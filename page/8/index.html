
<!DOCTYPE html>
<html lang="zh-tw">
    
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css">

    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/min/moment.min.js"></script>
    
      <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/locale/zh-tw.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
    <script>
      window.algoliaConfig = {
        appId: 'AWFC86Q51O',
        apiKey: 'c9d952906eb1b154d75cf863e75c1ede',
        indexName: 'MyBlog'
      };
      var algoliaIndex = algoliasearch(
        algoliaConfig.appId,
        algoliaConfig.apiKey
      ).initIndex(algoliaConfig.indexName);
    </script>


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Kein&#39;s blog">
    <title>Kein&#39;s blog</title>
    <meta name="author" content="Kein Chan">
    
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"Website","@id":"https://chankein.github.io","author":{"@type":"Person","name":"Kein Chan","sameAs":["https://github.com/chankein/","https://www.linkedin.com/profile/","mailto:kein.chan85@gmail.com"],"image":"profile.jpg"},"name":"Kein's blog","description":"","url":"https://chankein.github.io"}</script>
    <meta property="og:type" content="blog">
<meta property="og:title" content="Kein&#39;s blog">
<meta property="og:url" content="https://chankein.github.io/page/8/index.html">
<meta property="og:site_name" content="Kein&#39;s blog">
<meta property="og:locale" content="zh_TW">
<meta property="article:author" content="Kein Chan">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="https://chankein.github.io../../assets/images/profile.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="../../assets/css/style-l9zwheso7r7pnk98nvirovsz9dl7fhkrc9mlb5vmuxw7tk5movrk0eevsrpr.min.css">

    <!--STYLES END-->
    

    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="../../index.html"
            aria-label=""
        >
            Kein&#39;s blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="打開鏈接: ../../#about"
            >
        
        
            <img class="header-picture" src="../../assets/images/profile.jpg" alt="作者的圖片"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="../../#about"
                    aria-label="閱讀有關作者的更多信息"
                >
                    <img class="sidebar-profile-picture" src="../../assets/images/profile.jpg" alt="作者的圖片"/>
                </a>
                <h4 class="sidebar-profile-name">Kein Chan</h4>
                
                    <h5 class="sidebar-profile-bio"><p>這是獨立全棧工程師Kein Chan的技術博客</br>分享一些技術教程,命令備忘(cheat-sheet)等</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../index.html"
                            
                            rel="noopener"
                            title="首頁"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首頁</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../all-categories"
                            
                            rel="noopener"
                            title="分類"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分類</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../all-tags"
                            
                            rel="noopener"
                            title="標籤"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">標籤</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../all-archives"
                            
                            rel="noopener"
                            title="所有文章"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">所有文章</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="搜尋"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">搜尋</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="關於"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">關於</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/chankein/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/profile/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../mailto:kein.chan85@gmail.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Email"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Email</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../atom.xml"
                            
                            rel="noopener"
                            title="Atom"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Atom</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../2023/04/14/Algorithms/Astar%E6%90%9C%E7%B4%A2%E7%AE%97%E6%B3%95%E7%AE%80%E4%BB%8B%E5%8F%8A%E4%BF%9D%E5%A7%86%E7%BA%A7%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB/"
                            aria-label=": Astar搜索算法简介及保姆级代码解读"
                        >
                            Astar搜索算法简介及保姆级代码解读
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2023-04-14T15:43:00+08:00">
	
		    2023 年 4 月 14 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../categories/%E7%AE%97%E6%B3%95/">算法</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h4 id="A-搜索算法简介及保姆级代码解读">A*搜索算法简介及保姆级代码解读</h4>
<ul>
<li><a href="#1_A_1">1. A*算法简单介绍</a></li>
<li>
<ul>
<li><a href="#11_A_12">1.1 A*算法理论基础</a></li>
<li>
<ul>
<li><a href="#111__31">1.1.1 节点计算</a></li>
<li><a href="#112__60">1.1.2 由计算得出的小结论</a></li>
</ul>
</li>
<li><a href="#12__70">1.2 算法逻辑结构</a></li>
</ul>
</li>
<li><a href="#2__80">2. 代码解析</a></li>
<li>
<ul>
<li><a href="#21__81">2.1 引入地图</a></li>
<li><a href="#22__159">2.2 预处理</a></li>
<li><a href="#23_parent_286">2.3 定义父节点`parent`</a></li>
<li><a href="#24__296">2.4 主循环</a></li>
<li>
<ul>
<li><a href="#241_359">2.4.1</a></li>
<li><a href="#242_364">2.4.2</a></li>
<li><a href="#243_380">2.4.3</a></li>
<li><a href="#244_383">2.4.4</a></li>
<li><a href="#245_396">2.4.5</a></li>
</ul>
</li>
<li><a href="#25__414">2.5 画图</a></li>
</ul>
</li>
<li><a href="#3__427">3. 结果</a></li>
</ul>
<h2 id="1-A-算法简单介绍">1. A*算法简单介绍</h2>
<p>A*算法是一种路径规划算法，和传统的Dijkstra算法有所不同，该算法<strong>有选择</strong>地进行节点搜索，因此比Dijkstra算法更快、搜索的点更少。<br>
阅读本文，不需要掌握Dijkstra算法的知识，请放心食用。<br>
注意：<strong>本文只介绍二维A*算法及相关示例</strong>。</p>
<p><strong>PS</strong>：本文代码编写参考B站up主<br>
<code>小黎的Ally</code>的<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Jt4y1z7Ry?from=search&amp;seid=14748520462847442393&amp;spm_id_from=333.337.0.0">路径规划与轨迹跟踪系列算法学习_第4讲_A*算法</a>，讲解详细，本文代码部分是将其代码进行了些许改动并加以解释，在此对up主的辛苦表达感谢！！</p>
<p><strong>PPS</strong>：本文所使用的把地图栅格化的函数来自于博客<br>
<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42667352/article/details/98523370">Matlab中将一幅图片做成栅格地图</a>，本文进行了些许改动，再次一并感谢博主的辛苦！</p>
<h3 id="1-1-A-算法理论基础">1.1 A*算法理论基础</h3>
<p>A*算法首先将要搜索的区域划分为若干栅格（grid），并有选择地标识出障碍物（Obstacle）与空白区域。一般地，<strong>栅格划分越细密，搜索点数越多，搜索过程越慢，计算量也越大；栅格划分越稀疏，搜索点数越少，相应地搜索精确性就越低</strong>。<br>
<img src="https://i-blog.csdnimg.cn/blog_migrate/e5a5e9d6d0f36afb2bf3f1cd9ef378ac.png#pic_center" alt="地图栅格"></p>
<p>如上图，引入地图信息后画出栅格，该图片采用 100 × 100 100 \times 100 100×100的栅格划分，图中黑色区域为障碍物区域。图中绿点为起始点，红点为终点。</p>
<p>对每个节点，在计算时同时考虑两项<strong>代价</strong>指标：<strong>当前节点与起始点的距离</strong>，以及<strong>当前节点与目标点的距离</strong>：<br>
f = g + h f = g + h f=g+h其中 f f f为总代价， g g g为当前节点距离起始点的距离， h h h为当前节点距离目标点的距离。<br>
而在计算距离时，又可以采用两种方式：<br>
<strong>欧氏距离</strong>：<br>
L = ( x 1 − x 2 ) 2 + ( y 1 − y 2 ) 2 L = \sqrt{\left( x_1 - x_2 \right) ^2 + \left( y_1 - y_2 \right) ^2} L=(x1​−x2​)2+(y1​−y2​)2 ​<strong>曼哈顿距离</strong>：<br>
L = ∣ x 1 − x 2 ∣ + ∣ y 1 − y 2 ∣ L = \lvert x_1 - x_2 \rvert + \lvert y_1 - y_2 \rvert L=∣x1​−x2​∣+∣y1​−y2​∣为了计算方便，本文计算 h h h时采用<strong>曼哈顿距离</strong>，这也是A*算法中的一贯做法。<br>
为了方便计数，在计算每一个节点时，在栅格左上角写 f f f值，左下角写 g g g值，右下角写 h h h值。</p>
<h4 id="1-1-1-节点计算">1.1.1 节点计算</h4>
<p>这里举一个例子。<br>
<img src="https://i-blog.csdnimg.cn/blog_migrate/86fca2663892fb458c7cdef9e81facdf.jpeg#pic_center" alt="节点计算例1"><br>
如图所示，A点为起始点，M点为终点。对于A点来说，对其周边的8个节点进行寻找，A点本身为<strong>父节点</strong>，周边8个点为<strong>子节点</strong>。</p>
<p>假设：</p>
<ul>
<li>格子边长为10，这样水平和竖直位移一格为10，而对角位移一格为14；</li>
<li>从父节点到子节点可以水平、竖直、对角线位移计算 g g g值，而从子节点到目标点只能使用水平、竖直位移计算曼哈顿距离 h h h值。</li>
</ul>
<p>对于点B：从A到B只需右移一格，因此B的 g = 10 g=10 g=10；从B到M需要先右移四格，再上移三格，因此B的 h = 40 + 30 = 70 h = 40+30=70 h=40+30=70。这样B的 f = g + h = 10 + 70 = 80 f=g+h=10+70=80 f=g+h=10+70=80。将三者都记在B格中。<br>
对于点C：从A到C只需向右上方平移一格，因此C的 g = 14 g=14 g=14；从C到M需要先右移四格，再上移两格，因此C的 h = 40 + 20 = 60 h=40+20=60 h=40+20=60，继而C的 f = g + h = 74 f=g+h=74 f=g+h=74。<br>
同理可以计算出D的 g = 14 , h = 80 , f = 94 g=14, h=80,f=94 g=14,h=80,f=94，以及其他几个子节点的值。</p>
<p>将这8个子节点进行对比，可以发现，C点的 f f f值最小，因此选取C点为下一步搜寻的父节点， A C ‾ \overline{AC} AC即为路径迈出的第一步。<br>
<img src="https://i-blog.csdnimg.cn/blog_migrate/61d8dbfe6ffe8e4eb0d95eb32b2a6032.jpeg#pic_center" alt="节点计算例2"><br>
如图所示，现在将C作为新的父节点。</p>
<p>对于J点：<br>
从C到J只需右移一格，因此J的 g = 10 + g C = 10 + 14 = 24 g=10+g_C =10+14=24 g=10+gC​=10+14=24。需要注意的是，<strong>J点的 g g g值是从C到J的 g g g加上从A到C的 g g g，即当前子节点的 g g g值是从起点到该点的所有 g g g累和</strong>。<br>
从J到M需要先右移三格，再上移两格，因此J的 h = 30 + 20 = 50 h = 30+20=50 h=30+20=50。这样J的 f = g + h = 24 + 50 = 74 f=g+h=24+50=74 f=g+h=24+50=74。将三者都记在J格中。</p>
<p>对于I点：<br>
从C到I只需向右上方平移一格，同样地，<strong>I点的 g g g值是从C到I的 g g g加上从A到C的 g g g，即当前子节点的 g g g值是从起点到该点的所有 g g g累和</strong>，因此I的 g = 14 + g C = 14 + 14 = 28 g=14+g_C =14+14=28 g=14+gC​=14+14=28。<br>
从I到M需要先右移三格，再上移一格，因此I的 h = 30 + 10 = 40 h = 30+10=40 h=30+10=40。这样I的 f = g + h = 28 + 40 = 68 f=g+h=28+40=68 f=g+h=28+40=68。将三者都记在I格中。<br>
同样计算出其他点的值。<br>
可以看出，I点的 f f f值最小，因此选择I点作为路径上的下一个点，此时路径变为 A C I ‾ \overline{ACI} ACI。</p>
<p>如此一步步进行迭代，最后找到最优轨迹。</p>
<h4 id="1-1-2-由计算得出的小结论">1.1.2 由计算得出的小结论</h4>
<ul>
<li>每个节点中需要存储至少3个值： g , h , f g,h,f g,h,f。</li>
<li>当子节点迭代到目标点本身时， h = 0 h=0 h=0，即当前节点到目标点的距离为0.</li>
<li>在算法实施时， g g g的计算可以取10或14，即从父节点到子节点可以水平/竖直位移，也可以沿对角线位移；而 h h h的计算只能取10的倍数，即从当前子节点到目标点只能水平/竖直位移。前者可以采用<strong>欧氏距离</strong>，后者只能采用<strong>曼哈顿距离</strong>。</li>
<li><strong>当某个子节点被选中后，就作为下一次搜索的父节点；并且为了避免节点的重复计算和筛选，在下一次搜索时，需要将上一步选中的节点从“可搜索”列表中删除</strong>。如上图中，当C为父节点时，选中I作为下一次的父节点；那么当第二步I为父节点时，由于C已经在已选轨迹上了，所以I的子节点实际上并不包括C，只计算7个子节点即可。</li>
<li>鉴于上一点，可以预想，算法的具体实施过程中，<strong>需要有两个数组保存“待计算子节点”和“已被选中的节点”。当“待计算子节点”中某个点符合 f f f最小时，就将其加入“已选中的节点”，并在“待计算子节点”中删除该点，防止后续重复计算</strong>。</li>
<li>当算法结束时，<strong>保存在“已选中的节点”中的所有点，按照顺序即为找出的路径</strong>。</li>
<li>算法结束时，<strong>最后一个点的 f f f值，即为从起点到终点所用的距离</strong>。</li>
<li>算法的停止条件：1)当“待计算子节点”中没有点时，即已经没有点可供寻找了；2)当当前父节点恰为目标节点时，即 h = 0 h=0 h=0。</li>
</ul>
<h3 id="1-2-算法逻辑结构">1.2 算法逻辑结构</h3>
<p>A*算法的逻辑结构如下：<br>
1）初始化。导入地图信息，设置障碍物区域，设置起点<code>start</code>、终点<code>target</code>、栅格数量 m × n m \times n m×n等。<br>
2）数据预处理。建立“待计算子节点”的数组<code>openlist</code>，“已选中的节点”的数组<code>closelist</code>，保存路径的数组<code>closelist_path</code>。除此之外，还需建立一个当前子节点集合<code>children</code>，用来保存当前父节点周围8个子节点的坐标，以及父节点本身<code>parent</code>；还有保存代价值 g , h , f g, h,f g,h,f的数组<code>openlist_cost</code>和<code>closelist_cost</code>。<br>
3）对子节点们<code>children</code>中的每个节点<code>child</code>：<br>
若该子节点不在“待计算子节点”节点<code>openlist</code>中，则追加进去；<br>
若在，则计算出该<code>child</code>的 g g g值，该 g g g值是从起点到父节点<code>parent</code>的距离加上父节点到该子节点的距离。若该 g g g值小于之前<code>openlist_cost</code>中的 g g g最小值，那么就将<code>openlist_cost</code>中的最小 g g g值更新；<br>
4）由于该代价最小点已经加入了轨迹，因此将该点加入<code>clost_list</code>和<code>closelist_path</code>，并从<code>openlist</code>中剔除；<br>
5）更新<code>openlist</code>中的最小代价值，并以其为父节点开始新一轮搜索。</p>
<h2 id="2-代码解析">2. 代码解析</h2>
<h3 id="2-1-引入地图">2.1 引入地图</h3>
<p>代码块：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">%% 画地图</span><br><span class="line"></span><br><span class="line">% 栅格地图的行数、列数定义</span><br><span class="line">m = 150;</span><br><span class="line">n = 150;</span><br><span class="line">% 地图m行n列</span><br><span class="line"></span><br><span class="line">start = [10, 20];        % 起始节点</span><br><span class="line">target = [130, 80];       % 终止节点</span><br><span class="line"></span><br><span class="line">obs = TrunToGridMap(m, n);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">% 画格子</span><br><span class="line">for i = 0 : 5 : m</span><br><span class="line">    plot([0, n], [i, i], &#x27;k&#x27;, &#x27;handlevisibility&#x27;, &#x27;off&#x27;);</span><br><span class="line">    hold on;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">for j = 0 : 5 : n</span><br><span class="line">    plot([j, j], [0, m], &#x27;k&#x27;, &#x27;handlevisibility&#x27;, &#x27;off&#x27;);</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">axis equal;</span><br><span class="line">xlim([0, n]);</span><br><span class="line">ylim([0, m]);</span><br><span class="line"></span><br><span class="line">% 绘制障碍物、起止点颜色块</span><br><span class="line">scatter(start(1), start(2), 700, &#x27;pg&#x27;, &#x27;filled&#x27;);</span><br><span class="line">scatter(target(1), target(2), 700, &#x27;pr&#x27;, &#x27;filled&#x27;);</span><br><span class="line"></span><br><span class="line">for i = 1 : size(obs, 1) - 1</span><br><span class="line">    temp = obs(i, :);</span><br><span class="line">    fill([temp(1)-1, temp(1), temp(1), temp(1)-1],...</span><br><span class="line">        [temp(2)-1, temp(2)-1, temp(2), temp(2)], &#x27;k&#x27;, &#x27;handlevisibility&#x27;, &#x27;off&#x27;);</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">temp = obs(size(obs, 1), :);</span><br><span class="line">fill([temp(1)-1, temp(1), temp(1), temp(1)-1],...</span><br><span class="line">    [temp(2)-1, temp(2)-1, temp(2), temp(2)], &#x27;k&#x27;);</span><br></pre></td></tr></table></figure>
<p>绘制一个 150 × 150 150 \times 150 150×150的地图，起点设置为 ( 10 , 20 ) (10,20) (10,20)，终点设置为 ( 130 , 80 ) (130,80) (130,80)。<br>
障碍物的坐标通过函数<code>TrunToGridMap(m, n)</code>获得：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">function obs = TrunToGridMap(a, b)</span><br><span class="line">    I=imread(&#x27;此处放地图图片的文件名&#x27;);   %读入图片</span><br><span class="line">    I = rgb2gray(I);     %将图片转为灰度图</span><br><span class="line">    I = imrotate(I, -90);</span><br><span class="line"></span><br><span class="line">    l=1;    %网格边长</span><br><span class="line">    B = imresize(I,[a/l b/l]);</span><br><span class="line">    J=floor(B/255); </span><br><span class="line"></span><br><span class="line">    axes(&#x27;GridLineStyle&#x27;, &#x27;-&#x27;);</span><br><span class="line">    axis equal;</span><br><span class="line"></span><br><span class="line">    hold on</span><br><span class="line">    grid on</span><br><span class="line">    axis([0,a,0,b]);</span><br><span class="line">    set(gca,&#x27;xtick&#x27;,0:10:a,&#x27;ytick&#x27;,0:10:b);</span><br><span class="line"></span><br><span class="line">    obs = [];</span><br><span class="line"></span><br><span class="line">    %障碍物填充为黑色</span><br><span class="line">    for i=1:a/l-1</span><br><span class="line">        for j=1:b/l-1</span><br><span class="line">            if(J(i,j)==0)</span><br><span class="line">                obs(end+1, :) = [i, j];</span><br><span class="line">            end</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>该函数读取一个图片文件，将其转化为灰度图像，并将灰度图中黑色色块所在的坐标返回为障碍物坐标。</p>
<h3 id="2-2-预处理">2.2 预处理</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">%% 预处理</span><br><span class="line"></span><br><span class="line">% 初始化closelist</span><br><span class="line">closelist = start;</span><br><span class="line">closelist_path = &#123;start, start&#125;;      % 路径，从自身到自身</span><br><span class="line">closelist_cost = 0;</span><br><span class="line">children = child_nodes_cal(start, m, n, obs, closelist);</span><br><span class="line"></span><br><span class="line">% 初始化openlist</span><br><span class="line">openlist = children;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for i = 1 : size(openlist, 1)   % i为第i个节点</span><br><span class="line">    openlist_path&#123;i, 1&#125; = openlist(i, :);   % openlist_path的第i行第1列为第i个节点child</span><br><span class="line">    openlist_path&#123;i, 2&#125; = [start; openlist(i, :)]; % openlist_path的第i行第2列为一个列向量，分别是起始节点和当前child</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">for i = 1 : size(openlist, 1)</span><br><span class="line">    g = norm(start - openlist(i, 1:2));</span><br><span class="line">    h = abs(target(1) - openlist(i, 1)) + abs(target(2) - openlist(i, 2));</span><br><span class="line">    f = g + h;</span><br><span class="line">    openlist_cost(i, :) = [g, h, f];</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>这一部分主要做了以下几步：</p>
<ul>
<li>把起点<code>start</code>设为轨迹的第一个点：<code>closelist = start</code>；</li>
<li>路径初始化，即从起点到起点：<code>closelist_path = &#123;start, start&#125;</code>；</li>
<li>代价首先置为0：<code>closelist_cost = 0</code>；</li>
<li>利用<code>child_nodes_cal</code>函数计算当前父节点（即起点）周围的子节点们；</li>
<li>这些子节点们<code>children</code>即为待计算的子节点，也就是<code>openlist</code>；</li>
<li>随后进入一个循环，对每一个子节点i，<code>openlist_path</code>中第i行第1个元素储存第i个节点<code>child</code>，第2个元素为一个<strong>列向量</strong>，分别是第i个<code>child</code>的起点和它本身；</li>
<li>第二个循环则是计算代价的循环，对每一个子节点i，计算 g g g（这里使用<strong>范数</strong><code>norm</code>）， h h h（曼哈顿距离）和 f f f；之后，在代价数组<code>openlist_cost</code>中储存这三个代价值，因此<code>openlist_cost</code>第i行的元素为一个<strong>行向量</strong>；</li>
</ul>
<p>其中用到的子节点计算函数如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">function child_nodes = child_nodes_cal(parent_node, m, n, obs, closelist)</span><br><span class="line">    child_nodes = [];</span><br><span class="line">    field = [1, 1;</span><br><span class="line">        n, 1;</span><br><span class="line">        n, m;</span><br><span class="line">        1, m];</span><br><span class="line">    </span><br><span class="line">    % 左上子节点</span><br><span class="line">    child_node = [parent_node(1) - 1, parent_node(2) + 1];</span><br><span class="line">    if inpolygon(child_node(1), child_node(2), field(:, 1), field(:, 2))</span><br><span class="line">        % [in, on] = inpolygon, 返回 in，以指明 xq 和 yq 所指定的查询点是在 xv 和 </span><br><span class="line">        % yv 定义的多边形区% 域的边缘内部还是在边缘上,in为内部，on为边缘上</span><br><span class="line">        if ~ismember(child_node, obs, &#x27;rows&#x27;)</span><br><span class="line">            child_nodes = [child_nodes; child_node];</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    % 上子节点</span><br><span class="line">    child_node = [parent_node(1), parent_node(2) + 1];</span><br><span class="line">    if inpolygon(child_node(1), child_node(2), field(:, 1), field(:, 2))</span><br><span class="line">        if ~ismember(child_node, obs, &#x27;rows&#x27;)</span><br><span class="line">            child_nodes = [child_nodes; child_node];</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    % 右上子节点</span><br><span class="line">    child_node = [parent_node(1) + 1, parent_node(2) + 1];</span><br><span class="line">    if inpolygon(child_node(1), child_node(2), field(:, 1), field(:, 2))</span><br><span class="line">        if ~ismember(child_node, obs, &#x27;rows&#x27;)</span><br><span class="line">            child_nodes = [child_nodes; child_node];</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    % 左子节点</span><br><span class="line">    child_node = [parent_node(1) - 1, parent_node(2)];</span><br><span class="line">    if inpolygon(child_node(1), child_node(2), field(:, 1), field(:, 2))</span><br><span class="line">        if ~ismember(child_node, obs, &#x27;rows&#x27;)</span><br><span class="line">            child_nodes = [child_nodes; child_node];</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    %右子节点</span><br><span class="line">    child_node = [parent_node(1) + 1, parent_node(2)];</span><br><span class="line">    if inpolygon(child_node(1), child_node(2), field(:, 1), field(:, 2))</span><br><span class="line">        if ~ismember(child_node, obs, &#x27;rows&#x27;)</span><br><span class="line">            child_nodes = [child_nodes; child_node];</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    %左下子节点</span><br><span class="line">    child_node = [parent_node(1) - 1, parent_node(2) - 1];</span><br><span class="line">    if inpolygon(child_node(1), child_node(2), field(:, 1), field(:, 2))</span><br><span class="line">        if ~ismember(child_node, obs, &#x27;rows&#x27;)</span><br><span class="line">            child_nodes = [child_nodes; child_node];</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    % 下子节点</span><br><span class="line">    child_node = [parent_node(1), parent_node(2) - 1];</span><br><span class="line">    if inpolygon(child_node(1), child_node(2), field(:, 1), field(:, 2))</span><br><span class="line">        if ~ismember(child_node, obs, &#x27;rows&#x27;)</span><br><span class="line">            child_nodes = [child_nodes; child_node];</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    % 右下子节点</span><br><span class="line">    child_node = [parent_node(1) + 1, parent_node(2) - 1];</span><br><span class="line">    if inpolygon(child_node(1), child_node(2), field(:, 1), field(:, 2))</span><br><span class="line">        if ~ismember(child_node, obs, &#x27;rows&#x27;)</span><br><span class="line">            child_nodes = [child_nodes; child_node];</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    %% 排除已经存在于closelist的节点</span><br><span class="line">    delete_idx = [];</span><br><span class="line">    for i = 1 : size(child_nodes, 1)</span><br><span class="line">        if ismember(child_nodes(i, :), closelist, &#x27;rows&#x27;)</span><br><span class="line">            delete_idx(end+1, :) = i;</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    child_nodes(delete_idx, :) = [];</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h3 id="2-3-定义父节点parent">2.3 定义父节点<code>parent</code></h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">%% 定义父节点</span><br><span class="line">% 从openlist开始搜索移动代价最小的节点</span><br><span class="line">[~, min_idx] = min(openlist_cost(:, 3));    % 看f值最小，min_idx为f最小的那一行</span><br><span class="line">parent = openlist(min_idx, :);% 以min_idx该行的子节点child_node为新的父节点</span><br></pre></td></tr></table></figure>
<p>这一步搜索<code>openlist_cost</code>代价数组中 f f f最小的元素，记下其索引<code>min_idx</code>；<br>
随后该索引对应的<code>openlist</code>中的元素即为“ f f f值最小的待计算子节点”，作为下一步计算的父节点<code>parent</code>。</p>
<h3 id="2-4-主循环">2.4 主循环</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">%% 进入循环</span><br><span class="line">flag = 1;</span><br><span class="line">while flag</span><br><span class="line">    % 找出父节点的忽略closelist的子节点</span><br><span class="line">    children = child_nodes_cal(parent ,m, n, obs, closelist);</span><br><span class="line">    </span><br><span class="line">    % 判断这些子节点是否在openlist中，若在，则更新；没在，则追加到openlist中</span><br><span class="line">    for i = 1 : size(children, 1)</span><br><span class="line">        child = children(i, :);</span><br><span class="line">        [in_flag, openlist_idx] = ismember(child, openlist, &#x27;rows&#x27;);</span><br><span class="line">        % in_flag表示该child_node是否在openlist中</span><br><span class="line">        % openlist_idx表示该child_node在openlist中的行数</span><br><span class="line">        </span><br><span class="line">        g = openlist_cost(min_idx, 1) + norm(parent - child);</span><br><span class="line">        % 原来的g加上新的g</span><br><span class="line">        h = abs(child(1) - target(1)) + abs(child(2) - target(2));</span><br><span class="line">        f = g + h;</span><br><span class="line">        </span><br><span class="line">        if in_flag  % 若在，则比较更新g, f</span><br><span class="line">            if g &lt; openlist_cost(openlist_idx, 1)   </span><br><span class="line">                % openlist_cost(openlist_idx,1)指的是openlist_cost中idx这一行（即child_node所在的一行）的第一个坐标，即g</span><br><span class="line">                openlist_cost(openlist_idx, 1) = g;</span><br><span class="line">                openlist_cost(openlist_idx, 3) = f;</span><br><span class="line">                openlist_path&#123;openlist_idx, 2&#125; = [openlist_path&#123;min_idx, 2&#125;; child];</span><br><span class="line">                % openlist_path的第i行第2列为一个列向量，分别是起始节点和当前child，此处定义新的起始节点为openlist_path(min_idx,2)， 而openlist_path(min_idx,2)指第min_idx行所对应的 child在openlist_path中对应的路径，相当于把新的child附加到了路径上，延长了路径</span><br><span class="line">            end</span><br><span class="line">        else</span><br><span class="line">            openlist(end+1, :) = child;</span><br><span class="line">            openlist_cost(end+1, :) = [g, h, f];</span><br><span class="line">            openlist_path&#123;end+1, 1&#125; = child;</span><br><span class="line">            openlist_path&#123;end, 2&#125; = [openlist_path&#123;min_idx, 2&#125;; child];</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    % 从openlist移除代价最小的节点到closelist</span><br><span class="line">    closelist(end+1, :) = openlist(min_idx, :);</span><br><span class="line">    closelist_cost(end+1, :) = openlist_cost(min_idx, 3);</span><br><span class="line">    closelist_path(end+1, :) = openlist_path(min_idx, :);</span><br><span class="line">    </span><br><span class="line">    % 同样地，openlist中少了该节点</span><br><span class="line">    openlist(min_idx, :) = [];</span><br><span class="line">    openlist_cost(min_idx, :) = [];</span><br><span class="line">    openlist_path(min_idx, :) = [];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    % 重新搜索：从openlist搜索移动代价最小的节点，作为新的父节点</span><br><span class="line">    [~, min_idx] = min(openlist_cost(:, 3));</span><br><span class="line">    parent = openlist(min_idx, :);</span><br><span class="line">    </span><br><span class="line">    % 判断是否搜索到终点</span><br><span class="line">    if parent == target</span><br><span class="line">        closelist(end+1, :) = openlist(min_idx, :);</span><br><span class="line">        closelist_cost(end+1, 1) = openlist_cost(min_idx, 1);</span><br><span class="line">        closelist_path(end+1, :) = openlist_path(min_idx, :);</span><br><span class="line">        flag = 0;</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h4 id="2-4-1">2.4.1</h4>
<p>对这一部分循环来说，首先利用<code>child_nodes_cal</code>函数得出当前父节点<code>parent</code>周围的子节点们<code>children</code>；<br>
对每一个子节点<code>child</code>，判断其是否在“待计算子节点”<code>openlist</code>列表中——<code>in_flag</code>=1表示在列表中，同时<code>openlist_idx</code>为该子节点在<code>openlist</code>中的索引号。<br>
判断完成后，首先计算该子节点的 g , h , f g,h,f g,h,f值，注意： g g g值为父节点<code>parent</code>的 g g g加上该<code>child</code>子节点的 g g g值。</p>
<h4 id="2-4-2">2.4.2</h4>
<p>计算 g , h , f g,h,f g,h,f之后，再来看子节点在<code>openlist</code>中的情况。<strong>由于循环中查看了<code>parent</code>周围所有子节点的情况，所以一定会存在某个子节点的 g g g比其他子节点的 g g g都小</strong>。如果找到了这样的子节点，那么就更新该子节点在<code>openlist_cost</code>中对应位置的 g , h , f g,h,f g,h,f值。</p>
<p>同时，还要将该子节点加入到路径<code>openlist_path</code>中，即这一句代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openlist_path&#123;openlist_idx, 2&#125; = [openlist_path&#123;min_idx, 2&#125;; child];</span><br></pre></td></tr></table></figure>
<p>这行代码的含义是：<br>
<code>openlist_idx</code>表示当前子节点<code>child</code>在<code>openlist</code>中的索引，<code>min_idx</code>表示之前所有子节点中代价最小的子节点的索引。之前在<strong>预处理</strong>一节中提到，<code>openlist_path</code>的第i行第2列为一个列向量，分别是父节点和当前child，相当于第2列储存了路径。</p>
<p>而<code>min_idx</code>表示“代价最小的节点”，也就是父节点<code>parent</code>。因此这里<code>openlist_path&#123;min_idx, 2&#125;</code>表示父节点的路径。而<code>[openlist_path&#123;min_idx, 2&#125;; child]</code>则是把新的<code>child</code>附加到这一个列向量上，相当于把新的<code>child</code>附加到路径尾端，把向量长度延长了一个<code>child</code>，延长了路径。</p>
<p>这样，<strong><code>[openlist_path&#123;min_idx, 2&#125;; child]</code>构成了一个“父节点路径-当前child”的新路径</strong>。</p>
<p>把这个新路径赋值给<code>openlist_idx</code>索引所对应的<code>openlist_path</code>上，即为该<code>openlist_idx</code>索引对应的子节点的路径。</p>
<h4 id="2-4-3">2.4.3</h4>
<p>另一方面，如果该<code>child</code>不在<code>openlist</code>中，那么就把该<code>child</code>添加到“待计算子节点”列表中，其 g , h , f g,h,f g,h,f值添加到<code>openlist_cost</code>代价列表中，其路径<code>[openlist_path&#123;min_idx, 2&#125;; child]</code>添加到路径<code>openlist_path</code>中。</p>
<h4 id="2-4-4">2.4.4</h4>
<p>由于移动代价最小的节点已经是路径上的一点了，所以为了避免重复计算，应当把她从“待计算子节点”列表中删除，加入“已计算节点”中，即</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">closelist(end+1, :) = openlist(min_idx, :);</span><br><span class="line">closelist_cost(end+1, :) = openlist_cost(min_idx, 3);</span><br><span class="line">closelist_path(end+1, :) = openlist_path(min_idx, :);</span><br><span class="line">% openlist中少了该节点</span><br><span class="line">openlist(min_idx, :) = [];</span><br><span class="line">openlist_cost(min_idx, :) = [];</span><br><span class="line">openlist_path(min_idx, :) = [];</span><br></pre></td></tr></table></figure>
<p>仔细观察不难发现，<code>min_idx</code>对应的正是这一步的<code>parent</code>节点，直到这里，我们才把它加入到“已计算节点”列表中，在之前它一直呆在<code>openlist</code>中。</p>
<h4 id="2-4-5">2.4.5</h4>
<p>父节点加入到了“已计算节点”中了，那么下一步就没有父节点了，所以需要找出新的父节点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> [~, min_idx] = min(openlist_cost(:, 3));</span><br><span class="line">parent = openlist(min_idx, :);</span><br></pre></td></tr></table></figure>
<p>同时还需要判断一下，是否已经进行到了程序结束：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">% 判断是否搜索到终点</span><br><span class="line">if parent == target</span><br><span class="line">    closelist(end+1, :) = openlist(min_idx, :);</span><br><span class="line">    closelist_cost(end+1, 1) = openlist_cost(min_idx, 1);</span><br><span class="line">    closelist_path(end+1, :) = openlist_path(min_idx, :);</span><br><span class="line">    flag = 0;</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>需要注意，即使当当前父节点已经是目标点了，也不要忘了把这个父节点加入到“已计算节点”中，相当于把目标点添加入路径中，形成路径上最后一个点。</p>
<h3 id="2-5-画图">2.5 画图</h3>
<p>这一步就是将结果绘制出来了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">path_opt = closelist_path&#123;end, 2&#125;;</span><br><span class="line">% closelist_path中第二列存放路径，所以path_opt存放的是路径的(x,y)值</span><br><span class="line">path_opt(:, 1) = path_opt(:, 1) - 0.5;</span><br><span class="line">path_opt(:, 2) = path_opt(:, 2) - 0.5;</span><br><span class="line">plot(path_opt(:, 1), path_opt(:, 2), &#x27;m&#x27;, &#x27;linewidth&#x27;, 1.5);</span><br><span class="line"></span><br><span class="line">title([&#x27;Total length of path: &#x27; num2str(closelist_cost(end, 1))]);</span><br><span class="line">legend(&#x27;Start node&#x27;, &#x27;Target node&#x27;, &#x27;Obstacle&#x27;, &#x27;Path&#x27;, &#x27;location&#x27;, &#x27;northwest&#x27;);</span><br><span class="line">set(gca, &#x27;fontsize&#x27;, 35, &#x27;fontname&#x27;, &#x27;times new roman&#x27;);</span><br></pre></td></tr></table></figure>
<h2 id="3-结果">3. 结果</h2>
<p>这里导入稻妻地图作为路径规划的示例，该地图多为岛屿，路径复杂，障碍物分散且数量多，十分适合作为示例使用。<br>
<img src="https://i-blog.csdnimg.cn/blog_migrate/fcf59433821c1051a8f8714547d79018.png#pic_center" alt="稻妻地图"><br>
将其灰度化得到<br>
<img src="https://i-blog.csdnimg.cn/blog_migrate/124b144e99366faa9e582a913fc277e3.jpeg#pic_center" alt="灰度稻妻"><br>
把地图划分为 m × n = 150 × 150 m \times n = 150 \times 150 m×n=150×150的栅格，并设置起点为 ( 10 , 20 ) (10,20) (10,20)，终点为 ( 130 , 80 ) (130,80) (130,80)：<br>
<img src="https://i-blog.csdnimg.cn/blog_migrate/50113f38beb35b89434c28535c12ba1b.png#pic_center" alt="稻妻地图栅格"><br>
图中绿色为起点，红色为终点。</p>
<p>路径规划结果：<br>
<img src="https://i-blog.csdnimg.cn/blog_migrate/8a875e6b8ffc0c48064351488be0d262.png#pic_center" alt="稻妻路径规划"><br>
可以看出，A* 算法可以找到期望路径。</p>
<p>文件所有代码在笔者的资源<a target="_blank" rel="noopener" href="https://download.csdn.net/download/weixin_58399148/43085850">二维A*算法路径规划matlab代码</a>中可以下载得到。</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../2023/04/14/Algorithms/Astar%E6%90%9C%E7%B4%A2%E7%AE%97%E6%B3%95%E7%AE%80%E4%BB%8B%E5%8F%8A%E4%BF%9D%E5%A7%86%E7%BA%A7%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../2023/04/12/Algorithms/Dijkstra%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/"
                            aria-label=": Dijkstra简单介绍"
                        >
                            Dijkstra简单介绍
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2023-04-12T22:53:09+08:00">
	
		    2023 年 4 月 12 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../categories/%E7%AE%97%E6%B3%95/">算法</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>不是有个叫迪杰斯特拉(Dijkstra)的算法吗？名字难记不说，加权图的最短路径问题在实际开发中也很少需要自己实现，所以总是很快就忘了。。。</p>
<h2 id="迪杰斯特拉算法是什么"><a href="#%E8%BF%AA%E6%9D%B0%E6%96%AF%E7%89%B9%E6%8B%89%E7%AE%97%E6%B3%95%E6%98%AF%E4%BB%80%E4%B9%88"></a>迪杰斯特拉算法是什么</h2>
<p>迪杰斯特拉算法是一种用于求解图的最短路径的算法。很多人可能只是听过这个名字。虽然它的原理简单易懂，但初次接触可能有些难以理解，不过只要逐步分析就会发现它其实是一个相当直观的算法。<br>
对于没有权重的迷宫搜索等问题，可以用广度优先搜索(BFS)解决，但如果每条边都有权重，就需要计算所有可能的路径。假设每个顶点只经过一次，且有E条边，那么时间复杂度会是O(E!)，计算量会爆炸式增长。<br>
这样计算起来就很不现实。</p>
<p>而迪杰斯特拉算法正是高效解决这类问题的算法。</p>
<p>需要注意的是，各边的成本必须是非负值（大于等于0）。如果包含负数，则需要使用贝尔曼-福特(Bellman-Ford)等算法。</p>
<h2 id="步骤"><a href="#%E6%AD%A5%E9%AA%A4"></a>步骤</h2>
<p>迪杰斯特拉算法的步骤非常简单：</p>
<ol>
<li>将起点的最短距离设为0</li>
<li>从未访问的点中选择已知最短距离且距离最小的顶点移动</li>
<li>设置该顶点连接的其他顶点的最短距离。如果可以更新更短的距离，则更新。</li>
<li>重复以上步骤，直到所有顶点的最短距离都确定</li>
</ol>
<p>光这么说可能有点抽象，下面我们通过一个具体例子来说明。</p>
<h2 id="示例"><a href="#%E7%A4%BA%E4%BE%8B"></a>示例</h2>
<p>虽然方法很原始，但这是最能表达清楚的方式…<br>
我们来看下面这张图的最短路径：<br>
<a target="_blank" rel="noopener" href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F134294%2F90f90a2f-8991-1bc5-adb4-fb4b053a901f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b9d055575e737f8a2c459474e25322c7"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F134294%2F90f90a2f-8991-1bc5-adb4-fb4b053a901f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b9d055575e737f8a2c459474e25322c7" alt="image.png"></a></p>
<p>绿色表示最短路径已确定并已访问的顶点，红色是起点顶点。每个顶点上的数字表示当前的最短路径：<br>
<a target="_blank" rel="noopener" href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F134294%2Fae1ddc01-e867-8894-7aee-3940269cfe2e.gif?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0b8d3bd32321d163185bac4e6ecf4db7"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F134294%2Fae1ddc01-e867-8894-7aee-3940269cfe2e.gif?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0b8d3bd32321d163185bac4e6ecf4db7" alt="dijkstra algo.gif"></a></p>
<p>可以看到，算法从起点开始，每次移动到当前最短路径的顶点，并计算相邻顶点的最短路径。</p>
<h2 id="实现"><a href="#%E5%AE%9E%E7%8E%B0"></a>实现</h2>
<p>接下来我们来实现这个算法。<br>
按照上述步骤直接实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params">nodes</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> start = nodes[<span class="number">0</span>]</span><br><span class="line">    <span class="comment">// 记录已访问的顶点</span></span><br><span class="line">    <span class="keyword">const</span> visited = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line">    <span class="keyword">const</span> routesFromStart = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">     <span class="comment">// 记录从起点出发的距离</span></span><br><span class="line"></span><br><span class="line">    routesFromStart.<span class="title function_">set</span>(start, &#123;<span class="attr">distance</span>: <span class="number">0</span>&#125;)</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">const</span> n <span class="keyword">of</span> nodes) &#123;</span><br><span class="line">        <span class="keyword">if</span>(n != start) &#123;</span><br><span class="line">            <span class="comment">// 除起点外所有顶点初始化为无穷大</span></span><br><span class="line">            routesFromStart.<span class="title function_">set</span>(n, &#123;<span class="attr">distance</span>: <span class="title class_">Number</span>.<span class="property">MAX_VALUE</span>&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> current = start</span><br><span class="line">    <span class="keyword">let</span> routes = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">    <span class="keyword">while</span>(current != <span class="literal">null</span>) &#123;</span><br><span class="line">        visited.<span class="title function_">add</span>(current)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">const</span> edge <span class="keyword">of</span> current.<span class="property">edges</span>) &#123;</span><br><span class="line">             <span class="comment">// 计算相邻顶点的最短距离，如果更小则更新</span></span><br><span class="line">            <span class="keyword">if</span>(edge.<span class="property">cost</span> + routesFromStart.<span class="title function_">get</span>(current).<span class="property">distance</span> &lt; routesFromStart.<span class="title function_">get</span>(edge.<span class="property">to</span>).<span class="property">distance</span>) &#123;</span><br><span class="line">                routesFromStart.<span class="title function_">set</span>(edge.<span class="property">to</span>, &#123;<span class="attr">distance</span>: edge.<span class="property">cost</span> + routesFromStart.<span class="title function_">get</span>(current).<span class="property">distance</span>&#125;)</span><br><span class="line">                routes.<span class="title function_">set</span>(current, edge.<span class="property">to</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> cheapestNodeDistance = <span class="title class_">Number</span>.<span class="property">MAX_VALUE</span></span><br><span class="line">        current = <span class="literal">null</span></span><br><span class="line">        <span class="comment">// 从已计算最短距离的未访问顶点中选择最小的顶点</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">const</span> city <span class="keyword">of</span> routesFromStart.<span class="title function_">keys</span>()) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!visited.<span class="title function_">has</span>(city) &amp;&amp; cheapestNodeDistance &gt; routesFromStart.<span class="title function_">get</span>(city).<span class="property">distance</span>)&#123;</span><br><span class="line">                cheapestNodeDistance = routesFromStart.<span class="title function_">get</span>(city).<span class="property">distance</span></span><br><span class="line">                current = city</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> routesFromStart.<span class="title function_">get</span>(nodes[nodes.<span class="property">length</span> - <span class="number">1</span>]).<span class="property">distance</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>假设顶点数为V，这段代码在最坏情况下需要遍历所有边，并在内部循环中选择最小顶点，因此时间复杂度是O(V² + E)。空间复杂度需要记录每个顶点，所以是O(V)。</p>
<h2 id="关于使用优先队列的实现"><a href="#%E5%85%B3%E4%BA%8E%E4%BD%BF%E7%94%A8%E4%BC%98%E5%85%88%E9%98%9F%E5%88%97%E7%9A%84%E5%AE%9E%E7%8E%B0"></a>关于使用优先队列的实现</h2>
<p>细心的读者可能已经发现，这段代码中选取最小顶点的逻辑可以优化，这就是优先队列(Priority Queue)。<br>
优先队列的插入和取出操作需要O(logN)的时间复杂度，但比线性搜索最小顶点更快。</p>
<p>JavaScript没有内置优先队列，以下是Python实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">dijkstra</span>(<span class="params">nodes</span>):</span><br><span class="line">    start_node = nodes[<span class="number">0</span>]</span><br><span class="line">    routes_from_start = &#123;n: math.inf <span class="keyword">for</span> n <span class="keyword">in</span> nodes&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 起点距离设为0</span></span><br><span class="line">    routes_from_start[start_node] = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    minHeap = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加起点</span></span><br><span class="line">    heappush(minHeap, (<span class="number">0</span>, start_node))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 直到堆为空</span></span><br><span class="line">    <span class="keyword">while</span> minHeap:</span><br><span class="line">        (cost, current_node) = heappop(minHeap)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查priority key是否重复</span></span><br><span class="line">        <span class="keyword">if</span> cost &gt; routes_from_start[current_node]:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> node <span class="keyword">in</span> current_node.routes:</span><br><span class="line">            price_info = current_node.routes[node]</span><br><span class="line">            <span class="keyword">if</span> routes_from_start[node] &gt; price_info + routes_from_start[current_node]:</span><br><span class="line">                routes_from_start[node] = price_info + routes_from_start[current_node]</span><br><span class="line">                <span class="comment"># 记录更新最短距离的节点</span></span><br><span class="line">                heappush(minHeap, (price_info + routes_from_start[current_node], node))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> routes_from_start[nodes[-<span class="number">1</span>]]</span><br></pre></td></tr></table></figure>
<p>优先队列的说明我们以后再讨论。<br>
优化后的算法时间复杂度为O(V + ElogE)，比最初的实现更高效。</p>
<h2 id="记录路径"><a href="#%E8%AE%B0%E5%BD%95%E8%B7%AF%E5%BE%84"></a>记录路径</h2>
<p>现在我们已经能求出最短成本，但这是&quot;最短路径&quot;问题，我们自然还想知道具体路径。<br>
改进上面的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">dijkstra</span>(<span class="params">nodes</span>):</span><br><span class="line">    start_node = nodes[<span class="number">0</span>]</span><br><span class="line">    routes_from_start = &#123;n: math.inf <span class="keyword">for</span> n <span class="keyword">in</span> nodes&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 起点距离设为0</span></span><br><span class="line">    routes_from_start[start_node] = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    minHeap = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加起点</span></span><br><span class="line">    heappush(minHeap, (<span class="number">0</span>, start_node))</span><br><span class="line">    path = collections.defaultdict(Node)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 直到堆为空</span></span><br><span class="line">    <span class="keyword">while</span> minHeap:</span><br><span class="line">        (cost, current_node) = heappop(minHeap)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查priority key是否重复</span></span><br><span class="line">        <span class="keyword">if</span> cost &gt; routes_from_start[current_node]:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> node <span class="keyword">in</span> current_node.routes:</span><br><span class="line">            price_info = current_node.routes[node]</span><br><span class="line">            <span class="keyword">if</span> routes_from_start[node] &gt; price_info + routes_from_start[current_node]:</span><br><span class="line">                routes_from_start[node] = price_info + routes_from_start[current_node]</span><br><span class="line">                <span class="comment"># 记录更新最短距离的节点</span></span><br><span class="line">                path[node.<span class="built_in">id</span>] = current_node.<span class="built_in">id</span></span><br><span class="line">                heappush(minHeap, (price_info + routes_from_start[current_node], node))</span><br><span class="line"></span><br><span class="line">    current_node = nodes[-<span class="number">1</span>].<span class="built_in">id</span></span><br><span class="line">    path_array = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 从终点回溯记录的最短路径节点</span></span><br><span class="line">    <span class="keyword">while</span> current_node:</span><br><span class="line">        path_array.append(current_node)</span><br><span class="line">        <span class="keyword">if</span> current_node <span class="keyword">not</span> <span class="keyword">in</span> path:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        current_node = path[current_node]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> routes_from_start[nodes[-<span class="number">1</span>]], path_array[::-<span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<p>迪杰斯特拉算法会记录更新最短距离的节点，最后回溯即可。时间复杂度会增加最短路径节点数的计算量。</p>
<h2 id="为什么这样能求出最短路径"><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%99%E6%A0%B7%E8%83%BD%E6%B1%82%E5%87%BA%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84"></a>为什么这样能求出最短路径</h2>
<p>看到这里，很多人可能会想：算法本身很简单，实现也不难，但为什么能保证求出最短距离呢？我们简单验证一下：</p>
<p><a target="_blank" rel="noopener" href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F134294%2F8623f00e-2046-445a-f386-6341b4bef518.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4286b7e1195710b30d6ffb7ab22967c7"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F134294%2F8623f00e-2046-445a-f386-6341b4bef518.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4286b7e1195710b30d6ffb7ab22967c7" alt="image.png"></a></p>
<p>假设集合L中的顶点到起点S的最短距离已确定，那么从L连接到的最小顶点也应该是S的最短距离。</p>
<p><a target="_blank" rel="noopener" href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F134294%2F8eb04095-91e7-85e6-93f1-93cd7f927fa0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b64897102d0f8dec7ed56385248d0a06"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F134294%2F8eb04095-91e7-85e6-93f1-93cd7f927fa0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b64897102d0f8dec7ed56385248d0a06" alt="image.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F134294%2Fa10dcc01-c558-6f52-3b6f-906cb3433456.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=57a5fb3ec3b55e91b33e0184905063aa"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F134294%2Fa10dcc01-c558-6f52-3b6f-906cb3433456.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=57a5fb3ec3b55e91b33e0184905063aa" alt="image.png"></a></p>
<p>在集合T中选取最小顶点i，则d[i] = min(T)。对于任意顶点k，最短距离d[k] ≥ d[i]是确定的，因为d[i]是最小值且各边权重非负。<br>
通过归纳法可以证明这一点。</p>
<p>其实这就是一个递推公式：</p>
<p>d[i] = min(k ⊂ T) + i到L中相邻顶点的最短距离</p>
<p>说到递推公式就想到动态规划(DP)。关于DP可以参考这篇文章：<br>
<a target="_blank" rel="noopener" href="https://qiita.com/drken/items/a5e6fe22863b7992efdb">https://qiita.com/drken/items/a5e6fe22863b7992efdb</a></p>
<p>用DP来看值的更新过程：<br>
<a target="_blank" rel="noopener" href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F134294%2F800c0d89-06f7-335a-5195-2f47d85cc22c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=76478692796218d17f0ab00d2f2651b4"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F134294%2F800c0d89-06f7-335a-5195-2f47d85cc22c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=76478692796218d17f0ab00d2f2651b4" alt="image.png"></a></p>
<p>纵轴表示迭代次数，横轴表示顶点。原来迪杰斯特拉算法是DP的一种啊。</p>
<h2 id="总结"><a href="#%E6%80%BB%E7%BB%93"></a>总结</h2>
<p>通过以上分析，迪杰斯特拉算法一旦理解后其实相当简单。以后在算法问题中遇到类似问题时，希望能快速联想到这个算法。<br>
*顺便说一句，我也想写一篇关于DP的文章</p>
<p>讲解视频可以在这里观看：<br>
<a target="_blank" rel="noopener" href="https://youtu.be/jz8b0q5R1Ss">https://youtu.be/jz8b0q5R1Ss</a></p>
<h2 id="参考"><a href="#%E5%8F%82%E8%80%83"></a>参考</h2>
<p><a target="_blank" rel="noopener" href="http://www.lab2.kuis.kyoto-u.ac.jp/~shuichi/algintro/alg-6s.pdf">http://www.lab2.kuis.kyoto-u.ac.jp/~shuichi/algintro/alg-6s.pdf</a><br>
<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=X1AsMlJdiok">https://www.youtube.com/watch?v=X1AsMlJdiok</a></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../2023/04/12/Algorithms/Dijkstra%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../2021/05/09/oracelBD%E5%9F%BA%E7%A1%80/"
                            aria-label=": oracelBD基础"
                        >
                            oracelBD基础
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-05-09T07:15:08+08:00">
	
		    2021 年 5 月 9 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../categories/database/">database</a>, <a class="category-link" href="../../categories/database/oracleDB/">oracleDB</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1>OracleDB 笔记整理</h1>
<h2 id="1-SQL-分类">1. SQL 分类</h2>
<table>
<thead>
<tr>
<th>分类</th>
<th>说明</th>
<th>关键字</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>DML</strong> (Data Manipulation Language)</td>
<td>数据操作语言</td>
<td><code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>MERGE</code></td>
</tr>
<tr>
<td><strong>DDL</strong> (Data Definition Language)</td>
<td>数据定义语言</td>
<td><code>CREATE</code>, <code>ALTER</code>, <code>DROP</code>, <code>RENAME</code>, <code>TRUNCATE</code>, <code>COMMENT</code></td>
</tr>
<tr>
<td><strong>DCL</strong> (Data Control Language)</td>
<td>数据控制语言</td>
<td><code>GRANT</code>, <code>REVOKE</code></td>
</tr>
<tr>
<td><strong>事务</strong> (Transaction)</td>
<td>事务控制</td>
<td><code>COMMIT</code>, <code>ROLLBACK</code>, <code>SAVEPOINT</code></td>
</tr>
</tbody>
</table>
<h2 id="2-OracleDB-构成">2. OracleDB 构成</h2>
<h3 id="2-1-基本构成">2.1 基本构成</h3>
<p>OracleDB 由 <strong>Oracle实例(instance)</strong> 和 <strong>Database</strong> 构成：</p>
<ul>
<li><strong>实例(Instance)</strong> 由：
<ul>
<li><strong>SGA(System Global Area)</strong>：内存区域</li>
<li><strong>Background Process</strong>：后台进程</li>
</ul>
</li>
<li><strong>Database</strong> 由：
<ul>
<li>控制文件（制御ファイル）</li>
<li>REDO 文件（REDO ログ）</li>
<li>数据文件（データファイル）</li>
</ul>
</li>
</ul>
<h3 id="2-2-进程视角">2.2 进程视角</h3>
<p>除了实例中的 <strong>Background Process</strong>，还包括：</p>
<ul>
<li>用户进程</li>
<li>服务器进程</li>
<li>监听进程</li>
</ul>
<h3 id="2-3-工具列表">2.3 工具列表</h3>
<h4 id="安装和升级相关工具">安装和升级相关工具</h4>
<table>
<thead>
<tr>
<th>工具名</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>Oracle Universal Installer (OUI)</td>
<td>安装 Oracle 软件</td>
</tr>
<tr>
<td>Oracle Database Configuration Assistant (DBCA)</td>
<td>创建数据库</td>
</tr>
<tr>
<td>Oracle Database Upgrade Assistant (DBUA)</td>
<td>升级现有数据库到新版本</td>
</tr>
</tbody>
</table>
<h4 id="网络相关工具">网络相关工具</h4>
<table>
<thead>
<tr>
<th>工具名</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>Oracle Net Manager (netmgr)</td>
<td>配置 Oracle 网络</td>
</tr>
<tr>
<td>Oracle Net Configuration Assistant (netca)</td>
<td>配置 Oracle 网络</td>
</tr>
</tbody>
</table>
<h4 id="实例和数据库管理工具">实例和数据库管理工具</h4>
<table>
<thead>
<tr>
<th>工具名</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>Oracle Enterprise Manager (EM)</td>
<td>管理 Oracle DB</td>
</tr>
<tr>
<td>SQL*Plus</td>
<td>SQL 命令行工具</td>
</tr>
<tr>
<td>SQL Developer</td>
<td>图形化数据库管理工具</td>
</tr>
<tr>
<td>Recovery Manager (RMAN)</td>
<td>数据库备份、恢复、复原</td>
</tr>
<tr>
<td>Oracle Secure Backup</td>
<td>备份管理</td>
</tr>
<tr>
<td>Data Pump</td>
<td>数据库间高速数据传输</td>
</tr>
<tr>
<td>SQL*Loader</td>
<td>外部文件数据批量导入</td>
</tr>
</tbody>
</table>
<h2 id="3-安装">3. 安装</h2>
<h3 id="3-1-OUI-功能">3.1 OUI 功能</h3>
<ul>
<li>显示已安装的 Oracle 软件</li>
<li>安装新软件</li>
<li>删除软件</li>
<li>查看在线帮助</li>
<li>检查安装需求</li>
</ul>
<h3 id="3-2-系统要求">3.2 系统要求</h3>
<ul>
<li><strong>内存</strong>：1GB</li>
<li><strong>SWAP</strong>：1.5GB</li>
<li><strong>硬盘空间</strong>：
<ul>
<li>最小 1GB</li>
<li>一般需要 6.1GB</li>
</ul>
</li>
</ul>
<h3 id="3-3-创建用户和组">3.3 创建用户和组</h3>
<ul>
<li><strong>软件所有者</strong>：Oracle 用户</li>
<li><strong>Oracle Inventory Group</strong>：用于管理 Oracle 软件</li>
<li><strong>DB 管理组</strong>：
<ul>
<li><code>OSDBA</code>：数据库管理员组</li>
<li><code>OSOPER</code>：受限制的数据库管理员组</li>
</ul>
</li>
</ul>
<h3 id="3-4-环境变量">3.4 环境变量</h3>
<table>
<thead>
<tr>
<th>变量名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ORACLE_BASE</code></td>
<td>Oracle 主目录</td>
</tr>
<tr>
<td><code>ORACLE_HOME</code></td>
<td>Oracle 软件安装位置</td>
</tr>
<tr>
<td><code>ORACLE_SID</code></td>
<td>系统标识（实例名）</td>
</tr>
<tr>
<td><code>LD_LIBRARY_PATH</code></td>
<td>共享库路径（如 <code>$ORACLE_HOME/lib</code>）</td>
</tr>
</tbody>
</table>
<h3 id="3-5-安装脚本">3.5 安装脚本</h3>
<table>
<thead>
<tr>
<th>脚本名</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>orainstRoot.sh</code></td>
<td>生成 inventory pointer 文件</td>
</tr>
<tr>
<td><code>root.sh</code></td>
<td>生成 <code>oratab</code> 并设置环境变量 (<code>oraenv</code> 和 <code>coraenv</code>)，指定 <code>dbstart</code> 和 <code>dbshut</code> 脚本</td>
</tr>
</tbody>
</table>
<h3 id="3-6-创建数据库（DBCA）">3.6 创建数据库（DBCA）</h3>
<h4 id="3-6-1-指定-Global-DB-名">3.6.1 指定 Global DB 名</h4>
<p>格式：<code>database_name.domain_name</code></p>
<h4 id="3-6-2-Enterprise-Manager-选项">3.6.2 Enterprise Manager 选项</h4>
<ul>
<li><strong>Database Express</strong>：单数据库管理</li>
<li><strong>Cloud Control</strong>：集中管理多个数据库（需预先安装 Cloud Control）</li>
</ul>
<h4 id="3-6-3-存储类型">3.6.3 存储类型</h4>
<table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>文件系统</td>
<td>使用操作系统文件</td>
</tr>
<tr>
<td>ASM (Automatic Storage Management)</td>
<td>文件存储在 ASM 磁盘组，需额外实例</td>
</tr>
</tbody>
</table>
<h4 id="3-6-4-数据库文件位置">3.6.4 数据库文件位置</h4>
<ul>
<li><strong>使用模板的文件位置</strong></li>
<li><strong>所有数据库文件共享文件夹</strong></li>
<li><strong>Oracle Managed Files</strong>：由 Oracle 直接管理文件</li>
</ul>
<h4 id="3-6-5-模板">3.6.5 模板</h4>
<p>模板包含以下信息：</p>
<ul>
<li>数据库选项</li>
<li>初始化参数</li>
<li>存储属性（数据文件、表空间、控制文件、REDO 日志属性）</li>
</ul>
<h5 id="模板分类">模板分类</h5>
<table>
<thead>
<tr>
<th>模板类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>通用事务处理（默认）</td>
<td>适用于 OLTP 场景</td>
</tr>
<tr>
<td>数据仓库 (Data Warehouse)</td>
<td>适用于复杂查询和大数据处理</td>
</tr>
<tr>
<td>自定义模板</td>
<td>用户自定义配置</td>
</tr>
</tbody>
</table>
<h5 id="模板形式">模板形式</h5>
<table>
<thead>
<tr>
<th>形式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sheet Template</td>
<td>包含现有数据库结构和物理文件</td>
</tr>
<tr>
<td>Non-Sheet Template</td>
<td>仅包含数据库特性</td>
</tr>
</tbody>
</table>
<h2 id="4-EM-Express">4. EM Express</h2>
<h3 id="4-1-功能">4.1 功能</h3>
<ul>
<li>提供数据库管理功能（<strong>不包括启动/停止数据库</strong>）</li>
<li>如需启动/停止数据库，需使用 <strong>Oracle Enterprise Manager Cloud Control</strong></li>
</ul>
<h3 id="4-2-手动配置-EM-Express">4.2 手动配置 EM Express</h3>
<ol>
<li><strong>启动监听进程</strong></li>
<li><strong>初始化 <code>DISPATCHERS</code> 参数</strong>（设置 <code>PROTOCOL=TCP</code>）：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatchers<span class="operator">=</span>&quot;(PROTOCOL=TCP)(SERVICE=&lt;sid&gt;XDB)&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><strong>设置端口</strong>（需 <code>SYSDBA</code> 权限）：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXEC</span> DBMS_XDB_CONFIG.setHTTPSPORT(<span class="number">5500</span>);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="4-3-使用-EM-Express">4.3 使用 EM Express</h3>
<h4 id="4-3-1-查询-EM-Express-端口">4.3.1 查询 EM Express 端口</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DBMS_XDB_CONFIG.getHTTPSPort <span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>
<h4 id="4-3-2-权限分配">4.3.2 权限分配</h4>
<table>
<thead>
<tr>
<th>权限</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>EM_EXPRESS_BASIC</code></td>
<td>只读模式</td>
</tr>
<tr>
<td><code>EM_EXPRESS_ALL</code></td>
<td>完全权限</td>
</tr>
</tbody>
</table>
<h3 id="4-4-连接数据库">4.4 连接数据库</h3>
<h4 id="4-4-1-SQL-Plus-连接方式">4.4.1 SQL*Plus 连接方式</h4>
<ol>
<li>运行 <code>oraenv</code> 设置环境变量：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">. oraenv</span><br></pre></td></tr></table></figure>
</li>
<li>启动 SQL*Plus（<code>/nolog</code> 表示不登录数据库）：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlplus /nolog</span><br></pre></td></tr></table></figure>
</li>
<li>连接数据库：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CONNECT</span> <span class="operator">&lt;</span>用户名<span class="operator">&gt;</span><span class="operator">/</span><span class="operator">&lt;</span>密码<span class="operator">&gt;</span> [<span class="keyword">AS</span> SYSDBA <span class="operator">|</span> <span class="keyword">AS</span> SYSOPER]</span><br></pre></td></tr></table></figure>
</li>
<li>其他功能：
<ul>
<li>执行 SQL 脚本：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="operator">&lt;</span><span class="keyword">sql</span>文件名<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>执行操作系统命令：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HOST <span class="operator">&lt;</span>命令<span class="operator">&gt;</span>  # 例如：HOST ls</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h4 id="4-4-2-SQL-Developer-连接方式">4.4.2 SQL Developer 连接方式</h4>
<ol>
<li>运行 <code>oraenv</code> 设置环境变量：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">. oraenv</span><br></pre></td></tr></table></figure>
</li>
<li>启动 SQL Developer：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$ORACLE_HOME</span>/sqldeveloper</span><br><span class="line">sh sqldeveloper.sh</span><br></pre></td></tr></table></figure>
</li>
<li>功能：
<ul>
<li><strong>普通模式</strong>：查看、创建、编辑、删除表、视图等对象</li>
<li><strong>DBA Navigator</strong>：连接 DBA 用户后可启动/停止数据库</li>
</ul>
</li>
</ol>
<h2 id="5-Oracle-网络构成">5. Oracle 网络构成</h2>
<h3 id="5-1-Oracle-Net-概述">5.1 Oracle Net 概述</h3>
<ul>
<li><strong>功能</strong>：提供网络服务</li>
<li><strong>安装方式</strong>：随 Oracle 数据库软件或客户端一同安装</li>
<li><strong>通信模式</strong>：
<ul>
<li><strong>客户端-服务端模式</strong>：两端均需安装 Oracle Net</li>
<li><strong>客户端-Web 服务器-DB 服务器模式</strong>：客户端和 Web 服务器需安装 Oracle Net</li>
</ul>
</li>
</ul>
<h3 id="5-2-通信条件">5.2 通信条件</h3>
<table>
<thead>
<tr>
<th><strong>角色</strong></th>
<th><strong>要求</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>DB 服务端</strong></td>
<td>1. 网络服务器在线<br>2. 已安装 Oracle DB<br>3. 支持 TCP/IP 协议<br>4. 监听进程已启动</td>
</tr>
<tr>
<td><strong>客户端</strong></td>
<td>1. 网络服务器在线<br>2. 已安装 Oracle 客户端<br>3. 支持 TCP/IP 协议</td>
</tr>
</tbody>
</table>
<h3 id="5-3-监听进程">5.3 监听进程</h3>
<ul>
<li>
<p><strong>自动安装</strong>：通过 OUI 初始化 DB 时，NetCA 会默认安装监听进程</p>
</li>
<li>
<p><strong>作用</strong>：处理客户端连接请求（连接建立后不再参与通信）</p>
</li>
<li>
<p><strong>关键命令</strong>：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>lsnrctl start &lt;监听进程名&gt;</code></td>
<td>启动监听进程</td>
</tr>
<tr>
<td><code>lsnrctl stop &lt;监听进程名&gt;</code></td>
<td>停止监听进程</td>
</tr>
<tr>
<td><code>lsnrctl status &lt;监听进程名&gt;</code></td>
<td>查看状态</td>
</tr>
<tr>
<td><code>lsnrctl services &lt;监听进程名&gt;</code></td>
<td>查看支持的服务</td>
</tr>
<tr>
<td><code>LSNRCTL&gt; set current_listener &lt;名称&gt;</code></td>
<td>切换监听进程（需交互模式）</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h3 id="5-4-客户端构成">5.4 客户端构成</h3>
<ul>
<li><strong>数据库连接示例</strong>：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CONNECT</span> hr@(DESCRIPTION <span class="operator">=</span> </span><br><span class="line">  (ADDRESS <span class="operator">=</span> (PROTOCOL <span class="operator">=</span> TCP)(HOST <span class="operator">=</span> proj1<span class="operator">-</span>sv)(PORT <span class="operator">=</span> <span class="number">1521</span>))</span><br><span class="line">  (CONNECT_DATA <span class="operator">=</span> (SERVICE_NAME <span class="operator">=</span> sales.edifist.com)))</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="5-5-命名方法">5.5 命名方法</h3>
<table>
<thead>
<tr>
<th><strong>类型</strong></th>
<th><strong>存储位置</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>本地命名</strong></td>
<td>客户端 <code>tnsnames.ora</code></td>
<td>网络服务名映射存储在本地文件</td>
</tr>
<tr>
<td><strong>LDAP 基准</strong></td>
<td>LDAP 服务器</td>
<td>集中管理服务名映射</td>
</tr>
<tr>
<td><strong>简易连接命名</strong></td>
<td>无</td>
<td>直接使用 TCP/IP 连接字符串（如 <code>connect scott@host名/服务名</code>）</td>
</tr>
<tr>
<td><strong>外部命名</strong></td>
<td>第三方命名服务（如 NIS）</td>
<td>依赖非 Oracle 服务</td>
</tr>
</tbody>
</table>
<h4 id="本地命名配置方法">本地命名配置方法</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netca  <span class="comment"># 启动图形化配置工具</span></span><br></pre></td></tr></table></figure>
<h4 id="简易连接示例">简易连接示例</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlplus <span class="operator">/</span>nolog</span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">CONNECT</span> hr<span class="operator">/</span>hr<span class="variable">@oracle_sv</span><span class="operator">/</span>orcl.edifist.com</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="6-数据库服务器架构概要">6. 数据库服务器架构概要</h2>
<h3 id="6-1-核心组件">6.1 核心组件</h3>
<ul>
<li><strong>Oracle 实例</strong>：内存结构（SGA） + 后台进程</li>
<li><strong>Oracle 数据库</strong>：物理文件集合</li>
</ul>
<h3 id="6-2-SGA-System-Global-Area-构成">6.2 SGA (System Global Area) 构成</h3>
<table>
<thead>
<tr>
<th><strong>组件</strong></th>
<th><strong>功能</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>数据库缓存</strong></td>
<td>存储数据块（Buffer Cache）</td>
</tr>
<tr>
<td><strong>REDO 日志 Buffer</strong></td>
<td>记录数据变更历史</td>
</tr>
<tr>
<td><strong>共享池</strong></td>
<td>缓存 SQL/PLSQL 解析结果、执行计划、数据字典</td>
</tr>
<tr>
<td><strong>Large Pool</strong></td>
<td>可选，用于共享服务器模式、并行查询、RMAN 备份等</td>
</tr>
<tr>
<td><strong>Java Pool</strong></td>
<td>支持 Java 虚拟机（JVM）</td>
</tr>
<tr>
<td><strong>Stream Pool</strong></td>
<td>支持 Oracle Stream 数据复制</td>
</tr>
</tbody>
</table>
<h3 id="6-3-关键后台进程">6.3 关键后台进程</h3>
<table>
<thead>
<tr>
<th><strong>进程</strong></th>
<th><strong>名称</strong></th>
<th><strong>功能</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>SMON</strong></td>
<td>System Monitor</td>
<td>实例恢复（如崩溃后自动修复）</td>
</tr>
<tr>
<td><strong>PMON</strong></td>
<td>Process Monitor</td>
<td>清理异常终止的用户进程资源</td>
</tr>
<tr>
<td><strong>DBWn</strong></td>
<td>Database Writer</td>
<td>将脏缓冲区写入数据文件</td>
</tr>
<tr>
<td><strong>CKPT</strong></td>
<td>Checkpoint</td>
<td>触发 DBWn 写入，更新控制文件（用于灾难恢复）</td>
</tr>
<tr>
<td><strong>LGWR</strong></td>
<td>Log Writer</td>
<td>将 REDO 日志缓冲区写入磁盘</td>
</tr>
<tr>
<td><strong>ARCn</strong></td>
<td>Archiver</td>
<td>归档 REDO 日志</td>
</tr>
<tr>
<td><strong>MMON</strong></td>
<td>Manageability Monitor</td>
<td>执行 AWR（自动工作负载仓库）相关任务</td>
</tr>
</tbody>
</table>
<h3 id="6-4-用户与服务器进程">6.4 用户与服务器进程</h3>
<ul>
<li><strong>用户进程</strong>：运行应用程序（如 SQL*Plus）</li>
<li><strong>服务器进程</strong>：处理用户提交的 SQL 查询</li>
</ul>
<h3 id="6-5-PGA-Program-Global-Area">6.5 PGA (Program Global Area)</h3>
<ul>
<li><strong>特点</strong>：非共享内存，仅限单个进程访问</li>
<li><strong>用途</strong>：存储 SQL 执行时的排序区、会话信息等</li>
</ul>
<hr>
<h2 id="7-实例启停">7. 实例启停</h2>
<h3 id="7-1-启动方法">7.1 启动方法</h3>
<ul>
<li>SQL*Plus（<code>STARTUP</code> 命令）</li>
<li>Windows 服务管理器</li>
<li>SQL Developer</li>
<li>Enterprise Manager Cloud Control</li>
</ul>
<h3 id="7-2-启动状态迁移">7.2 启动状态迁移</h3>
<table>
<thead>
<tr>
<th><strong>状态</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>NOMOUNT</strong></td>
<td>读取参数文件，分配 SGA，启动后台进程（控制文件未打开）</td>
</tr>
<tr>
<td><strong>MOUNT</strong></td>
<td>打开控制文件（获知数据文件/日志文件路径，但未打开文件）</td>
</tr>
<tr>
<td><strong>OPEN</strong></td>
<td>打开所有数据文件和 REDO 日志，数据库可用</td>
</tr>
</tbody>
</table>
<h3 id="7-3-权限要求">7.3 权限要求</h3>
<table>
<thead>
<tr>
<th><strong>权限</strong></th>
<th><strong>能力</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>SYSDBA</strong></td>
<td>完全控制（包括启停实例、用户授权）</td>
</tr>
<tr>
<td><strong>SYSOPER</strong></td>
<td>仅限启停实例（无权管理用户对象）</td>
</tr>
</tbody>
</table>
<h4 id="连接示例">连接示例</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CONNECT</span> 用户名<span class="operator">/</span>密码 <span class="keyword">AS</span> &#123;SYSOPER <span class="operator">|</span> SYSDBA&#125;</span><br><span class="line">sqlplus <span class="operator">/</span>nolog</span><br><span class="line"><span class="keyword">CONNECT</span> sys <span class="keyword">AS</span> sysdba</span><br><span class="line">STARTUP</span><br></pre></td></tr></table></figure>
<h3 id="7-4-停止流程">7.4 停止流程</h3>
<ol>
<li><strong>关闭数据库</strong>（OPEN → CLOSED）
<ul>
<li>执行 Checkpoint，写入数据文件和 REDO 日志</li>
<li>关闭数据文件和 REDO 日志（控制文件仍打开）</li>
</ul>
</li>
<li><strong>卸载数据库</strong>（CLOSED → DISMOUNT）
<ul>
<li>实例与数据库分离</li>
</ul>
</li>
<li><strong>停止实例</strong>（DISMOUNT → SHUTDOWN）
<ul>
<li>终止后台进程，释放 SGA 内存</li>
</ul>
</li>
</ol>
<h3 id="7-5-停止模式对比">7.5 停止模式对比</h3>
<table>
<thead>
<tr>
<th><strong>行为</strong></th>
<th>NORMAL</th>
<th>TRANSACTIONAL</th>
<th>IMMEDIATE</th>
<th>ABORT</th>
</tr>
</thead>
<tbody>
<tr>
<td>接受新连接</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
</tr>
<tr>
<td>等待当前会话结束</td>
<td>✓</td>
<td>✓</td>
<td>×</td>
<td>×</td>
</tr>
<tr>
<td>等待当前事务结束</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>×</td>
</tr>
<tr>
<td>执行 Checkpoint 后关闭</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>×</td>
</tr>
</tbody>
</table>
<h3 id="7-6-初始化参数文件">7.6 初始化参数文件</h3>
<table>
<thead>
<tr>
<th><strong>类型</strong></th>
<th><strong>名称</strong></th>
<th><strong>特点</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>静态</strong></td>
<td>PFILE（文本文件）</td>
<td>手动编辑，需重启生效</td>
</tr>
<tr>
<td><strong>动态</strong></td>
<td>SPFILE（二进制文件）</td>
<td>支持在线修改（<code>ALTER SYSTEM</code>），优先使用</td>
</tr>
</tbody>
</table>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../2021/05/09/oracelBD%E5%9F%BA%E7%A1%80/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../2021/01/12/VPC/"
                            aria-label=": VPC"
                        >
                            VPC
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-01-12T23:15:39+08:00">
	
		    2021 年 1 月 12 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../categories/%E5%90%8E%E7%AB%AF/">后端</a>, <a class="category-link" href="../../categories/%E5%90%8E%E7%AB%AF/AWS/">AWS</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <ol>
<li>
<p>Security Group(SG):</p>
<ol>
<li>所有设定默认是拒绝，只可以设定许可规则，拒否ルールは指定できません。</li>
<li>特征是不单可以指定CIDR等IP,还可以指定SG</li>
<li>安全组是有状态的 — 如果您从实例发送一个请求，则无论入站安全组规则如何，都将允许该请求的响应流量流入。如果是为响应已允许的入站流量，则该响应可以出站，此时可忽略出站规则。セキュリティグループはステートフルです。</li>
</ol>
</li>
<li>
<p>Access Control List(ACL):</p>
<ol>
<li>VPC 自动带有可修改的默认网络 ACL。默认情况下，它允许所有入站和出站 IPv4 流量以及 IPv6 流量 (如果适用)。</li>
<li>可以创建自定义网络 ACL 并将其与子网相关联。默认情况下，每个自定义网络 ACL 都拒绝所有入站和出站流量，直至您添加规则。</li>
<li>VPC 中的每个子网都必须与一个网络 ACL 相关联。如果您没有明确地将子网与网络 ACL 相关联，则子网将自动与默认网络 ACL 关联。</li>
<li>可以将网络 ACL 与多个子网关联。但是，一个子网一次只能与一个网络 ACL 关联。当您将一个网络 ACL 与一个子网关联时，将删除之前的关联。</li>
<li>网络 ACL 包含规则的编号列表。我们按顺序评估（从编号最小的规则开始）规则，以判断是否允许流量进入或离开任何与网络 ACL 关联的子网。您可以使用的最高规则编号为 32766。我们建议您开始先以增量方式创建规则（例如，以 10 或 100 的增量增加），这样您可以在稍后需要时插入新的规则。</li>
<li>网络 ACL 有单独的入站和出站规则，每项规则都或是允许或是拒绝数据流。</li>
<li>网络 ACL 没有任何状态，这意味着对允许入站数据流的响应会随着出站数据流规则的变化而改变（反之亦然）。(ネットワーク ACL はステートレスです。許可されているインバウンドトラフィックに対する応答は、アウトバウンドトラフィックのルールに従います（その逆の場合も同様です）。)</li>
<li>ルール番号。ルールは、最も低い番号のルールから評価されます。ルールがトラフィックに一致すると、それと相反するより高い数値のルールの有無にかかわらず、すぐに適用されます。</li>
<li>タイプ。トラフィックのタイプ（SSH など）。また、すべてのトラフィックまたはカスタム範囲を指定することもできます。</li>
</ol>
</li>
</ol>
<p>セキュリティグループはステートフルです。（レスポンスでも明示する必要なしで許可。）<br>
ACLはステートレスです。（レスポンスでも明示する必要ある。）</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../2021/01/12/VPC/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../2020/11/17/linux/17-%E7%B3%BB%E7%BB%9F%E7%BB%B4%E6%8A%A4/"
                            aria-label=": 17.系统维护"
                        >
                            17.系统维护
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-11-17T14:01:48+08:00">
	
		    2020 年 11 月 17 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../categories/%E5%90%8E%E7%AB%AF/">后端</a>, <a class="category-link" href="../../categories/%E5%90%8E%E7%AB%AF/linux/">linux</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1>从源代码安装软件笔记整理</h1>
<h2 id="1-安装C语言开源软件的三个主要步骤">1. 安装C语言开源软件的三个主要步骤</h2>
<ol>
<li>解压源代码</li>
<li>编译成二进制文件</li>
<li>将二进制文件安装到适当的文件夹</li>
</ol>
<h2 id="2-解压源代码">2. 解压源代码</h2>
<h3 id="常用解压命令">常用解压命令</h3>
<table>
<thead>
<tr>
<th>命令格式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>gunzip [文件名]</code></td>
<td>解压.gz文件</td>
</tr>
<tr>
<td><code>gzip [option] [文件名]</code></td>
<td>压缩/解压文件</td>
</tr>
<tr>
<td><code>bunzip [文件名]</code></td>
<td>解压.bz2文件</td>
</tr>
<tr>
<td><code>bzip [option] [文件名]</code></td>
<td>压缩/解压文件</td>
</tr>
</tbody>
</table>
<h3 id="gzip-bzip-选项说明">gzip/bzip 选项说明</h3>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-d</code></td>
<td>解压压缩文件</td>
</tr>
<tr>
<td><code>-c</code></td>
<td>解压压缩文件到标准输出</td>
</tr>
</tbody>
</table>
<h2 id="3-patch命令">3. patch命令</h2>
<p>用于应用补丁文件</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-d 文件夹</code></td>
<td>移动到指定文件夹后处理</td>
</tr>
<tr>
<td><code>-p</code></td>
<td>修正patch文件内的path: <br><code>-p0</code>: 不修正path <br><code>-p1</code>: 删除最初的’/’ <br><code>-p2</code>: 删除下一级文件夹</td>
</tr>
<tr>
<td><code>patch</code></td>
<td>应用补丁</td>
</tr>
<tr>
<td><code>-C</code></td>
<td>测试(不实际应用补丁)</td>
</tr>
<tr>
<td><code>-R</code></td>
<td>取消补丁，恢复到补丁前状态</td>
</tr>
</tbody>
</table>
<h2 id="4-生成Makefile">4. 生成Makefile</h2>
<p>运行config脚本根据环境配置config文件:</p>
<h3 id="config脚本主要选项">config脚本主要选项</h3>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--help</code></td>
<td>显示帮助说明</td>
</tr>
<tr>
<td><code>--prefix=文件夹</code></td>
<td>指定安装目标的top路径</td>
</tr>
</tbody>
</table>
<h2 id="5-编译和安装">5. 编译和安装</h2>
<h3 id="make命令">make命令</h3>
<p>根据当前文件夹内的Makefile编译源代码</p>
<p>基本格式：</p>
<pre><code class="language-bash">make [option] [目标]</code></pre>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../2020/11/17/linux/17-%E7%B3%BB%E7%BB%9F%E7%BB%B4%E6%8A%A4/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../2020/11/16/linux/16-%E7%BD%91%E7%BB%9C/"
                            aria-label=": 16.网络"
                        >
                            16.网络
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-11-16T14:01:40+08:00">
	
		    2020 年 11 月 16 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../categories/%E5%90%8E%E7%AB%AF/">后端</a>, <a class="category-link" href="../../categories/%E5%90%8E%E7%AB%AF/linux/">linux</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="1-网络设备管理">1. 网络设备管理</h2>
<h3 id="1-1-网络接口命名规则">1.1 网络接口命名规则</h3>
<table>
<thead>
<tr>
<th>接口名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>eth0</code></td>
<td>第一个 Ethernet 接口</td>
</tr>
<tr>
<td><code>eth1</code></td>
<td>第二个 Ethernet 接口</td>
</tr>
<tr>
<td><code>ppp0</code></td>
<td>第一个 PPP 接口</td>
</tr>
<tr>
<td><code>lo</code></td>
<td>Loopback 接口</td>
</tr>
</tbody>
</table>
<h3 id="1-2-网络设备识别命令">1.2 网络设备识别命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dmesg | grep eth  <span class="comment"># 查看内核识别的网络设备</span></span><br></pre></td></tr></table></figure>
<h3 id="1-3-网络接口配置命令">1.3 网络接口配置命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig [-a] [IF名] [参数]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-a</code></td>
<td>显示所有接口</td>
</tr>
<tr>
<td><code>IF名</code></td>
<td>指定接口名称</td>
</tr>
<tr>
<td><code>IP地址</code></td>
<td>设置 IP 地址</td>
</tr>
<tr>
<td><code>netmask</code></td>
<td>设置子网掩码</td>
</tr>
<tr>
<td><code>up</code></td>
<td>激活接口（等价于 <code>ifup</code>）</td>
</tr>
<tr>
<td><code>down</code></td>
<td>停止接口（等价于 <code>ifdown</code>）</td>
</tr>
</tbody>
</table>
<p><strong>示例</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig eth0 192.168.120.27 netmask 255.255.255.0 up</span><br></pre></td></tr></table></figure>
<h3 id="1-4-NIC-组合与虚拟网络接口">1.4 NIC 组合与虚拟网络接口</h3>
<ul>
<li><strong>NIC 组合</strong>：允许将多个物理以太网适配器分组为虚拟网络适配器，提高性能和容错能力。</li>
<li><strong>MAC 地址设置</strong>：在 “交换机独立” 模式下，团队会将 MAC 地址设置为出站流量。</li>
<li><strong>IP 别名</strong>：在同一个网卡上分配不同 IP 地址。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig eth0:0 192.168.0.1 netmask 255.255.255.0 up</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="2-ARP-协议管理">2. ARP 协议管理</h2>
<h3 id="2-1-ARP-协议简介">2.1 ARP 协议简介</h3>
<p>ARP (Address Resolution Protocol) 用于将 IP 地址解析为 MAC 地址。</p>
<h3 id="2-2-ARP-命令">2.2 ARP 命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arp [option]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-a [host]</code></td>
<td>显示指定主机或全部 ARP 表</td>
</tr>
<tr>
<td><code>-f 文件名</code></td>
<td>从文件读取主机:MAC 对应表</td>
</tr>
<tr>
<td><code>-n</code></td>
<td>显示 IP 地址而非主机名</td>
</tr>
<tr>
<td><code>-d [host]</code></td>
<td>删除指定主机的 ARP 记录</td>
</tr>
<tr>
<td><code>-i [IF名]</code></td>
<td>指定接口</td>
</tr>
<tr>
<td><code>-s [host] [MAC地址]</code></td>
<td>添加主机和 MAC 地址的对应关系</td>
</tr>
</tbody>
</table>
<p><strong>示例</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arp -s h001.example.com 00:01:02:03:04:05</span><br></pre></td></tr></table></figure>
<h3 id="2-3-ARP-监视工具">2.3 ARP 监视工具</h3>
<ul>
<li><code>arpwatch</code>：监视网络中的 ARP 活动。</li>
</ul>
<h2 id="3-网络管理命令">3. 网络管理命令</h2>
<h3 id="3-1-Ping-命令">3.1 Ping 命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping [host名或IP] [option]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-n</code></td>
<td>不解析主机名，显示 IP 地址</td>
</tr>
<tr>
<td><code>-c 次数</code></td>
<td>发送指定次数的 ICMP 包</td>
</tr>
<tr>
<td><code>-i 间隔</code></td>
<td>按指定间隔发送 ICMP 包</td>
</tr>
</tbody>
</table>
<p><strong>示例</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping -c 4 192.168.1.1</span><br></pre></td></tr></table></figure>
<h3 id="3-2-Traceroute-命令">3.2 Traceroute 命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">traceroute [option] [host名或IP]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-i [IF]</code></td>
<td>指定接口</td>
</tr>
<tr>
<td><code>-n</code></td>
<td>显示 IP 地址而非主机名</td>
</tr>
</tbody>
</table>
<h3 id="3-3-Tcpdump-命令">3.3 Tcpdump 命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump [option] [条件式]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-i IF名</code></td>
<td>指定监视的接口</td>
</tr>
<tr>
<td><code>-s 比特数</code></td>
<td>指定从包中提取的比特数</td>
</tr>
<tr>
<td><code>-X</code></td>
<td>显示十六进制和 ASCII 文本</td>
</tr>
<tr>
<td><code>-n</code></td>
<td>不解析 ARP 地址</td>
</tr>
<tr>
<td><code>-l</code></td>
<td>缓存标准输出</td>
</tr>
<tr>
<td><code>-t</code></td>
<td>不显示时间</td>
</tr>
<tr>
<td><code>-v</code></td>
<td>显示详细信息</td>
</tr>
</tbody>
</table>
<p><strong>条件式</strong>:</p>
<ul>
<li><code>port</code>：指定端口</li>
</ul>
<p><strong>示例</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -nli eth0 port 53</span><br></pre></td></tr></table></figure>
<h3 id="3-4-Wireshark">3.4 Wireshark</h3>
<ul>
<li>图形化网络监视工具。</li>
</ul>
<h3 id="3-5-Netstat-命令">3.5 Netstat 命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat [option]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-a</code></td>
<td>显示所有 socket</td>
</tr>
<tr>
<td><code>-c</code></td>
<td>每秒刷新</td>
</tr>
<tr>
<td><code>-i</code></td>
<td>显示接口状态</td>
</tr>
<tr>
<td><code>-l</code></td>
<td>只显示监听状态的端口</td>
</tr>
<tr>
<td><code>-n</code></td>
<td>显示地址和端口</td>
</tr>
<tr>
<td><code>-p</code></td>
<td>显示 PID 和进程</td>
</tr>
<tr>
<td><code>-r</code></td>
<td>显示路由表</td>
</tr>
<tr>
<td><code>-t</code></td>
<td>显示 TCP 连接</td>
</tr>
<tr>
<td><code>-u</code></td>
<td>显示 UDP 连接</td>
</tr>
</tbody>
</table>
<h3 id="3-6-IP-命令">3.6 IP 命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip [option] 操作对象 [命令] [设备]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-s</code></td>
<td>显示状态</td>
</tr>
<tr>
<td><code>-r</code></td>
<td>解析名称</td>
</tr>
</tbody>
</table>
<p><strong>操作对象</strong>:</p>
<ul>
<li><code>link</code>：接口详细信息</li>
<li><code>addr</code>：IP 地址</li>
<li><code>route</code>：路由表</li>
<li><code>neigh</code>：ARP 缓存</li>
</ul>
<p><strong>命令</strong>:</p>
<ul>
<li><code>show</code>：显示指定对象</li>
<li><code>add</code>：设置指定对象的参数</li>
</ul>
<p><strong>示例</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip <span class="built_in">link</span> show eth0</span><br></pre></td></tr></table></figure>
<h2 id="4-路由设置">4. 路由设置</h2>
<h3 id="4-1-Route-命令">4.1 Route 命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route [option]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-n</code></td>
<td>不解析主机名</td>
</tr>
<tr>
<td><code>-F</code></td>
<td>显示内核路由表</td>
</tr>
<tr>
<td><code>-C</code></td>
<td>显示内核路由缓存</td>
</tr>
</tbody>
</table>
<p><strong>路由表项目</strong>:</p>
<ul>
<li><code>Destination</code>：目标网络或主机</li>
<li><code>Gateway</code>：网关</li>
<li><code>Genmask</code>：目标子网掩码</li>
<li><code>Flags</code>：路由状态（U:有效, H:目标主机, G:使用网关, !:无效）</li>
<li><code>Metric</code>：到达目标的距离</li>
<li><code>Ref</code>：路由引用数</li>
<li><code>Use</code>：路径引用次数</li>
<li><code>Iface</code>：使用的接口</li>
</ul>
<p><strong>示例</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">route add -net 192.168.100.0 netmask 255.255.255.0 gw 172.16.0.1</span><br><span class="line">route add default gw 192.168.0.50</span><br><span class="line">route del -net 192.168.100.0 netmask 255.255.255.0 gw 172.16.0.1</span><br></pre></td></tr></table></figure>
<h2 id="5-无线网络设置">5. 无线网络设置</h2>
<h3 id="5-1-无线规格与安全标准">5.1 无线规格与安全标准</h3>
<table>
<thead>
<tr>
<th>规格</th>
<th>频率</th>
<th>传送速度</th>
</tr>
</thead>
<tbody>
<tr>
<td>IEEE 802.11a</td>
<td>5.2GHz</td>
<td>54Mbps</td>
</tr>
<tr>
<td>IEEE 802.11b</td>
<td>2.4GHz</td>
<td>11Mbps</td>
</tr>
<tr>
<td>IEEE 802.11g</td>
<td>2.4GHz</td>
<td>54Mbps</td>
</tr>
<tr>
<td>IEEE 802.11n</td>
<td>2.4GHz/5GHz</td>
<td>600Mbps</td>
</tr>
<tr>
<td>IEEE 802.11ac</td>
<td>5GHz</td>
<td>433Mbps~7Gbps</td>
</tr>
</tbody>
</table>
<p><strong>安全标准</strong>:</p>
<ul>
<li><strong>WEP</strong>：使用 RC4 算法，存在漏洞。</li>
<li><strong>WPA</strong>：多种加密技术（TKIP, AES），用户认证由 IEEE 802.1x 等实现。WPA-AES 比 WPA-TKIP 更安全。</li>
</ul>
<h3 id="5-2-无线接口状态确认">5.2 无线接口状态确认</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iwconfig [wlanN] [essid ESSID] [key [s:]WEP key]</span><br></pre></td></tr></table></figure>
<p><strong>示例</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iwconfig wlan0 essid <span class="string">&quot;windsor&quot;</span></span><br><span class="line">iwconfig wlan0 key s:abc12345</span><br></pre></td></tr></table></figure>
<h3 id="5-3-获取无线接口信息">5.3 获取无线接口信息</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iwlist [无线IF] [参数]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>scanning [essid ID]</code></td>
<td>显示可接入的热点列表</td>
</tr>
<tr>
<td><code>channel</code></td>
<td>显示可设置的频道</td>
</tr>
<tr>
<td><code>rate</code></td>
<td>显示传送速度</td>
</tr>
</tbody>
</table>
<h2 id="6-高级网络设置">6. 高级网络设置</h2>
<h3 id="6-1-网络相关文件">6.1 网络相关文件</h3>
<table>
<thead>
<tr>
<th>文件</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/etc/hostname</code></td>
<td>记录主机名</td>
</tr>
<tr>
<td><code>/etc/hosts</code></td>
<td>记录主机名、别名和 IP 的对应关系</td>
</tr>
<tr>
<td><code>/etc/networks</code></td>
<td>记录网络和 IP 的对应关系</td>
</tr>
<tr>
<td><code>/etc/nsswitch.conf</code></td>
<td>规定信息查找顺序</td>
</tr>
<tr>
<td><code>/etc/resolv.conf</code></td>
<td>记录 DNS 服务器和域名</td>
</tr>
<tr>
<td><code>/etc/sysconfig/network</code></td>
<td>网络功能、主机名、默认网关等设置</td>
</tr>
<tr>
<td><code>/etc/sysconfig/network-scripts/</code></td>
<td>存放网络接口设置文件</td>
</tr>
<tr>
<td><code>/etc/network/interfaces</code></td>
<td>Debian 系统的网络接口设置文件</td>
</tr>
</tbody>
</table>
<h3 id="6-2-配置文件示例">6.2 配置文件示例</h3>
<p><strong>/etc/sysconfig/network-scripts/ifcfg-eth0</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DEVICE=eth0</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">IPADDR=192.168.0.6</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">NETWORK=192.168.0.0</span><br><span class="line">BROADCAST=192.168.0.255</span><br><span class="line">ONBOOT=<span class="built_in">yes</span></span><br></pre></td></tr></table></figure>
<p><strong>/etc/network/interfaces (Debian)</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line">allow-hotplug eth0</span><br><span class="line">iface eth0 inet static </span><br><span class="line">    address 192.168.0.6</span><br><span class="line">    netmask 255.255.255.0</span><br><span class="line">    gateway 192.168.0.1</span><br><span class="line">    dns-domain example.com</span><br><span class="line">    dns-nameservers 192.168.1.1</span><br></pre></td></tr></table></figure>
<h2 id="7-网络问题排查">7. 网络问题排查</h2>
<h3 id="7-1-排查步骤">7.1 排查步骤</h3>
<ol>
<li>
<p><strong>Ping 测试</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping 172.16.0.1</span><br><span class="line">ping h001.s16.la.net</span><br></pre></td></tr></table></figure>
<ul>
<li>如果 IP 能 Ping 通，但主机名失败，可能是 DNS 问题，检查 <code>/etc/resolv.conf</code>。</li>
</ul>
</li>
<li>
<p><strong>局域网连通但无法访问互联网</strong>：</p>
<ul>
<li>检查默认网关或路由表：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route</span><br></pre></td></tr></table></figure>
</li>
<li>如果没有默认路由，添加默认网关：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route add default gw 172.16.0.1</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p><strong>网络连接不通</strong>：</p>
<ul>
<li>使用 <code>traceroute</code> 或 <code>tracepath</code> 查看路径：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">traceroute www.lpi.jp</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p><strong>网络接口问题</strong>：</p>
<ul>
<li>检查网卡状态：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br></pre></td></tr></table></figure>
</li>
<li>如果只显示 <code>lo</code>，启动接口：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ifup eth0</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">ifconfig eth0 up</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h3 id="7-2-需要确认的配置文件">7.2 需要确认的配置文件</h3>
<table>
<thead>
<tr>
<th>文件</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/etc/resolv.conf</code></td>
<td>DNS 服务器设置</td>
</tr>
<tr>
<td><code>/etc/sysconfig/network-scripts/*</code></td>
<td>网络接口设置（RHEL/CentOS）</td>
</tr>
<tr>
<td><code>/etc/network/interfaces</code></td>
<td>网络接口设置（Debian）</td>
</tr>
<tr>
<td><code>/etc/hosts.allow</code>, <code>/etc/hosts.deny</code></td>
<td>连接控制</td>
</tr>
</tbody>
</table>
<hr>
<p><strong>补充说明</strong>：</p>
<ul>
<li><strong>IP 别名</strong>：允许在同一个网卡上分配多个 IP 地址，常用于服务器提供多种服务。</li>
<li><strong>ARP 缓存</strong>：存储 IP 地址与 MAC 地址的映射关系，可通过 <code>arp -d</code> 手动清除缓存。</li>
<li><strong>无线安全</strong>：建议使用 WPA2 或 WPA3 加密方式，避免使用不安全的 WEP。</li>
<li><strong>路由表</strong>：理解目标网络、网关、子网掩码和接口的关系，确保数据包正确转发。</li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../2020/11/16/linux/16-%E7%BD%91%E7%BB%9C/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../2020/11/15/linux/15-%E9%AB%98%E5%BA%A6%E7%9A%84%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/"
                            aria-label=": 15.高度的存储管理"
                        >
                            15.高度的存储管理
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-11-15T14:01:30+08:00">
	
		    2020 年 11 月 15 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../categories/%E5%90%8E%E7%AB%AF/">后端</a>, <a class="category-link" href="../../categories/%E5%90%8E%E7%AB%AF/linux/">linux</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1>1. RAID (冗余磁盘阵列)</h1>
<p>RAID（Redundant Arrays of Inexpensive Disks）是一种将多个硬盘组合以提高性能或数据冗余的技术。</p>
<h2 id="Linux-上的-RAID">Linux 上的 RAID</h2>
<p>在 Linux 上应用 RAID，有软件 RAID 和硬件 RAID 之分。通常，硬件 RAID 会被视作 SCSI 设备。</p>
<h2 id="RAID-各个等级：">RAID 各个等级：</h2>
<ul>
<li>
<p><strong>RAID 0 (条带化)</strong></p>
<ul>
<li>多个硬盘组合成一个大磁盘，没有备份，提供较好的性能但没有容灾能力。</li>
<li>示例：三台 100GB 硬盘组成一个 300GB 的 RAID 0。</li>
</ul>
</li>
<li>
<p><strong>RAID 1 (镜像)</strong></p>
<ul>
<li>多台硬盘写入相同数据，提供冗余备份。</li>
<li>示例：三个 100GB 硬盘组成一个 100GB 的 RAID 1。</li>
</ul>
</li>
<li>
<p><strong>RAID 4</strong></p>
<ul>
<li>至少需要 3 台硬盘，其中一台用作备份分区。性能瓶颈在于备份分区。</li>
<li>示例：三个 100GB 硬盘组成一个 200GB 的 RAID 4。</li>
</ul>
</li>
<li>
<p><strong>RAID 5</strong></p>
<ul>
<li>使用分布式备份技术，性能较 RAID 4 好，且不需要专门的备份硬盘。</li>
<li>示例：三个 100GB 硬盘组成一个 200GB 的 RAID 5。</li>
</ul>
</li>
<li>
<p><strong>其他 RAID 等级：</strong></p>
<ul>
<li><strong>RAID LINEAR</strong>：类似 RAID 0。</li>
<li><strong>RAID 0+1 (RAID01)</strong>：RAID 0 组成的 RAID 1。</li>
<li><strong>RAID 10 (RAID+0)</strong>：RAID 1 组成的 RAID 0。</li>
<li><strong>RAID 6</strong>：比 RAID 5 多一台备份区。</li>
</ul>
</li>
</ul>
<h2 id="mdadm-命令控制-RAID-阵列"><code>mdadm</code> 命令控制 RAID 阵列</h2>
<p><code>mdadm [option] [设备名]</code></p>
<h3 id="常用选项：">常用选项：</h3>
<table>
<thead>
<tr>
<th>选项</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-C</code>, <code>--create</code></td>
<td>创建 RAID 阵列并生成相关设备</td>
</tr>
<tr>
<td><code>-a</code></td>
<td>自动生成必要的设备文件</td>
</tr>
<tr>
<td><code>-c</code></td>
<td>指定 Chunk 大小</td>
</tr>
<tr>
<td><code>-l</code>, <code>--level</code></td>
<td>指定 RAID 级别</td>
</tr>
<tr>
<td><code>-n</code>, <code>--raid-devices</code></td>
<td>指定 RAID 阵列中的设备数量</td>
</tr>
<tr>
<td><code>-x</code>, <code>--spare-devices</code></td>
<td>指定备用设备数量</td>
</tr>
<tr>
<td><code>--manage</code></td>
<td>管理 RAID 阵列</td>
</tr>
<tr>
<td><code>-a</code>, <code>--add</code></td>
<td>添加设备</td>
</tr>
<tr>
<td><code>-r</code>, <code>--remove</code></td>
<td>删除设备</td>
</tr>
<tr>
<td><code>-f</code>, <code>--fail</code></td>
<td>标记设备为失效</td>
</tr>
<tr>
<td><code>--query</code></td>
<td>查询 RAID 状态</td>
</tr>
<tr>
<td><code>--detail</code></td>
<td>查看 RAID 详细状态</td>
</tr>
<tr>
<td><code>--stop</code></td>
<td>停止指定的 RAID 阵列</td>
</tr>
<tr>
<td><code>--stop --scan</code></td>
<td>停止所有 RAID 阵列</td>
</tr>
</tbody>
</table>
<hr>
<h1>2. LVM (逻辑卷管理)</h1>
<p>LVM 是 Linux 下的一种磁盘管理工具，可以灵活地管理硬盘、分区和逻辑卷。</p>
<h3 id="LVM-结构：">LVM 结构：</h3>
<ol>
<li><strong>PV (Physical Volume)</strong>：一个硬盘或一个分区作为物理空间。</li>
<li><strong>PE (Physical Extent)</strong>：PV 组成 PE。</li>
<li><strong>VG (Volume Group)</strong>：PE 组成 VG。</li>
<li><strong>LV (Logical Volume)</strong>：VG 内的 PE 分配为 LV。</li>
</ol>
<h3 id="创建-LVM：">创建 LVM：</h3>
<ol>
<li>
<p>准备 LVM 用的分区：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fdisk /dev/sda</span><br><span class="line">fdisk /dev/sdb</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>初始化 PV：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pvcreate /dev/sda1 /dev/sdb1</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>创建 VG：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vgcreate testvg /dev/sda1 /dev/sdb1</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>创建 LV：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lvcreate -L 1G -n lv01 testvg</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>创建文件系统并挂载：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mke2fs -j /dev/testvg/lv01</span><br><span class="line">mount /dev/testvg/lv01 /mnt</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="管理-LVM：">管理 LVM：</h3>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>pvdisplay</code></td>
<td>显示物理 PV 信息</td>
</tr>
<tr>
<td><code>pvscan</code></td>
<td>显示 PV 状态</td>
</tr>
<tr>
<td><code>pvmove</code></td>
<td>移动 PV 中的 PE</td>
</tr>
<tr>
<td><code>pvremove</code></td>
<td>删除 PV</td>
</tr>
<tr>
<td><code>vgextend</code></td>
<td>扩展 VG</td>
</tr>
<tr>
<td><code>vgreduce</code></td>
<td>缩小 VG</td>
</tr>
<tr>
<td><code>vgdisplay</code></td>
<td>显示 VG 详情</td>
</tr>
<tr>
<td><code>lvdisplay</code></td>
<td>显示 LV 详情</td>
</tr>
<tr>
<td><code>lvextend</code></td>
<td>扩展 LV</td>
</tr>
<tr>
<td><code>lvreduce</code></td>
<td>缩小 LV</td>
</tr>
<tr>
<td><code>lvremove</code></td>
<td>删除 LV</td>
</tr>
<tr>
<td><code>lvcreate -s</code></td>
<td>创建快照</td>
</tr>
</tbody>
</table>
<hr>
<h1>3. 访问记忆装置</h1>
<h3 id="设备文件说明：">设备文件说明：</h3>
<table>
<thead>
<tr>
<th>设备文件</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/dev/hda</code></td>
<td>IDE 主硬盘</td>
</tr>
<tr>
<td><code>/dev/hdb</code></td>
<td>IDE 从硬盘</td>
</tr>
<tr>
<td><code>/dev/sda</code></td>
<td>第一个 SCSI/STAT/USB 硬盘</td>
</tr>
<tr>
<td><code>/dev/sdb</code></td>
<td>第二个 SCSI/STAT/USB 硬盘</td>
</tr>
<tr>
<td><code>/dev/sr0</code></td>
<td>第一个 SCSI/STAT/USB CD/DVD</td>
</tr>
<tr>
<td><code>/dev/st0</code></td>
<td>第一个 SCSI 磁带设备</td>
</tr>
</tbody>
</table>
<h3 id="硬盘管理：">硬盘管理：</h3>
<p>Linux 将 IDE 以外的硬盘识别为 SCSI 设备。硬盘的数据传送模式有 PIO（Programmed I/O）和 DMA（Direct Memory Access）模式。通常使用 DMA 模式。</p>
<h3 id="检查-DMA-模式：">检查 DMA 模式：</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdparm -i /dev/sda</span><br></pre></td></tr></table></figure>
<h3 id="硬盘控制：">硬盘控制：</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdparm -d1 /dev/sda  <span class="comment"># 启用 DMA 模式</span></span><br></pre></td></tr></table></figure>
<h3 id="使用-SCSI-STAT-USB：">使用 SCSI/STAT/USB：</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sdparm [option] [设备文件]</span><br></pre></td></tr></table></figure>
<hr>
<h1>4. iSCSI (Internet Small Computer System Interface)</h1>
<p>iSCSI 是基于 TCP/IP 的 SCSI 协议，可以使远程存储设备像本地设备一样使用。</p>
<h2 id="iSCSI-配置步骤：">iSCSI 配置步骤：</h2>
<ol>
<li>
<p>配置 <code>targets.conf</code> 文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">target</span> <span class="attr">iqn.2014.01.com.example.lpic:target0</span>&gt;</span></span><br><span class="line">   backing-store /dev/sdb2</span><br><span class="line">   initiator-address 192.168.11.2</span><br><span class="line">   initiator-address 192.168.11.4</span><br><span class="line">   incominguser centuser password</span><br><span class="line"><span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>启动 iSCSI target 服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service tgtd start</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>使用 <code>tgtadm</code> 命令查看 target 状态：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tgtadm --mode target --op show</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>使用 <code>iscsiadm</code> 从 initiator 查询 target：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iscsiadm -m discovery -t sendtargets -p 192.168.11.3</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>配置认证方式：<br>
修改 <code>/etc/iscsi/iscid.conf</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node.session.auth.authmethod = CHAP</span><br><span class="line">node.session.auth.username = centuser</span><br><span class="line">node.session.auth.password = password</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>登录 iSCSI：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iscsiadm -m node --login</span><br></pre></td></tr></table></figure>
<p>登录后，使用 <code>cat /proc/partitions</code> 查看 iSCSI 目标是否添加成功。</p>
</li>
</ol>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../2020/11/15/linux/15-%E9%AB%98%E5%BA%A6%E7%9A%84%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../2020/11/14/linux/14-%E8%AE%BE%E5%A4%87%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"
                            aria-label=": 14.设备和文件系统"
                        >
                            14.设备和文件系统
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-11-14T14:01:10+08:00">
	
		    2020 年 11 月 14 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../categories/%E5%90%8E%E7%AB%AF/">后端</a>, <a class="category-link" href="../../categories/%E5%90%8E%E7%AB%AF/linux/">linux</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="1-文件系统基础">1. 文件系统基础</h2>
<h3 id="etc-fstab-文件格式解析">/etc/fstab 文件格式解析</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">设备/标签/UUID  挂载点  文件系统类型  挂载选项  dump标志  fsck顺序</span><br></pre></td></tr></table></figure>
<p><strong>字段说明：</strong></p>
<table>
<thead>
<tr>
<th>字段</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>设备标识</td>
<td>/dev/sda1, UUID=xxxx, LABEL=root</td>
</tr>
<tr>
<td>2</td>
<td>挂载路径</td>
<td>/, /home, /boot</td>
</tr>
<tr>
<td>3</td>
<td>文件系统类型</td>
<td>ext4, xfs, nfs</td>
</tr>
<tr>
<td>4</td>
<td>挂载选项</td>
<td>defaults, noatime</td>
</tr>
<tr>
<td>5</td>
<td>dump备份标志</td>
<td>0(不备份), 1(备份)</td>
</tr>
<tr>
<td>6</td>
<td>fsck检查顺序</td>
<td>0(不检查), 1(优先), 2(次级)</td>
</tr>
</tbody>
</table>
<h3 id="文件系统类型对比">文件系统类型对比</h3>
<table>
<thead>
<tr>
<th>类型</th>
<th>特点</th>
<th>适用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td>ext4</td>
<td>日志式, 最大16TB文件</td>
<td>通用Linux系统</td>
</tr>
<tr>
<td>XFS</td>
<td>高性能, 最大8EB文件</td>
<td>大文件处理</td>
</tr>
<tr>
<td>Btrfs</td>
<td>写时复制, 快照功能</td>
<td>高级存储需求</td>
</tr>
<tr>
<td>FAT32</td>
<td>兼容性好</td>
<td>U盘/移动设备</td>
</tr>
<tr>
<td>NTFS</td>
<td>Windows兼容</td>
<td>双系统共享分区</td>
</tr>
</tbody>
</table>
<h3 id="常用挂载选项">常用挂载选项</h3>
<table>
<thead>
<tr>
<th>选项</th>
<th>作用</th>
<th>性能影响</th>
</tr>
</thead>
<tbody>
<tr>
<td>async</td>
<td>异步写入</td>
<td>提升性能</td>
</tr>
<tr>
<td>noatime</td>
<td>不更新访问时间</td>
<td>显著提升</td>
</tr>
<tr>
<td>nodiratime</td>
<td>不更新目录访问时间</td>
<td>小幅提升</td>
</tr>
<tr>
<td>discard</td>
<td>TRIM支持(SSD)</td>
<td>延长SSD寿命</td>
</tr>
<tr>
<td>data=writeback</td>
<td>ext4日志模式</td>
<td>性能最佳</td>
</tr>
</tbody>
</table>
<p><strong>查看支持的文件系统：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/filesystems</span><br></pre></td></tr></table></figure>
<p><strong>查看已挂载文件系统：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/mtab   <span class="comment"># 或</span></span><br><span class="line"><span class="built_in">cat</span> /proc/mounts</span><br></pre></td></tr></table></figure>
<h2 id="2-挂载管理命令">2. 挂载管理命令</h2>
<h3 id="mount-命令详解">mount 命令详解</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount [选项] [设备] [挂载点]</span><br></pre></td></tr></table></figure>
<p><strong>常用选项：</strong></p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-t</td>
<td>指定文件系统类型</td>
</tr>
<tr>
<td>-o</td>
<td>指定挂载选项(多选项用逗号分隔)</td>
</tr>
<tr>
<td>-a</td>
<td>挂载/etc/fstab中所有文件系统</td>
</tr>
<tr>
<td>–bind</td>
<td>目录绑定挂载</td>
</tr>
<tr>
<td>-l</td>
<td>显示标签</td>
</tr>
</tbody>
</table>
<p><strong>示例：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t ext4 -o noatime /dev/sdb1 /mnt/data</span><br></pre></td></tr></table></figure>
<h3 id="umount-命令">umount 命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount [选项] [设备|挂载点]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-a</td>
<td>卸载所有文件系统</td>
</tr>
<tr>
<td>-t</td>
<td>按类型卸载</td>
</tr>
<tr>
<td>-l</td>
<td>延迟卸载(强制)</td>
</tr>
<tr>
<td>-f</td>
<td>强制卸载</td>
</tr>
</tbody>
</table>
<p><strong>强制卸载流程：</strong></p>
<ol>
<li><code>fuser -vm /mountpoint</code> 查看占用进程</li>
<li><code>kill -9 PID</code> 结束进程</li>
<li><code>umount -f /mountpoint</code></li>
</ol>
<h2 id="3-SWAP-管理">3. SWAP 管理</h2>
<h3 id="创建SWAP文件">创建SWAP文件</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建1GB交换文件</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/swapfile bs=1M count=1024</span><br><span class="line"><span class="built_in">chmod</span> 600 /swapfile</span><br><span class="line">mkswap /swapfile</span><br><span class="line">swapon /swapfile</span><br></pre></td></tr></table></figure>
<h3 id="SWAP管理命令">SWAP管理命令</h3>
<table>
<thead>
<tr>
<th>命令</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>swapon -a</code></td>
<td>启用所有swap</td>
</tr>
<tr>
<td><code>swapon -s</code></td>
<td>查看swap使用</td>
</tr>
<tr>
<td><code>swapoff -a</code></td>
<td>禁用所有swap</td>
</tr>
</tbody>
</table>
<p><strong>优化建议：</strong></p>
<ul>
<li>物理内存&lt;8GB时，SWAP=1.5倍内存</li>
<li>物理内存≥8GB时，SWAP=8GB</li>
</ul>
<h2 id="4-文件系统创建与维护">4. 文件系统创建与维护</h2>
<h3 id="创建工具对比">创建工具对比</h3>
<table>
<thead>
<tr>
<th>命令</th>
<th>对应文件系统</th>
<th>特点</th>
</tr>
</thead>
<tbody>
<tr>
<td>mkfs.ext4</td>
<td>ext4</td>
<td>默认日志模式</td>
</tr>
<tr>
<td>mkfs.xfs</td>
<td>XFS</td>
<td>高性能大文件</td>
</tr>
<tr>
<td>mkfs.btrfs</td>
<td>Btrfs</td>
<td>高级功能支持</td>
</tr>
</tbody>
</table>
<p><strong>ext4创建示例：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkfs.ext4 -b 4096 -m 1 -L DATA /dev/sdb1</span><br></pre></td></tr></table></figure>
<p><strong>XFS创建示例：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkfs.xfs -f -L BIGDATA /dev/sdc1</span><br></pre></td></tr></table></figure>
<h3 id="文件系统检查">文件系统检查</h3>
<p><strong>ext系列检查：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fsck -y /dev/sda1   <span class="comment"># 自动修复</span></span><br><span class="line">e2fsck -f /dev/sda1 <span class="comment"># 强制检查</span></span><br></pre></td></tr></table></figure>
<p><strong>XFS检查：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xfs_repair /dev/sdb1</span><br></pre></td></tr></table></figure>
<p><strong>检查时机：</strong></p>
<ul>
<li>异常关机后</li>
<li>定期维护时(建议每6个月)</li>
<li>出现I/O错误时</li>
</ul>
<h2 id="5-高级文件系统特性">5. 高级文件系统特性</h2>
<h3 id="ext4-特性管理">ext4 特性管理</h3>
<p><strong>转换ext3→ext4：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tune2fs -O extent,uninit_bg,dir_index /dev/sda1</span><br><span class="line">fsck -pf /dev/sda1</span><br></pre></td></tr></table></figure>
<p><strong>调整参数：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tune2fs -c 30 -i 7d /dev/sda1  <span class="comment"># 每30次挂载或7天检查</span></span><br><span class="line">tune2fs -m 5 /dev/sda1         <span class="comment"># 保留5%空间</span></span><br></pre></td></tr></table></figure>
<h3 id="XFS-高级功能">XFS 高级功能</h3>
<p><strong>查看信息：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xfs_info /dev/sdb1</span><br><span class="line">xfs_admin -l /dev/sdb1</span><br></pre></td></tr></table></figure>
<p><strong>备份恢复：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xfsdump -l 0 -f /backup/root.xfsdump /dev/sda1</span><br><span class="line">xfsrestore -f /backup/root.xfsdump /mnt/restore</span><br></pre></td></tr></table></figure>
<h2 id="6-光盘与加密文件系统">6. 光盘与加密文件系统</h2>
<h3 id="光盘制作">光盘制作</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建ISO</span></span><br><span class="line">mkisofs -JR -V <span class="string">&quot;BACKUP_2023&quot;</span> -o backup.iso /backup</span><br><span class="line"></span><br><span class="line"><span class="comment"># 刻录光盘</span></span><br><span class="line">cdrecord -v dev=1,0,0 speed=24 backup.iso</span><br></pre></td></tr></table></figure>
<h3 id="加密文件系统">加密文件系统</h3>
<p><strong>LUKS加密：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cryptsetup luksFormat /dev/sdb1</span><br><span class="line">cryptsetup luksOpen /dev/sdb1 secret</span><br><span class="line">mkfs.ext4 /dev/mapper/secret</span><br><span class="line">mount /dev/mapper/secret /mnt/secure</span><br></pre></td></tr></table></figure>
<p><strong>关闭加密卷：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">umount /mnt/secure</span><br><span class="line">cryptsetup luksClose secret</span><br></pre></td></tr></table></figure>
<h2 id="7-磁盘健康监控">7. 磁盘健康监控</h2>
<h3 id="S-M-A-R-T-监控">S.M.A.R.T. 监控</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">smartctl -a /dev/sda          <span class="comment"># 查看详细信息</span></span><br><span class="line">smartctl -H /dev/sda          <span class="comment"># 健康状态</span></span><br><span class="line">smartctl -t long /dev/sda     <span class="comment"># 启动长测试</span></span><br></pre></td></tr></table></figure>
<p><strong>关键监控指标：</strong></p>
<ul>
<li>Reallocated_Sector_Ct</li>
<li>Current_Pending_Sector</li>
<li>Temperature_Celsius</li>
</ul>
<h2 id="8-故障处理流程">8. 故障处理流程</h2>
<h3 id="文件系统修复步骤">文件系统修复步骤</h3>
<ol>
<li>
<p><strong>卸载文件系统</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount /dev/sda1</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>进入单用户模式</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">init 1</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>执行检查修复</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fsck -y /dev/sda1</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>严重损坏时</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">debugfs /dev/sda1</span><br><span class="line">&gt; lsdel      <span class="comment"># 查看已删除inode</span></span><br><span class="line">&gt; dump &lt;inode&gt; /tmp/recover_file</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="应急恢复方案">应急恢复方案</h3>
<table>
<thead>
<tr>
<th>问题现象</th>
<th>解决方案</th>
</tr>
</thead>
<tbody>
<tr>
<td>无法挂载</td>
<td><code>fsck -y /dev/sdX</code></td>
</tr>
<tr>
<td>Superblock损坏</td>
<td><code>e2fsck -b 32768 /dev/sdX</code></td>
</tr>
<tr>
<td>只读文件系统</td>
<td><code>mount -o remount,rw /</code></td>
</tr>
</tbody>
</table>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../2020/11/14/linux/14-%E8%AE%BE%E5%A4%87%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../2020/11/10/linux/13-%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8/"
                            aria-label=": 13.系统启动"
                        >
                            13.系统启动
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-11-10T14:01:10+08:00">
	
		    2020 年 11 月 10 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../categories/%E5%90%8E%E7%AB%AF/">后端</a>, <a class="category-link" href="../../categories/%E5%90%8E%E7%AB%AF/linux/">linux</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="1-系统启动流程">1. 系统启动流程</h2>
<h3 id="1-1-启动阶段详解">1.1 启动阶段详解</h3>
<table>
<thead>
<tr>
<th>阶段</th>
<th>组件</th>
<th>功能说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>BIOS</td>
<td>- 硬件自检(POST)<br>- 读取CMOS设置<br>- 检测启动设备顺序<br>- 加载MBR中的BootLoader</td>
</tr>
<tr>
<td>2</td>
<td>MBR</td>
<td>- 512字节(启动代码+分区表)<br>- 包含第一阶段BootLoader<br>- 标识活动分区</td>
</tr>
<tr>
<td>3</td>
<td>BootLoader</td>
<td>- 阶段1: MBR中的初始代码<br>- 阶段1.5: 文件系统识别<br>- 阶段2: 加载内核(/boot/grub/)</td>
</tr>
<tr>
<td>4</td>
<td>内核</td>
<td>- 硬件检测与初始化<br>- 加载驱动模块<br>- 挂载根文件系统<br>- 启动init进程(PID=1)</td>
</tr>
<tr>
<td>5</td>
<td>init进程</td>
<td>- 根据/etc/inittab初始化系统<br>- 启动运行级别对应服务<br>- 生成所有后续进程</td>
</tr>
</tbody>
</table>
<h3 id="1-2-inittab-文件格式">1.2 inittab 文件格式</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id:runlevels:action:process</span><br></pre></td></tr></table></figure>
<h4 id="主要action类型">主要action类型</h4>
<table>
<thead>
<tr>
<th>action</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>boot</td>
<td>系统启动时执行，不等待完成</td>
</tr>
<tr>
<td>bootwait</td>
<td>系统启动时执行，等待完成</td>
</tr>
<tr>
<td>ctrlaltdel</td>
<td>捕获Ctrl+Alt+Del组合键</td>
</tr>
<tr>
<td>initdefault</td>
<td>设置默认运行级别</td>
</tr>
<tr>
<td>once</td>
<td>进入运行级别时执行一次</td>
</tr>
<tr>
<td>respawn</td>
<td>进程终止后自动重启</td>
</tr>
<tr>
<td>sysinit</td>
<td>系统初始化脚本</td>
</tr>
<tr>
<td>wait</td>
<td>进入运行级别时执行并等待</td>
</tr>
</tbody>
</table>
<h3 id="1-3-运行级别管理">1.3 运行级别管理</h3>
<h4 id="标准运行级别">标准运行级别</h4>
<table>
<thead>
<tr>
<th>级别</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>关机</td>
</tr>
<tr>
<td>1/S</td>
<td>单用户模式</td>
</tr>
<tr>
<td>2</td>
<td>多用户无NFS</td>
</tr>
<tr>
<td>3</td>
<td>完整多用户模式</td>
</tr>
<tr>
<td>4</td>
<td>自定义</td>
</tr>
<tr>
<td>5</td>
<td>图形界面</td>
</tr>
<tr>
<td>6</td>
<td>重启</td>
</tr>
</tbody>
</table>
<h4 id="服务管理脚本">服务管理脚本</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/service [<span class="built_in">command</span>]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>start</td>
<td>启动服务</td>
</tr>
<tr>
<td>stop</td>
<td>停止服务</td>
</tr>
<tr>
<td>restart</td>
<td>重启服务</td>
</tr>
<tr>
<td>reload</td>
<td>重载配置</td>
</tr>
<tr>
<td>status</td>
<td>查看状态</td>
</tr>
</tbody>
</table>
<h4 id="服务自启动管理">服务自启动管理</h4>
<p><strong>RedHat系(chkconfig):</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig [选项] 服务名 [on|off]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>–list</td>
<td>显示服务状态</td>
</tr>
<tr>
<td>–level</td>
<td>指定运行级别</td>
</tr>
<tr>
<td>–add</td>
<td>添加服务</td>
</tr>
<tr>
<td>–del</td>
<td>删除服务</td>
</tr>
</tbody>
</table>
<p><strong>Debian系(update-rc.d):</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update-rc.d [选项] 服务名 [commands]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-n</td>
<td>模拟执行</td>
</tr>
<tr>
<td>-f</td>
<td>强制操作</td>
</tr>
<tr>
<td>remove</td>
<td>删除链接</td>
</tr>
</tbody>
</table>
<h3 id="1-4-Upstart-事件驱动">1.4 Upstart 事件驱动</h3>
<p><strong>主要命令:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">initctl [<span class="built_in">command</span>] job</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>命令</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>start</td>
<td>启动作业</td>
</tr>
<tr>
<td>stop</td>
<td>停止作业</td>
</tr>
<tr>
<td>restart</td>
<td>重启作业</td>
</tr>
<tr>
<td>status</td>
<td>查看状态</td>
</tr>
<tr>
<td>list</td>
<td>列出所有作业</td>
</tr>
</tbody>
</table>
<p><strong>配置文件位置:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init/*.conf</span><br></pre></td></tr></table></figure>
<h2 id="2-GRUB-引导加载器">2. GRUB 引导加载器</h2>
<h3 id="2-1-GRUB-Legacy-vs-GRUB2">2.1 GRUB Legacy vs GRUB2</h3>
<table>
<thead>
<tr>
<th>特性</th>
<th>GRUB Legacy</th>
<th>GRUB2</th>
</tr>
</thead>
<tbody>
<tr>
<td>版本</td>
<td>0.9x</td>
<td>1.9x</td>
</tr>
<tr>
<td>配置文件</td>
<td>menu.lst</td>
<td>grub.cfg</td>
</tr>
<tr>
<td>生成方式</td>
<td>直接编辑</td>
<td>update-grub</td>
</tr>
<tr>
<td>分区表示</td>
<td>(hd0,0)</td>
<td>hd0,msdos1</td>
</tr>
</tbody>
</table>
<h3 id="2-2-GRUB-Legacy-配置">2.2 GRUB Legacy 配置</h3>
<p><strong>/boot/grub/menu.lst 示例:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">timeout 5</span><br><span class="line">default 0</span><br><span class="line">title CentOS</span><br><span class="line">root (hd0,0)</span><br><span class="line">kernel /vmlinuz ro root=/dev/sda1</span><br><span class="line">initrd /initrd.img</span><br></pre></td></tr></table></figure>
<p><strong>常用命令:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grub&gt; root (hd0,0)     <span class="comment"># 设置根分区</span></span><br><span class="line">grub&gt; setup (hd0)      <span class="comment"># 安装到MBR</span></span><br><span class="line">grub&gt; <span class="built_in">cat</span> /grub/menu.lst <span class="comment"># 查看配置</span></span><br></pre></td></tr></table></figure>
<h3 id="2-3-GRUB2-配置">2.3 GRUB2 配置</h3>
<p><strong>/etc/default/grub 关键参数:</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>GRUB_DEFAULT</td>
<td>默认启动项</td>
</tr>
<tr>
<td>GRUB_TIMEOUT</td>
<td>菜单超时</td>
</tr>
<tr>
<td>GRUB_CMDLINE_LINUX</td>
<td>内核参数</td>
</tr>
</tbody>
</table>
<p><strong>生成配置:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update-grub</span><br></pre></td></tr></table></figure>
<h3 id="2-4-内核启动参数">2.4 内核启动参数</h3>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>root=/dev/sda1</td>
<td>指定根分区</td>
</tr>
<tr>
<td>ro/rw</td>
<td>只读/读写挂载</td>
</tr>
<tr>
<td>init=/bin/bash</td>
<td>指定初始化程序</td>
</tr>
<tr>
<td>single</td>
<td>单用户模式</td>
</tr>
<tr>
<td>mem=1024M</td>
<td>限制内存大小</td>
</tr>
</tbody>
</table>
<p><strong>查看当前参数:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/cmdline</span><br></pre></td></tr></table></figure>
<h2 id="3-其他引导加载器">3. 其他引导加载器</h2>
<h3 id="3-1-LILO-配置">3.1 LILO 配置</h3>
<p><strong>/etc/lilo.conf 示例:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">boot=/dev/sda</span><br><span class="line">map=/boot/map</span><br><span class="line">default=linux</span><br><span class="line">image=/boot/vmlinuz</span><br><span class="line">label=linux</span><br><span class="line">root=/dev/sda1</span><br></pre></td></tr></table></figure>
<p><strong>应用配置:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lilo -v</span><br></pre></td></tr></table></figure>
<h3 id="3-2-SYSLINUX-系列">3.2 SYSLINUX 系列</h3>
<table>
<thead>
<tr>
<th>类型</th>
<th>文件系统</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>SYSLINUX</td>
<td>FAT</td>
<td>USB启动</td>
</tr>
<tr>
<td>ISOLINUX</td>
<td>ISO9660</td>
<td>光盘启动</td>
</tr>
<tr>
<td>EXTLINUX</td>
<td>ext2/3/4</td>
<td>硬盘启动</td>
</tr>
<tr>
<td>PXELINUX</td>
<td>网络</td>
<td>网络启动</td>
</tr>
</tbody>
</table>
<p><strong>PXE启动环境搭建:</strong></p>
<ol>
<li>安装必要服务:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install dhcp tftp-server syslinux</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>配置DHCP:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filename &quot;pxelinux.0&quot;;</span><br><span class="line">next-server 192.168.1.100;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>准备TFTP目录:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/</span><br><span class="line"><span class="built_in">mkdir</span> /var/lib/tftpboot/pxelinux.cfg</span><br></pre></td></tr></table></figure>
<h2 id="4-系统恢复方法">4. 系统恢复方法</h2>
<h3 id="4-1-救援模式操作">4.1 救援模式操作</h3>
<ol>
<li>使用安装介质启动</li>
<li>进入救援模式</li>
<li>挂载原系统:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chroot</span> /mnt/sysimage</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>修复引导:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grub-install /dev/sda</span><br></pre></td></tr></table></figure>
<h3 id="4-2-常见修复场景">4.2 常见修复场景</h3>
<table>
<thead>
<tr>
<th>问题</th>
<th>解决方案</th>
</tr>
</thead>
<tbody>
<tr>
<td>MBR损坏</td>
<td><code>dd if=/usr/share/syslinux/mbr.bin of=/dev/sda</code></td>
</tr>
<tr>
<td>GRUB损坏</td>
<td><code>grub-install /dev/sda</code></td>
</tr>
<tr>
<td>文件系统错误</td>
<td><code>fsck -y /dev/sda1</code></td>
</tr>
<tr>
<td>密码重置</td>
<td><code>init=/bin/bash</code> 启动后修改密码</td>
</tr>
</tbody>
</table>
<h2 id="5-启动优化技巧">5. 启动优化技巧</h2>
<ol>
<li><strong>并行启动</strong>:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/init/rc-sysinit.conf</span><br><span class="line"><span class="comment"># 修改为:</span></span><br><span class="line"><span class="built_in">env</span> DEFAULT_RUNLEVEL=2</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><strong>禁用不需要的服务</strong>:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --list | grep 3:on</span><br><span class="line">chkconfig servicename off</span><br></pre></td></tr></table></figure>
<ol start="3">
<li><strong>使用readahead</strong>:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service readahead-early restart</span><br></pre></td></tr></table></figure>
<ol start="4">
<li><strong>SSD优化</strong>:<br>
在/etc/fstab添加:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">noatime,discard</span><br></pre></td></tr></table></figure>
                    
                        


                    
                    
                        <p>
                            <a
                                href="../../2020/11/10/linux/13-%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../2020/11/08/linux/12-%E5%86%85%E6%A0%B8/"
                            aria-label=": 12.内核"
                        >
                            12.内核
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-11-08T21:06:24+08:00">
	
		    2020 年 11 月 8 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../categories/%E5%90%8E%E7%AB%AF/">后端</a>, <a class="category-link" href="../../categories/%E5%90%8E%E7%AB%AF/linux/">linux</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="1-内核版本管理">1. 内核版本管理</h2>
<h3 id="版本号说明">版本号说明</h3>
<ul>
<li>
<p><strong>2.X.Y 旧版本格式</strong>：</p>
<ul>
<li>X：偶数表示稳定版，奇数表示开发版</li>
<li>Y：修订版本号</li>
<li>后缀说明：
<ul>
<li><code>-rcN</code>：Release Candidate（候选版本）</li>
<li><code>-gitN</code>：开发中的Git版本</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>3.0+ 新版本分类</strong>：</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Prepatch</td>
<td>稳定版前的测试版本</td>
</tr>
<tr>
<td>Mainline</td>
<td>包含新特性的主线开发版本</td>
</tr>
<tr>
<td>Stable</td>
<td>稳定版本</td>
</tr>
<tr>
<td>Longterm</td>
<td>长期支持版本(LTS)</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h3 id="版本查询命令">版本查询命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uname</span> [选项]</span><br></pre></td></tr></table></figure>
<h4 id="常用选项">常用选项</h4>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-a</td>
<td>显示全部系统信息</td>
</tr>
<tr>
<td>-r</td>
<td>显示内核版本</td>
</tr>
<tr>
<td>-m</td>
<td>显示硬件架构</td>
</tr>
</tbody>
</table>
<h4 id="其他查询方式">其他查询方式</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看/proc版本信息</span></span><br><span class="line"><span class="built_in">cat</span> /proc/version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过Makefile查看</span></span><br><span class="line"><span class="built_in">head</span> -4 /usr/src/linux/Makefile</span><br></pre></td></tr></table></figure>
<h2 id="2-内核模块管理">2. 内核模块管理</h2>
<h3 id="核心命令对比">核心命令对比</h3>
<table>
<thead>
<tr>
<th>命令</th>
<th>功能说明</th>
<th>特点</th>
</tr>
</thead>
<tbody>
<tr>
<td>lsmod</td>
<td>显示已加载模块</td>
<td>读取/proc/modules</td>
</tr>
<tr>
<td>insmod</td>
<td>加载单个模块</td>
<td>不处理依赖关系</td>
</tr>
<tr>
<td>rmmod</td>
<td>卸载模块</td>
<td>需确保无依赖</td>
</tr>
<tr>
<td>modprobe</td>
<td>智能加载/卸载模块</td>
<td>自动处理依赖关系</td>
</tr>
<tr>
<td>depmod</td>
<td>生成模块依赖关系文件</td>
<td>创建modules.dep</td>
</tr>
</tbody>
</table>
<h3 id="命令详解">命令详解</h3>
<h4 id="lsmod-输出说明">lsmod 输出说明</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Module                  Size  Used by    Dependent modules</span><br></pre></td></tr></table></figure>
<ul>
<li>显示模块名、大小、引用计数和被哪些模块使用</li>
</ul>
<h4 id="modinfo-模块信息">modinfo 模块信息</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modinfo [选项] 模块名</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-a</td>
<td>显示作者信息</td>
</tr>
<tr>
<td>-d</td>
<td>显示描述信息</td>
</tr>
<tr>
<td>-l</td>
<td>显示许可证信息</td>
</tr>
<tr>
<td>-n</td>
<td>显示模块文件路径</td>
</tr>
</tbody>
</table>
<h4 id="modprobe-高级用法">modprobe 高级用法</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modprobe [选项] 模块名</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-a</td>
<td>加载所有匹配模块</td>
</tr>
<tr>
<td>-c</td>
<td>显示当前配置</td>
</tr>
<tr>
<td>-l</td>
<td>列出所有可用模块</td>
</tr>
<tr>
<td>-r</td>
<td>递归卸载模块及依赖</td>
</tr>
<tr>
<td>-t 类型</td>
<td>仅操作指定类型模块</td>
</tr>
<tr>
<td>–show-depends</td>
<td>显示模块依赖关系</td>
</tr>
</tbody>
</table>
<h3 id="配置文件">配置文件</h3>
<ul>
<li><code>/etc/modprobe.conf</code>：模块别名和参数配置<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alias eth0 e1000</span><br><span class="line">options e1000 speed=1000 duplex=full</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="3-内核编译流程">3. 内核编译流程</h2>
<h3 id="编译步骤">编译步骤</h3>
<ol>
<li><strong>准备源代码</strong></li>
<li><strong>配置内核</strong>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">make oldconfig    <span class="comment"># 基于旧配置更新</span></span><br><span class="line">make menuconfig  <span class="comment"># 文本界面配置</span></span><br><span class="line">make xconfig     <span class="comment"># Qt图形界面配置</span></span><br><span class="line">make gconfig     <span class="comment"># GTK图形界面配置</span></span><br></pre></td></tr></table></figure>
</li>
<li><strong>编译内核</strong>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make           <span class="comment"># 编译内核和模块</span></span><br><span class="line">make bzImage   <span class="comment"># 仅编译内核</span></span><br><span class="line">make modules   <span class="comment"># 仅编译模块</span></span><br></pre></td></tr></table></figure>
</li>
<li><strong>安装组件</strong>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make modules_install  <span class="comment"># 安装模块到/lib/modules/</span></span><br><span class="line">make install          <span class="comment"># 自动安装内核</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="手动安装示例">手动安装示例</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 复制内核文件</span></span><br><span class="line"><span class="built_in">cp</span> <span class="built_in">arch</span>/x86/boot/bzImage /boot/vmlinuz-2.6.32</span><br><span class="line"><span class="built_in">cp</span> System.map /boot/System.map-2.6.32</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建链接</span></span><br><span class="line"><span class="built_in">ln</span> -s /boot/vmlinuz-2.6.32 /boot/vmlinuz</span><br><span class="line"><span class="built_in">ln</span> -s /boot/System.map-2.6.32 /boot/System.map</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成initramfs</span></span><br><span class="line">mkinitramfs -o /boot/initrd-2.6.32.img 2.6.32</span><br></pre></td></tr></table></figure>
<h3 id="其他make目标">其他make目标</h3>
<table>
<thead>
<tr>
<th>目标</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>clean</td>
<td>清除编译文件</td>
</tr>
<tr>
<td>mrproper</td>
<td>彻底清除(含配置)</td>
</tr>
<tr>
<td>rpm-pkg</td>
<td>生成RPM包</td>
</tr>
<tr>
<td>deb-pkg</td>
<td>生成Debian包</td>
</tr>
</tbody>
</table>
<h2 id="4-内核参数调优">4. 内核参数调优</h2>
<h3 id="proc-sys-关键参数">/proc/sys 关键参数</h3>
<table>
<thead>
<tr>
<th>路径</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>kernel/ctrl-alt-del</td>
<td>Ctrl+Alt+Del行为</td>
</tr>
<tr>
<td>kernel/shmall</td>
<td>共享内存页数上限</td>
</tr>
<tr>
<td>kernel/shmmax</td>
<td>共享内存段最大大小</td>
</tr>
<tr>
<td>net/ipv4/ip_forward</td>
<td>IP转发开关(1/0)</td>
</tr>
<tr>
<td>fs/file-max</td>
<td>系统最大文件句柄数</td>
</tr>
</tbody>
</table>
<h3 id="sysctl-工具">sysctl 工具</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl [选项] [参数=值]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-a</td>
<td>显示所有可用参数</td>
</tr>
<tr>
<td>-p</td>
<td>从/etc/sysctl.conf加载配置</td>
</tr>
<tr>
<td>-w</td>
<td>临时修改参数</td>
</tr>
</tbody>
</table>
<h3 id="initramfs-管理">initramfs 管理</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建initramfs</span></span><br><span class="line">mkinitramfs -o initrd.img 3.16.0-4-amd64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压分析</span></span><br><span class="line"><span class="built_in">mkdir</span> initrd &amp;&amp; <span class="built_in">cd</span> initrd</span><br><span class="line">zcat ../initrd.img | cpio -<span class="built_in">id</span></span><br></pre></td></tr></table></figure>
<h2 id="5-内核调试与设备管理">5. 内核调试与设备管理</h2>
<h3 id="proc-关键文件">/proc 关键文件</h3>
<table>
<thead>
<tr>
<th>文件</th>
<th>内容说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>/proc/cpuinfo</td>
<td>CPU详细信息</td>
</tr>
<tr>
<td>/proc/meminfo</td>
<td>内存使用情况</td>
</tr>
<tr>
<td>/proc/modules</td>
<td>已加载模块列表</td>
</tr>
<tr>
<td>/proc/partitions</td>
<td>分区信息</td>
</tr>
</tbody>
</table>
<h3 id="硬件信息工具">硬件信息工具</h3>
<h4 id="lspci">lspci</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lspci [选项]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-vv</td>
<td>超详细输出</td>
</tr>
<tr>
<td>-t</td>
<td>树状显示设备层级</td>
</tr>
</tbody>
</table>
<h4 id="lsusb">lsusb</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsusb [选项]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-v</td>
<td>详细输出设备描述符</td>
</tr>
<tr>
<td>-t</td>
<td>树状显示USB设备拓扑</td>
</tr>
</tbody>
</table>
<h3 id="udev-设备管理">udev 设备管理</h3>
<h4 id="规则文件示例">规则文件示例</h4>
<p><code>/etc/udev/rules.d/70-persistent-net.rules</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SUBSYSTEM==&quot;net&quot;, ACTION==&quot;add&quot;, DRIVERS==&quot;?*&quot;, </span><br><span class="line">ATTR&#123;address&#125;==&quot;08:00:27:aa:11:3c&quot;, NAME=&quot;eth0&quot;</span><br></pre></td></tr></table></figure>
<h4 id="udevadm-工具">udevadm 工具</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">udevadm info [选项]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-a</td>
<td>显示父设备属性</td>
</tr>
<tr>
<td>-n</td>
<td>指定设备节点路径</td>
</tr>
</tbody>
</table>
<h4 id="实时监控">实时监控</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">udevadm monitor</span><br></pre></td></tr></table></figure>
                    
                        


                    
                    
                        <p>
                            <a
                                href="../../2020/11/08/linux/12-%E5%86%85%E6%A0%B8/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
          <li class="pagination-prev">
            <a
                class="btn btn--default btn--small"
                href="../7/"
                aria-label="上一頁"
            >
              <i class="fa fa-angle-left text-base icon-mr"></i>
              <span>上一頁</span>
            </a>
          </li>
        
        
          <li class="pagination-next">
            <a
                class="btn btn--default btn--small"
                href="../9/"
                aria-label="下一頁"
            >
              <span>下一頁</span>
              <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
          </li>
        
        <li class="pagination-number">第 8 頁 共 14 頁</li>
    </ul>
</div>

</section>


                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Kein Chan. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="../../assets/images/profile.jpg" alt="作者的圖片"/>
        
            <h4 id="about-card-name">Kein Chan</h4>
        
            <div id="about-card-bio"><p>這是獨立全棧工程師Kein Chan的技術博客</br>分享一些技術教程,命令備忘(cheat-sheet)等</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>全棧工程師</br>資深技術顧問</br>數據科學家</br>Hit廣島觀光大使</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Tokyo/Macau
            </div>
        
    </div>
</div>

        
            <div id="algolia-search-modal" class="modal-container">
    <div class="modal">
        <div class="modal-header">
            <span class="close-button"><i class="fa fa-times"></i></span>
            <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
                <span class="searchby-algolia-text text-color-light text-small">by</span>
                <img class="searchby-algolia-logo" src="../assets/images/logo-algolia-nebula-blue-full.svg">
            </a>
            <i class="search-icon fa fa-search"></i>
            <form id="algolia-search-form">
                <input type="text" id="algolia-search-input" name="search"
                    class="form-control input--large search-input" placeholder="Search "
                    />
            </form>
        </div>
        <div class="modal-body">
            <div class="no-result text-color-light text-center">沒有找到文章</div>
            <div class="results">
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2013/04/27/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/"
                            aria-label=": R语言-环境安装"
                        >
                            <h3 class="media-heading">R语言-环境安装</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年4月27日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2013/04/28/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E5%9F%BA%E7%A1%80/"
                            aria-label=": R语言-基础"
                        >
                            <h3 class="media-heading">R语言-基础</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年4月28日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2013/05/01/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE/"
                            aria-label=": R语言-读取数据"
                        >
                            <h3 class="media-heading">R语言-读取数据</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月1日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2013/05/02/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E7%BB%98%E5%9B%BE/"
                            aria-label=": R语言-绘图"
                        >
                            <h3 class="media-heading">R语言-绘图</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月2日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2013/05/03/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/"
                            aria-label=": R语言-线性回归"
                        >
                            <h3 class="media-heading">R语言-线性回归</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月3日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2015/02/22/Algorithms/1.%E7%AE%97%E6%B3%95%E5%9C%A8%E8%AE%A1%E7%AE%97%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8/"
                            aria-label=": 1. 算法在计算中的作用"
                        >
                            <h3 class="media-heading">1. 算法在计算中的作用</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月22日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2015/02/23/Algorithms/2.%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80/"
                            aria-label=": 2. 算法基础"
                        >
                            <h3 class="media-heading">2. 算法基础</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月23日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2015/02/24/Algorithms/3.%E5%87%BD%E6%95%B0%E7%9A%84%E5%A2%9E%E9%95%BF/"
                            aria-label=": 3. 函数的增长"
                        >
                            <h3 class="media-heading">3. 函数的增长</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月24日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2015/02/25/Algorithms/4.%E5%88%86%E6%B2%BB%E7%AD%96%E7%95%A5/"
                            aria-label=": 4. 分治策略"
                        >
                            <h3 class="media-heading">4. 分治策略</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月25日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2015/02/26/Algorithms/5.%E6%A6%82%E7%8E%87%E5%88%86%E6%9E%90%E5%92%8C%E9%9A%8F%E6%9C%BA%E7%AE%97%E6%B3%95/"
                            aria-label=": 5. 概率分析和随机算法"
                        >
                            <h3 class="media-heading">5. 概率分析和随机算法</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月26日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <p class="results-count text-medium"
                data-message-zero="沒有找到文章"
                data-message-one="找到 1 篇文章"
                data-message-other="找到 {n} 篇文章">
                找到 137 篇文章
            </p>
        </div>
    </div>
</div>

        
        
<div id="cover" style="background-image:url('../../assets/images/cover.jpeg');"></div>
        <!--SCRIPTS-->

<script src="../../assets/js/script-qtzvvb63gamuirvfphht7lytrxkfllzng1escnm2phjtlt4tvvxi5gl0wx4o.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>

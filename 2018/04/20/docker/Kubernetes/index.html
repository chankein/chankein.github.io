
<!DOCTYPE html>
<html lang="zh-tw">
    
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css">

    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/min/moment.min.js"></script>
    
      <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/locale/zh-tw.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
    <script>
      window.algoliaConfig = {
        appId: 'AWFC86Q51O',
        apiKey: 'c9d952906eb1b154d75cf863e75c1ede',
        indexName: 'MyBlog'
      };
      var algoliaIndex = algoliasearch(
        algoliaConfig.appId,
        algoliaConfig.apiKey
      ).initIndex(algoliaConfig.indexName);
    </script>


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Kein&#39;s blog">
    <title>Kubernetes - Kein&#39;s blog</title>
    <meta name="author" content="Kein Chan">
    
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Kein Chan","sameAs":["https://github.com/chankein/","https://www.linkedin.com/profile/","mailto:kein.chan85@gmail.com"],"image":"profile.jpg"},"articleBody":"# 项目简介\n\nKubernetes 是 Google 团队发起的开源项目，它的目标是管理跨多个主机的容器，提供基本的部署，维护以及应用伸缩，主要实现语言为 Go 语言。Kubernetes 是：\n\n易学：轻量级，简单，容易理解\n便携：支持公有云，私有云，混合云，以及多种云平台\n可拓展：模块化，可插拔，支持钩子，可任意组合\n自修复：自动重调度，自动重启，自动复制\n\nKubernetes 构建于 Google 数十年经验，一大半来源于 Google 生产环境规模的经验。结合了社区最佳的想法和实践。\n在分布式系统中，部署，调度，伸缩一直是最为重要的也最为基础的功能。Kubernetes 就是希望解决这一序列问题的。\nKubernetes 目前在GitHub (opens new window)进行维护。\n# Kubernetes 能够运行在任何地方！\n虽然 Kubernetes 最初是为 GCE 定制的，但是在后续版本中陆续增加了其他云平台的支持，以及本地数据中心的支持。\n# 基本概念\n\n\n节点（Node）：一个节点是一个运行 Kubernetes 中的主机。\n容器组（Pod）：一个 Pod 对应于由若干容器组成的一个容器组，同个组内的容器共享一个存储卷(volume)。\n容器组生命周期（pos-states）：包含所有容器状态集合，包括容器组状态类型，容器组生命周期，事件，重启策略，以及 replication controllers。\nReplication Controllers：主要负责指定数量的 pod 在同一时间一起运行。\n服务（services）：一个 Kubernetes 服务是容器组逻辑的高级抽象，同时也对外提供访问容器组的策略。\n卷（volumes）：一个卷就是一个目录，容器对其有访问权限。\n标签（labels）：标签是用来连接一组对象的，比如容器组。标签可以被用来组织和选择子对象。\n接口权限（accessing_the_api）：端口，IP 地址和代理的防火墙规则。\nweb 界面（ux）：用户可以通过 web 界面操作 Kubernetes。\n命令行操作（cli）：kubectl命令。\n\n# 节点\n在 Kubernetes 中，节点是实际工作的点，节点可以是虚拟机或者物理机器，依赖于一个集群环境。每个节点都有一些必要的服务以运行容器组，并且它们都可以通过主节点来管理。必要服务包括 Docker，kubelet 和代理服务。\n# 容器状态\n容器状态用来描述节点的当前状态。现在，其中包含三个信息：\n# 主机IP\n主机 IP 需要云平台来查询，Kubernetes 把它作为状态的一部分来保存。如果 Kubernetes 没有运行在云平台上，节点 ID 就是必需的。IP 地址可以变化，并且可以包含多种类型的 IP 地址，如公共 IP，私有 IP，动态 IP，ipv6 等等。\n# 节点周期\n通常来说节点有 Pending，Running，Terminated 三个周期，如果 Kubernetes 发现了一个节点并且其可用，那么 Kubernetes 就把它标记为 Pending。然后在某个时刻，Kubernetes 将会标记其为 Running。节点的结束周期称为 Terminated。一个已经 Terminated 的节点不会接受和调度任何请求，并且已经在其上运行的容器组也会删除。\n# 节点状态\n节点的状态主要是用来描述处于 Running 的节点。当前可用的有 NodeReachable 和 NodeReady。以后可能会增加其他状态。NodeReachable 表示集群可达。NodeReady 表示 kubelet 返回 Status Ok 并且 HTTP 状态检查健康。\n# 节点管理\n节点并非 Kubernetes 创建，而是由云平台创建，或者就是物理机器、虚拟机。在 Kubernetes 中，节点仅仅是一条记录，节点创建之后，Kubernetes 会检查其是否可用。在 Kubernetes 中，节点用如下结构保存：\n1234567891011121314&#123;  &quot;id&quot;: &quot;10.1.2.3&quot;,  &quot;kind&quot;: &quot;Minion&quot;,  &quot;apiVersion&quot;: &quot;v1beta1&quot;,  &quot;resources&quot;: &#123;    &quot;capacity&quot;: &#123;      &quot;cpu&quot;: 1000,      &quot;memory&quot;: 1073741824    &#125;,  &#125;,  &quot;labels&quot;: &#123;    &quot;name&quot;: &quot;my-first-k8s-node&quot;,  &#125;,&#125;\nKubernetes 校验节点可用依赖于 ID。在当前的版本中，有两个接口可以用来管理节点：节点控制和 Kube 管理。\n# 节点控制\n在 Kubernetes 主节点中，节点控制器是用来管理节点的组件。主要包含：\n\n集群范围内节点同步\n单节点生命周期管理\n\n节点控制有一个同步轮寻，主要监听所有云平台的虚拟实例，会根据节点状态创建和删除。可以通过 --node_sync_period标志来控制该轮寻。如果一个实例已经创建，节点控制将会为其创建一个结构。同样的，如果一个节点被删除，节点控制也会删除该结构。在 Kubernetes 启动时可用通过 --machines标记来显示指定节点。同样可以使用 kubectl 来一条一条的添加节点，两者是相同的。通过设置 --sync_nodes=false标记来禁止集群之间的节点同步，你也可以使用 api/kubectl 命令行来增删节点。\n# 容器组\n在 Kubernetes 中，使用的最小单位是容器组，容器组是创建，调度，管理的最小单位。 一个容器组使用相同的 Docker 容器并共享卷（挂载点）。一个容器组是一个特定应用的打包集合，包含一个或多个容器。\n和运行的容器类似，一个容器组被认为只有很短的运行周期。容器组被调度到一组节点运行，直到容器的生命周期结束或者其被删除。如果节点死掉，运行在其上的容器组将会被删除而不是重新调度。（也许在将来的版本中会添加容器组的移动）。\n# 容器组设计的初衷\n# 资源共享和通信\n容器组主要是为了数据共享和它们之间的通信。\n在一个容器组中，容器都使用相同的网络地址和端口，可以通过本地网络来相互通信。每个容器组都有独立的 IP，可用通过网络来和其他物理主机或者容器通信。\n容器组有一组存储卷（挂载点），主要是为了让容器在重启之后可以不丢失数据。\n# 容器组管理\n容器组是一个应用管理和部署的高层次抽象，同时也是一组容器的接口。容器组是部署、水平放缩的最小单位。\n# 容器组的使用\n容器组可以通过组合来构建复杂的应用，其本来的意义包含：\n\n内容管理，文件和数据加载以及本地缓存管理等。\n日志和检查点备份，压缩，快照等。\n监听数据变化，跟踪日志，日志和监控代理，消息发布等。\n代理，网桥\n控制器，管理，配置以及更新\n\n# 替代方案\n为什么不在一个单一的容器里运行多个程序？\n\n1.透明化。为了使容器组中的容器保持一致的基础设施和服务，比如进程管理和资源监控。这样设计是为了用户的便利性。\n2.解偶软件之间的依赖。每个容器都可能重新构建和发布，Kubernetes 必须支持热发布和热更新（将来）。\n3.方便使用。用户不必运行独立的程序管理，也不用担心每个应用程序的退出状态。\n4.高效。考虑到基础设施有更多的职责，容器必须要轻量化。\n\n# 容器组的生命状态\n包括若干状态值：pending、running、succeeded、failed。\n# pending\n容器组已经被节点接受，但有一个或多个容器还没有运行起来。这将包含某些节点正在下载镜像的时间，这种情形会依赖于网络情况。\n# running\n容器组已经被调度到节点，并且所有的容器都已经启动。至少有一个容器处于运行状态（或者处于重启状态）。\n# succeeded\n所有的容器都正常退出。\n# failed\n容器组中所有容器都意外中断了。\n# 容器组生命周期\n通常来说，如果容器组被创建了就不会自动销毁，除非被某种行为触发，而触发此种情况可能是人为，或者复制控制器所为。唯一例外的是容器组由 succeeded 状态成功退出，或者在一定时间内重试多次依然失败。\n如果某个节点死掉或者不能连接，那么节点控制器将会标记其上的容器组的状态为 failed。\n举例如下。\n\n容器组状态 running，有 1 容器，容器正常退出\n\n记录完成事件\n如果重启策略为：\n\n始终：重启容器，容器组保持 running\n失败时：容器组变为 succeeded\n从不：容器组变为 succeeded\n\n\n\n\n容器组状态 running，有1容器，容器异常退出\n\n记录失败事件\n如果重启策略为：\n\n始终：重启容器，容器组保持 running\n失败时：重启容器，容器组保持 running\n从不：容器组变为 failed\n\n\n\n\n容器组状态 running，有2容器，有1容器异常退出\n\n记录失败事件\n如果重启策略为：\n\n始终：重启容器，容器组保持 running\n失败时：重启容器，容器组保持 running\n从不：容器组保持 running\n\n\n当有2容器退出\n\n记录失败事件\n如果重启策略为：\n\n始终：重启容器，容器组保持 running\n失败时：重启容器，容器组保持 running\n从不：容器组变为 failed\n\n\n\n\n\n\n容器组状态 running，容器内存不足\n\n标记容器错误中断\n记录内存不足事件\n如果重启策略为：\n\n始终：重启容器，容器组保持 running\n失败时：重启容器，容器组保持 running\n从不：记录错误事件，容器组变为 failed\n\n\n\n\n容器组状态 running，一块磁盘死掉\n\n杀死所有容器\n记录事件\n容器组变为 failed\n如果容器组运行在一个控制器下，容器组将会在其他地方重新创建\n\n\n容器组状态 running，对应的节点段溢出\n\n节点控制器等到超时\n节点控制器标记容器组 failed\n如果容器组运行在一个控制器下，容器组将会在其他地方重新创建\n\n\n\n# Replication Controllers\n# 服务\n# 卷\n# 标签\n# 接口权限\n# web界面\n# 命令行操作\n# 基本架构\n任何优秀的项目都离不开优秀的架构设计。本小节将介绍 Kubernetes 在架构方面的设计考虑。\n# 基本考虑\n如果让我们自己从头设计一套容器管理平台，有如下几个方面是很容易想到的：\n\n分布式架构，保证扩展性；\n逻辑集中式的控制平面 + 物理分布式的运行平面；\n一套资源调度系统，管理哪个容器该分配到哪个节点上；\n一套对容器内服务进行抽象和 HA 的系统。\n\n# 运行原理\n下面这张图完整展示了 Kubernetes 的运行原理。\n\n可见，Kubernetes 首先是一套分布式系统，由多个节点组成，节点分为两类：一类是属于管理平面的主节点/控制节点（Master Node）；一类是属于运行平面的工作节点（Worker Node）。\n显然，复杂的工作肯定都交给控制节点去做了，工作节点负责提供稳定的操作接口和能力抽象即可。\n从这张图上，我们没有能发现 Kubernetes 中对于控制平面的分布式实现，但是由于数据后端自身就是一套分布式的数据库 Etcd，因此可以很容易扩展到分布式实现。\n# 控制平面\n# 主节点服务\n主节点上需要提供如下的管理服务：\n\napiserver 是整个系统的对外接口，提供一套 RESTful 的 Kubernetes API (opens new window)，供客户端和其它组件调用；\nscheduler 负责对资源进行调度，分配某个 pod 到某个节点上。是 pluggable 的，意味着很容易选择其它实现方式；\ncontroller-manager 负责管理控制器，包括 endpoint-controller（刷新服务和 pod 的关联信息）和 replication-controller（维护某个 pod 的复制为配置的数值）。\n\n# Etcd\n这里 Etcd 即作为数据后端，又作为消息中间件。\n通过 Etcd 来存储所有的主节点上的状态信息，很容易实现主节点的分布式扩展。\n组件可以自动的去侦测 Etcd 中的数值变化来获得通知，并且获得更新后的数据来执行相应的操作。\n# 工作节点\n\nkubelet 是工作节点执行操作的 agent，负责具体的容器生命周期管理，根据从数据库中获取的信息来管理容器，并上报 pod 运行状态等；\nkube-proxy 是一个简单的网络访问代理，同时也是一个 Load Balancer。它负责将访问到某个服务的请求具体分配给工作节点上的 Pod（同一类标签）。\n\n\nDocker 从入门到实践\n微信交流群 (opens new window)\n小程序 (opens new window)\n安装 Docker\nDocker 入门\nDocker 实战\nCI/CD\nCompose\nKubernetes\n云计算\n云服务器99/元首年特惠 (opens new window)\nGitHub (opens new window)\n\nKubernetes\n部署 Kubernetes\n\n部署 Kubernetes\n小于 1 分钟 约 102 字\n\n# 部署 Kubernetes\n目前，Kubernetes 支持在多种环境下使用，包括本地主机（Ubuntu、Debian、CentOS、Fedora 等）、云服务（腾讯云 (opens new window)、阿里云 (opens new window)、百度云 (opens new window) 等）。\n你可以使用以下几种方式部署 Kubernetes：\n\nkubeadm\ndocker-desktop\nk3s\n\n接下来的小节会对以上几种方式进行详细介绍。\n基本架构 使用 kubeadm 部署 kubernetes(CRI 使用 containerd)\n# 使用 kubeadm 部署 kubernetes(CRI 使用 containerd)\nkubeadm 提供了 kubeadm init 以及 kubeadm join 这两个命令作为快速创建 kubernetes 集群的最佳实践。\n# 安装 containerd\n参考 安装 Docker 一节添加 apt/yum 源，之后执行如下命令。\n12345# debian 系$ sudo apt install containerd.io# rhel 系$ sudo yum install containerd.io\n# 配置 containerd\n新建 /etc/systemd/system/cri-containerd.service 文件\n1234567891011121314151617181920212223242526[Unit]Description=containerd container runtime for kubernetesDocumentation=https://containerd.ioAfter=network.target local-fs.target[Service]ExecStartPre=-/sbin/modprobe overlayExecStart=/usr/bin/containerd --config //etc/cri-containerd/config.tomlType=notifyDelegate=yesKillMode=processRestart=alwaysRestartSec=5# Having non-zero Limit*s causes performance problems due to accounting overhead# in the kernel. We recommend using cgroups to do container-local accounting.LimitNPROC=infinityLimitCORE=infinityLimitNOFILE=infinity# Comment TasksMax if your systemd version does not supports it.# Only systemd 226 and above support this version.TasksMax=infinityOOMScoreAdjust=-999[Install]WantedBy=multi-user.target\n新建 /etc/cri-containerd/config.toml containerd 配置文件\n123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147version = 2# persistent data locationroot = &quot;/var/lib/cri-containerd&quot;# runtime state informationstate = &quot;/run/cri-containerd&quot;plugin_dir = &quot;&quot;disabled_plugins = []required_plugins = []# set containerd&#x27;s OOM scoreoom_score = 0[grpc]  address = &quot;/run/cri-containerd/cri-containerd.sock&quot;  tcp_address = &quot;&quot;  tcp_tls_cert = &quot;&quot;  tcp_tls_key = &quot;&quot;  # socket uid  uid = 0  # socket gid  gid = 0  max_recv_message_size = 16777216  max_send_message_size = 16777216[debug]  address = &quot;&quot;  format = &quot;json&quot;  uid = 0  gid = 0  level = &quot;&quot;[metrics]  address = &quot;127.0.0.1:1338&quot;  grpc_histogram = false[cgroup]  path = &quot;&quot;[timeouts]  &quot;io.containerd.timeout.shim.cleanup&quot; = &quot;5s&quot;  &quot;io.containerd.timeout.shim.load&quot; = &quot;5s&quot;  &quot;io.containerd.timeout.shim.shutdown&quot; = &quot;3s&quot;  &quot;io.containerd.timeout.task.state&quot; = &quot;2s&quot;[plugins]  [plugins.&quot;io.containerd.gc.v1.scheduler&quot;]    pause_threshold = 0.02    deletion_threshold = 0    mutation_threshold = 100    schedule_delay = &quot;0s&quot;    startup_delay = &quot;100ms&quot;  [plugins.&quot;io.containerd.grpc.v1.cri&quot;]    disable_tcp_service = true    stream_server_address = &quot;127.0.0.1&quot;    stream_server_port = &quot;0&quot;    stream_idle_timeout = &quot;4h0m0s&quot;    enable_selinux = false    selinux_category_range = 1024    sandbox_image = &quot;registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.5&quot;    stats_collect_period = 10    # systemd_cgroup = false    enable_tls_streaming = false    max_container_log_line_size = 16384    disable_cgroup = false    disable_apparmor = false    restrict_oom_score_adj = false    max_concurrent_downloads = 3    disable_proc_mount = false    unset_seccomp_profile = &quot;&quot;    tolerate_missing_hugetlb_controller = true    disable_hugetlb_controller = true    ignore_image_defined_volumes = false    [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd]      snapshotter = &quot;overlayfs&quot;      default_runtime_name = &quot;runc&quot;      no_pivot = false      disable_snapshot_annotations = false      discard_unpacked_layers = false      [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes]        [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc]          runtime_type = &quot;io.containerd.runc.v2&quot;          pod_annotations = []          container_annotations = []          privileged_without_host_devices = false          base_runtime_spec = &quot;&quot;          [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options]            # SystemdCgroup enables systemd cgroups.            SystemdCgroup = true            # BinaryName is the binary name of the runc binary.            # BinaryName = &quot;runc&quot;            # BinaryName = &quot;crun&quot;            # NoPivotRoot disables pivot root when creating a container.            # NoPivotRoot = false            # NoNewKeyring disables new keyring for the container.            # NoNewKeyring = false            # ShimCgroup places the shim in a cgroup.            # ShimCgroup = &quot;&quot;            # IoUid sets the I/O&#x27;s pipes uid.            # IoUid = 0            # IoGid sets the I/O&#x27;s pipes gid.            # IoGid = 0            # Root is the runc root directory.            Root = &quot;&quot;            # CriuPath is the criu binary path.            # CriuPath = &quot;&quot;            # CriuImagePath is the criu image path            # CriuImagePath = &quot;&quot;            # CriuWorkPath is the criu work path.            # CriuWorkPath = &quot;&quot;    [plugins.&quot;io.containerd.grpc.v1.cri&quot;.cni]      bin_dir = &quot;/opt/cni/bin&quot;      conf_dir = &quot;/etc/cni/net.d&quot;      max_conf_num = 1      conf_template = &quot;&quot;    [plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry]      config_path = &quot;/etc/cri-containerd/certs.d&quot;      [plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.headers]        # Foo = [&quot;bar&quot;]    [plugins.&quot;io.containerd.grpc.v1.cri&quot;.image_decryption]      key_model = &quot;&quot;    [plugins.&quot;io.containerd.grpc.v1.cri&quot;.x509_key_pair_streaming]      tls_cert_file = &quot;&quot;      tls_key_file = &quot;&quot;  [plugins.&quot;io.containerd.internal.v1.opt&quot;]    path = &quot;/opt/cri-containerd&quot;  [plugins.&quot;io.containerd.internal.v1.restart&quot;]    interval = &quot;10s&quot;  [plugins.&quot;io.containerd.metadata.v1.bolt&quot;]    content_sharing_policy = &quot;shared&quot;  [plugins.&quot;io.containerd.monitor.v1.cgroups&quot;]    no_prometheus = false  [plugins.&quot;io.containerd.runtime.v2.task&quot;]    platforms = [&quot;linux/amd64&quot;]  [plugins.&quot;io.containerd.service.v1.diff-service&quot;]    default = [&quot;walking&quot;]  [plugins.&quot;io.containerd.snapshotter.v1.devmapper&quot;]    root_path = &quot;&quot;    pool_name = &quot;&quot;    base_image_size = &quot;&quot;    async_remove = false\n# 安装 kubelet kubeadm kubectl cri-tools kubernetes-cni\n# Ubuntu/Debian\n123456789$ apt-get update &amp;&amp; apt-get install -y apt-transport-https$ curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add -$ cat &lt;&lt;EOF | sudo tee /etc/apt/sources.list.d/kubernetes.listdeb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial mainEOF$ apt-get update$ apt-get install -y kubelet kubeadm kubectl\n# CentOS/Fedora\n1234567891011$ cat &lt;&lt;EOF | sudo tee /etc/yum.repos.d/kubernetes.repo[kubernetes]name=Kubernetesbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/enabled=1gpgcheck=1repo_gpgcheck=1gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpgEOF$ sudo yum install -y kubelet kubeadm kubectl\n# 修改内核的运行参数\n12345678$ cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.confnet.bridge.bridge-nf-call-iptables  = 1net.ipv4.ip_forward                 = 1net.bridge.bridge-nf-call-ip6tables = 1EOF# 应用配置$ sysctl --system\n# 配置 kubelet\n# 修改 kubelet.service\n/etc/systemd/system/kubelet.service.d/10-proxy-ipvs.conf 写入以下内容\n123456# 启用 ipvs 相关内核模块[Service]ExecStartPre=-/sbin/modprobe ip_vsExecStartPre=-/sbin/modprobe ip_vs_rrExecStartPre=-/sbin/modprobe ip_vs_wrrExecStartPre=-/sbin/modprobe ip_vs_sh\n执行以下命令应用配置。\n1$ sudo systemctl daemon-reload\n# 部署\n# master\n12345678910$ systemctl enable cri-containerd$ systemctl start cri-containerd$ sudo kubeadm init \\      --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers \\      --pod-network-cidr 10.244.0.0/16 \\      --cri-socket /run/cri-containerd/cri-containerd.sock \\      --v 5 \\      --ignore-preflight-errors=all\n\n--pod-network-cidr 10.244.0.0/16 参数与后续 CNI 插件有关，这里以 flannel 为例，若后续部署其他类型的网络插件请更改此参数。\n\n\n执行可能出现错误，例如缺少依赖包，根据提示安装即可。\n\n执行成功会输出\n12345678910111213141516171819202122...[addons] Applied essential addon: CoreDNSI1116 12:35:13.270407   86677 request.go:538] Throttling request took 181.409184ms, request: POST:https://192.168.199.100:6443/api/v1/namespaces/kube-system/serviceaccountsI1116 12:35:13.470292   86677 request.go:538] Throttling request took 186.088112ms, request: POST:https://192.168.199.100:6443/api/v1/namespaces/kube-system/configmaps[addons] Applied essential addon: kube-proxyYour Kubernetes control-plane has initialized successfully!To start using your cluster, you need to run the following as a regular user:  mkdir -p $HOME/.kube  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config  sudo chown $(id -u):$(id -g) $HOME/.kube/configYou should now deploy a pod network to the cluster.Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:  https://kubernetes.io/docs/concepts/cluster-administration/addons/Then you can join any number of worker nodes by running the following on each as root:kubeadm join 192.168.199.100:6443 --token cz81zt.orsy9gm9v649e5lf \\    --discovery-token-ca-cert-hash sha256:5edb316fd0d8ea2792cba15cdf1c899a366f147aa03cba52d4e5c5884ad836fe\n# node 工作节点\n在 另一主机 重复 部署 小节以前的步骤，安装配置好 kubelet。根据提示，加入到集群。\n12345678$ systemctl enable cri-containerd$ systemctl start cri-containerd$ kubeadm join 192.168.199.100:6443 \\    --token cz81zt.orsy9gm9v649e5lf \\    --discovery-token-ca-cert-hash sha256:5edb316fd0d8ea2792cba15cdf1c899a366f147aa03cba52d4e5c5884ad836fe \\    --cri-socket /run/cri-containerd/cri-containerd.sock\n# 查看服务\n所有服务启动后，通过 crictl 查看本地实际运行的容器。这些服务大概分为三类：主节点服务、工作节点服务和其它服务。\n1CONTAINER_RUNTIME_ENDPOINT=/run/cri-containerd/cri-containerd.sock crictl ps -a\n# 主节点服务\n\n\napiserver 是整个系统的对外接口，提供 RESTful 方式供客户端和其它组件调用；\n\n\nscheduler 负责对资源进行调度，分配某个 pod 到某个节点上；\n\n\ncontroller-manager 负责管理控制器，包括 endpoint-controller（刷新服务和 pod 的关联信息）和 replication-controller（维护某个 pod 的复制为配置的数值）。\n\n\n# 工作节点服务\n\nproxy 为 pod 上的服务提供访问的代理。\n\n# 其它服务\n\nEtcd 是所有状态的存储数据库；\n\n# 使用\n将 /etc/kubernetes/admin.conf 复制到 ~/.kube/config\n执行 $ kubectl get all -A 查看启动的服务。\n由于未部署 CNI 插件，CoreDNS 未正常启动。如何使用 Kubernetes，请参考后续章节。\n# 部署 CNI\n这里以 flannel 为例进行介绍。\n# flannel\n检查 podCIDR 设置\n12345$ kubectl get node -o yaml | grep CIDR# 输出    podCIDR: 10.244.0.0/16    podCIDRs:\n1$ kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/v0.11.0/Documentation/kube-flannel.yml\n# master 节点默认不能运行 pod\n如果用 kubeadm 部署一个单节点集群，默认情况下无法使用，请执行以下命令解除限制\n1234$ kubectl taint nodes --all node-role.kubernetes.io/master-# 恢复默认值# $ kubectl taint nodes NODE_NAME node-role.kubernetes.io/master=true:NoSchedule\n# 参考文档\n\n官方文档 (opens new window)\nContainer runtimes (opens new window)\n\n# Docker Desktop 启用 Kubernetes\n使用 Docker Desktop 可以很方便的启用 Kubernetes，由于国内获取不到 k8s.gcr.io 镜像，我们必须首先解决这一问题。\n# 获取 k8s.gcr.io 镜像\n由于国内拉取不到 k8s.gcr.io 镜像，我们可以使用开源项目 AliyunContainerService/k8s-for-docker-desktop (opens new window) 来获取所需的镜像。\n# 启用 Kubernetes\n在 Docker Desktop 设置页面，点击 Kubernetes，选择 Enable Kubernetes，稍等片刻，看到左下方 Kubernetes 变为 running，Kubernetes 启动成功。\n\n# 测试\n1$ kubectl version\n如果正常输出信息，则证明 Kubernetes 成功启动。\n# Kubernetes Dashboard\nKubernetes Dashboard (opens new window) 是基于网页的 Kubernetes 用户界面。\n\n# 部署\n执行以下命令即可部署 Dashboard：\n1kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml\n# 访问\n通过命令行代理访问，执行以下命令：\n到 http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/ 即可访问。\n# 登录\n目前，Dashboard 仅支持使用 Bearer 令牌登录。下面教大家如何创建该令牌：\n123456789$ kubectl create sa dashboard-admin -n kube-system$ kubectl create clusterrolebinding dashboard-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashboard-admin$ ADMIN_SECRET=$(kubectl get secrets -n kube-system | grep dashboard-admin | awk &#x27;&#123;print $1&#125;&#x27;)$ DASHBOARD_LOGIN_TOKEN=$(kubectl describe secret -n kube-system $&#123;ADMIN_SECRET&#125; | grep -E &#x27;^token&#x27; | awk &#x27;&#123;print $2&#125;&#x27;)echo $&#123;DASHBOARD_LOGIN_TOKEN&#125;\n将结果粘贴到登录页面，即可登录。\n# 参考文档\n\n官方文档 (opens new window)\n\n","dateCreated":"2018-04-20T16:02:39+08:00","dateModified":"2025-06-16T10:23:25+08:00","datePublished":"2018-04-20T16:02:39+08:00","description":"","headline":"Kubernetes","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://keinchan.com/2018/04/20/docker/Kubernetes/"},"publisher":{"@type":"Organization","name":"Kein Chan","sameAs":["https://github.com/chankein/","https://www.linkedin.com/profile/","mailto:kein.chan85@gmail.com"],"image":"profile.jpg","logo":{"@type":"ImageObject","url":"profile.jpg"}},"url":"https://keinchan.com/2018/04/20/docker/Kubernetes/","keywords":"Docker, Kubernetes"}</script>
    <meta name="description" content="# 项目简介  Kubernetes 是 Google 团队发起的开源项目，它的目标是管理跨多个主机的容器，提供基本的部署，维护以及应用伸缩，主要实现语言为 Go 语言。Kubernetes 是：  易学：轻量级，简单，容易理解 便携：支持公有云，私有云，混合云，以及多种云平台 可拓展：模块化，可插拔，支持钩子，可任意组合 自修复：自动重调度，自动重启，自动复制  Kubernetes 构建于 G">
<meta property="og:type" content="blog">
<meta property="og:title" content="Kubernetes">
<meta property="og:url" content="https://keinchan.com/2018/04/20/docker/Kubernetes/index.html">
<meta property="og:site_name" content="Kein&#39;s blog">
<meta property="og:description" content="# 项目简介  Kubernetes 是 Google 团队发起的开源项目，它的目标是管理跨多个主机的容器，提供基本的部署，维护以及应用伸缩，主要实现语言为 Go 语言。Kubernetes 是：  易学：轻量级，简单，容易理解 便携：支持公有云，私有云，混合云，以及多种云平台 可拓展：模块化，可插拔，支持钩子，可任意组合 自修复：自动重调度，自动重启，自动复制  Kubernetes 构建于 G">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://vuepress.mirror.docker-practice.com/assets/img/kubernetes_logo.328f5ccb.png">
<meta property="og:image" content="https://vuepress.mirror.docker-practice.com/assets/img/kubernetes_design.94f04f39.jpg">
<meta property="og:image" content="https://vuepress.mirror.docker-practice.com/assets/img/k8s_architecture.1cde0882.png">
<meta property="og:image" content="https://vuepress.mirror.docker-practice.com/assets/img/kube-proxy.e356ec8f.png">
<meta property="og:image" content="https://github.com/AliyunContainerService/k8s-for-docker-desktop/raw/master/images/k8s.png">
<meta property="og:image" content="https://d33wubrfki0l68.cloudfront.net/349824f68836152722dab89465835e604719caea/6e0b7/images/docs/ui-dashboard.png">
<meta property="article:published_time" content="2018-04-20T08:02:39.000Z">
<meta property="article:modified_time" content="2025-06-16T02:23:25.914Z">
<meta property="article:author" content="Kein Chan">
<meta property="article:tag" content="Docker">
<meta property="article:tag" content="Kubernetes">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://vuepress.mirror.docker-practice.com/assets/img/kubernetes_logo.328f5ccb.png">
    
    
        
    
    
        <meta property="og:image" content="https://keinchan.com../../../../../assets/images/profile.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="../../../../../assets/css/style-l9zwheso7r7pnk98nvirovsz9dl7fhkrc9mlb5vmuxw7tk5movrk0eevsrpr.min.css">

    <!--STYLES END-->
    

    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="../../../../../index.html"
            aria-label=""
        >
            Kein&#39;s blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="打開鏈接: ../../../../../#about"
            >
        
        
            <img class="header-picture" src="../../../../../assets/images/profile.jpg" alt="作者的圖片"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="../../../../../#about"
                    aria-label="閱讀有關作者的更多信息"
                >
                    <img class="sidebar-profile-picture" src="../../../../../assets/images/profile.jpg" alt="作者的圖片"/>
                </a>
                <h4 class="sidebar-profile-name">Kein Chan</h4>
                
                    <h5 class="sidebar-profile-bio"><p>這是獨立全棧工程師Kein Chan的技術博客</br>分享一些技術教程,命令備忘(cheat-sheet)等</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../../../../index.html"
                            
                            rel="noopener"
                            title="首頁"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首頁</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../../../../all-categories"
                            
                            rel="noopener"
                            title="分類"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分類</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../../../../all-tags"
                            
                            rel="noopener"
                            title="標籤"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">標籤</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../../../../all-archives"
                            
                            rel="noopener"
                            title="所有文章"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">所有文章</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="搜尋"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">搜尋</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="關於"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">關於</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/chankein/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/profile/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../../../../mailto:kein.chan85@gmail.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Email"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Email</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../../../../atom.xml"
                            
                            rel="noopener"
                            title="Atom"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Atom</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Kubernetes
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2018-04-20T16:02:39+08:00">
	
		    2018 年 4 月 20 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../../../../categories/devops/">devops</a>, <a class="category-link" href="../../../../../categories/devops/Docker/">Docker</a>, <a class="category-link" href="../../../../../categories/devops/Docker/Kubernetes/">Kubernetes</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <h2 id="项目简介"><a href="#%E9%A1%B9%E7%9B%AE%E7%AE%80%E4%BB%8B">#</a> 项目简介</h2>
<p><img src="https://vuepress.mirror.docker-practice.com/assets/img/kubernetes_logo.328f5ccb.png" alt=""></p>
<p>Kubernetes 是 Google 团队发起的开源项目，它的目标是管理跨多个主机的容器，提供基本的部署，维护以及应用伸缩，主要实现语言为 Go 语言。Kubernetes 是：</p>
<ul>
<li>易学：轻量级，简单，容易理解</li>
<li>便携：支持公有云，私有云，混合云，以及多种云平台</li>
<li>可拓展：模块化，可插拔，支持钩子，可任意组合</li>
<li>自修复：自动重调度，自动重启，自动复制</li>
</ul>
<p>Kubernetes 构建于 Google 数十年经验，一大半来源于 Google 生产环境规模的经验。结合了社区最佳的想法和实践。</p>
<p>在分布式系统中，部署，调度，伸缩一直是最为重要的也最为基础的功能。Kubernetes 就是希望解决这一序列问题的。</p>
<p>Kubernetes 目前在<a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes">GitHub (opens new window)</a>进行维护。</p>
<h3 id="Kubernetes-能够运行在任何地方！"><a href="#kubernetes-%E8%83%BD%E5%A4%9F%E8%BF%90%E8%A1%8C%E5%9C%A8%E4%BB%BB%E4%BD%95%E5%9C%B0%E6%96%B9">#</a> Kubernetes 能够运行在任何地方！</h3>
<p>虽然 Kubernetes 最初是为 GCE 定制的，但是在后续版本中陆续增加了其他云平台的支持，以及本地数据中心的支持。</p>
<h2 id="基本概念"><a href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">#</a> 基本概念</h2>
<p><img src="https://vuepress.mirror.docker-practice.com/assets/img/kubernetes_design.94f04f39.jpg" alt=""></p>
<ul>
<li>节点（<code>Node</code>）：一个节点是一个运行 Kubernetes 中的主机。</li>
<li>容器组（<code>Pod</code>）：一个 Pod 对应于由若干容器组成的一个容器组，同个组内的容器共享一个存储卷(volume)。</li>
<li>容器组生命周期（<code>pos-states</code>）：包含所有容器状态集合，包括容器组状态类型，容器组生命周期，事件，重启策略，以及 replication controllers。</li>
<li>Replication Controllers：主要负责指定数量的 pod 在同一时间一起运行。</li>
<li>服务（<code>services</code>）：一个 Kubernetes 服务是容器组逻辑的高级抽象，同时也对外提供访问容器组的策略。</li>
<li>卷（<code>volumes</code>）：一个卷就是一个目录，容器对其有访问权限。</li>
<li>标签（<code>labels</code>）：标签是用来连接一组对象的，比如容器组。标签可以被用来组织和选择子对象。</li>
<li>接口权限（<code>accessing_the_api</code>）：端口，IP 地址和代理的防火墙规则。</li>
<li>web 界面（<code>ux</code>）：用户可以通过 web 界面操作 Kubernetes。</li>
<li>命令行操作（<code>cli</code>）：<code>kubectl</code>命令。</li>
</ul>
<h2 id="节点"><a href="#%E8%8A%82%E7%82%B9">#</a> 节点</h2>
<p>在 <code>Kubernetes</code> 中，节点是实际工作的点，节点可以是虚拟机或者物理机器，依赖于一个集群环境。每个节点都有一些必要的服务以运行容器组，并且它们都可以通过主节点来管理。必要服务包括 Docker，kubelet 和代理服务。</p>
<h3 id="容器状态"><a href="#%E5%AE%B9%E5%99%A8%E7%8A%B6%E6%80%81">#</a> 容器状态</h3>
<p>容器状态用来描述节点的当前状态。现在，其中包含三个信息：</p>
<h4 id="主机IP"><a href="#%E4%B8%BB%E6%9C%BAip">#</a> 主机IP</h4>
<p>主机 IP 需要云平台来查询，<code>Kubernetes</code> 把它作为状态的一部分来保存。如果 <code>Kubernetes</code> 没有运行在云平台上，节点 ID 就是必需的。IP 地址可以变化，并且可以包含多种类型的 IP 地址，如公共 IP，私有 IP，动态 IP，ipv6 等等。</p>
<h4 id="节点周期"><a href="#%E8%8A%82%E7%82%B9%E5%91%A8%E6%9C%9F">#</a> 节点周期</h4>
<p>通常来说节点有 <code>Pending</code>，<code>Running</code>，<code>Terminated</code> 三个周期，如果 Kubernetes 发现了一个节点并且其可用，那么 Kubernetes 就把它标记为 <code>Pending</code>。然后在某个时刻，Kubernetes 将会标记其为 <code>Running</code>。节点的结束周期称为 <code>Terminated</code>。一个已经 <code>Terminated</code> 的节点不会接受和调度任何请求，并且已经在其上运行的容器组也会删除。</p>
<h4 id="节点状态"><a href="#%E8%8A%82%E7%82%B9%E7%8A%B6%E6%80%81">#</a> 节点状态</h4>
<p>节点的状态主要是用来描述处于 <code>Running</code> 的节点。当前可用的有 <code>NodeReachable</code> 和 <code>NodeReady</code>。以后可能会增加其他状态。<code>NodeReachable</code> 表示集群可达。<code>NodeReady</code> 表示 kubelet 返回 Status Ok 并且 HTTP 状态检查健康。</p>
<h3 id="节点管理"><a href="#%E8%8A%82%E7%82%B9%E7%AE%A1%E7%90%86">#</a> 节点管理</h3>
<p>节点并非 Kubernetes 创建，而是由云平台创建，或者就是物理机器、虚拟机。在 Kubernetes 中，节点仅仅是一条记录，节点创建之后，Kubernetes 会检查其是否可用。在 Kubernetes 中，节点用如下结构保存：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10.1.2.3&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;kind&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Minion&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;apiVersion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;v1beta1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;resources&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;capacity&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;cpu&quot;</span><span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;memory&quot;</span><span class="punctuation">:</span> <span class="number">1073741824</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;labels&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my-first-k8s-node&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>Kubernetes 校验节点可用依赖于 ID。在当前的版本中，有两个接口可以用来管理节点：节点控制和 Kube 管理。</p>
<h3 id="节点控制"><a href="#%E8%8A%82%E7%82%B9%E6%8E%A7%E5%88%B6">#</a> 节点控制</h3>
<p>在 Kubernetes 主节点中，节点控制器是用来管理节点的组件。主要包含：</p>
<ul>
<li>集群范围内节点同步</li>
<li>单节点生命周期管理</li>
</ul>
<p>节点控制有一个同步轮寻，主要监听所有云平台的虚拟实例，会根据节点状态创建和删除。可以通过 <code>--node_sync_period</code>标志来控制该轮寻。如果一个实例已经创建，节点控制将会为其创建一个结构。同样的，如果一个节点被删除，节点控制也会删除该结构。在 Kubernetes 启动时可用通过 <code>--machines</code>标记来显示指定节点。同样可以使用 <code>kubectl</code> 来一条一条的添加节点，两者是相同的。通过设置 <code>--sync_nodes=false</code>标记来禁止集群之间的节点同步，你也可以使用 api/kubectl 命令行来增删节点。</p>
<h2 id="容器组"><a href="#%E5%AE%B9%E5%99%A8%E7%BB%84">#</a> 容器组</h2>
<p>在 Kubernetes 中，使用的最小单位是容器组，容器组是创建，调度，管理的最小单位。 一个容器组使用相同的 Docker 容器并共享卷（挂载点）。一个容器组是一个特定应用的打包集合，包含一个或多个容器。</p>
<p>和运行的容器类似，一个容器组被认为只有很短的运行周期。容器组被调度到一组节点运行，直到容器的生命周期结束或者其被删除。如果节点死掉，运行在其上的容器组将会被删除而不是重新调度。（也许在将来的版本中会添加容器组的移动）。</p>
<h3 id="容器组设计的初衷"><a href="#%E5%AE%B9%E5%99%A8%E7%BB%84%E8%AE%BE%E8%AE%A1%E7%9A%84%E5%88%9D%E8%A1%B7">#</a> 容器组设计的初衷</h3>
<h3 id="资源共享和通信"><a href="#%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%AB%E5%92%8C%E9%80%9A%E4%BF%A1">#</a> 资源共享和通信</h3>
<p>容器组主要是为了数据共享和它们之间的通信。</p>
<p>在一个容器组中，容器都使用相同的网络地址和端口，可以通过本地网络来相互通信。每个容器组都有独立的 IP，可用通过网络来和其他物理主机或者容器通信。</p>
<p>容器组有一组存储卷（挂载点），主要是为了让容器在重启之后可以不丢失数据。</p>
<h3 id="容器组管理"><a href="#%E5%AE%B9%E5%99%A8%E7%BB%84%E7%AE%A1%E7%90%86">#</a> 容器组管理</h3>
<p>容器组是一个应用管理和部署的高层次抽象，同时也是一组容器的接口。容器组是部署、水平放缩的最小单位。</p>
<h3 id="容器组的使用"><a href="#%E5%AE%B9%E5%99%A8%E7%BB%84%E7%9A%84%E4%BD%BF%E7%94%A8">#</a> 容器组的使用</h3>
<p>容器组可以通过组合来构建复杂的应用，其本来的意义包含：</p>
<ul>
<li>内容管理，文件和数据加载以及本地缓存管理等。</li>
<li>日志和检查点备份，压缩，快照等。</li>
<li>监听数据变化，跟踪日志，日志和监控代理，消息发布等。</li>
<li>代理，网桥</li>
<li>控制器，管理，配置以及更新</li>
</ul>
<h3 id="替代方案"><a href="#%E6%9B%BF%E4%BB%A3%E6%96%B9%E6%A1%88">#</a> 替代方案</h3>
<p>为什么不在一个单一的容器里运行多个程序？</p>
<ul>
<li>1.透明化。为了使容器组中的容器保持一致的基础设施和服务，比如进程管理和资源监控。这样设计是为了用户的便利性。</li>
<li>2.解偶软件之间的依赖。每个容器都可能重新构建和发布，Kubernetes 必须支持热发布和热更新（将来）。</li>
<li>3.方便使用。用户不必运行独立的程序管理，也不用担心每个应用程序的退出状态。</li>
<li>4.高效。考虑到基础设施有更多的职责，容器必须要轻量化。</li>
</ul>
<h3 id="容器组的生命状态"><a href="#%E5%AE%B9%E5%99%A8%E7%BB%84%E7%9A%84%E7%94%9F%E5%91%BD%E7%8A%B6%E6%80%81">#</a> 容器组的生命状态</h3>
<p>包括若干状态值：<code>pending</code>、<code>running</code>、<code>succeeded</code>、<code>failed</code>。</p>
<h4 id="pending"><a href="#pending">#</a> pending</h4>
<p>容器组已经被节点接受，但有一个或多个容器还没有运行起来。这将包含某些节点正在下载镜像的时间，这种情形会依赖于网络情况。</p>
<h4 id="running"><a href="#running">#</a> running</h4>
<p>容器组已经被调度到节点，并且所有的容器都已经启动。至少有一个容器处于运行状态（或者处于重启状态）。</p>
<h4 id="succeeded"><a href="#succeeded">#</a> succeeded</h4>
<p>所有的容器都正常退出。</p>
<h4 id="failed"><a href="#failed">#</a> failed</h4>
<p>容器组中所有容器都意外中断了。</p>
<h3 id="容器组生命周期"><a href="#%E5%AE%B9%E5%99%A8%E7%BB%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">#</a> 容器组生命周期</h3>
<p>通常来说，如果容器组被创建了就不会自动销毁，除非被某种行为触发，而触发此种情况可能是人为，或者复制控制器所为。唯一例外的是容器组由 succeeded 状态成功退出，或者在一定时间内重试多次依然失败。</p>
<p>如果某个节点死掉或者不能连接，那么节点控制器将会标记其上的容器组的状态为 <code>failed</code>。</p>
<p>举例如下。</p>
<ul>
<li>容器组状态 <code>running</code>，有 1 容器，容器正常退出
<ul>
<li>记录完成事件</li>
<li>如果重启策略为：
<ul>
<li>始终：重启容器，容器组保持 <code>running</code></li>
<li>失败时：容器组变为 <code>succeeded</code></li>
<li>从不：容器组变为 <code>succeeded</code></li>
</ul>
</li>
</ul>
</li>
<li>容器组状态 <code>running</code>，有1容器，容器异常退出
<ul>
<li>记录失败事件</li>
<li>如果重启策略为：
<ul>
<li>始终：重启容器，容器组保持 <code>running</code></li>
<li>失败时：重启容器，容器组保持 <code>running</code></li>
<li>从不：容器组变为 <code>failed</code></li>
</ul>
</li>
</ul>
</li>
<li>容器组状态 <code>running</code>，有2容器，有1容器异常退出
<ul>
<li>记录失败事件</li>
<li>如果重启策略为：
<ul>
<li>始终：重启容器，容器组保持 <code>running</code></li>
<li>失败时：重启容器，容器组保持 <code>running</code></li>
<li>从不：容器组保持 <code>running</code></li>
</ul>
</li>
<li>当有2容器退出
<ul>
<li>记录失败事件</li>
<li>如果重启策略为：
<ul>
<li>始终：重启容器，容器组保持 <code>running</code></li>
<li>失败时：重启容器，容器组保持 <code>running</code></li>
<li>从不：容器组变为 <code>failed</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>容器组状态 <code>running</code>，容器内存不足
<ul>
<li>标记容器错误中断</li>
<li>记录内存不足事件</li>
<li>如果重启策略为：
<ul>
<li>始终：重启容器，容器组保持 <code>running</code></li>
<li>失败时：重启容器，容器组保持 <code>running</code></li>
<li>从不：记录错误事件，容器组变为 <code>failed</code></li>
</ul>
</li>
</ul>
</li>
<li>容器组状态 <code>running</code>，一块磁盘死掉
<ul>
<li>杀死所有容器</li>
<li>记录事件</li>
<li>容器组变为 <code>failed</code></li>
<li>如果容器组运行在一个控制器下，容器组将会在其他地方重新创建</li>
</ul>
</li>
<li>容器组状态 <code>running</code>，对应的节点段溢出
<ul>
<li>节点控制器等到超时</li>
<li>节点控制器标记容器组 <code>failed</code></li>
<li>如果容器组运行在一个控制器下，容器组将会在其他地方重新创建</li>
</ul>
</li>
</ul>
<h2 id="Replication-Controllers"><a href="#replication-controllers">#</a> Replication Controllers</h2>
<h2 id="服务"><a href="#%E6%9C%8D%E5%8A%A1">#</a> 服务</h2>
<h2 id="卷"><a href="#%E5%8D%B7">#</a> 卷</h2>
<h2 id="标签"><a href="#%E6%A0%87%E7%AD%BE">#</a> 标签</h2>
<h2 id="接口权限"><a href="#%E6%8E%A5%E5%8F%A3%E6%9D%83%E9%99%90">#</a> 接口权限</h2>
<h2 id="web界面"><a href="#web%E7%95%8C%E9%9D%A2">#</a> web界面</h2>
<h2 id="命令行操作"><a href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%93%8D%E4%BD%9C">#</a> 命令行操作</h2>
<h2 id="基本架构"><a href="#%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84">#</a> 基本架构</h2>
<p>任何优秀的项目都离不开优秀的架构设计。本小节将介绍 Kubernetes 在架构方面的设计考虑。</p>
<h2 id="基本考虑"><a href="#%E5%9F%BA%E6%9C%AC%E8%80%83%E8%99%91">#</a> 基本考虑</h2>
<p>如果让我们自己从头设计一套容器管理平台，有如下几个方面是很容易想到的：</p>
<ul>
<li>分布式架构，保证扩展性；</li>
<li>逻辑集中式的控制平面 + 物理分布式的运行平面；</li>
<li>一套资源调度系统，管理哪个容器该分配到哪个节点上；</li>
<li>一套对容器内服务进行抽象和 HA 的系统。</li>
</ul>
<h2 id="运行原理"><a href="#%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86">#</a> 运行原理</h2>
<p>下面这张图完整展示了 Kubernetes 的运行原理。</p>
<p><img src="https://vuepress.mirror.docker-practice.com/assets/img/k8s_architecture.1cde0882.png" alt="Kubernetes 架构"></p>
<p>可见，Kubernetes 首先是一套分布式系统，由多个节点组成，节点分为两类：一类是属于管理平面的主节点/控制节点（Master Node）；一类是属于运行平面的工作节点（Worker Node）。</p>
<p>显然，复杂的工作肯定都交给控制节点去做了，工作节点负责提供稳定的操作接口和能力抽象即可。</p>
<p>从这张图上，我们没有能发现 Kubernetes 中对于控制平面的分布式实现，但是由于数据后端自身就是一套分布式的数据库 Etcd，因此可以很容易扩展到分布式实现。</p>
<h2 id="控制平面"><a href="#%E6%8E%A7%E5%88%B6%E5%B9%B3%E9%9D%A2">#</a> 控制平面</h2>
<h3 id="主节点服务"><a href="#%E4%B8%BB%E8%8A%82%E7%82%B9%E6%9C%8D%E5%8A%A1">#</a> 主节点服务</h3>
<p>主节点上需要提供如下的管理服务：</p>
<ul>
<li><code>apiserver</code> 是整个系统的对外接口，提供一套 RESTful 的 <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/overview/kubernetes-api/">Kubernetes API (opens new window)</a>，供客户端和其它组件调用；</li>
<li><code>scheduler</code> 负责对资源进行调度，分配某个 pod 到某个节点上。是 pluggable 的，意味着很容易选择其它实现方式；</li>
<li><code>controller-manager</code> 负责管理控制器，包括 endpoint-controller（刷新服务和 pod 的关联信息）和 replication-controller（维护某个 pod 的复制为配置的数值）。</li>
</ul>
<h3 id="Etcd"><a href="#etcd">#</a> Etcd</h3>
<p>这里 Etcd 即作为数据后端，又作为消息中间件。</p>
<p>通过 Etcd 来存储所有的主节点上的状态信息，很容易实现主节点的分布式扩展。</p>
<p>组件可以自动的去侦测 Etcd 中的数值变化来获得通知，并且获得更新后的数据来执行相应的操作。</p>
<h2 id="工作节点"><a href="#%E5%B7%A5%E4%BD%9C%E8%8A%82%E7%82%B9">#</a> 工作节点</h2>
<ul>
<li>kubelet 是工作节点执行操作的 agent，负责具体的容器生命周期管理，根据从数据库中获取的信息来管理容器，并上报 pod 运行状态等；</li>
<li>kube-proxy 是一个简单的网络访问代理，同时也是一个 Load Balancer。它负责将访问到某个服务的请求具体分配给工作节点上的 Pod（同一类标签）。</li>
</ul>
<p><img src="https://vuepress.mirror.docker-practice.com/assets/img/kube-proxy.e356ec8f.png" alt="Proxy 代理对服务的请求"></p>
<p><a target="_blank" rel="noopener" href="https://vuepress.mirror.docker-practice.com/">Docker 从入门到实践</a></p>
<p><a target="_blank" rel="noopener" href="https://docker_practice.gitee.io/pic/dpsig-wechat.jpg">微信交流群 (opens new window)</a></p>
<p><a target="_blank" rel="noopener" href="https://docker_practice.gitee.io/pic/dp-wechat-miniprogram.jpg">小程序 (opens new window)</a></p>
<p><a target="_blank" rel="noopener" href="https://vuepress.mirror.docker-practice.com/install/">安装 Docker</a></p>
<p><a target="_blank" rel="noopener" href="https://vuepress.mirror.docker-practice.com/">Docker 入门</a></p>
<p><a target="_blank" rel="noopener" href="https://vuepress.mirror.docker-practice.com/cases/os/">Docker 实战</a></p>
<p><a target="_blank" rel="noopener" href="https://vuepress.mirror.docker-practice.com/cases/ci/">CI/CD</a></p>
<p><a target="_blank" rel="noopener" href="https://vuepress.mirror.docker-practice.com/compose/">Compose</a></p>
<p><a target="_blank" rel="noopener" href="https://vuepress.mirror.docker-practice.com/kubernetes/">Kubernetes</a></p>
<p><a target="_blank" rel="noopener" href="https://vuepress.mirror.docker-practice.com/cloud/">云计算</a></p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/act/cps/redirect?redirect=1062&amp;cps_key=3a5255852d5db99dcd5da4c72f05df61&amp;from=console">云服务器99/元首年特惠 (opens new window)</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/yeasy/docker_practice">GitHub (opens new window)</a></p>
<ol>
<li><a target="_blank" rel="noopener" href="https://vuepress.mirror.docker-practice.com/kubernetes/">Kubernetes</a></li>
<li><a target="_blank" rel="noopener" href="https://vuepress.mirror.docker-practice.com/kubernetes/setup/">部署 Kubernetes</a></li>
</ol>
<h2 id="部署-Kubernetes">部署 Kubernetes</h2>
<p>小于 1 分钟 约 102 字</p>
<hr>
<h2 id="部署-Kubernetes-2"><a href="#%E9%83%A8%E7%BD%B2-kubernetes">#</a> 部署 Kubernetes</h2>
<p>目前，Kubernetes 支持在多种环境下使用，包括本地主机（Ubuntu、Debian、CentOS、Fedora 等）、云服务（<a target="_blank" rel="noopener" href="https://cloud.tencent.com/act/cps/redirect?redirect=10058&amp;cps_key=3a5255852d5db99dcd5da4c72f05df61">腾讯云 (opens new window)</a>、<a target="_blank" rel="noopener" href="https://www.aliyun.com/product/kubernetes?source=5176.11533457&amp;userCode=8lx5zmtu&amp;type=copy">阿里云 (opens new window)</a>、<a target="_blank" rel="noopener" href="https://cloud.baidu.com/product/cce.html">百度云 (opens new window)</a> 等）。</p>
<p>你可以使用以下几种方式部署 Kubernetes：</p>
<ul>
<li>kubeadm</li>
<li>docker-desktop</li>
<li>k3s</li>
</ul>
<p>接下来的小节会对以上几种方式进行详细介绍。</p>
<p><a target="_blank" rel="noopener" href="https://vuepress.mirror.docker-practice.com/kubernetes/design/">基本架构</a> <a target="_blank" rel="noopener" href="https://vuepress.mirror.docker-practice.com/kubernetes/setup/kubeadm/">使用 kubeadm 部署 kubernetes(CRI 使用 containerd)</a></p>
<h2 id="使用-kubeadm-部署-kubernetes-CRI-使用-containerd"><a href="#%E4%BD%BF%E7%94%A8-kubeadm-%E9%83%A8%E7%BD%B2-kubernetes-cri-%E4%BD%BF%E7%94%A8-containerd">#</a> 使用 kubeadm 部署 kubernetes(CRI 使用 containerd)</h2>
<p><code>kubeadm</code> 提供了 <code>kubeadm init</code> 以及 <code>kubeadm join</code> 这两个命令作为快速创建 <code>kubernetes</code> 集群的最佳实践。</p>
<h2 id="安装-containerd"><a href="#%E5%AE%89%E8%A3%85-containerd">#</a> 安装 containerd</h2>
<p>参考 <a target="_blank" rel="noopener" href="https://vuepress.mirror.docker-practice.com/kubernetes/install">安装 Docker</a> 一节添加 apt/yum 源，之后执行如下命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># debian 系</span></span><br><span class="line">$ <span class="built_in">sudo</span> apt install containerd.io</span><br><span class="line"></span><br><span class="line"><span class="comment"># rhel 系</span></span><br><span class="line">$ <span class="built_in">sudo</span> yum install containerd.io</span><br></pre></td></tr></table></figure>
<h2 id="配置-containerd"><a href="#%E9%85%8D%E7%BD%AE-containerd">#</a> 配置 containerd</h2>
<p>新建 <code>/etc/systemd/system/cri-containerd.service</code> 文件</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=containerd container runtime for kubernetes</span><br><span class="line">Documentation=https://containerd.io</span><br><span class="line">After=network.target local-fs.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStartPre=-/sbin/modprobe overlay</span><br><span class="line">ExecStart=/usr/bin/containerd --config //etc/cri-containerd/config.toml</span><br><span class="line"></span><br><span class="line">Type=notify</span><br><span class="line">Delegate=yes</span><br><span class="line">KillMode=process</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=5</span><br><span class="line"># Having non-zero Limit*s causes performance problems due to accounting overhead</span><br><span class="line"># in the kernel. We recommend using cgroups to do container-local accounting.</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line"># Comment TasksMax if your systemd version does not supports it.</span><br><span class="line"># Only systemd 226 and above support this version.</span><br><span class="line">TasksMax=infinity</span><br><span class="line">OOMScoreAdjust=-999</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<p>新建 <code>/etc/cri-containerd/config.toml</code> containerd 配置文件</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version</span> = <span class="number">2</span></span><br><span class="line"><span class="comment"># persistent data location</span></span><br><span class="line"><span class="attr">root</span> = <span class="string">&quot;/var/lib/cri-containerd&quot;</span></span><br><span class="line"><span class="comment"># runtime state information</span></span><br><span class="line"><span class="attr">state</span> = <span class="string">&quot;/run/cri-containerd&quot;</span></span><br><span class="line"><span class="attr">plugin_dir</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">disabled_plugins</span> = []</span><br><span class="line"><span class="attr">required_plugins</span> = []</span><br><span class="line"><span class="comment"># set containerd&#x27;s OOM score</span></span><br><span class="line"><span class="attr">oom_score</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="section">[grpc]</span></span><br><span class="line">  <span class="attr">address</span> = <span class="string">&quot;/run/cri-containerd/cri-containerd.sock&quot;</span></span><br><span class="line">  <span class="attr">tcp_address</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">tcp_tls_cert</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">tcp_tls_key</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="comment"># socket uid</span></span><br><span class="line">  <span class="attr">uid</span> = <span class="number">0</span></span><br><span class="line">  <span class="comment"># socket gid</span></span><br><span class="line">  <span class="attr">gid</span> = <span class="number">0</span></span><br><span class="line">  <span class="attr">max_recv_message_size</span> = <span class="number">16777216</span></span><br><span class="line">  <span class="attr">max_send_message_size</span> = <span class="number">16777216</span></span><br><span class="line"></span><br><span class="line"><span class="section">[debug]</span></span><br><span class="line">  <span class="attr">address</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">format</span> = <span class="string">&quot;json&quot;</span></span><br><span class="line">  <span class="attr">uid</span> = <span class="number">0</span></span><br><span class="line">  <span class="attr">gid</span> = <span class="number">0</span></span><br><span class="line">  <span class="attr">level</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[metrics]</span></span><br><span class="line">  <span class="attr">address</span> = <span class="string">&quot;127.0.0.1:1338&quot;</span></span><br><span class="line">  <span class="attr">grpc_histogram</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="section">[cgroup]</span></span><br><span class="line">  <span class="attr">path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[timeouts]</span></span><br><span class="line">  <span class="attr">&quot;io.containerd.timeout.shim.cleanup&quot;</span> = <span class="string">&quot;5s&quot;</span></span><br><span class="line">  <span class="attr">&quot;io.containerd.timeout.shim.load&quot;</span> = <span class="string">&quot;5s&quot;</span></span><br><span class="line">  <span class="attr">&quot;io.containerd.timeout.shim.shutdown&quot;</span> = <span class="string">&quot;3s&quot;</span></span><br><span class="line">  <span class="attr">&quot;io.containerd.timeout.task.state&quot;</span> = <span class="string">&quot;2s&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[plugins]</span></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.gc.v1.scheduler&quot;]</span></span><br><span class="line">    <span class="attr">pause_threshold</span> = <span class="number">0.02</span></span><br><span class="line">    <span class="attr">deletion_threshold</span> = <span class="number">0</span></span><br><span class="line">    <span class="attr">mutation_threshold</span> = <span class="number">100</span></span><br><span class="line">    <span class="attr">schedule_delay</span> = <span class="string">&quot;0s&quot;</span></span><br><span class="line">    <span class="attr">startup_delay</span> = <span class="string">&quot;100ms&quot;</span></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;]</span></span><br><span class="line">    <span class="attr">disable_tcp_service</span> = <span class="literal">true</span></span><br><span class="line">    <span class="attr">stream_server_address</span> = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">    <span class="attr">stream_server_port</span> = <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="attr">stream_idle_timeout</span> = <span class="string">&quot;4h0m0s&quot;</span></span><br><span class="line">    <span class="attr">enable_selinux</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">selinux_category_range</span> = <span class="number">1024</span></span><br><span class="line">    <span class="attr">sandbox_image</span> = <span class="string">&quot;registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.5&quot;</span></span><br><span class="line">    <span class="attr">stats_collect_period</span> = <span class="number">10</span></span><br><span class="line">    <span class="comment"># systemd_cgroup = false</span></span><br><span class="line">    <span class="attr">enable_tls_streaming</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">max_container_log_line_size</span> = <span class="number">16384</span></span><br><span class="line">    <span class="attr">disable_cgroup</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">disable_apparmor</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">restrict_oom_score_adj</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">max_concurrent_downloads</span> = <span class="number">3</span></span><br><span class="line">    <span class="attr">disable_proc_mount</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">unset_seccomp_profile</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">tolerate_missing_hugetlb_controller</span> = <span class="literal">true</span></span><br><span class="line">    <span class="attr">disable_hugetlb_controller</span> = <span class="literal">true</span></span><br><span class="line">    <span class="attr">ignore_image_defined_volumes</span> = <span class="literal">false</span></span><br><span class="line">    <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd]</span></span><br><span class="line">      <span class="attr">snapshotter</span> = <span class="string">&quot;overlayfs&quot;</span></span><br><span class="line">      <span class="attr">default_runtime_name</span> = <span class="string">&quot;runc&quot;</span></span><br><span class="line">      <span class="attr">no_pivot</span> = <span class="literal">false</span></span><br><span class="line">      <span class="attr">disable_snapshot_annotations</span> = <span class="literal">false</span></span><br><span class="line">      <span class="attr">discard_unpacked_layers</span> = <span class="literal">false</span></span><br><span class="line">      <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes]</span></span><br><span class="line">        <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc]</span></span><br><span class="line">          <span class="attr">runtime_type</span> = <span class="string">&quot;io.containerd.runc.v2&quot;</span></span><br><span class="line">          <span class="attr">pod_annotations</span> = []</span><br><span class="line">          <span class="attr">container_annotations</span> = []</span><br><span class="line">          <span class="attr">privileged_without_host_devices</span> = <span class="literal">false</span></span><br><span class="line">          <span class="attr">base_runtime_spec</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">          <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options]</span></span><br><span class="line">            <span class="comment"># SystemdCgroup enables systemd cgroups.</span></span><br><span class="line">            <span class="attr">SystemdCgroup</span> = <span class="literal">true</span></span><br><span class="line">            <span class="comment"># BinaryName is the binary name of the runc binary.</span></span><br><span class="line">            <span class="comment"># BinaryName = &quot;runc&quot;</span></span><br><span class="line">            <span class="comment"># BinaryName = &quot;crun&quot;</span></span><br><span class="line">            <span class="comment"># NoPivotRoot disables pivot root when creating a container.</span></span><br><span class="line">            <span class="comment"># NoPivotRoot = false</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># NoNewKeyring disables new keyring for the container.</span></span><br><span class="line">            <span class="comment"># NoNewKeyring = false</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># ShimCgroup places the shim in a cgroup.</span></span><br><span class="line">            <span class="comment"># ShimCgroup = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># IoUid sets the I/O&#x27;s pipes uid.</span></span><br><span class="line">            <span class="comment"># IoUid = 0</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># IoGid sets the I/O&#x27;s pipes gid.</span></span><br><span class="line">            <span class="comment"># IoGid = 0</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Root is the runc root directory.</span></span><br><span class="line">            <span class="attr">Root</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># CriuPath is the criu binary path.</span></span><br><span class="line">            <span class="comment"># CriuPath = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># CriuImagePath is the criu image path</span></span><br><span class="line">            <span class="comment"># CriuImagePath = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># CriuWorkPath is the criu work path.</span></span><br><span class="line">            <span class="comment"># CriuWorkPath = &quot;&quot;</span></span><br><span class="line">    <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.cni]</span></span><br><span class="line">      <span class="attr">bin_dir</span> = <span class="string">&quot;/opt/cni/bin&quot;</span></span><br><span class="line">      <span class="attr">conf_dir</span> = <span class="string">&quot;/etc/cni/net.d&quot;</span></span><br><span class="line">      <span class="attr">max_conf_num</span> = <span class="number">1</span></span><br><span class="line">      <span class="attr">conf_template</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry]</span></span><br><span class="line">      <span class="attr">config_path</span> = <span class="string">&quot;/etc/cri-containerd/certs.d&quot;</span></span><br><span class="line">      <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.headers]</span></span><br><span class="line">        <span class="comment"># Foo = [&quot;bar&quot;]</span></span><br><span class="line">    <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.image_decryption]</span></span><br><span class="line">      <span class="attr">key_model</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.x509_key_pair_streaming]</span></span><br><span class="line">      <span class="attr">tls_cert_file</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="attr">tls_key_file</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.internal.v1.opt&quot;]</span></span><br><span class="line">    <span class="attr">path</span> = <span class="string">&quot;/opt/cri-containerd&quot;</span></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.internal.v1.restart&quot;]</span></span><br><span class="line">    <span class="attr">interval</span> = <span class="string">&quot;10s&quot;</span></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.metadata.v1.bolt&quot;]</span></span><br><span class="line">    <span class="attr">content_sharing_policy</span> = <span class="string">&quot;shared&quot;</span></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.monitor.v1.cgroups&quot;]</span></span><br><span class="line">    <span class="attr">no_prometheus</span> = <span class="literal">false</span></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.runtime.v2.task&quot;]</span></span><br><span class="line">    <span class="attr">platforms</span> = [<span class="string">&quot;linux/amd64&quot;</span>]</span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.service.v1.diff-service&quot;]</span></span><br><span class="line">    <span class="attr">default</span> = [<span class="string">&quot;walking&quot;</span>]</span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.snapshotter.v1.devmapper&quot;]</span></span><br><span class="line">    <span class="attr">root_path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">pool_name</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">base_image_size</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">async_remove</span> = <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<h2 id="安装-kubelet-kubeadm-kubectl-cri-tools-kubernetes-cni"><a href="#%E5%AE%89%E8%A3%85-kubelet-kubeadm-kubectl-cri-tools-kubernetes-cni">#</a> 安装 <strong>kubelet</strong> <strong>kubeadm</strong> <strong>kubectl</strong> <strong>cri-tools</strong> <strong>kubernetes-cni</strong></h2>
<h3 id="Ubuntu-Debian"><a href="#ubuntu-debian">#</a> Ubuntu/Debian</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get update &amp;&amp; apt-get install -y apt-transport-https</span><br><span class="line">$ curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add -</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/apt/sources.list.d/kubernetes.list</span></span><br><span class="line"><span class="string">deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">$ apt-get update</span><br><span class="line">$ apt-get install -y kubelet kubeadm kubectl</span><br></pre></td></tr></table></figure>
<h3 id="CentOS-Fedora"><a href="#centos-fedora">#</a> CentOS/Fedora</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/yum.repos.d/kubernetes.repo</span></span><br><span class="line"><span class="string">[kubernetes]</span></span><br><span class="line"><span class="string">name=Kubernetes</span></span><br><span class="line"><span class="string">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">repo_gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">sudo</span> yum install -y kubelet kubeadm kubectl</span><br></pre></td></tr></table></figure>
<h2 id="修改内核的运行参数"><a href="#%E4%BF%AE%E6%94%B9%E5%86%85%E6%A0%B8%E7%9A%84%E8%BF%90%E8%A1%8C%E5%8F%82%E6%95%B0">#</a> 修改内核的运行参数</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables  = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward                 = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用配置</span></span><br><span class="line">$ sysctl --system</span><br></pre></td></tr></table></figure>
<h2 id="配置-kubelet"><a href="#%E9%85%8D%E7%BD%AE-kubelet">#</a> 配置 kubelet</h2>
<h3 id="修改-kubelet-service"><a href="#%E4%BF%AE%E6%94%B9-kubelet-service">#</a> 修改 <code>kubelet.service</code></h3>
<p><code>/etc/systemd/system/kubelet.service.d/10-proxy-ipvs.conf</code> 写入以下内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启用 ipvs 相关内核模块</span></span><br><span class="line">[Service]</span><br><span class="line">ExecStartPre=-/sbin/modprobe ip_vs</span><br><span class="line">ExecStartPre=-/sbin/modprobe ip_vs_rr</span><br><span class="line">ExecStartPre=-/sbin/modprobe ip_vs_wrr</span><br><span class="line">ExecStartPre=-/sbin/modprobe ip_vs_sh</span><br></pre></td></tr></table></figure>
<p>执行以下命令应用配置。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> systemctl daemon-reload</span><br></pre></td></tr></table></figure>
<h2 id="部署"><a href="#%E9%83%A8%E7%BD%B2">#</a> 部署</h2>
<h3 id="master"><a href="#master">#</a> master</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl <span class="built_in">enable</span> cri-containerd</span><br><span class="line"></span><br><span class="line">$ systemctl start cri-containerd</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">sudo</span> kubeadm init \</span><br><span class="line">      --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers \</span><br><span class="line">      --pod-network-cidr 10.244.0.0/16 \</span><br><span class="line">      --cri-socket /run/cri-containerd/cri-containerd.sock \</span><br><span class="line">      --v 5 \</span><br><span class="line">      --ignore-preflight-errors=all</span><br></pre></td></tr></table></figure>
<ul>
<li><code>--pod-network-cidr 10.244.0.0/16</code> 参数与后续 CNI 插件有关，这里以 <code>flannel</code> 为例，若后续部署其他类型的网络插件请更改此参数。</li>
</ul>
<blockquote>
<p>执行可能出现错误，例如缺少依赖包，根据提示安装即可。</p>
</blockquote>
<p>执行成功会输出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">[addons] Applied essential addon: CoreDNS</span><br><span class="line">I1116 12:35:13.270407   86677 request.go:538] Throttling request took 181.409184ms, request: POST:https://192.168.199.100:6443/api/v1/namespaces/kube-system/serviceaccounts</span><br><span class="line">I1116 12:35:13.470292   86677 request.go:538] Throttling request took 186.088112ms, request: POST:https://192.168.199.100:6443/api/v1/namespaces/kube-system/configmaps</span><br><span class="line">[addons] Applied essential addon: kube-proxy</span><br><span class="line"></span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line"></span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line"></span><br><span class="line">  <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">  <span class="built_in">sudo</span> <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">  <span class="built_in">sudo</span> <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run <span class="string">&quot;kubectl apply -f [podnetwork].yaml&quot;</span> with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line"></span><br><span class="line">Then you can <span class="built_in">join</span> any number of worker nodes by running the following on each as root:</span><br><span class="line"></span><br><span class="line">kubeadm <span class="built_in">join</span> 192.168.199.100:6443 --token cz81zt.orsy9gm9v649e5lf \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:5edb316fd0d8ea2792cba15cdf1c899a366f147aa03cba52d4e5c5884ad836fe</span><br></pre></td></tr></table></figure>
<h3 id="node-工作节点"><a href="#node-%E5%B7%A5%E4%BD%9C%E8%8A%82%E7%82%B9">#</a> node 工作节点</h3>
<p>在 <strong>另一主机</strong> 重复 <strong>部署</strong> 小节以前的步骤，安装配置好 kubelet。根据提示，加入到集群。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl <span class="built_in">enable</span> cri-containerd</span><br><span class="line"></span><br><span class="line">$ systemctl start cri-containerd</span><br><span class="line"></span><br><span class="line">$ kubeadm <span class="built_in">join</span> 192.168.199.100:6443 \</span><br><span class="line">    --token cz81zt.orsy9gm9v649e5lf \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:5edb316fd0d8ea2792cba15cdf1c899a366f147aa03cba52d4e5c5884ad836fe \</span><br><span class="line">    --cri-socket /run/cri-containerd/cri-containerd.sock</span><br></pre></td></tr></table></figure>
<h2 id="查看服务"><a href="#%E6%9F%A5%E7%9C%8B%E6%9C%8D%E5%8A%A1">#</a> 查看服务</h2>
<p>所有服务启动后，通过 <code>crictl</code> 查看本地实际运行的容器。这些服务大概分为三类：主节点服务、工作节点服务和其它服务。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONTAINER_RUNTIME_ENDPOINT=/run/cri-containerd/cri-containerd.sock crictl ps -a</span><br></pre></td></tr></table></figure>
<h3 id="主节点服务-2"><a href="#%E4%B8%BB%E8%8A%82%E7%82%B9%E6%9C%8D%E5%8A%A1">#</a> 主节点服务</h3>
<ul>
<li>
<p><code>apiserver</code> 是整个系统的对外接口，提供 RESTful 方式供客户端和其它组件调用；</p>
</li>
<li>
<p><code>scheduler</code> 负责对资源进行调度，分配某个 pod 到某个节点上；</p>
</li>
<li>
<p><code>controller-manager</code> 负责管理控制器，包括 endpoint-controller（刷新服务和 pod 的关联信息）和 replication-controller（维护某个 pod 的复制为配置的数值）。</p>
</li>
</ul>
<h3 id="工作节点服务"><a href="#%E5%B7%A5%E4%BD%9C%E8%8A%82%E7%82%B9%E6%9C%8D%E5%8A%A1">#</a> 工作节点服务</h3>
<ul>
<li><code>proxy</code> 为 pod 上的服务提供访问的代理。</li>
</ul>
<h3 id="其它服务"><a href="#%E5%85%B6%E5%AE%83%E6%9C%8D%E5%8A%A1">#</a> 其它服务</h3>
<ul>
<li>Etcd 是所有状态的存储数据库；</li>
</ul>
<h2 id="使用"><a href="#%E4%BD%BF%E7%94%A8">#</a> 使用</h2>
<p>将 <code>/etc/kubernetes/admin.conf</code> 复制到 <code>~/.kube/config</code></p>
<p>执行 <code>$ kubectl get all -A</code> 查看启动的服务。</p>
<p>由于未部署 CNI 插件，CoreDNS 未正常启动。如何使用 Kubernetes，请参考后续章节。</p>
<h2 id="部署-CNI"><a href="#%E9%83%A8%E7%BD%B2-cni">#</a> 部署 CNI</h2>
<p>这里以 <code>flannel</code> 为例进行介绍。</p>
<h3 id="flannel"><a href="#flannel">#</a> flannel</h3>
<p>检查 podCIDR 设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get node -o yaml | grep CIDR</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">    podCIDR: 10.244.0.0/16</span><br><span class="line">    podCIDRs:</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/v0.11.0/Documentation/kube-flannel.yml</span><br></pre></td></tr></table></figure>
<h2 id="master-节点默认不能运行-pod"><a href="#master-%E8%8A%82%E7%82%B9%E9%BB%98%E8%AE%A4%E4%B8%8D%E8%83%BD%E8%BF%90%E8%A1%8C-pod">#</a> master 节点默认不能运行 pod</h2>
<p>如果用 <code>kubeadm</code> 部署一个单节点集群，默认情况下无法使用，请执行以下命令解除限制</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl taint nodes --all node-role.kubernetes.io/master-</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复默认值</span></span><br><span class="line"><span class="comment"># $ kubectl taint nodes NODE_NAME node-role.kubernetes.io/master=true:NoSchedule</span></span><br></pre></td></tr></table></figure>
<h2 id="参考文档"><a href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3">#</a> 参考文档</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">官方文档 (opens new window)</a></li>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/setup/production-environment/container-runtimes/#containerd">Container runtimes (opens new window)</a></li>
</ul>
<h2 id="Docker-Desktop-启用-Kubernetes"><a href="#docker-desktop-%E5%90%AF%E7%94%A8-kubernetes">#</a> Docker Desktop 启用 Kubernetes</h2>
<p>使用 Docker Desktop 可以很方便的启用 Kubernetes，由于国内获取不到 <code>k8s.gcr.io</code> 镜像，我们必须首先解决这一问题。</p>
<h2 id="获取-k8s-gcr-io-镜像"><a href="#%E8%8E%B7%E5%8F%96-k8s-gcr-io-%E9%95%9C%E5%83%8F">#</a> 获取 <code>k8s.gcr.io</code> 镜像</h2>
<p>由于国内拉取不到 <code>k8s.gcr.io</code> 镜像，我们可以使用开源项目 <a target="_blank" rel="noopener" href="https://github.com/AliyunContainerService/k8s-for-docker-desktop">AliyunContainerService/k8s-for-docker-desktop (opens new window)</a> 来获取所需的镜像。</p>
<h2 id="启用-Kubernetes"><a href="#%E5%90%AF%E7%94%A8-kubernetes">#</a> 启用 Kubernetes</h2>
<p>在 Docker Desktop 设置页面，点击 <code>Kubernetes</code>，选择 <code>Enable Kubernetes</code>，稍等片刻，看到左下方 <code>Kubernetes</code> 变为 <code>running</code>，Kubernetes 启动成功。</p>
<p><img src="https://github.com/AliyunContainerService/k8s-for-docker-desktop/raw/master/images/k8s.png" alt=""></p>
<h2 id="测试"><a href="#%E6%B5%8B%E8%AF%95">#</a> 测试</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl version</span><br></pre></td></tr></table></figure>
<p>如果正常输出信息，则证明 Kubernetes 成功启动。</p>
<h2 id="Kubernetes-Dashboard"><a href="#kubernetes-dashboard">#</a> Kubernetes Dashboard</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/kubernetes/dashboard">Kubernetes Dashboard (opens new window)</a> 是基于网页的 Kubernetes 用户界面。</p>
<p><img src="https://d33wubrfki0l68.cloudfront.net/349824f68836152722dab89465835e604719caea/6e0b7/images/docs/ui-dashboard.png" alt=""></p>
<h2 id="部署-2"><a href="#%E9%83%A8%E7%BD%B2">#</a> 部署</h2>
<p>执行以下命令即可部署 Dashboard：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml</span><br></pre></td></tr></table></figure>
<h2 id="访问"><a href="#%E8%AE%BF%E9%97%AE">#</a> 访问</h2>
<p>通过命令行代理访问，执行以下命令：</p>
<p>到 <a target="_blank" rel="noopener" href="http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/">http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/</a> 即可访问。</p>
<h2 id="登录"><a href="#%E7%99%BB%E5%BD%95">#</a> 登录</h2>
<p>目前，Dashboard 仅支持使用 Bearer 令牌登录。下面教大家如何创建该令牌：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create sa dashboard-admin -n kube-system</span><br><span class="line"></span><br><span class="line">$ kubectl create clusterrolebinding dashboard-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashboard-admin</span><br><span class="line"></span><br><span class="line">$ ADMIN_SECRET=$(kubectl get secrets -n kube-system | grep dashboard-admin | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">$ DASHBOARD_LOGIN_TOKEN=$(kubectl describe secret -n kube-system <span class="variable">$&#123;ADMIN_SECRET&#125;</span> | grep -E <span class="string">&#x27;^token&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;DASHBOARD_LOGIN_TOKEN&#125;</span></span><br></pre></td></tr></table></figure>
<p>将结果粘贴到登录页面，即可登录。</p>
<h2 id="参考文档-2"><a href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3">#</a> 参考文档</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/tasks/access-application-cluster/web-ui-dashboard/">官方文档 (opens new window)</a></li>
</ul>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">標籤</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="../../../../../tags/Docker/" rel="tag">Docker</a> <a class="tag tag--primary tag--small t-none-link" href="../../../../../tags/Kubernetes/" rel="tag">Kubernetes</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="../../../21/docker/Docker%20Compose/"
                    data-tooltip="Docker Compose"
                    aria-label="上一篇: Docker Compose"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="../../../19/docker/18.%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95%20Docker(Docker%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B)/"
                    data-tooltip="18.如何调试 Docker(Docker详细教程)"
                    aria-label="下一篇: 18.如何调试 Docker(Docker详细教程)"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://keinchan.com/2018/04/20/docker/Kubernetes/"
                    title="分享到 Facebook"
                    aria-label="分享到 Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://keinchan.com/2018/04/20/docker/Kubernetes/"
                    title="分享到 Twitter"
                    aria-label="分享到 Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://keinchan.com/2018/04/20/docker/Kubernetes/"
                    title="global.share_on_linkedin"
                    aria-label="global.share_on_linkedin"
                >
                    <i class="fab fa-linkedin" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://service.weibo.com/share/share.php?&amp;title=https://keinchan.com/2018/04/20/docker/Kubernetes/"
                    title="分享到 Weibo"
                    aria-label="分享到 Weibo"
                >
                    <i class="fab fa-weibo" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Kein Chan. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="../../../21/docker/Docker%20Compose/"
                    data-tooltip="Docker Compose"
                    aria-label="上一篇: Docker Compose"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="../../../19/docker/18.%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95%20Docker(Docker%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B)/"
                    data-tooltip="18.如何调试 Docker(Docker详细教程)"
                    aria-label="下一篇: 18.如何调试 Docker(Docker详细教程)"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://keinchan.com/2018/04/20/docker/Kubernetes/"
                    title="分享到 Facebook"
                    aria-label="分享到 Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://keinchan.com/2018/04/20/docker/Kubernetes/"
                    title="分享到 Twitter"
                    aria-label="分享到 Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://keinchan.com/2018/04/20/docker/Kubernetes/"
                    title="global.share_on_linkedin"
                    aria-label="global.share_on_linkedin"
                >
                    <i class="fab fa-linkedin" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://service.weibo.com/share/share.php?&amp;title=https://keinchan.com/2018/04/20/docker/Kubernetes/"
                    title="分享到 Weibo"
                    aria-label="分享到 Weibo"
                >
                    <i class="fab fa-weibo" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="4">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://keinchan.com/2018/04/20/docker/Kubernetes/"
                        aria-label="分享到 Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>分享到 Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://keinchan.com/2018/04/20/docker/Kubernetes/"
                        aria-label="分享到 Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>分享到 Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://keinchan.com/2018/04/20/docker/Kubernetes/"
                        aria-label="global.share_on_linkedin"
                    >
                        <i class="fab fa-linkedin" aria-hidden="true"></i><span>global.share_on_linkedin</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="http://service.weibo.com/share/share.php?&amp;title=https://keinchan.com/2018/04/20/docker/Kubernetes/"
                        aria-label="分享到 Weibo"
                    >
                        <i class="fab fa-weibo" aria-hidden="true"></i><span>分享到 Weibo</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="../../../../../assets/images/profile.jpg" alt="作者的圖片"/>
        
            <h4 id="about-card-name">Kein Chan</h4>
        
            <div id="about-card-bio"><p>這是獨立全棧工程師Kein Chan的技術博客</br>分享一些技術教程,命令備忘(cheat-sheet)等</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>全棧工程師</br>資深技術顧問</br>數據科學家</br>Hit廣島觀光大使</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Tokyo/Macau
            </div>
        
    </div>
</div>

        
            <div id="algolia-search-modal" class="modal-container">
    <div class="modal">
        <div class="modal-header">
            <span class="close-button"><i class="fa fa-times"></i></span>
            <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
                <span class="searchby-algolia-text text-color-light text-small">by</span>
                <img class="searchby-algolia-logo" src="../assets/images/logo-algolia-nebula-blue-full.svg">
            </a>
            <i class="search-icon fa fa-search"></i>
            <form id="algolia-search-form">
                <input type="text" id="algolia-search-input" name="search"
                    class="form-control input--large search-input" placeholder="Search "
                    />
            </form>
        </div>
        <div class="modal-body">
            <div class="no-result text-color-light text-center">沒有找到文章</div>
            <div class="results">
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://keinchan.com/2013/04/27/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/"
                            aria-label=": R语言-环境安装"
                        >
                            <h3 class="media-heading">R语言-环境安装</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年4月27日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://keinchan.com/2013/04/28/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E5%9F%BA%E7%A1%80/"
                            aria-label=": R语言-基础"
                        >
                            <h3 class="media-heading">R语言-基础</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年4月28日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://keinchan.com/2013/05/01/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE/"
                            aria-label=": R语言-读取数据"
                        >
                            <h3 class="media-heading">R语言-读取数据</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月1日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://keinchan.com/2013/05/02/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E7%BB%98%E5%9B%BE/"
                            aria-label=": R语言-绘图"
                        >
                            <h3 class="media-heading">R语言-绘图</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月2日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://keinchan.com/2013/05/03/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/"
                            aria-label=": R语言-线性回归"
                        >
                            <h3 class="media-heading">R语言-线性回归</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月3日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://keinchan.com/2015/02/22/Algorithms/1.%E7%AE%97%E6%B3%95%E5%9C%A8%E8%AE%A1%E7%AE%97%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8/"
                            aria-label=": 1. 算法在计算中的作用"
                        >
                            <h3 class="media-heading">1. 算法在计算中的作用</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月22日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://keinchan.com/2015/02/23/Algorithms/2.%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80/"
                            aria-label=": 2. 算法基础"
                        >
                            <h3 class="media-heading">2. 算法基础</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月23日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://keinchan.com/2015/02/24/Algorithms/3.%E5%87%BD%E6%95%B0%E7%9A%84%E5%A2%9E%E9%95%BF/"
                            aria-label=": 3. 函数的增长"
                        >
                            <h3 class="media-heading">3. 函数的增长</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月24日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://keinchan.com/2015/02/25/Algorithms/4.%E5%88%86%E6%B2%BB%E7%AD%96%E7%95%A5/"
                            aria-label=": 4. 分治策略"
                        >
                            <h3 class="media-heading">4. 分治策略</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月25日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://keinchan.com/2015/02/26/Algorithms/5.%E6%A6%82%E7%8E%87%E5%88%86%E6%9E%90%E5%92%8C%E9%9A%8F%E6%9C%BA%E7%AE%97%E6%B3%95/"
                            aria-label=": 5. 概率分析和随机算法"
                        >
                            <h3 class="media-heading">5. 概率分析和随机算法</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月26日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <p class="results-count text-medium"
                data-message-zero="沒有找到文章"
                data-message-one="找到 1 篇文章"
                data-message-other="找到 {n} 篇文章">
                找到 234 篇文章
            </p>
        </div>
    </div>
</div>

        
        
<div id="cover" style="background-image:url('../../../../../assets/images/cover.jpeg');"></div>
        <!--SCRIPTS-->

<script src="../../../../../assets/js/script-qtzvvb63gamuirvfphht7lytrxkfllzng1escnm2phjtlt4tvvxi5gl0wx4o.min.js"></script>

<!--SCRIPTS END-->


    




    </body>
</html>

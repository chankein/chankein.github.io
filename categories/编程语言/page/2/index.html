
<!DOCTYPE html>
<html lang="zh-tw">
    
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css">

    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/min/moment.min.js"></script>
    
      <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/locale/zh-tw.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
    <script>
      window.algoliaConfig = {
        appId: 'AWFC86Q51O',
        apiKey: 'c9d952906eb1b154d75cf863e75c1ede',
        indexName: 'MyBlog'
      };
      var algoliaIndex = algoliasearch(
        algoliaConfig.appId,
        algoliaConfig.apiKey
      ).initIndex(algoliaConfig.indexName);
    </script>


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Kein&#39;s blog">
    <title>分類: 编程语言 - Kein&#39;s blog</title>
    <meta name="author" content="Kein Chan">
    
    
    
    <script type="application/ld+json">{}</script>
    <meta property="og:type" content="blog">
<meta property="og:title" content="Kein&#39;s blog">
<meta property="og:url" content="https://chankein.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/page/2/index.html">
<meta property="og:site_name" content="Kein&#39;s blog">
<meta property="og:locale" content="zh_TW">
<meta property="article:author" content="Kein Chan">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="https://chankein.github.io../../../../assets/images/profile.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="../../../../assets/css/style-l9zwheso7r7pnk98nvirovsz9dl7fhkrc9mlb5vmuxw7tk5movrk0eevsrpr.min.css">

    <!--STYLES END-->
    

    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="../../../../index.html"
            aria-label=""
        >
            Kein&#39;s blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="打開鏈接: ../../../../#about"
            >
        
        
            <img class="header-picture" src="../../../../assets/images/profile.jpg" alt="作者的圖片"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="../../../../#about"
                    aria-label="閱讀有關作者的更多信息"
                >
                    <img class="sidebar-profile-picture" src="../../../../assets/images/profile.jpg" alt="作者的圖片"/>
                </a>
                <h4 class="sidebar-profile-name">Kein Chan</h4>
                
                    <h5 class="sidebar-profile-bio"><p>這是獨立全棧工程師Kein Chan的技術博客</br>分享一些技術教程,命令備忘(cheat-sheet)等</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../../../index.html"
                            
                            rel="noopener"
                            title="首頁"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首頁</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../../../all-categories"
                            
                            rel="noopener"
                            title="分類"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分類</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../../../all-tags"
                            
                            rel="noopener"
                            title="標籤"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">標籤</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../../../all-archives"
                            
                            rel="noopener"
                            title="所有文章"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">所有文章</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="搜尋"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">搜尋</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="關於"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">關於</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/chankein/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/profile/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../../../mailto:kein.chan85@gmail.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Email"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Email</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../../../atom.xml"
                            
                            rel="noopener"
                            title="Atom"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Atom</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../../../2024/01/13/JavaScript/JavaScript-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/"
                            aria-label=": JavaScript-面向对象编程"
                        >
                            JavaScript-面向对象编程
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2024-01-13T21:16:23+08:00">
	
		    2024 年 1 月 13 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../">编程语言</a>, <a class="category-link" href="../../JavaScript/">JavaScript</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>JavaScript的所有数据都可以看成对象，那是不是我们已经在使用面向对象编程了呢？</p>
<p>当然不是。如果我们只使用<code>Number</code>、<code>Array</code>、<code>string</code>以及基本的<code>&#123;...&#125;</code>定义的对象，还无法发挥出面向对象编程的威力。</p>
<p>JavaScript的面向对象编程和大多数其他语言如Java、C#的面向对象编程都不太一样。如果你熟悉Java或C#，很好，你一定明白面向对象的两个基本概念：</p>
<ol>
<li>类：类是对象的类型模板，例如，定义<code>Student</code>类来表示学生，类本身是一种类型，<code>Student</code>表示学生类型，但不表示任何具体的某个学生；</li>
<li>实例：实例是根据类创建的对象，例如，根据<code>Student</code>类可以创建出<code>xiaoming</code>、<code>xiaohong</code>、<code>xiaojun</code>等多个实例，每个实例表示一个具体的学生，他们全都属于<code>Student</code>类型。</li>
</ol>
<p>所以，类和实例是大多数面向对象编程语言的基本概念。</p>
<p>不过，在JavaScript中，这个概念需要改一改。JavaScript不区分类和实例的概念，而是通过原型（prototype）来实现面向对象编程。</p>
<p>原型是指当我们想要创建<code>xiaoming</code>这个具体的学生时，我们并没有一个<code>Student</code>类型可用。那怎么办？恰好有这么一个现成的对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> robot = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Robot&#x27;</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">1.6</span>,</span><br><span class="line">    <span class="attr">run</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27; is running...&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>我们看这个<code>robot</code>对象有名字，有身高，还会跑，有点像小明，干脆就根据它来“创建”小明得了！</p>
<p>于是我们把它改名为<code>Student</code>，然后创建出<code>xiaoming</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title class_">Student</span> = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Robot&#x27;</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">1.2</span>,</span><br><span class="line">    <span class="attr">run</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27; is running...&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xiaoming.<span class="property">__proto__</span> = <span class="title class_">Student</span>;</span><br></pre></td></tr></table></figure>
<p>注意最后一行代码把<code>xiaoming</code>的原型指向了对象<code>Student</code>，看上去<code>xiaoming</code>仿佛是从<code>Student</code>继承下来的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xiaoming.<span class="property">name</span>; <span class="comment">// &#x27;小明&#x27;</span></span><br><span class="line">xiaoming.<span class="title function_">run</span>(); <span class="comment">// 小明 is running...</span></span><br></pre></td></tr></table></figure>
<p><code>xiaoming</code>有自己的<code>name</code>属性，但并没有定义<code>run()</code>方法。不过，由于小明是从<code>Student</code>继承而来，只要<code>Student</code>有<code>run()</code>方法，<code>xiaoming</code>也可以调用：</p>
<p><img src="https://liaoxuefeng.com/books/javascript/oop/proto.jpg" alt="xiaoming-prototype"></p>
<p>JavaScript的原型链和Java的Class区别就在，它没有“Class”的概念，所有对象都是实例，所谓继承关系不过是把一个对象的原型指向另一个对象而已。</p>
<p>如果你把<code>xiaoming</code>的原型指向其他对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title class_">Bird</span> = &#123;</span><br><span class="line">    <span class="attr">fly</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27; is flying...&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xiaoming.<span class="property">__proto__</span> = <span class="title class_">Bird</span>;</span><br></pre></td></tr></table></figure>
<p>现在<code>xiaoming</code>已经无法<code>run()</code>了，他已经变成了一只鸟：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xiaoming.<span class="title function_">fly</span>(); <span class="comment">// 小明 is flying...</span></span><br></pre></td></tr></table></figure>
<p>在JavaScrip代码运行时期，你可以把<code>xiaoming</code>从<code>Student</code>变成<code>Bird</code>，或者变成任何对象。</p>
<p><em>请注意</em>，上述代码仅用于演示目的。在编写JavaScript代码时，不要直接用<code>obj.__proto__</code>去改变一个对象的原型，并且，低版本的IE也无法使用<code>__proto__</code>。<code>Object.create()</code>方法可以传入一个原型对象，并创建一个基于该原型的新对象，但是新对象什么属性都没有，因此，我们可以编写一个函数来创建<code>xiaoming</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 原型对象:</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">Student</span> = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Robot&#x27;</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">1.2</span>,</span><br><span class="line">    <span class="attr">run</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27; is running...&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createStudent</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="comment">// 基于Student原型创建一个新对象:</span></span><br><span class="line">    <span class="keyword">let</span> s = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Student</span>);</span><br><span class="line">    <span class="comment">// 初始化新对象:</span></span><br><span class="line">    s.<span class="property">name</span> = name;</span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> xiaoming = <span class="title function_">createStudent</span>(<span class="string">&#x27;小明&#x27;</span>);</span><br><span class="line">xiaoming.<span class="title function_">run</span>(); <span class="comment">// 小明 is running...</span></span><br><span class="line">xiaoming.<span class="property">__proto__</span> === <span class="title class_">Student</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>这是创建原型继承的一种方法，JavaScript还有其他方法来创建对象，我们在后面会一一讲到。</p>
<p>JavaScript对每个创建的对象都会设置一个原型，指向它的原型对象。</p>
<p>当我们用<code>obj.xxx</code>访问一个对象的属性时，JavaScript引擎先在当前对象上查找该属性，如果没有找到，就到其原型对象上找，如果还没有找到，就一直上溯到<code>Object.prototype</code>对象，最后，如果还没有找到，就只能返回<code>undefined</code>。</p>
<p>例如，创建一个<code>Array</code>对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br></pre></td></tr></table></figure>
<p>其原型链是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">       null</span><br><span class="line">         ▲</span><br><span class="line">         │</span><br><span class="line">┌─────────────────┐</span><br><span class="line">│Object.prototype │</span><br><span class="line">└─────────────────┘</span><br><span class="line">         ▲</span><br><span class="line">         │</span><br><span class="line">┌─────────────────┐</span><br><span class="line">│ Array.prototype │</span><br><span class="line">└─────────────────┘</span><br><span class="line">         ▲</span><br><span class="line">         │</span><br><span class="line">┌─────────────────┐</span><br><span class="line">│       arr       │</span><br><span class="line">└─────────────────┘</span><br></pre></td></tr></table></figure>
<p><code>Array.prototype</code>定义了<code>indexOf()</code>、<code>shift()</code>等方法，因此你可以在所有的<code>Array</code>对象上直接调用这些方法。</p>
<p>当我们创建一个函数时：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>函数也是一个对象，它的原型链是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">        null</span><br><span class="line">          ▲</span><br><span class="line">          │</span><br><span class="line">┌───────────────────┐</span><br><span class="line">│ Object.prototype  │</span><br><span class="line">└───────────────────┘</span><br><span class="line">          ▲</span><br><span class="line">          │</span><br><span class="line">┌───────────────────┐</span><br><span class="line">│Function.prototype │</span><br><span class="line">└───────────────────┘</span><br><span class="line">          ▲</span><br><span class="line">          │</span><br><span class="line">┌───────────────────┐</span><br><span class="line">│        foo        │</span><br><span class="line">└───────────────────┘</span><br></pre></td></tr></table></figure>
<p>由于<code>Function.prototype</code>定义了<code>apply()</code>等方法，因此，所有函数都可以调用<code>apply()</code>方法。</p>
<p>很容易想到，如果原型链很长，那么访问一个对象的属性就会因为花更多的时间查找而变得更慢，因此要注意不要把原型链搞得太长。</p>
<h3 id="构造函数">构造函数</h3>
<p>除了直接用<code>&#123; ... &#125;</code>创建一个对象外，JavaScript还可以用一种构造函数的方法来创建对象。它的用法是，先定义一个构造函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hello</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&#x27;Hello, &#x27;</span> + <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27;!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你会问，咦，这不是一个普通函数吗？</p>
<p>这确实是一个普通函数，但是在JavaScript中，可以用关键字<code>new</code>来调用这个函数，并返回一个对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xiaoming = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&#x27;小明&#x27;</span>);</span><br><span class="line">xiaoming.<span class="property">name</span>; <span class="comment">// &#x27;小明&#x27;</span></span><br><span class="line">xiaoming.<span class="title function_">hello</span>(); <span class="comment">// Hello, 小明!</span></span><br></pre></td></tr></table></figure>
<p><em>注意</em>，如果不写<code>new</code>，这就是一个普通函数，它返回<code>undefined</code>。但是，如果写了<code>new</code>，它就变成了一个构造函数，它绑定的<code>this</code>指向新创建的对象，并默认返回<code>this</code>，也就是说，不需要在最后写<code>return this;</code>。</p>
<p>新创建的<code>xiaoming</code>的原型链是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">       null</span><br><span class="line">         ▲</span><br><span class="line">         │</span><br><span class="line">┌─────────────────┐</span><br><span class="line">│Object.prototype │</span><br><span class="line">└─────────────────┘</span><br><span class="line">         ▲</span><br><span class="line">         │</span><br><span class="line">┌─────────────────┐</span><br><span class="line">│Student.prototype│</span><br><span class="line">└─────────────────┘</span><br><span class="line">         ▲</span><br><span class="line">         │</span><br><span class="line">┌─────────────────┐</span><br><span class="line">│    xiaoming     │</span><br><span class="line">└─────────────────┘</span><br></pre></td></tr></table></figure>
<p>也就是说，<code>xiaoming</code>的原型指向函数<code>Student</code>的原型。如果你又创建了<code>xiaohong</code>、<code>xiaojun</code>，那么这些对象的原型与<code>xiaoming</code>是一样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">              null</span><br><span class="line">                ▲</span><br><span class="line">                │</span><br><span class="line">       ┌─────────────────┐</span><br><span class="line">       │Object.prototype │</span><br><span class="line">       └─────────────────┘</span><br><span class="line">                ▲</span><br><span class="line">                │</span><br><span class="line">       ┌─────────────────┐</span><br><span class="line">       │Student.prototype│</span><br><span class="line">       └─────────────────┘</span><br><span class="line">         ▲      ▲      ▲</span><br><span class="line">         │      │      │</span><br><span class="line">┌─────────┐┌─────────┐┌─────────┐</span><br><span class="line">│xiaoming ││xiaohong ││ xiaojun │</span><br><span class="line">└─────────┘└─────────┘└─────────┘</span><br></pre></td></tr></table></figure>
<p>用<code>new Student()</code>创建的对象还从原型上获得了一个<code>constructor</code>属性，它指向函数<code>Student</code>本身：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xiaoming.<span class="property">constructor</span> === <span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span>; <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> === <span class="title class_">Student</span>; <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(xiaoming) === <span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">xiaoming <span class="keyword">instanceof</span> <span class="title class_">Student</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>看晕了吧？用一张图来表示这些乱七八糟的关系就是：</p>
<p><img src="https://liaoxuefeng.com/books/javascript/oop/create-object/prototypes.jpg" alt="prototypes"></p>
<p>红色箭头是原型链。注意，<code>Student.prototype</code>指向的对象就是<code>xiaoming</code>、<code>xiaohong</code>的原型对象，这个原型对象自己还有个属性<code>constructor</code>，指向<code>Student</code>函数本身。</p>
<p>另外，函数<code>Student</code>恰好有个属性<code>prototype</code>指向<code>xiaoming</code>、<code>xiaohong</code>的原型对象，但是<code>xiaoming</code>、<code>xiaohong</code>这些对象可没有<code>prototype</code>这个属性，不过可以用<code>__proto__</code>这个非标准用法来查看。</p>
<p>现在我们就认为<code>xiaoming</code>、<code>xiaohong</code>这些对象“继承”自<code>Student</code>。</p>
<p>不过还有一个小问题，注意观察：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xiaoming.<span class="property">name</span>; <span class="comment">// &#x27;小明&#x27;</span></span><br><span class="line">xiaohong.<span class="property">name</span>; <span class="comment">// &#x27;小红&#x27;</span></span><br><span class="line">xiaoming.<span class="property">hello</span>; <span class="comment">// function: Student.hello()</span></span><br><span class="line">xiaohong.<span class="property">hello</span>; <span class="comment">// function: Student.hello()</span></span><br><span class="line">xiaoming.<span class="property">hello</span> === xiaohong.<span class="property">hello</span>; <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p><code>xiaoming</code>和<code>xiaohong</code>各自的<code>name</code>不同，这是对的，否则我们无法区分谁是谁了。</p>
<p><code>xiaoming</code>和<code>xiaohong</code>各自的<code>hello</code>是一个函数，但它们是两个不同的函数，虽然函数名称和代码都是相同的！</p>
<p>如果我们通过<code>new Student()</code>创建了很多对象，这些对象的<code>hello</code>函数实际上只需要共享同一个函数就可以了，这样可以节省很多内存。</p>
<p>要让创建的对象共享一个<code>hello</code>函数，根据对象的属性查找原则，我们只要把<code>hello</code>函数移动到<code>xiaoming</code>、<code>xiaohong</code>这些对象共同的原型上就可以了，也就是<code>Student.prototype</code>：</p>
<p><img src="https://liaoxuefeng.com/books/javascript/oop/create-object/proto-share.jpg" alt="protos2"></p>
<p>修改代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hello</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;Hello, &#x27;</span> + <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27;!&#x27;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>用<code>new</code>创建基于原型的JavaScript的对象就是这么简单！</p>
<h3 id="忘记写new怎么办">忘记写new怎么办</h3>
<p>如果一个函数被定义为用于创建对象的构造函数，但是调用时忘记了写<code>new</code>怎么办？</p>
<p>在strict模式下，<code>this.name = name</code>将报错，因为<code>this</code>绑定为<code>undefined</code>，在非strict模式下，<code>this.name = name</code>不报错，因为<code>this</code>绑定为<code>window</code>，于是无意间创建了全局变量<code>name</code>，并且返回<code>undefined</code>，这个结果更糟糕。</p>
<p>所以，调用构造函数千万不要忘记写<code>new</code>。为了区分普通函数和构造函数，按照约定，构造函数首字母应当大写，而普通函数首字母应当小写，这样，一些语法检查工具如<a target="_blank" rel="noopener" href="https://www.jslint.com/">jslint</a>将可以帮你检测到漏写的<code>new</code>。</p>
<p>最后，我们还可以编写一个<code>createStudent()</code>函数，在内部封装所有的<code>new</code>操作。一个常用的编程模式像这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = props.<span class="property">name</span> || <span class="string">&#x27;匿名&#x27;</span>; <span class="comment">// 默认值为&#x27;匿名&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grade</span> = props.<span class="property">grade</span> || <span class="number">1</span>; <span class="comment">// 默认值为1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hello</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;Hello, &#x27;</span> + <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27;!&#x27;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createStudent</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Student</span>(props || &#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个<code>createStudent()</code>函数有几个巨大的优点：一是不需要<code>new</code>来调用，二是参数非常灵活，可以不传，也可以这么传：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xiaoming = <span class="title function_">createStudent</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">xiaoming.<span class="property">grade</span>; <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p>如果创建的对象有很多属性，我们只需要传递需要的某些属性，剩下的属性可以用默认值。由于参数是一个Object，我们无需记忆参数的顺序。如果恰好从<code>JSON</code>拿到了一个对象，就可以直接创建出<code>xiaoming</code>。</p>
<h3 id="练习">练习</h3>
<p>请利用构造函数定义<code>Cat</code>，并让所有的Cat对象有一个<code>name</code>属性，并共享一个方法<code>say()</code>，返回字符串<code>'Hello, xxx!'</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function Cat(name) &#123;</span><br><span class="line">    // TODO:</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">let kitty = new Cat(&#x27;Kitty&#x27;);</span><br><span class="line">let doraemon = new Cat(&#x27;哆啦A梦&#x27;);</span><br><span class="line">if (kitty &amp;&amp; kitty.name === &#x27;Kitty&#x27;</span><br><span class="line">    &amp;&amp; kitty.say</span><br><span class="line">    &amp;&amp; typeof kitty.say === &#x27;function&#x27;</span><br><span class="line">    &amp;&amp; kitty.say() === &#x27;Hello, Kitty!&#x27;</span><br><span class="line">    &amp;&amp; kitty.say === doraemon.say</span><br><span class="line">) &#123;</span><br><span class="line">    console.log(&#x27;测试通过!&#x27;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    console.log(&#x27;测试失败!&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在传统的基于Class的语言如Java、C++中，继承的本质是扩展一个已有的Class，并生成新的Subclass。</p>
<p>由于这类语言严格区分类和实例，继承实际上是类型的扩展。但是，JavaScript由于采用原型继承，我们无法直接扩展一个Class，因为根本不存在Class这种类型。</p>
<p>但是办法还是有的。我们先回顾<code>Student</code>构造函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = props.<span class="property">name</span> || <span class="string">&#x27;Unnamed&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hello</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;Hello, &#x27;</span> + <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27;!&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以及<code>Student</code>的原型链：</p>
<p><img src="https://liaoxuefeng.com/books/javascript/oop/prototype/prototype-chain.jpg" alt="js-proto"></p>
<p>现在，我们要基于<code>Student</code>扩展出<code>PrimaryStudent</code>，可以先定义出<code>PrimaryStudent</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">PrimaryStudent</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="comment">// 调用Student构造函数，绑定this变量:</span></span><br><span class="line">    <span class="title class_">Student</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grade</span> = props.<span class="property">grade</span> || <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是，调用了<code>Student</code>构造函数不等于继承了<code>Student</code>，<code>PrimaryStudent</code>创建的对象的原型是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new PrimaryStudent() --&gt; PrimaryStudent.prototype --&gt; Object.prototype --&gt; null</span><br></pre></td></tr></table></figure>
<p>必须想办法把原型链修改为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new PrimaryStudent() --&gt; PrimaryStudent.prototype --&gt; Student.prototype --&gt; Object.prototype --&gt; null</span><br></pre></td></tr></table></figure>
<p>这样，原型链对了，继承关系就对了。新的基于<code>PrimaryStudent</code>创建的对象不但能调用<code>PrimaryStudent.prototype</code>定义的方法，也可以调用<code>Student.prototype</code>定义的方法。</p>
<p>如果你想用最简单粗暴的方法这么干：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">PrimaryStudent</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>;</span><br></pre></td></tr></table></figure>
<p>是不行的！如果这样的话，<code>PrimaryStudent</code>和<code>Student</code>共享一个原型对象，那还要定义<code>PrimaryStudent</code>干啥？</p>
<p>我们必须借助一个中间对象来实现正确的原型链，这个中间对象的原型要指向<code>Student.prototype</code>。为了实现这一点，参考道爷（就是发明JSON的那个道格拉斯）的代码，中间对象可以用一个空函数<code>F</code>来实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PrimaryStudent构造函数:</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">PrimaryStudent</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="title class_">Student</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grade</span> = props.<span class="property">grade</span> || <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 空函数F:</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>) &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把F的原型指向Student.prototype:</span></span><br><span class="line">F.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把PrimaryStudent的原型指向一个新的F对象，F对象的原型正好指向Student.prototype:</span></span><br><span class="line"><span class="title class_">PrimaryStudent</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title function_">F</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把PrimaryStudent原型的构造函数修复为PrimaryStudent:</span></span><br><span class="line"><span class="title class_">PrimaryStudent</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">PrimaryStudent</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 继续在PrimaryStudent原型（就是new F()对象）上定义方法：</span></span><br><span class="line"><span class="title class_">PrimaryStudent</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getGrade</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">grade</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建xiaoming:</span></span><br><span class="line"><span class="keyword">let</span> xiaoming = <span class="keyword">new</span> <span class="title class_">PrimaryStudent</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">grade</span>: <span class="number">2</span></span><br><span class="line">&#125;);</span><br><span class="line">xiaoming.<span class="property">name</span>; <span class="comment">// &#x27;小明&#x27;</span></span><br><span class="line">xiaoming.<span class="property">grade</span>; <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证原型:</span></span><br><span class="line">xiaoming.<span class="property">__proto__</span> === <span class="title class_">PrimaryStudent</span>.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// true</span></span><br><span class="line">xiaoming.<span class="property">__proto__</span>.<span class="property">__proto__</span> === <span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证继承关系:</span></span><br><span class="line">xiaoming <span class="keyword">instanceof</span> <span class="title class_">PrimaryStudent</span>; <span class="comment">// true</span></span><br><span class="line">xiaoming <span class="keyword">instanceof</span> <span class="title class_">Student</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>用一张图来表示新的原型链：</p>
<p><img src="https://liaoxuefeng.com/books/javascript/oop/prototype/prototype-inherit.jpg" alt="js-proto-inherit"></p>
<p>注意，函数<code>F</code>仅用于桥接，我们仅创建了一个<code>new F()</code>实例，而且，没有改变原有的<code>Student</code>定义的原型链。</p>
<p>如果把继承这个动作用一个<code>inherits()</code>函数封装起来，还可以隐藏<code>F</code>的定义，并简化代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">inherits</span>(<span class="params">Child, Parent</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> F = <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;;</span><br><span class="line">    F.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Parent</span>.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">    <span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title function_">F</span>();</span><br><span class="line">    <span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Child</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个<code>inherits()</code>函数可以复用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = props.<span class="property">name</span> || <span class="string">&#x27;Unnamed&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hello</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;Hello, &#x27;</span> + <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27;!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">PrimaryStudent</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="title class_">Student</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grade</span> = props.<span class="property">grade</span> || <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现原型继承链:</span></span><br><span class="line"><span class="title function_">inherits</span>(<span class="title class_">PrimaryStudent</span>, <span class="title class_">Student</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定其他方法到PrimaryStudent原型:</span></span><br><span class="line"><span class="title class_">PrimaryStudent</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getGrade</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">grade</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="小结">小结</h3>
<p>JavaScript的原型继承实现方式就是：</p>
<ol>
<li>定义新的构造函数，并在内部用<code>call()</code>调用希望“继承”的构造函数，并绑定<code>this</code>；</li>
<li>借助中间函数<code>F</code>实现原型链继承，最好通过封装的<code>inherits</code>函数完成；</li>
<li>继续在新的构造函数的原型上定义新方法。</li>
</ol>
<h2 id="class继承">class继承</h2>
<p>在上面的章节中我们看到了JavaScript的对象模型是基于原型实现的，特点是简单，缺点是理解起来比传统的类－实例模型要困难，最大的缺点是继承的实现需要编写大量代码，并且需要正确实现原型链。</p>
<p>有没有更简单的写法？有！</p>
<p>新的关键字<code>class</code>从ES6开始正式被引入到JavaScript中。<code>class</code>的目的就是让定义类更简单。</p>
<p>我们先回顾用函数实现<code>Student</code>的方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hello</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;Hello, &#x27;</span> + <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27;!&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果用新的<code>class</code>关键字来编写<code>Student</code>，可以这样写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">hello</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&#x27;Hello, &#x27;</span> + <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27;!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>比较一下就可以发现，<code>class</code>的定义包含了构造函数<code>constructor</code>和定义在原型对象上的函数<code>hello()</code>（注意没有<code>function</code>关键字），这样就避免了<code>Student.prototype.hello = function () &#123;...&#125;</code>这样分散的代码。</p>
<p>最后，创建一个<code>Student</code>对象代码和前面章节完全一样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xiaoming = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&#x27;小明&#x27;</span>);</span><br><span class="line">xiaoming.<span class="title function_">hello</span>();</span><br></pre></td></tr></table></figure>
<h3 id="class继承-2">class继承</h3>
<p>用<code>class</code>定义对象的另一个巨大的好处是继承更方便了。想一想我们从<code>Student</code>派生一个<code>PrimaryStudent</code>需要编写的代码量。现在，原型继承的中间对象，原型对象的构造函数等等都不需要考虑了，直接通过<code>extends</code>来实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PrimaryStudent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Student</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name, grade</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(name); <span class="comment">// 记得用super调用父类的构造方法!</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">grade</span> = grade;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">myGrade</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&#x27;I am at grade &#x27;</span> + <span class="variable language_">this</span>.<span class="property">grade</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意<code>PrimaryStudent</code>的定义也是class关键字实现的，而<code>extends</code>则表示原型链对象来自<code>Student</code>。子类的构造函数可能会与父类不太相同，例如，<code>PrimaryStudent</code>需要<code>name</code>和<code>grade</code>两个参数，并且需要通过<code>super(name)</code>来调用父类的构造函数，否则父类的<code>name</code>属性无法正常初始化。</p>
<p><code>PrimaryStudent</code>已经自动获得了父类<code>Student</code>的<code>hello</code>方法，我们又在子类中定义了新的<code>myGrade</code>方法。</p>
<p>ES6引入的<code>class</code>和原有的JavaScript原型继承有什么区别呢？实际上它们没有任何区别，<code>class</code>的作用就是让JavaScript引擎去实现原来需要我们自己编写的原型链代码。简而言之，用<code>class</code>的好处就是极大地简化了原型链代码。</p>
<h3 id="练习-2">练习</h3>
<p>请利用<code>class</code>重新定义<code>Cat</code>，并让它从已有的<code>Animal</code>继承，然后新增一个方法<code>say()</code>，返回字符串<code>'Hello, xxx!'</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">class Animal &#123;</span><br><span class="line">    constructor(name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// FIXME:</span><br><span class="line">class Cat ???</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">let kitty = new Cat(&#x27;Kitty&#x27;);</span><br><span class="line">let doraemon = new Cat(&#x27;哆啦A梦&#x27;);</span><br><span class="line">if ((new Cat(&#x27;x&#x27;) instanceof Animal)</span><br><span class="line">    &amp;&amp; kitty </span><br><span class="line">    &amp;&amp; kitty.name === &#x27;Kitty&#x27;</span><br><span class="line">    &amp;&amp; kitty.say</span><br><span class="line">    &amp;&amp; typeof kitty.say === &#x27;function&#x27;</span><br><span class="line">    &amp;&amp; kitty.say() === &#x27;Hello, Kitty!&#x27;</span><br><span class="line">    &amp;&amp; kitty.say === doraemon.say)</span><br><span class="line">&#123;</span><br><span class="line">    console.log(&#x27;测试通过!&#x27;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    console.log(&#x27;测试失败!&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个练习需要浏览器支持ES6的<code>class</code>，如果遇到SyntaxError，则说明浏览器不支持<code>class</code>语法，请换一个最新的浏览器试试。</p>
<hr>
<hr>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../../../2024/01/13/JavaScript/JavaScript-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../../../2024/01/12/JavaScript/JavaScript-%E6%A0%87%E5%87%86%E5%AF%B9%E8%B1%A1/"
                            aria-label=": JavaScript-标准对象"
                        >
                            JavaScript-标准对象
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2024-01-12T21:14:28+08:00">
	
		    2024 年 1 月 12 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../">编程语言</a>, <a class="category-link" href="../../JavaScript/">JavaScript</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="标准对象">标准对象</h2>
<p>在JavaScript的世界里，一切都是对象。</p>
<p>但是某些对象还是和其他对象不太一样。为了区分对象的类型，我们用<code>typeof</code>操作符获取对象的类型，它总是返回一个字符串：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span> <span class="number">123</span>; <span class="comment">// &#x27;number&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="number">123n</span>; <span class="comment">// &#x27;bigint&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="title class_">NaN</span>; <span class="comment">// &#x27;number&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="string">&#x27;str&#x27;</span>; <span class="comment">// &#x27;string&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">true</span>; <span class="comment">// &#x27;boolean&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">undefined</span>; <span class="comment">// &#x27;undefined&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="title class_">Math</span>.<span class="property">abs</span>; <span class="comment">// &#x27;function&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">null</span>; <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> []; <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> &#123;&#125;; <span class="comment">// &#x27;object&#x27;</span></span><br></pre></td></tr></table></figure>
<p>可见，<code>number</code>、<code>bigint</code>、<code>string</code>、<code>boolean</code>、<code>function</code>和<code>undefined</code>有别于其他类型。特别注意<code>null</code>的类型是<code>object</code>，<code>Array</code>的类型也是<code>object</code>，如果我们用<code>typeof</code>将无法区分出<code>null</code>、<code>Array</code>和通常意义上的object——<code>&#123;&#125;</code>。</p>
<h3 id="包装对象">包装对象</h3>
<p>除了这些类型外，JavaScript还提供了包装对象，熟悉Java的小伙伴肯定很清楚<code>int</code>和<code>Integer</code>这种暧昧关系。</p>
<p><code>number</code>、<code>boolean</code>和<code>string</code>都有包装对象。没错，在JavaScript中，字符串也区分<code>string</code>类型和它的包装类型。包装对象用<code>new</code>创建：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> n = <span class="keyword">new</span> <span class="title class_">Number</span>(<span class="number">123</span>); <span class="comment">// 123,生成了新的包装类型</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> <span class="title class_">Boolean</span>(<span class="literal">true</span>); <span class="comment">// true,生成了新的包装类型</span></span><br><span class="line"><span class="keyword">let</span> s = <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&#x27;str&#x27;</span>); <span class="comment">// &#x27;str&#x27;,生成了新的包装类型</span></span><br></pre></td></tr></table></figure>
<p>虽然包装对象看上去和原来的值一模一样，显示出来也是一模一样，但他们的类型已经变为<code>object</code>了！所以，包装对象和原始值用<code>===</code>比较会返回<code>false</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span> <span class="keyword">new</span> <span class="title class_">Number</span>(<span class="number">123</span>); <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Number</span>(<span class="number">123</span>) === <span class="number">123</span>; <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> <span class="keyword">new</span> <span class="title class_">Boolean</span>(<span class="literal">true</span>); <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Boolean</span>(<span class="literal">true</span>) === <span class="literal">true</span>; <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&#x27;str&#x27;</span>); <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&#x27;str&#x27;</span>) === <span class="string">&#x27;str&#x27;</span>; <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>所以<em>闲的蛋疼也不要使用包装对象</em>！尤其是针对<code>string</code>类型！！！</p>
<p>如果我们在使用<code>Number</code>、<code>Boolean</code>和<code>String</code>时，没有写<code>new</code>会发生什么情况？</p>
<p>此时，<code>Number()</code>、<code>Boolean</code>和<code>String()</code>被当做普通函数，把任何类型的数据转换为<code>number</code>、<code>boolean</code>和<code>string</code>类型（注意不是其包装类型）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> n = <span class="title class_">Number</span>(<span class="string">&#x27;123&#x27;</span>); <span class="comment">// 123，相当于parseInt()或parseFloat()</span></span><br><span class="line"><span class="keyword">typeof</span> n; <span class="comment">// &#x27;number&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = <span class="title class_">Boolean</span>(<span class="string">&#x27;true&#x27;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="keyword">typeof</span> b; <span class="comment">// &#x27;boolean&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b2 = <span class="title class_">Boolean</span>(<span class="string">&#x27;false&#x27;</span>); <span class="comment">// true! &#x27;false&#x27;字符串转换结果为true！因为它是非空字符串！</span></span><br><span class="line"><span class="keyword">let</span> b3 = <span class="title class_">Boolean</span>(<span class="string">&#x27;&#x27;</span>); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> s = <span class="title class_">String</span>(<span class="number">123.45</span>); <span class="comment">// &#x27;123.45&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> s; <span class="comment">// &#x27;string&#x27;</span></span><br></pre></td></tr></table></figure>
<p>是不是感觉头大了？这就是JavaScript特有的催眠魅力！</p>
<p>总结一下，有这么几条规则需要遵守：</p>
<ul>
<li>不要使用<code>new Number()</code>、<code>new Boolean()</code>、<code>new String()</code>创建包装对象；</li>
<li>用<code>parseInt()</code>或<code>parseFloat()</code>来转换任意类型到<code>number</code>；</li>
<li>用<code>String()</code>来转换任意类型到<code>string</code>，或者直接调用某个对象的<code>toString()</code>方法；</li>
<li>通常不必把任意类型转换为<code>boolean</code>再判断，因为可以直接写<code>if (myVar) &#123;...&#125;</code>；</li>
<li><code>typeof</code>操作符可以判断出<code>number</code>、<code>boolean</code>、<code>string</code>、<code>function</code>和<code>undefined</code>；</li>
<li>判断<code>Array</code>要使用<code>Array.isArray(arr)</code>；</li>
<li>判断<code>null</code>请使用<code>myVar === null</code>；</li>
<li>判断某个全局变量是否存在用<code>typeof window.myVar === 'undefined'</code>；</li>
<li>函数内部判断某个变量是否存在用<code>typeof myVar === 'undefined'</code>。</li>
</ul>
<p>最后有细心的同学指出，任何对象都有<code>toString()</code>方法吗？<code>null</code>和<code>undefined</code>就没有！确实如此，这两个特殊值要除外，虽然<code>null</code>还伪装成了<code>object</code>类型。</p>
<p>更细心的同学指出，<code>number</code>对象调用<code>toString()</code>报SyntaxError：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">123.</span><span class="title function_">toString</span>(); <span class="comment">// SyntaxError</span></span><br></pre></td></tr></table></figure>
<p>遇到这种情况，要特殊处理一下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">123.</span>.<span class="title function_">toString</span>(); <span class="comment">// &#x27;123&#x27;, 注意是两个点！</span></span><br><span class="line">(<span class="number">123</span>).<span class="title function_">toString</span>(); <span class="comment">// &#x27;123&#x27;</span></span><br></pre></td></tr></table></figure>
<p>不要问为什么，这就是JavaScript代码的乐趣！</p>
<hr>
<hr>
<p>在JavaScript中，<code>Date</code>对象用来表示日期和时间。</p>
<p>要获取系统当前时间，用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">now; <span class="comment">// Wed Jun 24 2015 19:49:22 GMT+0800 (CST)</span></span><br><span class="line">now.<span class="title function_">getFullYear</span>(); <span class="comment">// 2015, 年份</span></span><br><span class="line">now.<span class="title function_">getMonth</span>(); <span class="comment">// 5, 月份，注意月份范围是0~11，5表示六月</span></span><br><span class="line">now.<span class="title function_">getDate</span>(); <span class="comment">// 24, 表示24号</span></span><br><span class="line">now.<span class="title function_">getDay</span>(); <span class="comment">// 3, 表示星期三</span></span><br><span class="line">now.<span class="title function_">getHours</span>(); <span class="comment">// 19, 24小时制</span></span><br><span class="line">now.<span class="title function_">getMinutes</span>(); <span class="comment">// 49, 分钟</span></span><br><span class="line">now.<span class="title function_">getSeconds</span>(); <span class="comment">// 22, 秒</span></span><br><span class="line">now.<span class="title function_">getMilliseconds</span>(); <span class="comment">// 875, 毫秒数</span></span><br><span class="line">now.<span class="title function_">getTime</span>(); <span class="comment">// 1435146562875, 以number形式表示的时间戳</span></span><br></pre></td></tr></table></figure>
<p>注意，当前时间是浏览器从本机操作系统获取的时间，所以不一定准确，因为用户可以把当前时间设定为任何值。</p>
<p>如果要创建一个指定日期和时间的<code>Date</code>对象，可以用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> d = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">2015</span>, <span class="number">5</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">15</span>, <span class="number">30</span>, <span class="number">123</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(d); <span class="comment">// Fri Jun 19 2015 20:15:30 GMT+0800 (CST)</span></span><br></pre></td></tr></table></figure>
<p>你可能观察到了一个<em>非常非常坑爹</em>的地方，就是JavaScript的月份范围用整数表示是0~11，<code>0</code>表示一月，<code>1</code>表示二月……，所以要表示6月，我们传入的是<code>5</code>！这绝对是JavaScript的设计者当时脑抽了一下，但是现在要修复已经不可能了。</p>
<p>特别注意</p>
<p>JavaScript的Date对象月份值从0开始，牢记0=1月，1=2月，2=3月，……，11=12月。</p>
<p>第二种创建一个指定日期和时间的方法是解析一个符合<a target="_blank" rel="noopener" href="https://www.w3.org/TR/NOTE-datetime">ISO 8601</a>格式的字符串：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> d = <span class="title class_">Date</span>.<span class="title function_">parse</span>(<span class="string">&#x27;2015-06-24T19:49:22.875+08:00&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(d); <span class="comment">// 1435146562875</span></span><br></pre></td></tr></table></figure>
<p>但它返回的不是<code>Date</code>对象，而是一个时间戳。不过有时间戳就可以很容易地把它转换为一个<code>Date</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> d = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">1435146562875</span>);</span><br><span class="line">d; <span class="comment">// Wed Jun 24 2015 19:49:22 GMT+0800 (CST)</span></span><br><span class="line">d.<span class="title function_">getMonth</span>(); <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>
<p>注意</p>
<p>使用Date.parse()时传入的字符串使用实际月份01~12，转换为Date对象后getMonth()获取的月份值为0~11。</p>
<h3 id="时区">时区</h3>
<p><code>Date</code>对象表示的时间总是按浏览器所在时区显示的，不过我们既可以显示本地时间，也可以显示调整后的UTC时间：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> d = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">1435146562875</span>);</span><br><span class="line">d.<span class="title function_">toLocaleString</span>(); <span class="comment">// &#x27;2015/6/24 下午7:49:22&#x27;，本地时间（北京时区+8:00），显示的字符串与操作系统设定的格式有关</span></span><br><span class="line">d.<span class="title function_">toUTCString</span>(); <span class="comment">// &#x27;Wed, 24 Jun 2015 11:49:22 GMT&#x27;，UTC时间，与本地时间相差8小时</span></span><br></pre></td></tr></table></figure>
<p>那么在JavaScript中如何进行时区转换呢？实际上，只要我们传递的是一个<code>number</code>类型的时间戳，我们就不用关心时区转换。任何浏览器都可以把一个时间戳正确转换为本地时间。</p>
<p>时间戳是个什么东西？时间戳是一个自增的整数，它表示从1970年1月1日零时整的GMT时区开始的那一刻，到现在的毫秒数。假设浏览器所在电脑的时间是准确的，那么世界上无论哪个时区的电脑，它们此刻产生的时间戳数字都是一样的，所以，时间戳可以精确地表示一个时刻，并且与时区无关。</p>
<p>所以，我们只需要传递时间戳，或者把时间戳从数据库里读出来，再让JavaScript自动转换为当地时间就可以了。</p>
<p>要获取当前时间戳，可以用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 方法1:</span><br><span class="line">console.log(Date.now());</span><br><span class="line"></span><br><span class="line">// 方法2:</span><br><span class="line">console.log(new Date().getTime());</span><br></pre></td></tr></table></figure>
<h3 id="练习">练习</h3>
<p>小明为了和女友庆祝情人节，特意制作了网页，并提前预定了法式餐厅。小明打算用JavaScript给女友一个惊喜留言：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let today = new Date();</span><br><span class="line">if (today.getMonth() === 2 &amp;&amp; today.getDate() === 14) &#123;</span><br><span class="line">    alert(&#x27;亲爱的，我预定了晚餐，晚上6点在餐厅见！&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果女友并未出现。小明非常郁闷，请你帮忙分析他的JavaScript代码有何问题。</p>
<p><img src="https://liaoxuefeng.com/books/javascript/standard-object/date/zgs.jpg" alt="注孤生"></p>
<p>字符串是编程时涉及到的最多的一种数据结构，对字符串进行操作的需求几乎无处不在。比如判断一个字符串是否是合法的Email地址，虽然可以编程提取<code>@</code>前后的子串，再分别判断是否是单词和域名，但这样做不但麻烦，而且代码难以复用。</p>
<p>正则表达式是一种用来匹配字符串的强有力的武器。它的设计思想是用一种描述性的语言来给字符串定义一个规则，凡是符合规则的字符串，我们就认为它“匹配”了，否则，该字符串就是不合法的。</p>
<p>所以我们判断一个字符串是否是合法的Email的方法是：</p>
<ol>
<li>创建一个匹配Email的正则表达式；</li>
<li>用该正则表达式去匹配用户的输入来判断是否合法。</li>
</ol>
<p>因为正则表达式也是用字符串表示的，所以，我们要首先了解如何用字符来描述字符。</p>
<p>在正则表达式中，如果直接给出字符，就是精确匹配。用<code>\d</code>可以匹配一个数字，<code>\w</code>可以匹配一个字母或数字，所以：</p>
<ul>
<li><code>'00\d'</code>可以匹配<code>'007'</code>，但无法匹配<code>'00A'</code>；</li>
<li><code>'\d\d\d'</code>可以匹配<code>'010'</code>；</li>
<li><code>'\w\w'</code>可以匹配<code>'js'</code>；</li>
</ul>
<p><code>.</code>可以匹配任意字符，所以：</p>
<ul>
<li><code>'js.'</code>可以匹配<code>'jsp'</code>、<code>'jss'</code>、<code>'js!'</code>等等。</li>
</ul>
<p>要匹配变长的字符，在正则表达式中，用<code>*</code>表示任意个字符（包括0个），用<code>+</code>表示至少一个字符，用<code>?</code>表示0个或1个字符，用<code>&#123;n&#125;</code>表示n个字符，用<code>&#123;n,m&#125;</code>表示n-m个字符：</p>
<p>来看一个复杂的例子：<code>\d&#123;3&#125;\s+\d&#123;3,8&#125;</code>。</p>
<p>我们来从左到右解读一下：</p>
<ol>
<li><code>\d&#123;3&#125;</code>表示匹配3个数字，例如<code>'010'</code>；</li>
<li><code>\s</code>可以匹配一个空格（也包括Tab等空白符），所以<code>\s+</code>表示至少有一个空格，例如匹配<code>' '</code>，<code>'\t\t'</code>等；</li>
<li><code>\d&#123;3,8&#125;</code>表示3-8个数字，例如<code>'1234567'</code>。</li>
</ol>
<p>综合起来，上面的正则表达式可以匹配以任意个空格隔开的带区号的电话号码。</p>
<p>如果要匹配<code>'010-12345'</code>这样的号码呢？由于<code>'-'</code>是特殊字符，在正则表达式中，要用<code>'\'</code>转义，所以，上面的正则是<code>\d&#123;3&#125;\-\d&#123;3,8&#125;</code>。</p>
<p>但是，仍然无法匹配<code>'010 - 12345'</code>，因为带有空格。所以我们需要更复杂的匹配方式。</p>
<h3 id="进阶">进阶</h3>
<p>要做更精确地匹配，可以用<code>[]</code>表示范围，比如：</p>
<ul>
<li><code>[0-9a-zA-Z\_]</code>可以匹配一个数字、字母或者下划线；</li>
<li><code>[0-9a-zA-Z\_]+</code>可以匹配至少由一个数字、字母或者下划线组成的字符串，比如<code>'a100'</code>，<code>'0_Z'</code>，<code>'js2015'</code>等等；</li>
<li><code>[a-zA-Z\_\$][0-9a-zA-Z\_\$]*</code>可以匹配由字母或下划线、开头，后接任意个由一个数字、字母或者下划线、开头，后接任意个由一个数字、字母或者下划线、组成的字符串，也就是JavaScript允许的变量名；</li>
<li><code>[a-zA-Z\_\$][0-9a-zA-Z\_\$]&#123;0, 19&#125;</code>更精确地限制了变量的长度是1-20个字符（前面1个字符+后面最多19个字符）。</li>
</ul>
<p><code>A|B</code>可以匹配A或B，所以<code>(J|j)ava(S|s)cript</code>可以匹配<code>'JavaScript'</code>、<code>'Javascript'</code>、<code>'javaScript'</code>或者<code>'javascript'</code>。</p>
<p><code>^</code>表示行的开头，<code>^\d</code>表示必须以数字开头。</p>
<p><code>$</code>表示行的结束，<code>\d$</code>表示必须以数字结束。</p>
<p>你可能注意到了，<code>js</code>也可以匹配<code>'jsp'</code>，但是加上<code>^js$</code>就变成了整行匹配，就只能匹配<code>'js'</code>了。</p>
<h3 id="RegExp">RegExp</h3>
<p>有了准备知识，我们就可以在JavaScript中使用正则表达式了。</p>
<p>JavaScript有两种方式创建一个正则表达式：</p>
<p>第一种方式是直接通过<code>/正则表达式/</code>写出来，第二种方式是通过<code>new RegExp('正则表达式')</code>创建一个RegExp对象。</p>
<p>两种写法是一样的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> re1 = <span class="regexp">/ABC\-001/</span>;</span><br><span class="line"><span class="keyword">let</span> re2 = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&#x27;ABC\\-001&#x27;</span>);</span><br><span class="line"></span><br><span class="line">re1; <span class="comment">// /ABC\-001/</span></span><br><span class="line">re2; <span class="comment">// /ABC\-001/</span></span><br></pre></td></tr></table></figure>
<p>注意，如果使用第二种写法，因为字符串的转义问题，字符串的两个<code>\\</code>实际上是一个<code>\</code>。</p>
<p>先看看如何判断正则表达式是否匹配：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> re = <span class="regexp">/^\d&#123;3&#125;\-\d&#123;3,8&#125;$/</span>;</span><br><span class="line">re.<span class="title function_">test</span>(<span class="string">&#x27;010-12345&#x27;</span>); <span class="comment">// true</span></span><br><span class="line">re.<span class="title function_">test</span>(<span class="string">&#x27;010-1234x&#x27;</span>); <span class="comment">// false</span></span><br><span class="line">re.<span class="title function_">test</span>(<span class="string">&#x27;010 12345&#x27;</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>RegExp对象的<code>test()</code>方法用于测试给定的字符串是否符合条件。</p>
<h3 id="切分字符串">切分字符串</h3>
<p>用正则表达式切分字符串比用固定的字符更灵活，请看正常的切分代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;a b   c&#x27;</span>.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>); <span class="comment">// [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;c&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>嗯，无法识别连续的空格，用正则表达式试试：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;a b   c&#x27;</span>.<span class="title function_">split</span>(<span class="regexp">/\s+/</span>); <span class="comment">// [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>无论多少个空格都可以正常分割。加入<code>,</code>试试：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;a,b, c  d&#x27;</span>.<span class="title function_">split</span>(<span class="regexp">/[\s\,]+/</span>); <span class="comment">// [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>再加入<code>;</code>试试：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;a,b;; c  d&#x27;</span>.<span class="title function_">split</span>(<span class="regexp">/[\s\,\;]+/</span>); <span class="comment">// [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>如果用户输入了一组标签，下次记得用正则表达式来把不规范的输入转化成正确的数组。</p>
<h3 id="分组">分组</h3>
<p>除了简单地判断是否匹配之外，正则表达式还有提取子串的强大功能。用<code>()</code>表示的就是要提取的分组（Group）。比如：</p>
<p><code>^(\d&#123;3&#125;)-(\d&#123;3,8&#125;)$</code>分别定义了两个组，可以直接从匹配的字符串中提取出区号和本地号码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> re = <span class="regexp">/^(\d&#123;3&#125;)-(\d&#123;3,8&#125;)$/</span>;</span><br><span class="line">re.<span class="title function_">exec</span>(<span class="string">&#x27;010-12345&#x27;</span>); <span class="comment">// [&#x27;010-12345&#x27;, &#x27;010&#x27;, &#x27;12345&#x27;]</span></span><br><span class="line">re.<span class="title function_">exec</span>(<span class="string">&#x27;010 12345&#x27;</span>); <span class="comment">// null</span></span><br></pre></td></tr></table></figure>
<p>如果正则表达式中定义了组，就可以在<code>RegExp</code>对象上用<code>exec()</code>方法提取出子串来。</p>
<p><code>exec()</code>方法在匹配成功后，会返回一个<code>Array</code>，第一个元素是正则表达式匹配到的整个字符串，后面的字符串表示匹配成功的子串。</p>
<p><code>exec()</code>方法在匹配失败时返回<code>null</code>。</p>
<p>提取子串非常有用。来看一个更凶残的例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> re = <span class="regexp">/^(0[0-9]|1[0-9]|2[0-3]|[0-9])\:(0[0-9]|1[0-9]|2[0-9]|3[0-9]|4[0-9]|5[0-9]|[0-9])\:(0[0-9]|1[0-9]|2[0-9]|3[0-9]|4[0-9]|5[0-9]|[0-9])$/</span>;</span><br><span class="line">re.<span class="title function_">exec</span>(<span class="string">&#x27;19:05:30&#x27;</span>); <span class="comment">// [&#x27;19:05:30&#x27;, &#x27;19&#x27;, &#x27;05&#x27;, &#x27;30&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>这个正则表达式可以直接识别合法的时间。但是有些时候，用正则表达式也无法做到完全验证，比如识别日期：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> re = <span class="regexp">/^(0[1-9]|1[0-2]|[0-9])-(0[1-9]|1[0-9]|2[0-9]|3[0-1]|[0-9])$/</span>;</span><br></pre></td></tr></table></figure>
<p>对于<code>'2-30'</code>，<code>'4-31'</code>这样的非法日期，用正则还是识别不了，或者说写出来非常困难，这时就需要程序配合识别了。</p>
<h3 id="贪婪匹配">贪婪匹配</h3>
<p>需要特别指出的是，正则匹配默认是贪婪匹配，也就是匹配尽可能多的字符。举例如下，匹配出数字后面的<code>0</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> re = <span class="regexp">/^(\d+)(0*)$/</span>;</span><br><span class="line">re.<span class="title function_">exec</span>(<span class="string">&#x27;102300&#x27;</span>); <span class="comment">// [&#x27;102300&#x27;, &#x27;102300&#x27;, &#x27;&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>由于<code>\d+</code>采用贪婪匹配，直接把后面的<code>0</code>全部匹配了，结果<code>0*</code>只能匹配空字符串了。</p>
<p>必须让<code>\d+</code>采用非贪婪匹配（也就是尽可能少匹配），才能把后面的<code>0</code>匹配出来，加个<code>?</code>就可以让<code>\d+</code>采用非贪婪匹配：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> re = <span class="regexp">/^(\d+?)(0*)$/</span>;</span><br><span class="line">re.<span class="title function_">exec</span>(<span class="string">&#x27;102300&#x27;</span>); <span class="comment">// [&#x27;102300&#x27;, &#x27;1023&#x27;, &#x27;00&#x27;]</span></span><br></pre></td></tr></table></figure>
<h3 id="全局搜索">全局搜索</h3>
<p>JavaScript的正则表达式还有几个特殊的标志，最常用的是<code>g</code>，表示全局匹配：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> r1 = <span class="regexp">/test/g</span>;</span><br><span class="line"><span class="comment">// 等价于:</span></span><br><span class="line"><span class="keyword">let</span> r2 = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;g&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>全局匹配可以多次执行<code>exec()</code>方法来搜索一个匹配的字符串。当我们指定<code>g</code>标志后，每次运行<code>exec()</code>，正则表达式本身会更新<code>lastIndex</code>属性，表示上次匹配到的最后索引：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">&#x27;JavaScript, VBScript, JScript and ECMAScript&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> re=<span class="regexp">/[a-zA-Z]+Script/g</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用全局匹配:</span></span><br><span class="line">re.<span class="title function_">exec</span>(s); <span class="comment">// [&#x27;JavaScript&#x27;]</span></span><br><span class="line">re.<span class="property">lastIndex</span>; <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line">re.<span class="title function_">exec</span>(s); <span class="comment">// [&#x27;VBScript&#x27;]</span></span><br><span class="line">re.<span class="property">lastIndex</span>; <span class="comment">// 20</span></span><br><span class="line"></span><br><span class="line">re.<span class="title function_">exec</span>(s); <span class="comment">// [&#x27;JScript&#x27;]</span></span><br><span class="line">re.<span class="property">lastIndex</span>; <span class="comment">// 29</span></span><br><span class="line"></span><br><span class="line">re.<span class="title function_">exec</span>(s); <span class="comment">// [&#x27;ECMAScript&#x27;]</span></span><br><span class="line">re.<span class="property">lastIndex</span>; <span class="comment">// 44</span></span><br><span class="line"></span><br><span class="line">re.<span class="title function_">exec</span>(s); <span class="comment">// null，直到结束仍没有匹配到</span></span><br></pre></td></tr></table></figure>
<p>全局匹配类似搜索，因此不能使用<code>/^...$/</code>，那样只会最多匹配一次。</p>
<p>正则表达式还可以指定<code>i</code>标志，表示忽略大小写，<code>m</code>标志，表示执行多行匹配。</p>
<h3 id="小结">小结</h3>
<p>正则表达式非常强大，要在短短的一节里讲完是不可能的。要讲清楚正则的所有内容，可以写一本厚厚的书了。如果你经常遇到正则表达式的问题，你可能需要一本正则表达式的参考书。</p>
<h3 id="练习-2">练习</h3>
<p>请尝试写一个验证Email地址的正则表达式。版本一应该可以验证出类似的Email：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">let re = /^$/;</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">let</span><br><span class="line">    i,</span><br><span class="line">    success = true,</span><br><span class="line">    should_pass = [&#x27;someone@gmail.com&#x27;, &#x27;bill.gates@microsoft.com&#x27;, &#x27;tom@voyager.org&#x27;, &#x27;bob2015@163.com&#x27;],</span><br><span class="line">    should_fail = [&#x27;test#gmail.com&#x27;, &#x27;bill@microsoft&#x27;, &#x27;bill%gates@ms.com&#x27;, &#x27;@voyager.org&#x27;];</span><br><span class="line">for (i = 0; i &lt; should_pass.length; i++) &#123;</span><br><span class="line">    if (!re.test(should_pass[i])) &#123;</span><br><span class="line">        console.log(&#x27;测试失败: &#x27; + should_pass[i]);</span><br><span class="line">        success = false;</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">for (i = 0; i &lt; should_fail.length; i++) &#123;</span><br><span class="line">    if (re.test(should_fail[i])) &#123;</span><br><span class="line">        console.log(&#x27;测试失败: &#x27; + should_fail[i]);</span><br><span class="line">        success = false;</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if (success) &#123;</span><br><span class="line">    console.log(&#x27;测试通过!&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>版本二可以验证并提取出带名字的Email地址：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">let re = /^$/;</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">let r = re.exec(&#x27;&lt;Tom Paris&gt; tom@voyager.org&#x27;);</span><br><span class="line">if (r === null || r.toString() !== [&#x27;&lt;Tom Paris&gt; tom@voyager.org&#x27;, &#x27;Tom Paris&#x27;, &#x27;tom@voyager.org&#x27;].toString()) &#123;</span><br><span class="line">    console.log(&#x27;测试失败!&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">    console.log(&#x27;测试成功!&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JSON是JavaScript Object Notation的缩写，它是一种数据交换格式。</p>
<p>在JSON出现之前，大家一直用XML来传递数据。因为XML是一种纯文本格式，所以它适合在网络上交换数据。XML本身不算复杂，但是，加上DTD、XSD、XPath、XSLT等一大堆复杂的规范以后，任何正常的软件开发人员碰到XML都会感觉头大了，最后大家发现，即使你努力钻研几个月，也未必搞得清楚XML的规范。</p>
<p>终于，在2002年的一天，道格拉斯·克罗克福特（Douglas Crockford）同学为了拯救深陷水深火热同时又被某几个巨型软件企业长期愚弄的软件工程师，发明了JSON这种超轻量级的数据交换格式。</p>
<p>道格拉斯同学长期担任雅虎的高级架构师，自然钟情于JavaScript。他设计的JSON实际上是JavaScript的一个子集。在JSON中，一共就这么几种数据类型：</p>
<ul>
<li>number：和JavaScript的<code>number</code>完全一致；</li>
<li>boolean：就是JavaScript的<code>true</code>或<code>false</code>；</li>
<li>string：就是JavaScript的<code>string</code>；</li>
<li>null：就是JavaScript的<code>null</code>；</li>
<li>array：就是JavaScript的<code>Array</code>表示方式——<code>[]</code>；</li>
<li>object：就是JavaScript的<code>&#123; ... &#125;</code>表示方式。</li>
</ul>
<p>以及上面的任意组合。</p>
<p>并且，JSON还定死了字符集必须是UTF-8，表示多语言就没有问题了。为了统一解析，JSON的字符串规定必须用双引号<code>&quot;&quot;</code>，Object的键也必须用双引号<code>&quot;&quot;</code>。</p>
<p>由于JSON非常简单，很快就风靡Web世界，并且成为ECMA标准。几乎所有编程语言都有解析JSON的库，而在JavaScript中，我们可以直接使用JSON，因为JavaScript内置了JSON的解析。</p>
<p>把任何JavaScript对象变成JSON，就是把这个对象序列化成一个JSON格式的字符串，这样才能够通过网络传递给其他计算机。</p>
<p>如果我们收到一个JSON格式的字符串，只需要把它反序列化成一个JavaScript对象，就可以在JavaScript中直接使用这个对象了。</p>
<h3 id="序列化">序列化</h3>
<p>让我们先把小明这个对象序列化成JSON格式的字符串：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">let xiaoming = &#123;</span><br><span class="line">    name: &#x27;小明&#x27;,</span><br><span class="line">    age: 14,</span><br><span class="line">    gender: true,</span><br><span class="line">    height: 1.65,</span><br><span class="line">    grade: null,</span><br><span class="line">    &#x27;middle-school&#x27;: &#x27;\&quot;W3C\&quot; Middle School&#x27;,</span><br><span class="line">    skills: [&#x27;JavaScript&#x27;, &#x27;Java&#x27;, &#x27;Python&#x27;, &#x27;Lisp&#x27;]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let s = JSON.stringify(xiaoming);</span><br><span class="line">console.log(s);</span><br></pre></td></tr></table></figure>
<p>要输出得好看一些，可以加上参数，按缩进输出：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>(xiaoming, <span class="literal">null</span>, <span class="string">&#x27;  &#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小明&quot;</span>,</span><br><span class="line">  <span class="string">&quot;age&quot;</span>: <span class="number">14</span>,</span><br><span class="line">  <span class="string">&quot;gender&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;height&quot;</span>: <span class="number">1.65</span>,</span><br><span class="line">  <span class="string">&quot;grade&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;middle-school&quot;</span>: <span class="string">&quot;\&quot;W3C\&quot; Middle School&quot;</span>,</span><br><span class="line">  <span class="string">&quot;skills&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;JavaScript&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Java&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Python&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Lisp&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二个参数用于控制如何筛选对象的键值，如果我们只想输出指定的属性，可以传入<code>Array</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>(xiaoming, [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;skills&#x27;</span>], <span class="string">&#x27;  &#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小明&quot;</span>,</span><br><span class="line">  <span class="string">&quot;skills&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;JavaScript&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Java&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Python&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Lisp&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还可以传入一个函数，这样对象的每个键值对都会被函数先处理：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">convert</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> value.<span class="title function_">toUpperCase</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>(xiaoming, convert, <span class="string">&#x27;  &#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>上面的代码把所有属性值都变成大写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小明&quot;</span>,</span><br><span class="line">  <span class="string">&quot;age&quot;</span>: <span class="number">14</span>,</span><br><span class="line">  <span class="string">&quot;gender&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;height&quot;</span>: <span class="number">1.65</span>,</span><br><span class="line">  <span class="string">&quot;grade&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;middle-school&quot;</span>: <span class="string">&quot;\&quot;W3C\&quot; MIDDLE SCHOOL&quot;</span>,</span><br><span class="line">  <span class="string">&quot;skills&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;JAVASCRIPT&quot;</span>,</span><br><span class="line">    <span class="string">&quot;JAVA&quot;</span>,</span><br><span class="line">    <span class="string">&quot;PYTHON&quot;</span>,</span><br><span class="line">    <span class="string">&quot;LISP&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果我们还想要精确控制如何序列化小明，可以给<code>xiaoming</code>定义一个<code>toJSON()</code>的方法，直接返回JSON应该序列化的数据：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">14</span>,</span><br><span class="line">    <span class="attr">gender</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">1.65</span>,</span><br><span class="line">    <span class="attr">grade</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">&#x27;middle-school&#x27;</span>: <span class="string">&#x27;\&quot;W3C\&quot; Middle School&#x27;</span>,</span><br><span class="line">    <span class="attr">skills</span>: [<span class="string">&#x27;JavaScript&#x27;</span>, <span class="string">&#x27;Java&#x27;</span>, <span class="string">&#x27;Python&#x27;</span>, <span class="string">&#x27;Lisp&#x27;</span>],</span><br><span class="line">    <span class="attr">toJSON</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="comment">// 只输出name和age，并且改变了key：</span></span><br><span class="line">            <span class="string">&#x27;Name&#x27;</span>: <span class="variable language_">this</span>.<span class="property">name</span>,</span><br><span class="line">            <span class="string">&#x27;Age&#x27;</span>: <span class="variable language_">this</span>.<span class="property">age</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>(xiaoming); <span class="comment">// &#x27;&#123;&quot;Name&quot;:&quot;小明&quot;,&quot;Age&quot;:14&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="反序列化">反序列化</h3>
<p>拿到一个JSON格式的字符串，我们直接用<code>JSON.parse()</code>把它变成一个JavaScript对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="string">&#x27;[1,2,3,true]&#x27;</span>); <span class="comment">// [1, 2, 3, true]</span></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="string">&#x27;&#123;&quot;name&quot;:&quot;小明&quot;,&quot;age&quot;:14&#125;&#x27;</span>); <span class="comment">// Object &#123;name: &#x27;小明&#x27;, age: 14&#125;</span></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="string">&#x27;true&#x27;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="string">&#x27;123.45&#x27;</span>); <span class="comment">// 123.45</span></span><br></pre></td></tr></table></figure>
<p><code>JSON.parse()</code>还可以接收一个函数，用来转换解析出的属性：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let obj = JSON.parse(&#x27;&#123;&quot;name&quot;:&quot;小明&quot;,&quot;age&quot;:14&#125;&#x27;, function (key, value) &#123;</span><br><span class="line">    if (key === &#x27;name&#x27;) &#123;</span><br><span class="line">        return value + &#x27;同学&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    return value;</span><br><span class="line">&#125;);</span><br><span class="line">console.log(JSON.stringify(obj)); // &#123;name: &#x27;小明同学&#x27;, age: 14&#125;</span><br></pre></td></tr></table></figure>
<p>在JavaScript中使用JSON，就是这么简单！</p>
<h3 id="练习-3">练习</h3>
<p>用浏览器访问OpenWeatherMap的<a target="_blank" rel="noopener" href="https://api.openweathermap.org/data/2.5/forecast?q=Beijing,cn&amp;appid=800f49846586c3ba6e7052cfc89af16c">天气API</a>，查看返回的JSON数据，然后返回城市、天气预报等信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">let url = &#x27;https://api.openweathermap.org/data/2.5/forecast?q=Beijing,cn&amp;appid=800f49846586c3ba6e7052cfc89af16c&#x27;;</span><br><span class="line">fetch(url).then(resp =&gt; &#123;</span><br><span class="line">    resp.json().then(data =&gt; &#123;</span><br><span class="line">        let info = &#123;</span><br><span class="line">            city: data.city.name,</span><br><span class="line">            weather: data.list[0].weather[0].main,</span><br><span class="line">            time: data.list[0].dt_txt</span><br><span class="line">        &#125;;</span><br><span class="line">        alert(JSON.stringify(info, null, &#x27;  &#x27;));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../../../2024/01/12/JavaScript/JavaScript-%E6%A0%87%E5%87%86%E5%AF%B9%E8%B1%A1/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../../../2024/01/11/JavaScript/JavaScript-%E5%87%BD%E6%95%B0/"
                            aria-label=": JavaScript-函数"
                        >
                            JavaScript-函数
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2024-01-11T21:05:28+08:00">
	
		    2024 年 1 月 11 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../">编程语言</a>, <a class="category-link" href="../../JavaScript/">JavaScript</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="函数">函数</h2>
<p>我们知道圆的面积计算公式为：</p>
<p>当我们知道半径<code>r</code>的值时，就可以根据公式计算出面积。假设我们需要计算3个不同大小的圆的面积：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> r1 = <span class="number">12.34</span>;</span><br><span class="line"><span class="keyword">let</span> r2 = <span class="number">9.08</span>;</span><br><span class="line"><span class="keyword">let</span> r3 = <span class="number">73.1</span>;</span><br><span class="line"><span class="keyword">let</span> s1 = <span class="number">3.14</span> * r1 * r1;</span><br><span class="line"><span class="keyword">let</span> s2 = <span class="number">3.14</span> * r2 * r2;</span><br><span class="line"><span class="keyword">let</span> s3 = <span class="number">3.14</span> * r3 * r3;</span><br></pre></td></tr></table></figure>
<p>当代码出现有规律的重复的时候，你就需要当心了，每次写<code>3.14 * x * x</code>不仅很麻烦，而且，如果要把<code>3.14</code>改成<code>3.1416</code>的时候，得全部替换。</p>
<p>有了函数，我们就不再每次写<code>s = 3.14 * x * x</code>，而是写成更有意义的函数调用<code>s = area_of_circle(x)</code>，而函数<code>area_of_circle</code>本身只需要写一次，就可以多次调用。</p>
<p>基本上所有的高级语言都支持函数，JavaScript也不例外。JavaScript的函数不但是“头等公民”，而且可以像变量一样使用，具有非常强大的抽象能力。</p>
<h3 id="抽象">抽象</h3>
<p>抽象是数学中非常常见的概念。举个例子：</p>
<p>计算数列的和，比如：<code>1 + 2 + 3 + ... + 100</code>，写起来十分不方便，于是数学家发明了求和符号∑，可以把<code>1 + 2 + 3 + ... + 100</code>记作：</p>
<p>这种抽象记法非常强大，因为我们看到 ∑ 就可以理解成求和，而不是还原成低级的加法运算。</p>
<p>而且，这种抽象记法是可扩展的，比如：</p>
<p>还原成加法运算就变成了：</p>
<p>可见，借助抽象，我们才能不关心底层的具体计算过程，而直接在更高的层次上思考问题。</p>
<p>写计算机程序也是一样，函数就是最基本的一种代码抽象的方式。</p>
<hr>
<hr>
<h3 id="定义函数">定义函数</h3>
<p>在JavaScript中，定义函数的方式如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">abs</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (x &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述<code>abs()</code>函数的定义如下：</p>
<ul>
<li><code>function</code>指出这是一个函数定义；</li>
<li><code>abs</code>是函数的名称；</li>
<li><code>(x)</code>括号内列出函数的参数，多个参数以<code>,</code>分隔；</li>
<li><code>&#123; ... &#125;</code>之间的代码是函数体，可以包含若干语句，甚至可以没有任何语句。</li>
</ul>
<p>请注意，函数体内部的语句在执行时，一旦执行到<code>return</code>时，函数就执行完毕，并将结果返回。因此，函数内部通过条件判断和循环可以实现非常复杂的逻辑。</p>
<p>如果没有<code>return</code>语句，函数执行完毕后也会返回结果，只是结果为<code>undefined</code>。</p>
<p>由于JavaScript的函数也是一个对象，上述定义的<code>abs()</code>函数实际上是一个函数对象，而函数名<code>abs</code>可以视为指向该函数的变量。</p>
<p>因此，第二种定义函数的方式如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> abs = <span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (x &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在这种方式下，<code>function (x) &#123; ... &#125;</code>是一个匿名函数，它没有函数名。但是，这个匿名函数赋值给了变量<code>abs</code>，所以，通过变量<code>abs</code>就可以调用该函数。</p>
<p>上述两种定义<em>完全等价</em>，注意第二种方式按照完整语法需要在函数体末尾加一个<code>;</code>，表示赋值语句结束。</p>
<h3 id="调用函数">调用函数</h3>
<p>调用函数时，按顺序传入参数即可：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">abs</span>(<span class="number">10</span>); <span class="comment">// 返回10</span></span><br><span class="line"><span class="title function_">abs</span>(-<span class="number">9</span>); <span class="comment">// 返回9</span></span><br></pre></td></tr></table></figure>
<p>由于JavaScript允许传入任意个参数而不影响调用，因此传入的参数比定义的参数多也没有问题，虽然函数内部并不需要这些参数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">abs</span>(<span class="number">10</span>, <span class="string">&#x27;blablabla&#x27;</span>); <span class="comment">// 返回10</span></span><br><span class="line"><span class="title function_">abs</span>(-<span class="number">9</span>, <span class="string">&#x27;haha&#x27;</span>, <span class="string">&#x27;hehe&#x27;</span>, <span class="literal">null</span>); <span class="comment">// 返回9</span></span><br></pre></td></tr></table></figure>
<p>传入的参数比定义的少也没有问题：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">abs</span>(); <span class="comment">// 返回NaN</span></span><br></pre></td></tr></table></figure>
<p>此时<code>abs(x)</code>函数的参数<code>x</code>将收到<code>undefined</code>，计算结果为<code>NaN</code>。</p>
<p>要避免收到<code>undefined</code>，可以对参数进行检查：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">abs</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> x !== <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="string">&#x27;Not a number&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (x &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="arguments">arguments</h3>
<p>JavaScript还有一个免费赠送的关键字<code>arguments</code>，它只在函数内部起作用，并且永远指向当前函数的调用者传入的所有参数。<code>arguments</code>类似<code>Array</code>但它不是一个<code>Array</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function foo(x) &#123;</span><br><span class="line">    console.log(&#x27;x = &#x27; + x); // 10</span><br><span class="line">    for (let i=0; i&lt;arguments.length; i++) &#123;</span><br><span class="line">        console.log(&#x27;arg &#x27; + i + &#x27; = &#x27; + arguments[i]); // 10, 20, 30</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">foo(10, 20, 30);</span><br></pre></td></tr></table></figure>
<p>利用<code>arguments</code>，你可以获得调用者传入的所有参数。也就是说，即使函数不定义任何参数，还是可以拿到参数的值：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">abs</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> x = <span class="variable language_">arguments</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">return</span> x &gt;= <span class="number">0</span> ? x : -x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">abs</span>(); <span class="comment">// 0</span></span><br><span class="line"><span class="title function_">abs</span>(<span class="number">10</span>); <span class="comment">// 10</span></span><br><span class="line"><span class="title function_">abs</span>(-<span class="number">9</span>); <span class="comment">// 9</span></span><br></pre></td></tr></table></figure>
<p>实际上<code>arguments</code>最常用于判断传入参数的个数。你可能会看到这样的写法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// foo(a[, b], c)</span></span><br><span class="line"><span class="comment">// 接收2~3个参数，b是可选参数，如果只传2个参数，b默认为null：</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">a, b, c</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="comment">// 实际拿到的参数是a和b，c为undefined</span></span><br><span class="line">        c = b; <span class="comment">// 把b赋给c</span></span><br><span class="line">        b = <span class="literal">null</span>; <span class="comment">// b变为默认值</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>要把中间的参数<code>b</code>变为“可选”参数，就只能通过<code>arguments</code>判断，然后重新调整参数并赋值。</p>
<h3 id="rest参数">rest参数</h3>
<p>由于JavaScript函数允许接收任意个参数，于是我们就不得不用<code>arguments</code>来获取所有参数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> i, rest = [];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> &gt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">2</span>; i&lt;<span class="variable language_">arguments</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            rest.<span class="title function_">push</span>(<span class="variable language_">arguments</span>[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;a = &#x27;</span> + a);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;b = &#x27;</span> + b);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(rest);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了获取除了已定义参数<code>a</code>、<code>b</code>之外的参数，我们不得不用<code>arguments</code>，并且循环要从索引<code>2</code>开始以便排除前两个参数，这种写法很别扭，只是为了获得额外的<code>rest</code>参数，有没有更好的方法？</p>
<p>ES6标准引入了rest参数，上面的函数可以改写为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">a, b, ...rest</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;a = &#x27;</span> + a);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;b = &#x27;</span> + b);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(rest);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line"><span class="comment">// 结果:</span></span><br><span class="line"><span class="comment">// a = 1</span></span><br><span class="line"><span class="comment">// b = 2</span></span><br><span class="line"><span class="comment">// Array [ 3, 4, 5 ]</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(<span class="number">1</span>);</span><br><span class="line"><span class="comment">// 结果:</span></span><br><span class="line"><span class="comment">// a = 1</span></span><br><span class="line"><span class="comment">// b = undefined</span></span><br><span class="line"><span class="comment">// Array []</span></span><br></pre></td></tr></table></figure>
<p>rest参数只能写在最后，前面用<code>...</code>标识，从运行结果可知，传入的参数先绑定<code>a</code>、<code>b</code>，多余的参数以数组形式交给变量<code>rest</code>，所以，不再需要<code>arguments</code>我们就获取了全部参数。</p>
<p>如果传入的参数连正常定义的参数都没填满，也不要紧，rest参数会接收一个空数组（注意不是<code>undefined</code>）。</p>
<p>因为rest参数是ES6新标准，所以你需要测试一下浏览器是否支持。请用rest参数编写一个<code>sum()</code>函数，接收任意个参数并返回它们的和：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function sum(...rest) &#123;</span><br><span class="line">   ???</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">let i, args = [];</span><br><span class="line">for (i=1; i&lt;=100; i++) &#123;</span><br><span class="line">    args.push(i);</span><br><span class="line">&#125;</span><br><span class="line">if (sum() !== 0) &#123;</span><br><span class="line">    console.log(&#x27;测试失败: sum() = &#x27; + sum());</span><br><span class="line">&#125; else if (sum(1) !== 1) &#123;</span><br><span class="line">    console.log(&#x27;测试失败: sum(1) = &#x27; + sum(1));</span><br><span class="line">&#125; else if (sum(2, 3) !== 5) &#123;</span><br><span class="line">    console.log(&#x27;测试失败: sum(2, 3) = &#x27; + sum(2, 3));</span><br><span class="line">&#125; else if (sum.apply(null, args) !== 5050) &#123;</span><br><span class="line">    console.log(&#x27;测试失败: sum(1, 2, 3, ..., 100) = &#x27; + sum.apply(null, args));</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    console.log(&#x27;测试通过!&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="小心你的return语句">小心你的return语句</h3>
<p>前面我们讲到了JavaScript引擎有一个在行末自动添加分号的机制，这可能让你栽到return语句的一个大坑：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">name</span>: <span class="string">&#x27;foo&#x27;</span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(); <span class="comment">// &#123; name: &#x27;foo&#x27; &#125;</span></span><br></pre></td></tr></table></figure>
<p>如果把return语句拆成两行：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">        &#123; <span class="attr">name</span>: <span class="string">&#x27;foo&#x27;</span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<p><em>要小心了</em>，由于JavaScript引擎在行末自动添加分号的机制，上面的代码实际上变成了：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>; <span class="comment">// 自动添加了分号，相当于return undefined;</span></span><br><span class="line">        &#123; <span class="attr">name</span>: <span class="string">&#x27;foo&#x27;</span> &#125;; <span class="comment">// 这行语句已经没法执行到了</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以正确的多行写法是：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="comment">// 这里不会自动加分号，因为&#123;表示语句尚未结束</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;foo&#x27;</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="练习">练习</h3>
<p>定义一个计算圆面积的函数<code>area_of_circle()</code>，它有两个参数：</p>
<ul>
<li>r: 表示圆的半径；</li>
<li>pi: 表示π的值，如果不传，则默认3.14</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function area_of_circle(r, pi) &#123;</span><br><span class="line">    // FIXME:</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line">// 测试:</span><br><span class="line">if (area_of_circle(2) === 12.56 &amp;&amp; area_of_circle(2, 3.1416) === 12.5664) &#123;</span><br><span class="line">    console.log(&#x27;测试通过&#x27;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    console.log(&#x27;测试失败&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>小明是一个JavaScript新手，他写了一个<code>max()</code>函数，返回两个数中较大的那个：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function max(a, b) &#123;</span><br><span class="line">    if (a &gt; b) &#123;</span><br><span class="line">        return</span><br><span class="line">                a;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return</span><br><span class="line">                b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">console.log(max(15, 20));</span><br></pre></td></tr></table></figure>
<p>但是小明抱怨他的浏览器出问题了，无论传入什么数，<code>max()</code>函数总是返回<code>undefined</code>。请帮他指出问题并修复。</p>
<p>在JavaScript中，用<code>var</code>申明的变量实际上是有作用域的。</p>
<p>如果一个变量在函数体内部申明，则该变量的作用域为整个函数体，在函数体外不可引用该变量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line">    x = x + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">x = x + <span class="number">2</span>; <span class="comment">// ReferenceError! 无法在函数体外引用变量x</span></span><br></pre></td></tr></table></figure>
<p>如果两个不同的函数各自申明了同一个变量，那么该变量只在各自的函数体内起作用。换句话说，不同函数内部的同名变量互相独立，互不影响：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line">    x = x + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">    x = x + <span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于JavaScript的函数可以嵌套，此时，内部函数可以访问外部函数定义的变量，反过来则不行：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> y = x + <span class="number">1</span>; <span class="comment">// bar可以访问foo的变量x!</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> z = y + <span class="number">1</span>; <span class="comment">// ReferenceError! foo不可以访问bar的变量y!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果内部函数和外部函数的变量名重名怎么办？来测试一下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function foo() &#123;</span><br><span class="line">    var x = 1;</span><br><span class="line">    function bar() &#123;</span><br><span class="line">        var x = &#x27;A&#x27;;</span><br><span class="line">        console.log(&#x27;x in bar() = &#x27; + x); // &#x27;A&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(&#x27;x in foo() = &#x27; + x); // 1</span><br><span class="line">    bar();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo();</span><br></pre></td></tr></table></figure>
<p>这说明JavaScript的函数在查找变量时从自身函数定义开始，从“内”向“外”查找。如果内部函数定义了与外部函数重名的变量，则内部函数的变量将“屏蔽”外部函数的变量。</p>
<h3 id="变量提升">变量提升</h3>
<p>JavaScript的函数定义有个特点，它会先扫描整个函数体的语句，把所有用<code>var</code>申明的变量“提升”到函数顶部：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="string">&#x27;Hello, &#x27;</span> + y;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span><br><span class="line">    <span class="keyword">var</span> y = <span class="string">&#x27;Bob&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>();</span><br></pre></td></tr></table></figure>
<p>虽然是strict模式，但语句<code>var x = 'Hello, ' + y;</code>并不报错，原因是变量<code>y</code>在稍后申明了。但是<code>console.log</code>显示<code>Hello, undefined</code>，说明变量<code>y</code>的值为<code>undefined</code>。这正是因为JavaScript引擎自动提升了变量<code>y</code>的声明，但不会提升变量<code>y</code>的赋值。</p>
<p>对于上述<code>foo()</code>函数，JavaScript引擎看到的代码相当于：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> y; <span class="comment">// 提升变量y的申明，此时y为undefined</span></span><br><span class="line">    <span class="keyword">var</span> x = <span class="string">&#x27;Hello, &#x27;</span> + y;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span><br><span class="line">    y = <span class="string">&#x27;Bob&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于JavaScript的这一怪异的“特性”，我们在函数内部定义变量时，请严格遵守“在函数内部首先申明所有变量”这一规则。最常见的做法是用一个<code>var</code>申明函数内部用到的所有变量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span></span><br><span class="line">        x = <span class="number">1</span>, <span class="comment">// x初始化为1</span></span><br><span class="line">        y = x + <span class="number">1</span>, <span class="comment">// y初始化为2</span></span><br><span class="line">        z, i; <span class="comment">// z和i为undefined</span></span><br><span class="line">    <span class="comment">// 其他语句:</span></span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果不需要兼容低版本浏览器，完全可以用<code>let</code>代替<code>var</code>来申明变量。</p>
<p>注意</p>
<p>建议使用let申明变量，避免var申明变量时带来的隐患。</p>
<h3 id="全局作用域">全局作用域</h3>
<p>不在任何函数内定义的变量就具有全局作用域。实际上，JavaScript默认有一个全局对象<code>window</code>，全局作用域的变量实际上被绑定到<code>window</code>的一个属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> course = <span class="string">&#x27;Learn JavaScript&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(course); <span class="comment">// &#x27;Learn JavaScript&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">course</span>); <span class="comment">// &#x27;Learn JavaScript&#x27;</span></span><br></pre></td></tr></table></figure>
<p>因此，直接访问全局变量<code>course</code>和访问<code>window.course</code>是完全一样的。</p>
<p>你可能猜到了，由于函数定义有两种方式，以变量方式<code>var foo = function () &#123;&#125;</code>定义的函数实际上也是一个全局变量，因此，顶层函数的定义也被视为一个全局变量，并绑定到<code>window</code>对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(); <span class="comment">// 直接调用foo()</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">foo</span>(); <span class="comment">// 通过window.foo()调用</span></span><br></pre></td></tr></table></figure>
<p>进一步大胆地猜测，我们每次直接调用的<code>alert()</code>函数其实也是<code>window</code>的一个变量：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">window.alert(&#x27;调用window.alert()&#x27;);</span><br><span class="line">// 把alert保存到另一个变量:</span><br><span class="line">let old_alert = window.alert;</span><br><span class="line">// 给alert赋一个新函数:</span><br><span class="line">window.alert = function () &#123;&#125;</span><br><span class="line"></span><br><span class="line">alert(&#x27;无法用alert()显示了!&#x27;);</span><br><span class="line"></span><br><span class="line">// 恢复alert:</span><br><span class="line">window.alert = old_alert;</span><br><span class="line">alert(&#x27;又可以用alert()了!&#x27;);</span><br></pre></td></tr></table></figure>
<p>这说明JavaScript实际上只有一个全局作用域。任何变量（函数也视为变量），如果没有在当前函数作用域中找到，就会继续往上查找，最后如果在全局作用域中也没有找到，则报<code>ReferenceError</code>错误。</p>
<h3 id="名字空间">名字空间</h3>
<p>全局变量会绑定到<code>window</code>上，不同的JavaScript文件如果使用了相同的全局变量，或者定义了相同名字的顶层函数，都会造成命名冲突，并且很难被发现。</p>
<p>减少冲突的一个方法是把自己的所有变量和函数全部绑定到一个全局变量中。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 唯一的全局变量MYAPP:</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable constant_">MYAPP</span> = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 其他变量:</span></span><br><span class="line"><span class="variable constant_">MYAPP</span>.<span class="property">name</span> = <span class="string">&#x27;myapp&#x27;</span>;</span><br><span class="line"><span class="variable constant_">MYAPP</span>.<span class="property">version</span> = <span class="number">1.0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 其他函数:</span></span><br><span class="line"><span class="variable constant_">MYAPP</span>.<span class="property">foo</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;foo&#x27;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>把自己的代码全部放入唯一的名字空间<code>MYAPP</code>中，会大大减少全局变量冲突的可能。</p>
<p>许多著名的JavaScript库都是这么干的：jQuery，YUI，underscore等等。</p>
<h3 id="局部作用域">局部作用域</h3>
<p>由于JavaScript的变量作用域实际上是函数内部，我们在<code>for</code>循环等语句块中是无法定义具有局部作用域的变量的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">    i += <span class="number">100</span>; <span class="comment">// 仍然可以引用变量i</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了解决块级作用域，ES6引入了新的关键字<code>let</code>，用<code>let</code>替代<code>var</code>可以申明一个块级作用域的变量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</span><br><span class="line">        sum += i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// SyntaxError:</span></span><br><span class="line">    i += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="常量">常量</h3>
<p>由于<code>var</code>和<code>let</code>申明的是变量，如果要申明一个常量，在ES6之前是不行的，我们通常用全部大写的变量来表示“这是一个常量，不要修改它的值”：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable constant_">PI</span> = <span class="number">3.14</span>;</span><br></pre></td></tr></table></figure>
<p>ES6标准引入了新的关键字<code>const</code>来定义常量，<code>const</code>与<code>let</code>都具有块级作用域：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">PI</span> = <span class="number">3.14</span>;</span><br><span class="line"><span class="variable constant_">PI</span> = <span class="number">3</span>; <span class="comment">// 某些浏览器不报错，但是无效果！</span></span><br><span class="line"><span class="variable constant_">PI</span>; <span class="comment">// 3.14</span></span><br></pre></td></tr></table></figure>
<h3 id="解构赋值">解构赋值</h3>
<p>从ES6开始，JavaScript引入了解构赋值，可以同时对一组变量进行赋值。</p>
<p>什么是解构赋值？我们先看看传统的做法，如何把一个数组的元素分别赋值给几个变量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> array = [<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;JavaScript&#x27;</span>, <span class="string">&#x27;ES6&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> x = array[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">let</span> y = array[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">let</span> z = array[<span class="number">2</span>];</span><br></pre></td></tr></table></figure>
<p>现在，在ES6中，可以使用解构赋值，直接对多个变量同时赋值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 如果浏览器支持解构赋值就不会报错:</span><br><span class="line">let [x, y, z] = [&#x27;hello&#x27;, &#x27;JavaScript&#x27;, &#x27;ES6&#x27;];</span><br><span class="line"></span><br><span class="line">// x, y, z分别被赋值为数组对应元素:</span><br><span class="line">console.log(`x = $&#123;x&#125;, y = $&#123;y&#125;, z = $&#123;z&#125;`);</span><br></pre></td></tr></table></figure>
<p>注意，对数组元素进行解构赋值时，多个变量要用<code>[...]</code>括起来。</p>
<p>如果数组本身还有嵌套，也可以通过下面的形式进行解构赋值，注意嵌套层次和位置要保持一致：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [x, [y, z]] = [<span class="string">&#x27;hello&#x27;</span>, [<span class="string">&#x27;JavaScript&#x27;</span>, <span class="string">&#x27;ES6&#x27;</span>]];</span><br><span class="line">x; <span class="comment">// &#x27;hello&#x27;</span></span><br><span class="line">y; <span class="comment">// &#x27;JavaScript&#x27;</span></span><br><span class="line">z; <span class="comment">// &#x27;ES6&#x27;</span></span><br></pre></td></tr></table></figure>
<p>解构赋值还可以忽略某些元素：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [, , z] = [<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;JavaScript&#x27;</span>, <span class="string">&#x27;ES6&#x27;</span>]; <span class="comment">// 忽略前两个元素，只对z赋值第三个元素</span></span><br><span class="line">z; <span class="comment">// &#x27;ES6&#x27;</span></span><br></pre></td></tr></table></figure>
<p>如果需要从一个对象中取出若干属性，也可以使用解构赋值，便于快速获取对象的指定属性：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">let person = &#123;</span><br><span class="line">    name: &#x27;小明&#x27;,</span><br><span class="line">    age: 20,</span><br><span class="line">    gender: &#x27;male&#x27;,</span><br><span class="line">    passport: &#x27;G-12345678&#x27;,</span><br><span class="line">    school: &#x27;No.4 middle school&#x27;</span><br><span class="line">&#125;;</span><br><span class="line">let &#123;name, age, passport&#125; = person;</span><br><span class="line"></span><br><span class="line">// name, age, passport分别被赋值为对应属性:</span><br><span class="line">console.log(`name = $&#123;name&#125;, age = $&#123;age&#125;, passport = $&#123;passport&#125;`);</span><br></pre></td></tr></table></figure>
<p>对一个对象进行解构赋值时，同样可以直接对嵌套的对象属性进行赋值，只要保证对应的层次是一致的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">gender</span>: <span class="string">&#x27;male&#x27;</span>,</span><br><span class="line">    <span class="attr">passport</span>: <span class="string">&#x27;G-12345678&#x27;</span>,</span><br><span class="line">    <span class="attr">school</span>: <span class="string">&#x27;No.4 middle school&#x27;</span>,</span><br><span class="line">    <span class="attr">address</span>: &#123;</span><br><span class="line">        <span class="attr">city</span>: <span class="string">&#x27;Beijing&#x27;</span>,</span><br><span class="line">        <span class="attr">street</span>: <span class="string">&#x27;No.1 Road&#x27;</span>,</span><br><span class="line">        <span class="attr">zipcode</span>: <span class="string">&#x27;100001&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> &#123;name, <span class="attr">address</span>: &#123;city, zip&#125;&#125; = person;</span><br><span class="line">name; <span class="comment">// &#x27;小明&#x27;</span></span><br><span class="line">city; <span class="comment">// &#x27;Beijing&#x27;</span></span><br><span class="line">zip; <span class="comment">// undefined, 因为属性名是zipcode而不是zip</span></span><br><span class="line"><span class="comment">// 注意: address不是变量，而是为了让city和zip获得嵌套的address对象的属性:</span></span><br><span class="line">address; <span class="comment">// Uncaught ReferenceError: address is not defined</span></span><br></pre></td></tr></table></figure>
<p>使用解构赋值对对象属性进行赋值时，如果对应的属性不存在，变量将被赋值为<code>undefined</code>，这和引用一个不存在的属性获得<code>undefined</code>是一致的。如果要使用的变量名和属性名不一致，可以用下面的语法获取：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">gender</span>: <span class="string">&#x27;male&#x27;</span>,</span><br><span class="line">    <span class="attr">passport</span>: <span class="string">&#x27;G-12345678&#x27;</span>,</span><br><span class="line">    <span class="attr">school</span>: <span class="string">&#x27;No.4 middle school&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把passport属性赋值给变量id:</span></span><br><span class="line"><span class="keyword">let</span> &#123;name, <span class="attr">passport</span>:id&#125; = person;</span><br><span class="line">name; <span class="comment">// &#x27;小明&#x27;</span></span><br><span class="line">id; <span class="comment">// &#x27;G-12345678&#x27;</span></span><br><span class="line"><span class="comment">// 注意: passport不是变量，而是为了让变量id获得passport属性:</span></span><br><span class="line">passport; <span class="comment">// Uncaught ReferenceError: passport is not defined</span></span><br></pre></td></tr></table></figure>
<p>解构赋值还可以使用默认值，这样就避免了不存在的属性返回<code>undefined</code>的问题：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">gender</span>: <span class="string">&#x27;male&#x27;</span>,</span><br><span class="line">    <span class="attr">passport</span>: <span class="string">&#x27;G-12345678&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果person对象没有single属性，默认赋值为true:</span></span><br><span class="line"><span class="keyword">let</span> &#123;name, single=<span class="literal">true</span>&#125; = person;</span><br><span class="line">name; <span class="comment">// &#x27;小明&#x27;</span></span><br><span class="line">single; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>有些时候，如果变量已经被声明了，再次赋值的时候，正确的写法也会报语法错误：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明变量:</span></span><br><span class="line"><span class="keyword">let</span> x, y;</span><br><span class="line"><span class="comment">// 解构赋值:</span></span><br><span class="line">&#123;x, y&#125; = &#123; <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>, <span class="attr">x</span>: <span class="number">100</span>, <span class="attr">y</span>: <span class="number">200</span>&#125;;</span><br><span class="line"><span class="comment">// 语法错误: Uncaught SyntaxError: Unexpected token =</span></span><br></pre></td></tr></table></figure>
<p>这是因为JavaScript引擎把<code>&#123;</code>开头的语句当作了块处理，于是<code>=</code>不再合法。解决方法是用小括号括起来：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&#123;x, y&#125; = &#123; <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>, <span class="attr">x</span>: <span class="number">100</span>, <span class="attr">y</span>: <span class="number">200</span>&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="使用场景">使用场景</h3>
<p>解构赋值在很多时候可以大大简化代码。例如，交换两个变量<code>x</code>和<code>y</code>的值，可以这么写，不再需要临时变量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x=<span class="number">1</span>, y=<span class="number">2</span>;</span><br><span class="line">[x, y] = [y, x]</span><br></pre></td></tr></table></figure>
<p>快速获取当前页面的域名和路径：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;<span class="attr">hostname</span>:domain, <span class="attr">pathname</span>:path&#125; = location;</span><br></pre></td></tr></table></figure>
<p>如果一个函数接收一个对象作为参数，那么，可以使用解构直接把对象的属性绑定到变量中。例如，下面的函数可以快速创建一个<code>Date</code>对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">buildDate</span>(<span class="params">&#123;year, month, day, hour=<span class="number">0</span>, minute=<span class="number">0</span>, second=<span class="number">0</span>&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">`<span class="subst">$&#123;year&#125;</span>-<span class="subst">$&#123;month&#125;</span>-<span class="subst">$&#123;day&#125;</span> <span class="subst">$&#123;hour&#125;</span>:<span class="subst">$&#123;minute&#125;</span>:<span class="subst">$&#123;second&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>它的方便之处在于传入的对象只需要<code>year</code>、<code>month</code>和<code>day</code>这三个属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">buildDate</span>(&#123; <span class="attr">year</span>: <span class="number">2017</span>, <span class="attr">month</span>: <span class="number">1</span>, <span class="attr">day</span>: <span class="number">1</span> &#125;);</span><br><span class="line"><span class="comment">// Sun Jan 01 2017 00:00:00 GMT+0800 (CST)</span></span><br></pre></td></tr></table></figure>
<p>也可以传入<code>hour</code>、<code>minute</code>和<code>second</code>属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">buildDate</span>(&#123; <span class="attr">year</span>: <span class="number">2017</span>, <span class="attr">month</span>: <span class="number">1</span>, <span class="attr">day</span>: <span class="number">1</span>, <span class="attr">hour</span>: <span class="number">20</span>, <span class="attr">minute</span>: <span class="number">15</span> &#125;);</span><br><span class="line"><span class="comment">// Sun Jan 01 2017 20:15:00 GMT+0800 (CST)</span></span><br></pre></td></tr></table></figure>
<p>使用解构赋值可以减少代码量，但是，需要在支持ES6解构赋值特性的现代浏览器中才能正常运行。目前支持解构赋值的浏览器包括Chrome，Firefox，Edge等。</p>
<p>在一个对象中绑定函数，称为这个对象的方法。</p>
<p>在JavaScript中，对象的定义是这样的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>但是，如果我们给<code>xiaoming</code>绑定一个函数，就可以做更多的事情。比如，写个<code>age()</code>方法，返回<code>xiaoming</code>的年龄：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> y = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>();</span><br><span class="line">        <span class="keyword">return</span> y - <span class="variable language_">this</span>.<span class="property">birth</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xiaoming.<span class="property">age</span>; <span class="comment">// function xiaoming.age()</span></span><br><span class="line">xiaoming.<span class="title function_">age</span>(); <span class="comment">// 今年调用是25,明年调用就变成26了</span></span><br></pre></td></tr></table></figure>
<p>绑定到对象上的函数称为方法，和普通函数也没啥区别，但是它在内部使用了一个<code>this</code>关键字，这个东东是什么？</p>
<p>在一个方法内部，<code>this</code>是一个特殊变量，它始终指向当前对象，也就是<code>xiaoming</code>这个变量。所以，<code>this.birth</code>可以拿到<code>xiaoming</code>的<code>birth</code>属性。</p>
<p>让我们拆开写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getAge</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> y = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>();</span><br><span class="line">    <span class="keyword">return</span> y - <span class="variable language_">this</span>.<span class="property">birth</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span>,</span><br><span class="line">    <span class="attr">age</span>: getAge</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xiaoming.<span class="title function_">age</span>(); <span class="comment">// 25, 正常结果</span></span><br><span class="line"><span class="title function_">getAge</span>(); <span class="comment">// NaN</span></span><br></pre></td></tr></table></figure>
<p>单独调用函数<code>getAge()</code>怎么返回了<code>NaN</code>？<em>请注意</em>，我们已经进入到了JavaScript的一个大坑里。</p>
<p>JavaScript的函数内部如果调用了<code>this</code>，那么这个<code>this</code>到底指向谁？</p>
<p>答案是，视情况而定！</p>
<p>如果以对象的方法形式调用，比如<code>xiaoming.age()</code>，该函数的<code>this</code>指向被调用的对象，也就是<code>xiaoming</code>，这是符合我们预期的。</p>
<p>如果单独调用函数，比如<code>getAge()</code>，此时，该函数的<code>this</code>指向全局对象，也就是<code>window</code>。</p>
<p>坑爹啊！</p>
<p>更坑爹的是，如果这么写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fn = xiaoming.<span class="property">age</span>; <span class="comment">// 先拿到xiaoming的age函数</span></span><br><span class="line"><span class="title function_">fn</span>(); <span class="comment">// NaN</span></span><br></pre></td></tr></table></figure>
<p>也是不行的！要保证<code>this</code>指向正确，必须用<code>obj.xxx()</code>的形式调用！</p>
<p>由于这是一个巨大的设计错误，要想纠正可没那么简单。ECMA决定，在strict模式下让函数的<code>this</code>指向<code>undefined</code>，因此，在strict模式下，你会得到一个错误：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> y = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>();</span><br><span class="line">        <span class="keyword">return</span> y - <span class="variable language_">this</span>.<span class="property">birth</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> fn = xiaoming.<span class="property">age</span>;</span><br><span class="line"><span class="title function_">fn</span>(); <span class="comment">// Uncaught TypeError: Cannot read property &#x27;birth&#x27; of undefined</span></span><br></pre></td></tr></table></figure>
<p>这个决定只是让错误及时暴露出来，并没有解决<code>this</code>应该指向的正确位置。</p>
<p>有些时候，喜欢重构的你把方法重构了一下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">getAgeFromBirth</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> y = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>();</span><br><span class="line">            <span class="keyword">return</span> y - <span class="variable language_">this</span>.<span class="property">birth</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">getAgeFromBirth</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xiaoming.<span class="title function_">age</span>(); <span class="comment">// Uncaught TypeError: Cannot read property &#x27;birth&#x27; of undefined</span></span><br></pre></td></tr></table></figure>
<p>结果又报错了！原因是<code>this</code>指针只在<code>age</code>方法的函数内指向<code>xiaoming</code>，在函数内部定义的函数，<code>this</code>又指向<code>undefined</code>了！（在非strict模式下，它重新指向全局对象<code>window</code>！）</p>
<p>修复的办法也不是没有，我们用一个<code>that</code>变量首先捕获<code>this</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> that = <span class="variable language_">this</span>; <span class="comment">// 在方法内部一开始就捕获this</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">getAgeFromBirth</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> y = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>();</span><br><span class="line">            <span class="keyword">return</span> y - that.<span class="property">birth</span>; <span class="comment">// 用that而不是this</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">getAgeFromBirth</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xiaoming.<span class="title function_">age</span>(); <span class="comment">// 25</span></span><br></pre></td></tr></table></figure>
<p>用<code>let that = this;</code>，你就可以放心地在方法内部定义其他函数，而不是把所有语句都堆到一个方法中。</p>
<h3 id="apply">apply</h3>
<p>虽然在一个独立的函数调用中，根据是否是strict模式，<code>this</code>指向<code>undefined</code>或<code>window</code>，不过，我们还是可以控制<code>this</code>的指向的！</p>
<p>要指定函数的<code>this</code>指向哪个对象，可以用函数本身的<code>apply</code>方法，它接收两个参数，第一个参数就是需要绑定的<code>this</code>变量，第二个参数是<code>Array</code>，表示函数本身的参数。</p>
<p>用<code>apply</code>修复<code>getAge()</code>调用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getAge</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> y = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>();</span><br><span class="line">    <span class="keyword">return</span> y - <span class="variable language_">this</span>.<span class="property">birth</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span>,</span><br><span class="line">    <span class="attr">age</span>: getAge</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xiaoming.<span class="title function_">age</span>(); <span class="comment">// 25</span></span><br><span class="line">getAge.<span class="title function_">apply</span>(xiaoming, []); <span class="comment">// 25, this指向xiaoming, 参数为空</span></span><br></pre></td></tr></table></figure>
<p>另一个与<code>apply()</code>类似的方法是<code>call()</code>，唯一区别是：</p>
<ul>
<li><code>apply()</code>把参数打包成<code>Array</code>再传入；</li>
<li><code>call()</code>把参数按顺序传入。</li>
</ul>
<p>比如调用<code>Math.max(3, 5, 4)</code>，分别用<code>apply()</code>和<code>call()</code>实现如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Math</span>.<span class="property">max</span>.<span class="title function_">apply</span>(<span class="literal">null</span>, [<span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>]); <span class="comment">// 5</span></span><br><span class="line"><span class="title class_">Math</span>.<span class="property">max</span>.<span class="title function_">call</span>(<span class="literal">null</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>); <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>
<p>对普通函数调用，我们通常把<code>this</code>绑定为<code>null</code>。</p>
<h3 id="装饰器">装饰器</h3>
<p>利用<code>apply()</code>，我们还可以动态改变函数的行为。</p>
<p>JavaScript的所有对象都是动态的，即使内置的函数，我们也可以重新指向新的函数。</p>
<p>现在假定我们想统计一下代码一共调用了多少次<code>parseInt()</code>，可以把所有的调用都找出来，然后手动加上<code>count += 1</code>，不过这样做太傻了。最佳方案是用我们自己的函数替换掉默认的<code>parseInt()</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x27;use strict&#x27;;</span><br><span class="line"></span><br><span class="line">let count = 0;</span><br><span class="line">let oldParseInt = parseInt; // 保存原函数</span><br><span class="line"></span><br><span class="line">window.parseInt = function () &#123;</span><br><span class="line">    count += 1;</span><br><span class="line">    return oldParseInt.apply(null, arguments); // 调用原函数</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">parseInt(&#x27;10&#x27;);</span><br><span class="line">parseInt(&#x27;20&#x27;);</span><br><span class="line">parseInt(&#x27;30&#x27;);</span><br><span class="line">console.log(&#x27;count = &#x27; + count); // 3</span><br></pre></td></tr></table></figure>
<p>高阶函数英文叫Higher-order function。那么什么是高阶函数？</p>
<p>JavaScript的函数其实都指向某个变量。既然变量可以指向函数，函数的参数能接收变量，那么一个函数就可以接收另一个函数作为参数，这种函数就称之为高阶函数。</p>
<p>一个最简单的高阶函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">x, y, f</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">f</span>(x) + <span class="title function_">f</span>(y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们调用<code>add(-5, 6, Math.abs)</code>时，参数<code>x</code>，<code>y</code>和<code>f</code>分别接收<code>-5</code>，<code>6</code>和函数<code>Math.abs</code>，根据函数定义，我们可以推导计算过程为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x = -5;</span><br><span class="line">y = 6;</span><br><span class="line">f = Math.abs;</span><br><span class="line">f(x) + f(y) ==&gt; Math.abs(-5) + Math.abs(6) ==&gt; 11;</span><br><span class="line">return 11;</span><br></pre></td></tr></table></figure>
<p>用代码验证一下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function add(x, y, f) &#123;</span><br><span class="line">    return f(x) + f(y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let x = add(-5, 6, Math.abs);</span><br><span class="line">console.log(x); // 11</span><br></pre></td></tr></table></figure>
<p>编写高阶函数，就是让函数的参数能够接收别的函数。</p>
<p>如果你读过Google的那篇大名鼎鼎的论文“<a target="_blank" rel="noopener" href="https://research.google/pubs/mapreduce-simplified-data-processing-on-large-clusters/">MapReduce: Simplified Data Processing on Large Clusters</a>”，你就能大概明白map/reduce的概念。</p>
<h3 id="map">map</h3>
<p>举例说明，比如我们有一个函数f(x)=x2，要把这个函数作用在一个数组<code>[1, 2, 3, 4, 5, 6, 7, 8, 9]</code>上，就可以用<code>map</code>实现如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">            f(x) = x * x</span><br><span class="line"></span><br><span class="line">                  │</span><br><span class="line">                  │</span><br><span class="line">  ┌───┬───┬───┬───┼───┬───┬───┬───┐</span><br><span class="line">  │   │   │   │   │   │   │   │   │</span><br><span class="line">  ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼</span><br><span class="line"></span><br><span class="line">[ 1   2   3   4   5   6   7   8   9 ]</span><br><span class="line"></span><br><span class="line">  │   │   │   │   │   │   │   │   │</span><br><span class="line">  │   │   │   │   │   │   │   │   │</span><br><span class="line">  ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼</span><br><span class="line"></span><br><span class="line">[ 1   4   9  16  25  36  49  64  81 ]</span><br></pre></td></tr></table></figure>
<p>由于<code>map()</code>方法定义在JavaScript的<code>Array</code>中，我们调用<code>Array</code>的<code>map()</code>方法，传入我们自己的函数，就得到了一个新的<code>Array</code>作为结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function pow(x) &#123;</span><br><span class="line">    return x * x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let arr = [1, 2, 3, 4, 5, 6, 7, 8, 9];</span><br><span class="line">let results = arr.map(pow); // [1, 4, 9, 16, 25, 36, 49, 64, 81]</span><br><span class="line">console.log(results);</span><br></pre></td></tr></table></figure>
<p>注意：<code>map()</code>传入的参数是<code>pow</code>，即函数对象本身。</p>
<p>你可能会想，不需要<code>map()</code>，写一个循环，也可以计算出结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> f = <span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>];</span><br><span class="line"><span class="keyword">let</span> result = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    result.<span class="title function_">push</span>(<span class="title function_">f</span>(arr[i]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>的确可以，但是，从上面的循环代码，我们无法一眼看明白“把f(x)作用在Array的每一个元素并把结果生成一个新的Array”。</p>
<p>所以，<code>map()</code>作为高阶函数，事实上它把运算规则抽象了，因此，我们不但可以计算简单的f(x)=x2，还可以计算任意复杂的函数，比如，把<code>Array</code>的所有数字转为字符串：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>];</span><br><span class="line">arr.<span class="title function_">map</span>(<span class="title class_">String</span>); <span class="comment">// [&#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;, &#x27;6&#x27;, &#x27;7&#x27;, &#x27;8&#x27;, &#x27;9&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>只需要一行代码。</p>
<h3 id="reduce">reduce</h3>
<p>再看reduce的用法。Array的<code>reduce()</code>把一个函数作用在这个<code>Array</code>的<code>[x1, x2, x3...]</code>上，这个函数必须接收两个参数，<code>reduce()</code>把结果继续和序列的下一个元素做累积计算，其效果就是：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[x1, x2, x3, x4].<span class="title function_">reduce</span>(f) = <span class="title function_">f</span>(<span class="title function_">f</span>(<span class="title function_">f</span>(x1, x2), x3), x4)</span><br></pre></td></tr></table></figure>
<p>比方说对一个<code>Array</code>求和，就可以用<code>reduce</code>实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>];</span><br><span class="line">arr.<span class="title function_">reduce</span>(<span class="keyword">function</span> (<span class="params">x, y</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;); <span class="comment">// 25</span></span><br></pre></td></tr></table></figure>
<p>如果数组元素只有1个，那么还需要提供一个额外的初始参数以便至少凑够两：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">123</span>];</span><br><span class="line">arr.<span class="title function_">reduce</span>(<span class="keyword">function</span> (<span class="params">x, y</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;, <span class="number">0</span>); <span class="comment">// 123</span></span><br></pre></td></tr></table></figure>
<p>练习：利用<code>reduce()</code>求积：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function product(arr) &#123;</span><br><span class="line">    // FIXME:</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">if (product([1, 2, 3, 4]) === 24 &amp;&amp; product([0, 1, 2]) === 0 &amp;&amp; product([99, 88, 77, 66]) === 44274384) &#123;</span><br><span class="line">    console.log(&#x27;测试通过!&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">    console.log(&#x27;测试失败!&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>要把<code>[1, 3, 5, 7, 9]</code>变换成整数13579，<code>reduce()</code>也能派上用场：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>];</span><br><span class="line">arr.<span class="title function_">reduce</span>(<span class="keyword">function</span> (<span class="params">x, y</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x * <span class="number">10</span> + y;</span><br><span class="line">&#125;); <span class="comment">// 13579</span></span><br></pre></td></tr></table></figure>
<p>如果我们继续改进这个例子，想办法把一个字符串<code>13579</code>先变成<code>Array</code>——<code>[1, 3, 5, 7, 9]</code>，再利用<code>reduce()</code>就可以写出一个把字符串转换为Number的函数。</p>
<p>练习：不要使用JavaScript内置的<code>parseInt()</code>函数，利用map和reduce操作实现一个<code>string2int()</code>函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function string2int(s) &#123;</span><br><span class="line">    // FIXME:</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">if (string2int(&#x27;0&#x27;) === 0 &amp;&amp; string2int(&#x27;12345&#x27;) === 12345 &amp;&amp; string2int(&#x27;12300&#x27;) === 12300) &#123;</span><br><span class="line">    if (string2int.toString().indexOf(&#x27;parseInt&#x27;) !== -1) &#123;</span><br><span class="line">        console.log(&#x27;请勿使用parseInt()!&#x27;);</span><br><span class="line">    &#125; else if (string2int.toString().indexOf(&#x27;Number&#x27;) !== -1) &#123;</span><br><span class="line">        console.log(&#x27;请勿使用Number()!&#x27;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(&#x27;测试通过!&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">    console.log(&#x27;测试失败!&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="练习-2">练习</h3>
<p>请把用户输入的不规范的英文名字，变为首字母大写，其他小写的规范名字。输入：<code>['adam', 'LISA', 'barT']</code>，输出：<code>['Adam', 'Lisa', 'Bart']</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function normalize(arr) &#123;</span><br><span class="line">    // FIXME:</span><br><span class="line">    return [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">if (normalize([&#x27;adam&#x27;, &#x27;LISA&#x27;, &#x27;barT&#x27;]).toString() === [&#x27;Adam&#x27;, &#x27;Lisa&#x27;, &#x27;Bart&#x27;].toString()) &#123;</span><br><span class="line">    console.log(&#x27;测试通过!&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">    console.log(&#x27;测试失败!&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>小明希望利用<code>map()</code>把字符串变成整数，他写的代码很简洁：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let arr = [&#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;];</span><br><span class="line">let r;</span><br><span class="line"></span><br><span class="line">r = arr.map(parseInt);</span><br><span class="line">console.log(r);</span><br></pre></td></tr></table></figure>
<p>结果竟然是<code>1</code>, <code>NaN</code>, <code>NaN</code>，小明百思不得其解，请帮他找到原因并修正代码。</p>
<p>提示：参考<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/map">Array.prototype.map()的文档</a>。</p>
<p>原因分析:</p>
<p>由于map()接收的回调函数可以有3个参数：callback(currentValue, index, array)，通常我们仅需要第一个参数，而忽略了传入的后面两个参数。不幸的是，parseInt(string, radix)没有忽略第二个参数，导致实际执行的函数分别是：</p>
<p>parseInt(‘1’, 0); // 1, 按十进制转换<br>
parseInt(‘2’, 1); // NaN, 没有一进制<br>
parseInt(‘3’, 2); // NaN, 按二进制转换不允许出现3<br>
可以改为r = arr.map(Number);，因为Number(value)函数仅接收一个参数。</p>
<p>filter也是一个常用的操作，它用于把<code>Array</code>的某些元素过滤掉，然后返回剩下的元素。</p>
<p>和<code>map()</code>类似，<code>Array</code>的<code>filter()</code>也接收一个函数。和<code>map()</code>不同的是，<code>filter()</code>把传入的函数依次作用于每个元素，然后根据返回值是<code>true</code>还是<code>false</code>决定保留还是丢弃该元素。</p>
<p>例如，在一个<code>Array</code>中，删掉偶数，只保留奇数，可以这么写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">15</span>];</span><br><span class="line"><span class="keyword">let</span> r = arr.<span class="title function_">filter</span>(<span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x % <span class="number">2</span> !== <span class="number">0</span>;</span><br><span class="line">&#125;);</span><br><span class="line">r; <span class="comment">// [1, 5, 9, 15]</span></span><br></pre></td></tr></table></figure>
<p>把一个<code>Array</code>中的空字符串删掉，可以这么写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="literal">null</span>, <span class="literal">undefined</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;  &#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> r = arr.<span class="title function_">filter</span>(<span class="keyword">function</span> (<span class="params">s</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> s &amp;&amp; s.<span class="title function_">trim</span>(); <span class="comment">// 注意：IE9以下的版本没有trim()方法</span></span><br><span class="line">&#125;);</span><br><span class="line">r; <span class="comment">// [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>可见用<code>filter()</code>这个高阶函数，关键在于正确实现一个“筛选”函数。</p>
<h3 id="回调函数">回调函数</h3>
<p><code>filter()</code>接收的回调函数，其实可以有多个参数。通常我们仅使用第一个参数，表示<code>Array</code>的某个元素。回调函数还可以接收另外两个参数，表示元素的位置和数组本身：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> r = arr.<span class="title function_">filter</span>(<span class="keyword">function</span> (<span class="params">element, index, self</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(element); <span class="comment">// 依次打印&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(index); <span class="comment">// 依次打印0, 1, 2</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(self); <span class="comment">// self就是变量arr</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>利用<code>filter</code>，可以巧妙地去除<code>Array</code>的重复元素：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let</span><br><span class="line">    r,</span><br><span class="line">    arr = [&#x27;apple&#x27;, &#x27;strawberry&#x27;, &#x27;banana&#x27;, &#x27;pear&#x27;, &#x27;apple&#x27;, &#x27;orange&#x27;, &#x27;orange&#x27;, &#x27;strawberry&#x27;];</span><br><span class="line"></span><br><span class="line">r = arr.filter(function (element, index, self) &#123;</span><br><span class="line">    return self.indexOf(element) === index;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">console.log(r);</span><br></pre></td></tr></table></figure>
<p>去除重复元素依靠的是<code>indexOf</code>总是返回第一个元素的位置，后续的重复元素位置与<code>indexOf</code>返回的位置不相等，因此被<code>filter</code>滤掉了。</p>
<h3 id="练习-3">练习</h3>
<p>请尝试用<code>filter()</code>筛选出素数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function get_primes(arr) &#123;</span><br><span class="line">    // FIXME:</span><br><span class="line">    return [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">let</span><br><span class="line">    x,</span><br><span class="line">    r,</span><br><span class="line">    arr = [];</span><br><span class="line">for (x = 1; x &lt; 100; x++) &#123;</span><br><span class="line">    arr.push(x);</span><br><span class="line">&#125;</span><br><span class="line">r = get_primes(arr);</span><br><span class="line">if (r.toString() === [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97].toString()) &#123;</span><br><span class="line">    console.log(&#x27;测试通过!&#x27;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    console.log(&#x27;测试失败: &#x27; + r.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="排序算法">排序算法</h3>
<p>排序也是在程序中经常用到的算法。无论使用冒泡排序还是快速排序，排序的核心是比较两个元素的大小。如果是数字，我们可以直接比较，但如果是字符串或者两个对象呢？直接比较数学上的大小是没有意义的，因此，比较的过程必须通过函数抽象出来。通常规定，对于两个元素<code>x</code>和<code>y</code>，如果认为<code>x &lt; y</code>，则返回<code>-1</code>，如果认为<code>x == y</code>，则返回<code>0</code>，如果认为<code>x &gt; y</code>，则返回<code>1</code>，这样，排序算法就不用关心具体的比较过程，而是根据比较结果直接排序。</p>
<p>JavaScript的<code>Array</code>的<code>sort()</code>方法就是用于排序的，但是排序结果可能让你大吃一惊：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 看上去正常的结果:</span></span><br><span class="line">[<span class="string">&#x27;Google&#x27;</span>, <span class="string">&#x27;Apple&#x27;</span>, <span class="string">&#x27;Microsoft&#x27;</span>].<span class="title function_">sort</span>(); <span class="comment">// [&#x27;Apple&#x27;, &#x27;Google&#x27;, &#x27;Microsoft&#x27;];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// apple排在了最后:</span></span><br><span class="line">[<span class="string">&#x27;Google&#x27;</span>, <span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;Microsoft&#x27;</span>].<span class="title function_">sort</span>(); <span class="comment">// [&#x27;Google&#x27;, &#x27;Microsoft&quot;, &#x27;apple&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 无法理解的结果:</span></span><br><span class="line">[<span class="number">10</span>, <span class="number">20</span>, <span class="number">1</span>, <span class="number">2</span>].<span class="title function_">sort</span>(); <span class="comment">// [1, 10, 2, 20]</span></span><br></pre></td></tr></table></figure>
<p>第二个排序把<code>apple</code>排在了最后，是因为字符串根据ASCII码进行排序，而小写字母<code>a</code>的ASCII码在大写字母之后。</p>
<p>第三个排序结果是什么鬼？简单的数字排序都能错？</p>
<p>这是因为<code>Array</code>的<code>sort()</code>方法默认把所有元素先转换为String再排序，结果<code>'10'</code>排在了<code>'2'</code>的前面，因为字符<code>'1'</code>比字符<code>'2'</code>的ASCII码小。</p>
<p><img src="https://liaoxuefeng.com/books/javascript/function/higher-order-function/sort/douwo.jpg" alt="douwo"></p>
<p>如果不知道<code>sort()</code>方法的默认排序规则，直接对数字排序，绝对栽进坑里！</p>
<p>幸运的是，<code>sort()</code>方法也是一个高阶函数，它还可以接收一个比较函数来实现自定义的排序。</p>
<p>要按数字大小排序，我们可以这么写：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">let arr = [10, 20, 1, 2];</span><br><span class="line"></span><br><span class="line">arr.sort(function (x, y) &#123;</span><br><span class="line">    if (x &lt; y) &#123;</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line">    if (x &gt; y) &#123;</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">console.log(arr); // [1, 2, 10, 20]</span><br></pre></td></tr></table></figure>
<p>如果要倒序排序，我们可以把大的数放前面：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">10</span>, <span class="number">20</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">arr.<span class="title function_">sort</span>(<span class="keyword">function</span> (<span class="params">x, y</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> y - x;</span><br><span class="line">&#125;); <span class="comment">// [20, 10, 2, 1]</span></span><br></pre></td></tr></table></figure>
<p>给<code>sort()</code>传入的比较函数接受<code>x</code>和<code>y</code>两个参数，如果<code>x&lt;y</code>，应返回负数，如果<code>x&gt;y</code>，应返回正数，如果<code>x=y</code>，应返回0。</p>
<p>默认情况下，对字符串排序，是按照ASCII的大小比较的，现在，我们提出排序应该忽略大小写，按照字母序排序。要实现这个算法，不必对现有代码大加改动，只要我们能定义出忽略大小写的比较算法就可以：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;Google&#x27;</span>, <span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;Microsoft&#x27;</span>];</span><br><span class="line">arr.<span class="title function_">sort</span>(<span class="keyword">function</span> (<span class="params">s1, s2</span>) &#123;</span><br><span class="line">    x1 = s1.<span class="title function_">toUpperCase</span>();</span><br><span class="line">    x2 = s2.<span class="title function_">toUpperCase</span>();</span><br><span class="line">    <span class="keyword">if</span> (x1 &lt; x2) &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (x1 &gt; x2) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;); <span class="comment">// [&#x27;apple&#x27;, &#x27;Google&#x27;, &#x27;Microsoft&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>忽略大小写来比较两个字符串，实际上就是先把字符串都变成大写（或者都变成小写），再比较。</p>
<p>从上述例子可以看出，高阶函数的抽象能力是非常强大的，而且，核心代码可以保持得非常简洁。</p>
<p>最后友情提示，<code>sort()</code>方法会直接对<code>Array</code>进行修改，它返回的结果仍是当前<code>Array</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 = [<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;C&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> a2 = a1.<span class="title function_">sort</span>();</span><br><span class="line">a1; <span class="comment">// [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;]</span></span><br><span class="line">a2; <span class="comment">// [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;]</span></span><br><span class="line">a1 === a2; <span class="comment">// true, a1和a2是同一对象</span></span><br></pre></td></tr></table></figure>
<h2 id="Array">Array</h2>
<p>对于数组，除了<code>map()</code>、<code>reduce</code>、<code>filter()</code>、<code>sort()</code>这些方法可以传入一个函数外，<code>Array</code>对象还提供了很多非常实用的高阶函数。</p>
<h3 id="every">every</h3>
<p><code>every()</code>方法可以判断数组的所有元素是否满足测试条件。</p>
<p>例如，给定一个包含若干字符串的数组，判断所有字符串是否满足指定的测试条件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let arr = [&#x27;Apple&#x27;, &#x27;pear&#x27;, &#x27;orange&#x27;];</span><br><span class="line">console.log(arr.every(function (s) &#123;</span><br><span class="line">    return s.length &gt; 0;</span><br><span class="line">&#125;)); // true, 因为每个元素都满足s.length&gt;0</span><br><span class="line"></span><br><span class="line">console.log(arr.every(function (s) &#123;</span><br><span class="line">    return s.toLowerCase() === s;</span><br><span class="line">&#125;)); // false, 因为不是每个元素都全部是小写</span><br></pre></td></tr></table></figure>
<h3 id="find">find</h3>
<p><code>find()</code>方法用于查找符合条件的第一个元素，如果找到了，返回这个元素，否则，返回<code>undefined</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let arr = [&#x27;Apple&#x27;, &#x27;pear&#x27;, &#x27;orange&#x27;];</span><br><span class="line">console.log(arr.find(function (s) &#123;</span><br><span class="line">    return s.toLowerCase() === s;</span><br><span class="line">&#125;)); // &#x27;pear&#x27;, 因为pear全部是小写</span><br><span class="line"></span><br><span class="line">console.log(arr.find(function (s) &#123;</span><br><span class="line">    return s.toUpperCase() === s;</span><br><span class="line">&#125;)); // undefined, 因为没有全部是大写的元素</span><br></pre></td></tr></table></figure>
<h3 id="findIndex">findIndex</h3>
<p><code>findIndex()</code>和<code>find()</code>类似，也是查找符合条件的第一个元素，不同之处在于<code>findIndex()</code>会返回这个元素的索引，如果没有找到，返回<code>-1</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let arr = [&#x27;Apple&#x27;, &#x27;pear&#x27;, &#x27;orange&#x27;];</span><br><span class="line">console.log(arr.findIndex(function (s) &#123;</span><br><span class="line">    return s.toLowerCase() === s;</span><br><span class="line">&#125;)); // 1, 因为&#x27;pear&#x27;的索引是1</span><br><span class="line"></span><br><span class="line">console.log(arr.findIndex(function (s) &#123;</span><br><span class="line">    return s.toUpperCase() === s;</span><br><span class="line">&#125;)); // -1</span><br></pre></td></tr></table></figure>
<h3 id="forEach">forEach</h3>
<p><code>forEach()</code>和<code>map()</code>类似，它也把每个元素依次作用于传入的函数，但不会返回新的数组。<code>forEach()</code>常用于遍历数组，因此，传入的函数不需要返回值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let arr = [&#x27;Apple&#x27;, &#x27;pear&#x27;, &#x27;orange&#x27;];</span><br><span class="line">arr.forEach(x=&gt;console.log(x)); // 依次打印每个元素</span><br></pre></td></tr></table></figure>
<hr>
<hr>
<h3 id="函数作为返回值">函数作为返回值</h3>
<p>高阶函数除了可以接受函数作为参数外，还可以把函数作为结果值返回。</p>
<p>我们来实现一个对<code>Array</code>的求和。通常情况下，求和的函数是这样定义的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> arr.<span class="title function_">reduce</span>(<span class="keyword">function</span> (<span class="params">x, y</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">sum</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]); <span class="comment">// 15</span></span><br></pre></td></tr></table></figure>
<p>但是，如果不需要立刻求和，而是在后面的代码中，根据需要再计算怎么办？可以不返回求和的结果，而是返回求和的函数！</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">lazy_sum</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> sum = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> arr.<span class="title function_">reduce</span>(<span class="keyword">function</span> (<span class="params">x, y</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> x + y;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们调用<code>lazy_sum()</code>时，返回的并不是求和结果，而是求和函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> f = <span class="title function_">lazy_sum</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]); <span class="comment">// function sum()</span></span><br></pre></td></tr></table></figure>
<p>调用函数<code>f</code>时，才真正计算求和的结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">f</span>(); <span class="comment">// 15</span></span><br></pre></td></tr></table></figure>
<p>在这个例子中，我们在函数<code>lazy_sum</code>中又定义了函数<code>sum</code>，并且，内部函数<code>sum</code>可以引用外部函数<code>lazy_sum</code>的参数和局部变量，当<code>lazy_sum</code>返回函数<code>sum</code>时，相关参数和变量都保存在返回的函数中，这种称为“闭包（Closure）”的程序结构拥有极大的威力。</p>
<p>请再注意一点，当我们调用<code>lazy_sum()</code>时，每次调用都会返回一个新的函数，即使传入相同的参数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> f1 = <span class="title function_">lazy_sum</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line"><span class="keyword">let</span> f2 = <span class="title function_">lazy_sum</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line">f1 === f2; <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p><code>f1()</code>和<code>f2()</code>的调用结果互不影响。</p>
<h3 id="闭包">闭包</h3>
<p>注意到返回的函数在其定义内部引用了局部变量<code>arr</code>，所以，当一个函数返回了一个函数后，其内部的局部变量还被新函数引用，所以，闭包用起来简单，实现起来可不容易。</p>
<p>另一个需要注意的问题是，返回的函数并没有立刻执行，而是直到调用了<code>f()</code>才执行。我们来看一个例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">count</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">1</span>; i&lt;=<span class="number">3</span>; i++) &#123;</span><br><span class="line">        arr.<span class="title function_">push</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> i * i;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> results = <span class="title function_">count</span>();</span><br><span class="line"><span class="keyword">let</span> [f1, f2, f3] = results;</span><br></pre></td></tr></table></figure>
<p>在上面的例子中，每次循环，都创建了一个新的函数，然后，把创建的3个函数都添加到一个<code>Array</code>中返回了。</p>
<p>你可能认为调用<code>f1()</code>，<code>f2()</code>和<code>f3()</code>结果应该是<code>1</code>，<code>4</code>，<code>9</code>，但实际结果是：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">f1</span>(); <span class="comment">// 16</span></span><br><span class="line"><span class="title function_">f2</span>(); <span class="comment">// 16</span></span><br><span class="line"><span class="title function_">f3</span>(); <span class="comment">// 16</span></span><br></pre></td></tr></table></figure>
<p>全部都是<code>16</code>！原因就在于返回的函数引用了用<code>var</code>定义的变量<code>i</code>，但它并非立刻执行。等到3个函数都返回时，它们所引用的变量<code>i</code>已经变成了<code>4</code>，因此最终结果为<code>16</code>。</p>
<p>返回闭包时牢记的一点就是：返回函数不要引用任何循环变量，或者后续会发生变化的变量。</p>
<p>如果一定要引用循环变量怎么办？方法是再创建一个函数，用该函数的参数绑定循环变量当前的值，无论该循环变量后续如何更改，已绑定到函数参数的值不变：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">count</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">1</span>; i&lt;=<span class="number">3</span>; i++) &#123;</span><br><span class="line">        arr.<span class="title function_">push</span>((<span class="keyword">function</span> (<span class="params">n</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> n * n;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)(i));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [f1, f2, f3] = <span class="title function_">count</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_">f1</span>(); <span class="comment">// 1</span></span><br><span class="line"><span class="title function_">f2</span>(); <span class="comment">// 4</span></span><br><span class="line"><span class="title function_">f3</span>(); <span class="comment">// 9</span></span><br></pre></td></tr></table></figure>
<p>注意这里用了一个“创建一个匿名函数并立刻执行”的语法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;)(<span class="number">3</span>); <span class="comment">// 9</span></span><br></pre></td></tr></table></figure>
<p>理论上讲，创建一个匿名函数并立刻执行可以这么写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> (<span class="params">x</span>) &#123; <span class="keyword">return</span> x * x &#125; (<span class="number">3</span>);</span><br></pre></td></tr></table></figure>
<p>但是由于JavaScript语法解析的问题，会报SyntaxError错误，因此需要用括号把整个函数定义括起来：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params">x</span>) &#123; <span class="keyword">return</span> x * x &#125;) (<span class="number">3</span>);</span><br></pre></td></tr></table></figure>
<p>通常，一个立即执行的匿名函数可以把函数体拆开，一般这么写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;)(<span class="number">3</span>);</span><br></pre></td></tr></table></figure>
<p>另一个方法是把循环变量<code>i</code>用<code>let</code>定义在<code>for</code>循环体中，<code>let</code>作用域决定了在每次循环时都会绑定新的<code>i</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">count</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">1</span>; i&lt;=<span class="number">3</span>; i++) &#123;</span><br><span class="line">        arr.<span class="title function_">push</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> i * i;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但如果<code>i</code>定义在<code>for</code>循环外面，则仍然是错误的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">count</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = [];</span><br><span class="line">    <span class="keyword">let</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;=<span class="number">3</span>; i++) &#123;</span><br><span class="line">        arr.<span class="title function_">push</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> i * i;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因此，最好的办法还是返回函数不要引用任何循环变量。</p>
<p>说了这么多，难道闭包就是为了返回一个函数然后延迟执行吗？</p>
<p>当然不是！闭包有非常强大的功能。举个栗子：</p>
<p>在面向对象的程序设计语言里，比如Java和C++，要在对象内部封装一个私有变量，可以用<code>private</code>修饰一个成员变量。</p>
<p>在没有<code>class</code>机制，只有函数的语言里，借助闭包，同样可以封装一个私有变量。我们用JavaScript创建一个计数器：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">create_counter</span>(<span class="params">initial</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> x = initial || <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">inc</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            x += <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>它用起来像这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> c1 = <span class="title function_">create_counter</span>();</span><br><span class="line">c1.<span class="title function_">inc</span>(); <span class="comment">// 1</span></span><br><span class="line">c1.<span class="title function_">inc</span>(); <span class="comment">// 2</span></span><br><span class="line">c1.<span class="title function_">inc</span>(); <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> c2 = <span class="title function_">create_counter</span>(<span class="number">10</span>);</span><br><span class="line">c2.<span class="title function_">inc</span>(); <span class="comment">// 11</span></span><br><span class="line">c2.<span class="title function_">inc</span>(); <span class="comment">// 12</span></span><br><span class="line">c2.<span class="title function_">inc</span>(); <span class="comment">// 13</span></span><br></pre></td></tr></table></figure>
<p>在返回的对象中，实现了一个闭包，该闭包携带了局部变量<code>x</code>，并且，从外部代码根本无法访问到变量<code>x</code>。换句话说，闭包就是携带状态的函数，并且它的状态可以完全对外隐藏起来。</p>
<p>闭包还可以把多参数的函数变成单参数的函数。例如，要计算xy可以用<code>Math.pow(x, y)</code>函数，不过考虑到经常计算x2或x3，我们可以利用闭包创建新的函数<code>pow2</code>和<code>pow3</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function make_pow(n) &#123;</span><br><span class="line">    return function (x) &#123;</span><br><span class="line">        return Math.pow(x, n);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 创建两个新函数:</span><br><span class="line">let pow2 = make_pow(2);</span><br><span class="line">let pow3 = make_pow(3);</span><br><span class="line"></span><br><span class="line">console.log(pow2(5)); // 25</span><br><span class="line">console.log(pow3(7)); // 343</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://weibo.com/liaoxuefeng"><img src="http://thirdqq.qlogo.cn/ek_qqapp/AQVJKMtqeFCGNEZqicOj7qb7mnpcJiaZNlEOf0iasx2DicuEycbIG9cQktWUBxWR1dFWfLMI2Ilt/100" alt=""></a></p>
<p><a target="_blank" rel="noopener" href="https://weibo.com/liaoxuefeng">廖雪峰</a><a target="_blank" rel="noopener" href="https://github.com/michaelliao"></a><a target="_blank" rel="noopener" href="https://weibo.com/liaoxuefeng"></a><a target="_blank" rel="noopener" href="https://zhihu.com/people/liaoxuefeng"></a><a target="_blank" rel="noopener" href="https://twitter.com/liaoxuefeng"></a><br>
资深软件开发工程师，业余马拉松选手。</p>
<p>ES6标准新增了一种新的函数：箭头函数（Arrow Function）。</p>
<p>为什么叫箭头函数？因为它的定义用的就是一个箭头：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x =&gt; x * x</span><br></pre></td></tr></table></figure>
<p>上面的箭头函数相当于：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在继续学习箭头函数之前，请测试你的浏览器是否支持ES6的Arrow Function：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let fn = x =&gt; x * x;</span><br><span class="line">console.log(&#x27;你的浏览器支持ES6的Arrow Function!&#x27;);</span><br></pre></td></tr></table></figure>
<p>箭头函数相当于匿名函数，并且简化了函数定义。箭头函数有两种格式，一种像上面的，只包含一个表达式，连<code>&#123; ... &#125;</code>和<code>return</code>都省略掉了。还有一种可以包含多条语句，这时候就不能省略<code>&#123; ... &#125;</code>和<code>return</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">x =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> x * x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> - x * x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果参数不是一个，就需要用括号<code>()</code>括起来：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 两个参数:</span></span><br><span class="line">(x, y) =&gt; x * x + y * y</span><br><span class="line"></span><br><span class="line"><span class="comment">// 无参数:</span></span><br><span class="line">() =&gt; <span class="number">3.14</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可变参数:</span></span><br><span class="line">(x, y, ...rest) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> i, sum = x + y;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;rest.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        sum += rest[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果要返回一个对象，就要注意，如果是单表达式，这么写的话会报错：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SyntaxError:</span></span><br><span class="line">x =&gt; &#123; <span class="attr">foo</span>: x &#125;</span><br></pre></td></tr></table></figure>
<p>因为和函数体的<code>&#123; ... &#125;</code>有语法冲突，所以要改为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ok:</span></span><br><span class="line">x =&gt; (&#123; <span class="attr">foo</span>: x &#125;)</span><br></pre></td></tr></table></figure>
<h3 id="this">this</h3>
<p>箭头函数看上去是匿名函数的一种简写，但实际上，箭头函数和匿名函数有个明显的区别：箭头函数内部的<code>this</code>是词法作用域，由上下文确定。</p>
<p>回顾前面的例子，由于JavaScript函数对<code>this</code>绑定的错误处理，下面的例子无法得到预期结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span>,</span><br><span class="line">    <span class="attr">getAge</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> b = <span class="variable language_">this</span>.<span class="property">birth</span>; <span class="comment">// 1990</span></span><br><span class="line">        <span class="keyword">let</span> fn = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>() - <span class="variable language_">this</span>.<span class="property">birth</span>; <span class="comment">// this指向window或undefined</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">fn</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>现在，箭头函数完全修复了<code>this</code>的指向，<code>this</code>总是指向词法作用域，也就是外层调用者<code>obj</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span>,</span><br><span class="line">    <span class="attr">getAge</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> b = <span class="variable language_">this</span>.<span class="property">birth</span>; <span class="comment">// 1990</span></span><br><span class="line">        <span class="keyword">let</span> <span class="title function_">fn</span> = (<span class="params"></span>) =&gt; <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>() - <span class="variable language_">this</span>.<span class="property">birth</span>; <span class="comment">// this指向obj对象</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">fn</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">obj.<span class="title function_">getAge</span>(); <span class="comment">// 25</span></span><br></pre></td></tr></table></figure>
<p>如果使用箭头函数，以前的那种hack写法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> that = <span class="variable language_">this</span>;</span><br></pre></td></tr></table></figure>
<p>就不再需要了。</p>
<p>由于<code>this</code>在箭头函数中已经按照词法作用域绑定了，所以，用<code>call()</code>或者<code>apply()</code>调用箭头函数时，无法对<code>this</code>进行绑定，即传入的第一个参数被忽略：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span>,</span><br><span class="line">    <span class="attr">getAge</span>: <span class="keyword">function</span> (<span class="params">year</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> b = <span class="variable language_">this</span>.<span class="property">birth</span>; <span class="comment">// 1990</span></span><br><span class="line">        <span class="keyword">let</span> <span class="title function_">fn</span> = (<span class="params">y</span>) =&gt; y - <span class="variable language_">this</span>.<span class="property">birth</span>; <span class="comment">// this.birth仍是1990</span></span><br><span class="line">        <span class="keyword">return</span> fn.<span class="title function_">call</span>(&#123;<span class="attr">birth</span>:<span class="number">2000</span>&#125;, year);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">obj.<span class="title function_">getAge</span>(<span class="number">2015</span>); <span class="comment">// 25</span></span><br></pre></td></tr></table></figure>
<h3 id="练习-4">练习</h3>
<p>请使用箭头函数简化排序时传入的函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let arr = [10, 20, 1, 2];</span><br><span class="line">arr.sort((x, y) =&gt; &#123;</span><br><span class="line">    ???</span><br><span class="line">&#125;);</span><br><span class="line">console.log(arr); // [1, 2, 10, 20]</span><br></pre></td></tr></table></figure>
<h2 id="标签函数">标签函数</h2>
<p><a target="_blank" rel="noopener" href="https://weibo.com/liaoxuefeng"><img src="http://thirdqq.qlogo.cn/ek_qqapp/AQVJKMtqeFCGNEZqicOj7qb7mnpcJiaZNlEOf0iasx2DicuEycbIG9cQktWUBxWR1dFWfLMI2Ilt/100" alt=""></a></p>
<p><a target="_blank" rel="noopener" href="https://weibo.com/liaoxuefeng">廖雪峰</a><a target="_blank" rel="noopener" href="https://github.com/michaelliao"></a><a target="_blank" rel="noopener" href="https://weibo.com/liaoxuefeng"></a><a target="_blank" rel="noopener" href="https://zhihu.com/people/liaoxuefeng"></a><a target="_blank" rel="noopener" href="https://twitter.com/liaoxuefeng"></a><br>
资深软件开发工程师，业余马拉松选手。</p>
<p>前面我们介绍了<a target="_blank" rel="noopener" href="https://liaoxuefeng.com/books/javascript/quick-start/string/index.html">模板字符串</a>，它可以非常方便地引用变量，并合并出最终的字符串：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let name = &#x27;小明&#x27;;</span><br><span class="line">let age = 20;</span><br><span class="line">let s = `你好, $&#123;name&#125;, 你今年$&#123;age&#125;岁了!`;</span><br><span class="line">console.log(s);</span><br></pre></td></tr></table></figure>
<p>对于模板字符串，除了方便引用变量构造字符串外，还有一种更强大的功能，即可以使用标签函数（Tag Function）。</p>
<p>什么是标签函数？让我们看一个例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const email = &quot;test@example.com&quot;;</span><br><span class="line">const password = &#x27;hello123&#x27;;</span><br><span class="line"></span><br><span class="line">function sql(strings, ...exps) &#123;</span><br><span class="line">    console.log(`SQL: $&#123;strings.join(&#x27;?&#x27;)&#125;`);</span><br><span class="line">    console.log(`SQL parameters: $&#123;JSON.stringify(exps)&#125;`);</span><br><span class="line">    return &#123;</span><br><span class="line">        name: &#x27;小明&#x27;,</span><br><span class="line">        age: 20</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const result = sql`SELECT * FROM users WHERE email=$&#123;email&#125; AND password=$&#123;password&#125;`;</span><br><span class="line"></span><br><span class="line">console.log(JSON.stringify(result));</span><br></pre></td></tr></table></figure>
<p>这里出现了一个奇怪的语法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sql<span class="string">`SELECT * FROM users WHERE email=<span class="subst">$&#123;email&#125;</span> AND password=<span class="subst">$&#123;password&#125;</span>`</span></span><br></pre></td></tr></table></figure>
<p>模板字符串前面以<code>sql</code>开头，实际上这是一个标签函数，上述语法会自动转换为对<code>sql()</code>函数的调用。我们关注的是，传入<code>sql()</code>函数的参数是什么。</p>
<p><code>sql()</code>函数实际上接收两个参数：</p>
<p>第一个参数<code>strings</code>是一个字符串数组，它是<code>[&quot;SELECT * FROM users WHERE email=&quot;, &quot; AND password=&quot;, &quot;&quot;]</code>，即除去<code>$&#123;xxx&#125;</code>剩下的字符组成的数组；</p>
<p>第二个参数<code>...exps</code>是一个可变参数，它接收的也是一个数组，但数组的内容是由模板字符串里所有的<code>$&#123;xxx&#125;</code>的实际值组成，即<code>[&quot;test@example.com&quot;, &quot;hello123&quot;]</code>，因为解析<code>$&#123;email&#125;</code>得到<code>&quot;test@example.com&quot;</code>，解析<code>$&#123;password&#125;</code>得到<code>&quot;hello123&quot;</code>。</p>
<p>标签函数<code>sql()</code>实际上是一个普通函数，我们在内部把<code>strings</code>拼接成一个SQL字符串，把<code>...exps</code>作为参数，就可以实现一个安全的SQL查询，并返回查询结果。此处并没有真正的数据库连接，因此返回一个固定的Object。</p>
<p>标签函数和普通函数的定义区别仅仅在于参数，如果我们想对数据库进行修改，完全可以定义一个标签函数如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">update</span>(<span class="params">strings, ...exps</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> sql = strings.<span class="title function_">join</span>(<span class="string">&#x27;?&#x27;</span>);</span><br><span class="line">    <span class="comment">// 执行数据库更新</span></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>函数调用可以简化为带标签的模板字符串：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> id = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">let</span> age = <span class="number">21</span>;</span><br><span class="line"><span class="keyword">let</span> score = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line"></span><br><span class="line">update<span class="string">`UPDATE users SET age=<span class="subst">$&#123;age&#125;</span>, score=<span class="subst">$&#123;score&#125;</span> WHERE id=<span class="subst">$&#123;id&#125;</span>`</span>;</span><br></pre></td></tr></table></figure>
<p>是不是非常简洁？</p>
<hr>
<hr>
<p><a target="_blank" rel="noopener" href="https://weibo.com/liaoxuefeng"><img src="http://thirdqq.qlogo.cn/ek_qqapp/AQVJKMtqeFCGNEZqicOj7qb7mnpcJiaZNlEOf0iasx2DicuEycbIG9cQktWUBxWR1dFWfLMI2Ilt/100" alt=""></a></p>
<p><a target="_blank" rel="noopener" href="https://weibo.com/liaoxuefeng">廖雪峰</a><a target="_blank" rel="noopener" href="https://github.com/michaelliao"></a><a target="_blank" rel="noopener" href="https://weibo.com/liaoxuefeng"></a><a target="_blank" rel="noopener" href="https://zhihu.com/people/liaoxuefeng"></a><a target="_blank" rel="noopener" href="https://twitter.com/liaoxuefeng"></a><br>
资深软件开发工程师，业余马拉松选手。</p>
<p>生成器（generator）是ES6标准引入的新的数据类型。一个生成器看上去像一个函数，但可以返回多次。</p>
<p>ES6定义生成器标准的哥们借鉴了Python的generator的概念和语法，如果你对Python的generator很熟悉，那么ES6的generator就是小菜一碟了。如果你对Python还不熟，赶快恶补<a target="_blank" rel="noopener" href="https://liaoxuefeng.com/books/python/index.html">Python教程</a>！。</p>
<p>我们先复习函数的概念。一个函数是一段完整的代码，调用一个函数就是传入参数，然后返回结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x + x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> r = <span class="title function_">foo</span>(<span class="number">1</span>); <span class="comment">// 调用foo函数</span></span><br></pre></td></tr></table></figure>
<p>函数在执行过程中，如果没有遇到<code>return</code>语句（函数末尾如果没有<code>return</code>，就是隐含的<code>return undefined;</code>），控制权无法交回被调用的代码。</p>
<p>generator跟函数很像，定义如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">foo</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">yield</span> x + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">yield</span> x + <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> x + <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>generator和函数不同的是，generator由<code>function*</code>定义（注意多出的<code>*</code>号），并且，除了<code>return</code>语句，还可以用<code>yield</code>返回多次。</p>
<p>大多数同学立刻就晕了，generator就是能够返回多次的“函数”？返回多次有啥用？</p>
<p>还是举个栗子吧。</p>
<p>我们以一个著名的斐波那契数列为例，它由<code>0</code>，<code>1</code>开头：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">8</span> <span class="number">13</span> <span class="number">21</span> <span class="number">34</span> ...</span><br></pre></td></tr></table></figure>
<p>要编写一个产生斐波那契数列的函数，可以这么写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fib</span>(<span class="params">max</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span></span><br><span class="line">        t,</span><br><span class="line">        a = <span class="number">0</span>,</span><br><span class="line">        b = <span class="number">1</span>,</span><br><span class="line">        arr = [<span class="number">0</span>, <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">while</span> (arr.<span class="property">length</span> &lt; max) &#123;</span><br><span class="line">        [a, b] = [b, a + b];</span><br><span class="line">        arr.<span class="title function_">push</span>(b);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试:</span></span><br><span class="line"><span class="title function_">fib</span>(<span class="number">5</span>); <span class="comment">// [0, 1, 1, 2, 3]</span></span><br><span class="line"><span class="title function_">fib</span>(<span class="number">10</span>); <span class="comment">// [0, 1, 1, 2, 3, 5, 8, 13, 21, 34]</span></span><br></pre></td></tr></table></figure>
<p>函数只能返回一次，所以必须返回一个<code>Array</code>。但是，如果换成generator，就可以一次返回一个数，不断返回多次。用generator改写如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">fib</span>(<span class="params">max</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span></span><br><span class="line">        t,</span><br><span class="line">        a = <span class="number">0</span>,</span><br><span class="line">        b = <span class="number">1</span>,</span><br><span class="line">        n = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (n &lt; max) &#123;</span><br><span class="line">        <span class="keyword">yield</span> a;</span><br><span class="line">        [a, b] = [b, a + b];</span><br><span class="line">        n ++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>直接调用试试：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fib</span>(<span class="number">5</span>); <span class="comment">// fib &#123;[[GeneratorStatus]]: &quot;suspended&quot;, [[GeneratorReceiver]]: Window&#125;</span></span><br></pre></td></tr></table></figure>
<p>直接调用一个generator和调用函数不一样，<code>fib(5)</code>仅仅是创建了一个generator对象，还没有去执行它。</p>
<p>调用generator对象有两个方法，一是不断地调用generator对象的<code>next()</code>方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> f = <span class="title function_">fib</span>(<span class="number">5</span>);</span><br><span class="line">f.<span class="title function_">next</span>(); <span class="comment">// &#123;value: 0, done: false&#125;</span></span><br><span class="line">f.<span class="title function_">next</span>(); <span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line">f.<span class="title function_">next</span>(); <span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line">f.<span class="title function_">next</span>(); <span class="comment">// &#123;value: 2, done: false&#125;</span></span><br><span class="line">f.<span class="title function_">next</span>(); <span class="comment">// &#123;value: 3, done: false&#125;</span></span><br><span class="line">f.<span class="title function_">next</span>(); <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>
<p><code>next()</code>方法会执行generator的代码，然后，每次遇到<code>yield x;</code>就返回一个对象<code>&#123;value: x, done: true/false&#125;</code>，然后“暂停”。返回的<code>value</code>就是<code>yield</code>的返回值，<code>done</code>表示这个generator是否已经执行结束了。如果<code>done</code>为<code>true</code>，则<code>value</code>就是<code>return</code>的返回值。</p>
<p>当执行到<code>done</code>为<code>true</code>时，这个generator对象就已经全部执行完毕，不要再继续调用<code>next()</code>了。</p>
<p>第二个方法是直接用<code>for ... of</code>循环迭代generator对象，这种方式不需要我们自己判断<code>done</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function* fib(max) &#123;</span><br><span class="line">    let</span><br><span class="line">        a = 0,</span><br><span class="line">        b = 1,</span><br><span class="line">        n = 0;</span><br><span class="line">    while (n &lt; max) &#123;</span><br><span class="line">        yield a;</span><br><span class="line">        [a, b] = [b, a + b];</span><br><span class="line">        n ++;</span><br><span class="line">    &#125;</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">for (let x of fib(10)) &#123;</span><br><span class="line">    console.log(x); // 依次输出0, 1, 1, 2, 3, ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>generator和普通函数相比，有什么用？</p>
<p>因为generator可以在执行过程中多次返回，所以它看上去就像一个可以记住执行状态的函数，利用这一点，写一个generator就可以实现需要用面向对象才能实现的功能。例如，用一个对象来保存状态，得这么写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fib = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">b</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">n</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">max</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">next</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span></span><br><span class="line">            r = <span class="variable language_">this</span>.<span class="property">a</span>,</span><br><span class="line">            t = <span class="variable language_">this</span>.<span class="property">a</span> + <span class="variable language_">this</span>.<span class="property">b</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">a</span> = <span class="variable language_">this</span>.<span class="property">b</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">b</span> = t;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">n</span> &lt; <span class="variable language_">this</span>.<span class="property">max</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">n</span> ++;</span><br><span class="line">            <span class="keyword">return</span> r;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>用对象的属性来保存状态，相当繁琐。</p>
<p>generator还有另一个巨大的好处，就是把异步回调代码变成“同步”代码。这个好处要等到后面学了AJAX以后才能体会到。</p>
<p>没有generator之前的黑暗时代，用AJAX时需要这么写代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">ajax</span>(<span class="string">&#x27;http://url-1&#x27;</span>, data1, <span class="keyword">function</span> (<span class="params">err, result</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">handle</span>(err);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">ajax</span>(<span class="string">&#x27;http://url-2&#x27;</span>, data2, <span class="keyword">function</span> (<span class="params">err, result</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">handle</span>(err);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">ajax</span>(<span class="string">&#x27;http://url-3&#x27;</span>, data3, <span class="keyword">function</span> (<span class="params">err, result</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">handle</span>(err);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">success</span>(result);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>回调越多，代码越难看。</p>
<p>有了generator的美好时代，用AJAX时可以这么写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    r1 = <span class="keyword">yield</span> <span class="title function_">ajax</span>(<span class="string">&#x27;http://url-1&#x27;</span>, data1);</span><br><span class="line">    r2 = <span class="keyword">yield</span> <span class="title function_">ajax</span>(<span class="string">&#x27;http://url-2&#x27;</span>, data2);</span><br><span class="line">    r3 = <span class="keyword">yield</span> <span class="title function_">ajax</span>(<span class="string">&#x27;http://url-3&#x27;</span>, data3);</span><br><span class="line">    <span class="title function_">success</span>(r3);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="title function_">handle</span>(err);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看上去是同步的代码，实际执行是异步的。</p>
<h3 id="练习-5">练习</h3>
<p>要生成一个自增的ID，可以编写一个<code>next_id()</code>函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> current_id = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">next_id</span>(<span class="params"></span>) &#123;</span><br><span class="line">    current_id ++;</span><br><span class="line">    <span class="keyword">return</span> current_id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于函数无法保存状态，故需要一个全局变量<code>current_id</code>来保存数字。</p>
<p>不用闭包，试用generator改写：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function* next_id() &#123;</span><br><span class="line">    ???</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">let</span><br><span class="line">    x,</span><br><span class="line">    pass = true,</span><br><span class="line">    g = next_id();</span><br><span class="line">for (x = 1; x &lt; 100; x ++) &#123;</span><br><span class="line">    if (g.next().value !== x) &#123;</span><br><span class="line">        pass = false;</span><br><span class="line">        console.log(&#x27;测试失败!&#x27;);</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if (pass) &#123;</span><br><span class="line">    console.log(&#x27;测试通过!&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../../../2024/01/11/JavaScript/JavaScript-%E5%87%BD%E6%95%B0/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../../../2024/01/10/JavaScript/JavaScript-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"
                            aria-label=": JavaScript-快速入门"
                        >
                            JavaScript-快速入门
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2024-01-10T20:56:13+08:00">
	
		    2024 年 1 月 10 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../">编程语言</a>, <a class="category-link" href="../../JavaScript/">JavaScript</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>JavaScript代码可以直接嵌在网页的任何地方，不过通常我们都把JavaScript代码放到<code>&lt;head&gt;</code>中：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">alert</span>(<span class="string">&#x27;Hello, world&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>由<code>&lt;script&gt;...&lt;/script&gt;</code>包含的代码就是JavaScript代码，它将直接被浏览器执行。</p>
<p>第二种方法是把JavaScript代码放到一个单独的<code>.js</code>文件，然后在HTML中通过<code>&lt;script src=&quot;...&quot;&gt;&lt;/script&gt;</code>引入这个文件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/js/abc.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样，<code>/static/js/abc.js</code>就会被浏览器执行。</p>
<p>把JavaScript代码放入一个单独的<code>.js</code>文件中更利于维护代码，并且多个页面可以各自引用同一份<code>.js</code>文件。</p>
<p>可以在同一个页面中引入多个<code>.js</code>文件，还可以在页面中多次编写<code>&lt;script&gt; js代码... &lt;/script&gt;</code>，浏览器按照顺序依次执行。</p>
<p>有些时候你会看到<code>&lt;script&gt;</code>标签还设置了一个<code>type</code>属性：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>但这是没有必要的，因为默认的<code>type</code>就是JavaScript，所以不必显式地把<code>type</code>指定为JavaScript。</p>
<h3 id="如何编写JavaScript">如何编写JavaScript</h3>
<p>可以用任何文本编辑器来编写JavaScript代码。这里我们推荐以下几种文本编辑器：</p>
<h4 id="Visual-Studio-Code">Visual Studio Code</h4>
<p>微软出的<a target="_blank" rel="noopener" href="https://code.visualstudio.com/">Visual Studio Code</a>，可以看做迷你版Visual Studio，免费，跨平台，内置JavaScript支持，强烈推荐使用！</p>
<h4 id="Sublime-Text">Sublime Text</h4>
<p><a target="_blank" rel="noopener" href="https://www.sublimetext.com/">Sublime Text</a>是一个好用的文本编辑器，免费，但不注册会不定时弹出提示框。</p>
<p><em>注意</em>：不可以用Word或写字板来编写JavaScript或HTML，因为带格式的文本保存后不是<em>纯文本文件</em>，无法被浏览器正常读取。也尽量不要用记事本编写，它会自作聪明地在保存UTF-8格式文本时添加BOM头。</p>
<h3 id="如何运行JavaScript">如何运行JavaScript</h3>
<p>要让浏览器运行JavaScript，必须先有一个HTML页面，在HTML页面中引入JavaScript，然后，让浏览器加载该HTML页面，就可以执行JavaScript代码。</p>
<p>你也许会想，直接在我的硬盘上创建好HTML和JavaScript文件，然后用浏览器打开，不就可以看到效果了吗？</p>
<p>这种方式运行部分JavaScript代码没有问题，但由于浏览器的安全限制，以<code>file://</code>开头的地址无法执行如联网等JavaScript代码，最终，你还是需要架设一个Web服务器，然后以<code>http://</code>开头的地址来正常执行所有JavaScript代码。</p>
<p>不过，开始学习阶段，你无须关心如何搭建开发环境的问题，我们提供在页面输入JavaScript代码并直接运行的功能，让你专注于JavaScript的学习。</p>
<p>试试直接点击“Run”按钮执行下面的JavaScript代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 以双斜杠开头直到行末的是注释，注释是给人看的，会被浏览器忽略</span><br><span class="line">/* 在这中间的也是注释，将被浏览器忽略 */</span><br><span class="line">// 第一个JavaScript代码:</span><br><span class="line"></span><br><span class="line">alert(&#x27;Hello, world&#x27;); // 观察执行效果</span><br></pre></td></tr></table></figure>
<p>浏览器将弹出一个对话框，显示“Hello, world”。你也可以修改两个单引号中间的内容，再试着运行。</p>
<h3 id="调试">调试</h3>
<p>俗话说得好，“工欲善其事，必先利其器。”，写JavaScript的时候，如果期望显示<code>ABC</code>，结果却显示<code>XYZ</code>，到底代码哪里出了问题？不要抓狂，也不要泄气，作为小白，要坚信：JavaScript本身没有问题，浏览器执行也没有问题，有问题的一定是我的代码。</p>
<p>如何找出问题代码？这就需要调试。</p>
<p>怎么在浏览器中调试JavaScript代码呢？</p>
<p>首先，你需要安装Google Chrome浏览器，Chrome浏览器对开发者非常友好，可以让你方便地调试JavaScript代码。从这里<a target="_blank" rel="noopener" href="https://www.google.com/chrome/?system=true&amp;standalone=1">下载Chrome浏览器</a>。打开网页出问题的童鞋请移步<a target="_blank" rel="noopener" href="https://www.google.cn/chrome/?system=true&amp;standalone=1">国内镜像</a>。</p>
<p>安装后，随便打开一个网页，然后点击菜单“查看(View)”-“开发者(Developer)”-“开发者工具(Developer Tools)”，浏览器窗口就会一分为二，下方就是开发者工具：</p>
<p><img src="https://liaoxuefeng.com/books/javascript/quick-start/dev-tools.jpg" alt="chrome dev tools"></p>
<p>先点击“控制台(Console)“，在这个面板里可以直接输入JavaScript代码，按回车后执行。</p>
<p>要查看一个变量的内容，在Console中输入<code>console.log(a);</code>，回车后显示的值就是变量的内容。</p>
<p>关闭Console请点击右上角的“×”按钮。请熟练掌握Console的使用方法，在编写JavaScript代码时，经常需要在Console运行测试代码。</p>
<p>如果你对自己还有更高的要求，可以研究开发者工具的“源码(Sources)”，掌握断点、单步执行等高级调试技巧。</p>
<h3 id="练习">练习</h3>
<p>打开<a target="_blank" rel="noopener" href="http://www.sina.com.cn/">新浪首页</a>，然后查看页面源代码，找一找引入的JavaScript文件和直接编写在页面中的JavaScript代码。然后在Chrome中打开开发者工具，在控制台输入<code>console.log('Hello');</code>，回车查看JavaScript代码执行结果。</p>
<h2 id="基本语法">基本语法</h2>
<p>JavaScript的语法和Java语言类似，每个语句以<code>;</code>结束，语句块用<code>&#123;...&#125;</code>。但是，JavaScript并不强制要求在每个语句的结尾加<code>;</code>，浏览器中负责执行JavaScript代码的引擎会自动在每个语句的结尾补上<code>;</code>。</p>
<p>提示</p>
<p>让JavaScript引擎自动加分号在某些情况下会改变程序的语义，导致运行结果与期望不一致。在本教程中，我们不会省略;，所有语句都会添加;。</p>
<p>例如，下面的一行代码就是一个完整的赋值语句：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>下面的一行代码是一个字符串，但仍然可以视为一个完整的语句：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;Hello, world&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>下面的一行代码包含两个语句，每个语句用<code>;</code>表示语句结束：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>; <span class="keyword">var</span> y = <span class="number">2</span>; <span class="comment">// 不建议一行写多个语句!</span></span><br></pre></td></tr></table></figure>
<p>语句块是一组语句的集合，例如，下面的代码先做了一个判断，如果判断成立，将执行<code>&#123;...&#125;</code>中的所有语句：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="number">2</span> &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    x = <span class="number">1</span>;</span><br><span class="line">    y = <span class="number">2</span>;</span><br><span class="line">    z = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意花括号<code>&#123;...&#125;</code>内的语句具有缩进，通常是4个空格。缩进不是JavaScript语法要求必须的，但缩进有助于我们理解代码的层次，所以编写代码时要遵守缩进规则。很多文本编辑器具有“自动缩进”的功能，可以帮助整理代码。</p>
<p><code>&#123;...&#125;</code>还可以嵌套，形成层级结构：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="number">2</span> &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    x = <span class="number">1</span>;</span><br><span class="line">    y = <span class="number">2</span>;</span><br><span class="line">    z = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; y) &#123;</span><br><span class="line">        z = <span class="number">4</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; y) &#123;</span><br><span class="line">        z = <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JavaScript本身对嵌套的层级没有限制，但是过多的嵌套无疑会大大增加看懂代码的难度。遇到这种情况，需要把部分代码抽出来，作为函数来调用，这样可以减少代码的复杂度。</p>
<h3 id="注释">注释</h3>
<p>以<code>//</code>开头直到行末的字符被视为行注释，注释是给开发人员看到，JavaScript引擎会自动忽略：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这是一行注释</span></span><br><span class="line"><span class="title function_">alert</span>(<span class="string">&#x27;hello&#x27;</span>); <span class="comment">// 这也是注释</span></span><br></pre></td></tr></table></figure>
<p>另一种块注释是用<code>/*...*/</code>把多行字符包裹起来，把一大“块”视为一个注释：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 从这里开始是块注释</span></span><br><span class="line"><span class="comment">仍然是注释</span></span><br><span class="line"><span class="comment">仍然是注释</span></span><br><span class="line"><span class="comment">注释结束 */</span></span><br></pre></td></tr></table></figure>
<h3 id="练习-2">练习</h3>
<p>分别利用行注释和块注释把下面的语句注释掉，使它不再执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 请注释掉下面的语句:</span><br><span class="line">alert(&#x27;我不想执行&#x27;);</span><br><span class="line">alert(&#x27;我也不想执行&#x27;);</span><br></pre></td></tr></table></figure>
<h3 id="大小写">大小写</h3>
<p>请注意，JavaScript严格区分大小写，如果弄错了大小写，程序将报错或者运行不正常。</p>
<hr>
<hr>
<h3 id="数据类型">数据类型</h3>
<p>计算机顾名思义就是可以做数学计算的机器，因此，计算机程序理所当然地可以处理各种数值。但是，计算机能处理的远不止数值，还可以处理文本、图形、音频、视频、网页等各种各样的数据，不同的数据，需要定义不同的数据类型。在JavaScript中定义了以下几种数据类型：</p>
<h4 id="Number">Number</h4>
<p>JavaScript不区分整数和浮点数，统一用Number表示，以下都是合法的Number类型：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">123</span>; <span class="comment">// 整数123</span></span><br><span class="line"><span class="number">0.456</span>; <span class="comment">// 浮点数0.456</span></span><br><span class="line"><span class="number">1.2345e3</span>; <span class="comment">// 科学计数法表示1.2345x1000，等同于1234.5</span></span><br><span class="line">-<span class="number">99</span>; <span class="comment">// 负数</span></span><br><span class="line"><span class="title class_">NaN</span>; <span class="comment">// NaN表示Not a Number，当无法计算结果时用NaN表示</span></span><br><span class="line"><span class="title class_">Infinity</span>; <span class="comment">// Infinity表示无限大，当数值超过了JavaScript的Number所能表示的最大值时，就表示为Infinity</span></span><br></pre></td></tr></table></figure>
<p>计算机由于使用二进制，所以，有时候用十六进制表示整数比较方便，十六进制用0x前缀和0-9，a-f表示，例如：<code>0xff00</code>，<code>0xa5b4c3d2</code>，等等，它们和十进制表示的数值完全一样。</p>
<p>Number可以直接做四则运算，规则和数学一致：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> + <span class="number">2</span>; <span class="comment">// 3</span></span><br><span class="line">(<span class="number">1</span> + <span class="number">2</span>) * <span class="number">5</span> / <span class="number">2</span>; <span class="comment">// 7.5</span></span><br><span class="line"><span class="number">2</span> / <span class="number">0</span>; <span class="comment">// Infinity</span></span><br><span class="line"><span class="number">0</span> / <span class="number">0</span>; <span class="comment">// NaN</span></span><br><span class="line"><span class="number">10</span> % <span class="number">3</span>; <span class="comment">// 1</span></span><br><span class="line"><span class="number">10.5</span> % <span class="number">3</span>; <span class="comment">// 1.5</span></span><br></pre></td></tr></table></figure>
<p>注意<code>%</code>是求余运算。</p>
<p>要注意，JavaScript的Number不区分整数和浮点数，也就是说，<code>12.00 === 12</code>。（在大多数其他语言中，整数和浮点数不能直接比较）并且，JavaScript的整数最大范围不是±263，而是±253，因此，超过253的整数就可能无法精确表示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 计算圆面积:</span><br><span class="line">var r = 123.456;</span><br><span class="line">var s = 3.14 * r * r;</span><br><span class="line">console.log(s); // 47857.94555904001</span><br><span class="line"></span><br><span class="line">// 打印Number能表示的最大整数:</span><br><span class="line">console.log(Number.MAX_SAFE_INTEGER); // 9007199254740991</span><br></pre></td></tr></table></figure>
<h4 id="字符串">字符串</h4>
<p>字符串是以单引号’或双引号&quot;括起来的任意文本，比如<code>'abc'</code>，<code>&quot;xyz&quot;</code>等等。请注意，<code>''</code>或<code>&quot;&quot;</code>本身只是一种表示方式，不是字符串的一部分，因此，字符串<code>'abc'</code>只有<code>a</code>，<code>b</code>，<code>c</code>这3个字符。</p>
<h4 id="布尔值">布尔值</h4>
<p>布尔值和布尔代数的表示完全一致，一个布尔值只有<code>true</code>、<code>false</code>两种值，要么是<code>true</code>，要么是<code>false</code>，可以直接用<code>true</code>、<code>false</code>表示布尔值，也可以通过布尔运算计算出来：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">true</span>; <span class="comment">// 这是一个true值</span></span><br><span class="line"><span class="literal">false</span>; <span class="comment">// 这是一个false值</span></span><br><span class="line"><span class="number">2</span> &gt; <span class="number">1</span>; <span class="comment">// 这是一个true值</span></span><br><span class="line"><span class="number">2</span> &gt;= <span class="number">3</span>; <span class="comment">// 这是一个false值</span></span><br></pre></td></tr></table></figure>
<p><code>&amp;&amp;</code>运算是与运算，只有所有都为<code>true</code>，<code>&amp;&amp;</code>运算结果才是<code>true</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">true</span> &amp;&amp; <span class="literal">true</span>; <span class="comment">// 这个&amp;&amp;语句计算结果为true</span></span><br><span class="line"><span class="literal">true</span> &amp;&amp; <span class="literal">false</span>; <span class="comment">// 这个&amp;&amp;语句计算结果为false</span></span><br><span class="line"><span class="literal">false</span> &amp;&amp; <span class="literal">true</span> &amp;&amp; <span class="literal">false</span>; <span class="comment">// 这个&amp;&amp;语句计算结果为false</span></span><br></pre></td></tr></table></figure>
<p><code>||</code>运算是或运算，只要其中有一个为<code>true</code>，<code>||</code>运算结果就是<code>true</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">false</span> || <span class="literal">false</span>; <span class="comment">// 这个||语句计算结果为false</span></span><br><span class="line"><span class="literal">true</span> || <span class="literal">false</span>; <span class="comment">// 这个||语句计算结果为true</span></span><br><span class="line"><span class="literal">false</span> || <span class="literal">true</span> || <span class="literal">false</span>; <span class="comment">// 这个||语句计算结果为true</span></span><br></pre></td></tr></table></figure>
<p><code>!</code>运算是非运算，它是一个单目运算符，把<code>true</code>变成<code>false</code>，<code>false</code>变成<code>true</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">! <span class="literal">true</span>; <span class="comment">// 结果为false</span></span><br><span class="line">! <span class="literal">false</span>; <span class="comment">// 结果为true</span></span><br><span class="line">! (<span class="number">2</span> &gt; <span class="number">5</span>); <span class="comment">// 结果为true</span></span><br></pre></td></tr></table></figure>
<p>布尔值经常用在条件判断中，比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> age = <span class="number">15</span>;</span><br><span class="line"><span class="keyword">if</span> (age &gt;= <span class="number">18</span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;adult&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;teenager&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="比较运算符">比较运算符</h3>
<p>当我们对Number做比较时，可以通过比较运算符得到一个布尔值：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span> &gt; <span class="number">5</span>; <span class="comment">// false</span></span><br><span class="line"><span class="number">5</span> &gt;= <span class="number">2</span>; <span class="comment">// true</span></span><br><span class="line"><span class="number">7</span> == <span class="number">7</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>实际上，JavaScript允许对任意数据类型做比较：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">false</span> == <span class="number">0</span>; <span class="comment">// true</span></span><br><span class="line"><span class="literal">false</span> === <span class="number">0</span>; <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>要特别注意相等运算符<code>==</code>。JavaScript在设计时，有两种比较运算符：</p>
<p>第一种是<code>==</code>比较，它会自动转换数据类型再比较，很多时候，会得到非常诡异的结果；</p>
<p>第二种是<code>===</code>比较，它不会自动转换数据类型，如果数据类型不一致，返回<code>false</code>，如果一致，再比较。</p>
<p>由于JavaScript这个设计缺陷，<em>不要</em>使用<code>==</code>比较，始终坚持使用<code>===</code>比较。</p>
<p>另一个例外是<code>NaN</code>这个特殊的Number与所有其他值都不相等，包括它自己：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">NaN</span> === <span class="title class_">NaN</span>; <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>唯一能判断<code>NaN</code>的方法是通过<code>isNaN()</code>函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">isNaN</span>(<span class="title class_">NaN</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>最后要注意浮点数的相等比较：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> / <span class="number">3</span> === (<span class="number">1</span> - <span class="number">2</span> / <span class="number">3</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>这不是JavaScript的设计缺陷。浮点数在运算过程中会产生误差，因为计算机无法精确表示无限循环小数。要比较两个浮点数是否相等，只能计算它们之差的绝对值，看是否小于某个阈值：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="number">1</span> / <span class="number">3</span> - (<span class="number">1</span> - <span class="number">2</span> / <span class="number">3</span>)) &lt; <span class="number">0.0000001</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h4 id="BigInt">BigInt</h4>
<p>要精确表示比253还大的整数，可以使用内置的BigInt类型，它的表示方法是在整数后加一个<code>n</code>，例如<code>9223372036854775808n</code>，也可以使用<code>BigInt()</code>把Number和字符串转换成BigInt：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 使用BigInt:</span><br><span class="line">var bi1 = 9223372036854775807n;</span><br><span class="line">var bi2 = BigInt(12345);</span><br><span class="line">var bi3 = BigInt(&quot;0x7fffffffffffffff&quot;);</span><br><span class="line">console.log(bi1 === bi2); // false</span><br><span class="line">console.log(bi1 === bi3); // true</span><br><span class="line">console.log(bi1 + bi2);</span><br></pre></td></tr></table></figure>
<p>使用BigInt可以正常进行加减乘除等运算，结果仍然是一个BigInt，但不能把一个BigInt和一个Number放在一起运算：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 使用BigInt:</span><br><span class="line">console.log(1234567n + 3456789n); // OK</span><br><span class="line">console.log(1234567n / 789n); // 1564, 除法运算结果仍然是BigInt</span><br><span class="line">console.log(1234567n % 789n); // 571, 求余</span><br><span class="line">console.log(1234567n + 3456789); // Uncaught TypeError: Cannot mix BigInt and other types</span><br></pre></td></tr></table></figure>
<h4 id="null和undefined">null和undefined</h4>
<p><code>null</code>表示一个“空”的值，它和<code>0</code>以及空字符串<code>''</code>不同，<code>0</code>是一个数值，<code>''</code>表示长度为0的字符串，而<code>null</code>表示“空”。</p>
<p>在其他语言中，也有类似JavaScript的<code>null</code>的表示，例如Java也用<code>null</code>，Swift用<code>nil</code>，Python用<code>None</code>表示。但是，在JavaScript中，还有一个和<code>null</code>类似的<code>undefined</code>，它表示“未定义”。</p>
<p>JavaScript的设计者希望用<code>null</code>表示一个空的值，而<code>undefined</code>表示值未定义。事实证明，这并没有什么卵用，区分两者的意义不大。大多数情况下，我们都应该用<code>null</code>。<code>undefined</code>仅仅在判断函数参数是否传递的情况下有用。</p>
<h4 id="数组">数组</h4>
<p>数组是一组按顺序排列的集合，集合的每个值称为元素。JavaScript的数组可以包括任意数据类型。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3.14</span>, <span class="string">&#x27;Hello&#x27;</span>, <span class="literal">null</span>, <span class="literal">true</span>];</span><br></pre></td></tr></table></figure>
<p>上述数组包含6个元素。数组用<code>[]</code>表示，元素之间用<code>,</code>分隔。</p>
<p>另一种创建数组的方法是通过<code>Array()</code>函数实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>); <span class="comment">// 创建了数组[1, 2, 3]</span></span><br></pre></td></tr></table></figure>
<p>然而，出于代码的可读性考虑，强烈建议直接使用<code>[]</code>。</p>
<p>数组的元素可以通过索引来访问。请注意，索引的起始值为<code>0</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1, 2, 3.14, &#x27;Hello&#x27;, null, true];</span><br><span class="line">arr[0]; // 返回索引为0的元素，即1</span><br><span class="line">arr[5]; // 返回索引为5的元素，即true</span><br><span class="line">arr[6]; // 索引超出了范围，返回undefined</span><br><span class="line">console.log(arr[0], arr[5], arr[6]);</span><br></pre></td></tr></table></figure>
<h4 id="对象">对象</h4>
<p>JavaScript的对象是一组由键-值组成的无序集合，例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Bob&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">tags</span>: [<span class="string">&#x27;js&#x27;</span>, <span class="string">&#x27;web&#x27;</span>, <span class="string">&#x27;mobile&#x27;</span>],</span><br><span class="line">    <span class="attr">city</span>: <span class="string">&#x27;Beijing&#x27;</span>,</span><br><span class="line">    <span class="attr">hasCar</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">zipcode</span>: <span class="literal">null</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>JavaScript对象的键都是字符串类型，值可以是任意数据类型。上述<code>person</code>对象一共定义了6个键值对，其中每个键又称为对象的属性，例如，<code>person</code>的<code>name</code>属性为<code>'Bob'</code>，<code>zipcode</code>属性为<code>null</code>。</p>
<p>要获取一个对象的属性，我们用<code>对象变量.属性名</code>的方式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">person.<span class="property">name</span>; <span class="comment">// &#x27;Bob&#x27;</span></span><br><span class="line">person.<span class="property">zipcode</span>; <span class="comment">// null</span></span><br></pre></td></tr></table></figure>
<h3 id="变量">变量</h3>
<p>变量的概念基本上和初中代数的方程变量是一致的，只是在计算机程序中，变量不仅可以是数字，还可以是任意数据类型。</p>
<p>变量在JavaScript中就是用一个变量名表示，变量名是大小写英文、数字、<code>$</code>和<code>_</code>的组合，且不能用数字开头。变量名也不能是JavaScript的关键字，如<code>if</code>、<code>while</code>等。申明一个变量用<code>var</code>语句，比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a; <span class="comment">// 申明了变量a，此时a的值为undefined</span></span><br><span class="line"><span class="keyword">var</span> $b = <span class="number">1</span>; <span class="comment">// 申明了变量$b，同时给$b赋值，此时$b的值为1</span></span><br><span class="line"><span class="keyword">var</span> s_007 = <span class="string">&#x27;007&#x27;</span>; <span class="comment">// s_007是一个字符串</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Answer</span> = <span class="literal">true</span>; <span class="comment">// Answer是一个布尔值true</span></span><br><span class="line"><span class="keyword">var</span> t = <span class="literal">null</span>; <span class="comment">// t的值是null</span></span><br></pre></td></tr></table></figure>
<p>变量名也可以用中文，但是，请不要给自己找麻烦。</p>
<p>在JavaScript中，使用等号<code>=</code>对变量进行赋值。可以把任意数据类型赋值给变量，同一个变量可以反复赋值，而且可以是不同类型的变量，但是要注意只能用<code>var</code>申明一次，例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">123</span>; <span class="comment">// a的值是整数123</span></span><br><span class="line">a = <span class="string">&#x27;ABC&#x27;</span>; <span class="comment">// a变为字符串</span></span><br></pre></td></tr></table></figure>
<p>这种变量本身类型不固定的语言称之为动态语言，与之对应的是静态语言。静态语言在定义变量时必须指定变量类型，如果赋值的时候类型不匹配，就会报错。例如Java是静态语言，赋值语句如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">123</span>; <span class="comment">// a是整数类型变量，类型用int申明</span></span><br><span class="line">a = <span class="string">&quot;ABC&quot;</span>; <span class="comment">// 错误：不能把字符串赋给整型变量</span></span><br></pre></td></tr></table></figure>
<p>和静态语言相比，动态语言更灵活，就是这个原因。</p>
<p>请不要把赋值语句的等号等同于数学的等号。比如下面的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">10</span>;</span><br><span class="line">x = x + <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<p>如果从数学上理解<code>x = x + 2</code>那无论如何是不成立的，在程序中，赋值语句先计算右侧的表达式<code>x + 2</code>，得到结果<code>12</code>，再赋给变量<code>x</code>。由于<code>x</code>之前的值是<code>10</code>，重新赋值后，<code>x</code>的值变成<code>12</code>。</p>
<p>要显示变量的内容，可以用<code>console.log(x)</code>，打开Chrome的控制台就可以看到结果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 打印变量x</span><br><span class="line">var x = 100;</span><br><span class="line">console.log(x);</span><br></pre></td></tr></table></figure>
<p>使用<code>console.log()</code>代替<code>alert()</code>的好处是可以避免弹出烦人的对话框。</p>
<h3 id="strict模式">strict模式</h3>
<p>JavaScript在设计之初，为了方便初学者学习，并不强制要求用<code>var</code>申明变量。这个设计错误带来了严重的后果：如果一个变量没有通过<code>var</code>申明就被使用，那么该变量就自动被申明为全局变量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">10</span>; <span class="comment">// i现在是全局变量</span></span><br></pre></td></tr></table></figure>
<p>在同一个页面的不同的JavaScript文件中，如果都不用<code>var</code>申明，恰好都使用了变量<code>i</code>，将造成变量<code>i</code>互相影响，产生难以调试的错误结果。</p>
<p>使用<code>var</code>申明的变量则不是全局变量，它的范围被限制在该变量被申明的函数体内（函数的概念将稍后讲解），同名变量在不同的函数体内互不冲突。</p>
<p>为了修补JavaScript这一严重设计缺陷，ECMA在后续规范中推出了strict模式，在strict模式下运行的JavaScript代码，强制通过<code>var</code>申明变量，未使用<code>var</code>申明变量就使用的，将导致运行错误。</p>
<p>启用strict模式的方法是在JavaScript代码的第一行写上：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>这是一个字符串，不支持strict模式的浏览器会把它当做一个字符串语句执行，支持strict模式的浏览器将开启strict模式运行JavaScript。</p>
<p>来测试一下你的浏览器是否能支持strict模式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function hello() &#123;</span><br><span class="line">    &#x27;use strict&#x27;;</span><br><span class="line">    // 如果浏览器支持strict模式，</span><br><span class="line">    // 下面的代码将报ReferenceError错误:</span><br><span class="line">    helloStr = &#x27;hello&#x27;;</span><br><span class="line">    console.log(helloStr);</span><br><span class="line">&#125;</span><br><span class="line">hello();</span><br></pre></td></tr></table></figure>
<p>运行代码，如果浏览器报错，请修复后再运行。如果浏览器不报错，说明你的浏览器太古老了，需要尽快升级。</p>
<p>不用<code>var</code>申明的变量会被视为全局变量，为了避免这一缺陷，所有的JavaScript代码都应该使用strict模式。我们在后面编写的JavaScript代码将全部采用strict模式。</p>
<p>另一种申明变量的方式是<code>let</code>，这也是现代JavaScript推荐的方式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 用let申明变量:</span><br><span class="line">let s = &#x27;hello&#x27;;</span><br><span class="line">console.log(s);</span><br></pre></td></tr></table></figure>
<p>后续我们还会详细讨论<code>var</code>和<code>let</code>的区别。</p>
<p>JavaScript的字符串就是用<code>''</code>或<code>&quot;&quot;</code>括起来的字符表示。</p>
<p>如果<code>'</code>本身也是一个字符，那就可以用<code>&quot;&quot;</code>括起来，比如<code>&quot;I'm OK&quot;</code>包含的字符是<code>I</code>，<code>'</code>，<code>m</code>，空格，<code>O</code>，<code>K</code>这6个字符。</p>
<p>如果字符串内部既包含<code>'</code>又包含<code>&quot;</code>怎么办？可以用转义字符<code>\</code>来标识，比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;I\&#x27;m \&quot;OK\&quot;!&#x27;</span>; <span class="comment">// I&#x27;m &quot;OK&quot;!</span></span><br></pre></td></tr></table></figure>
<p>表示的字符串内容是：<code>I'm &quot;OK&quot;!</code></p>
<p>转义字符<code>\</code>可以转义很多字符，比如<code>\n</code>表示换行，<code>\t</code>表示制表符，字符<code>\</code>本身也要转义，所以<code>\\</code>表示的字符就是<code>\</code>。</p>
<p>ASCII字符可以以<code>\x##</code>形式的十六进制表示，例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;\x41&#x27;</span>; <span class="comment">// 完全等同于 &#x27;A&#x27;</span></span><br></pre></td></tr></table></figure>
<p>还可以用<code>\u####</code>表示一个Unicode字符：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;\u4e2d\u6587&#x27;</span>; <span class="comment">// 完全等同于 &#x27;中文&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="多行字符串">多行字符串</h3>
<p>由于多行字符串用<code>\n</code>写起来比较费事，所以最新的ES6标准新增了一种多行字符串的表示方法，用反引号`…`表示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">`这是一个</span></span><br><span class="line"><span class="string">多行</span></span><br><span class="line"><span class="string">字符串`</span>;</span><br></pre></td></tr></table></figure>
<p><em>注意</em>：反引号在键盘的<code>ESC</code>下方，数字键<code>1</code>的左边：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">┌─────┐ ┌─────┬─────┬─────┬─────┐</span><br><span class="line">│ ESC │ │ F1  │ F2  │ F3  │ F4  │</span><br><span class="line">└─────┘ └─────┴─────┴─────┴─────┘</span><br><span class="line">┌─────┬─────┬─────┬─────┬─────┐</span><br><span class="line">│  ~  │  !  │  @  │  #  │  $  │</span><br><span class="line">│  `  │  1  │  2  │  3  │  4  │</span><br><span class="line">├─────┴──┬──┴──┬──┴──┬──┴──┬──┘</span><br><span class="line">│        │     │     │     │</span><br><span class="line">│  tab   │  Q  │  W  │  E  │</span><br><span class="line">├────────┴──┬──┴──┬──┴──┬──┘</span><br><span class="line">│           │     │     │</span><br><span class="line">│ caps lock │  A  │  S  │</span><br><span class="line">└───────────┴─────┴─────┘</span><br></pre></td></tr></table></figure>
<p>练习：测试你的浏览器是否支持ES6标准，如果不支持，请把多行字符串用<code>\n</code>重新表示出来：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 如果浏览器不支持ES6，将报SyntaxError错误:</span><br><span class="line">console.log(`多行</span><br><span class="line">字符串</span><br><span class="line">测试`);</span><br></pre></td></tr></table></figure>
<h3 id="模板字符串">模板字符串</h3>
<p>要把多个字符串连接起来，可以用<code>+</code>号连接：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">&#x27;小明&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> age = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">let</span> message = <span class="string">&#x27;你好, &#x27;</span> + name + <span class="string">&#x27;, 你今年&#x27;</span> + age + <span class="string">&#x27;岁了!&#x27;</span>;</span><br><span class="line"><span class="title function_">alert</span>(message);</span><br></pre></td></tr></table></figure>
<p>如果有很多变量需要连接，用<code>+</code>号就比较麻烦。ES6新增了一种模板字符串，表示方法和上面的多行字符串一样，但是它会自动替换字符串中的变量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">&#x27;小明&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> age = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">let</span> message = <span class="string">`你好, <span class="subst">$&#123;name&#125;</span>, 你今年<span class="subst">$&#123;age&#125;</span>岁了!`</span>;</span><br><span class="line"><span class="title function_">alert</span>(message);</span><br></pre></td></tr></table></figure>
<p>练习：测试你的浏览器是否支持ES6模板字符串，如果不支持，请把模板字符串改为<code>+</code>连接的普通字符串：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 如果浏览器支持模板字符串，将会替换字符串内部的变量:</span><br><span class="line">let name = &#x27;小明&#x27;;</span><br><span class="line">let age = 20;</span><br><span class="line">console.log(`你好, $&#123;name&#125;, 你今年$&#123;age&#125;岁了!`);</span><br></pre></td></tr></table></figure>
<h3 id="操作字符串">操作字符串</h3>
<p>字符串常见的操作如下：</p>
<p>获取字符串长度：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">&#x27;Hello, world!&#x27;</span>;</span><br><span class="line">s.<span class="property">length</span>; <span class="comment">// 13</span></span><br></pre></td></tr></table></figure>
<p>要获取字符串某个指定位置的字符，使用类似Array的下标操作，索引号从0开始：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">&#x27;Hello, world!&#x27;</span>;</span><br><span class="line"></span><br><span class="line">s[<span class="number">0</span>]; <span class="comment">// &#x27;H&#x27;</span></span><br><span class="line">s[<span class="number">6</span>]; <span class="comment">// &#x27; &#x27;</span></span><br><span class="line">s[<span class="number">7</span>]; <span class="comment">// &#x27;w&#x27;</span></span><br><span class="line">s[<span class="number">12</span>]; <span class="comment">// &#x27;!&#x27;</span></span><br><span class="line">s[<span class="number">13</span>]; <span class="comment">// undefined 超出范围的索引不会报错，但一律返回undefined</span></span><br></pre></td></tr></table></figure>
<p><em>需要特别注意的是</em>，字符串是不可变的，如果对字符串的某个索引赋值，不会有任何错误，但是，也没有任何效果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">&#x27;Test&#x27;</span>;</span><br><span class="line">s[<span class="number">0</span>] = <span class="string">&#x27;X&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s); <span class="comment">// s仍然为&#x27;Test&#x27;</span></span><br></pre></td></tr></table></figure>
<p>JavaScript为字符串提供了一些常用方法，注意，调用这些方法本身不会改变原有字符串的内容，而是返回一个新字符串：</p>
<h3 id="toUpperCase">toUpperCase</h3>
<p><code>toUpperCase()</code>把一个字符串全部变为大写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">&#x27;Hello&#x27;</span>;</span><br><span class="line">s.<span class="title function_">toUpperCase</span>(); <span class="comment">// 返回&#x27;HELLO&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="toLowerCase">toLowerCase</h3>
<p><code>toLowerCase()</code>把一个字符串全部变为小写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">&#x27;Hello&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> lower = s.<span class="title function_">toLowerCase</span>(); <span class="comment">// 返回&#x27;hello&#x27;并赋值给变量lower</span></span><br><span class="line">lower; <span class="comment">// &#x27;hello&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="indexOf">indexOf</h3>
<p><code>indexOf()</code>会搜索指定字符串出现的位置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">&#x27;hello, world&#x27;</span>;</span><br><span class="line">s.<span class="title function_">indexOf</span>(<span class="string">&#x27;world&#x27;</span>); <span class="comment">// 返回7</span></span><br><span class="line">s.<span class="title function_">indexOf</span>(<span class="string">&#x27;World&#x27;</span>); <span class="comment">// 没有找到指定的子串，返回-1</span></span><br></pre></td></tr></table></figure>
<h3 id="substring">substring</h3>
<p><code>substring()</code>返回指定索引区间的子串：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">&#x27;hello, world&#x27;</span></span><br><span class="line">s.<span class="title function_">substring</span>(<span class="number">0</span>, <span class="number">5</span>); <span class="comment">// 从索引0开始到5（不包括5），返回&#x27;hello&#x27;</span></span><br><span class="line">s.<span class="title function_">substring</span>(<span class="number">7</span>); <span class="comment">// 从索引7开始到结束，返回&#x27;world&#x27;</span></span><br></pre></td></tr></table></figure>
<p>JavaScript的<code>Array</code>可以包含任意数据类型，并通过索引来访问每个元素。</p>
<p>要取得<code>Array</code>的长度，直接访问<code>length</code>属性：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// Array.length:</span><br><span class="line">let arr = [1, 2, 3.14, &#x27;Hello&#x27;, null, true];</span><br><span class="line">console.log(arr.length); // 6</span><br></pre></td></tr></table></figure>
<p><em>请注意</em>，直接给<code>Array</code>的<code>length</code>赋一个新的值会导致<code>Array</code>大小的变化：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let arr = [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;];</span><br><span class="line">console.log(arr.length); // 3</span><br><span class="line">// 调整数组大小:</span><br><span class="line">arr.length = 6;</span><br><span class="line">console.log(arr); // arr变为[&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, undefined, undefined, undefined]</span><br><span class="line">// 调整数组大小:</span><br><span class="line">arr.length = 2;</span><br><span class="line">console.log(arr); // arr变为[&#x27;A&#x27;, &#x27;B&#x27;]</span><br></pre></td></tr></table></figure>
<p><code>Array</code>可以通过索引把对应的元素修改为新的值，因此，对<code>Array</code>的索引进行赋值会直接修改这个<code>Array</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// Array index:</span><br><span class="line">let arr = [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;];</span><br><span class="line">arr[1] = 99;</span><br><span class="line">console.log(arr); // arr现在变为[&#x27;A&#x27;, 99, &#x27;C&#x27;]</span><br><span class="line">console.log(arr[1]); // 99</span><br></pre></td></tr></table></figure>
<p><em>请注意</em>，如果通过索引赋值时，索引超过了范围，同样会引起<code>Array</code>大小的变化：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 索引超出范围会导致数组大小自动调整:</span><br><span class="line">let arr = [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;];</span><br><span class="line">arr[5] = &#x27;x&#x27;;</span><br><span class="line">console.log(arr); // arr变为[&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, undefined, undefined, &#x27;x&#x27;]</span><br></pre></td></tr></table></figure>
<p>大多数其他编程语言不允许直接改变数组的大小，越界访问索引会报错。然而，JavaScript的<code>Array</code>却不会有任何错误。在编写代码时，不建议直接修改<code>Array</code>的大小，访问索引时要确保索引不会越界。</p>
<h3 id="indexOf-2">indexOf</h3>
<p>与String类似，<code>Array</code>也可以通过<code>indexOf()</code>来搜索一个指定的元素的位置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">10</span>, <span class="number">20</span>, <span class="string">&#x27;30&#x27;</span>, <span class="string">&#x27;xyz&#x27;</span>];</span><br><span class="line">arr.<span class="title function_">indexOf</span>(<span class="number">10</span>); <span class="comment">// 元素10的索引为0</span></span><br><span class="line">arr.<span class="title function_">indexOf</span>(<span class="number">20</span>); <span class="comment">// 元素20的索引为1</span></span><br><span class="line">arr.<span class="title function_">indexOf</span>(<span class="number">30</span>); <span class="comment">// 元素30没有找到，返回-1</span></span><br><span class="line">arr.<span class="title function_">indexOf</span>(<span class="string">&#x27;30&#x27;</span>); <span class="comment">// 元素&#x27;30&#x27;的索引为2</span></span><br></pre></td></tr></table></figure>
<p>注意了，数字<code>30</code>和字符串<code>'30'</code>是不同的元素。</p>
<h3 id="slice">slice</h3>
<p><code>slice()</code>就是对应String的<code>substring()</code>版本，它截取<code>Array</code>的部分元素，然后返回一个新的<code>Array</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>];</span><br><span class="line">arr.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">3</span>); <span class="comment">// 从索引0开始，到索引3结束，但不包括索引3: [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;]</span></span><br><span class="line">arr.<span class="title function_">slice</span>(<span class="number">3</span>); <span class="comment">// 从索引3开始到结束: [&#x27;D&#x27;, &#x27;E&#x27;, &#x27;F&#x27;, &#x27;G&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>注意到<code>slice()</code>的起止参数包括开始索引，不包括结束索引。</p>
<p>如果不给<code>slice()</code>传递任何参数，它就会从头到尾截取所有元素。利用这一点，我们可以很容易地复制一个<code>Array</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> aCopy = arr.<span class="title function_">slice</span>();</span><br><span class="line">aCopy; <span class="comment">// [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, &#x27;D&#x27;, &#x27;E&#x27;, &#x27;F&#x27;, &#x27;G&#x27;]</span></span><br><span class="line">aCopy === arr; <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h3 id="push和pop">push和pop</h3>
<p><code>push()</code>向<code>Array</code>的末尾添加若干元素，<code>pop()</code>则把<code>Array</code>的最后一个元素删除掉：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">arr.<span class="title function_">push</span>(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>); <span class="comment">// 返回Array新的长度: 4</span></span><br><span class="line">arr; <span class="comment">// [1, 2, &#x27;A&#x27;, &#x27;B&#x27;]</span></span><br><span class="line">arr.<span class="title function_">pop</span>(); <span class="comment">// pop()返回&#x27;B&#x27;</span></span><br><span class="line">arr; <span class="comment">// [1, 2, &#x27;A&#x27;]</span></span><br><span class="line">arr.<span class="title function_">pop</span>(); arr.<span class="title function_">pop</span>(); arr.<span class="title function_">pop</span>(); <span class="comment">// 连续pop 3次</span></span><br><span class="line">arr; <span class="comment">// []</span></span><br><span class="line">arr.<span class="title function_">pop</span>(); <span class="comment">// 空数组继续pop不会报错，而是返回undefined</span></span><br><span class="line">arr; <span class="comment">// []</span></span><br></pre></td></tr></table></figure>
<h3 id="unshift和shift">unshift和shift</h3>
<p>如果要往<code>Array</code>的头部添加若干元素，使用<code>unshift()</code>方法，<code>shift()</code>方法则把<code>Array</code>的第一个元素删掉：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">arr.<span class="title function_">unshift</span>(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>); <span class="comment">// 返回Array新的长度: 4</span></span><br><span class="line">arr; <span class="comment">// [&#x27;A&#x27;, &#x27;B&#x27;, 1, 2]</span></span><br><span class="line">arr.<span class="title function_">shift</span>(); <span class="comment">// &#x27;A&#x27;</span></span><br><span class="line">arr; <span class="comment">// [&#x27;B&#x27;, 1, 2]</span></span><br><span class="line">arr.<span class="title function_">shift</span>(); arr.<span class="title function_">shift</span>(); arr.<span class="title function_">shift</span>(); <span class="comment">// 连续shift 3次</span></span><br><span class="line">arr; <span class="comment">// []</span></span><br><span class="line">arr.<span class="title function_">shift</span>(); <span class="comment">// 空数组继续shift不会报错，而是返回undefined</span></span><br><span class="line">arr; <span class="comment">// []</span></span><br></pre></td></tr></table></figure>
<h3 id="sort">sort</h3>
<p><code>sort()</code>可以对当前<code>Array</code>进行排序，它会直接修改当前<code>Array</code>的元素位置，直接调用时，按照默认顺序排序：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;A&#x27;</span>];</span><br><span class="line">arr.<span class="title function_">sort</span>();</span><br><span class="line">arr; <span class="comment">// [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>能否按照我们自己指定的顺序排序呢？完全可以，我们将在后面的函数中讲到。</p>
<h3 id="reverse">reverse</h3>
<p><code>reverse()</code>把整个<code>Array</code>的元素给调个个，也就是反转：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;three&#x27;</span>];</span><br><span class="line">arr.<span class="title function_">reverse</span>(); </span><br><span class="line">arr; <span class="comment">// [&#x27;three&#x27;, &#x27;two&#x27;, &#x27;one&#x27;]</span></span><br></pre></td></tr></table></figure>
<h3 id="splice">splice</h3>
<p><code>splice()</code>方法是修改<code>Array</code>的“万能方法”，它可以从指定的索引开始删除若干元素，然后再从该位置添加若干元素：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;Microsoft&#x27;</span>, <span class="string">&#x27;Apple&#x27;</span>, <span class="string">&#x27;Yahoo&#x27;</span>, <span class="string">&#x27;AOL&#x27;</span>, <span class="string">&#x27;Excite&#x27;</span>, <span class="string">&#x27;Oracle&#x27;</span>];</span><br><span class="line"><span class="comment">// 从索引2开始删除3个元素,然后再添加两个元素:</span></span><br><span class="line">arr.<span class="title function_">splice</span>(<span class="number">2</span>, <span class="number">3</span>, <span class="string">&#x27;Google&#x27;</span>, <span class="string">&#x27;Facebook&#x27;</span>); <span class="comment">// 返回删除的元素 [&#x27;Yahoo&#x27;, &#x27;AOL&#x27;, &#x27;Excite&#x27;]</span></span><br><span class="line">arr; <span class="comment">// [&#x27;Microsoft&#x27;, &#x27;Apple&#x27;, &#x27;Google&#x27;, &#x27;Facebook&#x27;, &#x27;Oracle&#x27;]</span></span><br><span class="line"><span class="comment">// 只删除,不添加:</span></span><br><span class="line">arr.<span class="title function_">splice</span>(<span class="number">2</span>, <span class="number">2</span>); <span class="comment">// [&#x27;Google&#x27;, &#x27;Facebook&#x27;]</span></span><br><span class="line">arr; <span class="comment">// [&#x27;Microsoft&#x27;, &#x27;Apple&#x27;, &#x27;Oracle&#x27;]</span></span><br><span class="line"><span class="comment">// 只添加,不删除:</span></span><br><span class="line">arr.<span class="title function_">splice</span>(<span class="number">2</span>, <span class="number">0</span>, <span class="string">&#x27;Google&#x27;</span>, <span class="string">&#x27;Facebook&#x27;</span>); <span class="comment">// 返回[],因为没有删除任何元素</span></span><br><span class="line">arr; <span class="comment">// [&#x27;Microsoft&#x27;, &#x27;Apple&#x27;, &#x27;Google&#x27;, &#x27;Facebook&#x27;, &#x27;Oracle&#x27;]</span></span><br></pre></td></tr></table></figure>
<h3 id="concat">concat</h3>
<p><code>concat()</code>方法把当前的<code>Array</code>和另一个<code>Array</code>连接起来，并返回一个新的<code>Array</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> added = arr.<span class="title function_">concat</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line">added; <span class="comment">// [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, 1, 2, 3]</span></span><br><span class="line">arr; <span class="comment">// [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;]</span></span><br></pre></td></tr></table></figure>
<p><em>请注意</em>，<code>concat()</code>方法并没有修改当前<code>Array</code>，而是返回了一个新的<code>Array</code>。</p>
<p>实际上，<code>concat()</code>方法可以接收任意个元素和<code>Array</code>，并且自动把<code>Array</code>拆开，然后全部添加到新的<code>Array</code>里：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>];</span><br><span class="line">arr.<span class="title function_">concat</span>(<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>]); <span class="comment">// [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, 1, 2, 3, 4]</span></span><br></pre></td></tr></table></figure>
<h3 id="join">join</h3>
<p><code>join()</code>方法是一个非常实用的方法，它把当前<code>Array</code>的每个元素都用指定的字符串连接起来，然后返回连接后的字符串：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">arr.<span class="title function_">join</span>(<span class="string">&#x27;-&#x27;</span>); <span class="comment">// &#x27;A-B-C-1-2-3&#x27;</span></span><br></pre></td></tr></table></figure>
<p>练习：在新生欢迎会上，你已经拿到了新同学的名单，请排序后显示：欢迎XXX，XXX，XXX和XXX同学！：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let arr = [&#x27;小明&#x27;, &#x27;小红&#x27;, &#x27;大军&#x27;, &#x27;阿黄&#x27;];</span><br><span class="line"></span><br><span class="line">console.log(&#x27;???&#x27;);</span><br></pre></td></tr></table></figure>
<p>如果<code>Array</code>的元素不是字符串，将自动转换为字符串后再连接。</p>
<h3 id="多维数组">多维数组</h3>
<p>如果数组的某个元素又是一个<code>Array</code>，则可以形成多维数组，例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">400</span>, <span class="number">500</span>, <span class="number">600</span>], <span class="string">&#x27;-&#x27;</span>];</span><br></pre></td></tr></table></figure>
<p>上述<code>Array</code>包含3个元素，其中头两个元素本身也是<code>Array</code>。</p>
<p>练习：如何通过索引取到<code>500</code>这个值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let arr = [[1, 2, 3], [400, 500, 600], &#x27;-&#x27;];</span><br><span class="line"></span><br><span class="line">let x = ??;</span><br><span class="line">console.log(x); // x应该为500</span><br></pre></td></tr></table></figure>
<h3 id="小结">小结</h3>
<p><code>Array</code>提供了一种顺序存储一组元素的功能，并可以按索引来读写。</p>
<p>JavaScript的对象是一种无序的集合数据类型，它由若干键值对组成。</p>
<p>JavaScript的对象用于描述现实世界中的某个对象。例如，为了描述“小明”这个淘气的小朋友，我们可以用若干键值对来描述他：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span>,</span><br><span class="line">    <span class="attr">school</span>: <span class="string">&#x27;No.1 Middle School&#x27;</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">1.70</span>,</span><br><span class="line">    <span class="attr">weight</span>: <span class="number">65</span>,</span><br><span class="line">    <span class="attr">score</span>: <span class="literal">null</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>JavaScript用一个<code>&#123;...&#125;</code>表示一个对象，键值对以<code>xxx: xxx</code>形式申明，用<code>,</code>隔开。注意，最后一个键值对不需要在末尾加<code>,</code>，如果加了，有的浏览器（如低版本的IE）将报错。</p>
<p>上述对象申明了一个<code>name</code>属性，值是<code>'小明'</code>，<code>birth</code>属性，值是<code>1990</code>，以及其他一些属性。最后，把这个对象赋值给变量<code>xiaoming</code>后，就可以通过变量<code>xiaoming</code>来获取小明的属性了：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xiaoming.<span class="property">name</span>; <span class="comment">// &#x27;小明&#x27;</span></span><br><span class="line">xiaoming.<span class="property">birth</span>; <span class="comment">// 1990</span></span><br></pre></td></tr></table></figure>
<p>访问属性是通过<code>.</code>操作符完成的，但这要求属性名必须是一个有效的变量名。如果属性名包含特殊字符，就必须用<code>''</code>括起来：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xiaohong = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小红&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;middle-school&#x27;</span>: <span class="string">&#x27;No.1 Middle School&#x27;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>xiaohong</code>的属性名<code>middle-school</code>不是一个有效的变量，就需要用<code>''</code>括起来。访问这个属性也无法使用<code>.</code>操作符，必须用<code>['xxx']</code>来访问：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xiaohong[<span class="string">&#x27;middle-school&#x27;</span>]; <span class="comment">// &#x27;No.1 Middle School&#x27;</span></span><br><span class="line">xiaohong[<span class="string">&#x27;name&#x27;</span>]; <span class="comment">// &#x27;小红&#x27;</span></span><br><span class="line">xiaohong.<span class="property">name</span>; <span class="comment">// &#x27;小红&#x27;</span></span><br></pre></td></tr></table></figure>
<p>也可以用<code>xiaohong['name']</code>来访问<code>xiaohong</code>的<code>name</code>属性，不过<code>xiaohong.name</code>的写法更简洁。我们在编写JavaScript代码的时候，属性名尽量使用标准的变量名，这样就可以直接通过<code>object.prop</code>的形式访问一个属性了。</p>
<p>实际上JavaScript对象的所有属性都是字符串，不过属性对应的值可以是任意数据类型。</p>
<p>如果访问一个不存在的属性会返回什么呢？JavaScript规定，访问不存在的属性不报错，而是返回<code>undefined</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x27;use strict&#x27;;</span><br><span class="line"></span><br><span class="line">let xiaoming = &#123;</span><br><span class="line">    name: &#x27;小明&#x27;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">console.log(xiaoming.name);</span><br><span class="line">console.log(xiaoming.age); // undefined</span><br></pre></td></tr></table></figure>
<p>由于JavaScript的对象是动态类型，你可以自由地给一个对象添加或删除属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line">xiaoming.<span class="property">age</span>; <span class="comment">// undefined</span></span><br><span class="line">xiaoming.<span class="property">age</span> = <span class="number">18</span>; <span class="comment">// 新增一个age属性</span></span><br><span class="line">xiaoming.<span class="property">age</span>; <span class="comment">// 18</span></span><br><span class="line"><span class="keyword">delete</span> xiaoming.<span class="property">age</span>; <span class="comment">// 删除age属性</span></span><br><span class="line">xiaoming.<span class="property">age</span>; <span class="comment">// undefined</span></span><br><span class="line"><span class="keyword">delete</span> xiaoming[<span class="string">&#x27;name&#x27;</span>]; <span class="comment">// 删除name属性</span></span><br><span class="line">xiaoming.<span class="property">name</span>; <span class="comment">// undefined</span></span><br><span class="line"><span class="keyword">delete</span> xiaoming.<span class="property">school</span>; <span class="comment">// 删除一个不存在的school属性也不会报错</span></span><br></pre></td></tr></table></figure>
<p>如果我们要检测<code>xiaoming</code>是否拥有某一属性，可以用<code>in</code>操作符：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span>,</span><br><span class="line">    <span class="attr">school</span>: <span class="string">&#x27;No.1 Middle School&#x27;</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">1.70</span>,</span><br><span class="line">    <span class="attr">weight</span>: <span class="number">65</span>,</span><br><span class="line">    <span class="attr">score</span>: <span class="literal">null</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="string">&#x27;name&#x27;</span> <span class="keyword">in</span> xiaoming; <span class="comment">// true</span></span><br><span class="line"><span class="string">&#x27;grade&#x27;</span> <span class="keyword">in</span> xiaoming; <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>不过要小心，如果<code>in</code>判断一个属性存在，这个属性不一定是<code>xiaoming</code>的，它可能是<code>xiaoming</code>继承得到的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;toString&#x27;</span> <span class="keyword">in</span> xiaoming; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>因为<code>toString</code>定义在<code>object</code>对象中，而所有对象最终都会在原型链上指向<code>object</code>，所以<code>xiaoming</code>也拥有<code>toString</code>属性。</p>
<p>要判断一个属性是否是<code>xiaoming</code>自身拥有的，而不是继承得到的，可以用<code>hasOwnProperty()</code>方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line">xiaoming.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;name&#x27;</span>); <span class="comment">// true</span></span><br><span class="line">xiaoming.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;toString&#x27;</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h2 id="条件判断">条件判断</h2>
<p>JavaScript使用<code>if () &#123; ... &#125; else &#123; ... &#125;</code>来进行条件判断。例如，根据年龄显示不同内容，可以用<code>if</code>语句实现如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> age = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">if</span> (age &gt;= <span class="number">18</span>) &#123; <span class="comment">// 如果age &gt;= 18为true，则执行if语句块</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;adult&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123; <span class="comment">// 否则执行else语句块</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;teenager&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中<code>else</code>语句是可选的。如果语句块只包含一条语句，那么可以省略<code>&#123;&#125;</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> age = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">if</span> (age &gt;= <span class="number">18</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;adult&#x27;</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;teenager&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>省略<code>&#123;&#125;</code>的危险之处在于，如果后来想添加一些语句，却忘了写<code>&#123;&#125;</code>，就改变了<code>if...else...</code>的语义，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let age = 20;</span><br><span class="line">if (age &gt;= 18)</span><br><span class="line">    console.log(&#x27;adult&#x27;);</span><br><span class="line">else</span><br><span class="line">    console.log(&#x27;age &lt; 18&#x27;); // 添加一行日志</span><br><span class="line">    console.log(&#x27;teenager&#x27;); // &lt;- 这行语句已经不在else的控制范围了</span><br></pre></td></tr></table></figure>
<p>上述代码的<code>else</code>子句实际上只负责执行<code>console.log('age &lt; 18');</code>，原有的<code>console.log('teenager');</code>已经不属于<code>if...else...</code>的控制范围了，它每次都会执行。</p>
<p>相反地，有<code>&#123;&#125;</code>的语句就不会出错：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let age = 20;</span><br><span class="line">if (age &gt;= 18) &#123;</span><br><span class="line">    console.log(&#x27;adult&#x27;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    console.log(&#x27;age &lt; 18&#x27;);</span><br><span class="line">    console.log(&#x27;teenager&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这就是为什么我们建议永远都要写上<code>&#123;&#125;</code>。</p>
<h3 id="多行条件判断">多行条件判断</h3>
<p>如果还要更细致地判断条件，可以使用多个<code>if...else...</code>的组合：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> age = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">if</span> (age &gt;= <span class="number">18</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;adult&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (age &gt;= <span class="number">6</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;teenager&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;kid&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述多个<code>if...else...</code>的组合实际上相当于两层<code>if...else...</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> age = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">if</span> (age &gt;= <span class="number">18</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;adult&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (age &gt;= <span class="number">6</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;teenager&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;kid&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是我们通常把<code>else if</code>连写在一起，来增加可读性。这里的<code>else</code>略掉了<code>&#123;&#125;</code>是没有问题的，因为它只包含一个<code>if</code>语句。注意最后一个单独的<code>else</code>不要略掉<code>&#123;&#125;</code>。</p>
<p><em>请注意</em>，<code>if...else...</code>语句的执行特点是二选一，在多个<code>if...else...</code>语句中，如果某个条件成立，则后续就不再继续判断了。</p>
<p>试解释为什么下面的代码显示的是<code>teenager</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x27;use strict&#x27;;</span><br><span class="line">let age = 20;</span><br><span class="line"></span><br><span class="line">if (age &gt;= 6) &#123;</span><br><span class="line">    console.log(&#x27;teenager&#x27;);</span><br><span class="line">&#125; else if (age &gt;= 18) &#123;</span><br><span class="line">    console.log(&#x27;adult&#x27;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    console.log(&#x27;kid&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于<code>age</code>的值为<code>20</code>，它实际上同时满足条件<code>age &gt;= 6</code>和<code>age &gt;= 18</code>，这说明条件判断的顺序非常重要。请修复后让其显示<code>adult</code>。</p>
<p>如果<code>if</code>的条件判断语句结果不是<code>true</code>或<code>false</code>怎么办？例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (s.<span class="property">length</span>) &#123; <span class="comment">// 条件计算结果为3</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JavaScript把<code>null</code>、<code>undefined</code>、<code>0</code>、<code>NaN</code>和空字符串<code>''</code>视为<code>false</code>，其他值一概视为<code>true</code>，因此上述代码条件判断的结果是<code>true</code>。</p>
<h3 id="练习-3">练习</h3>
<p>小明身高1.75，体重80.5kg。请根据BMI公式（体重除以身高的平方）帮小明计算他的BMI指数，并根据BMI指数：</p>
<ul>
<li>低于18.5：过轻</li>
<li>18.5-25：正常</li>
<li>25-28：过重</li>
<li>28-32：肥胖</li>
<li>高于32：严重肥胖</li>
</ul>
<p>用<code>if...else...</code>判断并显示结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let height = parseFloat(prompt(&#x27;请输入身高(m):&#x27;));</span><br><span class="line">let weight = parseFloat(prompt(&#x27;请输入体重(kg):&#x27;));</span><br><span class="line"></span><br><span class="line">// TODO:</span><br><span class="line">let bmi = ???;</span><br><span class="line">if ...</span><br></pre></td></tr></table></figure>
<hr>
<hr>
<p>要计算1+2+3，我们可以直接写表达式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> + <span class="number">2</span> + <span class="number">3</span>; <span class="comment">// 6</span></span><br></pre></td></tr></table></figure>
<p>要计算1+2+3+…+10，勉强也能写出来。</p>
<p>但是，要计算1+2+3+…+10000，直接写表达式就不可能了。</p>
<p>为了让计算机能计算成千上万次的重复运算，我们就需要循环语句。</p>
<p>JavaScript的循环有两种，一种是<code>for</code>循环，通过初始条件、结束条件和递增条件来循环执行语句块：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> i;</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;=<span class="number">10000</span>; i++) &#123;</span><br><span class="line">    x = x + i;</span><br><span class="line">&#125;</span><br><span class="line">x; <span class="comment">// 50005000</span></span><br></pre></td></tr></table></figure>
<p>让我们来分析一下<code>for</code>循环的控制条件：</p>
<ul>
<li>i=1 这是初始条件，将变量i置为1；</li>
<li>i&lt;=10000 这是判断条件，满足时就继续循环，不满足就退出循环；</li>
<li>i++ 这是每次循环后的递增条件，由于每次循环后变量i都会加1，因此它终将在若干次循环后不满足判断条件<code>i&lt;=10000</code>而退出循环。</li>
</ul>
<p>练习：利用<code>for</code>循环计算<code>1 * 2 * 3 * ... * 10</code>的结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">let x = ?;</span><br><span class="line">let i;</span><br><span class="line">for ...</span><br><span class="line"></span><br><span class="line">if (x === 3628800) &#123;</span><br><span class="line">    console.log(&#x27;1 x 2 x 3 x ... x 10 = &#x27; + x);</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">    console.log(&#x27;计算错误&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>for</code>循环最常用的地方是利用索引来遍历数组：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;Apple&#x27;</span>, <span class="string">&#x27;Google&#x27;</span>, <span class="string">&#x27;Microsoft&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> i, x;</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    x = arr[i];</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>for</code>循环的3个条件都是可以省略的，如果没有退出循环的判断条件，就必须使用<code>break</code>语句退出循环，否则就是死循环：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (;;) &#123; <span class="comment">// 将无限循环下去</span></span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">100</span>) &#123;</span><br><span class="line">        <span class="keyword">break</span>; <span class="comment">// 通过if判断来退出循环</span></span><br><span class="line">    &#125;</span><br><span class="line">    x ++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="for-…-in">for … in</h3>
<p><code>for</code>循环的一个变体是<code>for ... in</code>循环，它可以把一个对象的所有属性依次循环出来：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Jack&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">city</span>: <span class="string">&#x27;Beijing&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> o) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key); <span class="comment">// &#x27;name&#x27;, &#x27;age&#x27;, &#x27;city&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>要过滤掉对象继承的属性，用<code>hasOwnProperty()</code>来实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Jack&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">city</span>: <span class="string">&#x27;Beijing&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> o) &#123;</span><br><span class="line">    <span class="keyword">if</span> (o.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(key); <span class="comment">// &#x27;name&#x27;, &#x27;age&#x27;, &#x27;city&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于<code>Array</code>也是对象，而它的每个元素的索引被视为对象的属性，因此，<code>for ... in</code>循环可以直接循环出<code>Array</code>的索引：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> a) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(i); <span class="comment">// &#x27;0&#x27;, &#x27;1&#x27;, &#x27;2&#x27;</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a[i]); <span class="comment">// &#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>请注意</em>，<code>for ... in</code>对<code>Array</code>的循环得到的是<code>String</code>而不是<code>Number</code>。</p>
<h3 id="while">while</h3>
<p><code>for</code>循环在已知循环的初始和结束条件时非常有用。而上述忽略了条件的<code>for</code>循环容易让人看不清循环的逻辑，此时用<code>while</code>循环更佳。</p>
<p><code>while</code>循环只有一个判断条件，条件满足，就不断循环，条件不满足时则退出循环。比如我们要计算100以内所有奇数之和，可以用while循环实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> n = <span class="number">99</span>;</span><br><span class="line"><span class="keyword">while</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    x = x + n;</span><br><span class="line">    n = n - <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line">x; <span class="comment">// 2500</span></span><br></pre></td></tr></table></figure>
<p>在循环内部变量<code>n</code>不断自减，直到变为<code>-1</code>时，不再满足<code>while</code>条件，循环退出。</p>
<h3 id="do-…-while">do … while</h3>
<p>最后一种循环是<code>do &#123; ... &#125; while()</code>循环，它和<code>while</code>循环的唯一区别在于，不是在每次循环开始的时候判断条件，而是在每次循环完成的时候判断条件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> n = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    n = n + <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">while</span> (n &lt; <span class="number">100</span>);</span><br><span class="line">n; <span class="comment">// 100</span></span><br></pre></td></tr></table></figure>
<p>用<code>do &#123; ... &#125; while()</code>循环要小心，循环体会至少执行1次，而<code>for</code>和<code>while</code>循环则可能一次都不执行。</p>
<h3 id="练习-4">练习</h3>
<p>请利用循环遍历数组中的每个名字，并显示<code>Hello, xxx!</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let arr = [&#x27;Bart&#x27;, &#x27;Lisa&#x27;, &#x27;Adam&#x27;];</span><br><span class="line"></span><br><span class="line">for ...</span><br></pre></td></tr></table></figure>
<p>请尝试<code>for</code>循环和<code>while</code>循环，并以正序、倒序两种方式遍历。</p>
<h3 id="小结-2">小结</h3>
<p>循环是让计算机做重复任务的有效的方法，有些时候，如果代码写得有问题，会让程序陷入“死循环”，也就是永远循环下去。JavaScript的死循环会让浏览器无法正常显示或执行当前页面的逻辑，有的浏览器会直接挂掉，有的浏览器会在一段时间后提示你强行终止JavaScript的执行，因此，要特别注意死循环的问题。</p>
<p>在编写循环代码时，务必小心编写初始条件和判断条件，尤其是边界值。特别注意<code>i &lt; 100</code>和<code>i &lt;= 100</code>是不同的判断逻辑。</p>
<p>JavaScript的默认对象表示方式<code>&#123;&#125;</code>可以视为其他语言中的<code>Map</code>或<code>Dictionary</code>的数据结构，即一组键值对。</p>
<p>但是JavaScript的对象有个小问题，就是键必须是字符串。但实际上Number或者其他数据类型作为键也是非常合理的。</p>
<p>为了解决这个问题，最新的ES6规范引入了新的数据类型<code>Map</code>。要测试你的浏览器是否支持ES6规范，请执行以下代码，如果浏览器报ReferenceError错误，那么你需要换一个支持ES6的浏览器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let m = new Map();</span><br><span class="line">let s = new Set();</span><br><span class="line">console.log(&#x27;你的浏览器支持Map和Set！&#x27;);</span><br><span class="line">// 直接运行测试</span><br></pre></td></tr></table></figure>
<h3 id="Map">Map</h3>
<p><code>Map</code>是一组键值对的结构，具有极快的查找速度。</p>
<p>举个例子，假设要根据同学的名字查找对应的成绩，如果用<code>Array</code>实现，需要两个<code>Array</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> names = [<span class="string">&#x27;Michael&#x27;</span>, <span class="string">&#x27;Bob&#x27;</span>, <span class="string">&#x27;Tracy&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> scores = [<span class="number">95</span>, <span class="number">75</span>, <span class="number">85</span>];</span><br></pre></td></tr></table></figure>
<p>给定一个名字，要查找对应的成绩，就先要在names中找到对应的位置，再从scores取出对应的成绩，Array越长，耗时越长。</p>
<p>如果用Map实现，只需要一个“名字”-“成绩”的对照表，直接根据名字查找成绩，无论这个表有多大，查找速度都不会变慢。用JavaScript写一个Map如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> m = <span class="keyword">new</span> <span class="title class_">Map</span>([[<span class="string">&#x27;Michael&#x27;</span>, <span class="number">95</span>], [<span class="string">&#x27;Bob&#x27;</span>, <span class="number">75</span>], [<span class="string">&#x27;Tracy&#x27;</span>, <span class="number">85</span>]]);</span><br><span class="line">m.<span class="title function_">get</span>(<span class="string">&#x27;Michael&#x27;</span>); <span class="comment">// 95</span></span><br></pre></td></tr></table></figure>
<p>初始化<code>Map</code>需要一个二维数组，或者直接初始化一个空<code>Map</code>。<code>Map</code>具有以下方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> m = <span class="keyword">new</span> <span class="title class_">Map</span>(); <span class="comment">// 空Map</span></span><br><span class="line">m.<span class="title function_">set</span>(<span class="string">&#x27;Adam&#x27;</span>, <span class="number">67</span>); <span class="comment">// 添加新的key-value</span></span><br><span class="line">m.<span class="title function_">set</span>(<span class="string">&#x27;Bob&#x27;</span>, <span class="number">59</span>);</span><br><span class="line">m.<span class="title function_">has</span>(<span class="string">&#x27;Adam&#x27;</span>); <span class="comment">// 是否存在key &#x27;Adam&#x27;: true</span></span><br><span class="line">m.<span class="title function_">get</span>(<span class="string">&#x27;Adam&#x27;</span>); <span class="comment">// 67</span></span><br><span class="line">m.<span class="title function_">delete</span>(<span class="string">&#x27;Adam&#x27;</span>); <span class="comment">// 删除key &#x27;Adam&#x27;</span></span><br><span class="line">m.<span class="title function_">get</span>(<span class="string">&#x27;Adam&#x27;</span>); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<p>由于一个key只能对应一个value，所以，多次对一个key放入value，后面的值会把前面的值冲掉：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> m = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">m.<span class="title function_">set</span>(<span class="string">&#x27;Adam&#x27;</span>, <span class="number">67</span>);</span><br><span class="line">m.<span class="title function_">set</span>(<span class="string">&#x27;Adam&#x27;</span>, <span class="number">88</span>);</span><br><span class="line">m.<span class="title function_">get</span>(<span class="string">&#x27;Adam&#x27;</span>); <span class="comment">// 88</span></span><br></pre></td></tr></table></figure>
<h3 id="Set">Set</h3>
<p><code>Set</code>和<code>Map</code>类似，也是一组key的集合，但不存储value。由于key不能重复，所以，在<code>Set</code>中，没有重复的key。</p>
<p>要创建一个<code>Set</code>，需要提供一个<code>Array</code>作为输入，或者直接创建一个空<code>Set</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="keyword">new</span> <span class="title class_">Set</span>(); <span class="comment">// 空Set</span></span><br><span class="line"><span class="keyword">let</span> s2 = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]); <span class="comment">// 含1, 2, 3</span></span><br></pre></td></tr></table></figure>
<p>重复元素在<code>Set</code>中自动被过滤：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="string">&#x27;3&#x27;</span>]);</span><br><span class="line">s; <span class="comment">// Set &#123;1, 2, 3, &quot;3&quot;&#125;</span></span><br></pre></td></tr></table></figure>
<p>注意数字<code>3</code>和字符串<code>'3'</code>是不同的元素。</p>
<p>通过<code>add(key)</code>方法可以添加元素到<code>Set</code>中，可以重复添加，但不会有效果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s.<span class="title function_">add</span>(<span class="number">4</span>);</span><br><span class="line">s; <span class="comment">// Set &#123;1, 2, 3, 4&#125;</span></span><br><span class="line">s.<span class="title function_">add</span>(<span class="number">4</span>);</span><br><span class="line">s; <span class="comment">// 仍然是 Set &#123;1, 2, 3, 4&#125;</span></span><br></pre></td></tr></table></figure>
<p>通过<code>delete(key)</code>方法可以删除元素：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line">s; <span class="comment">// Set &#123;1, 2, 3&#125;</span></span><br><span class="line">s.<span class="title function_">delete</span>(<span class="number">3</span>);</span><br><span class="line">s; <span class="comment">// Set &#123;1, 2&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="小结-3">小结</h3>
<p><code>Map</code>和<code>Set</code>是ES6标准新增的数据类型，请根据浏览器的支持情况决定是否要使用。</p>
<p>遍历<code>Array</code>可以采用下标循环，遍历<code>Map</code>和<code>Set</code>就无法使用下标。为了统一集合类型，ES6标准引入了新的<code>iterable</code>类型，<code>Array</code>、<code>Map</code>和<code>Set</code>都属于<code>iterable</code>类型。</p>
<p>具有<code>iterable</code>类型的集合可以通过新的<code>for ... of</code>循环来遍历。</p>
<p><code>for ... of</code>循环是ES6引入的新的语法，请测试你的浏览器是否支持：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let a = [1, 2, 3];</span><br><span class="line">for (let x of a) &#123;</span><br><span class="line">&#125;</span><br><span class="line">console.log(&#x27;你的浏览器支持for ... of&#x27;);</span><br><span class="line">// 请直接运行测试</span><br></pre></td></tr></table></figure>
<p>用<code>for ... of</code>循环遍历集合，用法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> s = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>]);</span><br><span class="line"><span class="keyword">let</span> m = <span class="keyword">new</span> <span class="title class_">Map</span>([[<span class="number">1</span>, <span class="string">&#x27;x&#x27;</span>], [<span class="number">2</span>, <span class="string">&#x27;y&#x27;</span>], [<span class="number">3</span>, <span class="string">&#x27;z&#x27;</span>]]);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> x <span class="keyword">of</span> a) &#123; <span class="comment">// 遍历Array</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> x <span class="keyword">of</span> s) &#123; <span class="comment">// 遍历Set</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> x <span class="keyword">of</span> m) &#123; <span class="comment">// 遍历Map</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x[<span class="number">0</span>] + <span class="string">&#x27;=&#x27;</span> + x[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你可能会有疑问，<code>for ... of</code>循环和<code>for ... in</code>循环有何区别？</p>
<p><code>for ... in</code>循环由于历史遗留问题，它遍历的实际上是对象的属性名称。一个<code>Array</code>数组实际上也是一个对象，它的每个元素的索引被视为一个属性。</p>
<p>当我们手动给<code>Array</code>对象添加了额外的属性后，<code>for ... in</code>循环将带来意想不到的意外效果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>];</span><br><span class="line">a.<span class="property">name</span> = <span class="string">&#x27;Hello&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> x <span class="keyword">in</span> a) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x); <span class="comment">// &#x27;0&#x27;, &#x27;1&#x27;, &#x27;2&#x27;, &#x27;name&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>for ... in</code>循环将把<code>name</code>包括在内，但<code>Array</code>的<code>length</code>属性却不包括在内。</p>
<p><code>for ... of</code>循环则完全修复了这些问题，它只循环集合本身的元素：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>];</span><br><span class="line">a.<span class="property">name</span> = <span class="string">&#x27;Hello&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> x <span class="keyword">of</span> a) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x); <span class="comment">// &#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这就是为什么要引入新的<code>for ... of</code>循环。</p>
<p>然而，更好的方式是直接使用<code>iterable</code>内置的<code>forEach</code>方法，它接收一个函数，每次迭代就自动回调该函数。以<code>Array</code>为例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let a = [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;];</span><br><span class="line">a.forEach(function (element, index, array) &#123;</span><br><span class="line">    // element: 指向当前元素的值</span><br><span class="line">    // index: 指向当前索引</span><br><span class="line">    // array: 指向Array对象本身</span><br><span class="line">    console.log(`$&#123;element&#125;, index = $&#123;index&#125;`);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><em>注意</em>，<code>forEach()</code>方法是ES5.1标准引入的，你需要测试浏览器是否支持。</p>
<p><code>Set</code>与<code>Array</code>类似，但<code>Set</code>没有索引，因此回调函数的前两个参数都是元素本身：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>]);</span><br><span class="line">s.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">element, sameElement, set</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(element);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>Map</code>的回调函数参数依次为<code>value</code>、<code>key</code>和<code>map</code>本身：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> m = <span class="keyword">new</span> <span class="title class_">Map</span>([[<span class="number">1</span>, <span class="string">&#x27;x&#x27;</span>], [<span class="number">2</span>, <span class="string">&#x27;y&#x27;</span>], [<span class="number">3</span>, <span class="string">&#x27;z&#x27;</span>]]);</span><br><span class="line">m.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">value, key, map</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>如果对某些参数不感兴趣，由于JavaScript的函数调用不要求参数必须一致，因此可以忽略它们。例如，只需要获得<code>Array</code>的<code>element</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>];</span><br><span class="line">a.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">element</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(element);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../../../2024/01/10/JavaScript/JavaScript-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../../../2023/10/25/Swift/SwiftUI%E5%85%A8%E9%9D%A2%E6%8C%87%E5%8D%97-%E8%A7%86%E5%9B%BE-%E4%BF%AE%E9%A5%B0%E7%AC%A6-%E7%BB%84%E4%BB%B6%E4%B8%8EMVVM%E6%9E%B6%E6%9E%84/"
                            aria-label=": SwiftUI全面指南:视图,修饰符,组件与MVVM架构"
                        >
                            SwiftUI全面指南:视图,修饰符,组件与MVVM架构
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2023-10-25T00:14:52+08:00">
	
		    2023 年 10 月 25 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../">编程语言</a>, <a class="category-link" href="../../SwiftUI/">SwiftUI</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>SwiftUI 是 Apple 推出的声明式框架，用于构建用户界面（UI）。 自2019年首次发布以来，SwiftUI 已成为 iOS、macOS、watchOS 和 tvOS 应用开发的重要工具。 本文将深入介绍 SwiftUI 的基本概念，包括视图(View)、修饰符(Modifiers)、内置修饰符、如何自定义视图、 组件化开发以及 MVVM 架构在 SwiftUI 中的应用。无论你是刚开始学习 SwiftUI，还是希望巩固基础，这篇指南都将为你提供有价值的知识。</p>
<h2 id="什么是-SwiftUI​">什么是 SwiftUI<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#what-is-swiftui" title="什么是 SwiftUI的直接链接">​</a></h2>
<p>SwiftUI 是 Apple 推出的用于构建用户界面的框架，采用声明式语法，使开发者能够更简洁、高效地创建复杂的界面。与传统的 UIKit 不同，SwiftUI 允许开发者通过声明视图的状态和布局来自动管理 UI 更新，从而减少了大量的样板代码。</p>
<h3 id="SwiftUI-的优势​">SwiftUI 的优势<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#swiftui-%E7%9A%84%E4%BC%98%E5%8A%BF" title="SwiftUI 的优势的直接链接">​</a></h3>
<ul>
<li><strong>声明式语法</strong>：通过描述界面的状态，SwiftUI 自动处理界面的更新。</li>
<li><strong>跨平台支持</strong>：适用于 iOS、macOS、watchOS 和 tvOS。</li>
<li><strong>实时预览</strong>：Xcode 提供的 Canvas 允许开发者实时预览和调试 UI。</li>
<li><strong>高效开发</strong>：减少样板代码，提高开发效率。</li>
<li><strong>响应式编程</strong>：SwiftUI 内置支持响应式编程范式，简化数据与UI的绑定。</li>
</ul>
<h2 id="什么是视图-View-​">什么是视图(View)<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#what-is-view" title="什么是视图(View)的直接链接">​</a></h2>
<p>在 SwiftUI 中，<strong>视图(View)</strong> 是构建用户界面的基本单元。每一个视图都代表 UI 的一个部分，例如文本、按钮、图像等。视图可以嵌套和组合，以创建复杂的界面。</p>
<h3 id="常见的-SwiftUI-视图​">常见的 SwiftUI 视图<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#%E5%B8%B8%E8%A7%81%E7%9A%84-swiftui-%E8%A7%86%E5%9B%BE" title="常见的 SwiftUI 视图的直接链接">​</a></h3>
<ul>
<li><code>Text</code>：显示文本内容。</li>
<li><code>Image</code>：显示图片。</li>
<li><code>Button</code>：交互式按钮。</li>
<li><code>VStack</code> 和 <code>HStack</code>：垂直和水平堆叠视图。</li>
<li><code>List</code>：显示可滚动的列表。</li>
<li><code>ScrollView</code>：实现可滚动的内容视图。</li>
<li><code>Spacer</code>：在堆叠视图中添加弹性空间。</li>
<li><code>NavigationView</code>：实现导航功能。</li>
</ul>
<h3 id="示例：创建一个简单的文本视图​">示例：创建一个简单的文本视图<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#%E7%A4%BA%E4%BE%8B%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%96%87%E6%9C%AC%E8%A7%86%E5%9B%BE" title="示例：创建一个简单的文本视图的直接链接">​</a></h3>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUIstruct ContentView: View &#123;    var body: some View &#123;        Text(&quot;Hello, SwiftUI!&quot;)    &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>在上述示例中，<code>Text</code> 视图用于显示一段文本。</p>
<h2 id="什么是修饰符-Modifiers-​">什么是修饰符(Modifiers)<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#what-is-modifiers" title="什么是修饰符(Modifiers)的直接链接">​</a></h2>
<p><strong>修饰符(Modifiers)</strong> 是 SwiftUI 中用于修改视图属性的方法。通过链式调用修饰符，开发者可以轻松地调整视图的外观和行为，例如颜色、字体、边距等。</p>
<h3 id="使用修饰符的示例​">使用修饰符的示例<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#%E4%BD%BF%E7%94%A8%E4%BF%AE%E9%A5%B0%E7%AC%A6%E7%9A%84%E7%A4%BA%E4%BE%8B" title="使用修饰符的示例的直接链接">​</a></h3>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;Hello, SwiftUI!&quot;</span>)    .font(.title)    .foregroundColor(.blue)    .padding()</span><br></pre></td></tr></table></figure>
<p>在这个例子中，<code>Text</code> 视图被应用了三个修饰符：<code>font</code> 修改字体大小，<code>foregroundColor</code> 修改文本颜色，<code>padding</code> 添加内边距。</p>
<h2 id="什么是内置修饰符​">什么是内置修饰符<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#what-is-built-in-modifiers" title="什么是内置修饰符的直接链接">​</a></h2>
<p>SwiftUI 提供了丰富的<strong>内置修饰符</strong>，开发者可以直接使用这些修饰符来调整视图的各种属性。以下是一些常用的内置修饰符：</p>
<ul>
<li><code>font(_:)</code>：设置字体和字体大小。</li>
<li><code>foregroundColor(_:)</code>：设置前景色（如文本颜色）。</li>
<li><code>background(_:)</code>：设置视图的背景颜色或视图。</li>
<li><code>padding(_:)</code>：设置视图的内边距。</li>
<li><code>frame(width:height:)</code>：设置视图的宽度和高度。</li>
<li><code>cornerRadius(_:)</code>：设置视图的圆角半径。</li>
<li><code>shadow(color:radius:x:y:)</code>：添加阴影效果。</li>
<li><code>opacity(_:)</code>：设置视图的不透明度。</li>
<li><code>rotationEffect(_:)</code>：旋转视图。</li>
<li><code>scaleEffect(_:)</code>：缩放视图。</li>
</ul>
<h3 id="示例：使用多个内置修饰符​">示例：使用多个内置修饰符<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#%E7%A4%BA%E4%BE%8B%E4%BD%BF%E7%94%A8%E5%A4%9A%E4%B8%AA%E5%86%85%E7%BD%AE%E4%BF%AE%E9%A5%B0%E7%AC%A6" title="示例：使用多个内置修饰符的直接链接">​</a></h3>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;Welcome to SwiftUI&quot;</span>)    .font(.largeTitle)    .foregroundColor(.white)    .padding()    .background(<span class="type">Color</span>.blue)    .cornerRadius(<span class="number">10</span>)    .shadow(color: .gray, radius: <span class="number">5</span>, x: <span class="number">0</span>, y: <span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<p>在这个例子中，<code>Text</code> 视图应用了多个内置修饰符，改变了字体、颜色、背景、圆角和阴影效果。</p>
<h2 id="如何自定义视图​">如何自定义视图<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#how-to-custom-view" title="如何自定义视图的直接链接">​</a></h2>
<p>除了使用内置视图和修饰符，SwiftUI 允许开发者创建<strong>自定义视图</strong>。通过组合多个视图和修饰符，可以创建可重用且模块化的 UI 组件。</p>
<h3 id="创建自定义视图的步骤​">创建自定义视图的步骤<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A7%86%E5%9B%BE%E7%9A%84%E6%AD%A5%E9%AA%A4" title="创建自定义视图的步骤的直接链接">​</a></h3>
<ol>
<li><strong>定义新的视图结构</strong>：创建一个遵循 <code>View</code> 协议的结构体。</li>
<li><strong>实现 <code>body</code> 属性</strong>：在 <code>body</code> 中定义视图的内容和布局。</li>
<li><strong>组合视图和修饰符</strong>：使用内置视图和修饰符来设计自定义视图。</li>
</ol>
<h3 id="示例：创建一个自定义按钮视图​">示例：创建一个自定义按钮视图<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#%E7%A4%BA%E4%BE%8B%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%89%E9%92%AE%E8%A7%86%E5%9B%BE" title="示例：创建一个自定义按钮视图的直接链接">​</a></h3>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUIstruct CustomButton: View &#123;    var title: String    var backgroundColor: Color    var body: some View &#123;        Text(title)            .font(.headline)            .foregroundColor(.white)            .padding()            .background(backgroundColor)            .cornerRadius(8)            .shadow(radius: 5)    &#125;&#125;struct ContentView: View &#123;    var body: some View &#123;        CustomButton(title: &quot;Click Me&quot;, backgroundColor: .green)    &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>在这个示例中，<code>CustomButton</code> 是一个自定义视图，通过组合 <code>Text</code> 视图和多个修饰符，创建了一个带有背景色、圆角和阴影效果的按钮。</p>
<h2 id="视图与组件化开发​">视图与组件化开发<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#view-and-component-development" title="视图与组件化开发的直接链接">​</a></h2>
<p><strong>组件化开发</strong> 是现代软件开发中的一种最佳实践，通过将 UI 分解为可重用的组件，提升代码的可维护性和可扩展性。在 SwiftUI 中，视图本身就是组件的基本形式，开发者可以通过创建自定义视图来实现组件化开发。</p>
<h3 id="组件化的优势​">组件化的优势<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#%E7%BB%84%E4%BB%B6%E5%8C%96%E7%9A%84%E4%BC%98%E5%8A%BF" title="组件化的优势的直接链接">​</a></h3>
<ul>
<li><strong>可重用性</strong>：相同的组件可以在不同的地方重复使用，减少代码冗余。</li>
<li><strong>可维护性</strong>：组件独立，便于管理和更新。</li>
<li><strong>可测试性</strong>：独立的组件更容易进行单元测试。</li>
</ul>
<h3 id="示例：创建多个自定义组件​">示例：创建多个自定义组件<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#%E7%A4%BA%E4%BE%8B%E5%88%9B%E5%BB%BA%E5%A4%9A%E4%B8%AA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6" title="示例：创建多个自定义组件的直接链接">​</a></h3>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">HeaderView</span>: <span class="title class_ inherited__">View</span> &#123;    <span class="keyword">var</span> title: <span class="type">String</span>    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;        <span class="type">Text</span>(title)            .font(.largeTitle)            .padding()            .background(<span class="type">Color</span>.orange)            .foregroundColor(.white)    &#125;&#125;<span class="keyword">struct</span> <span class="title class_">FooterView</span>: <span class="title class_ inherited__">View</span> &#123;    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;        <span class="type">Text</span>(<span class="string">&quot;© 2025 Your Company&quot;</span>)            .font(.footnote)            .padding()            .background(<span class="type">Color</span>.gray.opacity(<span class="number">0.2</span>))    &#125;&#125;<span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;        <span class="type">VStack</span> &#123;            <span class="type">HeaderView</span>(title: <span class="string">&quot;Welcome to My App&quot;</span>)            <span class="type">Spacer</span>()            <span class="type">FooterView</span>()        &#125;    &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>在这个示例中，<code>HeaderView</code> 和 <code>FooterView</code> 是两个独立的自定义组件，通过组合它们构建了一个完整的界面。</p>
<h2 id="MVVM-架构简介​">MVVM 架构简介<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#mvvm-architecture-introduction" title="MVVM 架构简介的直接链接">​</a></h2>
<p><strong>MVVM（Model-View-ViewModel）</strong> 是一种软件架构模式，旨在将应用程序的业务逻辑与用户界面分离。MVVM 提供了一种清晰的方式来组织代码，使其更易于维护、测试和扩展。</p>
<h3 id="MVVM-的组成部分​">MVVM 的组成部分<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#mvvm-%E7%9A%84%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86" title="MVVM 的组成部分的直接链接">​</a></h3>
<ul>
<li><strong>Model（模型）</strong>：表示应用程序的数据和业务逻辑。通常与数据存储和网络请求相关。</li>
<li><strong>View（视图）</strong>：负责显示数据和处理用户交互。SwiftUI 中的视图如 <code>Text</code>、<code>Image</code> 等。</li>
<li><strong>ViewModel（视图模型）</strong>：充当 Model 和 View 之间的中介。它处理业务逻辑，将 Model 中的数据转换为 View 可以直接使用的格式，并响应用户交互。</li>
</ul>
<h3 id="MVVM-的优势​">MVVM 的优势<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#mvvm-%E7%9A%84%E4%BC%98%E5%8A%BF" title="MVVM 的优势的直接链接">​</a></h3>
<ul>
<li><strong>分离关注点</strong>：将 UI 与业务逻辑分离，提升代码的可维护性。</li>
<li><strong>可测试性</strong>：ViewModel 可以独立于 View 进行单元测试。</li>
<li><strong>可重用性</strong>：ViewModel 可以在多个 View 中复用。</li>
</ul>
<h2 id="SwiftUI-中的-MVVM-实现​">SwiftUI 中的 MVVM 实现<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#mvvm-implementation-in-swiftui" title="SwiftUI 中的 MVVM 实现的直接链接">​</a></h2>
<p>在 SwiftUI 中，MVVM 架构通过结合 SwiftUI 的声明式语法和数据绑定机制，实现了 Model、View 和 ViewModel 的分离与协作。</p>
<h3 id="关键概念​">关键概念<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5" title="关键概念的直接链接">​</a></h3>
<ul>
<li><strong>@State</strong>：用于在 View 中存储和管理局部状态。</li>
<li><strong>@ObservableObject</strong>：用于声明一个可观察的对象，通常在 ViewModel 中使用。</li>
<li><strong>@Published</strong>：用于在 ObservableObject 中标记可以被观察的属性。</li>
<li><strong>@StateObject</strong> 和 <strong>@ObservedObject</strong>：用于在 View 中引用 ViewModel。</li>
</ul>
<h3 id="示例：使用-MVVM-架构的简单计数器应用​">示例：使用 MVVM 架构的简单计数器应用<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#%E7%A4%BA%E4%BE%8B%E4%BD%BF%E7%94%A8-mvvm-%E6%9E%B6%E6%9E%84%E7%9A%84%E7%AE%80%E5%8D%95%E8%AE%A1%E6%95%B0%E5%99%A8%E5%BA%94%E7%94%A8" title="示例：使用 MVVM 架构的简单计数器应用的直接链接">​</a></h3>
<h4 id="Model​">Model<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#model" title="Model的直接链接">​</a></h4>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">CounterModel</span> &#123;    <span class="keyword">var</span> count: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span>&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ViewModel​">ViewModel<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#viewmodel" title="ViewModel的直接链接">​</a></h4>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combineclass CounterViewModel: ObservableObject &#123;    @Published var counter: CounterModel    init(counter: CounterModel = CounterModel()) &#123;        self.counter = counter    &#125;    func increment() &#123;        counter.count += 1    &#125;    func decrement() &#123;        counter.count -= 1    &#125;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="View​">View<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#view" title="View的直接链接">​</a></h4>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUIstruct CounterView: View &#123;    @StateObject private var viewModel = CounterViewModel()    var body: some View &#123;        VStack(spacing: 20) &#123;            Text(&quot;Count: \(viewModel.counter.count)&quot;)                .font(.largeTitle)            HStack(spacing: 40) &#123;                Button(action: &#123;                    viewModel.decrement()                &#125;) &#123;                    Text(&quot;-&quot;)                        .font(.title)                        .frame(width: 60, height: 60)                        .background(Color.red)                        .foregroundColor(.white)                        .clipShape(Circle())                &#125;                Button(action: &#123;                    viewModel.increment()                &#125;) &#123;                    Text(&quot;+&quot;)                        .font(.title)                        .frame(width: 60, height: 60)                        .background(Color.green)                        .foregroundColor(.white)                        .clipShape(Circle())                &#125;            &#125;        &#125;        .padding()    &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>在这个示例中：</p>
<ul>
<li><strong>Model</strong>：<code>CounterModel</code> 包含一个 <code>count</code> 属性，表示当前计数值。</li>
<li><strong>ViewModel</strong>：<code>CounterViewModel</code> 作为 <code>ObservableObject</code>，管理 <code>CounterModel</code> 的实例，并提供 <code>increment</code> 和 <code>decrement</code> 方法来修改计数值。</li>
<li><strong>View</strong>：<code>CounterView</code> 使用 <code>@StateObject</code> 引用 <code>CounterViewModel</code>，并通过数据绑定 (<code>viewModel.counter.count</code>) 显示计数值，同时通过按钮调用 ViewModel 的方法来修改计数。</li>
</ul>
<h2 id="MVVM-架构关系图​">MVVM 架构关系图<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#mvvm-architecture-relationship-diagram" title="MVVM 架构关系图的直接链接">​</a></h2>
<p>以下图示展示了 MVVM 架构在 SwiftUI 中的关系：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph LR    Model --&gt; ViewModel    ViewModel --&gt; View    View --&gt; ViewModel</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Model</strong>：提供数据和业务逻辑。</li>
<li><strong>ViewModel</strong>：持有 Model 的实例，处理业务逻辑，并通过 <code>@Published</code> 属性将数据暴露给 View。</li>
<li><strong>View</strong>：通过 <code>@StateObject</code> 或 <code>@ObservedObject</code> 引用 ViewModel，使用数据绑定显示数据，并通过用户交互调用 ViewModel 的方法。</li>
</ul>
<h2 id="基于SwiftUI的项目如何设置MVVM​">基于SwiftUI的项目如何设置MVVM<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#how-to-set-up-mvvm-in-swiftui-projects" title="基于SwiftUI的项目如何设置MVVM的直接链接">​</a></h2>
<p>在 SwiftUI 项目中应用 MVVM 架构，可以按照以下步骤进行设置：</p>
<h3 id="1-创建-Model​">1. 创建 Model<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#1-%E5%88%9B%E5%BB%BA-model" title="1. 创建 Model的直接链接">​</a></h3>
<p>首先，定义应用程序的数据结构和业务逻辑。例如，一个简单的用户模型：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">User</span>: <span class="title class_ inherited__">Identifiable</span> &#123;    <span class="keyword">let</span> id: <span class="type">UUID</span>    <span class="keyword">let</span> name: <span class="type">String</span>    <span class="keyword">let</span> email: <span class="type">String</span>&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-创建-ViewModel​">2. 创建 ViewModel<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#2-%E5%88%9B%E5%BB%BA-viewmodel" title="2. 创建 ViewModel的直接链接">​</a></h3>
<p>创建一个 <code>ObservableObject</code> 类来管理 Model 的数据和业务逻辑：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combineclass UserViewModel: ObservableObject &#123;    @Published var users: [User] = []    func fetchUsers() &#123;        <span class="comment">// 模拟网络请求或数据获取        users = [            User(id: UUID(), name: &quot;Alice&quot;, email: &quot;alice@example.com&quot;),            User(id: UUID(), name: &quot;Bob&quot;, email: &quot;bob@example.com&quot;)        ]    &#125;    func addUser(name: String, email: String) &#123;        let newUser = User(id: UUID(), name: name, email: email)        users.append(newUser)    &#125;    func removeUser(at offsets: IndexSet) &#123;        users.remove(atOffsets: offsets)    &#125;&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-创建-View​">3. 创建 View<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#3-%E5%88%9B%E5%BB%BA-view" title="3. 创建 View的直接链接">​</a></h3>
<p>在 View 中引用 ViewModel 并使用数据绑定展示和操作数据：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUIstruct UserListView: View &#123;    @StateObject private var viewModel = UserViewModel()    var body: some View &#123;        NavigationView &#123;            List &#123;                ForEach(viewModel.users) &#123; user in                    VStack(alignment: .leading) &#123;                        Text(user.name)                            .font(.headline)                        Text(user.email)                            .font(.subheadline)                            .foregroundColor(.gray)                    &#125;                &#125;                .onDelete(perform: viewModel.removeUser)            &#125;            .navigationTitle(&quot;用户列表&quot;)            .navigationBarItems(trailing: Button(action: &#123;                viewModel.addUser(name: &quot;新用户&quot;, email: &quot;newuser@example.com&quot;)            &#125;) &#123;                Image(systemName: &quot;plus&quot;)            &#125;)            .onAppear &#123;                viewModel.fetchUsers()            &#125;        &#125;    &#125;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-组织项目结构​">4. 组织项目结构<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#4-%E7%BB%84%E7%BB%87%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84" title="4. 组织项目结构的直接链接">​</a></h3>
<p>为了更好地组织代码，建议按照 MVVM 的结构将项目分为不同的文件夹：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YourProject/├── Models/│   └── User.swift├── ViewModels/│   └── UserViewModel.swift├── Views/│   └── UserListView.swift└── YourProjectApp.swift</span><br></pre></td></tr></table></figure>
<h3 id="5-使用依赖注入（可选）​">5. 使用依赖注入（可选）<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#5-%E4%BD%BF%E7%94%A8%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E5%8F%AF%E9%80%89" title="5. 使用依赖注入（可选）的直接链接">​</a></h3>
<p>为了提高代码的可测试性和可扩展性，可以使用依赖注入将 ViewModel 注入到 View 中。例如：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">UserListView</span>: <span class="title class_ inherited__">View</span> &#123;    <span class="meta">@ObservedObject</span> <span class="keyword">var</span> viewModel: <span class="type">UserViewModel</span>    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;        <span class="comment">// 与之前相同    &#125;&#125;// 在入口处注入 ViewModelstruct YourProjectApp: App &#123;    var body: some Scene &#123;        WindowGroup &#123;            UserListView(viewModel: UserViewModel())        &#125;    &#125;&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="6-添加更多功能​">6. 添加更多功能<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#6-%E6%B7%BB%E5%8A%A0%E6%9B%B4%E5%A4%9A%E5%8A%9F%E8%83%BD" title="6. 添加更多功能的直接链接">​</a></h3>
<p>随着项目的发展，可以在 ViewModel 中添加更多的方法和属性，处理更复杂的业务逻辑，同时保持 View 的简洁和专注于展示。</p>
<h2 id="SwiftUI-术语汇总​">SwiftUI 术语汇总<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#swiftui-terminology-summary" title="SwiftUI 术语汇总的直接链接">​</a></h2>
<p>为了更好地理解 SwiftUI，以下是一些常见的术语及其解释：</p>
<ul>
<li><strong>声明式编程（Declarative Programming）</strong>：一种编程范式，开发者描述 UI 应该是什么样子，系统负责管理其状态和更新。</li>
<li><strong>视图（View）</strong>：SwiftUI 中的基本构建块，用于构建用户界面。</li>
<li><strong>修饰符（Modifier）</strong>：用于修改视图属性的方法，采用链式调用方式。</li>
<li><strong>布局容器（Layout Containers）</strong>：用于组织和布局视图的容器，如 <code>VStack</code>、<code>HStack</code>、<code>ZStack</code>。</li>
<li><strong>状态（State）</strong>：视图的数据源，影响视图的显示和行为。</li>
<li><strong>绑定（Binding）</strong>：一种双向数据流机制，使视图与其数据源保持同步。</li>
<li><strong>环境（Environment）</strong>：提供全局数据和配置，视图可以从环境中读取或写入数据。</li>
<li><strong>预览（Preview）</strong>：Xcode 提供的实时预览功能，允许开发者在编写代码时即时查看 UI 的变化。</li>
<li><strong><code>ObservableObject</code></strong>：一种可以被多个视图观察的对象，当其中的 <code>@Published</code> 属性发生变化时，视图会自动更新。</li>
<li><strong><code>@State</code></strong>：用于在视图内部存储和管理局部状态。</li>
<li><strong><code>@ObservedObject</code></strong>：用于在视图中观察外部的 <code>ObservableObject</code>，视图会在对象变化时自动更新。</li>
<li><strong><code>@EnvironmentObject</code></strong>：用于在多个视图中共享一个 <code>ObservableObject</code>，无需手动传递。</li>
</ul>
<h2 id="总结​">总结<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#summary" title="总结的直接链接">​</a></h2>
<p>SwiftUI 以其声明式语法和强大的功能，正在迅速改变 iOS 和其他 Apple 平台的应用开发方式。理解 SwiftUI 的核心概念，如视图(View)、修饰符(Modifiers)、内置修饰符、如何自定义视图和组件化开发，是掌握这一框架的关键。通过引入 MVVM 架构，开发者可以进一步提升代码的可维护性和可测试性，构建出高效、可扩展的应用。</p>
<p>本文介绍了 SwiftUI 的基本概念和术语，展示了如何创建和使用自定义视图，并深入探讨了 MVVM 架构在 SwiftUI 中的实现方式。掌握这些知识后，你将能够在 SwiftUI 项目中应用最佳实践，打造出优雅且高效的用户界面。</p>
<p>继续深入学习 SwiftUI 的高级功能，如动画、数据绑定和自定义控件，将进一步提升你的开发技能，帮助你打造出更具吸引力和互动性的应用。</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../../../2023/10/25/Swift/SwiftUI%E5%85%A8%E9%9D%A2%E6%8C%87%E5%8D%97-%E8%A7%86%E5%9B%BE-%E4%BF%AE%E9%A5%B0%E7%AC%A6-%E7%BB%84%E4%BB%B6%E4%B8%8EMVVM%E6%9E%B6%E6%9E%84/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../../../2023/10/15/Swift/SwiftUI%E6%96%87%E6%A1%A3/"
                            aria-label=": SwiftUI文档"
                        >
                            SwiftUI文档
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2023-10-15T00:11:14+08:00">
	
		    2023 年 10 月 15 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../">编程语言</a>, <a class="category-link" href="../../SwiftUI/">SwiftUI</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="SwiftUI简介">SwiftUI简介</h2>
<p><a href="#swiftui%E7%AE%80%E4%BB%8B"></a></p>
<p>SwiftUI是一种更为现代的编码方式，他可以为苹果任意平台声明用户界面。以更为快捷迅速的方式创建漂亮的动态应用程序！</p>
<p><img src="https://camo.githubusercontent.com/50a2f12c5e3282b365e3b2d61fb68268595f7d7cddb2a4cd5f96635465b50d72/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f313461663861316435352f35366133303432312d393863352d343365302d626666642d3630353038363539316235342e706e67" alt=""></p>
<h2 id="只需描述你的布局">只需描述你的布局</h2>
<p><a href="#%E5%8F%AA%E9%9C%80%E6%8F%8F%E8%BF%B0%E4%BD%A0%E7%9A%84%E5%B8%83%E5%B1%80"></a></p>
<blockquote>
<p>为视图的任何状态声明内容和布局。SwiftUI知道该状态何时更改，并更新视图，以匹配其呈现的状态。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">List</span>(landmarks) &#123; landmark <span class="keyword">in</span></span><br><span class="line">   <span class="type">HStack</span> &#123;</span><br><span class="line">      <span class="type">Image</span>(landmark.thumbnail)</span><br><span class="line">      <span class="type">Text</span>(landmark.name)</span><br><span class="line">      <span class="type">Spacer</span>()</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> landmark.isFavorite &#123;</span><br><span class="line">         <span class="type">Image</span>(systemName: <span class="string">&quot;star.fill&quot;</span>)</span><br><span class="line">            .foregroundColor(.yellow)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/dee4c4f45faeaf064a3d75f5f27440b630ebc284815a1853e8bcbbb84464a06a/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f636533613062393839302f63373266303838662d356265392d343661642d393234352d3163663862346337333561302e706e67" alt=""></p>
<h2 id="构建可重用组件">构建可重用组件</h2>
<p><a href="#%E6%9E%84%E5%BB%BA%E5%8F%AF%E9%87%8D%E7%94%A8%E7%BB%84%E4%BB%B6"></a></p>
<blockquote>
<p>将小的、单一职责的视图组合成更大、更复杂的界面。在为苹果任意平台设计的应用程序之间共享您的自定义视图。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">FeatureCard</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">   <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">   </span><br><span class="line">   <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">      landmark.featureImage</span><br><span class="line">         .resizable()</span><br><span class="line">         .aspectRatio(<span class="number">3</span><span class="operator">/</span><span class="number">2</span>, contentMode: .fit)</span><br><span class="line">         .overlay(<span class="type">TextOverlay</span>(landmark))</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/db8bb42a17bfee69c85380765cff44eb527695a3d8f4226e050412c8e8560ea7/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f373433623135333030352f38316534646632642d616333302d343662382d616633302d3332643063386636393334652e706e67" alt=""></p>
<h2 id="简化动画">简化动画</h2>
<p><a href="#%E7%AE%80%E5%8C%96%E5%8A%A8%E7%94%BB"></a></p>
<blockquote>
<p>创建平滑动画就像添加一个方法调用一样简单。SwiftUI会在需要时自动计算并设置过渡动画。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">VStack</span> &#123;</span><br><span class="line">   <span class="type">Badge</span>()</span><br><span class="line">      .frame(width: <span class="number">300</span>, height: <span class="number">300</span>)</span><br><span class="line">      .animation(.easeInOut())</span><br><span class="line">   <span class="type">Text</span>(name)</span><br><span class="line">      .font(.title)</span><br><span class="line">      .animation(.easeInOut())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/80023f3ab89eb740084dfd37d15b0f3de507b16b0a1d366cdc72d786d58de98d/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f643565623365656563612f32353961653665362d663231362d343064382d613065362d6134623036396263343733612e706e67" alt=""></p>
<h2 id="在Xcode中实时预览">在Xcode中实时预览</h2>
<p><a href="#%E5%9C%A8xcode%E4%B8%AD%E5%AE%9E%E6%97%B6%E9%A2%84%E8%A7%88"></a></p>
<blockquote>
<p>在不运行应用程序的情况下设计、生成和测试应用程序的界面。使用交互式预览测试控件和布局。</p>
</blockquote>
<p><img src="https://camo.githubusercontent.com/4a1a02a9323e98d568f2cd0b2db1c83597a545b034e8fbf89962f074a5ace9d2/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f616436373263363465662f64326236663133362d666537362d346336392d393564642d6433623232633364393833362e706e67" alt=""></p>
<h3 id="应用程序设计和布局">应用程序设计和布局</h3>
<p><a href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%B8%83%E5%B1%80"></a></p>
<h2 id="组合复杂界面">组合复杂界面</h2>
<p><a href="#%E7%BB%84%E5%90%88%E5%A4%8D%E6%9D%82%E7%95%8C%E9%9D%A2"></a></p>
<p>地标的首页显示一个滚动的分类列表，在每个分类中水平滚动地标。在构建此主导航时，您将探索组合视图如何适应不同的设备大小和方向。</p>
<blockquote>
<p>学习时间：20分钟</p>
<p><a target="_blank" rel="noopener" href="https://docs-assets.developer.apple.com/published/bbc4a40f38/ComposingComplexInterfaces.zip">下载地址：ComposingComplexInterfaces.zip</a></p>
</blockquote>
<h2 id="第一节-添加首页">第一节 添加首页</h2>
<p><a href="#%E7%AC%AC%E4%B8%80%E8%8A%82-%E6%B7%BB%E5%8A%A0%E9%A6%96%E9%A1%B5"></a></p>
<p>既然你已经拥有了地标应用程序所需的所有视图，现在是时候给它们一个首页了——一个统一视图页面。主视图不仅包含所有其他视图，还提供导航和显示地标的方法。</p>
<p><img src="https://camo.githubusercontent.com/184615ada53392d20cfc9a87dca89fb1debd1aa03cb7e5a80e83c3ae9ea570c9/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f376535393332306432332f36663364613762622d343666612d343766362d393466622d6335333734613466333438372e706e67" alt=""></p>
<h2 id="步骤1">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41"></a></p>
<p>在名为<code>Home.swift</code>的新文件中创建名为<code>CategoryHome</code>的自定义视图。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Landmarks Content&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/54f5c957e91cf81977c40f1f885a23db7b8ad1c39919f455a0d8b8bc9f86fe3d/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f363633356333383935622f34373266646266312d643765622d343864662d393265352d3835656161666339313464652e706e67" alt=""></p>
<h2 id="步骤2">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42"></a></p>
<p>修改<code>scene delegate</code>，使其显示新的<code>CategoryHome</code>视图而不是地标列表。</p>
<p>主视图是地标应用程序的根，因此它需要一种方式来呈现所有其他视图。</p>
<blockquote>
<p>SceneDelegate.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SceneDelegate</span>: <span class="title class_ inherited__">UIResponder</span>, <span class="title class_ inherited__">UIWindowSceneDelegate</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> window: <span class="type">UIWindow</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">scene</span>(<span class="keyword">_</span> <span class="params">scene</span>: <span class="type">UIScene</span>, <span class="params">willConnectTo</span> <span class="params">session</span>: <span class="type">UISceneSession</span>, <span class="params">options</span> <span class="params">connectionOptions</span>: <span class="type">UIScene</span>.<span class="type">ConnectionOptions</span>) &#123;</span><br><span class="line">        <span class="comment">// Use this method to optionally configure and attach the UIWindow `window` to the provided UIWindowScene `scene`.</span></span><br><span class="line">        <span class="comment">// If using a storyboard, the `window` property will automatically be initialized and attached to the scene.</span></span><br><span class="line">        <span class="comment">// This delegate does not imply the connecting scene or session are new (see `application:configurationForConnectingSceneSession` instead).</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Use a UIHostingController as window root view controller</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> windowScene <span class="operator">=</span> scene <span class="keyword">as?</span> <span class="type">UIWindowScene</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> window <span class="operator">=</span> <span class="type">UIWindow</span>(windowScene: windowScene)</span><br><span class="line">            window.rootViewController <span class="operator">=</span> <span class="type">UIHostingController</span>(</span><br><span class="line">                rootView: <span class="type">CategoryHome</span>()</span><br><span class="line">                    .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">self</span>.window <span class="operator">=</span> window</span><br><span class="line">            window.makeKeyAndVisible()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤3">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43"></a></p>
<p>添加<code>NavigationView</code>以在地标中承载不同的视图。</p>
<p>您可以使用<code>NavigationView</code>以及<code>NavigationLink</code>实例和相关修饰符在应用程序中构建导航层级结构。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Landmarks Content&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/54f5c957e91cf81977c40f1f885a23db7b8ad1c39919f455a0d8b8bc9f86fe3d/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f363633356333383935622f34373266646266312d643765622d343864662d393265352d3835656161666339313464652e706e67" alt=""></p>
<h2 id="步骤4">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44"></a></p>
<p>将导航栏的标题设置为“Featured”。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Landmarks Content&quot;</span>)</span><br><span class="line">                .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Featured&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/38292c3b58c1485c47ed763cb7c21032062389eed141c3556fb909779e4b6acd/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f333363626461306430662f33333064636463332d383334342d343038322d626561312d3230383065643838336331312e706e67" alt=""></p>
<h2 id="第二节-创建分类列表">第二节 创建分类列表</h2>
<p><a href="#%E7%AC%AC%E4%BA%8C%E8%8A%82-%E5%88%9B%E5%BB%BA%E5%88%86%E7%B1%BB%E5%88%97%E8%A1%A8"></a></p>
<p>Landmarks应用程序将所有分类显示在垂直列中的单独行中，以便于浏览。通过组合垂直和水平堆栈，并向列表中添加滚动条，就可以完成此操作。</p>
<p><img src="https://camo.githubusercontent.com/7120019785703b47c78c069692aec1fcfe5a273eec32bcdd53210d87fb6ba90a/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f656534353539633136342f33393836383833322d363861322d346431622d623532382d3935346337623063616237612e706e67" alt=""></p>
<h2 id="步骤1-2">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-1"></a></p>
<p>使用<code>Dictionary</code>结构的<code>init（grouping:by:）</code>方法将地标分组到类别中，输入地标的category属性。</p>
<p>初始化项目文件给每个示例地标预设了类别。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categories: [<span class="type">String</span>: [<span class="type">Landmark</span>]] &#123;</span><br><span class="line">        <span class="type">Dictionary</span>(</span><br><span class="line">            grouping: landmarkData,</span><br><span class="line">            by: &#123; <span class="variable">$0</span>.category.rawValue &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Landmarks Content&quot;</span>)</span><br><span class="line">                .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Featured&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤2-2">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-1"></a></p>
<blockquote>
<p>使用列表在地标中显示分类。</p>
</blockquote>
<p><code>Landmark.Category</code>会匹配列表中每一项<code>name</code>，这些项在其他类别中必须是唯一的，因为它是枚举。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categories: [<span class="type">String</span>: [<span class="type">Landmark</span>]] &#123;</span><br><span class="line">        <span class="type">Dictionary</span>(</span><br><span class="line">            grouping: landmarkData,</span><br><span class="line">            by: &#123; <span class="variable">$0</span>.category.rawValue &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">ForEach</span>(categories.keys.sorted(), id: \.<span class="keyword">self</span>) &#123; key <span class="keyword">in</span></span><br><span class="line">                    <span class="type">Text</span>(key)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Featured&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/5eb1be4e6a5a6054754c674e55cb96a964eb5e4714371dafcd8e89bc27881bc7/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f613835663032383466332f34363066653135362d643264372d343166392d613632652d3438366362653333633430642e706e67" alt=""></p>
<h2 id="第三节-添加地标行">第三节 添加地标行</h2>
<p><a href="#%E7%AC%AC%E4%B8%89%E8%8A%82-%E6%B7%BB%E5%8A%A0%E5%9C%B0%E6%A0%87%E8%A1%8C"></a></p>
<p>地标在水平滚动的行中显示每个类别。添加一个新的视图类型来表示行，然后在新视图中显示该类别的所有地标。</p>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/add-rows-landmarks.gif" alt=""></p>
<h2 id="步骤1-3">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-2"></a></p>
<p>定义用于保存行内容的新自定义视图。</p>
<p>这个视图需要存储地标的类别信息，以及地标本身。</p>
<blockquote>
<p>CategoryRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categoryName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> items: [<span class="type">Landmark</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="keyword">self</span>.categoryName)</span><br><span class="line">            .font(.headline)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryRow</span>(</span><br><span class="line">            categoryName: landmarkData[<span class="number">0</span>].category.rawValue,</span><br><span class="line">            items: <span class="type">Array</span>(landmarkData.prefix(<span class="number">3</span>))</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/069c759e8f0e65c0d2124cc0b667fc95e5c4e633e4c9787d2ce9a9c5a0c96636/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f616138396332313066362f39373033303036332d323462332d343436642d393765312d3062613339633662653638352e706e67" alt=""></p>
<h2 id="步骤2-3">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-2"></a></p>
<p>更新<code>CategoryHome</code>的主体以将类别信息传递给新的行类型。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categories: [<span class="type">String</span>: [<span class="type">Landmark</span>]] &#123;</span><br><span class="line">        <span class="type">Dictionary</span>(</span><br><span class="line">            grouping: landmarkData,</span><br><span class="line">            by: &#123; <span class="variable">$0</span>.category.rawValue &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">ForEach</span>(categories.keys.sorted(), id: \.<span class="keyword">self</span>) &#123; key <span class="keyword">in</span></span><br><span class="line">                    <span class="type">CategoryRow</span>(categoryName: key, items: <span class="keyword">self</span>.categories[key]<span class="operator">!</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Featured&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/bdb471f842daedd8a7647f492ee2f3fb8b486f551a25de7040e4ce8ce165ce89/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f383339656466653062612f63353338646139342d626338642d343065312d383962302d3961646162656464303231372e706e67" alt=""></p>
<h2 id="步骤3-2">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-1"></a></p>
<p>在<code>HStack</code>中显示该类别的地标。</p>
<blockquote>
<p>CategoryRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categoryName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> items: [<span class="type">Landmark</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span>(alignment: .top, spacing: <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">ForEach</span>(<span class="keyword">self</span>.items) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="type">Text</span>(landmark.name)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryRow</span>(</span><br><span class="line">            categoryName: landmarkData[<span class="number">0</span>].category.rawValue,</span><br><span class="line">            items: <span class="type">Array</span>(landmarkData.prefix(<span class="number">3</span>))</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/a9cf0d35dc0309d88acd3589ab689a899d0bbcb5737608bd04700958e1a59487/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f323062303265316264332f62373333313039622d646231622d346364622d616666332d6665373463616235316335362e706e67" alt=""></p>
<h2 id="步骤4-2">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-1"></a></p>
<blockquote>
<p>通过指定一个<code>frame(width:height:)</code> 并在<code>scrollView</code>中包装<code>stack</code>，为行提供空间。</p>
</blockquote>
<p>使用长数据样本更新视图预览，以便确保可以滚动。</p>
<blockquote>
<p>CategoryRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categoryName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> items: [<span class="type">Landmark</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="keyword">self</span>.categoryName)</span><br><span class="line">                .font(.headline)</span><br><span class="line">                .padding(.leading, <span class="number">15</span>)</span><br><span class="line">                .padding(.top, <span class="number">5</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">ScrollView</span>(.horizontal, showsIndicators: <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="type">HStack</span>(alignment: .top, spacing: <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="type">ForEach</span>(<span class="keyword">self</span>.items) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                        <span class="type">Text</span>(landmark.name)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .frame(height: <span class="number">185</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryRow</span>(</span><br><span class="line">            categoryName: landmarkData[<span class="number">0</span>].category.rawValue,</span><br><span class="line">            items: <span class="type">Array</span>(landmarkData.prefix(<span class="number">4</span>))</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/e8ce0ea8112e7c3538c644771ed4fa10378b87dd3c1f18b0e655de62cf6e6ef8/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f333962653830646332652f38393332346134322d363966652d343431652d386433312d3138633736346163326630392e706e67" alt=""></p>
<h2 id="第四节-组成主页">第四节 组成主页</h2>
<p><a href="#%E7%AC%AC%E5%9B%9B%E8%8A%82-%E7%BB%84%E6%88%90%E4%B8%BB%E9%A1%B5"></a></p>
<p>地标应用程序的主页需要显示地标的简单信息，然后用户点击其中一个更多进入详情视图。</p>
<p>重新使用在<code>Creating and Combining Views</code>中的视图来创建更简单的视图预览，以显示地标的分类和特征。</p>
<p><img src="https://camo.githubusercontent.com/21440c60f467abd9344efabb42a4355c9aaeb6e8098b937a3aeee23b36617f84/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393633353563666336382f33333739633736382d646334652d346464382d393831622d3132363661656337626436302e706e67" alt=""></p>
<h2 id="步骤1-4">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-3"></a></p>
<p>在<code>CategoryRow</code>旁边创建一个名为<code>CategoryItem</code>的新自定义视图，并用新视图替换<code>Text</code>视图。</p>
<blockquote>
<p>CategoryRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categoryName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> items: [<span class="type">Landmark</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="keyword">self</span>.categoryName)</span><br><span class="line">                .font(.headline)</span><br><span class="line">                .padding(.leading, <span class="number">15</span>)</span><br><span class="line">                .padding(.top, <span class="number">5</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">ScrollView</span>(.horizontal, showsIndicators: <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="type">HStack</span>(alignment: .top, spacing: <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="type">ForEach</span>(<span class="keyword">self</span>.items) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                        <span class="type">CategoryItem</span>(landmark: landmark)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .frame(height: <span class="number">185</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryItem</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            landmark.image</span><br><span class="line">                .resizable()</span><br><span class="line">                .frame(width: <span class="number">155</span>, height: <span class="number">155</span>)</span><br><span class="line">                .cornerRadius(<span class="number">5</span>)</span><br><span class="line">            <span class="type">Text</span>(landmark.name)</span><br><span class="line">                .font(.caption)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding(.leading, <span class="number">15</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryRow</span>(</span><br><span class="line">            categoryName: landmarkData[<span class="number">0</span>].category.rawValue,</span><br><span class="line">            items: <span class="type">Array</span>(landmarkData.prefix(<span class="number">4</span>))</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/2b64d2d3c0a6cb1df0563ac00675ac7fe79866129a6b72ad645bf27e0a40114e/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f396437366637373030632f36613362336335632d333465622d346637322d393363362d6136666634383831376535622e706e67" alt=""></p>
<h2 id="步骤2-4">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-3"></a></p>
<blockquote>
<p>在<code>Home.swift</code>中，添加一个名为<code>FeaturedLandmarks</code>的简单视图，该视图仅显示标记为<code>isFeatured</code>的地标。</p>
</blockquote>
<p>在后面的教程中，您将把此视图转换为可交互的轮播视图。目前，它显示了一个裁剪和缩放后的预览图像。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categories: [<span class="type">String</span>: [<span class="type">Landmark</span>]] &#123;</span><br><span class="line">        <span class="type">Dictionary</span>(</span><br><span class="line">            grouping: landmarkData,</span><br><span class="line">            by: &#123; <span class="variable">$0</span>.category.rawValue &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> featured: [<span class="type">Landmark</span>] &#123;</span><br><span class="line">        landmarkData.filter &#123; <span class="variable">$0</span>.isFeatured &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">FeaturedLandmarks</span>(landmarks: featured)</span><br><span class="line">                    .scaledToFill()</span><br><span class="line">                    .frame(height: <span class="number">200</span>)</span><br><span class="line">                    .clipped()</span><br><span class="line">                <span class="type">ForEach</span>(categories.keys.sorted(), id: \.<span class="keyword">self</span>) &#123; key <span class="keyword">in</span></span><br><span class="line">                    <span class="type">CategoryRow</span>(categoryName: key, items: <span class="keyword">self</span>.categories[key]<span class="operator">!</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Featured&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FeaturedLandmarks</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmarks: [<span class="type">Landmark</span>]</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        landmarks[<span class="number">0</span>].image.resizable()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/c27fa8ef7828faa6d7edbf28a2d0c0d69aff9c57cccecb7534739101ac917d36/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f643037636165393339372f35363235656139652d366533362d343237302d396434342d3833303262373338623965352e706e67" alt=""></p>
<h2 id="步骤3-3">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-2"></a></p>
<p>在两种地标预览中将<code>edge insets</code>设置为零，以便内容可以延伸到屏幕边缘。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categories: [<span class="type">String</span>: [<span class="type">Landmark</span>]] &#123;</span><br><span class="line">        <span class="type">Dictionary</span>(</span><br><span class="line">            grouping: landmarkData,</span><br><span class="line">            by: &#123; <span class="variable">$0</span>.category.rawValue &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> featured: [<span class="type">Landmark</span>] &#123;</span><br><span class="line">        landmarkData.filter &#123; <span class="variable">$0</span>.isFeatured &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">FeaturedLandmarks</span>(landmarks: featured)</span><br><span class="line">                    .scaledToFill()</span><br><span class="line">                    .frame(height: <span class="number">200</span>)</span><br><span class="line">                    .clipped()</span><br><span class="line">                    .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">                </span><br><span class="line">                <span class="type">ForEach</span>(categories.keys.sorted(), id: \.<span class="keyword">self</span>) &#123; key <span class="keyword">in</span></span><br><span class="line">                    <span class="type">CategoryRow</span>(categoryName: key, items: <span class="keyword">self</span>.categories[key]<span class="operator">!</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Featured&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FeaturedLandmarks</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmarks: [<span class="type">Landmark</span>]</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        landmarks[<span class="number">0</span>].image.resizable()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/831721aa7e9c7e63bc5581baf34fc71750b0640cf5ca4858edb809a9a66d5c8e/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f386566623439346239622f35303266326431382d353737342d343339642d613363312d6238623235653635613737392e706e67" alt=""></p>
<h2 id="第五节-在分区之间添加导航">第五节 在分区之间添加导航</h2>
<p><a href="#%E7%AC%AC%E4%BA%94%E8%8A%82-%E5%9C%A8%E5%88%86%E5%8C%BA%E4%B9%8B%E9%97%B4%E6%B7%BB%E5%8A%A0%E5%AF%BC%E8%88%AA"></a></p>
<p>现在，在主页中可以看到所有不同分类的地标，用户需要一种方法来访问应用程序中的每个部分。使用<code>navigation</code>和<code>presentation Apis</code>可以从主页导航到地标详情页，收藏夹和用户主页。</p>
<p><img src="https://camo.githubusercontent.com/1f94b160bf9d8ebe7bffc2e41a8436d80be58391dab2416ccffb4e483581bc4a/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f626331313837333131302f32626231326135312d323733652d346663382d613131362d3736656664393039316432342e706e67" alt=""></p>
<h2 id="步骤1-5">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-4"></a></p>
<p>在<code>CategoryRow.swift</code>中，用<code>NavigationLink</code>包装现有的<code>CategoryItem</code>。</p>
<p>类别项本身是按钮的<code>label</code>，其目的地是显示地标详情视图。</p>
<blockquote>
<p>CategoryRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categoryName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> items: [<span class="type">Landmark</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="keyword">self</span>.categoryName)</span><br><span class="line">                .font(.headline)</span><br><span class="line">                .padding(.leading, <span class="number">15</span>)</span><br><span class="line">                .padding(.top, <span class="number">5</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">ScrollView</span>(.horizontal, showsIndicators: <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="type">HStack</span>(alignment: .top, spacing: <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="type">ForEach</span>(<span class="keyword">self</span>.items) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                        <span class="type">NavigationLink</span>(</span><br><span class="line">                            destination: <span class="type">LandmarkDetail</span>(</span><br><span class="line">                                landmark: landmark</span><br><span class="line">                            )</span><br><span class="line">                        ) &#123;</span><br><span class="line">                            <span class="type">CategoryItem</span>(landmark: landmark)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .frame(height: <span class="number">185</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryItem</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            landmark.image</span><br><span class="line">                .resizable()</span><br><span class="line">                .frame(width: <span class="number">155</span>, height: <span class="number">155</span>)</span><br><span class="line">                .cornerRadius(<span class="number">5</span>)</span><br><span class="line">            <span class="type">Text</span>(landmark.name)</span><br><span class="line">                .font(.caption)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding(.leading, <span class="number">15</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryRow</span>(</span><br><span class="line">            categoryName: landmarkData[<span class="number">0</span>].category.rawValue,</span><br><span class="line">            items: <span class="type">Array</span>(landmarkData.prefix(<span class="number">4</span>))</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/413ae130993f87716ab70d4d0574fe3561803a3f47e139045d361a81f18d456c/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f626638383932343062352f36643763346262372d343338312d343863332d616132372d3234613666383933626138622e706e67" alt=""></p>
<p><em><strong>注意</strong></em></p>
<blockquote>
<p>在<code>Xcode11 beta 6</code>中，如果在列表中嵌套一个<code>ScrollView</code>，并且该<code>ScrollView</code>包含一个<code>NavigationLink</code>，那么当用户点击<code>NavigationLink</code>时，这些<code>NavigationLink</code>不会导航到目标视图。</p>
</blockquote>
<h2 id="步骤2-5">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-4"></a></p>
<p>通过应用<code>renderingMode（:）</code>和<code>foregroundColor（:）</code>修饰符更改导航外观。</p>
<p>作为<code>NavigationLink</code>的<code>label</code>传递的文本使用环境的强调色进行渲染，而图像可能被作为<code>template images</code>进行渲染。您可以修改任一行为以最适合您的设计。</p>
<blockquote>
<p>CategoryRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categoryName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> items: [<span class="type">Landmark</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="keyword">self</span>.categoryName)</span><br><span class="line">                .font(.headline)</span><br><span class="line">                .padding(.leading, <span class="number">15</span>)</span><br><span class="line">                .padding(.top, <span class="number">5</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">ScrollView</span>(.horizontal, showsIndicators: <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="type">HStack</span>(alignment: .top, spacing: <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="type">ForEach</span>(<span class="keyword">self</span>.items) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                        <span class="type">NavigationLink</span>(</span><br><span class="line">                            destination: <span class="type">LandmarkDetail</span>(</span><br><span class="line">                                landmark: landmark</span><br><span class="line">                            )</span><br><span class="line">                        ) &#123;</span><br><span class="line">                            <span class="type">CategoryItem</span>(landmark: landmark)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .frame(height: <span class="number">185</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryItem</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            landmark.image</span><br><span class="line">                .renderingMode(.original)</span><br><span class="line">                .resizable()</span><br><span class="line">                .frame(width: <span class="number">155</span>, height: <span class="number">155</span>)</span><br><span class="line">                .cornerRadius(<span class="number">5</span>)</span><br><span class="line">            <span class="type">Text</span>(landmark.name)</span><br><span class="line">                .foregroundColor(.primary)</span><br><span class="line">                .font(.caption)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding(.leading, <span class="number">15</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryRow</span>(</span><br><span class="line">            categoryName: landmarkData[<span class="number">0</span>].category.rawValue,</span><br><span class="line">            items: <span class="type">Array</span>(landmarkData.prefix(<span class="number">4</span>))</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/40ad0aeb189cf55a35d268d0f4b94c0babc84183acc947084cf997dc37dc3a5a/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f396434333530393631332f64393931623434362d316436642d343164362d623662632d3935306637376133363534352e706e67" alt=""></p>
<h2 id="步骤3-4">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-3"></a></p>
<blockquote>
<p>在<code>Home.swift</code>中，点击选项卡栏中的简介图标后，添加一个模态视图以显示用户简介页面。</p>
</blockquote>
<p>当<code>showProfile</code>状态变量设置为<code>true</code>时，SwiftUI显示用户简介占位符，当用户关闭模态时，将<code>showProfile</code>设置回<code>false</code>。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categories: [<span class="type">String</span>: [<span class="type">Landmark</span>]] &#123;</span><br><span class="line">        <span class="type">Dictionary</span>(</span><br><span class="line">            grouping: landmarkData,</span><br><span class="line">            by: &#123; <span class="variable">$0</span>.category.rawValue &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> featured: [<span class="type">Landmark</span>] &#123;</span><br><span class="line">        landmarkData.filter &#123; <span class="variable">$0</span>.isFeatured &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showingProfile <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">FeaturedLandmarks</span>(landmarks: featured)</span><br><span class="line">                    .scaledToFill()</span><br><span class="line">                    .frame(height: <span class="number">200</span>)</span><br><span class="line">                    .clipped()</span><br><span class="line">                    .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">                </span><br><span class="line">                <span class="type">ForEach</span>(categories.keys.sorted(), id: \.<span class="keyword">self</span>) &#123; key <span class="keyword">in</span></span><br><span class="line">                    <span class="type">CategoryRow</span>(categoryName: key, items: <span class="keyword">self</span>.categories[key]<span class="operator">!</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Featured&quot;</span>))</span><br><span class="line">            .sheet(isPresented: <span class="variable">$showingProfile</span>) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;User Profile&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FeaturedLandmarks</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmarks: [<span class="type">Landmark</span>]</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        landmarks[<span class="number">0</span>].image.resizable()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/831721aa7e9c7e63bc5581baf34fc71750b0640cf5ca4858edb809a9a66d5c8e/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f386566623439346239622f35303266326431382d353737342d343339642d613363312d6238623235653635613737392e706e67" alt=""></p>
<h2 id="步骤4-3">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-2"></a></p>
<p>在导航栏中添加一个按钮，在点击时将<code>showProfile</code>从<code>false</code>切换为<code>true</code>。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categories: [<span class="type">String</span>: [<span class="type">Landmark</span>]] &#123;</span><br><span class="line">        .<span class="keyword">init</span>(</span><br><span class="line">            grouping: landmarkData,</span><br><span class="line">            by: &#123; <span class="variable">$0</span>.category.rawValue &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> featured: [<span class="type">Landmark</span>] &#123;</span><br><span class="line">        landmarkData.filter &#123; <span class="variable">$0</span>.isFeatured &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showingProfile <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> profileButton: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span>(action: &#123; <span class="keyword">self</span>.showingProfile.toggle() &#125;) &#123;</span><br><span class="line">            <span class="type">Image</span>(systemName: <span class="string">&quot;person.crop.circle&quot;</span>)</span><br><span class="line">                .imageScale(.large)</span><br><span class="line">                .accessibility(label: <span class="type">Text</span>(<span class="string">&quot;User Profile&quot;</span>))</span><br><span class="line">                .padding()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">FeaturedLandmarks</span>(landmarks: featured)</span><br><span class="line">                    .scaledToFill()</span><br><span class="line">                    .frame(height: <span class="number">200</span>)</span><br><span class="line">                    .clipped()</span><br><span class="line">                    .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">                </span><br><span class="line">                <span class="type">ForEach</span>(categories.keys.sorted(), id: \.<span class="keyword">self</span>) &#123; key <span class="keyword">in</span></span><br><span class="line">                    <span class="type">CategoryRow</span>(categoryName: key, items: <span class="keyword">self</span>.categories[key]<span class="operator">!</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Featured&quot;</span>))</span><br><span class="line">            .navigationBarItems(trailing: profileButton)</span><br><span class="line">            .sheet(isPresented: <span class="variable">$showingProfile</span>) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;User Profile&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FeaturedLandmarks</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmarks: [<span class="type">Landmark</span>]</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        landmarks[<span class="number">0</span>].image(forSize: <span class="number">250</span>).resizable()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/20e42fa057151b611d238df3d90aa348ae9bb00c5f7428fed435d8e6e846acb2/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f643335366365656333652f33346566363964332d356333382d346166392d613266632d6232373930393863653934312e706e67" alt=""></p>
<h2 id="步骤5">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45"></a></p>
<p>通过添加导航链接完成主页，该链接指向可过滤所有地标的列表。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categories: [<span class="type">String</span>: [<span class="type">Landmark</span>]] &#123;</span><br><span class="line">        <span class="type">Dictionary</span>(</span><br><span class="line">            grouping: landmarkData,</span><br><span class="line">            by: &#123; <span class="variable">$0</span>.category.rawValue &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> featured: [<span class="type">Landmark</span>] &#123;</span><br><span class="line">        landmarkData.filter &#123; <span class="variable">$0</span>.isFeatured &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showingProfile <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> profileButton: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span>(action: &#123; <span class="keyword">self</span>.showingProfile.toggle() &#125;) &#123;</span><br><span class="line">            <span class="type">Image</span>(systemName: <span class="string">&quot;person.crop.circle&quot;</span>)</span><br><span class="line">                .imageScale(.large)</span><br><span class="line">                .accessibility(label: <span class="type">Text</span>(<span class="string">&quot;User Profile&quot;</span>))</span><br><span class="line">                .padding()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">FeaturedLandmarks</span>(landmarks: featured)</span><br><span class="line">                    .scaledToFill()</span><br><span class="line">                    .frame(height: <span class="number">200</span>)</span><br><span class="line">                    .clipped()</span><br><span class="line">                    .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">                </span><br><span class="line">                <span class="type">ForEach</span>(categories.keys.sorted(), id: \.<span class="keyword">self</span>) &#123; key <span class="keyword">in</span></span><br><span class="line">                    <span class="type">CategoryRow</span>(categoryName: key, items: <span class="keyword">self</span>.categories[key]<span class="operator">!</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">                </span><br><span class="line">                <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkList</span>()) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;See All&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Featured&quot;</span>))</span><br><span class="line">            .navigationBarItems(trailing: profileButton)</span><br><span class="line">            .sheet(isPresented: <span class="variable">$showingProfile</span>) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;User Profile&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FeaturedLandmarks</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmarks: [<span class="type">Landmark</span>]</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        landmarks[<span class="number">0</span>].image.resizable()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/20e42fa057151b611d238df3d90aa348ae9bb00c5f7428fed435d8e6e846acb2/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f643335366365656333652f33346566363964332d356333382d346166392d613266632d6232373930393863653934312e706e67" alt=""></p>
<h2 id="步骤6">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46"></a></p>
<p>在<code>LandmarkList.swift</code>中，删除包装地标列表的<code>NavigationView</code>，并将其添加到预览中。</p>
<p>在应用程序的环境中，<code>LandmarkList</code>将始终显示在<code>Home.swift</code>中声明的导航视图中。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Toggle</span>(isOn: <span class="variable">$userData</span>.showFavoritesOnly) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Favorites only&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">ForEach</span>(userData.landmarks) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.userData.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                    <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                        <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">LandmarkList</span>()</span><br><span class="line">                .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/b0e1c3a23091ea24ef4d8d54ada6adab9df6a85711ac1bb2a693acd7c7d76eed/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f633562616130616431332f64353737316334622d333738372d343964332d623065312d3732373731396438353463332e706e67" alt=""></p>
<blockquote>
<p>SwiftUI纲要</p>
</blockquote>
<h2 id="创建和组织视图">创建和组织视图</h2>
<p><a href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E7%BB%84%E7%BB%87%E8%A7%86%E5%9B%BE"></a></p>
<blockquote>
<p>本教程将指导您构建一个iOS应用程序——<code>Landmarks(地标)</code>，用于发现和分享您喜欢的地方。首先，您将构建显示<code>Landmark</code>的详情页面。</p>
<p>为了布局视图，&quot;地标&quot;使用<code>stacks</code>来对<code>image、text</code>等组件进行组织和分层。要将地图添加到视图中，需要包含一个标准的<code>MapKit</code>组件。当您优化视图的设计时，Xcode提供实时反馈，这样当您修改代码时，就可以看到视图状态的改变。</p>
<p>下载项目文件开始构建此项目，并按照以下步骤操作：</p>
<p>学习时长：40分钟</p>
<p><a target="_blank" rel="noopener" href="https://docs-assets.developer.apple.com/published/c2c7dffe44/CreatingAndCombiningViews.zip">下载示例：CreatingAndCombiningViews.zip</a></p>
</blockquote>
<h2 id="第一节-创建新项目并浏览画布">第一节 创建新项目并浏览画布</h2>
<p><a href="#%E7%AC%AC%E4%B8%80%E8%8A%82-%E5%88%9B%E5%BB%BA%E6%96%B0%E9%A1%B9%E7%9B%AE%E5%B9%B6%E6%B5%8F%E8%A7%88%E7%94%BB%E5%B8%83"></a></p>
<p>创建一个使用SwiftUI的新Xcode项目。浏览画布、预览和SwiftUI模板代码。</p>
<blockquote>
<p><strong>要在Xcode中预览画布上的视图并与之交互，请确保Mac运行的是macOS Catalina 10.15。</strong></p>
</blockquote>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/create-new-project.gif" alt=""></p>
<h2 id="步骤一">步骤一</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80"></a></p>
<p>打开Xcode并在Xcode的启动窗口中单击<code>Create a new Xcode</code>项目，或者选择<code>File&gt;new&gt;project</code>。</p>
<p><img src="https://camo.githubusercontent.com/b896251a7bdc07ba857696a99dc6fe59bd89c8137cad7757cfc61f738c7e0b7e/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f383662333734366539622f65326236646630632d393035632d343533652d396436372d3137646463386536633632632e706e67" alt=""></p>
<h2 id="步骤二">步骤二</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C"></a></p>
<p>在模板选择器中，选择iOS平台，选择单视图应用程序模板，然后单击下一步。</p>
<p><img src="https://camo.githubusercontent.com/19b7163f0fce23e86f191a5d33a73f483bdfb3878bb8d03b039105b99a96282d/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f306431393839386237652f30366538306666312d343766322d343638652d613331622d3165373732333234316432352e706e67" alt=""></p>
<h2 id="步骤三">步骤三</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%89"></a></p>
<p>输入“Landmarks”作为产品名称，选中Use SwiftUI复选框，然后单击Next。选择一个路径来保存你的项目。</p>
<p><img src="https://camo.githubusercontent.com/5d1aaa88b7134b13f5b631ddfaca5371751fcd696a290fa7f4033ca10c6318aa/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f646164623566636264312f33356231633834642d313236652d343732632d393833392d3934623563316362636139312e706e67" alt=""></p>
<h2 id="步骤四">步骤四</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B"></a></p>
<p>在项目导航器中，单击以选择ContentView.swift。</p>
<p>默认情况下，SwiftUI视图文件声明两个结构。第一个结构实现了视图的必选协议，并描述了视图的内容和布局。第二个结构声明了该视图的预览。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/fa45c038604e470f340bc372a0be18df3fd2d59834b19100ff37f1892ce03b03/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f653063306239396461652f39623666363131622d313464662d343539322d613937372d3037383462653861373639352e706e67" alt=""></p>
<h2 id="步骤五">步骤五</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%94"></a></p>
<p>在画布中，单击<code>Resume</code>以显示预览。</p>
<blockquote>
<p>Tips:如果画布不可见，请选择<code>Editor &gt; Editor and Canvas</code>以显示它。</p>
</blockquote>
<p><img src="https://camo.githubusercontent.com/5aca50837582794c53801557c660bfbff1dfcf7f63a32ef319ba404a38abae1c/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663239623761393030382f65343364363039312d643238612d343433372d396231622d3062643566376664656533382e706e67" alt=""></p>
<h2 id="步骤六">步骤六</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%85%AD"></a></p>
<p>在<code>body</code>属性中，将“Hello World”更改为自己的问候语。</p>
<p>当您在视图的<code>body</code>属性中更改代码时，预览将更新以反映您的更改。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello SwiftUI!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/44805c99d5837b9b3e39aefbd74ea383346bd97981c351ddc6b74ff2e9b01237/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393839373063306139622f65333334313835362d633766382d346539612d626133362d6336633731346536346263312e706e67" alt=""></p>
<h2 id="第二节-自定义文本视图">第二节 自定义文本视图</h2>
<p><a href="#%E7%AC%AC%E4%BA%8C%E8%8A%82-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%87%E6%9C%AC%E8%A7%86%E5%9B%BE"></a></p>
<p>您可以通过更改代码，或使用检查器查看可用的内容，并帮助您编写代码，来自定义视图的显示。</p>
<p>构建<code>Lanmarks</code>应用程序时，可以使用任意编辑器组合：源码编辑、画布或检查器。无论使用哪种工具，代码都会保持更新。</p>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/customize-text-view.gif" alt=""></p>
<blockquote>
<p>接下来，您将使用检查器自定义文本视图。</p>
</blockquote>
<h2 id="步骤一-2">步骤一</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80-1"></a></p>
<p>在预览中，按住<code>command</code>并单击问候语以打开结构化编辑弹出窗口，然后选择<code>Inspect</code>。</p>
<p>弹出窗口显示可自定义的不同属性，具体取决于所检查的视图类型。</p>
<p><img src="https://camo.githubusercontent.com/acbaddebaf9e02fd1f3e2f3b3af218dd010b855bff9c6ba4e3a47a513627a423/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f616563353330636561362f30616238393338352d376638352d346136382d616562312d3039313938313434316334312e706e67" alt=""></p>
<h2 id="步骤二-2">步骤二</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C-1"></a></p>
<p>使用检查器将文本更改为“Turtle Rock”，即您将在应用程序中显示的第一个地标的名称。</p>
<p><img src="https://camo.githubusercontent.com/d9ee74324dc0900cb1d7b27792990c0a5fe2b36ed66a8552040d3dfb92bb9db7/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f353132306265303465352f63376639613030632d383738382d346133322d623036612d6466376433663961373933632e706e67" alt=""></p>
<h2 id="步骤三-2">步骤三</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%89-1"></a></p>
<p>将<code>font</code>更改为<code>Title</code>。</p>
<p>这会将系统字体应用于该文本，以便它正确适应用户系统偏好的字体大小和设置。</p>
<p><img src="https://camo.githubusercontent.com/9f18c4a616058131c5077547c4cf0f8f7b1f751e953938c806ff95f06c9438ff/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f666234633137313966632f33646464633932322d366666382d343566322d383733662d6634303030623434343339332e706e67" alt=""></p>
<blockquote>
<p>要自定义SwiftUI视图，可以调用名为<code>修饰符(modifier)</code>的方法。修饰符会包装视图以更改其显示或其他属性。每个修饰符都返回一个新视图，因此通常采用垂直的链式调用多个修饰符。</p>
</blockquote>
<h2 id="步骤四-2">步骤四</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B-1"></a></p>
<p>手动编辑代码添加<code>foregroundColor（.green）</code>修饰符；这会将文本的颜色更改为绿色。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">            .font(.title)</span><br><span class="line">            .foregroundColor(.green)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/97b308c4d6e5a26f949326cd1c00522d99a24940351288718961acd8f9aa4960/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f386535333035373431652f38386637373732342d666565382d346437312d383166382d3437336530616433616264352e706e67" alt=""></p>
<blockquote>
<p>您的代码始终真实反应到视图上。因此当使用检查器更改或移除修饰符时，Xcode会立即更新视图以匹配代码。</p>
</blockquote>
<h2 id="步骤五-2">步骤五</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%94-1"></a></p>
<p>然后我们在代码编辑区，按住<code>command</code>并单击<code>Text</code>来打开检查器，然后从弹出窗口中选择<code>Inspect</code>。单击<code>Color</code>弹出菜单，然后选择<code>Inherited</code> , 将文本颜色再次更改为黑色。</p>
<p><img src="https://camo.githubusercontent.com/c6327d9f8d1dbb1700ba90424a6ed8a8a0271fa26ea928c91a742c5f5477d6be/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f623433666439633531372f66303162373931302d633362302d346630652d386261612d3632366662393833376635612e706e67" alt=""></p>
<h2 id="步骤六-2">步骤六</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%85%AD-1"></a></p>
<p>请注意，Xcode会自动更新代码以反映您的更改，并删除<code>foregroundColor（.green）</code>修饰符。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">            .font(.title)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/96956a9d68ddac2e1dc6eb288b7ab3b6fe704f1eb96d889b3b131640d3f0bcf4/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f666562336666316666642f65323464393030352d333134392d346635382d383432392d3965646330383935366433362e706e67" alt=""></p>
<h2 id="第三节">第三节</h2>
<p><a href="#%E7%AC%AC%E4%B8%89%E8%8A%82"></a></p>
<h2 id="使用堆栈组合视图">使用堆栈组合视图</h2>
<p><a href="#%E4%BD%BF%E7%94%A8%E5%A0%86%E6%A0%88%E7%BB%84%E5%90%88%E8%A7%86%E5%9B%BE"></a></p>
<p>除了在上一节中创建的标题视图之外，还将添加文本视图，以包含有关地标的详细信息，例如公园的名称和所在的州。</p>
<p>创建SwiftUI视图时，可以在视图的<code>body</code>属性中描述其内容、布局和行为；但是，<code>body</code>属性只返回单个视图。您可以将多个视图组合并嵌入到<code>Stack</code>中，从而将视图水平、垂直或前后组合在一起。</p>
<p>在本节中，您将使用<code>VStack(垂直堆栈)</code>组合标题信息，使用<code>HStack(水平堆栈)</code>组合公园详情信息。</p>
<p><img src="https://camo.githubusercontent.com/3aeefe3292b56902b53bedabdd80192b5ee234ecf269f9107b09f74caa82e2f9/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f346130303064326333342f35343661346433342d666566392d343537342d613430352d6431366563383363613766652e706e67" alt=""></p>
<blockquote>
<p>你可以使用Xcode的结构化编辑功能在容器视图中嵌入视图，也可以打开<code>Inspector</code> 或使用<code>help</code>进行其他更多有用的更改。</p>
</blockquote>
<h2 id="步骤一-3">步骤一</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80-2"></a></p>
<p>按住<code>command</code>并单击<code>Text</code>视图，会看到初始值设定项的显示结构化编辑弹出窗口，然后选择<code>Embed in VStack</code>。</p>
<p><img src="https://camo.githubusercontent.com/cc4265b5a7b78aef59daf5b1853c9f1d8249d12fcca1923e7a5b4bd27c313a30/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336665383139363335382f36633934333065322d643062382d346161642d623131332d3465313263363938303135612e706e67" alt=""></p>
<blockquote>
<p>接下来，通过从<code>组件库</code>中拖动<code>Text</code>视图，将<code>Text</code>视图添加到<code>Stack</code>中。</p>
</blockquote>
<p>通过单击Xcode窗口右上角的加号按钮（＋）打开<code>组件库</code>，然后将<code>Text</code>视图拖到<code>Turtle Rock</code>文本视图下面的位置。</p>
<p><img src="https://camo.githubusercontent.com/4a1664a9507008e96d6e9f33f86c15160bc8af2e51a5e36472abef04746303e5/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f303033396239366439372f30626635663639322d366466312d343231352d393034392d6632346662333938373639652e706e67" alt=""></p>
<h2 id="步骤三-3">步骤三</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%89-2"></a></p>
<p>将<code>Text</code>视图的默认文本替换为“Joshua Tree National Park”。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                .font(.title)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/5d6997dedec53e4066531f7149f276b467926bae5d72db398c52dc78fa9d9f0f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663933373037383362622f30303262323930382d663832632d343866342d393634622d3833393831386631333864622e706e67" alt=""></p>
<blockquote>
<p>自定义位置文本的样式，以满足布局需求。</p>
</blockquote>
<h2 id="步骤四-3">步骤四</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B-2"></a></p>
<p>将位置的<code>font</code>设置为<code>subheadline</code> 。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                .font(.title)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                .font(.subheadline)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/8d00ac729f176849ab669f4bb3b530b1b6ba1753b74e6e052635f0d6613e0636/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f343462386236383931302f66353237663134322d363664662d343831642d383364662d3865666439366637616332652e706e67" alt=""></p>
<h2 id="步骤五-3">步骤五</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%94-2"></a></p>
<p>编辑<code>VStack</code>初始值设定项，以<code>leading</code>方式对齐视图。</p>
<p>默认情况下，<code>VStack</code>会将它们的内容按轴中心对齐，并提供上下文适当的间距。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                .font(.title)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                .font(.subheadline)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/35d3cab99a52b029abb9b190e70950cd52dc94aa49f3e2d59122c5ab565b199d/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f343162383435616533652f36373233376666372d306234322d346466662d386136362d3633343464313431326135352e706e67" alt=""></p>
<blockquote>
<p>接下来，您将在位置文本的右侧添加另一个文本视图，该视图用于展示公园所在的州。</p>
</blockquote>
<h2 id="步骤六-3">步骤六</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%85%AD-2"></a></p>
<p>在画布中，按住<code>command</code>并单击<code>Joshua Tree National Park</code>，然后选择<code>Embed In HStack</code>。</p>
<p><img src="https://camo.githubusercontent.com/8caee3d1764973d6aa74464911639db3835510e1801389dfb428a9d083967c0f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f366233656139613838352f36353538333832372d343235612d343934332d626135662d6261663134636237663834622e706e67" alt=""></p>
<h2 id="步骤七">步骤七</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%83"></a></p>
<p>在地点文本后添加新的文本视图，将默认文本更改为公园所在的州，然后将其<code>font</code>设置为<code>subheadline</code> 。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                .font(.title)</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                    .font(.subheadline)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                    .font(.subheadline)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/9bfc0dced1ef3a52ce3d041accc719f33799390abfb6cd709ea43b3270777fc0/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f383262663137313031392f63323936656633632d333235622d346166342d393061642d3862346536663932666531302e706e67" alt=""></p>
<h2 id="步骤八">步骤八</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%85%AB"></a></p>
<blockquote>
<p>若想使布局自动撑开并充满设备的宽，在<code>HStack</code>中添加<code>Spacer</code>来分隔<code>Joshua Tree National Park</code>和<code>California</code>两个文本视图。</p>
</blockquote>
<p><code>Spacer</code>将撑开<code>Stack</code>，以使其包含的视图充满其父视图的所有空间，而不是仅由其内容定义其大小。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                .font(.title)</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                    .font(.subheadline)</span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                    .font(.subheadline)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/e806ad2124c7ae0896f94c64ecfa668c53e32539ef4e511deebb3dc7d2fcdff1/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f643731306534363964352f64323865643832652d366230632d343738632d623139662d3030666664323262653831652e706e67" alt=""></p>
<h2 id="步骤九">步骤九</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B9%9D"></a></p>
<p>最后，使用<code>padding()</code>修饰符方法给整个地标信息区域加一个边距。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                .font(.title)</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                    .font(.subheadline)</span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                    .font(.subheadline)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/6722a06a707c4babd354052944bc899cc907cbcd117c4b8ccf5e2f63bf1fb6b1/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f636539656364316434382f64656636386131392d666237362d346133322d396539312d6539643265393364343036372e706e67" alt=""></p>
<h2 id="第四节">第四节</h2>
<p><a href="#%E7%AC%AC%E5%9B%9B%E8%8A%82"></a></p>
<p>创建自定义图像视图</p>
<p>在名称和地点视图都设置好的情况下，接下来要做的是为地标添加一个图像。</p>
<p>对自定义的图像使用遮罩、边框和阴影，和原来的方法相比，将使用很少的代码。</p>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/custom-image-view.gif" alt=""></p>
<blockquote>
<p>首先将图片添加到项目的<code>Assets</code>中。</p>
</blockquote>
<h2 id="步骤一-4">步骤一</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80-3"></a></p>
<p>在项目<code>Resources</code>文件夹的中找到<code>turtlerock.png</code>，将其拖到<code>Assets</code>中。Xcode为图像创建一个新的图像集。</p>
<p><img src="https://camo.githubusercontent.com/dfa87e40344b3fceb0c5ccded545c0c4d576332d0c5fad96ae69de5ec0647cea/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f623539663862646134352f35666662663461382d346361642d343162652d623839342d3162323062363935646262352e706e67" alt=""></p>
<blockquote>
<p>接下来，您将为您的自定义图像视图创建一个新的SwiftUI视图。</p>
</blockquote>
<h2 id="步骤二-3">步骤二</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C-2"></a></p>
<p>选择<code>File &gt; New &gt; File</code>再次打开模板选择器。在<code>User Interface</code>中，单击选择<code>SwiftUI View</code>，然后单击<code>Next</code>。将文件命名为<code>CircleImage.swift</code>，然后单击<code>Create</code>。</p>
<p><img src="https://camo.githubusercontent.com/38f219688c78bf6c3f118949309132314feb802fec3adf0f05444fb2fc0c9772/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f356165373664396566372f38326564626531612d646662362d346236332d623637322d6432356631646339633462302e706e67" alt=""></p>
<blockquote>
<p>现在您已准备好图像，以满足设计所需。</p>
</blockquote>
<h3 id="步骤三-4">步骤三</h3>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%89-3"></a></p>
<p>使用<code>Image(:)</code>将<code>Text</code>视图替换为Turtle Rock的图像视图。</p>
<blockquote>
<p>CircleImage.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Image</span>(<span class="string">&quot;turtlerock&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CircleImage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/fa383c03ffe8a6bcfa8a8c9b28d3711f86f6f6e0fe05b7503422c19d3151b360/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f653636643661303632392f38316562313064342d393739632d346164382d393539312d6131613239343834653464612e706e67" alt=""></p>
<h2 id="步骤四-4">步骤四</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B-3"></a></p>
<p>添加<code>Image</code>的<code>.clipShape(Circle())</code>的修饰符，将图像剪裁为圆形。</p>
<p><code>Circle()</code>是一个可以用作遮罩的形状，或通过给<code>Circle()</code>设置<code>stroke</code>或<code>fill</code>来绘制视图。</p>
<blockquote>
<p>CircleImage.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Image</span>(<span class="string">&quot;turtlerock&quot;</span>)</span><br><span class="line">            .clipShape(<span class="type">Circle</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CircleImage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d12972cd7ad4fa16646907177dc7e2cd8c306fa848d21147a6f34272e66cb953/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f666366323666323732652f30643166663464612d653838632d346537392d383065612d3537366364633164646364372e706e67" alt=""></p>
<h2 id="步骤五-4">步骤五</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%94-3"></a></p>
<p>创建另一个带有灰色<code>stroke</code>的<code>Circle()</code>，使用<code>.overlay()</code>修饰符，将其覆盖添加到图像的边框中。</p>
<blockquote>
<p>CircleImage.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Image</span>(<span class="string">&quot;turtlerock&quot;</span>)</span><br><span class="line">            .clipShape(<span class="type">Circle</span>())</span><br><span class="line">            .overlay(</span><br><span class="line">                <span class="type">Circle</span>().stroke(<span class="type">Color</span>.gray, lineWidth: <span class="number">4</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CircleImage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/7478ced9e68d1e568b055f1640cfefec6a0eeb02bc63dbd30d65aaeae716090c/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f373665376531343663622f62323063333934652d663330322d343638312d383163302d6336353561363162326337302e706e67" alt=""></p>
<h2 id="步骤六-4">步骤六</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%85%AD-3"></a></p>
<p>接下来，添加半径为<code>10point</code>的阴影。</p>
<blockquote>
<p>CircleImage.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Image</span>(<span class="string">&quot;turtlerock&quot;</span>)</span><br><span class="line">            .clipShape(<span class="type">Circle</span>())</span><br><span class="line">            .overlay(</span><br><span class="line">                <span class="type">Circle</span>().stroke(<span class="type">Color</span>.gray, lineWidth: <span class="number">4</span>))</span><br><span class="line">            .shadow(radius: <span class="number">10</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CircleImage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/4d29477149e15aa7473f5a604192733176f7ca99878d2391b53f5bccdee1db15/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f313663636235646262342f61343930346164302d373864632d346635662d613366332d3165393761663331353734362e706e67" alt=""></p>
<h2 id="步骤七-2">步骤七</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%83-1"></a></p>
<p>将边框颜色修改为白色。</p>
<p>到此，我们就完成了图像视图。</p>
<blockquote>
<p>CircleImage.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Image</span>(<span class="string">&quot;turtlerock&quot;</span>)</span><br><span class="line">            .clipShape(<span class="type">Circle</span>())</span><br><span class="line">            .overlay(</span><br><span class="line">                <span class="type">Circle</span>().stroke(<span class="type">Color</span>.white, lineWidth: <span class="number">4</span>))</span><br><span class="line">            .shadow(radius: <span class="number">10</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CircleImage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/89d64a999cb02f62d2946240944ab76e7de310b58d23dd69864bf049c7cb4af9/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f353463356536356234332f65646332636666312d646465342d343931372d623538642d6564346330353639303762622e706e67" alt=""></p>
<h2 id="第五节">第五节</h2>
<p><a href="#%E7%AC%AC%E4%BA%94%E8%8A%82"></a></p>
<h2 id="UIKit和SwiftUI配合使用">UIKit和SwiftUI配合使用</h2>
<p><a href="#uikit%E5%92%8Cswiftui%E9%85%8D%E5%90%88%E4%BD%BF%E7%94%A8"></a></p>
<p>现在可以创建地图视图了，您可以使用<code>MapKit</code>中的<code>MKMappView</code>类来绘制地图。</p>
<p>要在SwiftUI中使用UIView子类，可以将另一个视图包装在遵守UIViewRepresentable协议的SwiftUI视图中。SwiftUI包含了WatchKit和AppKit视图类似的协议。</p>
<p><img src="https://camo.githubusercontent.com/b3ae3c503c97109a3f27929c376bb5ef88ddd37f5ddf569f6b4d25236fec9a4d/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f313665326561303530312f62393735333932372d666234342d346637342d383736662d3331643931323663626231362e706e67" alt=""></p>
<blockquote>
<p>现在开始，您将创建一个新的自定义视图，该视图可以显示<code>MKMapView</code>。</p>
</blockquote>
<p>选择<code>File &gt; New &gt; File</code>，选择<code>iOS</code>平台，选择<code>SwiftUI View</code>模板，然后单击<code>Next</code>。将新文件命名为<code>MapView.swift</code>，然后单击“Create”。</p>
<p><img src="https://camo.githubusercontent.com/b2cbf45d4a436da332f40ab478e46f01f52f21ae1407b995a2fc07def74d1db5/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f303266346264623163372f62633066323063662d313039342d343139332d623832372d3435353737306266626132392e706e67" alt=""></p>
<h2 id="步骤二-4">步骤二</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C-3"></a></p>
<p>添加<code>import MapKit</code>，并让<code>MappView</code>结构遵守UIViewRepresentable协议。</p>
<p>不要担心Xcode显示的警告；您将在接下来的几个步骤中修复它。</p>
<blockquote>
<p>MapView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> MapKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MapView</span>: <span class="title class_ inherited__">UIViewRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MapView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">MapView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>UIViewRepresentable</code>协议有两个需要实现的方法：使用<code>UIView(context:)</code>方法创建<code>MKMapView</code>，使用<code>updateUIView(u:context:)</code>方法来配置视图并响应视图的任意变化。</p>
</blockquote>
<h2 id="步骤三-5">步骤三</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%89-4"></a></p>
<p>用<code>makeUIView（context:）</code>方法替换body属性。</p>
<blockquote>
<p>MapView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> MapKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MapView</span>: <span class="title class_ inherited__">UIViewRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIView</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">MKMapView</span> &#123;</span><br><span class="line">        <span class="type">MKMapView</span>(frame: .zero)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MapView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">MapView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤四-5">步骤四</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B-4"></a></p>
<p>创建一个<code>updateUIView（u:context:）</code>方法，将地图视图的区域设置为正确的坐标，以便将地图居中放置在<code>Turtle Rock</code>上。</p>
<blockquote>
<p>MapView.swift</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import SwiftUI</span><br><span class="line">import MapKit</span><br><span class="line"></span><br><span class="line">struct MapView: UIViewRepresentable &#123;</span><br><span class="line">    func makeUIView(context: Context) -&gt; MKMapView &#123;</span><br><span class="line">        MKMapView(frame: .zero)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    func updateUIView(_ view: MKMapView, context: Context) &#123;</span><br><span class="line">        let coordinate = CLLocationCoordinate2D(</span><br><span class="line">            latitude: 34.011286, longitude: -116.166868)</span><br><span class="line">        let span = MKCoordinateSpan(latitudeDelta: 2.0, longitudeDelta: 2.0)</span><br><span class="line">        let region = MKCoordinateRegion(center: coordinate, span: span)</span><br><span class="line">        view.setRegion(region, animated: true)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct MapView_Preview: PreviewProvider &#123;</span><br><span class="line">    static var previews: some View &#123;</span><br><span class="line">        MapView()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>当预览处于静态模式时，它们仅完全呈现<code>SwiftUI</code>视图。因为<code>MKMapView</code>是一个<code>UIView</code>子类，所以您需要切换到实时预览来查看地图。</p>
</blockquote>
<h2 id="步骤五-5">步骤五</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%94-4"></a></p>
<p>单击<code>Live Preview</code>按钮将预览切换到实时预览模式。您可能需要单击预览上方的<code>Try Again</code>或<code>Resume</code>按钮。</p>
<p>再过一会儿，你会看到一张<code>Joshua Tree National Park</code>的地图，那里是<code>Turtle Rock</code>的故乡。</p>
<p><img src="https://camo.githubusercontent.com/f721594834182445ac4af6508efaae5520c53febf3c75b5f8549aa1de1177e9c/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f343239336536353339662f37346238633831302d626537382d346133362d613032382d6634643132373466633736302e706e67" alt=""></p>
<h2 id="第六节">第六节</h2>
<p><a href="#%E7%AC%AC%E5%85%AD%E8%8A%82"></a></p>
<h2 id="组成详情视图">组成详情视图</h2>
<p><a href="#%E7%BB%84%E6%88%90%E8%AF%A6%E6%83%85%E8%A7%86%E5%9B%BE"></a></p>
<p>现在您已经拥有了所需的所有组件——名称和位置、圆形图像以及地图。</p>
<p>现在使用目前的工具，组合自定义视图，创建地标详情视图以达到最终设计吧。</p>
<p><img src="https://camo.githubusercontent.com/194cd52911cf2ed5d4e3cad7953c38a7375a16ebc26d3932c8e196642dab6096/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f333365313530626235352f39373362613730322d383564622d343835322d383531662d3836613934636663613030322e706e67" alt=""></p>
<h2 id="步骤一-5">步骤一</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80-4"></a></p>
<p>在项目导航器中，选择<code>ContentView.swift</code>文件。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                .font(.title)</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                    .font(.subheadline)</span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                    .font(.subheadline)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/f8c51da637994597d28d41dc04507f0f93c251000f39564ef23e867b941493a3/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f366430303836356435342f62613132646666372d386164622d346565612d396535322d6239323237386639376134642e706e67" alt=""></p>
<h2 id="步骤二-5">步骤二</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C-4"></a></p>
<p>将刚才的三个文本的VStack嵌入到另一个VStack中。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                    .font(.title)</span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/f8c51da637994597d28d41dc04507f0f93c251000f39564ef23e867b941493a3/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f366430303836356435342f62613132646666372d386164622d346565612d396535322d6239323237386639376134642e706e67" alt=""></p>
<h2 id="步骤三-6">步骤三</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%89-5"></a></p>
<blockquote>
<p>将自定义<code>MapView</code>添加到<code>Stack</code>顶部。使用<code>frame(width:height:)</code>设置<code>MapView</code>的大小。</p>
</blockquote>
<p>仅指定<code>height(高度)</code>参数时，视图会自动调整其内容的宽度。在这种情况下，<code>MapView</code>将展开以填充可用空间。</p>
<h2 id="步骤四-6">步骤四</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B-5"></a></p>
<p>单击<code>Live Preview</code>按钮，以在预览中查看渲染的地图。</p>
<p>您可以在显示实时预览时继续编辑视图。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>()</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                    .font(.title)</span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/bec25a515816f18045c64d1ef74843d963bb109bf840aea5ebe74f2dfdc1440b/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f653536353333656265632f32626662663733302d666362662d343430352d613132312d6435666563393663313430332e706e67" alt=""></p>
<h2 id="步骤五-6">步骤五</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%94-5"></a></p>
<p>将<code>CircleImage</code>视图添加到<code>Stack</code>中。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>()</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>()</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                    .font(.title)</span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/7ca40186fd5e512a5fc8af8816f02a1504e386df895bbaf069430d47208c58f5/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f373261363131396562302f61373938633064382d653561632d346531392d383461382d3565336636623762663465322e706e67" alt=""></p>
<h2 id="步骤六-5">步骤六</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%85%AD-4"></a></p>
<p>若要将<code>CircleImage</code>显示在<code>MapView</code>视图的上方，请使图像垂直偏移-130个点，并从视图底部填充-130个点。</p>
<p>这些调整通过向上移动图像为文本腾出空间。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>()</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>()</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                    .font(.title)</span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/5a711088e7a71112df3d58961351cc7f0e33438f2160a85e6e24e21898b83ff8/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f623735306231356663652f37613135633138382d616334642d346163302d386161372d6163663536636431353737642e706e67" alt=""></p>
<h2 id="步骤七-3">步骤七</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%83-2"></a></p>
<p>在<code>VStack</code>中底部添加一个<code>Spacer()</code>，将内容推到屏幕的顶部。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>()</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>()</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                    .font(.title)</span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/71a7e5f83911ef9b430ae72e3560407b9976f3340bd52f8b5080ab4da1bf1d74/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f666538313037343966622f33343663313732652d313335382d343966652d626238392d3331633030373736656561382e706e67" alt=""></p>
<h2 id="步骤八-2">步骤八</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%85%AB-1"></a></p>
<p>最后，要允许地图内容扩展到屏幕的上边缘，请将<code>edgesIgnoringSafeArea（.top）</code>修饰符添加到地图视图中。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>()</span><br><span class="line">                .edgesIgnoringSafeArea(.top)</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>()</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                    .font(.title)</span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/f348f6b5192adb6ce6417793d8aef7e43df24a97d6076575985141f77a9c2a87/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336231356434363864362f36363530306134662d303137392d343465362d616362302d6166393436383964396538652e706e67" alt=""></p>
<h3 id="绘图和动画">绘图和动画</h3>
<p><a href="#%E7%BB%98%E5%9B%BE%E5%92%8C%E5%8A%A8%E7%94%BB"></a></p>
<h2 id="绘制路径和形状">绘制路径和形状</h2>
<p><a href="#%E7%BB%98%E5%88%B6%E8%B7%AF%E5%BE%84%E5%92%8C%E5%BD%A2%E7%8A%B6"></a></p>
<p>用户每次访问列表中的地标时都会收到徽章。当然，要让用户收到徽章，您需要创建一个徽章。本教程将引导您通过组合路径和形状来创建徽章，然后将其与表示位置的另一个形状重叠。</p>
<p>如果要为不同类型的地标创建多个徽章，请尝试使用覆盖的符号、更改重复次数或更改不同角度和比例。</p>
<blockquote>
<p>学习时间：25分钟</p>
<p><a target="_blank" rel="noopener" href="https://docs-assets.developer.apple.com/published/03f5d726da/DrawingPathsAndShapes.zip">下载地址：DrawingPathsAndShapes.zip</a></p>
</blockquote>
<h2 id="第一节-创建徽章视图">第一节 创建徽章视图</h2>
<p><a href="#%E7%AC%AC%E4%B8%80%E8%8A%82-%E5%88%9B%E5%BB%BA%E5%BE%BD%E7%AB%A0%E8%A7%86%E5%9B%BE"></a></p>
<p>要创建徽章，首先要创建一个徽章视图，该视图使用<code>SwiftUI</code>中的矢量绘图<code>api</code>。</p>
<p><img src="https://camo.githubusercontent.com/774d2e73ebaff78b70c40ca9529b4861403a603308c8194925f26c99219a5c79/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f633034643230303131322f31656161366365302d303239662d343637652d396431392d3038353266636461646233352e706e67" alt=""></p>
<h2 id="步骤1-6">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41"></a></p>
<p>选择<code>File &gt; New &gt; File</code>，然后从“iOS模板”工作表中选择<code>SwiftUI View</code>。单击<code>Next</code>继续，然后在“Save as”字段中输入<code>Badge</code>并单击“Create”。</p>
<p><img src="https://camo.githubusercontent.com/99555d98d1b740eee3060c51ebdeb1d66ccfbef1c27e68c781b2b4914aeefeae/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f383436353835636132362f31356132366132382d653630652d343034342d623765372d3236643838646434653531302e706e67" alt=""></p>
<h2 id="步骤2-6">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42"></a></p>
<p>调整<code>Badge</code>视图以显示文本“Badge”，接下来我们开始定义徽章形状。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Badge&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/929d03baece74b8f321a9b5d3658d7e94c9672a1a1ddd1c2db4025a405459b5f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f306637373361633362632f34326663666164642d346636322d343833392d393635662d6633343238663863336431622e706e67" alt=""></p>
<h2 id="第二节-绘制徽章背景">第二节 绘制徽章背景</h2>
<p><a href="#%E7%AC%AC%E4%BA%8C%E8%8A%82-%E7%BB%98%E5%88%B6%E5%BE%BD%E7%AB%A0%E8%83%8C%E6%99%AF"></a></p>
<p>使用SwiftUI中的图形api绘制自定义徽章形状。</p>
<p><img src="https://camo.githubusercontent.com/152655c4d7925d1485ba71c999f8d9d69c540687d4b5d23baec49ae52e8b6c7c/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f356636333265333030352f31353832333462662d356139382d346436342d386663302d3764363835663431393435332e706e67" alt=""></p>
<h2 id="步骤1-7">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-1"></a></p>
<blockquote>
<p>查看<code>HexagonParameters.swift</code>文件中的代码。</p>
</blockquote>
<p>六边形参数结构定义了绘制徽章六边形的详细信息。您不会修改此数据；相反，您将使用它指定用于绘制徽章的线条和曲线的控制点。</p>
<blockquote>
<p>HexagonParameters.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HexagonParameters</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Segment</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> useWidth: (<span class="type">CGFloat</span>, <span class="type">CGFloat</span>, <span class="type">CGFloat</span>)</span><br><span class="line">        <span class="keyword">let</span> xFactors: (<span class="type">CGFloat</span>, <span class="type">CGFloat</span>, <span class="type">CGFloat</span>)</span><br><span class="line">        <span class="keyword">let</span> useHeight: (<span class="type">CGFloat</span>, <span class="type">CGFloat</span>, <span class="type">CGFloat</span>)</span><br><span class="line">        <span class="keyword">let</span> yFactors: (<span class="type">CGFloat</span>, <span class="type">CGFloat</span>, <span class="type">CGFloat</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> adjustment: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">0.085</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> points <span class="operator">=</span> [</span><br><span class="line">        <span class="type">Segment</span>(</span><br><span class="line">            useWidth:  (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">1.00</span>),</span><br><span class="line">            xFactors:  (<span class="number">0.60</span>, <span class="number">0.40</span>, <span class="number">0.50</span>),</span><br><span class="line">            useHeight: (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">0.00</span>),</span><br><span class="line">            yFactors:  (<span class="number">0.05</span>, <span class="number">0.05</span>, <span class="number">0.00</span>)</span><br><span class="line">        ),</span><br><span class="line">        <span class="type">Segment</span>(</span><br><span class="line">            useWidth:  (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">0.00</span>),</span><br><span class="line">            xFactors:  (<span class="number">0.05</span>, <span class="number">0.00</span>, <span class="number">0.00</span>),</span><br><span class="line">            useHeight: (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">1.00</span>),</span><br><span class="line">            yFactors:  (<span class="number">0.20</span> <span class="operator">+</span> adjustment, <span class="number">0.30</span> <span class="operator">+</span> adjustment, <span class="number">0.25</span> <span class="operator">+</span> adjustment)</span><br><span class="line">        ),</span><br><span class="line">        <span class="type">Segment</span>(</span><br><span class="line">            useWidth:  (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">0.00</span>),</span><br><span class="line">            xFactors:  (<span class="number">0.00</span>, <span class="number">0.05</span>, <span class="number">0.00</span>),</span><br><span class="line">            useHeight: (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">1.00</span>),</span><br><span class="line">            yFactors:  (<span class="number">0.70</span> <span class="operator">-</span> adjustment, <span class="number">0.80</span> <span class="operator">-</span> adjustment, <span class="number">0.75</span> <span class="operator">-</span> adjustment)</span><br><span class="line">        ),</span><br><span class="line">        <span class="type">Segment</span>(</span><br><span class="line">            useWidth:  (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">1.00</span>),</span><br><span class="line">            xFactors:  (<span class="number">0.40</span>, <span class="number">0.60</span>, <span class="number">0.50</span>),</span><br><span class="line">            useHeight: (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">1.00</span>),</span><br><span class="line">            yFactors:  (<span class="number">0.95</span>, <span class="number">0.95</span>, <span class="number">1.00</span>)</span><br><span class="line">        ),</span><br><span class="line">        <span class="type">Segment</span>(</span><br><span class="line">            useWidth:  (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">1.00</span>),</span><br><span class="line">            xFactors:  (<span class="number">0.95</span>, <span class="number">1.00</span>, <span class="number">1.00</span>),</span><br><span class="line">            useHeight: (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">1.00</span>),</span><br><span class="line">            yFactors:  (<span class="number">0.80</span> <span class="operator">-</span> adjustment, <span class="number">0.70</span> <span class="operator">-</span> adjustment, <span class="number">0.75</span> <span class="operator">-</span> adjustment)</span><br><span class="line">        ),</span><br><span class="line">        <span class="type">Segment</span>(</span><br><span class="line">            useWidth:  (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">1.00</span>),</span><br><span class="line">            xFactors:  (<span class="number">1.00</span>, <span class="number">0.95</span>, <span class="number">1.00</span>),</span><br><span class="line">            useHeight: (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">1.00</span>),</span><br><span class="line">            yFactors:  (<span class="number">0.30</span> <span class="operator">+</span> adjustment, <span class="number">0.20</span> <span class="operator">+</span> adjustment, <span class="number">0.25</span> <span class="operator">+</span> adjustment)</span><br><span class="line">        )</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤2-7">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-1"></a></p>
<p>在<code>Badge.swift</code>中，向<code>Badge</code>添加一个<code>Path shape</code>，并应用<code>fill（）</code>修饰符将该形状转换为视图。</p>
<p>您可以使用<code>paths</code>来组合线条、曲线和其他绘图，以形成更复杂的形状，如徽章的六边形背景。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        .fill(<span class="type">Color</span>.black)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤3-5">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43"></a></p>
<p>为<code>path</code>添加起点。</p>
<p><code>move（to:）</code>方法在形状的边界内移动绘图光标，就像一支虚构的笔悬停在该区域上，等待开始绘图一样。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">var</span> width: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">100.0</span></span><br><span class="line">            <span class="keyword">let</span> height <span class="operator">=</span> width</span><br><span class="line">            path.move(to: <span class="type">CGPoint</span>(x: width <span class="operator">*</span> <span class="number">0.95</span>, y: height <span class="operator">*</span> <span class="number">0.20</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        .fill(<span class="type">Color</span>.black)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤4-4">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44"></a></p>
<p>为形状数据的每个点绘制线，以创建一个大致的六边形。</p>
<p><code>addLine（to:）</code>方法接受一个点并绘制它。对<code>addLine（to:）</code>连续调用，会从上一点开始到新点画一条线。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">var</span> width: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">100.0</span></span><br><span class="line">            <span class="keyword">let</span> height <span class="operator">=</span> width</span><br><span class="line">            path.move(to: <span class="type">CGPoint</span>(x: width <span class="operator">*</span> <span class="number">0.95</span>, y: height <span class="operator">*</span> <span class="number">0.20</span>))</span><br><span class="line">            </span><br><span class="line">            <span class="type">HexagonParameters</span>.points.forEach &#123;</span><br><span class="line">                path.addLine(</span><br><span class="line">                    to: .<span class="keyword">init</span>(</span><br><span class="line">                        x: width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">0</span>,</span><br><span class="line">                        y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">0</span></span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .fill(<span class="type">Color</span>.black)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/ed85c5f693b54a593cc345800d22c474866f66600c7a317f815b704ff64e5af3/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f653562343833633738622f33383931613534372d366466342d343731382d383362632d6335313766333166623438612e706e67" alt=""></p>
<blockquote>
<p>如果你的六边形看起来有点不寻常，不要担心；这符合预期。在接下来的几个步骤中，您将努力使六边形看起来更像本节开头显示的徽章形状。</p>
</blockquote>
<h2 id="步骤5-2">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45"></a></p>
<p>使用<code>addQuadCurve（to:control:）</code>方法为徽章的角绘制<code>Bézier</code>曲线。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">var</span> width: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">100.0</span></span><br><span class="line">            <span class="keyword">let</span> height <span class="operator">=</span> width</span><br><span class="line">            path.move(</span><br><span class="line">                to: <span class="type">CGPoint</span>(</span><br><span class="line">                    x: width <span class="operator">*</span> <span class="number">0.95</span>,</span><br><span class="line">                    y: height <span class="operator">*</span> (<span class="number">0.20</span> <span class="operator">+</span> <span class="type">HexagonParameters</span>.adjustment)</span><br><span class="line">                )</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="type">HexagonParameters</span>.points.forEach &#123;</span><br><span class="line">                path.addLine(</span><br><span class="line">                    to: .<span class="keyword">init</span>(</span><br><span class="line">                        x: width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">0</span>,</span><br><span class="line">                        y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">0</span></span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                path.addQuadCurve(</span><br><span class="line">                    to: .<span class="keyword">init</span>(</span><br><span class="line">                        x: width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">1</span>,</span><br><span class="line">                        y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">1</span></span><br><span class="line">                    ),</span><br><span class="line">                    control: .<span class="keyword">init</span>(</span><br><span class="line">                        x: width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">2</span>,</span><br><span class="line">                        y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">2</span></span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .fill(<span class="type">Color</span>.black)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/87cfebdd9ef83b5c88d360e56ef8075fdb707f0022f55cdb937b6e1b7d286209/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f383238323862653436652f62633739393939392d336637632d343463312d623463332d3265333964613466373463312e706e67" alt=""></p>
<h2 id="步骤6-2">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46"></a></p>
<blockquote>
<p>将徽章<code>path</code>包装在<code>GeometryReader</code>中，以便徽章可以使用其包含视图的大小，该视图定义大小，而不是硬编码值（100）。</p>
</blockquote>
<p>当包含的视图不是正方形时，使用几何体的两个维度中的最小值以保证徽章的宽高比。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; geometry <span class="keyword">in</span></span><br><span class="line">            <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">var</span> width: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="built_in">min</span>(geometry.size.width, geometry.size.height)</span><br><span class="line">                <span class="keyword">let</span> height <span class="operator">=</span> width</span><br><span class="line">                path.move(</span><br><span class="line">                    to: <span class="type">CGPoint</span>(</span><br><span class="line">                        x: width <span class="operator">*</span> <span class="number">0.95</span>,</span><br><span class="line">                        y: height <span class="operator">*</span> (<span class="number">0.20</span> <span class="operator">+</span> <span class="type">HexagonParameters</span>.adjustment)</span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                <span class="type">HexagonParameters</span>.points.forEach &#123;</span><br><span class="line">                    path.addLine(</span><br><span class="line">                        to: .<span class="keyword">init</span>(</span><br><span class="line">                            x: width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">0</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">0</span></span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                    </span><br><span class="line">                    path.addQuadCurve(</span><br><span class="line">                        to: .<span class="keyword">init</span>(</span><br><span class="line">                            x: width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">1</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">1</span></span><br><span class="line">                        ),</span><br><span class="line">                        control: .<span class="keyword">init</span>(</span><br><span class="line">                            x: width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">2</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">2</span></span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .fill(<span class="type">Color</span>.black)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/61a30b59da3216e824c6590b73438de6c4ab4edc0a04ecb6ad00b78ea23eaee2/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f313632643635333131352f66306264636565322d316633302d343264622d396635372d6661646532343463663064392e706e67" alt=""></p>
<h2 id="步骤7">步骤7</h2>
<p><a href="#%E6%AD%A5%E9%AA%A47"></a></p>
<p>使用<code>xScale</code>和<code>xOffset</code>调整变量使徽章在其几何体中居中。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; geometry <span class="keyword">in</span></span><br><span class="line">            <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">var</span> width: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="built_in">min</span>(geometry.size.width, geometry.size.height)</span><br><span class="line">                <span class="keyword">let</span> height <span class="operator">=</span> width</span><br><span class="line">                <span class="keyword">let</span> xScale: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">0.832</span></span><br><span class="line">                <span class="keyword">let</span> xOffset <span class="operator">=</span> (width <span class="operator">*</span> (<span class="number">1.0</span> <span class="operator">-</span> xScale)) <span class="operator">/</span> <span class="number">2.0</span></span><br><span class="line">                width <span class="operator">*=</span> xScale</span><br><span class="line">                path.move(</span><br><span class="line">                    to: <span class="type">CGPoint</span>(</span><br><span class="line">                        x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="number">0.95</span>,</span><br><span class="line">                        y: height <span class="operator">*</span> (<span class="number">0.20</span> <span class="operator">+</span> <span class="type">HexagonParameters</span>.adjustment)</span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                <span class="type">HexagonParameters</span>.points.forEach &#123;</span><br><span class="line">                    path.addLine(</span><br><span class="line">                        to: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">0</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">0</span></span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                    </span><br><span class="line">                    path.addQuadCurve(</span><br><span class="line">                        to: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">1</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">1</span></span><br><span class="line">                        ),</span><br><span class="line">                        control: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">2</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">2</span></span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .fill(<span class="type">Color</span>.black)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/37f8b437e325cf8c743d02b004c60c4b608e24fbfe2556fd9b899b94d4aa749a/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f333565653665356265612f39333734316261332d396662622d343633362d613336372d3630323262663839663463652e706e67" alt=""></p>
<h2 id="步骤8">步骤8</h2>
<p><a href="#%E6%AD%A5%E9%AA%A48"></a></p>
<p>将徽章的纯黑背景替换为与设计匹配的渐变色。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; geometry <span class="keyword">in</span></span><br><span class="line">            <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">var</span> width: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="built_in">min</span>(geometry.size.width, geometry.size.height)</span><br><span class="line">                <span class="keyword">let</span> height <span class="operator">=</span> width</span><br><span class="line">                <span class="keyword">let</span> xScale: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">0.832</span></span><br><span class="line">                <span class="keyword">let</span> xOffset <span class="operator">=</span> (width <span class="operator">*</span> (<span class="number">1.0</span> <span class="operator">-</span> xScale)) <span class="operator">/</span> <span class="number">2.0</span></span><br><span class="line">                width <span class="operator">*=</span> xScale</span><br><span class="line">                path.move(</span><br><span class="line">                    to: <span class="type">CGPoint</span>(</span><br><span class="line">                        x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="number">0.95</span>,</span><br><span class="line">                        y: height <span class="operator">*</span> (<span class="number">0.20</span> <span class="operator">+</span> <span class="type">HexagonParameters</span>.adjustment)</span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                <span class="type">HexagonParameters</span>.points.forEach &#123;</span><br><span class="line">                    path.addLine(</span><br><span class="line">                        to: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">0</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">0</span></span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                    </span><br><span class="line">                    path.addQuadCurve(</span><br><span class="line">                        to: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">1</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">1</span></span><br><span class="line">                        ),</span><br><span class="line">                        control: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">2</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">2</span></span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .fill(<span class="type">LinearGradient</span>(</span><br><span class="line">                gradient: .<span class="keyword">init</span>(colors: [<span class="keyword">Self</span>.gradientStart, <span class="keyword">Self</span>.gradientEnd]),</span><br><span class="line">                startPoint: .<span class="keyword">init</span>(x: <span class="number">0.5</span>, y: <span class="number">0</span>),</span><br><span class="line">                endPoint: .<span class="keyword">init</span>(x: <span class="number">0.5</span>, y: <span class="number">0.6</span>)</span><br><span class="line">            ))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> gradientStart <span class="operator">=</span> <span class="type">Color</span>(red: <span class="number">239.0</span> <span class="operator">/</span> <span class="number">255</span>, green: <span class="number">120.0</span> <span class="operator">/</span> <span class="number">255</span>, blue: <span class="number">221.0</span> <span class="operator">/</span> <span class="number">255</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> gradientEnd <span class="operator">=</span> <span class="type">Color</span>(red: <span class="number">239.0</span> <span class="operator">/</span> <span class="number">255</span>, green: <span class="number">172.0</span> <span class="operator">/</span> <span class="number">255</span>, blue: <span class="number">120.0</span> <span class="operator">/</span> <span class="number">255</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/1e524ce2966d5a60db50b14b4b30ae40adbd877f7e0456464b2d1dfa6ebc7f5a/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f346631383133633738392f63376362313063312d376536342d346362362d623536362d3065306533633566326331372e706e67" alt=""></p>
<h2 id="步骤9">步骤9</h2>
<p><a href="#%E6%AD%A5%E9%AA%A49"></a></p>
<p>对渐变填充应用<code>aspectRatio（u:contentMode:）</code>修饰符。</p>
<p>即使其父视图不是正方形的，可以通过它可以使视图保持1:1的宽高比，并保持其在视图中心的位置。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; geometry <span class="keyword">in</span></span><br><span class="line">            <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">var</span> width: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="built_in">min</span>(geometry.size.width, geometry.size.height)</span><br><span class="line">                <span class="keyword">let</span> height <span class="operator">=</span> width</span><br><span class="line">                <span class="keyword">let</span> xScale: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">0.832</span></span><br><span class="line">                <span class="keyword">let</span> xOffset <span class="operator">=</span> (width <span class="operator">*</span> (<span class="number">1.0</span> <span class="operator">-</span> xScale)) <span class="operator">/</span> <span class="number">2.0</span></span><br><span class="line">                width <span class="operator">*=</span> xScale</span><br><span class="line">                path.move(</span><br><span class="line">                    to: <span class="type">CGPoint</span>(</span><br><span class="line">                        x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="number">0.95</span>,</span><br><span class="line">                        y: height <span class="operator">*</span> (<span class="number">0.20</span> <span class="operator">+</span> <span class="type">HexagonParameters</span>.adjustment)</span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                <span class="type">HexagonParameters</span>.points.forEach &#123;</span><br><span class="line">                    path.addLine(</span><br><span class="line">                        to: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">0</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">0</span></span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                    </span><br><span class="line">                    path.addQuadCurve(</span><br><span class="line">                        to: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">1</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">1</span></span><br><span class="line">                        ),</span><br><span class="line">                        control: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">2</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">2</span></span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .fill(<span class="type">LinearGradient</span>(</span><br><span class="line">                gradient: .<span class="keyword">init</span>(colors: [<span class="keyword">Self</span>.gradientStart, <span class="keyword">Self</span>.gradientEnd]),</span><br><span class="line">                startPoint: .<span class="keyword">init</span>(x: <span class="number">0.5</span>, y: <span class="number">0</span>),</span><br><span class="line">                endPoint: .<span class="keyword">init</span>(x: <span class="number">0.5</span>, y: <span class="number">0.6</span>)</span><br><span class="line">            ))</span><br><span class="line">            .aspectRatio(<span class="number">1</span>, contentMode: .fit)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> gradientStart <span class="operator">=</span> <span class="type">Color</span>(red: <span class="number">239.0</span> <span class="operator">/</span> <span class="number">255</span>, green: <span class="number">120.0</span> <span class="operator">/</span> <span class="number">255</span>, blue: <span class="number">221.0</span> <span class="operator">/</span> <span class="number">255</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> gradientEnd <span class="operator">=</span> <span class="type">Color</span>(red: <span class="number">239.0</span> <span class="operator">/</span> <span class="number">255</span>, green: <span class="number">172.0</span> <span class="operator">/</span> <span class="number">255</span>, blue: <span class="number">120.0</span> <span class="operator">/</span> <span class="number">255</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/f7fec3cabd47e719e97ea257fc21fb68c72689ffffca4ff3ceeb769d8063483c/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f333535643136623766662f36623561346438332d373034352d343862312d623431642d6231323936623037303265652e706e67" alt=""></p>
<h2 id="第三节-画徽章符号">第三节 画徽章符号</h2>
<p><a href="#%E7%AC%AC%E4%B8%89%E8%8A%82-%E7%94%BB%E5%BE%BD%E7%AB%A0%E7%AC%A6%E5%8F%B7"></a></p>
<p>地标徽章的中心有一个自定义徽章，该徽章基于地标应用程序图标中显示的山。</p>
<p>山体符号由两个形状组成：一个表示山顶的积雪，另一个表示沿引道的植被。您将使用两个由一个小间隙隔开的部分三角形来绘制它们。</p>
<p><img src="https://camo.githubusercontent.com/019468198dbe1e4663f786a97adedae4c70b9857a7bc2a3042250d9515d1480f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f353238376430396166642f34373364366363652d656164342d343438332d616438302d3364363934653733633435612e706e67" alt=""></p>
<h2 id="步骤1-8">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-2"></a></p>
<p>在名为<code>BadgeBackground.swift</code>的新文件中，将徽章视图的主体放入新的徽章背景视图中，以便为其他视图准备徽章视图。</p>
<blockquote>
<p>BadgeBackground.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BadgeBackground</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; geometry <span class="keyword">in</span></span><br><span class="line">            <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">var</span> width: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="built_in">min</span>(geometry.size.width, geometry.size.height)</span><br><span class="line">                <span class="keyword">let</span> height <span class="operator">=</span> width</span><br><span class="line">                <span class="keyword">let</span> xScale: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">0.832</span></span><br><span class="line">                <span class="keyword">let</span> xOffset <span class="operator">=</span> (width <span class="operator">*</span> (<span class="number">1.0</span> <span class="operator">-</span> xScale)) <span class="operator">/</span> <span class="number">2.0</span></span><br><span class="line">                width <span class="operator">*=</span> xScale</span><br><span class="line">                path.move(</span><br><span class="line">                    to: <span class="type">CGPoint</span>(</span><br><span class="line">                        x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="number">0.95</span>,</span><br><span class="line">                        y: height <span class="operator">*</span> (<span class="number">0.20</span> <span class="operator">+</span> <span class="type">HexagonParameters</span>.adjustment)</span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                <span class="type">HexagonParameters</span>.points.forEach &#123;</span><br><span class="line">                    path.addLine(</span><br><span class="line">                        to: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">0</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">0</span></span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                    </span><br><span class="line">                    path.addQuadCurve(</span><br><span class="line">                        to: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">1</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">1</span></span><br><span class="line">                        ),</span><br><span class="line">                        control: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">2</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">2</span></span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .fill(<span class="type">LinearGradient</span>(</span><br><span class="line">                gradient: .<span class="keyword">init</span>(colors: [<span class="keyword">Self</span>.gradientStart, <span class="keyword">Self</span>.gradientEnd]),</span><br><span class="line">                startPoint: .<span class="keyword">init</span>(x: <span class="number">0.5</span>, y: <span class="number">0</span>),</span><br><span class="line">                endPoint: .<span class="keyword">init</span>(x: <span class="number">0.5</span>, y: <span class="number">0.6</span>)</span><br><span class="line">            ))</span><br><span class="line">            .aspectRatio(<span class="number">1</span>, contentMode: .fit)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> gradientStart <span class="operator">=</span> <span class="type">Color</span>(red: <span class="number">239.0</span> <span class="operator">/</span> <span class="number">255</span>, green: <span class="number">120.0</span> <span class="operator">/</span> <span class="number">255</span>, blue: <span class="number">221.0</span> <span class="operator">/</span> <span class="number">255</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> gradientEnd <span class="operator">=</span> <span class="type">Color</span>(red: <span class="number">239.0</span> <span class="operator">/</span> <span class="number">255</span>, green: <span class="number">172.0</span> <span class="operator">/</span> <span class="number">255</span>, blue: <span class="number">120.0</span> <span class="operator">/</span> <span class="number">255</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BadgeBackground_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">BadgeBackground</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤2-8">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-2"></a></p>
<p>将徽章背景放在徽章主体中以恢复徽章。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">BadgeBackground</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤3-6">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-1"></a></p>
<p>为山形创建一个名为<code>BadgeSymbol</code>的新自定义视图，该山形在徽章设计中以旋转方式绘制。</p>
<blockquote>
<p>BadgeSymbol.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BadgeSymbol</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Badge Symbol&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BadgeSymbol_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">BadgeSymbol</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤4-5">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-1"></a></p>
<blockquote>
<p>使用<code>Paths api</code>绘制符号的顶部。</p>
</blockquote>
<p><em><strong>实验</strong></em></p>
<p>尝试调整与spacing、topWidth和topHeight常量关联的系数，以查看它们如何影响整体形状。</p>
<blockquote>
<p>BadgeSymbol.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BadgeSymbol</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; geometry <span class="keyword">in</span></span><br><span class="line">            <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">let</span> width <span class="operator">=</span> <span class="built_in">min</span>(geometry.size.width, geometry.size.height)</span><br><span class="line">                <span class="keyword">let</span> height <span class="operator">=</span> width <span class="operator">*</span> <span class="number">0.75</span></span><br><span class="line">                <span class="keyword">let</span> spacing <span class="operator">=</span> width <span class="operator">*</span> <span class="number">0.030</span></span><br><span class="line">                <span class="keyword">let</span> middle <span class="operator">=</span> width <span class="operator">/</span> <span class="number">2</span></span><br><span class="line">                <span class="keyword">let</span> topWidth <span class="operator">=</span> <span class="number">0.226</span> <span class="operator">*</span> width</span><br><span class="line">                <span class="keyword">let</span> topHeight <span class="operator">=</span> <span class="number">0.488</span> <span class="operator">*</span> height</span><br><span class="line">                </span><br><span class="line">                path.addLines([</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle, y: spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle <span class="operator">-</span> topWidth, y: topHeight <span class="operator">-</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle, y: topHeight <span class="operator">/</span> <span class="number">2</span> <span class="operator">+</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle <span class="operator">+</span> topWidth, y: topHeight <span class="operator">-</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle, y: spacing)</span><br><span class="line">                ])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BadgeSymbol_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">BadgeSymbol</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d4fadb1b6926aa0b920704543e3f73a53eca3e540352a8451d47b41ea0f88306/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f303864376334646534332f34653164623734382d653532622d343964662d386634652d3264636562356137303631662e706e67" alt=""></p>
<h2 id="步骤5-3">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-1"></a></p>
<p>绘制符号的底部。</p>
<p>使用<code>move(to:)</code> 修饰符在同一路径中的多个形状之间插入间隙。</p>
<blockquote>
<p>BadgeSymbol.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BadgeSymbol</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; geometry <span class="keyword">in</span></span><br><span class="line">            <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">let</span> width <span class="operator">=</span> <span class="built_in">min</span>(geometry.size.width, geometry.size.height)</span><br><span class="line">                <span class="keyword">let</span> height <span class="operator">=</span> width <span class="operator">*</span> <span class="number">0.75</span></span><br><span class="line">                <span class="keyword">let</span> spacing <span class="operator">=</span> width <span class="operator">*</span> <span class="number">0.030</span></span><br><span class="line">                <span class="keyword">let</span> middle <span class="operator">=</span> width <span class="operator">/</span> <span class="number">2</span></span><br><span class="line">                <span class="keyword">let</span> topWidth <span class="operator">=</span> <span class="number">0.226</span> <span class="operator">*</span> width</span><br><span class="line">                <span class="keyword">let</span> topHeight <span class="operator">=</span> <span class="number">0.488</span> <span class="operator">*</span> height</span><br><span class="line">                </span><br><span class="line">                path.addLines([</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle, y: spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle <span class="operator">-</span> topWidth, y: topHeight <span class="operator">-</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle, y: topHeight <span class="operator">/</span> <span class="number">2</span> <span class="operator">+</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle <span class="operator">+</span> topWidth, y: topHeight <span class="operator">-</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle, y: spacing)</span><br><span class="line">                ])</span><br><span class="line">                </span><br><span class="line">                path.move(to: <span class="type">CGPoint</span>(x: middle, y: topHeight <span class="operator">/</span> <span class="number">2</span> <span class="operator">+</span> spacing <span class="operator">*</span> <span class="number">3</span>))</span><br><span class="line">                path.addLines([</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle <span class="operator">-</span> topWidth, y: topHeight <span class="operator">+</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: spacing, y: height <span class="operator">-</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: width <span class="operator">-</span> spacing, y: height <span class="operator">-</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle <span class="operator">+</span> topWidth, y: topHeight <span class="operator">+</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle, y: topHeight <span class="operator">/</span> <span class="number">2</span> <span class="operator">+</span> spacing <span class="operator">*</span> <span class="number">3</span>)</span><br><span class="line">                ])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BadgeSymbol_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">BadgeSymbol</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/2aeb7c2c54ec4a4df93333c94e73d44e38f3d49090df9e54659f949904bcf0fd/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f313836336566373939612f38343533353366342d386161302d343661362d613235662d6539333866626132363064632e706e67" alt=""></p>
<h2 id="步骤6-3">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46-1"></a></p>
<p>用设计中的紫色填充符号。</p>
<blockquote>
<p>BadgeSymbol.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BadgeSymbol</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> symbolColor <span class="operator">=</span> <span class="type">Color</span>(red: <span class="number">79.0</span> <span class="operator">/</span> <span class="number">255</span>, green: <span class="number">79.0</span> <span class="operator">/</span> <span class="number">255</span>, blue: <span class="number">191.0</span> <span class="operator">/</span> <span class="number">255</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; geometry <span class="keyword">in</span></span><br><span class="line">            <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">let</span> width <span class="operator">=</span> <span class="built_in">min</span>(geometry.size.width, geometry.size.height)</span><br><span class="line">                <span class="keyword">let</span> height <span class="operator">=</span> width <span class="operator">*</span> <span class="number">0.75</span></span><br><span class="line">                <span class="keyword">let</span> spacing <span class="operator">=</span> width <span class="operator">*</span> <span class="number">0.030</span></span><br><span class="line">                <span class="keyword">let</span> middle <span class="operator">=</span> width <span class="operator">/</span> <span class="number">2</span></span><br><span class="line">                <span class="keyword">let</span> topWidth <span class="operator">=</span> <span class="number">0.226</span> <span class="operator">*</span> width</span><br><span class="line">                <span class="keyword">let</span> topHeight <span class="operator">=</span> <span class="number">0.488</span> <span class="operator">*</span> height</span><br><span class="line">                </span><br><span class="line">                path.addLines([</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle, y: spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle <span class="operator">-</span> topWidth, y: topHeight <span class="operator">-</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle, y: topHeight <span class="operator">/</span> <span class="number">2</span> <span class="operator">+</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle <span class="operator">+</span> topWidth, y: topHeight <span class="operator">-</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle, y: spacing)</span><br><span class="line">                ])</span><br><span class="line">                </span><br><span class="line">                path.move(to: <span class="type">CGPoint</span>(x: middle, y: topHeight <span class="operator">/</span> <span class="number">2</span> <span class="operator">+</span> spacing <span class="operator">*</span> <span class="number">3</span>))</span><br><span class="line">                path.addLines([</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle <span class="operator">-</span> topWidth, y: topHeight <span class="operator">+</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: spacing, y: height <span class="operator">-</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: width <span class="operator">-</span> spacing, y: height <span class="operator">-</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle <span class="operator">+</span> topWidth, y: topHeight <span class="operator">+</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle, y: topHeight <span class="operator">/</span> <span class="number">2</span> <span class="operator">+</span> spacing <span class="operator">*</span> <span class="number">3</span>)</span><br><span class="line">                ])</span><br><span class="line">            &#125;</span><br><span class="line">            .fill(<span class="keyword">Self</span>.symbolColor)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BadgeSymbol_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">BadgeSymbol</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/fc3faabc42bfcfce0d0a86b1b86971ce62182e10312cb36b6d8a05722fe77787/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393631363965323830662f33643161333332362d646566612d343762342d623135352d3961643734646639636464312e706e67" alt=""></p>
<h2 id="第四节-结合徽章前景和背景">第四节 结合徽章前景和背景</h2>
<p><a href="#%E7%AC%AC%E5%9B%9B%E8%8A%82-%E7%BB%93%E5%90%88%E5%BE%BD%E7%AB%A0%E5%89%8D%E6%99%AF%E5%92%8C%E8%83%8C%E6%99%AF"></a></p>
<p>徽章设计要求在徽章背景上旋转和重复多次山形。</p>
<p>定义一种新的<code>rotation</code>类型，并利用<code>ForEach</code>视图对山形的多个副本使用相同的调整。</p>
<p><img src="https://camo.githubusercontent.com/aefc19d3e0f719333604185d492ec381604058f783ada30cf5eefecc61564831/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336635623564396530312f34333233363733312d303631652d343636322d386632372d3036643731636138663030302e706e67" alt=""></p>
<h2 id="步骤1-9">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-3"></a></p>
<p>创建新的<code>RotatedBadgeSymbol</code>视图以封装旋转符号。</p>
<p><em><strong>实验</strong></em></p>
<p>调整预览中的角度以测试旋转的效果。</p>
<blockquote>
<p>RotatedBadgeSymbol.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">RotatedBadgeSymbol</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> angle: <span class="type">Angle</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">BadgeSymbol</span>()</span><br><span class="line">            .padding(<span class="operator">-</span><span class="number">60</span>)</span><br><span class="line">            .rotationEffect(angle, anchor: .bottom)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">RotatedBadgeSymbol_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">RotatedBadgeSymbol</span>(angle: .<span class="keyword">init</span>(degrees: <span class="number">5</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/ad2e99a305cefccad8c1af9625fcd5a9ff17af394400b48eb5ce888f606d07c8/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f613730626135386564302f65303339656131662d343735662d343261662d623561312d3530363365623533353838302e706e67" alt=""></p>
<h2 id="步骤2-9">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-3"></a></p>
<p>在<code>Badge.swift</code>中，将徽章的符号放置在<code>ZStack</code>中，将其放置在徽章背景上。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> badgeSymbols: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">RotatedBadgeSymbol</span>(angle: .<span class="keyword">init</span>(degrees: <span class="number">0</span>))</span><br><span class="line">            .opacity(<span class="number">0.5</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span> &#123;</span><br><span class="line">            <span class="type">BadgeBackground</span>()</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">self</span>.badgeSymbols</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/4c54668adce42a3f23ee929bbb920da390554088e0499f1118a56e3103976bee/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f636133386162363635662f61613838653861382d666339652d343332312d626666632d3134313936663561366233392e706e67" alt=""></p>
<blockquote>
<p>现在看来，徽章符号与预期的设计和背景的相对大小相比太大了。</p>
</blockquote>
<h2 id="步骤3-7">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-2"></a></p>
<p>通过读取周围的几何图形并缩放符号，更正徽章符号的大小。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> badgeSymbols: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">RotatedBadgeSymbol</span>(angle: .<span class="keyword">init</span>(degrees: <span class="number">0</span>))</span><br><span class="line">            .opacity(<span class="number">0.5</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span> &#123;</span><br><span class="line">            <span class="type">BadgeBackground</span>()</span><br><span class="line">            </span><br><span class="line">            <span class="type">GeometryReader</span> &#123; geometry <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">self</span>.badgeSymbols</span><br><span class="line">                    .scaleEffect(<span class="number">1.0</span> <span class="operator">/</span> <span class="number">4.0</span>, anchor: .top)</span><br><span class="line">                    .position(x: geometry.size.width <span class="operator">/</span> <span class="number">2.0</span>, y: (<span class="number">3.0</span> <span class="operator">/</span> <span class="number">4.0</span>) <span class="operator">*</span> geometry.size.height)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/09976e95e2403dcece078fb1844cb1507b630bb76f19daecd72b08257b4b011b/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393030343133613433662f35393537303331322d373337642d343062352d393437322d3030626431363163633066652e706e67" alt=""></p>
<h2 id="步骤4-6">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-2"></a></p>
<p>使用<code>ForEach</code>创建旋转显示多个徽章符号的副本。</p>
<p>一个完整的360°旋转分成八个部分，通过重复山脉符号创建一个类似太阳的图案。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> rotationCount <span class="operator">=</span> <span class="number">8</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> badgeSymbols: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ForEach</span>(<span class="number">0</span><span class="operator">..&lt;</span><span class="type">Badge</span>.rotationCount) &#123; i <span class="keyword">in</span></span><br><span class="line">            <span class="type">RotatedBadgeSymbol</span>(</span><br><span class="line">                angle: .degrees(<span class="type">Double</span>(i) <span class="operator">/</span> <span class="type">Double</span>(<span class="type">Badge</span>.rotationCount)) <span class="operator">*</span> <span class="number">360.0</span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">        .opacity(<span class="number">0.5</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span> &#123;</span><br><span class="line">            <span class="type">BadgeBackground</span>()</span><br><span class="line">            </span><br><span class="line">            <span class="type">GeometryReader</span> &#123; geometry <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">self</span>.badgeSymbols</span><br><span class="line">                    .scaleEffect(<span class="number">1.0</span> <span class="operator">/</span> <span class="number">4.0</span>, anchor: .top)</span><br><span class="line">                    .position(x: geometry.size.width <span class="operator">/</span> <span class="number">2.0</span>, y: (<span class="number">3.0</span> <span class="operator">/</span> <span class="number">4.0</span>) <span class="operator">*</span> geometry.size.height)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .scaledToFit()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/15ff62f5c4764fddd5e34e530ddd55baeb2c23d7db10f095d2de39e4ce090b1c/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f633266353134336336612f38656165633265312d306564652d343561332d386361382d6139376230323135653530392e706e67" alt=""></p>
<h3 id="框架集成">框架集成</h3>
<p><a href="#%E6%A1%86%E6%9E%B6%E9%9B%86%E6%88%90"></a></p>
<h2 id="与UIKit协作">与UIKit协作</h2>
<p><a href="#%E4%B8%8Euikit%E5%8D%8F%E4%BD%9C"></a></p>
<p>SwiftUI与所有苹果平台上现有的UI框架无缝协作。例如，可以将UIKit视图和视图控制器放置在SwiftUI视图中，反之亦然。</p>
<p>本教程向您展示如何将主页的特色地标转换为包装UIPageViewController和UIPageControl实例。您将使用UIPageViewController来显示SwiftUI视图的轮播，并使用状态变量和绑定来协调整个用户界面中的数据更新。</p>
<blockquote>
<p>学习时间：25分钟</p>
<p><a target="_blank" rel="noopener" href="https://docs-assets.developer.apple.com/published/189399d05e/InterfacingWithUIKit.zip">下载地址：InterfacingWithUIKit.zip</a></p>
</blockquote>
<h2 id="第一节">第一节</h2>
<p><a href="#%E7%AC%AC%E4%B8%80%E8%8A%82"></a></p>
<p>创建显示UIPageViewController的视图</p>
<p>要在SwiftUI中显示UIKit视图和视图控制器，可以创建遵守<code>UIViewRepresentable</code>和<code>UIViewControllerRepresentable</code>协议的类型，您的自定义类型创建并配置它们所表示的UIKit类型，而SwiftUI管理它们的生命周期，并在需要时更新它们。</p>
<p><img src="https://camo.githubusercontent.com/b490958db204499bec0d9227373b3866b89eacf7ce83dbde95acf21bb9f2fb88/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f303665613065303265392f34343662303334372d356462382d343131332d383638632d3661346432626538333832652e706e67" alt=""></p>
<h2 id="步骤1-10">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41"></a></p>
<p>创建一个名为<code>PageViewController.swift</code>的新SwiftUI视图文件，并声明<code>PageViewController</code>类型遵守<code>UIViewControllerRepresentable</code>。</p>
<p>页面视图控制器存储<code>UIViewController</code>实例的数组。这些是在地标之间滚动的页面。</p>
<blockquote>
<p>PageViewController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageViewController</span>: <span class="title class_ inherited__">UIViewControllerRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> controllers: [<span class="type">UIViewController</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>接下来，添加<code>UIViewControllerRepresentable</code>协议的两个方法。</p>
</blockquote>
<h2 id="步骤2-10">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42"></a></p>
<p>添加<code>makeUIViewController（context:）</code>方法，该方法创建满足需求的<code>UIPageViewController</code>。</p>
<p>SwiftUI在准备好显示视图时调用此方法一次，然后管理视图控制器的生命周期。</p>
<blockquote>
<p>PageViewController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageViewController</span>: <span class="title class_ inherited__">UIViewControllerRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> controllers: [<span class="type">UIViewController</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIViewController</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageViewController</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> pageViewController <span class="operator">=</span> <span class="type">UIPageViewController</span>(</span><br><span class="line">            transitionStyle: .scroll,</span><br><span class="line">            navigationOrientation: .horizontal)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageViewController</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤3-8">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43"></a></p>
<p>添加一个<code>updateUIViewController（_:context:）</code>方法，该方法调用<code>setViewControllers(_:direction:animated:)</code>以显示数组中的第一个视图控制器。</p>
<blockquote>
<p>PageViewController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageViewController</span>: <span class="title class_ inherited__">UIViewControllerRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> controllers: [<span class="type">UIViewController</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIViewController</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageViewController</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> pageViewController <span class="operator">=</span> <span class="type">UIPageViewController</span>(</span><br><span class="line">            transitionStyle: .scroll,</span><br><span class="line">            navigationOrientation: .horizontal)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageViewController</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIViewController</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        pageViewController.setViewControllers(</span><br><span class="line">            [controllers[<span class="number">0</span>]], direction: .forward, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>创建另一个SwiftUI视图以显示UIViewControllerRepresentable视图。</p>
</blockquote>
<h2 id="步骤4-7">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44"></a></p>
<p>创建一个名为<code>PageView.swift</code>的新SwiftUI视图文件，并更新<code>PageView</code>类型以将<code>PageViewController</code>声明为子视图。</p>
<p>注意，泛型初始值设定项接受一个视图数组，并将每个视图嵌套在<code>UIHostingController</code>中。<code>UIHostingController</code>是<code>UIViewController</code>子类，表示UIKit上下文中的SwiftUI视图。</p>
<blockquote>
<p>PageView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView</span>&lt;<span class="type">Page</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> viewControllers: [<span class="type">UIHostingController</span>&lt;<span class="type">Page</span>&gt;]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">views</span>: [<span class="type">Page</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.viewControllers <span class="operator">=</span> views.map &#123; <span class="type">UIHostingController</span>(rootView: <span class="variable">$0</span>) &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageViewController</span>(controllers: viewControllers)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤5-4">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45"></a></p>
<p>更新<code>PageView_Preview</code>以传递所需的视图数组，此时预览开始工作。</p>
<blockquote>
<p>PageView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView</span>&lt;<span class="type">Page</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> viewControllers: [<span class="type">UIHostingController</span>&lt;<span class="type">Page</span>&gt;]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">views</span>: [<span class="type">Page</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.viewControllers <span class="operator">=</span> views.map &#123; <span class="type">UIHostingController</span>(rootView: <span class="variable">$0</span>) &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageViewController</span>(controllers: viewControllers)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageView</span>(features.map &#123; <span class="type">FeatureCard</span>(landmark: <span class="variable">$0</span>) &#125;)</span><br><span class="line">            .aspectRatio(<span class="number">3</span><span class="operator">/</span><span class="number">2</span>, contentMode: .fit)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d5b9106f3812db2f0ec1daa8e138cccdc07062e87738cf859bc10dca88821760/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336432393630643539312f64323265646539662d316136622d346464372d623839652d3062363763393734316263332e706e67" alt=""></p>
<h2 id="步骤6-4">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46"></a></p>
<p>在继续下一步之前，将页面视图预览固定到画布，所有操作变化都会发生在此视图上。</p>
<p><img src="https://camo.githubusercontent.com/d38e16df8e4d7240ecca90f3c33c0e8820f34d0ccf2fb0dea6f1edb9c8391101/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f383537353364343366392f65646439346234362d366539632d343737312d383265642d3965366533326639623965632e706e67" alt=""></p>
<h2 id="第二节-创建视图控制器的数据源">第二节 创建视图控制器的数据源</h2>
<p><a href="#%E7%AC%AC%E4%BA%8C%E8%8A%82-%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE%E6%8E%A7%E5%88%B6%E5%99%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E6%BA%90"></a></p>
<p>在几个简单的步骤中，您已经完成了很多工作—<code>PageViewController</code>使用一个<code>UIPageViewController</code>在SwiftUI视图中显示内容。现在是时候让视图轮播滚动了。</p>
<p><img src="https://camo.githubusercontent.com/58608e8bf0060b71898229848d86fc96cb667132cc83a5d5e93b1747400c78ae/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f346662643636376566382f37646366333263302d336230332d346235662d383336302d6264636339306664336632332e706e67" alt=""></p>
<blockquote>
<p>代表UIKit视图控制器的SwiftUI视图可以定义一个``类型，SwiftUI将其作为可表示视图上下文的一部分进行提供和管理。</p>
</blockquote>
<h2 id="步骤1-11">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-1"></a></p>
<p>在<code>PageViewController</code>中声明嵌套的<code>Coordinator</code>类。</p>
<p>SwiftUI管理<code>UIViewControllerRepresentable</code>类型的<code>Coordinator</code>，并在调用上面创建的方法时将其作为上下文的一部分提供。</p>
<blockquote>
<p>PageViewController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageViewController</span>: <span class="title class_ inherited__">UIViewControllerRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> controllers: [<span class="type">UIViewController</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIViewController</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageViewController</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> pageViewController <span class="operator">=</span> <span class="type">UIPageViewController</span>(</span><br><span class="line">            transitionStyle: .scroll,</span><br><span class="line">            navigationOrientation: .horizontal)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageViewController</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIViewController</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        pageViewController.setViewControllers(</span><br><span class="line">            [controllers[<span class="number">0</span>]], direction: .forward, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Coordinator</span>: <span class="title class_ inherited__">NSObject</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> parent: <span class="type">PageViewController</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">PageViewController</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.parent <span class="operator">=</span> pageViewController</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d5b9106f3812db2f0ec1daa8e138cccdc07062e87738cf859bc10dca88821760/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336432393630643539312f64323265646539662d316136622d346464372d623839652d3062363763393734316263332e706e67" alt=""></p>
<h2 id="步骤2-11">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-1"></a></p>
<p>向<code>PageViewController</code>添加另一个方法以生成<code>Coordinator</code>。</p>
<p>SwiftUI在<code>makeUIViewController(context:)</code>之前调用此<code>makeCoordinator（）</code>方法，以便在配置视图控制器时可以访问<code>coordinator</code>对象。</p>
<blockquote>
<p>Tips 您可以使用这个<code>Coordinator</code>来实现常见的<code>Cocoa</code>模式，例如委托、数据源和通过<code>target-action</code>响应用户事件。</p>
</blockquote>
<blockquote>
<p>PageViewController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageViewController</span>: <span class="title class_ inherited__">UIViewControllerRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> controllers: [<span class="type">UIViewController</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeCoordinator</span>() -&gt; <span class="type">Coordinator</span> &#123;</span><br><span class="line">        <span class="type">Coordinator</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIViewController</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageViewController</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> pageViewController <span class="operator">=</span> <span class="type">UIPageViewController</span>(</span><br><span class="line">            transitionStyle: .scroll,</span><br><span class="line">            navigationOrientation: .horizontal)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageViewController</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIViewController</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        pageViewController.setViewControllers(</span><br><span class="line">            [controllers[<span class="number">0</span>]], direction: .forward, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Coordinator</span>: <span class="title class_ inherited__">NSObject</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> parent: <span class="type">PageViewController</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">PageViewController</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.parent <span class="operator">=</span> pageViewController</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d5b9106f3812db2f0ec1daa8e138cccdc07062e87738cf859bc10dca88821760/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336432393630643539312f64323265646539662d316136622d346464372d623839652d3062363763393734316263332e706e67" alt=""></p>
<h2 id="步骤3-9">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-1"></a></p>
<p>向<code>Coordinator</code>类型添加<code>UIPageViewControllerDataSource</code>一致性，并实现两个必需的方法。</p>
<p>这两个方法建立视图控制器之间的关系，以便您可以在它们之间来回滑动。</p>
<blockquote>
<p>PageViewController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageViewController</span>: <span class="title class_ inherited__">UIViewControllerRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> controllers: [<span class="type">UIViewController</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeCoordinator</span>() -&gt; <span class="type">Coordinator</span> &#123;</span><br><span class="line">        <span class="type">Coordinator</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIViewController</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageViewController</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> pageViewController <span class="operator">=</span> <span class="type">UIPageViewController</span>(</span><br><span class="line">            transitionStyle: .scroll,</span><br><span class="line">            navigationOrientation: .horizontal)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageViewController</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIViewController</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        pageViewController.setViewControllers(</span><br><span class="line">            [controllers[<span class="number">0</span>]], direction: .forward, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Coordinator</span>: <span class="title class_ inherited__">NSObject</span>, <span class="title class_ inherited__">UIPageViewControllerDataSource</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> parent: <span class="type">PageViewController</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">PageViewController</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.parent <span class="operator">=</span> pageViewController</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(</span><br><span class="line">            <span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>,</span><br><span class="line">            <span class="params">viewControllerBefore</span> <span class="params">viewController</span>: <span class="type">UIViewController</span>) -&gt; <span class="type">UIViewController</span>?</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: viewController) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> index <span class="operator">==</span> <span class="number">0</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> parent.controllers.last</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> parent.controllers[index <span class="operator">-</span> <span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(</span><br><span class="line">            <span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>,</span><br><span class="line">            <span class="params">viewControllerAfter</span> <span class="params">viewController</span>: <span class="type">UIViewController</span>) -&gt; <span class="type">UIViewController</span>?</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: viewController) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> index <span class="operator">+</span> <span class="number">1</span> <span class="operator">==</span> parent.controllers.count &#123;</span><br><span class="line">                <span class="keyword">return</span> parent.controllers.first</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> parent.controllers[index <span class="operator">+</span> <span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d5b9106f3812db2f0ec1daa8e138cccdc07062e87738cf859bc10dca88821760/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336432393630643539312f64323265646539662d316136622d346464372d623839652d3062363763393734316263332e706e67" alt=""></p>
<h2 id="步骤4-8">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-1"></a></p>
<p>将<code>coordinator</code>添加为<code>UIPageViewController</code>的数据源。</p>
<blockquote>
<p>PageViewController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageViewController</span>: <span class="title class_ inherited__">UIViewControllerRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> controllers: [<span class="type">UIViewController</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeCoordinator</span>() -&gt; <span class="type">Coordinator</span> &#123;</span><br><span class="line">        <span class="type">Coordinator</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIViewController</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageViewController</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> pageViewController <span class="operator">=</span> <span class="type">UIPageViewController</span>(</span><br><span class="line">            transitionStyle: .scroll,</span><br><span class="line">            navigationOrientation: .horizontal)</span><br><span class="line">        pageViewController.dataSource <span class="operator">=</span> context.coordinator</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageViewController</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIViewController</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        pageViewController.setViewControllers(</span><br><span class="line">            [controllers[<span class="number">0</span>]], direction: .forward, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Coordinator</span>: <span class="title class_ inherited__">NSObject</span>, <span class="title class_ inherited__">UIPageViewControllerDataSource</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> parent: <span class="type">PageViewController</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">PageViewController</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.parent <span class="operator">=</span> pageViewController</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(</span><br><span class="line">            <span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>,</span><br><span class="line">            <span class="params">viewControllerBefore</span> <span class="params">viewController</span>: <span class="type">UIViewController</span>) -&gt; <span class="type">UIViewController</span>?</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: viewController) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> index <span class="operator">==</span> <span class="number">0</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> parent.controllers.last</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> parent.controllers[index <span class="operator">-</span> <span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(</span><br><span class="line">            <span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>,</span><br><span class="line">            <span class="params">viewControllerAfter</span> <span class="params">viewController</span>: <span class="type">UIViewController</span>) -&gt; <span class="type">UIViewController</span>?</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: viewController) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> index <span class="operator">+</span> <span class="number">1</span> <span class="operator">==</span> parent.controllers.count &#123;</span><br><span class="line">                <span class="keyword">return</span> parent.controllers.first</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> parent.controllers[index <span class="operator">+</span> <span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d5b9106f3812db2f0ec1daa8e138cccdc07062e87738cf859bc10dca88821760/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336432393630643539312f64323265646539662d316136622d346464372d623839652d3062363763393734316263332e706e67" alt=""></p>
<h2 id="步骤5-5">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-1"></a></p>
<p>打开实时预览并测试滑动交互。</p>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/_p42_swipe_interactions.gif" alt=""></p>
<h2 id="第三节-在SwiftUI视图状态下跟踪页面">第三节 在SwiftUI视图状态下跟踪页面</h2>
<p><a href="#%E7%AC%AC%E4%B8%89%E8%8A%82-%E5%9C%A8swiftui%E8%A7%86%E5%9B%BE%E7%8A%B6%E6%80%81%E4%B8%8B%E8%B7%9F%E8%B8%AA%E9%A1%B5%E9%9D%A2"></a></p>
<p>要准备添加自定义<code>UIPageControl</code>，需要一种方法从<code>PageView</code>中跟踪当前页。</p>
<p>为此，您将在<code>PageView</code>中声明<code>@State</code>属性，并将对该属性的绑定传递到<code>PageViewController</code>视图。<code>PageViewController</code>更新绑定以匹配当前可见页。</p>
<p><img src="https://camo.githubusercontent.com/e92d63ed36a1d524de83d58689d504c2b2618167cffc2dd875938f3bc65159df/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f313865323661616564652f62393733393638612d633030372d343061332d613332342d6431626336383731313134622e706e67" alt=""></p>
<h2 id="步骤1-12">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-2"></a></p>
<p>首先添加一个<code>currentPage</code>绑定作为<code>PageViewController</code>的属性。</p>
<p>除了声明<code>@Binding</code>属性外，还要更新对<code>setViewControllers（u:direction:animated:）</code>的调用，传递<code>currentPage</code>绑定的值。</p>
<blockquote>
<p>PageViewController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageViewController</span>: <span class="title class_ inherited__">UIViewControllerRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> controllers: [<span class="type">UIViewController</span>]</span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> currentPage: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeCoordinator</span>() -&gt; <span class="type">Coordinator</span> &#123;</span><br><span class="line">        <span class="type">Coordinator</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIViewController</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageViewController</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> pageViewController <span class="operator">=</span> <span class="type">UIPageViewController</span>(</span><br><span class="line">            transitionStyle: .scroll,</span><br><span class="line">            navigationOrientation: .horizontal)</span><br><span class="line">        pageViewController.dataSource <span class="operator">=</span> context.coordinator</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageViewController</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIViewController</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        pageViewController.setViewControllers(</span><br><span class="line">            [controllers[currentPage]], direction: .forward, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Coordinator</span>: <span class="title class_ inherited__">NSObject</span>, <span class="title class_ inherited__">UIPageViewControllerDataSource</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> parent: <span class="type">PageViewController</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">PageViewController</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.parent <span class="operator">=</span> pageViewController</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(</span><br><span class="line">            <span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>,</span><br><span class="line">            <span class="params">viewControllerBefore</span> <span class="params">viewController</span>: <span class="type">UIViewController</span>) -&gt; <span class="type">UIViewController</span>?</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: viewController) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> index <span class="operator">==</span> <span class="number">0</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> parent.controllers.last</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> parent.controllers[index <span class="operator">-</span> <span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(</span><br><span class="line">            <span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>,</span><br><span class="line">            <span class="params">viewControllerAfter</span> <span class="params">viewController</span>: <span class="type">UIViewController</span>) -&gt; <span class="type">UIViewController</span>?</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: viewController) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> index <span class="operator">+</span> <span class="number">1</span> <span class="operator">==</span> parent.controllers.count &#123;</span><br><span class="line">                <span class="keyword">return</span> parent.controllers.first</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> parent.controllers[index <span class="operator">+</span> <span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d5b9106f3812db2f0ec1daa8e138cccdc07062e87738cf859bc10dca88821760/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336432393630643539312f64323265646539662d316136622d346464372d623839652d3062363763393734316263332e706e67" alt=""></p>
<h2 id="步骤2-12">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-2"></a></p>
<p>在<code>PageView</code>中声明<code>@State</code>变量，并在创建子<code>PageViewController</code>时向属性传递绑定。</p>
<p><strong>重要</strong></p>
<p>请记住使用<code>$</code>语法创建用状态来存储值的绑定。</p>
<blockquote>
<p>PageView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView</span>&lt;<span class="type">Page</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> viewControllers: [<span class="type">UIHostingController</span>&lt;<span class="type">Page</span>&gt;]</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> currentPage <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">views</span>: [<span class="type">Page</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.viewControllers <span class="operator">=</span> views.map &#123; <span class="type">UIHostingController</span>(rootView: <span class="variable">$0</span>) &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageViewController</span>(controllers: viewControllers, currentPage: <span class="variable">$currentPage</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageView</span>(features.map &#123; <span class="type">FeatureCard</span>(landmark: <span class="variable">$0</span>) &#125;)</span><br><span class="line">            .aspectRatio(<span class="number">3</span><span class="operator">/</span><span class="number">2</span>, contentMode: .fit)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d5b9106f3812db2f0ec1daa8e138cccdc07062e87738cf859bc10dca88821760/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336432393630643539312f64323265646539662d316136622d346464372d623839652d3062363763393734316263332e706e67" alt=""></p>
<h2 id="步骤3-10">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-2"></a></p>
<p>通过更改<code>PageViewController</code>的初始值，测试该值是否通过绑定流向<code>PageViewController</code>。</p>
<blockquote>
<p>PageView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView</span>&lt;<span class="type">Page</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> viewControllers: [<span class="type">UIHostingController</span>&lt;<span class="type">Page</span>&gt;]</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> currentPage <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">views</span>: [<span class="type">Page</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.viewControllers <span class="operator">=</span> views.map &#123; <span class="type">UIHostingController</span>(rootView: <span class="variable">$0</span>) &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageViewController</span>(controllers: viewControllers, currentPage: <span class="variable">$currentPage</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageView</span>(features.map &#123; <span class="type">FeatureCard</span>(landmark: <span class="variable">$0</span>) &#125;)</span><br><span class="line">            .aspectRatio(<span class="number">3</span><span class="operator">/</span><span class="number">2</span>, contentMode: .fit)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><em>实验</em>：向<code>PageView</code>添加一个按钮，使<code>PageViewController</code>跳转到第二个视图。</p>
</blockquote>
<blockquote>
<p>PageView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView</span>&lt;<span class="type">Page</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> viewControllers: [<span class="type">UIHostingController</span>&lt;<span class="type">Page</span>&gt;]</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> currentPage <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">views</span>: [<span class="type">Page</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.viewControllers <span class="operator">=</span> views.map &#123; <span class="type">UIHostingController</span>(rootView: <span class="variable">$0</span>) &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageViewController</span>(controllers: viewControllers, currentPage: <span class="variable">$currentPage</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageView</span>(features.map &#123; <span class="type">FeatureCard</span>(landmark: <span class="variable">$0</span>) &#125;)</span><br><span class="line">            .aspectRatio(<span class="number">3</span><span class="operator">/</span><span class="number">2</span>, contentMode: .fit)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/5209c189ff1a2699c690fb8575e8b907bf5fe16b9e2e98c50af4627556b2b21b/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f373430303064653136322f37633136356330632d326330312d343633322d626339322d6634356566333135663634332e706e67" alt=""></p>
<h2 id="步骤4-9">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-2"></a></p>
<p>添加一个带有<code>currentPage</code>属性的文本视图，这样您就可以监视<code>@State</code>属性的值。</p>
<p>请注意，当您从一页刷到另一页时，值不会改变。</p>
<blockquote>
<p>PageView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView</span>&lt;<span class="type">Page</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> viewControllers: [<span class="type">UIHostingController</span>&lt;<span class="type">Page</span>&gt;]</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> currentPage <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">views</span>: [<span class="type">Page</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.viewControllers <span class="operator">=</span> views.map &#123; <span class="type">UIHostingController</span>(rootView: <span class="variable">$0</span>) &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">PageViewController</span>(controllers: viewControllers, currentPage: <span class="variable">$currentPage</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Current Page: <span class="subst">\(currentPage)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageView</span>(features.map &#123; <span class="type">FeatureCard</span>(landmark: <span class="variable">$0</span>) &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d5b9106f3812db2f0ec1daa8e138cccdc07062e87738cf859bc10dca88821760/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336432393630643539312f64323265646539662d316136622d346464372d623839652d3062363763393734316263332e706e67" alt=""></p>
<h2 id="步骤5-6">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-2"></a></p>
<blockquote>
<p>在<code>PageViewController.swift</code>中，将协调器设置为<code>UIPageViewControllerDelegate</code>，并添加<code>pageViewController(_:didFinishAnimating:previousViewControllers:transitionCompleted completed: Bool)</code> 方法。</p>
</blockquote>
<p>由于SwiftUI在页面切换动画完成时调用此方法，因此可以找到当前视图控制器的索引并更新绑定。</p>
<blockquote>
<p>PageViewController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageViewController</span>: <span class="title class_ inherited__">UIViewControllerRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> controllers: [<span class="type">UIViewController</span>]</span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> currentPage: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeCoordinator</span>() -&gt; <span class="type">Coordinator</span> &#123;</span><br><span class="line">        <span class="type">Coordinator</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIViewController</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageViewController</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> pageViewController <span class="operator">=</span> <span class="type">UIPageViewController</span>(</span><br><span class="line">            transitionStyle: .scroll,</span><br><span class="line">            navigationOrientation: .horizontal)</span><br><span class="line">        pageViewController.dataSource <span class="operator">=</span> context.coordinator</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageViewController</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIViewController</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        pageViewController.setViewControllers(</span><br><span class="line">            [controllers[currentPage]], direction: .forward, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Coordinator</span>: <span class="title class_ inherited__">NSObject</span>, <span class="title class_ inherited__">UIPageViewControllerDataSource</span>, <span class="title class_ inherited__">UIPageViewControllerDelegate</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> parent: <span class="type">PageViewController</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">PageViewController</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.parent <span class="operator">=</span> pageViewController</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(</span><br><span class="line">            <span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>,</span><br><span class="line">            <span class="params">viewControllerBefore</span> <span class="params">viewController</span>: <span class="type">UIViewController</span>) -&gt; <span class="type">UIViewController</span>?</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: viewController) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> index <span class="operator">==</span> <span class="number">0</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> parent.controllers.last</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> parent.controllers[index <span class="operator">-</span> <span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(</span><br><span class="line">            <span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>,</span><br><span class="line">            <span class="params">viewControllerAfter</span> <span class="params">viewController</span>: <span class="type">UIViewController</span>) -&gt; <span class="type">UIViewController</span>?</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: viewController) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> index <span class="operator">+</span> <span class="number">1</span> <span class="operator">==</span> parent.controllers.count &#123;</span><br><span class="line">                <span class="keyword">return</span> parent.controllers.first</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> parent.controllers[index <span class="operator">+</span> <span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>, <span class="params">didFinishAnimating</span> <span class="params">finished</span>: <span class="type">Bool</span>, <span class="params">previousViewControllers</span>: [<span class="type">UIViewController</span>], <span class="params">transitionCompleted</span> <span class="params">completed</span>: <span class="type">Bool</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> completed,</span><br><span class="line">                <span class="keyword">let</span> visibleViewController <span class="operator">=</span> pageViewController.viewControllers<span class="operator">?</span>.first,</span><br><span class="line">                <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: visibleViewController)</span><br><span class="line">            &#123;</span><br><span class="line">                parent.currentPage <span class="operator">=</span> index</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d5b9106f3812db2f0ec1daa8e138cccdc07062e87738cf859bc10dca88821760/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336432393630643539312f64323265646539662d316136622d346464372d623839652d3062363763393734316263332e706e67" alt=""></p>
<h2 id="步骤6-5">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46-1"></a></p>
<p>除了<code>dataSource</code>之外，还将<code>coordinator</code>指定为<code>UIPageViewController</code>的委托。</p>
<p>当在两个方向上连接绑定后，文本视图会在每次刷新后更新以显示正确的页码。</p>
<blockquote>
<p>PageViewController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageViewController</span>: <span class="title class_ inherited__">UIViewControllerRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> controllers: [<span class="type">UIViewController</span>]</span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> currentPage: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeCoordinator</span>() -&gt; <span class="type">Coordinator</span> &#123;</span><br><span class="line">        <span class="type">Coordinator</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIViewController</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageViewController</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> pageViewController <span class="operator">=</span> <span class="type">UIPageViewController</span>(</span><br><span class="line">            transitionStyle: .scroll,</span><br><span class="line">            navigationOrientation: .horizontal)</span><br><span class="line">        pageViewController.dataSource <span class="operator">=</span> context.coordinator</span><br><span class="line">        pageViewController.delegate <span class="operator">=</span> context.coordinator</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageViewController</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIViewController</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        pageViewController.setViewControllers(</span><br><span class="line">            [controllers[currentPage]], direction: .forward, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Coordinator</span>: <span class="title class_ inherited__">NSObject</span>, <span class="title class_ inherited__">UIPageViewControllerDataSource</span>, <span class="title class_ inherited__">UIPageViewControllerDelegate</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> parent: <span class="type">PageViewController</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">PageViewController</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.parent <span class="operator">=</span> pageViewController</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(</span><br><span class="line">            <span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>,</span><br><span class="line">            <span class="params">viewControllerBefore</span> <span class="params">viewController</span>: <span class="type">UIViewController</span>) -&gt; <span class="type">UIViewController</span>?</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: viewController) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> index <span class="operator">==</span> <span class="number">0</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> parent.controllers.last</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> parent.controllers[index <span class="operator">-</span> <span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(</span><br><span class="line">            <span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>,</span><br><span class="line">            <span class="params">viewControllerAfter</span> <span class="params">viewController</span>: <span class="type">UIViewController</span>) -&gt; <span class="type">UIViewController</span>?</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: viewController) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> index <span class="operator">+</span> <span class="number">1</span> <span class="operator">==</span> parent.controllers.count &#123;</span><br><span class="line">                <span class="keyword">return</span> parent.controllers.first</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> parent.controllers[index <span class="operator">+</span> <span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>, <span class="params">didFinishAnimating</span> <span class="params">finished</span>: <span class="type">Bool</span>, <span class="params">previousViewControllers</span>: [<span class="type">UIViewController</span>], <span class="params">transitionCompleted</span> <span class="params">completed</span>: <span class="type">Bool</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> completed,</span><br><span class="line">                <span class="keyword">let</span> visibleViewController <span class="operator">=</span> pageViewController.viewControllers<span class="operator">?</span>.first,</span><br><span class="line">                <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: visibleViewController)</span><br><span class="line">            &#123;</span><br><span class="line">                parent.currentPage <span class="operator">=</span> index</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d5b9106f3812db2f0ec1daa8e138cccdc07062e87738cf859bc10dca88821760/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336432393630643539312f64323265646539662d316136622d346464372d623839652d3062363763393734316263332e706e67" alt=""></p>
<h2 id="第四节-添加自定义分页控件">第四节 添加自定义分页控件</h2>
<p><a href="#%E7%AC%AC%E5%9B%9B%E8%8A%82-%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E9%A1%B5%E6%8E%A7%E4%BB%B6"></a></p>
<p>您已经准备好向视图中添加自定义<code>UIPageControl</code>，该控件包装在<code>SwiftUI</code>的<code>UIViewRepresentable</code>视图中。</p>
<p><img src="https://camo.githubusercontent.com/f33ce41b76a653d0786dee35b95351c06aee07e52f96da2ed4b11e6dd03d08de/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663632393031346637642f64613532303662612d383137642d346136362d623538622d3861363438303466383261342e706e67" alt=""></p>
<h2 id="步骤1-13">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-3"></a></p>
<p>创建一个新的SwiftUI视图文件，名为<code>PageControl.swift</code>。更新<code>PageControl</code>类型以遵守<code>UIViewRepresentable</code>协议。</p>
<p><code>UIViewRepresentable</code>和<code>UIViewControllerRepresentable</code>类型具有相同的生命周期，其方法与其基础的UIKit类型相对应。</p>
<blockquote>
<p>PageControl.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageControl</span>: <span class="title class_ inherited__">UIViewRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> numberOfPages: <span class="type">Int</span></span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> currentPage: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIView</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageControl</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> control <span class="operator">=</span> <span class="type">UIPageControl</span>()</span><br><span class="line">        control.numberOfPages <span class="operator">=</span> numberOfPages</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> control</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIView</span>(<span class="keyword">_</span> <span class="params">uiView</span>: <span class="type">UIPageControl</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        uiView.currentPage <span class="operator">=</span> currentPage</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/7464ce9d51ebc401e2d0aac2ce39d500dfb446199ff6c790fdb956a9ad014014/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f633239636166623832652f30386636656331392d393565322d346662372d623735652d6164623437306466363234392e706e67" alt=""></p>
<h2 id="步骤2-13">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-3"></a></p>
<p>将文本框替换为<code>PageControl</code>，从<code>VStack</code>切换到<code>ZStack</code>进行布局。</p>
<p>因为我们正在讲页数和绑定传递到当前页，所以<code>PageControl</code>已显示正确的值。</p>
<blockquote>
<p>PageView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView</span>&lt;<span class="type">Page</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> viewControllers: [<span class="type">UIHostingController</span>&lt;<span class="type">Page</span>&gt;]</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> currentPage <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">views</span>: [<span class="type">Page</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.viewControllers <span class="operator">=</span> views.map &#123; <span class="type">UIHostingController</span>(rootView: <span class="variable">$0</span>) &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span>(alignment: .bottomTrailing) &#123;</span><br><span class="line">            <span class="type">PageViewController</span>(controllers: viewControllers, currentPage: <span class="variable">$currentPage</span>)</span><br><span class="line">            <span class="type">PageControl</span>(numberOfPages: viewControllers.count, currentPage: <span class="variable">$currentPage</span>)</span><br><span class="line">                .padding(.trailing)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageView</span>(features.map &#123; <span class="type">FeatureCard</span>(landmark: <span class="variable">$0</span>) &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>下一步，让<code>PageControl</code>交互，这样用户可以点击一边或另一边时，页面可以随之滚动。</p>
</blockquote>
<h2 id="步骤3-11">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-3"></a></p>
<p>在<code>PageControl</code>中创建嵌套的<code>Coordinator</code>类型，并添加<code>makeCoordinator（）</code>方法以创建并返回新的协调器。</p>
<p>由于<code>UIPageControl</code>是<code>UIControl</code>子类，故使用<code>target-action</code>模式而不是代理，所以此<code>Coordinator</code>实现<code>@objc</code>方法来更新 <code>current page</code>的绑定。</p>
<blockquote>
<p>PageControl.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageControl</span>: <span class="title class_ inherited__">UIViewRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> numberOfPages: <span class="type">Int</span></span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> currentPage: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeCoordinator</span>() -&gt; <span class="type">Coordinator</span> &#123;</span><br><span class="line">        <span class="type">Coordinator</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIView</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageControl</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> control <span class="operator">=</span> <span class="type">UIPageControl</span>()</span><br><span class="line">        control.numberOfPages <span class="operator">=</span> numberOfPages</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> control</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIView</span>(<span class="keyword">_</span> <span class="params">uiView</span>: <span class="type">UIPageControl</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        uiView.currentPage <span class="operator">=</span> currentPage</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Coordinator</span>: <span class="title class_ inherited__">NSObject</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> control: <span class="type">PageControl</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">control</span>: <span class="type">PageControl</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.control <span class="operator">=</span> control</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">updateCurrentPage</span>(<span class="params">sender</span>: <span class="type">UIPageControl</span>) &#123;</span><br><span class="line">            control.currentPage <span class="operator">=</span> sender.currentPage</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/499680b5bed8b1d8fe20a72857fc639a7c34c58b6e206f786702564aa0eb7b69/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f623035623264353538382f33306162333238352d316336312d343961362d393133612d3537383263303033613731342e706e67" alt=""></p>
<h2 id="步骤4-10">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-3"></a></p>
<p>将<code>Coordinator</code>添加为<code>valueChanged</code>事件的目标，指定<code>updateCurrentPage（sender:）</code>方法作为要执行的操作。</p>
<blockquote>
<p>PageControl.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageControl</span>: <span class="title class_ inherited__">UIViewRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> numberOfPages: <span class="type">Int</span></span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> currentPage: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeCoordinator</span>() -&gt; <span class="type">Coordinator</span> &#123;</span><br><span class="line">        <span class="type">Coordinator</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIView</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageControl</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> control <span class="operator">=</span> <span class="type">UIPageControl</span>()</span><br><span class="line">        control.numberOfPages <span class="operator">=</span> numberOfPages</span><br><span class="line">        control.addTarget(</span><br><span class="line">            context.coordinator,</span><br><span class="line">            action: <span class="keyword">#selector</span>(<span class="type">Coordinator</span>.updateCurrentPage(sender:)),</span><br><span class="line">            for: .valueChanged)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> control</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIView</span>(<span class="keyword">_</span> <span class="params">uiView</span>: <span class="type">UIPageControl</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        uiView.currentPage <span class="operator">=</span> currentPage</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Coordinator</span>: <span class="title class_ inherited__">NSObject</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> control: <span class="type">PageControl</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">control</span>: <span class="type">PageControl</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.control <span class="operator">=</span> control</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">updateCurrentPage</span>(<span class="params">sender</span>: <span class="type">UIPageControl</span>) &#123;</span><br><span class="line">            control.currentPage <span class="operator">=</span> sender.currentPage</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/499680b5bed8b1d8fe20a72857fc639a7c34c58b6e206f786702564aa0eb7b69/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f623035623264353538382f33306162333238352d316336312d343961362d393133612d3537383263303033613731342e706e67" alt=""></p>
<h2 id="步骤5-7">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-3"></a></p>
<p>现在尝试所有不同的交互，<code>PageView</code>展示了UIKit和SwiftUI视图以及控制器是如何协同工作的。</p>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/_p42_all_interactions.gif" alt=""></p>
<h3 id="绘图和动画-2">绘图和动画</h3>
<p><a href="#%E7%BB%98%E5%9B%BE%E5%92%8C%E5%8A%A8%E7%94%BB"></a></p>
<h2 id="视图动画和转场">视图动画和转场</h2>
<p><a href="#%E8%A7%86%E5%9B%BE%E5%8A%A8%E7%94%BB%E5%92%8C%E8%BD%AC%E5%9C%BA"></a></p>
<p>使用SwiftUI时，无论效果在哪里，都可以对视图或视图状态的更改单独设置动画。SwiftUI负责处理这些组合、重叠和可中断动画的所有复杂性。</p>
<p>在本教程中，您将设置一个视图的动画，该视图包含一个图形，用于跟踪用户在使用Landmarks应用程序时的行为数据。使用<code>animation(_:)</code>修改器，您将看到设置视图动画是多么容易。</p>
<blockquote>
<p>学习时间：25分钟</p>
<p><a target="_blank" rel="noopener" href="https://docs-assets.developer.apple.com/published/6178892d17/AnimatingViewsAndTransitions.zip">下载地址：AnimatingViewsAndTransitions.zip</a></p>
</blockquote>
<h2 id="第一节-向各个视图添加动画">第一节 向各个视图添加动画</h2>
<p><a href="#%E7%AC%AC%E4%B8%80%E8%8A%82-%E5%90%91%E5%90%84%E4%B8%AA%E8%A7%86%E5%9B%BE%E6%B7%BB%E5%8A%A0%E5%8A%A8%E7%94%BB"></a></p>
<p>在视图上使用<code>animation(_:)</code>修改器时，SwiftUI可以改变视图的任何<code>animatable(可动画)</code>属性。视图的颜色<code>color</code>、不透明度<code>opacity</code>、旋转<code>rotation</code>、大小<code>size</code>和其他属性都是可设置动画的。</p>
<p><img src="https://camo.githubusercontent.com/4d317f89cbe2df435bdf2ec9dcf6fba88a4a0e63b6a15e6b5c6aed225f19c72f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f333362343064383539382f38376536316239342d306237302d343739632d616630622d6232326636356636366430342e706e67" alt=""></p>
<h2 id="步骤1-14">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41"></a></p>
<p>在<code>HikeView.swift</code>中，打开实时预览并尝试显示和隐藏图形。</p>
<p>请确保在本教程中使用实时预览，以便您可以尝试每个步骤的结果。</p>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/_p22_explore-no-animations.gif" alt=""></p>
<h2 id="步骤2-14">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42"></a></p>
<p>通过添加<code>animation(.easeInOut())</code>为按钮启用旋转动画。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line">                        .padding()</span><br><span class="line">                        .animation(.easeInOut())</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/41d0296155e0de9ae8880dc2a8cb8726e5becbc41e1220ee5fb5c7b0573c553f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663438633038343036392f65656233336165662d326664342d343139312d383966392d3739383034316635656632302e706e67" alt=""></p>
<h2 id="步骤3-12">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43"></a></p>
<p>当图形可见时，添加一个让按钮变大的动画。</p>
<p><code>animation(_:)</code>修饰符将应用于其包装的视图中所有可动画的更改。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line">                        .scaleEffect(showDetail <span class="operator">?</span> <span class="number">1.5</span> : <span class="number">1</span>)</span><br><span class="line">                        .padding()</span><br><span class="line">                        .animation(.easeInOut())</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/41d0296155e0de9ae8880dc2a8cb8726e5becbc41e1220ee5fb5c7b0573c553f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663438633038343036392f65656233336165662d326664342d343139312d383966392d3739383034316635656632302e706e67" alt=""></p>
<h2 id="步骤4-11">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44"></a></p>
<p>将动画类型从<code>easeInOut（）</code>更改为<code>spring（）</code>。</p>
<p>SwiftUI包括预定义或自定义宽松的基本动画，以及弹簧和流体动画。可以调整动画的速度、在动画开始之前设置延迟或指定动画重复。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line">                        .scaleEffect(showDetail <span class="operator">?</span> <span class="number">1.5</span> : <span class="number">1</span>)</span><br><span class="line">                        .padding()</span><br><span class="line">                        .animation(.spring())</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/41d0296155e0de9ae8880dc2a8cb8726e5becbc41e1220ee5fb5c7b0573c553f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663438633038343036392f65656233336165662d326664342d343139312d383966392d3739383034316635656632302e706e67" alt=""></p>
<h2 id="步骤5-8">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45"></a></p>
<p>尝试通过在<code>scaleEffect</code>修改器的正上方添加另一个动画修改器来关闭旋转的动画。</p>
<p><em><strong>实验</strong></em></p>
<p>围绕SwiftUI尝试组合不同的动画效果，看看有什么不同的效果。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line">                        .animation(<span class="literal">nil</span>)</span><br><span class="line">                        .scaleEffect(showDetail <span class="operator">?</span> <span class="number">1.5</span> : <span class="number">1</span>)</span><br><span class="line">                        .padding()</span><br><span class="line">                        .animation(.spring())</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/41d0296155e0de9ae8880dc2a8cb8726e5becbc41e1220ee5fb5c7b0573c553f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663438633038343036392f65656233336165662d326664342d343139312d383966392d3739383034316635656632302e706e67" alt=""></p>
<h2 id="步骤6-6">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46"></a></p>
<p>在转到下一节之前，请删除两个动画（:）修改器。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">                        .scaleEffect(showDetail <span class="operator">?</span> <span class="number">1.5</span> : <span class="number">1</span>)</span><br><span class="line">                        .padding()</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/41d0296155e0de9ae8880dc2a8cb8726e5becbc41e1220ee5fb5c7b0573c553f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663438633038343036392f65656233336165662d326664342d343139312d383966392d3739383034316635656632302e706e67" alt=""></p>
<h2 id="第二节-使状态的改变产生动画效果">第二节 使状态的改变产生动画效果</h2>
<p><a href="#%E7%AC%AC%E4%BA%8C%E8%8A%82-%E4%BD%BF%E7%8A%B6%E6%80%81%E7%9A%84%E6%94%B9%E5%8F%98%E4%BA%A7%E7%94%9F%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C"></a></p>
<p>既然您已经学习了如何将动画应用于各个视图，现在是时候在更改状态值的位置添加动画了。</p>
<p>在这里，您将对用户点击按钮并切换<code>showDetail</code>属性时发生的所有更改添加动画。</p>
<p><img src="https://camo.githubusercontent.com/d4134b5708c1d69b362a440bbd9b9dc86f10a28b1fe4e4a582ef3a10439a584c/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336631323963663163392f37343633316630312d393438622d343030322d383034342d3165623063343531393465322e706e67" alt=""></p>
<h2 id="步骤1-15">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-1"></a></p>
<p>用<code>withAnimation</code>函数包装<code>showDetail.toggle（）</code>的调用。</p>
<p>受<code>showDetail</code>属性影响的两个视图（<code>disclosure</code>按钮和<code>HikeDetail</code>视图）现在都具有动画过渡。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    withAnimation &#123;</span><br><span class="line">                        <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line">                        .scaleEffect(showDetail <span class="operator">?</span> <span class="number">1.5</span> : <span class="number">1</span>)</span><br><span class="line">                        .padding()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/41d0296155e0de9ae8880dc2a8cb8726e5becbc41e1220ee5fb5c7b0573c553f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663438633038343036392f65656233336165662d326664342d343139312d383966392d3739383034316635656632302e706e67" alt=""></p>
<blockquote>
<p>减慢动画的速度，以查看SwiftUI动画是如何中断的。</p>
</blockquote>
<h2 id="步骤2-15">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-1"></a></p>
<p>将4秒长的基本动画传递给<code>withAnimation</code>函数。</p>
<p>可以传递相同类型的动画给给<code>animation（:）</code>修饰符的<code>withAnimation</code>函数。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    withAnimation(.easeInOut(duration: <span class="number">4</span>)) &#123;</span><br><span class="line">                        <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line">                        .scaleEffect(showDetail <span class="operator">?</span> <span class="number">1.5</span> : <span class="number">1</span>)</span><br><span class="line">                        .padding()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤3-13">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-1"></a></p>
<p>尝试在动画中打开和关闭图形视图。</p>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/_p22_slow-animation.gif" alt=""></p>
<h2 id="步骤4-12">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-1"></a></p>
<p>在继续下一节之前，请从<code>withAnimation</code>函数调用中删除慢速动画。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    withAnimation &#123;</span><br><span class="line">                        <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line">                        .scaleEffect(showDetail <span class="operator">?</span> <span class="number">1.5</span> : <span class="number">1</span>)</span><br><span class="line">                        .padding()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="第三节-自定义视图转场">第三节 自定义视图转场</h2>
<p><a href="#%E7%AC%AC%E4%B8%89%E8%8A%82-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A7%86%E5%9B%BE%E8%BD%AC%E5%9C%BA"></a></p>
<p>默认情况下，视图通过淡入淡出在屏幕内外切换。您可以使用<code>transition（:）</code>修饰符自定义此转场。</p>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/customize-view-transitions.gif" alt=""></p>
<h2 id="步骤1-16">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-2"></a></p>
<p>向条件可见的<code>HikeView</code>添加一个<code>transition(_:)</code>修饰符。</p>
<p>现在，图形通过滑动进入和退出视线而出现和消失。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    withAnimation &#123;</span><br><span class="line">                        <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line">                        .scaleEffect(showDetail <span class="operator">?</span> <span class="number">1.5</span> : <span class="number">1</span>)</span><br><span class="line">                        .padding()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">                    .transition(.slide)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/41d0296155e0de9ae8880dc2a8cb8726e5becbc41e1220ee5fb5c7b0573c553f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663438633038343036392f65656233336165662d326664342d343139312d383966392d3739383034316635656632302e706e67" alt=""></p>
<h2 id="步骤2-16">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-2"></a></p>
<p>将转场提取为<code>AnyTransition</code>的静态属性。</p>
<p>这将在展开自定义转场时保持代码的干净。对于自定义转换，您可以使用与SwiftUI相同的<code>.</code>语法。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">AnyTransition</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> moveAndFade: <span class="type">AnyTransition</span> &#123;</span><br><span class="line">        <span class="type">AnyTransition</span>.slide</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    withAnimation &#123;</span><br><span class="line">                        <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line">                        .scaleEffect(showDetail <span class="operator">?</span> <span class="number">1.5</span> : <span class="number">1</span>)</span><br><span class="line">                        .padding()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">                    .transition(.moveAndFade)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤3-14">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-2"></a></p>
<p>切换到使用<code>move(edge:)</code> 转场，以便图形从同一侧滑入和滑出。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">AnyTransition</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> moveAndFade: <span class="type">AnyTransition</span> &#123;</span><br><span class="line">        <span class="type">AnyTransition</span>.move(edge: .trailing)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    withAnimation &#123;</span><br><span class="line">                        <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line">                        .scaleEffect(showDetail <span class="operator">?</span> <span class="number">1.5</span> : <span class="number">1</span>)</span><br><span class="line">                        .padding()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">                    .transition(.moveAndFade)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤4-13">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-2"></a></p>
<p>使用<code>asymmetric(insertion:removal:)</code>（不对称）修饰符在视图出现和消失时提供不同的过渡。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">AnyTransition</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> moveAndFade: <span class="type">AnyTransition</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> insertion <span class="operator">=</span> <span class="type">AnyTransition</span>.move(edge: .trailing)</span><br><span class="line">            .combined(with: .opacity)</span><br><span class="line">        <span class="keyword">let</span> removal <span class="operator">=</span> <span class="type">AnyTransition</span>.scale</span><br><span class="line">            .combined(with: .opacity)</span><br><span class="line">        <span class="keyword">return</span> .asymmetric(insertion: insertion, removal: removal)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    withAnimation &#123;</span><br><span class="line">                        <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line">                        .scaleEffect(showDetail <span class="operator">?</span> <span class="number">1.5</span> : <span class="number">1</span>)</span><br><span class="line">                        .padding()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">                    .transition(.moveAndFade)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="第四节-为复杂效果撰写动画">第四节 为复杂效果撰写动画</h2>
<p><a href="#%E7%AC%AC%E5%9B%9B%E8%8A%82-%E4%B8%BA%E5%A4%8D%E6%9D%82%E6%95%88%E6%9E%9C%E6%92%B0%E5%86%99%E5%8A%A8%E7%94%BB"></a></p>
<p>单击栏下方的按钮时，图形将在三组不同的数据之间切换。在本节中，将使用组合动画为构成图形的胶囊提供动态、波动的转场动画。</p>
<p><img src="https://camo.githubusercontent.com/ea7f48d85067ec682b91b09b3d5670af26ad117a65f2bb78dece50eaced4ba99/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f363232323031646265302f66306462643666652d653337332d343835662d393636622d3136343161383032663338302e706e67" alt=""></p>
<h2 id="步骤1-17">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-3"></a></p>
<blockquote>
<p>将<code>showDetail</code>的默认值更改为true，并将<code>HikeView</code>预览锁定到画布。</p>
</blockquote>
<p>这使您在另一个文件中处理动画时依然可以在上下文中看到图表。</p>
<p><img src="https://camo.githubusercontent.com/cf94f22dc3bed82f642f4fd9f35f7a3ac0cd46625a55809cbe67112a51b33280/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f633363366636646338312f38333866316334392d353838392d343137622d613539302d6662613564643464323662642e706e67" alt=""></p>
<h2 id="步骤2-17">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-3"></a></p>
<p>在<code>GraphCapsule.swift</code>中，添加新的计算动画属性，并将其应用于胶囊形状。</p>
<blockquote>
<p>GraphCapsule.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">GraphCapsule</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> index: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> height: <span class="type">CGFloat</span></span><br><span class="line">    <span class="keyword">var</span> range: <span class="type">Range</span>&lt;<span class="type">Double</span>&gt;</span><br><span class="line">    <span class="keyword">var</span> overallRange: <span class="type">Range</span>&lt;<span class="type">Double</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> heightRatio: <span class="type">CGFloat</span> &#123;</span><br><span class="line">        <span class="built_in">max</span>(<span class="type">CGFloat</span>(magnitude(of: range) <span class="operator">/</span> magnitude(of: overallRange)), <span class="number">0.15</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> offsetRatio: <span class="type">CGFloat</span> &#123;</span><br><span class="line">        <span class="type">CGFloat</span>((range.lowerBound <span class="operator">-</span> overallRange.lowerBound) <span class="operator">/</span> magnitude(of: overallRange))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> animation: <span class="type">Animation</span> &#123;</span><br><span class="line">        <span class="type">Animation</span>.default</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Capsule</span>()</span><br><span class="line">            .fill(<span class="type">Color</span>.gray)</span><br><span class="line">            .frame(height: height <span class="operator">*</span> heightRatio, alignment: .bottom)</span><br><span class="line">            .offset(x: <span class="number">0</span>, y: height <span class="operator">*</span> <span class="operator">-</span>offsetRatio)</span><br><span class="line">            .animation(animation)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/5f732633cd0acac70f2f06525fd970ddd7a86d559e62e3b94aaca2d45ccf4cc6/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f386333376331393866632f30316330383331362d623439652d346132382d386431342d6533306365323763646337372e706e67" alt=""></p>
<h2 id="步骤3-15">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-3"></a></p>
<p>将动画切换为弹簧动画<code>spring</code>，减少阻尼部分<code>dampingFraction</code>以使条形可以跳跃。</p>
<blockquote>
<p>GraphCapsule.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">GraphCapsule</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> index: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> height: <span class="type">CGFloat</span></span><br><span class="line">    <span class="keyword">var</span> range: <span class="type">Range</span>&lt;<span class="type">Double</span>&gt;</span><br><span class="line">    <span class="keyword">var</span> overallRange: <span class="type">Range</span>&lt;<span class="type">Double</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> heightRatio: <span class="type">CGFloat</span> &#123;</span><br><span class="line">        <span class="built_in">max</span>(<span class="type">CGFloat</span>(magnitude(of: range) <span class="operator">/</span> magnitude(of: overallRange)), <span class="number">0.15</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> offsetRatio: <span class="type">CGFloat</span> &#123;</span><br><span class="line">        <span class="type">CGFloat</span>((range.lowerBound <span class="operator">-</span> overallRange.lowerBound) <span class="operator">/</span> magnitude(of: overallRange))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> animation: <span class="type">Animation</span> &#123;</span><br><span class="line">        <span class="type">Animation</span>.spring(dampingFraction: <span class="number">0.5</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Capsule</span>()</span><br><span class="line">            .fill(<span class="type">Color</span>.gray)</span><br><span class="line">            .frame(height: height <span class="operator">*</span> heightRatio, alignment: .bottom)</span><br><span class="line">            .offset(x: <span class="number">0</span>, y: height <span class="operator">*</span> <span class="operator">-</span>offsetRatio)</span><br><span class="line">            .animation(animation)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤4-14">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-3"></a></p>
<p>稍微加快动画的速度，以缩短每个条形移动到新位置所需的时间。</p>
<blockquote>
<p>GraphCapsule.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">GraphCapsule</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> index: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> height: <span class="type">CGFloat</span></span><br><span class="line">    <span class="keyword">var</span> range: <span class="type">Range</span>&lt;<span class="type">Double</span>&gt;</span><br><span class="line">    <span class="keyword">var</span> overallRange: <span class="type">Range</span>&lt;<span class="type">Double</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> heightRatio: <span class="type">CGFloat</span> &#123;</span><br><span class="line">        <span class="built_in">max</span>(<span class="type">CGFloat</span>(magnitude(of: range) <span class="operator">/</span> magnitude(of: overallRange)), <span class="number">0.15</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> offsetRatio: <span class="type">CGFloat</span> &#123;</span><br><span class="line">        <span class="type">CGFloat</span>((range.lowerBound <span class="operator">-</span> overallRange.lowerBound) <span class="operator">/</span> magnitude(of: overallRange))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> animation: <span class="type">Animation</span> &#123;</span><br><span class="line">        <span class="type">Animation</span>.spring(dampingFraction: <span class="number">0.5</span>)</span><br><span class="line">            .speed(<span class="number">2</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Capsule</span>()</span><br><span class="line">            .fill(<span class="type">Color</span>.gray)</span><br><span class="line">            .frame(height: height <span class="operator">*</span> heightRatio, alignment: .bottom)</span><br><span class="line">            .offset(x: <span class="number">0</span>, y: height <span class="operator">*</span> <span class="operator">-</span>offsetRatio)</span><br><span class="line">            .animation(animation)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤5-9">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-1"></a></p>
<p>根据胶囊在图形上的位置为每个动画添加延迟<code>delay</code>。</p>
<blockquote>
<p>GraphCapsule.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">GraphCapsule</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> index: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> height: <span class="type">CGFloat</span></span><br><span class="line">    <span class="keyword">var</span> range: <span class="type">Range</span>&lt;<span class="type">Double</span>&gt;</span><br><span class="line">    <span class="keyword">var</span> overallRange: <span class="type">Range</span>&lt;<span class="type">Double</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> heightRatio: <span class="type">CGFloat</span> &#123;</span><br><span class="line">        <span class="built_in">max</span>(<span class="type">CGFloat</span>(magnitude(of: range) <span class="operator">/</span> magnitude(of: overallRange)), <span class="number">0.15</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> offsetRatio: <span class="type">CGFloat</span> &#123;</span><br><span class="line">        <span class="type">CGFloat</span>((range.lowerBound <span class="operator">-</span> overallRange.lowerBound) <span class="operator">/</span> magnitude(of: overallRange))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> animation: <span class="type">Animation</span> &#123;</span><br><span class="line">        <span class="type">Animation</span>.spring(dampingFraction: <span class="number">0.5</span>)</span><br><span class="line">            .speed(<span class="number">2</span>)</span><br><span class="line">            .delay(<span class="number">0.03</span> <span class="operator">*</span> <span class="type">Double</span>(index))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Capsule</span>()</span><br><span class="line">            .fill(<span class="type">Color</span>.gray)</span><br><span class="line">            .frame(height: height <span class="operator">*</span> heightRatio, alignment: .bottom)</span><br><span class="line">            .offset(x: <span class="number">0</span>, y: height <span class="operator">*</span> <span class="operator">-</span>offsetRatio)</span><br><span class="line">            .animation(animation)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤6-7">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46-1"></a></p>
<p>观察自定义动画在图形之间转换时如何提供波动效果。</p>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/_p22_explore-with-animations.gif" alt=""></p>
<h2 id="构建列表和导航">构建列表和导航</h2>
<p><a href="#%E6%9E%84%E5%BB%BA%E5%88%97%E8%A1%A8%E5%92%8C%E5%AF%BC%E8%88%AA"></a></p>
<p>设置了基本地标详情视图后，需要为用户提供查看地标所有列表和查看每个地标详情的方法。</p>
<p>您将创建显示所有地标信息的视图，并动态生成一个滚动列表，用户可以点击该列表查看地标的详情视图。要微调UI，您将使用Xcode的画布以不同的设备大小呈现多个预览。</p>
<p>下载项目文件以开始构建此项目，并执行以下步骤。</p>
<blockquote>
<p>学习时间：35分钟</p>
<p><a target="_blank" rel="noopener" href="https://docs-assets.developer.apple.com/published/58bd04ddca/BuildingListsAndNavigation.zip">下载示例：BuildingListsAndNavigation.zip</a></p>
</blockquote>
<h2 id="第一节-了解示例数据。">第一节 了解示例数据。</h2>
<p><a href="#%E7%AC%AC%E4%B8%80%E8%8A%82-%E4%BA%86%E8%A7%A3%E7%A4%BA%E4%BE%8B%E6%95%B0%E6%8D%AE"></a></p>
<p>在第一个教程中，我们将数据硬编码到所有自定义视图中。在这里，您将学习如何将数据传递到自定义视图中以动态显示。</p>
<p>首先<a target="_blank" rel="noopener" href="https://docs-assets.developer.apple.com/published/58bd04ddca/BuildingListsAndNavigation.zip">下载示例项目</a>并熟悉示例数据。</p>
<p><img src="https://camo.githubusercontent.com/2dcdb436a4520060ac81a44c83c6e8d44acce0dc66b5516e771f5edc8f1eb0c9/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f346434613235636432632f32663866396431352d333438652d346337662d623533642d6265333161356438633435372e706e67" alt=""></p>
<h2 id="步骤1-18">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41"></a></p>
<p>在项目导航器中，选择<code>Models&gt;Landmark.swift</code>。</p>
<p><code>Landmark.swift</code>声明了一个Landmark结构，该结构存储应用程序需要显示的所有<code>Landmark</code>信息，并从<code>landmarkData.json</code>导入一组<code>Landmark</code>数据。</p>
<blockquote>
<p>Landmark.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> CoreLocation</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Landmark</span>: <span class="title class_ inherited__">Hashable</span>, <span class="title class_ inherited__">Codable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> id: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">var</span> imageName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">var</span> coordinates: <span class="type">Coordinates</span></span><br><span class="line">    <span class="keyword">var</span> state: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> park: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> category: <span class="type">Category</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> locationCoordinate: <span class="type">CLLocationCoordinate2D</span> &#123;</span><br><span class="line">        <span class="type">CLLocationCoordinate2D</span>(</span><br><span class="line">            latitude: coordinates.latitude,</span><br><span class="line">            longitude: coordinates.longitude)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">Category</span>: <span class="title class_ inherited__">String</span>, <span class="title class_ inherited__">CaseIterable</span>, <span class="title class_ inherited__">Codable</span>, <span class="title class_ inherited__">Hashable</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> featured <span class="operator">=</span> <span class="string">&quot;Featured&quot;</span></span><br><span class="line">        <span class="keyword">case</span> lakes <span class="operator">=</span> <span class="string">&quot;Lakes&quot;</span></span><br><span class="line">        <span class="keyword">case</span> rivers <span class="operator">=</span> <span class="string">&quot;Rivers&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Landmark</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> image: <span class="type">Image</span> &#123;</span><br><span class="line">        <span class="type">ImageStore</span>.shared.image(name: imageName)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Coordinates</span>: <span class="title class_ inherited__">Hashable</span>, <span class="title class_ inherited__">Codable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> latitude: <span class="type">Double</span></span><br><span class="line">    <span class="keyword">var</span> longitude: <span class="type">Double</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤2-18">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42"></a></p>
<p>在项目导航器中，选择<code>Resources&gt;landmarkData.json</code>。</p>
<p>您将在本教程的其余部分以及随后的所有内容中使用此示例数据。</p>
<blockquote>
<p>landmarkData.json</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;name&quot;: &quot;Turtle Rock&quot;,</span><br><span class="line">        &quot;category&quot;: &quot;Featured&quot;,</span><br><span class="line">        &quot;city&quot;: &quot;Twentynine Palms&quot;,</span><br><span class="line">        &quot;state&quot;: &quot;California&quot;,</span><br><span class="line">        &quot;id&quot;: 1001,</span><br><span class="line">        &quot;park&quot;: &quot;Joshua Tree National Park&quot;,</span><br><span class="line">        &quot;coordinates&quot;: &#123;</span><br><span class="line">            &quot;longitude&quot;: -116.166868,</span><br><span class="line">            &quot;latitude&quot;: 34.011286</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;imageName&quot;: &quot;turtlerock&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;name&quot;: &quot;Silver Salmon Creek&quot;,</span><br><span class="line">        &quot;category&quot;: &quot;Lakes&quot;,</span><br><span class="line">        &quot;city&quot;: &quot;Port Alsworth&quot;,</span><br><span class="line">        &quot;state&quot;: &quot;Alaska&quot;,</span><br><span class="line">        &quot;id&quot;: 1002,</span><br><span class="line">        &quot;park&quot;: &quot;Lake Clark National Park and Preserve&quot;,</span><br><span class="line">        &quot;coordinates&quot;: &#123;</span><br><span class="line">            &quot;longitude&quot;: -152.665167,</span><br><span class="line">            &quot;latitude&quot;: 59.980167</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;imageName&quot;: &quot;silversalmoncreek&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="步骤3-16">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43"></a></p>
<p>请注意，我们将<code>ContentView</code>类型重命名为<code>LandmarkDetail</code>。</p>
<p>在本教程和以下每个教程中，您将创建多个视图类型。</p>
<blockquote>
<p>LandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>()</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>()</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                    .font(.title)</span><br><span class="line"></span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/f348f6b5192adb6ce6417793d8aef7e43df24a97d6076575985141f77a9c2a87/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336231356434363864362f36363530306134662d303137392d343465362d616362302d6166393436383964396538652e706e67" alt=""></p>
<h2 id="第二节-创建行视图">第二节 创建行视图</h2>
<p><a href="#%E7%AC%AC%E4%BA%8C%E8%8A%82-%E5%88%9B%E5%BB%BA%E8%A1%8C%E8%A7%86%E5%9B%BE"></a></p>
<p>本节中构建的第一个视图是行视图，用于显示每个地标的详细信息。此行视图声明了一个属性即<code>landmark</code> ，其用于存储地标信息，以便行视图可以显示任何地标。稍后，您将把多个行视图合并成一个地标列表。</p>
<p><img src="https://camo.githubusercontent.com/7679f99fa7181e7bc78ece11727a61aa021c976167815cd1981ac6c382dd7c29/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f383535333364323765662f36663163336461352d333463372d346332372d626137372d3237306564326132393237322e706e67" alt=""></p>
<h2 id="步骤1-19">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-1"></a></p>
<p>创建一个新的SwiftUI视图，名为<code>LandmarkRow.swift</code>。</p>
<p><img src="https://camo.githubusercontent.com/ca612cb88a14a6cacd37822f86c9991f6f8364a9f53adc28f58e51f64d1d3261/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f396164323335316237612f30613663303233322d366436312d346538622d396530342d3237636664613437626632622e706e67" alt=""></p>
<h2 id="步骤2-19">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-1"></a></p>
<p>如果预览尚未显示，请通过选择<code>Editor &gt; Editor and Canvas</code>，来显示画布，然后单击“Resume”。</p>
<p><img src="https://camo.githubusercontent.com/540b4fa379403fc023c2e017e28eb71ad65fc6f5927a79fa852d90f86c982ec2/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f633761653862303631372f61633939663031352d333362302d346438332d626361322d6162383433383936623932662e706e67" alt=""></p>
<h2 id="步骤3-17">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-1"></a></p>
<p>添加<code>landmark</code>作为<code>LandmarkRow</code>的存储属性。</p>
<p>添加<code>landmark</code>属性时，预览将停止工作，因为<code>LandmarkRow</code>类型在初始化期间需要<code>landmark</code>实例。</p>
<blockquote>
<p>LandmarkRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkRow</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>想要修复预览，需要修改<code>PreviewProvider</code>。</p>
</blockquote>
<h2 id="步骤4-15">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44"></a></p>
<p>在<code>LandmarkRow_Previews</code>的<code>static previews</code>属性中，将<code>landmarkData</code>数组的第一个元素作为<code>LandmarkRow</code>参数添加到LandmarkRow初始值设定项中。</p>
<p>预览可以正常显示文本<code>Hello World</code>了。</p>
<blockquote>
<p>LandmarkRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/70344d7590245f3d18b90a323ac31f2a9eccd6355c8b3f59b2bf820c49c52fb8/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f316534326233323233612f32393262373461362d303137342d343737332d623834622d6238613637643566393164332e706e67" alt=""></p>
<blockquote>
<p>修复后，可以为行视图生成布局。</p>
</blockquote>
<h2 id="步骤5-10">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45"></a></p>
<p>将文本视图嵌入到<code>HStack</code>中。</p>
<blockquote>
<p>LandmarkRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/70344d7590245f3d18b90a323ac31f2a9eccd6355c8b3f59b2bf820c49c52fb8/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f316534326233323233612f32393262373461362d303137342d343737332d623834622d6238613637643566393164332e706e67" alt=""></p>
<h2 id="步骤6-8">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46"></a></p>
<p>修改文本视图以使用<code>landmark</code>的<code>name</code>属性。</p>
<blockquote>
<p>LandmarkRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(landmark.name)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/c34b69d9aa9b63d524698127d75b4399f497870d49fa6e7d40b840009b6a8890/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393834666538346334362f31616630626131302d333964362d343531332d396430382d3362616332336261636664642e706e67" alt=""></p>
<h2 id="步骤7-2">步骤7</h2>
<p><a href="#%E6%AD%A5%E9%AA%A47"></a></p>
<p>在<code>Text</code>视图之前添加<code>Image</code>视图来完成行视图。</p>
<blockquote>
<p>LandmarkRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            landmark.image</span><br><span class="line">                .resizable()</span><br><span class="line">                .frame(width: <span class="number">50</span>, height: <span class="number">50</span>)</span><br><span class="line">            <span class="type">Text</span>(landmark.name)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/63dc967eb42e2bbc2e59f3b80dd2c047a3545c50946490624d6ea0d6e5878a3e/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f626635333364626138632f65396230646461362d643166332d343438632d626435342d3266316466313966336639302e706e67" alt=""></p>
<h2 id="第三节-自定义行预览">第三节 自定义行预览</h2>
<p><a href="#%E7%AC%AC%E4%B8%89%E8%8A%82-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A1%8C%E9%A2%84%E8%A7%88"></a></p>
<p>Xcode的画布自动识别并显示当前编辑器中遵守<code>PreviewProvider</code>协议的任何类型。<code>PreviewProvider</code>返回一个或多个视图，并提供配置大小和设备的选项。</p>
<p>您可以自定义<code>PreviewProvider</code>返回的内容，以准确呈现对您最有帮助的预览。</p>
<p><img src="https://camo.githubusercontent.com/a6729288ec6370153c0302bfe5e85a501d9aa6759ded8aabbdaf3c07d1913e48/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f383936633830353734642f64653433303166612d626639632d343561632d623766322d6262623939306363623431622e706e67" alt=""></p>
<h2 id="步骤1-20">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-2"></a></p>
<p>在<code>LandmarkRow_Previews</code>中，将<code>landmark</code>参数更新为<code>landmarkData</code>数组中的第二个元素。</p>
<p>预览立即显示第二个示例地标，而不是第一个。</p>
<blockquote>
<p>LandmarkRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            landmark.image</span><br><span class="line">                .resizable()</span><br><span class="line">                .frame(width: <span class="number">50</span>, height: <span class="number">50</span>)</span><br><span class="line">            <span class="type">Text</span>(landmark.name)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">1</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/63dc967eb42e2bbc2e59f3b80dd2c047a3545c50946490624d6ea0d6e5878a3e/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f626635333364626138632f65396230646461362d643166332d343438632d626435342d3266316466313966336639302e706e67" alt=""></p>
<h2 id="步骤2-20">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-2"></a></p>
<p>使用<code>previewLayout(_:)</code> 设置一个与列表中的行近似的大小。</p>
<blockquote>
<p>LandmarkRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            landmark.image</span><br><span class="line">                .resizable()</span><br><span class="line">                .frame(width: <span class="number">50</span>, height: <span class="number">50</span>)</span><br><span class="line">            <span class="type">Text</span>(landmark.name)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">1</span>])</span><br><span class="line">            .previewLayout(.fixed(width: <span class="number">300</span>, height: <span class="number">70</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/6e9c3e19452d904a8edc75c3e99d0ebe5ffa01f16ce326db9f4b15d1b52971a5/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f623763346465376430652f64336364643533612d633363352d343135342d383466632d6362623661333133376165662e706e67" alt=""></p>
<blockquote>
<p>可以使用<code>Group</code>从<code>PreviewProvider</code>返回多个视图预览。</p>
</blockquote>
<h2 id="步骤3-18">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-2"></a></p>
<p>将返回的行包装在一个<code>Group</code>中，然后再次添加第一行。</p>
<p><code>Group</code>是用于对视图内容进行分组的容器。Xcode将组的子视图呈现为画布中的单独预览。</p>
<blockquote>
<p>LandmarkRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            landmark.image</span><br><span class="line">                .resizable()</span><br><span class="line">                .frame(width: <span class="number">50</span>, height: <span class="number">50</span>)</span><br><span class="line">            <span class="type">Text</span>(landmark.name)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">                .previewLayout(.fixed(width: <span class="number">300</span>, height: <span class="number">70</span>))</span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">1</span>])</span><br><span class="line">                .previewLayout(.fixed(width: <span class="number">300</span>, height: <span class="number">70</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/16e33f82002d7bbd654acf8ec4df30f4de33c7ff23681c31c5d5ee888b88da91/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f373566396433663964302f63393062303738382d323265322d346132352d396137662d3464616163636439653762342e706e67" alt=""></p>
<h2 id="步骤4-16">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-1"></a></p>
<p>要简化代码，请将<code>previewLayout（:）</code>调用移到<code>Group</code>的外部。</p>
<p>视图的子级视图继承视图的上下文设置，如预览配置。</p>
<blockquote>
<p>LandmarkRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            landmark.image</span><br><span class="line">                .resizable()</span><br><span class="line">                .frame(width: <span class="number">50</span>, height: <span class="number">50</span>)</span><br><span class="line">            <span class="type">Text</span>(landmark.name)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">1</span>])</span><br><span class="line">        &#125;</span><br><span class="line">        .previewLayout(.fixed(width: <span class="number">300</span>, height: <span class="number">70</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/16e33f82002d7bbd654acf8ec4df30f4de33c7ff23681c31c5d5ee888b88da91/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f373566396433663964302f63393062303738382d323265322d346132352d396137662d3464616163636439653762342e706e67" alt=""></p>
<blockquote>
<p>Tips：在<code>PreviewProvider</code>中编写的代码只会改变Xcode在画布中显示的内容。</p>
</blockquote>
<h2 id="第四节-创建地标列表">第四节 创建地标列表</h2>
<p><a href="#%E7%AC%AC%E5%9B%9B%E8%8A%82-%E5%88%9B%E5%BB%BA%E5%9C%B0%E6%A0%87%E5%88%97%E8%A1%A8"></a></p>
<p>使用SwiftUI的<code>List</code>类型时，可以显示特定于平台的视图列表。列表的元素可以是静态的，比如您目前创建的堆栈的子视图，也可以是动态生成的。您甚至可以混合静态和动态生成的视图。</p>
<p><img src="https://camo.githubusercontent.com/0dd540c130b7003f3d576baef92b8e585ce0a6dccb8130811c9fdd4da9ab1aaa/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f343431363661633763332f63393162363534362d313233302d343361322d383836372d3266306534343565646239392e706e67" alt=""></p>
<h2 id="步骤1-21">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-3"></a></p>
<p>创建一个新的<code>SwiftUI View</code>，名为<code>LandmarkList.swift</code>。</p>
<p><img src="https://camo.githubusercontent.com/9c7de4a1867143114d4a20a6885fde579d81297c027c98d2fc8f514fc1a2aaa6/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393931633532646234652f61666236646335392d636462382d346236342d396263652d3330663837636262656563342e706e67" alt=""></p>
<h2 id="步骤2-21">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-3"></a></p>
<p>将默认<code>Text</code>视图替换为<code>List</code>，并提供前两个<code>Landmark</code>作为列表子级的<code>LandmarkRow</code>实例。</p>
<p>预览显示了两个地标，它们以适合iOS的列表样式呈现。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">1</span>])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/46f318e8c55d715da76ebbc3daddc7294601ab2ecb0c5a626044afb4f83ec4e1/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f303135643038393365302f63373333313836382d646235322d346664612d613635622d3131376333326538343864392e706e67" alt=""></p>
<h2 id="第五节-动态化列表">第五节 动态化列表</h2>
<p><a href="#%E7%AC%AC%E4%BA%94%E8%8A%82-%E5%8A%A8%E6%80%81%E5%8C%96%E5%88%97%E8%A1%A8"></a></p>
<p>您可以直接从集合中生成行，而不是单独的指定列表中的元素。</p>
<p>通过传递数据集合并为集合中的每个元素提供视图的闭包，可以创建显示集合元素的列表。列表使用提供的闭包将集合中的每个元素转换为子视图。</p>
<p><img src="https://camo.githubusercontent.com/e6aaef5ffb941d324829926768025373fa43369737579d6dbd0a6bafac1362d0/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f363862636164373735392f33663266383037312d393765312d343831652d393261322d6566623138626530316563372e706e67" alt=""></p>
<h2 id="步骤1-22">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-4"></a></p>
<p>删除两个静态<code>LandmarkRow</code>，并将<code>landmarkData</code> 传递给<code>Lisst</code>初始值设定项。</p>
<p><code>List</code>使用<code>identifiable</code>数据。您可以通过以下两种方式之一生产<code>identifiable</code>数据：1、使用<code>key path</code>属性标识每个元素；2、使数据遵守<code>Identifiable</code>协议。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span>(landmarkData, id: \.id) &#123; landmark <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤2-22">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-4"></a></p>
<p>通过从闭包返回<code>LandmarkRow</code>来动态生成列表。</p>
<p>这将为<code>landmarkData</code>数组中的每个元素创建一个<code>LandmarkRow</code>。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span>(landmarkData, id: \.id) &#123; landmark <span class="keyword">in</span></span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/9a26e88d14bcac52fe6b908b862daf000771cb6e9beede294236167f9d9779eb/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f643437646332623739352f61653339343032322d633731302d346338362d393232362d3765306361323235633238372e706e67" alt=""></p>
<blockquote>
<p>接下来，您将通过使<code>Landmark</code>遵守<code>Identifiable</code>来简化代码。</p>
</blockquote>
<h2 id="步骤3-19">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-3"></a></p>
<p>切换到<code>Landmark.swift</code>并声明<code>Identifiable</code>协议。</p>
<p>由于<code>Landmark</code>类型已经具有<code>Identifiable</code>所需的id属性，因此没有其他工作要做。</p>
<blockquote>
<p>Landmark.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> CoreLocation</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Landmark</span>: <span class="title class_ inherited__">Hashable</span>, <span class="title class_ inherited__">Codable</span>, <span class="title class_ inherited__">Identifiable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> id: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">var</span> imageName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">var</span> coordinates: <span class="type">Coordinates</span></span><br><span class="line">    <span class="keyword">var</span> state: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> park: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> category: <span class="type">Category</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> locationCoordinate: <span class="type">CLLocationCoordinate2D</span> &#123;</span><br><span class="line">        <span class="type">CLLocationCoordinate2D</span>(</span><br><span class="line">            latitude: coordinates.latitude,</span><br><span class="line">            longitude: coordinates.longitude)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">Category</span>: <span class="title class_ inherited__">String</span>, <span class="title class_ inherited__">CaseIterable</span>, <span class="title class_ inherited__">Codable</span>, <span class="title class_ inherited__">Hashable</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> featured <span class="operator">=</span> <span class="string">&quot;Featured&quot;</span></span><br><span class="line">        <span class="keyword">case</span> lakes <span class="operator">=</span> <span class="string">&quot;Lakes&quot;</span></span><br><span class="line">        <span class="keyword">case</span> rivers <span class="operator">=</span> <span class="string">&quot;Rivers&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Landmark</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> image: <span class="type">Image</span> &#123;</span><br><span class="line">        <span class="type">ImageStore</span>.shared.image(name: imageName)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Coordinates</span>: <span class="title class_ inherited__">Hashable</span>, <span class="title class_ inherited__">Codable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> latitude: <span class="type">Double</span></span><br><span class="line">    <span class="keyword">var</span> longitude: <span class="type">Double</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/9a26e88d14bcac52fe6b908b862daf000771cb6e9beede294236167f9d9779eb/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f643437646332623739352f61653339343032322d633731302d346338362d393232362d3765306361323235633238372e706e67" alt=""></p>
<h2 id="步骤4-17">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-2"></a></p>
<p>切换回<code>LandmarkList.swift</code>并删除id参数。</p>
<p>从现在起，您将能够直接使用<code>Landmark</code>的集合。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/9a26e88d14bcac52fe6b908b862daf000771cb6e9beede294236167f9d9779eb/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f643437646332623739352f61653339343032322d633731302d346338362d393232362d3765306361323235633238372e706e67" alt=""></p>
<h2 id="第六节-在列表和详情之间设置导航">第六节 在列表和详情之间设置导航</h2>
<p><a href="#%E7%AC%AC%E5%85%AD%E8%8A%82-%E5%9C%A8%E5%88%97%E8%A1%A8%E5%92%8C%E8%AF%A6%E6%83%85%E4%B9%8B%E9%97%B4%E8%AE%BE%E7%BD%AE%E5%AF%BC%E8%88%AA"></a></p>
<p>列表呈现正确，但您还不能轻触每个<code>LandmarkRow</code>来查看该地标的详情页面。</p>
<p>通过把<code>List</code>嵌入到<code>NavigationView</code>中使其具有导航功能，然后在<code>NavigationLink</code>中嵌入每一行<code>LandmarkRow</code>，并设置要跳转的目标视图。</p>
<p><img src="https://camo.githubusercontent.com/40ec756f989e837d2bbc7215fa39be8b457a86f9da26b8895897c63b536c0153/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f343866653961623061332f63366632316466392d316436642d343264342d623231622d3061323538386634636439372e706e67" alt=""></p>
<h2 id="步骤1-23">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-5"></a></p>
<p>在<code>NavigationView</code>中嵌入动态生成的<code>LandmarkList</code>。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/10c5e824736a30cb2416082248046234500d1766f24939144b8492f62cc88ddf/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f303738613132653533362f66636231336362362d613865332d346339352d613266642d6138343439396131666132622e706e67" alt=""></p>
<h2 id="步骤2-23">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-5"></a></p>
<p>在显示列表时，调用<code>navigationBarTitle（:）</code>修饰符方法设置导航栏的标题。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/2e223378a25970e2f510031191eca5c174091923bd9eb329f844898fbb28b114/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f356238616236386239392f36386333343630362d306434312d343361392d623233612d6262666665393131373764382e706e67" alt=""></p>
<h2 id="步骤3-20">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-4"></a></p>
<p>在<code>List</code>的闭包中，将返回的<code>Row</code>包装在<code>NavigationLink</code> 中，指定<code>LandmarkDetail</code>视图作为跳转目标。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>()) &#123;</span><br><span class="line">                    <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/4f1f502fd64b5098da356d410e304df576a21e7491864733eecb0ebc989d4bf6/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f636336613763613332362f38383336633637612d646230332d343064362d613834612d3364333830393934306638312e706e67" alt=""></p>
<h2 id="步骤4-18">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-3"></a></p>
<p>通过切换到实时预览模式，您可以在预览中直接尝试导航功能。单击<code>Live Preview</code>按钮并点击地标行访问详情页。</p>
<p><img src="https://camo.githubusercontent.com/87d58aa06de09967e4d72ca003b8368afeebe31cfb7bb802aba7359cbbbae098/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f356533393736373734642f64393065313465662d666366652d346566342d396266382d6430353062633961343261342e706e67" alt=""></p>
<h2 id="第7节-将数据传递到子视图">第7节 将数据传递到子视图</h2>
<p><a href="#%E7%AC%AC7%E8%8A%82-%E5%B0%86%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%92%E5%88%B0%E5%AD%90%E8%A7%86%E5%9B%BE"></a></p>
<p><code>LandmarkDetail</code>视图仍然使用硬编码方式来显示地标。与<code>LandmarkRow</code>一样，<code>LandmarkDetail</code>类型及其包含的视图需要使用<code>landmark</code>属性作为其数据源。</p>
<p>从子视图开始，您将转换<code>CircleImage</code>、<code>MapView</code>和<code>LandmarkDetail</code>以显示传入的数据，而不是对每行进行硬编码。</p>
<p><img src="https://camo.githubusercontent.com/d385ac27178d00ad935d9201c395114d5a6a577609f9b3720c3c4f3e2a3ba40f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f633333383030313062662f63623439373332662d636233652d346537372d613265362d3834663766373631383530322e706e67" alt=""></p>
<h2 id="步骤1-24">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-6"></a></p>
<p>在<code>CircleImage.swift</code>中，将存储属性<code>image</code>添加到<code>CircleImage</code>。</p>
<p>这是使用SwiftUI构建视图时的常见模式。您的自定义视图通常会包装一系列修饰符。</p>
<blockquote>
<p>CircleImage.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> image: <span class="type">Image</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        image</span><br><span class="line">            .clipShape(<span class="type">Circle</span>())</span><br><span class="line">            .overlay(<span class="type">Circle</span>().stroke(<span class="type">Color</span>.white, lineWidth: <span class="number">4</span>))</span><br><span class="line">            .shadow(radius: <span class="number">10</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CircleImage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤2-24">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-6"></a></p>
<p>更新<code>CircleImage_Preview</code> 以传递名为<code>Turtle Rock</code>的<code>Image</code>。</p>
<blockquote>
<p>CircleImage.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> image: <span class="type">Image</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        image</span><br><span class="line">            .clipShape(<span class="type">Circle</span>())</span><br><span class="line">            .overlay(<span class="type">Circle</span>().stroke(<span class="type">Color</span>.white, lineWidth: <span class="number">4</span>))</span><br><span class="line">            .shadow(radius: <span class="number">10</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CircleImage</span>(image: <span class="type">Image</span>(<span class="string">&quot;turtlerock&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>步骤3</p>
<p>在<code>MapView.swift</code>中，向<code>MapView</code>添加一个<code>coordinate</code>属性，并将代码转换为使用该属性，而不是硬编码纬度和经度。</p>
<blockquote>
<p>MapView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> MapKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MapView</span>: <span class="title class_ inherited__">UIViewRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> coordinate: <span class="type">CLLocationCoordinate2D</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIView</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">MKMapView</span> &#123;</span><br><span class="line">        <span class="type">MKMapView</span>(frame: .zero)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIView</span>(<span class="keyword">_</span> <span class="params">view</span>: <span class="type">MKMapView</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> span <span class="operator">=</span> <span class="type">MKCoordinateSpan</span>(latitudeDelta: <span class="number">0.02</span>, longitudeDelta: <span class="number">0.02</span>)</span><br><span class="line">        <span class="keyword">let</span> region <span class="operator">=</span> <span class="type">MKCoordinateRegion</span>(center: coordinate, span: span)</span><br><span class="line">        view.setRegion(region, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MapView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">MapView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤4-19">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-4"></a></p>
<p>更新<code>MapView_Preview</code>以传递数据数组中第一个地标元素的坐标。</p>
<blockquote>
<p>MapView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> MapKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MapView</span>: <span class="title class_ inherited__">UIViewRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> coordinate: <span class="type">CLLocationCoordinate2D</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIView</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">MKMapView</span> &#123;</span><br><span class="line">        <span class="type">MKMapView</span>(frame: .zero)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIView</span>(<span class="keyword">_</span> <span class="params">view</span>: <span class="type">MKMapView</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> span <span class="operator">=</span> <span class="type">MKCoordinateSpan</span>(latitudeDelta: <span class="number">0.02</span>, longitudeDelta: <span class="number">0.02</span>)</span><br><span class="line">        <span class="keyword">let</span> region <span class="operator">=</span> <span class="type">MKCoordinateRegion</span>(center: coordinate, span: span)</span><br><span class="line">        view.setRegion(region, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MapView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">MapView</span>(coordinate: landmarkData[<span class="number">0</span>].locationCoordinate)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤5-11">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-1"></a></p>
<p>在<code>LandmarkDetail.swift</code>中，将<code>Landmark</code>属性添加到<code>LandmarkDetail</code>类中。</p>
<blockquote>
<p>LandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>()</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>()</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                    .font(.title)</span><br><span class="line"></span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkDetail</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>步骤6</p>
<p>更新<code>LandmarkDetail_Preview</code>以使用<code>landmarkData</code>数组中的第一个地标元素。</p>
<blockquote>
<p>LandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>()</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>()</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                    .font(.title)</span><br><span class="line"></span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkDetail</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤7-3">步骤7</h2>
<p><a href="#%E6%AD%A5%E9%AA%A47-1"></a></p>
<p>将所需的数据下传给自定义类型。</p>
<blockquote>
<p>LandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>(coordinate: landmark.locationCoordinate)</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>(image: landmark.image)</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(landmark.name)</span><br><span class="line">                    .font(.title)</span><br><span class="line"></span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(landmark.park)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(landmark.state)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkDetail</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤8-2">步骤8</h2>
<p><a href="#%E6%AD%A5%E9%AA%A48"></a></p>
<p>最后，调用<code>navigationBarTitle(_:displayMode:)</code>修饰符，在显示详情视图时为导航栏提供标题。</p>
<blockquote>
<p>LandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>(coordinate: landmark.locationCoordinate)</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>(image: landmark.image)</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(landmark.name)</span><br><span class="line">                    .font(.title)</span><br><span class="line"></span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(landmark.park)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(landmark.state)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="type">Text</span>(landmark.name), displayMode: .inline)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkDetail</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤9-2">步骤9</h2>
<p><a href="#%E6%AD%A5%E9%AA%A49"></a></p>
<p>在<code>SceneDelegate.swift</code>中，将应用程序的根视图切换为<code>LandmarkList</code>。</p>
<p>当在模拟器中独立运行(不是预览模式)时，您的应用程序将从<code>SceneDelegate</code>中定义的根视图开始。</p>
<blockquote>
<p>SceneDelegate.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SceneDelegate</span>: <span class="title class_ inherited__">UIResponder</span>, <span class="title class_ inherited__">UIWindowSceneDelegate</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> window: <span class="type">UIWindow</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">scene</span>(<span class="keyword">_</span> <span class="params">scene</span>: <span class="type">UIScene</span>, <span class="params">willConnectTo</span> <span class="params">session</span>: <span class="type">UISceneSession</span>, <span class="params">options</span> <span class="params">connectionOptions</span>: <span class="type">UIScene</span>.<span class="type">ConnectionOptions</span>) &#123;</span><br><span class="line">        <span class="comment">// Use this method to optionally configure and attach the UIWindow `window` to the provided UIWindowScene `scene`.</span></span><br><span class="line">        <span class="comment">// If using a storyboard, the `window` property will automatically be initialized and attached to the scene.</span></span><br><span class="line">        <span class="comment">// This delegate does not imply the connecting scene or session are new (see `application:configurationForConnectingSceneSession` instead).</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Use a UIHostingController as window root view controller</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> windowScene <span class="operator">=</span> scene <span class="keyword">as?</span> <span class="type">UIWindowScene</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> window <span class="operator">=</span> <span class="type">UIWindow</span>(windowScene: windowScene)</span><br><span class="line">            window.rootViewController <span class="operator">=</span> <span class="type">UIHostingController</span>(rootView: <span class="type">LandmarkList</span>())</span><br><span class="line">            <span class="keyword">self</span>.window <span class="operator">=</span> window</span><br><span class="line">            window.makeKeyAndVisible()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/942e2a6d97e59f6a46f5bf7872fe5724b6bd3ab79c6d8de821609fb1423b17fe/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f326662653635353663342f62666331343637622d653761392d346136312d383035312d3530623935353039633361622e706e67" alt=""></p>
<h2 id="步骤10">步骤10</h2>
<p><a href="#%E6%AD%A5%E9%AA%A410"></a></p>
<p>在<code>LandmarkList.swift</code>中，将当前<code>Landmark</code>传递到目标详情页。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                    <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/942e2a6d97e59f6a46f5bf7872fe5724b6bd3ab79c6d8de821609fb1423b17fe/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f326662653635353663342f62666331343637622d653761392d346136312d383035312d3530623935353039633361622e706e67" alt=""></p>
<h2 id="步骤11">步骤11</h2>
<p><a href="#%E6%AD%A5%E9%AA%A411"></a></p>
<p>切换到实时预览以查看从列表导航到详情视图时，是否显示正确的地标。</p>
<p><img src="https://camo.githubusercontent.com/87d58aa06de09967e4d72ca003b8368afeebe31cfb7bb802aba7359cbbbae098/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f356533393736373734642f64393065313465662d666366652d346566342d396266382d6430353062633961343261342e706e67" alt=""></p>
<h2 id="第8节-动态生成预览">第8节 动态生成预览</h2>
<p><a href="#%E7%AC%AC8%E8%8A%82-%E5%8A%A8%E6%80%81%E7%94%9F%E6%88%90%E9%A2%84%E8%A7%88"></a></p>
<p>接下来，将向<code>LandmarkList_Previews</code>添加代码，以呈现不同设备大小的列表视图预览。默认情况下，预览以激活状态设备的大小呈现。可以通过调用<code>previewDevice（:）</code>修饰符方法来更改预览设备。</p>
<p><img src="https://camo.githubusercontent.com/603502b096d1dbf3d709b47fe0f9d131ecbc1a96e086420d2d25f63e44d55b9e/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f626639376636663634642f34373565346163332d623630352d343330392d613239342d6539643265666136663161622e706e67" alt=""></p>
<h2 id="步骤1-25">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-7"></a></p>
<p>首先，将当前列表预览更改为<code>iPhone SE</code>大小的渲染器。</p>
<p>您可以提供<code>Xcode</code>的<code>scheme</code>菜单中显示的任何设备的名称。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                    <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">            .previewDevice(<span class="type">PreviewDevice</span>(rawValue: <span class="string">&quot;iPhone SE&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/2203984b932e49e6398b65e894436f578a66b000318f3603b910210a0ec188da/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f666166613963356530652f38396335393062612d613265302d343662632d626163612d3238643039303631373832652e706e67" alt=""></p>
<h2 id="步骤2-25">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-7"></a></p>
<p>在<code>LandmarkList_Previews</code>中，使用设备名称数组作为数据，将<code>LandmarkList</code>嵌入<code>ForEach</code>实例中。</p>
<p>ForEach对集合的操作方式与list相同，这意味着您可以在任何可以使用子视图的地方使用它，例如在<code>stacks</code>、<code>list</code>、<code>group</code>等中。当数据元素是简单的值类型（如您在这里使用的字符串）时，可以使用.self作为<code>identifier</code>的<code>key path</code>。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                    <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ForEach</span>([<span class="string">&quot;iPhone SE&quot;</span>, <span class="string">&quot;iPhone XS Max&quot;</span>], id: \.<span class="keyword">self</span>) &#123; deviceName <span class="keyword">in</span></span><br><span class="line">            <span class="type">LandmarkList</span>()</span><br><span class="line">                .previewDevice(<span class="type">PreviewDevice</span>(rawValue: deviceName))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/211152e25bc0bf47a4004a9e14db37a62988641dbc90c805391d7be151fbd173/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393039336136303638362f64366638326161302d663330382d346364632d623934322d6165396134613866613166392e706e67" alt=""></p>
<h2 id="步骤3-21">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-5"></a></p>
<p>使用<code>previewDisplayName(_:)</code>修饰符将设备名称添加为预览的标签。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                    <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ForEach</span>([<span class="string">&quot;iPhone SE&quot;</span>, <span class="string">&quot;iPhone XS Max&quot;</span>], id: \.<span class="keyword">self</span>) &#123; deviceName <span class="keyword">in</span></span><br><span class="line">            <span class="type">LandmarkList</span>()</span><br><span class="line">                .previewDevice(<span class="type">PreviewDevice</span>(rawValue: deviceName))</span><br><span class="line">                .previewDisplayName(deviceName)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/72d9728f29857da99cbbc6d65a54ea98688bea2d7ead6617132e113f755ce77d/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f363434663134663036342f34313930623234332d616636322d343337622d613365312d3930346435333232346630362e706e67" alt=""></p>
<h2 id="步骤4-20">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-5"></a></p>
<p>您可以尝试使用不同的设备来比较视图的渲染，所有这些都来自画布。</p>
<p><img src="https://camo.githubusercontent.com/e276e569fa4b0488ec9d0f2135055373e8f316cb83bb73d2394cf0c9b7af0963/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f386533376136303038342f64616634323962622d336237372d343138662d616431332d6161346239646137316137632e706e67" alt=""></p>
<h3 id="框架集成-2">框架集成</h3>
<p><a href="#%E6%A1%86%E6%9E%B6%E9%9B%86%E6%88%90"></a></p>
<h2 id="创建watchOS应用程序">创建watchOS应用程序</h2>
<p><a href="#%E5%88%9B%E5%BB%BAwatchos%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"></a></p>
<p>本教程为您提供了一个机会，让您可以应用您已经了解的有关SwiftUI的大部分内容，并且只需很少的努力将<code>Landmarks</code>应用程序迁移到<code>watchOS</code>。</p>
<p>在复制为iOS应用程序创建的共享数据和视图之前，您将首先向项目中添加<code>watchOS target</code>。所有资源就绪后，您将自定义SwiftUI视图，以便在<code>watchOS</code>上显示详情视图和列表视图。</p>
<blockquote>
<p>学习时间：25分钟</p>
<p><a target="_blank" rel="noopener" href="https://docs-assets.developer.apple.com/published/2165a283e4/CreatingAwatchOSApp.zip">下载地址：CreatingAwatchOSApp.zip</a></p>
</blockquote>
<h2 id="第一节-添加watchOS-Target">第一节 添加watchOS Target</h2>
<p><a href="#%E7%AC%AC%E4%B8%80%E8%8A%82-%E6%B7%BB%E5%8A%A0watchos-target"></a></p>
<p>要创建watchOS应用程序，请首先将watchOS Target添加到项目中。Xcode将watchOS应用程序的文件夹和文件，以及构建和运行该应用程序所需的方案添加到项目中。</p>
<p><img src="https://camo.githubusercontent.com/94e5cb4d1b6bf9cee0366f72b27112dfbfee7b131f979b7a5c3c25a0f546eba5/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f363332313031353864612f65306461346164642d363265622d343737652d613363622d3134626666653362383361612e706e67" alt=""></p>
<h2 id="步骤1-26">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41"></a></p>
<p>选择<code>File &gt; New &gt; Target</code>。当工作模板表出现时，选择<code>watchOS</code>选项卡，选择<code>Watch App for iOS</code>应用程序模板，然后单击<code>Next</code>。</p>
<p>此模板将新的watchOS应用程序添加到您的项目中，并与iOS应用程序配对。</p>
<p><img src="https://camo.githubusercontent.com/3f1925f86b2fade7e5cdd1a610932de6d20c4e4ab5eb287b08d9814f8171f18b/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f376334633065333137312f64363831333232342d323866362d343031382d383736302d3163623662623936623062332e706e67" alt=""></p>
<h2 id="步骤2-26">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42"></a></p>
<p>在表单中，输入<code>WatchLandmarks</code>作为产品名称。将语言设置为<code>Swift</code>，将用户界面设置为<code>SwiftUI</code>。选中<code>Include Notification Scene</code>复选框，然后单击“Finish”。</p>
<p><img src="https://camo.githubusercontent.com/ae35f464476b2d66628838d67b41534e4270d03640001178b51b630cfe730604/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f306534313063643932332f64613733363431312d346335322d346162662d616535312d3965366464643232366639332e706e67" alt=""></p>
<h2 id="步骤3-22">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43"></a></p>
<blockquote>
<p>如果Xcode提示，请单击“Activate”。</p>
</blockquote>
<p>这将选择<code>WatchLandmarks</code>方案，以便您可以构建和运行watchOS应用程序。</p>
<p><img src="https://camo.githubusercontent.com/e27ae1c3f18e4b9666755eb3a325dc9fb977dccd9a40cf680f486112b0400deb/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f363334663533666536622f35316663376633362d363264612d346461622d386435342d6330366434653738633437372e706e67" alt=""></p>
<h2 id="步骤4-21">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44"></a></p>
<p>在<code>WatchLandmarks</code>扩展的“General”选项卡中，选中<code>Supports Running Without iOS App Installation(支持在不安装iOS应用程序的情况下运行)</code>复选框。</p>
<blockquote>
<p>尽可能创建一个独立的watchOS应用程序。独立的watchOS应用不需要iOS配套应用。</p>
</blockquote>
<p><img src="https://camo.githubusercontent.com/e95d6ca42c552ac8f94552ac39cf826eea201631c2c2f2aa53b9c536cf798c31/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f623439343564306165372f39346632616132382d336365622d343932382d613663662d6435366338626138613464612e706e67" alt=""></p>
<h2 id="第二节-在目标之间共享文件">第二节 在目标之间共享文件</h2>
<p><a href="#%E7%AC%AC%E4%BA%8C%E8%8A%82-%E5%9C%A8%E7%9B%AE%E6%A0%87%E4%B9%8B%E9%97%B4%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6"></a></p>
<p>设置了watchOS目标后，需要共享iOS目标中的一些资源。您将重用<code>Landmark</code>应用程序的数据模型、一些资源文件以及两个平台都可以显示而无需修改的任何视图。</p>
<p><img src="https://camo.githubusercontent.com/1edc28a6d546e1ed24f7e6702f2a723a10290c3e5c38b7bbdaf19d803db63bdd/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f396532653061356561352f66643762633837662d613235652d346561622d383837662d6462366462636362323065382e706e67" alt=""></p>
<h2 id="步骤1-27">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-1"></a></p>
<p>在项目导航器中，单击命令以选择以下文件：LandmarkRow.swift、Landmark.swift、UserData.swift、Data.swift、Profile.swift、Hike.swift和CircleImage.swift。</p>
<p>Landmark.swift、UserData.swift、Data.swift、Profile.swift和Hike.swift定义了应用程序的数据模型。您不会使用模型的所有方面，但需要所有文件才能成功编译应用程序。LandmarkRow.swift和CircleImage.swift都是应用程序可以在watchOS上显示的视图，无需任何更改。</p>
<p><img src="https://camo.githubusercontent.com/ea545188f8eb75b30f9ef0d042a89331accc069e6ceb29d20c9ee060c44b6bdb/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f323531366535363133642f39353732313666652d616632622d343965632d616430652d6639653731643638323162652e706e67" alt=""></p>
<h2 id="步骤2-27">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-1"></a></p>
<p>在“文件检查器”中，选中“Target Membership”部分中的“WatchLandmarks Extension”复选框。</p>
<p><img src="https://camo.githubusercontent.com/98daa11ce8e23aae78655dbcbb344fab78364e24b96bc2d079bf4076c96d8a38/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f666538373435363936342f32353861333461652d613536352d343364342d613261392d3436356636653562393939392e706e67" alt=""></p>
<blockquote>
<p>这使您在上一步中选择的文件可用于watchOS应用程序。</p>
</blockquote>
<h2 id="步骤3-23">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-1"></a></p>
<p>在项目导航器中，选择Landmark组中的Assets.xclassets文件，并将其添加到<code>File</code>检查器的<code>Target Membership</code>部分中的<code>WatchLandmarks</code> Target中。</p>
<p>这与您在上一步中选择的<code>Target</code>不同。<code>WatchLandmarks Extension</code> Target包含你的应用程序的代码，而<code>WatchLandmarks Target</code>管理脚本、图标和相关资源。</p>
<p><img src="https://camo.githubusercontent.com/0b9dbaa9d025d35d817a7c05ca880f6feb9eefb10678aaa655125a215cad0593/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f343239303166333030652f66643362663461652d343539622d343638652d623631312d6561636235613433353862322e706e67" alt=""></p>
<h2 id="步骤4-22">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-1"></a></p>
<p>在项目导航器中，选择<code>Resources</code>文件夹中的所有文件，然后在<code>File</code>检查器的<code>Target Membership</code>中将它们添加到<code>WatchLandmarks Extension</code> target中。</p>
<p><img src="https://camo.githubusercontent.com/ec10e16d166dfdf5a2c40538ba019261705f7c623dd8860d6cf9bf388666cc05/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f643662376136323537342f38313462303931662d313832392d346639612d396439652d3365663137613038616635362e706e67" alt=""></p>
<h2 id="第三节-创建详情视图">第三节 创建详情视图</h2>
<p><a href="#%E7%AC%AC%E4%B8%89%E8%8A%82-%E5%88%9B%E5%BB%BA%E8%AF%A6%E6%83%85%E8%A7%86%E5%9B%BE"></a></p>
<p>现在iOS目标资源已经准备好用于watch应用程序，您需要创建一个watch的视图来显示地标详情。为了测试详情视图，您将为最大和最小的手表尺寸创建自定义预览，并对圆形视图进行一些更改，以便所有内容都适合手表界面。</p>
<p><img src="https://camo.githubusercontent.com/a0426ec1422661dea3b047ab629887a05f43745897c6f338c4067f054e40cad2/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393838393463356262642f63346534646538382d626138652d343962392d396136652d3030656439626335376633622e706e67" alt=""></p>
<h2 id="步骤1-28">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-2"></a></p>
<p>在项目导航器中，单击<code>WatchLandmarks Extension</code>文件夹旁边的三角形以显示其内容，然后添加名为<code>WatchLandmarkDetail</code>的新SwiftUI视图。</p>
<p><img src="https://camo.githubusercontent.com/8b29e4d0ecfe281efce56192f299c9b98ae900700b71deb605ce17c58c39686c/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f666566643362356538372f37376436306238312d623132622d343232302d616565302d3939383339643931363837362e706e67" alt=""></p>
<h2 id="步骤2-28">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-2"></a></p>
<p>将<code>userData、landmark、landmarkIndex</code>属性添加到<code>WatchLandmarkDetail</code>结构中。</p>
<p>这些属性与您在Handling User Input时添加到<code>LandmarkDetail</code>结构中的属性相同。</p>
<blockquote>
<p>WatchLandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello World!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">WatchLandmarkDetail</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在上一步中添加属性后，Xcode中将出现参数丢失错误。要修复错误，您需要执行以下两项操作之一：为属性提供默认值，或传递参数设置视图的属性。</p>
</blockquote>
<h2 id="步骤3-24">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-2"></a></p>
<p>在预览中，创建用户数据的实例，并使用它将<code>landmark</code>对象传递给<code>WatchLandmarkView</code>结构的初始值。还需要将用户数据设置为视图的环境对象。</p>
<blockquote>
<p>WatchLandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello World!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> userData <span class="operator">=</span> <span class="type">UserData</span>()</span><br><span class="line">        <span class="keyword">return</span> <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">0</span>])</span><br><span class="line">            .environmentObject(userData)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/52c7d41a324a48a3eb1df51ec58a274b897760eb9a34e23e53390b29c03ff4ba/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f316637333639333863382f61386131383764652d356539622d343239312d623936632d3663636162626233346638392e706e67" alt=""></p>
<h2 id="步骤4-23">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-2"></a></p>
<p>在<code>WatchLandmarkDetail.swift</code>中，从<code>body（）</code>方法返回<code>CircleImage</code>视图。</p>
<p>在这里，您可以重用iOS项目中的CircleImage视图。因为您创建了一个可调整大小的图像，所以调用<code>.scaledToFill（）</code>将调整圆的大小，使其自动适配显示。</p>
<blockquote>
<p>WatchLandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CircleImage</span>(image: <span class="keyword">self</span>.landmark.image.resizable())</span><br><span class="line">            .scaledToFill()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> userData <span class="operator">=</span> <span class="type">UserData</span>()</span><br><span class="line">        <span class="keyword">return</span> <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">0</span>])</span><br><span class="line">            .environmentObject(userData)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤5-12">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45"></a></p>
<p>为最大（44毫米）和最小（38毫米）的表盘创建预览。</p>
<p>通过对最大和最小的手表表面进行测试，你可以看到你的应用程序在屏幕上的缩放效果。一如既往，您应该在所有支持的设备大小上测试用户界面。</p>
<blockquote>
<p>WatchLandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CircleImage</span>(image: <span class="keyword">self</span>.landmark.image.resizable())</span><br><span class="line">            .scaledToFill()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> userData <span class="operator">=</span> <span class="type">UserData</span>()</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">0</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 4 - 44mm&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">1</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 2 - 38mm&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/11cbfa48139c2ad01549d97b5a9cef1482ce2f8e52edd920e278dad0c7ee3f8e/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f373432643533393730322f32626266363065642d363139372d346636342d383535352d3061383465323561313766622e706e67" alt=""></p>
<blockquote>
<p>圆形图像将调整大小以适配显示的高度。不幸的是，这也限制了圆的宽度。要解决裁减问题，您需要将图像嵌入<code>VStack</code>中，并进行一些额外的布局更改，以便圆形图像适合任何手表的宽度。</p>
</blockquote>
<h2 id="步骤6-9">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46"></a></p>
<p>将圆图像嵌入到<code>VStack</code>中。在图像下方显示地标名称及其信息。</p>
<p>如您所见，该信息不太适合在表盘屏幕上显示，但您可以通过将VStack放在滚动视图中来解决这个问题。</p>
<blockquote>
<p>WatchLandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">CircleImage</span>(image: <span class="keyword">self</span>.landmark.image.resizable())</span><br><span class="line">                .scaledToFill()</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="keyword">self</span>.landmark.name)</span><br><span class="line">                .font(.headline)</span><br><span class="line">                .lineLimit(<span class="number">0</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Toggle</span>(isOn:</span><br><span class="line">            <span class="variable">$userData</span>.landmarks[<span class="keyword">self</span>.landmarkIndex].isFavorite) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Favorite&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">Divider</span>()</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="keyword">self</span>.landmark.park)</span><br><span class="line">                .font(.caption)</span><br><span class="line">                .bold()</span><br><span class="line">                .lineLimit(<span class="number">0</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="keyword">self</span>.landmark.state)</span><br><span class="line">                .font(.caption)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> userData <span class="operator">=</span> <span class="type">UserData</span>()</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">0</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 4 - 44mm&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">1</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 2 - 38mm&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/2c3962044d2e8fb9d52feabbda3f0efa434ad2dcdccb3522561c45264d3c2e0a/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663831373162393463612f62633039313630392d363564362d343436332d383436342d6433613566336632613035312e706e67" alt=""></p>
<h2 id="步骤7-4">步骤7</h2>
<p><a href="#%E6%AD%A5%E9%AA%A47"></a></p>
<p>在滚动视图中包装<code>VStack</code>。</p>
<p>这会打开视图滚动，但会产生另一个问题：圆形图像现在会扩展到原大小，并且会调整其他UI元素的大小以匹配图像大小。您需要调整圆图像的大小，以便屏幕上只显示圆和地标名称。</p>
<blockquote>
<p>WatchLandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ScrollView</span> &#123;</span><br><span class="line">            <span class="type">VStack</span> &#123;</span><br><span class="line">                <span class="type">CircleImage</span>(image: <span class="keyword">self</span>.landmark.image.resizable())</span><br><span class="line">                    .scaledToFill()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.name)</span><br><span class="line">                    .font(.headline)</span><br><span class="line">                    .lineLimit(<span class="number">0</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="type">Toggle</span>(isOn:</span><br><span class="line">                <span class="variable">$userData</span>.landmarks[<span class="keyword">self</span>.landmarkIndex].isFavorite) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Favorite&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="type">Divider</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.park)</span><br><span class="line">                    .font(.caption)</span><br><span class="line">                    .bold()</span><br><span class="line">                    .lineLimit(<span class="number">0</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.state)</span><br><span class="line">                    .font(.caption)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> userData <span class="operator">=</span> <span class="type">UserData</span>()</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">0</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 4 - 44mm&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">1</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 2 - 38mm&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/6bba9cde52680e0519f897f766fbbc853ab2e9b7a2672272b69464f0886d3759/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f353636613563623838342f39643437616339662d323061392d346466652d393332642d3532636461346266393932342e706e67" alt=""></p>
<h2 id="步骤8-3">步骤8</h2>
<p><a href="#%E6%AD%A5%E9%AA%A48"></a></p>
<p>将<code>scaleToFill（）</code>更改为<code>scaleToFit（）</code>。</p>
<p>这将缩放圆图像以匹配显示器的宽度。</p>
<blockquote>
<p>WatchLandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ScrollView</span> &#123;</span><br><span class="line">            <span class="type">VStack</span> &#123;</span><br><span class="line">                <span class="type">CircleImage</span>(image: <span class="keyword">self</span>.landmark.image.resizable())</span><br><span class="line">                    .scaledToFit()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.name)</span><br><span class="line">                    .font(.headline)</span><br><span class="line">                    .lineLimit(<span class="number">0</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="type">Toggle</span>(isOn:</span><br><span class="line">                <span class="variable">$userData</span>.landmarks[<span class="keyword">self</span>.landmarkIndex].isFavorite) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Favorite&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="type">Divider</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.park)</span><br><span class="line">                    .font(.caption)</span><br><span class="line">                    .bold()</span><br><span class="line">                    .lineLimit(<span class="number">0</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.state)</span><br><span class="line">                    .font(.caption)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> userData <span class="operator">=</span> <span class="type">UserData</span>()</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">0</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 4 - 44mm&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">1</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 2 - 38mm&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/e6834923fb4a19e1e1f84d6b508b58c798d0184d8e46f8f5841f8d8a6c775b73/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f323761386531653230612f61333830633264632d343361342d346265362d386639322d3339303463353931356536662e706e67" alt=""></p>
<h2 id="步骤9-3">步骤9</h2>
<p><a href="#%E6%AD%A5%E9%AA%A49"></a></p>
<p>添加<code>padding</code>，使地标名称在圆图像下方可见。</p>
<blockquote>
<p>WatchLandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ScrollView</span> &#123;</span><br><span class="line">            <span class="type">VStack</span> &#123;</span><br><span class="line">                <span class="type">CircleImage</span>(image: <span class="keyword">self</span>.landmark.image.resizable())</span><br><span class="line">                    .scaledToFit()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.name)</span><br><span class="line">                    .font(.headline)</span><br><span class="line">                    .lineLimit(<span class="number">0</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="type">Toggle</span>(isOn:</span><br><span class="line">                <span class="variable">$userData</span>.landmarks[<span class="keyword">self</span>.landmarkIndex].isFavorite) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Favorite&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="type">Divider</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.park)</span><br><span class="line">                    .font(.caption)</span><br><span class="line">                    .bold()</span><br><span class="line">                    .lineLimit(<span class="number">0</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.state)</span><br><span class="line">                    .font(.caption)</span><br><span class="line">            &#125;</span><br><span class="line">            .padding(<span class="number">16</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> userData <span class="operator">=</span> <span class="type">UserData</span>()</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">0</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 4 - 44mm&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">1</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 2 - 38mm&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/0b02ca1bf5ca5290d18b14f1bada438174e7f0f2402042aa4dfed889e7a76e59/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393436633830326330302f35633633636462372d663166362d343863642d386662362d6332613162653432383335652e706e67" alt=""></p>
<h2 id="步骤10-2">步骤10</h2>
<p><a href="#%E6%AD%A5%E9%AA%A410"></a></p>
<p>在<code>后退</code>按钮上添加标题。</p>
<p>这会将后退按钮的文本设置为“地标”。但是，在添加“地标列表”视图之前，您不会看到“后退”按钮。</p>
<blockquote>
<p>WatchLandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ScrollView</span> &#123;</span><br><span class="line">            <span class="type">VStack</span> &#123;</span><br><span class="line">                <span class="type">CircleImage</span>(image: <span class="keyword">self</span>.landmark.image.resizable())</span><br><span class="line">                    .scaledToFit()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.name)</span><br><span class="line">                    .font(.headline)</span><br><span class="line">                    .lineLimit(<span class="number">0</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="type">Toggle</span>(isOn:</span><br><span class="line">                <span class="variable">$userData</span>.landmarks[<span class="keyword">self</span>.landmarkIndex].isFavorite) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Favorite&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="type">Divider</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.park)</span><br><span class="line">                    .font(.caption)</span><br><span class="line">                    .bold()</span><br><span class="line">                    .lineLimit(<span class="number">0</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.state)</span><br><span class="line">                    .font(.caption)</span><br><span class="line">            &#125;</span><br><span class="line">            .padding(<span class="number">16</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="string">&quot;Landmarks&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> userData <span class="operator">=</span> <span class="type">UserData</span>()</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">0</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 4 - 44mm&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">1</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 2 - 38mm&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/0b02ca1bf5ca5290d18b14f1bada438174e7f0f2402042aa4dfed889e7a76e59/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393436633830326330302f35633633636462372d663166362d343863642d386662362d6332613162653432383335652e706e67" alt=""></p>
<h2 id="第四节-添加watchOS地图视图">第四节 添加watchOS地图视图</h2>
<p><a href="#%E7%AC%AC%E5%9B%9B%E8%8A%82-%E6%B7%BB%E5%8A%A0watchos%E5%9C%B0%E5%9B%BE%E8%A7%86%E5%9B%BE"></a></p>
<p>现在您已经创建了基本详情视图，现在是时候添加一个地图来显示地标的位置了。与<code>CircleImage</code>不同，你不能重用iOS应用程序的<code>MapView</code>。相反，您需要创建一个<code>WKInterfaceObjectRepresentable</code>结构来包装<code>WatchKit</code>的地图视图。</p>
<p><img src="https://camo.githubusercontent.com/53b2572627149ce7fb0b40d2c07f7bd257519607b195f956ae26ef8abc4d7a19/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f313738306665356134352f37623630306664352d386637302d346365362d626532652d6434666338313530326139382e706e67" alt=""></p>
<h2 id="步骤1-29">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-3"></a></p>
<p>向<code>WatchKit extension</code>添加名为<code>WatchMapView</code>的自定义视图。</p>
<blockquote>
<p>WatchMapView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchMapView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello World!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchMapView_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">WatchMapView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/52c7d41a324a48a3eb1df51ec58a274b897760eb9a34e23e53390b29c03ff4ba/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f316637333639333863382f61386131383764652d356539622d343239312d623936632d3663636162626233346638392e706e67" alt=""></p>
<h2 id="步骤2-29">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-3"></a></p>
<blockquote>
<p>在<code>WatchMapView</code>结构中，将View更改为<code>WKInterfaceObjectRepresentable</code>。</p>
</blockquote>
<p>要查看区别，请在步骤1和2所示的代码之间来回滚动。</p>
<blockquote>
<p>WatchMapView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchMapView</span>: <span class="title class_ inherited__">WKInterfaceObjectRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello World!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchMapView_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">WatchMapView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Xcode显示编译错误，因为WatchMapView尚未实现<code>WKInterfaceObjectRepresentable</code>协议属性。</p>
</blockquote>
<h2 id="步骤3-25">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-3"></a></p>
<p>删除<code>body（）</code>方法并将其替换为<code>landmark</code>属性。</p>
<p>无论何时创建地图视图，都需要传递此属性的值。例如，可以将<code>landmark</code>的实例传递给预览。</p>
<blockquote>
<p>WatchMapView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchMapView</span>: <span class="title class_ inherited__">WKInterfaceObjectRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchMapView_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">WatchMapView</span>(landmark: <span class="type">UserData</span>().landmarks[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤4-24">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-3"></a></p>
<p>实现<code>WKInterfaceObjectRepresentable</code>的<code>makeWKInterfaceObject(context:)</code> 方法。</p>
<p>此方法用来创建<code>WatchMapView</code>显示的<code>WatchKit</code>地图。</p>
<blockquote>
<p>WatchMapView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchMapView</span>: <span class="title class_ inherited__">WKInterfaceObjectRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeWKInterfaceObject</span>(<span class="params">context</span>: <span class="type">WKInterfaceObjectRepresentableContext</span>&lt;<span class="type">WatchMapView</span>&gt;) -&gt; <span class="type">WKInterfaceMap</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">WKInterfaceMap</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchMapView_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">WatchMapView</span>(landmark: <span class="type">UserData</span>().landmarks[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤5-13">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-1"></a></p>
<p>通过实现<code>WKInterfaceObjectRepresentable</code>的<code>updateWKInterfaceObject（_:，context:）</code>方法，根据地标的坐标设置地图的区域。</p>
<p>现在，编译成功了。</p>
<blockquote>
<p>WatchMapView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchMapView</span>: <span class="title class_ inherited__">WKInterfaceObjectRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeWKInterfaceObject</span>(<span class="params">context</span>: <span class="type">WKInterfaceObjectRepresentableContext</span>&lt;<span class="type">WatchMapView</span>&gt;) -&gt; <span class="type">WKInterfaceMap</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">WKInterfaceMap</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateWKInterfaceObject</span>(<span class="keyword">_</span> <span class="params">map</span>: <span class="type">WKInterfaceMap</span>, <span class="params">context</span>: <span class="type">WKInterfaceObjectRepresentableContext</span>&lt;<span class="type">WatchMapView</span>&gt;) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> span <span class="operator">=</span> <span class="type">MKCoordinateSpan</span>(latitudeDelta: <span class="number">0.02</span>,</span><br><span class="line">            longitudeDelta: <span class="number">0.02</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> region <span class="operator">=</span> <span class="type">MKCoordinateRegion</span>(</span><br><span class="line">            center: landmark.locationCoordinate,</span><br><span class="line">            span: span)</span><br><span class="line">        </span><br><span class="line">        map.setRegion(region)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchMapView_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">WatchMapView</span>(landmark: <span class="type">UserData</span>().landmarks[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/5551ad7b71c54a37f15c63d1056aac1c7f0c5e8e1519cc2f166a73a61fa53bdb/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f356330373736623463622f39396533356233612d306333652d343063312d613739332d6261656261626230323734642e706e67" alt=""></p>
<h2 id="步骤6-10">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46-1"></a></p>
<p>选择<code>WatchLandmarkView.swift</code>文件并将地图视图添加到<code>VStack</code>的底部。</p>
<p>代码添加了一个分隔符，后跟地图视图。<code>.scaledToFit（）</code>和<code>.padding（）</code>修饰符将地图以合适的大小适配屏幕。</p>
<blockquote>
<p>WatchLandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ScrollView</span> &#123;</span><br><span class="line">            <span class="type">VStack</span> &#123;</span><br><span class="line">                <span class="type">CircleImage</span>(image: <span class="keyword">self</span>.landmark.image.resizable())</span><br><span class="line">                    .scaledToFit()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.name)</span><br><span class="line">                    .font(.headline)</span><br><span class="line">                    .lineLimit(<span class="number">0</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="type">Toggle</span>(isOn:</span><br><span class="line">                <span class="variable">$userData</span>.landmarks[<span class="keyword">self</span>.landmarkIndex].isFavorite) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Favorite&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="type">Divider</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.park)</span><br><span class="line">                    .font(.caption)</span><br><span class="line">                    .bold()</span><br><span class="line">                    .lineLimit(<span class="number">0</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.state)</span><br><span class="line">                    .font(.caption)</span><br><span class="line">                </span><br><span class="line">                <span class="type">Divider</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">WatchMapView</span>(landmark: <span class="keyword">self</span>.landmark)</span><br><span class="line">                    .scaledToFit()</span><br><span class="line">                    .padding()</span><br><span class="line">            &#125;</span><br><span class="line">            .padding(<span class="number">16</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="string">&quot;Landmarks&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> userData <span class="operator">=</span> <span class="type">UserData</span>()</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">0</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 4 - 44mm&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">1</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 2 - 38mm&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/b1c95ec69bb97575ea43a15c8c0740e0f9643f936edcfb9eb0d05f2a95e269fd/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663336383661313061612f63303138653933642d636538342d343762622d623730632d3436336530343834336131342e706e67" alt=""></p>
<h2 id="第五节-创建跨平台列表视图">第五节 创建跨平台列表视图</h2>
<p><a href="#%E7%AC%AC%E4%BA%94%E8%8A%82-%E5%88%9B%E5%BB%BA%E8%B7%A8%E5%B9%B3%E5%8F%B0%E5%88%97%E8%A1%A8%E8%A7%86%E5%9B%BE"></a></p>
<p>对于地标列表，您可以重用iOS应用程序中的行<code>Row</code>，但每个平台都需要呈现自己的详情视图。为了支持这一点，您将把LandmarkList视图转换为泛型列表类型，在这里实例化代码定义了详情视图。</p>
<h2 id="步骤1-在工具栏中，选择Landmarks-scheme。">步骤1 在工具栏中，选择<code>Landmarks scheme</code>。</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-%E5%9C%A8%E5%B7%A5%E5%85%B7%E6%A0%8F%E4%B8%AD%E9%80%89%E6%8B%A9landmarks-scheme"></a></p>
<p>Xcode现在编译并运行应用程序的iOS版本。在将列表移动到watchOS应用程序之前，您要确保对<code>LandmarkList</code>视图的任何修改在iOS应用程序中仍然有效。</p>
<p><img src="https://camo.githubusercontent.com/fa82bdc504625c6f764d35ff385f348b7bbca93a267ab913261dfa8611a4be51/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f383264316230653466632f38313034303539622d396138612d346434662d616362382d6561376664386537376462372e706e67" alt=""></p>
<h2 id="步骤2-30">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-4"></a></p>
<p>选择<code>LandmarkList.swift</code>并更改类型声明，使其成为泛型类型。</p>
<blockquote>
<p>LandmarksList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>&lt;<span class="type">DetailView</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">private</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Toggle</span>(isOn: <span class="variable">$userData</span>.showFavoritesOnly) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Show Favorites Only&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">ForEach</span>(userData.landmarks) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.userData.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                    <span class="type">NavigationLink</span>(</span><br><span class="line">                    destination: <span class="type">LandmarkDetail</span>(landmark: landmark).environmentObject(<span class="keyword">self</span>.userData)) &#123;</span><br><span class="line">                        <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarksList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ForEach</span>([<span class="string">&quot;iPhone SE&quot;</span>, <span class="string">&quot;iPhone XS Max&quot;</span>].identified(by: \.<span class="keyword">self</span>)) &#123; deviceName <span class="keyword">in</span></span><br><span class="line">            <span class="type">LandmarkList</span>()</span><br><span class="line">                .previewDevice(<span class="type">PreviewDevice</span>(rawValue: deviceName))</span><br><span class="line">                .previewDisplayName(deviceName)</span><br><span class="line">        &#125;</span><br><span class="line">        .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在创建<code>LandmarkList</code>结构的实例时，添加泛型声明会导致<code>Generic parameter could not be inferred(无法推断泛型参数)</code>错误。以下步骤会修复这些错误。</p>
</blockquote>
<h2 id="步骤3-26">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-4"></a></p>
<p>为创建局部视图的闭包添加属性。</p>
<blockquote>
<p>LandmarksList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>&lt;<span class="type">DetailView</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">private</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> detailViewProducer: (<span class="type">Landmark</span>) -&gt; <span class="type">DetailView</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Toggle</span>(isOn: <span class="variable">$userData</span>.showFavoritesOnly) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Show Favorites Only&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">ForEach</span>(userData.landmarks) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.userData.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                    <span class="type">NavigationLink</span>(</span><br><span class="line">                    destination: <span class="type">LandmarkDetail</span>(landmark: landmark).environmentObject(<span class="keyword">self</span>.userData)) &#123;</span><br><span class="line">                        <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarksList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ForEach</span>([<span class="string">&quot;iPhone SE&quot;</span>, <span class="string">&quot;iPhone XS Max&quot;</span>].identified(by: \.<span class="keyword">self</span>)) &#123; deviceName <span class="keyword">in</span></span><br><span class="line">            <span class="type">LandmarkList</span>()</span><br><span class="line">                .previewDevice(<span class="type">PreviewDevice</span>(rawValue: deviceName))</span><br><span class="line">                .previewDisplayName(deviceName)</span><br><span class="line">        &#125;</span><br><span class="line">        .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤4-25">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-4"></a></p>
<p>使用<code>detailViewProducer</code>属性为地标创建详情视图。</p>
<blockquote>
<p>LandmarksList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>&lt;<span class="type">DetailView</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">private</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> detailViewProducer: (<span class="type">Landmark</span>) -&gt; <span class="type">DetailView</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Toggle</span>(isOn: <span class="variable">$userData</span>.showFavoritesOnly) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Show Favorites Only&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">ForEach</span>(userData.landmarks) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.userData.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                    <span class="type">NavigationLink</span>(</span><br><span class="line">                    destination: <span class="keyword">self</span>.detailViewProducer(landmark).environmentObject(<span class="keyword">self</span>.userData)) &#123;</span><br><span class="line">                        <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarksList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ForEach</span>([<span class="string">&quot;iPhone SE&quot;</span>, <span class="string">&quot;iPhone XS Max&quot;</span>].identified(by: \.<span class="keyword">self</span>)) &#123; deviceName <span class="keyword">in</span></span><br><span class="line">            <span class="type">LandmarkList</span>()</span><br><span class="line">                .previewDevice(<span class="type">PreviewDevice</span>(rawValue: deviceName))</span><br><span class="line">                .previewDisplayName(deviceName)</span><br><span class="line">        &#125;</span><br><span class="line">        .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>创建<code>LandmarkList</code>实例时，还需要提供一个闭包，用于创建<code>landmark</code>的详情视图。</p>
</blockquote>
<h2 id="步骤5-14">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-2"></a></p>
<p>选择Home.swift。在<code>CategoryHome</code>结构的<code>body（）</code>方法中，添加闭包以创建<code>LandmarkDetail</code>视图。</p>
<p>Xcode根据闭包的返回值推断<code>LandmarkList</code>结构的泛型类型。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categories: [<span class="type">String</span>: [<span class="type">Landmark</span>]] &#123;</span><br><span class="line">        <span class="type">Dictionary</span>(</span><br><span class="line">            grouping: landmarkData,</span><br><span class="line">            by: &#123; <span class="variable">$0</span>.category.rawValue &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> featured: [<span class="type">Landmark</span>] &#123;</span><br><span class="line">        landmarkData.filter &#123; <span class="variable">$0</span>.isFeatured &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showingProfile <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> profileButton: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span>(action: &#123; <span class="keyword">self</span>.showingProfile.toggle() &#125;) &#123;</span><br><span class="line">            <span class="type">Image</span>(systemName: <span class="string">&quot;person.crop.circle&quot;</span>)</span><br><span class="line">                .imageScale(.large)</span><br><span class="line">                .accessibility(label: <span class="type">Text</span>(<span class="string">&quot;User Profile&quot;</span>))</span><br><span class="line">                .padding()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">FeaturedLandmarks</span>(landmarks: featured)</span><br><span class="line">                    .scaledToFill()</span><br><span class="line">                    .frame(height: <span class="type">CGFloat</span>(<span class="number">200</span>))</span><br><span class="line">                    .clipped()</span><br><span class="line">                    .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">                </span><br><span class="line">                <span class="type">ForEach</span>(categories.keys.sorted(), id: \.<span class="keyword">self</span>) &#123; key <span class="keyword">in</span></span><br><span class="line">                    <span class="type">CategoryRow</span>(categoryName: key, items: <span class="keyword">self</span>.categories[key]<span class="operator">!</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">                </span><br><span class="line">                <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkList</span> &#123; <span class="type">LandmarkDetail</span>(landmark: <span class="variable">$0</span>) &#125;) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;See All&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Featured&quot;</span>))</span><br><span class="line">            .navigationBarItems(trailing: profileButton)</span><br><span class="line">            .sheet(isPresented: <span class="variable">$showingProfile</span>) &#123;</span><br><span class="line">                <span class="type">ProfileHost</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FeaturedLandmarks</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmarks: [<span class="type">Landmark</span>]</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        landmarks[<span class="number">0</span>].image.resizable()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// swiftlint:disable type_name</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">            .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤6-11">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46-2"></a></p>
<p>在LandmarkList.swift中，向预览添加类似的代码。</p>
<p>在这里，您需要使用条件判断，根据Xcode编译的当前<code>scheme</code>定义详情视图。现在地标应用程序可以按照预期在iOS上构建和运行了。</p>
<blockquote>
<p>LandmarksList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>&lt;<span class="type">DetailView</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">private</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> detailViewProducer: (<span class="type">Landmark</span>) -&gt; <span class="type">DetailView</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Toggle</span>(isOn: <span class="variable">$userData</span>.showFavoritesOnly) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Show Favorites Only&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">ForEach</span>(userData.landmarks) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.userData.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                    <span class="type">NavigationLink</span>(</span><br><span class="line">                    destination: <span class="keyword">self</span>.detailViewProducer(landmark).environmentObject(<span class="keyword">self</span>.userData)) &#123;</span><br><span class="line">                        <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">#if</span> os(watchOS)</span><br><span class="line"><span class="keyword">typealias</span> <span class="type">PreviewDetailView</span> <span class="operator">=</span> <span class="type">WatchLandmarkDetail</span></span><br><span class="line"><span class="keyword">#else</span></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">PreviewDetailView</span> <span class="operator">=</span> <span class="type">LandmarkDetail</span></span><br><span class="line"><span class="keyword">#endif</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span> &#123; <span class="type">PreviewDetailView</span>(landmark: <span class="variable">$0</span>) &#125;</span><br><span class="line">            .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/155253a23fe7a02f9e435374ece449f3d092a622da3841dd7353dc1135ba1b25/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f656164323837616138322f66396236376132322d313936632d343064372d386630302d3132323033643730626535302e706e67" alt=""></p>
<h2 id="第六节-添加地标列表">第六节 添加地标列表</h2>
<p><a href="#%E7%AC%AC%E5%85%AD%E8%8A%82-%E6%B7%BB%E5%8A%A0%E5%9C%B0%E6%A0%87%E5%88%97%E8%A1%A8"></a></p>
<p>现在您已经更新了LandmarksList视图，以便它在两个平台上都能工作，您可以将其添加到watchOS应用程序中。</p>
<p><img src="https://camo.githubusercontent.com/b36132b3627950a40351115d6c1c9f2d198d1e46e8d2fdd493a44c0299ac446a/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393964396135313461382f63633463373830662d383065382d343139362d393632332d6634653731663636666165302e706e67" alt=""></p>
<h2 id="步骤1-30">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-4"></a></p>
<p>在文件检查器中，将<code>LandmarksList.swift</code>添加到<code>WatchLandmarks Extension</code>Target。</p>
<p>现在可以在watchOS应用程序的代码中使用LandmarkList视图。</p>
<p><img src="https://camo.githubusercontent.com/d6270016341abca60586d0bcd80f66db55284bb4841e76f6f1f4885612d473dd/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f623666656465613266642f35333239623336652d326261302d343633662d623038342d3933386465666665643934322e706e67" alt=""></p>
<h2 id="步骤2-31">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-5"></a></p>
<p>在工具栏中，将<code>scheme</code>更改为<code>WatchLandmarks</code>。</p>
<p><img src="https://camo.githubusercontent.com/8e530ec5f9e0f7ffb6dbe22b95af0564eb1ca8cff023b8da7b3bdd2595f7bd28/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f373561623437356338612f39336539613464372d343039622d343233362d383336632d6566353765383161626532352e706e67" alt=""></p>
<h2 id="步骤3-27">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-5"></a></p>
<p>打开<code>LandmarkList.swift</code>，继续预览。</p>
<p>预览现在显示watchOS列表视图。</p>
<blockquote>
<p>LandmarksList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>&lt;<span class="type">DetailView</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">private</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> detailViewProducer: (<span class="type">Landmark</span>) -&gt; <span class="type">DetailView</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Toggle</span>(isOn: <span class="variable">$userData</span>.showFavoritesOnly) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Show Favorites Only&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">ForEach</span>(userData.landmarks) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.userData.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                    <span class="type">NavigationLink</span>(</span><br><span class="line">                    destination: <span class="keyword">self</span>.detailViewProducer(landmark).environmentObject(<span class="keyword">self</span>.userData)) &#123;</span><br><span class="line">                        <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">#if</span> os(watchOS)</span><br><span class="line"><span class="keyword">typealias</span> <span class="type">PreviewDetailView</span> <span class="operator">=</span> <span class="type">WatchLandmarkDetail</span></span><br><span class="line"><span class="keyword">#else</span></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">PreviewDetailView</span> <span class="operator">=</span> <span class="type">LandmarkDetail</span></span><br><span class="line"><span class="keyword">#endif</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span> &#123; <span class="type">PreviewDetailView</span>(landmark: <span class="variable">$0</span>) &#125;</span><br><span class="line">            .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>watchOS应用程序的根视图是ContentView，它显示默认文本<code>Hello World！</code>。</p>
</blockquote>
<p><img src="https://camo.githubusercontent.com/a30f9cebda3c540a1e1fe0292baf157da40c156769c84d0739fcab1e930c17ba/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f346230666337396331342f65663032396237332d656637622d343939352d393566352d3862646339613030653636612e706e67" alt=""></p>
<h2 id="步骤4-26">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-5"></a></p>
<p>修改ContentView，使其显示列表视图。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span> &#123; <span class="type">WatchLandmarkDetail</span>(landmark: <span class="variable">$0</span>) &#125;</span><br><span class="line">            .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span> &#123; <span class="type">WatchLandmarkDetail</span>(landmark: <span class="variable">$0</span>) &#125;</span><br><span class="line">            .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/a30f9cebda3c540a1e1fe0292baf157da40c156769c84d0739fcab1e930c17ba/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f346230666337396331342f65663032396237332d656637622d343939352d393566352d3862646339613030653636612e706e67" alt=""></p>
<h2 id="步骤5-15">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-3"></a></p>
<p>在模拟器中编译运行watchOS应用程序。</p>
<p>通过滚动列表中的地标来测试watchOS应用程序的行为，点击以查看地标的详细信息，并将其标记为收藏夹。单击<code>back</code>按钮返回列表，然后打开<code>Favorite</code>开关，这样您只能看到收藏的地标。</p>
<p><img src="https://camo.githubusercontent.com/dbca4e8fc36442494ed03ed86a398c0097cd6bf49c6b6b142c23852c6e387189/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f626461336236636435662f30633332306434632d386131352d346261312d393138322d3264383231333239343366362e706e67" alt=""></p>
<h2 id="第7节-创建自定义通知界面">第7节 创建自定义通知界面</h2>
<p><a href="#%E7%AC%AC7%E8%8A%82-%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E9%80%9A%E7%9F%A5%E7%95%8C%E9%9D%A2"></a></p>
<p>你的watchOS版地标应用程序几乎完成了。在这最后一部分中，您将创建一个通知界面，每当您离最喜欢的某一位置很近时，会收到地标信息的通知信息。</p>
<p><img src="https://camo.githubusercontent.com/c72963e1dff238ad5c763a4eeb9497a4e3405611aee70cabf5a39196b4cf9a81/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f333739646434353933332f36366236343234342d633164662d343963372d383936362d6639333234396435656136302e706e67" alt=""></p>
<blockquote>
<p>注意：本节仅介绍如何在收到通知后显示通知。它不描述如何设置或发送通知。</p>
</blockquote>
<h2 id="步骤1-31">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-5"></a></p>
<p>打开<code>NotificationView.swift</code>并创建一个显示有关地标、标题和消息的信息的视图。</p>
<p>因为任何通知值都可以为nil，所以预览将显示通知视图的两个版本。第一个仅在未提供数据时显示默认值，第二个显示您提供的标题、消息和位置。</p>
<blockquote>
<p>NotificationView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">NotificationView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> title: <span class="type">String</span>?</span><br><span class="line">    <span class="keyword">let</span> message: <span class="type">String</span>?</span><br><span class="line">    <span class="keyword">let</span> landmark: <span class="type">Landmark</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">title</span>: <span class="type">String</span>? <span class="operator">=</span> <span class="literal">nil</span>,</span><br><span class="line">         <span class="params">message</span>: <span class="type">String</span>? <span class="operator">=</span> <span class="literal">nil</span>,</span><br><span class="line">         <span class="params">landmark</span>: <span class="type">Landmark</span>? <span class="operator">=</span> <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.title <span class="operator">=</span> title</span><br><span class="line">        <span class="keyword">self</span>.message <span class="operator">=</span> message</span><br><span class="line">        <span class="keyword">self</span>.landmark <span class="operator">=</span> landmark</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> landmark <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">                <span class="type">CircleImage</span>(image: landmark<span class="operator">!</span>.image.resizable())</span><br><span class="line">                    .scaledToFit()</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(title <span class="operator">??</span> <span class="string">&quot;Unknown Landmark&quot;</span>)</span><br><span class="line">                .font(.headline)</span><br><span class="line">                .lineLimit(<span class="number">0</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Divider</span>()</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(message <span class="operator">??</span> <span class="string">&quot;You are within 5 miles of one of your favorite landmarks.&quot;</span>)</span><br><span class="line">                .font(.caption)</span><br><span class="line">                .lineLimit(<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">NotificationView_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">NotificationView</span>()</span><br><span class="line">            </span><br><span class="line">            <span class="type">NotificationView</span>(title: <span class="string">&quot;Turtle Rock&quot;</span>,</span><br><span class="line">                             message: <span class="string">&quot;You are within 5 miles of Turtle Rock.&quot;</span>,</span><br><span class="line">                             landmark: <span class="type">UserData</span>().landmarks[<span class="number">0</span>])</span><br><span class="line">        &#125;</span><br><span class="line">        .previewLayout(.sizeThatFits)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/0fae9f5a08302a4a49c869bf638a2acfad4094d98c421317e921f5b2daac8d8b/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f323137366330646438622f66393033653434392d376161632d343135362d623838352d6535306132616464616636622e706e67" alt=""></p>
<h2 id="步骤2-32">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-6"></a></p>
<p>打开<code>NotificationController</code>并添加<code>landmark</code>、<code>title</code>和<code>message</code>属性。</p>
<p>这些数据存储了有关通知传入信息。</p>
<blockquote>
<p>NotificationController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> WatchKit</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UserNotifications</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NotificationController</span>: <span class="title class_ inherited__">WKUserNotificationHostingController</span>&lt;<span class="title class_ inherited__">NotificationView</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span>?</span><br><span class="line">    <span class="keyword">var</span> title: <span class="type">String</span>?</span><br><span class="line">    <span class="keyword">var</span> message: <span class="type">String</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> body: <span class="type">NotificationView</span> &#123;</span><br><span class="line">        <span class="type">NotificationView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">willActivate</span>() &#123;</span><br><span class="line">        <span class="comment">// This method is called when watch view controller is about to be visible to user</span></span><br><span class="line">        <span class="keyword">super</span>.willActivate()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">didDeactivate</span>() &#123;</span><br><span class="line">        <span class="comment">// This method is called when watch view controller is no longer visible</span></span><br><span class="line">        <span class="keyword">super</span>.didDeactivate()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">didReceive</span>(<span class="keyword">_</span> <span class="params">notification</span>: <span class="type">UNNotification</span>) &#123;</span><br><span class="line">        <span class="comment">// This method is called when a notification needs to be presented.</span></span><br><span class="line">        <span class="comment">// Implement it if you use a dynamic notification interface.</span></span><br><span class="line">        <span class="comment">// Populate your dynamic notification interface as quickly as possible.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤3-28">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-6"></a></p>
<p>更新<code>body（）</code>方法以使用这些属性。</p>
<p>此方法实例化您先前创建的通知视图。</p>
<blockquote>
<p>NotificationController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> WatchKit</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UserNotifications</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NotificationController</span>: <span class="title class_ inherited__">WKUserNotificationHostingController</span>&lt;<span class="title class_ inherited__">NotificationView</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span>?</span><br><span class="line">    <span class="keyword">var</span> title: <span class="type">String</span>?</span><br><span class="line">    <span class="keyword">var</span> message: <span class="type">String</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> body: <span class="type">NotificationView</span> &#123;</span><br><span class="line">        <span class="type">NotificationView</span>(title: title,</span><br><span class="line">            message: message,</span><br><span class="line">            landmark: landmark)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">willActivate</span>() &#123;</span><br><span class="line">        <span class="comment">// This method is called when watch view controller is about to be visible to user</span></span><br><span class="line">        <span class="keyword">super</span>.willActivate()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">didDeactivate</span>() &#123;</span><br><span class="line">        <span class="comment">// This method is called when watch view controller is no longer visible</span></span><br><span class="line">        <span class="keyword">super</span>.didDeactivate()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">didReceive</span>(<span class="keyword">_</span> <span class="params">notification</span>: <span class="type">UNNotification</span>) &#123;</span><br><span class="line">        <span class="comment">// This method is called when a notification needs to be presented.</span></span><br><span class="line">        <span class="comment">// Implement it if you use a dynamic notification interface.</span></span><br><span class="line">        <span class="comment">// Populate your dynamic notification interface as quickly as possible.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤4-27">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-6"></a></p>
<p>定义<code>LandmarkIndexKey</code>。</p>
<p>使用此键可从通知中提取地标索引。</p>
<blockquote>
<p>NotificationController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> WatchKit</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UserNotifications</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NotificationController</span>: <span class="title class_ inherited__">WKUserNotificationHostingController</span>&lt;<span class="title class_ inherited__">NotificationView</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span>?</span><br><span class="line">    <span class="keyword">var</span> title: <span class="type">String</span>?</span><br><span class="line">    <span class="keyword">var</span> message: <span class="type">String</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> landmarkIndexKey <span class="operator">=</span> <span class="string">&quot;landmarkIndex&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> body: <span class="type">NotificationView</span> &#123;</span><br><span class="line">        <span class="type">NotificationView</span>(title: title,</span><br><span class="line">            message: message,</span><br><span class="line">            landmark: landmark)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">willActivate</span>() &#123;</span><br><span class="line">        <span class="comment">// This method is called when watch view controller is about to be visible to user</span></span><br><span class="line">        <span class="keyword">super</span>.willActivate()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">didDeactivate</span>() &#123;</span><br><span class="line">        <span class="comment">// This method is called when watch view controller is no longer visible</span></span><br><span class="line">        <span class="keyword">super</span>.didDeactivate()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">didReceive</span>(<span class="keyword">_</span> <span class="params">notification</span>: <span class="type">UNNotification</span>) &#123;</span><br><span class="line">        <span class="comment">// This method is called when a notification needs to be presented.</span></span><br><span class="line">        <span class="comment">// Implement it if you use a dynamic notification interface.</span></span><br><span class="line">        <span class="comment">// Populate your dynamic notification interface as quickly as possible.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤5-16">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-4"></a></p>
<p>更新<code>didReceive（:）</code>方法以解析通知中的数据。</p>
<p>此方法更新控制器的属性。调用此方法后，系统将使控制器的body属性无效，该属性将更新导航视图。然后系统在<code>Apple Watch</code>上显示通知。</p>
<blockquote>
<p>NotificationController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> WatchKit</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UserNotifications</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NotificationController</span>: <span class="title class_ inherited__">WKUserNotificationHostingController</span>&lt;<span class="title class_ inherited__">NotificationView</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span>?</span><br><span class="line">    <span class="keyword">var</span> title: <span class="type">String</span>?</span><br><span class="line">    <span class="keyword">var</span> message: <span class="type">String</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> landmarkIndexKey <span class="operator">=</span> <span class="string">&quot;landmarkIndex&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> body: <span class="type">NotificationView</span> &#123;</span><br><span class="line">        <span class="type">NotificationView</span>(title: title,</span><br><span class="line">            message: message,</span><br><span class="line">            landmark: landmark)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">willActivate</span>() &#123;</span><br><span class="line">        <span class="comment">// This method is called when watch view controller is about to be visible to user</span></span><br><span class="line">        <span class="keyword">super</span>.willActivate()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">didDeactivate</span>() &#123;</span><br><span class="line">        <span class="comment">// This method is called when watch view controller is no longer visible</span></span><br><span class="line">        <span class="keyword">super</span>.didDeactivate()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">didReceive</span>(<span class="keyword">_</span> <span class="params">notification</span>: <span class="type">UNNotification</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> userData <span class="operator">=</span> <span class="type">UserData</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> notificationData <span class="operator">=</span></span><br><span class="line">            notification.request.content.userInfo <span class="keyword">as?</span> [<span class="type">String</span>: <span class="keyword">Any</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> aps <span class="operator">=</span> notificationData<span class="operator">?</span>[<span class="string">&quot;aps&quot;</span>] <span class="keyword">as?</span> [<span class="type">String</span>: <span class="keyword">Any</span>]</span><br><span class="line">        <span class="keyword">let</span> alert <span class="operator">=</span> aps<span class="operator">?</span>[<span class="string">&quot;alert&quot;</span>] <span class="keyword">as?</span> [<span class="type">String</span>: <span class="keyword">Any</span>]</span><br><span class="line">        </span><br><span class="line">        title <span class="operator">=</span> alert<span class="operator">?</span>[<span class="string">&quot;title&quot;</span>] <span class="keyword">as?</span> <span class="type">String</span></span><br><span class="line">        message <span class="operator">=</span> alert<span class="operator">?</span>[<span class="string">&quot;body&quot;</span>] <span class="keyword">as?</span> <span class="type">String</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> index <span class="operator">=</span> notificationData<span class="operator">?</span>[landmarkIndexKey] <span class="keyword">as?</span> <span class="type">Int</span> &#123;</span><br><span class="line">            landmark <span class="operator">=</span> userData.landmarks[index]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>当Apple Watch收到通知时，它会创建与通知类别关联的通知控制器。若要设置通知控制器的类别，必须打开并编辑应用程序的情节提要。</p>
</blockquote>
<h2 id="步骤6-12">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46-3"></a></p>
<p>在项目导航栏中，选择“Watch Landmarks”文件夹并打开界面<code>storyboard</code>。选择指向静态通知界面控制器的箭头。</p>
<p><img src="https://camo.githubusercontent.com/2ff42dd6b1639719775536c9667f1725a8f4048c54082b63676c0130fd0bd79b/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f396533653661653038342f37643030303236652d623164642d343830392d616635612d6436623234306566623432322e706e67" alt=""></p>
<h2 id="步骤7-5">步骤7</h2>
<p><a href="#%E6%AD%A5%E9%AA%A47-1"></a></p>
<p>在属性检查器中，将<code>Notification Category</code>的名称设置为<code>LandmarkNear</code>。</p>
<p><img src="https://camo.githubusercontent.com/4203bf25cc18a8afbde6c395f5065fffd03d54a53b2fb15d42212ece46d61a6f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f616562353239626132342f39323838386434652d643332382d346364612d396364662d3037326364626164366265612e706e67" alt=""></p>
<blockquote>
<p>配置测试负载来使用LandmarkNear类别，并传递通知控制器期望的数据。</p>
</blockquote>
<h2 id="步骤8-4">步骤8</h2>
<p><a href="#%E6%AD%A5%E9%AA%A48-1"></a></p>
<p>选择<code>PushNotificationPayload.apns</code>文件，并更新title、body、category和landmarkIndex属性。请务必将类别设置为<code>LandmarkNear</code>。您还可以删除本教程中未使用的任何键，如<code>subtitle</code>、<code>WatchKit Simulator Actions</code>和<code>customKey</code>。</p>
<blockquote>
<p>PushNotificationPayload.apns</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;aps&quot;: &#123;</span><br><span class="line">        &quot;alert&quot;: &#123;</span><br><span class="line">            &quot;body&quot;: &quot;You are within 5 miles of Silver Salmon Creek.&quot;</span><br><span class="line">            &quot;title&quot;: &quot;Silver Salmon Creek&quot;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;category&quot;: &quot;LandmarkNear&quot;,</span><br><span class="line">        &quot;thread-id&quot;: &quot;5280&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    &quot;landmarkIndex&quot;: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>负载文件模拟远程通知中从服务器发送的数据。</p>
<h2 id="步骤9-4">步骤9</h2>
<p><a href="#%E6%AD%A5%E9%AA%A49-1"></a></p>
<p>选择“Landmarks-Watch (Notification)” scheme，并编译和运行您的应用程序。</p>
<p>第一次运行通知Scheme时，系统将请求发送通知的权限。选择<code>Allow(允许)</code>。模拟器随后显示一个可滚动的通知，其中包括：一个用于将地标应用程序标记为发送者的框、通知视图和通知操作的按钮。</p>
<p><img src="https://camo.githubusercontent.com/5e9bdcb61dafdcfe82a539a6318f43adf0ff0990568ddc411344e5b05f26f930/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f656263643133633637652f61396131333262642d616463652d343939382d393164622d6630633263313464643163332e706e67" alt=""></p>
<h3 id="应用程序设计和布局-2">应用程序设计和布局</h3>
<p><a href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%B8%83%E5%B1%80"></a></p>
<h2 id="使用UI控件">使用UI控件</h2>
<p><a href="#%E4%BD%BF%E7%94%A8ui%E6%8E%A7%E4%BB%B6"></a></p>
<p>在地标应用程序中，用户可以创建一个个人资料页来表达他们的个性。为了让用户能够更改他们的个人简介，您将添加一个编辑模式，并设计一个偏好设置页面。</p>
<p>您将使用各种用于数据输入的通用用户界面控件，并在用户保存更改时更新地标数据模型。</p>
<blockquote>
<p>学习时间：25分钟</p>
<p><a target="_blank" rel="noopener" href="https://docs-assets.developer.apple.com/published/9b7e314dba/WorkingWithUIControls.zip">下载地址：WorkingWithUIControls.zip</a></p>
</blockquote>
<h2 id="第一节-显示用户简介">第一节 显示用户简介</h2>
<p><a href="#%E7%AC%AC%E4%B8%80%E8%8A%82-%E6%98%BE%E7%A4%BA%E7%94%A8%E6%88%B7%E7%AE%80%E4%BB%8B"></a></p>
<p><code>Landmarks</code>应用程序在本地存储一些详情配置和偏好设置。在用户编辑其详情之前，它们将显示在没有任何编辑控件的摘要视图中。</p>
<p><img src="https://camo.githubusercontent.com/c6e0255cc6cf7621c378c8e10b76a20f5471d4904d56a158291073a788ff4ac0/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f626664393235336532642f36393961356631322d636638612d343936342d383666642d6463303065313331653333302e706e67" alt=""></p>
<h2 id="步骤1-32">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41"></a></p>
<p>要开始，请在<code>Landmarks</code>目录下创建一个名为<code>Profile</code>的新目录，然后将名为<code>ProfileHost</code>的视图添加到该目录中。</p>
<p><code>ProfileHost</code>视图将同时承载用户信息的静态摘要视图和编辑模式。</p>
<blockquote>
<p>ProfileHost.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> draftProfile <span class="operator">=</span> <span class="type">Profile</span>.default</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Profile for: <span class="subst">\(draftProfile.username)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileHost</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/dc751f03ab8bf316b49e867e58b74d1def84ba36dd929506cde9559755e064bd/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663034323966613466302f37643238353632392d353833372d343838332d383464332d3336613831636138646662322e706e67" alt=""></p>
<h2 id="步骤2-33">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42"></a></p>
<p>将<code>Home.swift</code>中的静态文本替换为上一步中创建的<code>ProfileHost</code>。</p>
<p>现在，主屏幕上的<code>profile</code>按钮将以模态方式展现用户简介。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categories: [<span class="type">String</span>: [<span class="type">Landmark</span>]] &#123;</span><br><span class="line">        <span class="type">Dictionary</span>(</span><br><span class="line">            grouping: landmarkData,</span><br><span class="line">            by: &#123; <span class="variable">$0</span>.category.rawValue &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> featured: [<span class="type">Landmark</span>] &#123;</span><br><span class="line">        landmarkData.filter &#123; <span class="variable">$0</span>.isFeatured &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showingProfile <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> profileButton: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span>(action: &#123; <span class="keyword">self</span>.showingProfile.toggle() &#125;) &#123;</span><br><span class="line">            <span class="type">Image</span>(systemName: <span class="string">&quot;person.crop.circle&quot;</span>)</span><br><span class="line">                .imageScale(.large)</span><br><span class="line">                .accessibility(label: <span class="type">Text</span>(<span class="string">&quot;User Profile&quot;</span>))</span><br><span class="line">                .padding()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">FeaturedLandmarks</span>(landmarks: featured)</span><br><span class="line">                    .scaledToFill()</span><br><span class="line">                    .frame(height: <span class="number">200</span>)</span><br><span class="line">                    .clipped()</span><br><span class="line">                    .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">                </span><br><span class="line">                <span class="type">ForEach</span>(categories.keys.sorted(), id: \.<span class="keyword">self</span>) &#123; key <span class="keyword">in</span></span><br><span class="line">                    <span class="type">CategoryRow</span>(categoryName: key, items: <span class="keyword">self</span>.categories[key]<span class="operator">!</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">                </span><br><span class="line">                <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkList</span>()) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;See All&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Featured&quot;</span>))</span><br><span class="line">            .navigationBarItems(trailing: profileButton)</span><br><span class="line">            .sheet(isPresented: <span class="variable">$showingProfile</span>) &#123;</span><br><span class="line">                <span class="type">ProfileHost</span>()</span><br><span class="line">                    .environmentObject(<span class="keyword">self</span>.userData)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FeaturedLandmarks</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmarks: [<span class="type">Landmark</span>]</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        landmarks[<span class="number">0</span>].image.resizable()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/7d80dac1796c14d563b5ce1f5cdf150d623238ddcc3d3354d1a011ffd5e5943e/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f303434356634646233312f32366365353664312d303137362d343238632d396632332d3565623939353232346638322e706e67" alt=""></p>
<h2 id="步骤3-29">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43"></a></p>
<p>创建一个名为<code>ProfileSummary</code>的新视图，该视图接受一个<code>Profile</code>实例并显示一些基本的用户信息。</p>
<p><code>ProfileSummary</code>持有一个<code>Profile</code>，比个人简介持有它好，因为父视图<code>ProfileHost</code>管理此视图的<code>State</code>。</p>
<blockquote>
<p>ProfileSummary.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileSummary</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> profile: <span class="type">Profile</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> goalFormat: <span class="type">DateFormatter</span> <span class="operator">=</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> formatter <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">        formatter.dateStyle <span class="operator">=</span> .long</span><br><span class="line">        formatter.timeStyle <span class="operator">=</span> .none</span><br><span class="line">        <span class="keyword">return</span> formatter</span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(profile.username)</span><br><span class="line">                .bold()</span><br><span class="line">                .font(.title)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Notifications: <span class="subst">\(<span class="keyword">self</span>.profile.prefersNotifications <span class="operator">?</span> <span class="string">&quot;On&quot;</span>: <span class="string">&quot;Off&quot;</span> )</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Seasonal Photos: <span class="subst">\(<span class="keyword">self</span>.profile.seasonalPhoto.rawValue)</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Goal Date: <span class="subst">\(<span class="keyword">self</span>.profile.goalDate, formatter: <span class="keyword">Self</span>.goalFormat)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileSummary_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileSummary</span>(profile: <span class="type">Profile</span>.default)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/35202ca2396b10ec362f296622b16f36b22316be660c75233236e35f0d4cd954/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f333432613635343461652f39633838366562392d616363642d343363312d396161652d3930356336646335366233622e706e67" alt=""></p>
<h2 id="步骤4-28">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44"></a></p>
<p>更新<code>ProfileHost</code>以显示新的摘要视图。</p>
<blockquote>
<p>ProfileHost.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> draftProfile <span class="operator">=</span> <span class="type">Profile</span>.default</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="type">ProfileSummary</span>(profile: draftProfile)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileHost</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/f0622abcb1d191737b5d9182be9cdf5567354f360fe14c3f6417c092f78355fd/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f326666376439333961622f35383030653861362d343130392d346533302d623663372d3834306665383337363232302e706e67" alt=""></p>
<h2 id="步骤5-17">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45"></a></p>
<p>创建一个名为<code>HikeBadge</code> 的新视图，该视图由<a target="_blank" rel="noopener" href="https://github.com/ly918/SwiftUI-Chinese-Documents/wiki/01-Drawing-Paths-and-Shapes">绘制路径和形状</a>中制作的徽章以及徒步旅行的一些数据文本组成。</p>
<p>徽章只是一个图形，因此<code>HikeBadge</code>中的文本和<code>accessibility(label:)</code> 修饰符使徽章的含义对其他用户更清晰。</p>
<p><em><strong>注意：</strong></em></p>
<p>两次调用<code>frame(width:height:)</code>修饰符，使徽章以其设计时的尺寸300×300点进行缩放渲染。</p>
<blockquote>
<p>HikeBadge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeBadge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .center) &#123;</span><br><span class="line">            <span class="type">Badge</span>()</span><br><span class="line">                .frame(width: <span class="number">300</span>, height: <span class="number">300</span>)</span><br><span class="line">                .scaleEffect(<span class="number">1.0</span> <span class="operator">/</span> <span class="number">3.0</span>)</span><br><span class="line">                .frame(width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line">            <span class="type">Text</span>(name)</span><br><span class="line">                .font(.caption)</span><br><span class="line">                .accessibility(label: <span class="type">Text</span>(<span class="string">&quot;Badge for <span class="subst">\(name)</span>.&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeBadge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HikeBadge</span>(name: <span class="string">&quot;Preview Testing&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/111ef1c72951f8fac61e410a18cbee9dca47ead17575da16f0974afb465b38d4/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f323262316564663131332f32656438626262352d393438302d343539302d386238302d3337353430386666316466302e706e67" alt=""></p>
<h2 id="步骤6-13">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46"></a></p>
<p>更新<code>ProfileSummary</code>以添加不同颜色的徽章以及获得徽章的原因文字。</p>
<blockquote>
<p>ProfileSummary.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileSummary</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> profile: <span class="type">Profile</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> goalFormat: <span class="type">DateFormatter</span> <span class="operator">=</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> formatter <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">        formatter.dateStyle <span class="operator">=</span> .long</span><br><span class="line">        formatter.timeStyle <span class="operator">=</span> .none</span><br><span class="line">        <span class="keyword">return</span> formatter</span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(profile.username)</span><br><span class="line">                .bold()</span><br><span class="line">                .font(.title)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Notifications: <span class="subst">\(<span class="keyword">self</span>.profile.prefersNotifications <span class="operator">?</span> <span class="string">&quot;On&quot;</span>: <span class="string">&quot;Off&quot;</span> )</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Seasonal Photos: <span class="subst">\(<span class="keyword">self</span>.profile.seasonalPhoto.rawValue)</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Goal Date: <span class="subst">\(<span class="keyword">self</span>.profile.goalDate, formatter: <span class="keyword">Self</span>.goalFormat)</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Completed Badges&quot;</span>)</span><br><span class="line">                    .font(.headline)</span><br><span class="line">                <span class="type">ScrollView</span> &#123;</span><br><span class="line">                    <span class="type">HStack</span> &#123;</span><br><span class="line">                        <span class="type">HikeBadge</span>(name: <span class="string">&quot;First Hike&quot;</span>)</span><br><span class="line">                        </span><br><span class="line">                        <span class="type">HikeBadge</span>(name: <span class="string">&quot;Earth Day&quot;</span>)</span><br><span class="line">                            .hueRotation(<span class="type">Angle</span>(degrees: <span class="number">90</span>))</span><br><span class="line">                        </span><br><span class="line">                        </span><br><span class="line">                        <span class="type">HikeBadge</span>(name: <span class="string">&quot;Tenth Hike&quot;</span>)</span><br><span class="line">                            .grayscale(<span class="number">0.5</span>)</span><br><span class="line">                            .hueRotation(<span class="type">Angle</span>(degrees: <span class="number">45</span>))</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                .frame(height: <span class="number">140</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileSummary_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileSummary</span>(profile: <span class="type">Profile</span>.default)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/6e1242822670a46d172d861abdf601e520c6f3a36c3c338fa2c3da6a0cc835a5/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f376363396662663531312f38626135623366372d393436642d343637652d386665322d6637303062646161346463352e706e67" alt=""></p>
<h2 id="步骤7-6">步骤7</h2>
<p><a href="#%E6%AD%A5%E9%AA%A47"></a></p>
<p>通过引入<a target="_blank" rel="noopener" href="https://github.com/ly918/SwiftUI-Chinese-Documents/wiki/02-Animating-Views-and-Transitions">视图动画与转场</a>的<code>HikeView</code>来完成<code>ProfileSummary</code>。</p>
<blockquote>
<p>ProfileSummary.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileSummary</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> profile: <span class="type">Profile</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> goalFormat: <span class="type">DateFormatter</span> <span class="operator">=</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> formatter <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">        formatter.dateStyle <span class="operator">=</span> .long</span><br><span class="line">        formatter.timeStyle <span class="operator">=</span> .none</span><br><span class="line">        <span class="keyword">return</span> formatter</span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(profile.username)</span><br><span class="line">                .bold()</span><br><span class="line">                .font(.title)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Notifications: <span class="subst">\(<span class="keyword">self</span>.profile.prefersNotifications <span class="operator">?</span> <span class="string">&quot;On&quot;</span>: <span class="string">&quot;Off&quot;</span> )</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Seasonal Photos: <span class="subst">\(<span class="keyword">self</span>.profile.seasonalPhoto.rawValue)</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Goal Date: <span class="subst">\(<span class="keyword">self</span>.profile.goalDate, formatter: <span class="keyword">Self</span>.goalFormat)</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Completed Badges&quot;</span>)</span><br><span class="line">                    .font(.headline)</span><br><span class="line">                <span class="type">ScrollView</span> &#123;</span><br><span class="line">                    <span class="type">HStack</span> &#123;</span><br><span class="line">                        <span class="type">HikeBadge</span>(name: <span class="string">&quot;First Hike&quot;</span>)</span><br><span class="line">                        </span><br><span class="line">                        <span class="type">HikeBadge</span>(name: <span class="string">&quot;Earth Day&quot;</span>)</span><br><span class="line">                            .hueRotation(<span class="type">Angle</span>(degrees: <span class="number">90</span>))</span><br><span class="line">                        </span><br><span class="line">                        </span><br><span class="line">                        <span class="type">HikeBadge</span>(name: <span class="string">&quot;Tenth Hike&quot;</span>)</span><br><span class="line">                            .grayscale(<span class="number">0.5</span>)</span><br><span class="line">                            .hueRotation(<span class="type">Angle</span>(degrees: <span class="number">45</span>))</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                .frame(height: <span class="number">140</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Recent Hikes&quot;</span>)</span><br><span class="line">                    .font(.headline)</span><br><span class="line">            </span><br><span class="line">                <span class="type">HikeView</span>(hike: hikeData[<span class="number">0</span>])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileSummary_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileSummary</span>(profile: <span class="type">Profile</span>.default)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/be5f3e3a6ac062ed689f93e9ac2f2b624e1ba24a06b4de7da1fc47bd61a5a8fa/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f326332343930656132622f64356239376331662d353064382d346339362d616364622d3038646338366662646633632e706e67" alt=""></p>
<h2 id="第二节-添加编辑模式">第二节 添加编辑模式</h2>
<p><a href="#%E7%AC%AC%E4%BA%8C%E8%8A%82-%E6%B7%BB%E5%8A%A0%E7%BC%96%E8%BE%91%E6%A8%A1%E5%BC%8F"></a></p>
<p>用户需要在查看或编辑其简介详情之间切换。您将添加一个编辑模式，通过向现有的<code>ProfileHost</code>添加一个<code>EditButton</code>，然后创建一个带有控件的视图，用于编辑单个数据。</p>
<p><img src="https://camo.githubusercontent.com/d6ab975fb258a886c7c0895e93383a0eafb7910d3d550d8b19e92145998182d2/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f633864333432643434622f38306437343066392d363633652d346436332d623036352d3964653139336566366362332e706e67" alt=""></p>
<h2 id="步骤1-33">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-1"></a></p>
<p>添加一个<code>Environment</code>属性，并设置<code>\.editMode</code>。</p>
<p>可以使用此属性读取和写入当前编辑范围。</p>
<blockquote>
<p>ProfileHost.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@Environment</span>(\.editMode) <span class="keyword">var</span> mode</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> draftProfile <span class="operator">=</span> <span class="type">Profile</span>.default</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="type">ProfileSummary</span>(profile: draftProfile)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileHost</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/6dea1a87c22691c7a43a0a50e0be144f2bcdc8e27b3732191cb4b9fe4dbdc897/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f623065663766383639302f33613533396366322d323561392d346530662d383562352d3964386539306664313165372e706e67" alt=""></p>
<h2 id="步骤2-34">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-1"></a></p>
<p>创建一个编辑按钮，用于打开和关闭环境的编辑模式。</p>
<blockquote>
<p>ProfileHost.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@Environment</span>(\.editMode) <span class="keyword">var</span> mode</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> draftProfile <span class="operator">=</span> <span class="type">Profile</span>.default</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">EditButton</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">ProfileSummary</span>(profile: draftProfile)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileHost</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/931200989845ec40b8559d1573d5fdc574eae47f5495278a32cbafc2c9e07c15/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f343266646661333261382f39346262613361382d663230362d343564642d396165652d6361643134303361343236312e706e67" alt=""></p>
<h2 id="步骤3-30">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-1"></a></p>
<p>更新<code>UserData</code>类以包含用户简介的实例，该实例在用户关闭简介视图后仍然存在。</p>
<blockquote>
<p>UserData.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">UserData</span>: <span class="title class_ inherited__">ObservableObject</span> &#123;</span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">var</span> showFavoritesOnly <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">var</span> landmarks <span class="operator">=</span> landmarkData</span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">var</span> profile <span class="operator">=</span> <span class="type">Profile</span>.default</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤4-29">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-1"></a></p>
<p>从<code>Environment</code>中读取<code>Profile</code>数据，将数据的控制权传递给<code>ProfileHost</code> 。</p>
<p>为了避免在确认编辑之前更新全局应用程序状态（例如当用户输入其名称时），编辑视图将对其自身的副本进行操作。</p>
<blockquote>
<p>ProfileHost.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@Environment</span>(\.editMode) <span class="keyword">var</span> mode</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> draftProfile <span class="operator">=</span> <span class="type">Profile</span>.default</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">EditButton</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">ProfileSummary</span>(profile: draftProfile)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileHost</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/931200989845ec40b8559d1573d5fdc574eae47f5495278a32cbafc2c9e07c15/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f343266646661333261382f39346262613361382d663230362d343564642d396165652d6361643134303361343236312e706e67" alt=""></p>
<h2 id="步骤5-18">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-1"></a></p>
<p>添加条件视图，显示静态简介视图或编辑模式视图。</p>
<p><em>注意</em></p>
<p>目前，编辑模式只是一个静态文本字段。</p>
<blockquote>
<p>ProfileHost.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@Environment</span>(\.editMode) <span class="keyword">var</span> mode</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> draftProfile <span class="operator">=</span> <span class="type">Profile</span>.default</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">EditButton</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>.mode<span class="operator">?</span>.wrappedValue <span class="operator">==</span> .inactive &#123;</span><br><span class="line">                <span class="type">ProfileSummary</span>(profile: userData.profile)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Profile Editor&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileHost</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/931200989845ec40b8559d1573d5fdc574eae47f5495278a32cbafc2c9e07c15/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f343266646661333261382f39346262613361382d663230362d343564642d396165652d6361643134303361343236312e706e67" alt=""></p>
<h2 id="第三节-定义用户简介编辑器">第三节 定义用户简介编辑器</h2>
<p><a href="#%E7%AC%AC%E4%B8%89%E8%8A%82-%E5%AE%9A%E4%B9%89%E7%94%A8%E6%88%B7%E7%AE%80%E4%BB%8B%E7%BC%96%E8%BE%91%E5%99%A8"></a></p>
<p>用户简介编辑器主要由不同的控件组成，这些控件更改用户简介中的各个详情信息。配置文件中的某些项目（如徽章）不可由用户编辑，因此它们不会显示在编辑器中。</p>
<p>为了与信息摘要保持一致，您将在编辑器中按相同的顺序添加概要文件详情信息。</p>
<p><img src="https://camo.githubusercontent.com/0cac9efdd06c38a735f0c38cd6d8b3624e86f908deb65ee01044a87728e4200b/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f396335613437613962322f37333730366661322d616566392d343633622d393966382d3133373835333731336161352e706e67" alt=""></p>
<h2 id="步骤1-34">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-2"></a></p>
<p>创建一个名为<code>ProfileEditor</code>的新视图，并包含对用户简介副本的绑定。</p>
<p>视图中的第一个控件是一个<code>TextField</code>，它控制并更新一个字符串的绑定，是用户选择的显示名称。当创建<code>TextField</code>时，您需要提供标签和字符串的绑定。</p>
<blockquote>
<p>ProfileEditor.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileEditor</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> profile: <span class="type">Profile</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Username&quot;</span>).bold()</span><br><span class="line">                <span class="type">Divider</span>()</span><br><span class="line">                <span class="type">TextField</span>(<span class="string">&quot;Username&quot;</span>, text: <span class="variable">$profile</span>.username)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileEditor_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileEditor</span>(profile: .constant(.default))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/e0b433f59437ef51e48017738bf4c32f4e2d5a0a8fe7fb42a3988e4aa31db299/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f353164333566386637372f35353630646134622d353263622d346566332d396135612d6562663165656536323362312e706e67" alt=""></p>
<h2 id="步骤2-35">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-2"></a></p>
<p>更新<code>ProfileHost</code>中的条件内容，使其包含<code>Profile Editor</code>，并传递简介信息的绑定。</p>
<p>现在，单击“Edit”时将显示“简介编辑视图”。</p>
<blockquote>
<p>ProfileHost.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@Environment</span>(\.editMode) <span class="keyword">var</span> mode</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> draftProfile <span class="operator">=</span> <span class="type">Profile</span>.default</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">EditButton</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>.mode<span class="operator">?</span>.wrappedValue <span class="operator">==</span> .inactive &#123;</span><br><span class="line">                <span class="type">ProfileSummary</span>(profile: userData.profile)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">ProfileEditor</span>(profile: <span class="variable">$draftProfile</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileHost</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/931200989845ec40b8559d1573d5fdc574eae47f5495278a32cbafc2c9e07c15/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f343266646661333261382f39346262613361382d663230362d343564642d396165652d6361643134303361343236312e706e67" alt=""></p>
<h2 id="步骤3-31">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-2"></a></p>
<p>添加是否接收地标相关事件通知的开关。</p>
<p><code>Toggles</code>是只有打开或关闭的控件，因此它们非常适合布尔值<code>Boolean</code>，如“yes”或“no”的设置。</p>
<blockquote>
<p>ProfileEditor.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileEditor</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> profile: <span class="type">Profile</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Username&quot;</span>).bold()</span><br><span class="line">                <span class="type">Divider</span>()</span><br><span class="line">                <span class="type">TextField</span>(<span class="string">&quot;Username&quot;</span>, text: <span class="variable">$profile</span>.username)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">Toggle</span>(isOn: <span class="variable">$profile</span>.prefersNotifications) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Enable Notifications&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileEditor_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileEditor</span>(profile: .constant(.default))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/0fad353c21b0b7997add4d2553a0f3453b2b09808dea3dd9c79f1552020a79a0/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663831373539336236662f36383235303337312d633531332d346534632d386430642d6134663535323433346238372e706e67" alt=""></p>
<h2 id="步骤4-30">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-2"></a></p>
<p>将<code>Picker</code>控件及其标签放置在<code>VStack</code>中，使地标照片具有可选择的季节。</p>
<blockquote>
<p>ProfileEditor.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileEditor</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> profile: <span class="type">Profile</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Username&quot;</span>).bold()</span><br><span class="line">                <span class="type">Divider</span>()</span><br><span class="line">                <span class="type">TextField</span>(<span class="string">&quot;Username&quot;</span>, text: <span class="variable">$profile</span>.username)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">Toggle</span>(isOn: <span class="variable">$profile</span>.prefersNotifications) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Enable Notifications&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Seasonal Photo&quot;</span>).bold()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Picker</span>(<span class="string">&quot;Seasonal Photo&quot;</span>, selection: <span class="variable">$profile</span>.seasonalPhoto) &#123;</span><br><span class="line">                    <span class="type">ForEach</span>(<span class="type">Profile</span>.<span class="type">Season</span>.allCases, id: \.<span class="keyword">self</span>) &#123; season <span class="keyword">in</span></span><br><span class="line">                        <span class="type">Text</span>(season.rawValue).tag(season)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                .pickerStyle(<span class="type">SegmentedPickerStyle</span>())</span><br><span class="line">            &#125;</span><br><span class="line">            .padding(.top)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileEditor_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileEditor</span>(profile: .constant(.default))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/5f7fb44f5decb629bc6fe906c174209684246778e3d78e8017fcea558bbdcea0/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f346466326462643037662f38616232653066362d343932662d346634372d616463382d3330386561333761656439342e706e67" alt=""></p>
<h2 id="步骤5-19">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-2"></a></p>
<p>最后，在季节选择器下面添加一个<code>DatePicker</code>，修改到达地标的日期。</p>
<blockquote>
<p>ProfileEditor.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileEditor</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> profile: <span class="type">Profile</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> dateRange: <span class="type">ClosedRange</span>&lt;<span class="type">Date</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> min <span class="operator">=</span> <span class="type">Calendar</span>.current.date(byAdding: .year, value: <span class="operator">-</span><span class="number">1</span>, to: profile.goalDate)<span class="operator">!</span></span><br><span class="line">        <span class="keyword">let</span> max <span class="operator">=</span> <span class="type">Calendar</span>.current.date(byAdding: .year, value: <span class="number">1</span>, to: profile.goalDate)<span class="operator">!</span></span><br><span class="line">        <span class="keyword">return</span> min<span class="operator">...</span>max</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Username&quot;</span>).bold()</span><br><span class="line">                <span class="type">Divider</span>()</span><br><span class="line">                <span class="type">TextField</span>(<span class="string">&quot;Username&quot;</span>, text: <span class="variable">$profile</span>.username)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">Toggle</span>(isOn: <span class="variable">$profile</span>.prefersNotifications) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Enable Notifications&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Seasonal Photo&quot;</span>).bold()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Picker</span>(<span class="string">&quot;Seasonal Photo&quot;</span>, selection: <span class="variable">$profile</span>.seasonalPhoto) &#123;</span><br><span class="line">                    <span class="type">ForEach</span>(<span class="type">Profile</span>.<span class="type">Season</span>.allCases, id: \.<span class="keyword">self</span>) &#123; season <span class="keyword">in</span></span><br><span class="line">                        <span class="type">Text</span>(season.rawValue).tag(season)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                .pickerStyle(<span class="type">SegmentedPickerStyle</span>())</span><br><span class="line">            &#125;</span><br><span class="line">            .padding(.top)</span><br><span class="line">            </span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Goal Date&quot;</span>).bold()</span><br><span class="line">                <span class="type">DatePicker</span>(</span><br><span class="line">                    <span class="string">&quot;Goal Date&quot;</span>,</span><br><span class="line">                    selection: <span class="variable">$profile</span>.goalDate,</span><br><span class="line">                    in: dateRange,</span><br><span class="line">                    displayedComponents: .date)</span><br><span class="line">            &#125;</span><br><span class="line">            .padding(.top)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileEditor_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileEditor</span>(profile: .constant(.default))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/53f34a34ae2f171abbf31a50e92687bffe0bcb94780ddbb3149d1409f9cfc9ce/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f323236356630663038642f38656639306461352d313135392d346339332d393836392d6535643038623336613864392e706e67" alt=""></p>
<h2 id="第四节-延迟编辑传递">第四节 延迟编辑传递</h2>
<p><a href="#%E7%AC%AC%E5%9B%9B%E8%8A%82-%E5%BB%B6%E8%BF%9F%E7%BC%96%E8%BE%91%E4%BC%A0%E9%80%92"></a></p>
<p>要使其编辑，直到用户退出编辑模式后才生效，在编辑过程中使用其<code>Profile</code>的草稿副本，然后仅当用户确认编辑时才将草稿副本分配给真实副本。</p>
<p><img src="https://camo.githubusercontent.com/ba8bb301954e5d24b756a85cd53bb19c0d2b7d34bd309f80cecb607c120931df/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336233616333366261322f30393433616661362d646434662d343938662d386461342d3837393031636362356531352e706e67" alt=""></p>
<h2 id="步骤1-35">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-3"></a></p>
<p>向<code>ProfileHost</code>添加取消按钮。</p>
<p>与<code>EditButton</code>提供的<code>Done</code>按钮不同，<code>Cancel</code>按钮不会将编辑应用于其闭包中的真实<code>Profile</code>数据。</p>
<blockquote>
<p>ProfileHost.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@Environment</span>(\.editMode) <span class="keyword">var</span> mode</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> draftProfile <span class="operator">=</span> <span class="type">Profile</span>.default</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">self</span>.mode<span class="operator">?</span>.wrappedValue <span class="operator">==</span> .active &#123;</span><br><span class="line">                    <span class="type">Button</span>(<span class="string">&quot;Cancel&quot;</span>) &#123;</span><br><span class="line">                        <span class="keyword">self</span>.draftProfile <span class="operator">=</span> <span class="keyword">self</span>.userData.profile</span><br><span class="line">                        <span class="keyword">self</span>.mode<span class="operator">?</span>.animation().wrappedValue <span class="operator">=</span> .inactive</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">EditButton</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>.mode<span class="operator">?</span>.wrappedValue <span class="operator">==</span> .inactive &#123;</span><br><span class="line">                <span class="type">ProfileSummary</span>(profile: userData.profile)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">ProfileEditor</span>(profile: <span class="variable">$draftProfile</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileHost</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/9cf7616ad8ad548a13328cdc59bc8e4150d63d4dc75b3ada23ea9d3707b25455/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f313663393663323531342f33323165303362622d373233372d346231302d616637362d3930633936313566653637322e706e67" alt=""></p>
<h2 id="步骤2-36">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-3"></a></p>
<p>应用<code>onAppear（perform:）</code>和<code>onDisappear（perform:）</code>修饰符，将正确的用户简介数据填充给编辑器，并在用户点击<code>Done</code>按钮时更新简介数据。</p>
<p>否则，在下次激活编辑模式时显示旧值。</p>
<blockquote>
<p>ProfileHost.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@Environment</span>(\.editMode) <span class="keyword">var</span> mode</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> draftProfile <span class="operator">=</span> <span class="type">Profile</span>.default</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">self</span>.mode<span class="operator">?</span>.wrappedValue <span class="operator">==</span> .active &#123;</span><br><span class="line">                    <span class="type">Button</span>(<span class="string">&quot;Cancel&quot;</span>) &#123;</span><br><span class="line">                        <span class="keyword">self</span>.draftProfile <span class="operator">=</span> <span class="keyword">self</span>.userData.profile</span><br><span class="line">                        <span class="keyword">self</span>.mode<span class="operator">?</span>.animation().wrappedValue <span class="operator">=</span> .inactive</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">EditButton</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>.mode<span class="operator">?</span>.wrappedValue <span class="operator">==</span> .inactive &#123;</span><br><span class="line">                <span class="type">ProfileSummary</span>(profile: userData.profile)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">ProfileEditor</span>(profile: <span class="variable">$draftProfile</span>)</span><br><span class="line">                    .onAppear &#123;</span><br><span class="line">                        <span class="keyword">self</span>.draftProfile <span class="operator">=</span> <span class="keyword">self</span>.userData.profile</span><br><span class="line">                    &#125;</span><br><span class="line">                    .onDisappear &#123;</span><br><span class="line">                        <span class="keyword">self</span>.userData.profile <span class="operator">=</span> <span class="keyword">self</span>.draftProfile</span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileHost</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="处理用户输入">处理用户输入</h2>
<p><a href="#%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5"></a></p>
<p>在<code>Landmarks</code>应用程序中，用户可以标记他们最喜欢的位置，并筛选列表来仅仅显示他们最喜欢的位置。要创建此功能，首先要向列表中添加一个开关，以便用户只关注他们的收藏夹，然后添加一个星形按钮，用户点击该按钮可将地标标记到收藏夹。</p>
<blockquote>
<p>学习时间：20分钟</p>
<p><a target="_blank" rel="noopener" href="https://docs-assets.developer.apple.com/published/771290d0bd/HandlingUserInput.zip">下载示例：HandlingUserInput.zip</a></p>
</blockquote>
<h2 id="第一节-标记用户最喜欢的地标">第一节 标记用户最喜欢的地标</h2>
<p><a href="#%E7%AC%AC%E4%B8%80%E8%8A%82-%E6%A0%87%E8%AE%B0%E7%94%A8%E6%88%B7%E6%9C%80%E5%96%9C%E6%AC%A2%E7%9A%84%E5%9C%B0%E6%A0%87"></a></p>
<p>从优化列表开始，让用户一目了然地看到他们的最爱。为每个显示最喜欢的地标行添加一个星。</p>
<p><img src="https://camo.githubusercontent.com/4aa651ebee6d81f607e9bee34a34506164ffc48c8f17ea132c641f4e5c8ecf78/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f616261313761363135392f31626639656633392d616563312d343439612d626266362d3461353161643134626261652e706e67" alt=""></p>
<h2 id="步骤1-36">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41"></a></p>
<p>打开Xcode项目，然后在项目导航器中选择<code>LandmarkRow.swift</code>。</p>
<p><img src="https://camo.githubusercontent.com/b5ee6c4f665c8054ed2808428326c4d6662057bee79047e2cc67af6e6c155a0e/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f346464646463666363652f38613830303966382d333938382d343239342d613364362d6434303666656361343162392e706e67" alt=""></p>
<h2 id="步骤2-37">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42"></a></p>
<p>在<code>Spacer()</code>之后，在<code>if</code>语句中添加一个星星<code>Image</code>，用来测试当前地标是否被收藏。</p>
<p>在<code>SwiftUI</code>语句块中，使用<code>if</code>语句有条件地包含视图。</p>
<blockquote>
<p>LandmarkRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            landmark.image</span><br><span class="line">                .resizable()</span><br><span class="line">                .frame(width: <span class="number">50</span>, height: <span class="number">50</span>)</span><br><span class="line">            <span class="type">Text</span>(landmark.name)</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> landmark.isFavorite &#123;</span><br><span class="line">                <span class="type">Image</span>(systemName: <span class="string">&quot;star.fill&quot;</span>)</span><br><span class="line">                    .imageScale(.medium)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">1</span>])</span><br><span class="line">        &#125;</span><br><span class="line">        .previewLayout(.fixed(width: <span class="number">300</span>, height: <span class="number">70</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/fbfdfba69de187370146be22b42b87895b2f65aaada5b3166b57e77ad5588d96/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f356533626437306461662f62353138333261382d313439632d343264642d613731632d6532373866623432386561352e706e67" alt=""></p>
<h2 id="步骤3-32">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43"></a></p>
<p>由于系统图像是基于矢量的，因此可以使用<code>foregroundColor(_:)</code>修改器更改其颜色。</p>
<p>当地标的<code>isFavorite</code>属性为<code>true</code>时，星星就出现了。您将在本教程后面看到如何修改该属性。</p>
<blockquote>
<p>LandmarkRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            landmark.image</span><br><span class="line">                .resizable()</span><br><span class="line">                .frame(width: <span class="number">50</span>, height: <span class="number">50</span>)</span><br><span class="line">            <span class="type">Text</span>(landmark.name)</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> landmark.isFavorite &#123;</span><br><span class="line">                <span class="type">Image</span>(systemName: <span class="string">&quot;star.fill&quot;</span>)</span><br><span class="line">                    .imageScale(.medium)</span><br><span class="line">                    .foregroundColor(.yellow)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">1</span>])</span><br><span class="line">        &#125;</span><br><span class="line">        .previewLayout(.fixed(width: <span class="number">300</span>, height: <span class="number">70</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/cc381bdda5a2ed09d939fc572dce85556290d5a4de0734734e0ec42e180bf500/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f323936663738343265362f35623964346433322d653165372d343336302d386439302d3735303736373561633137312e706e67" alt=""></p>
<h2 id="第二节-筛选列表视图">第二节 筛选列表视图</h2>
<p><a href="#%E7%AC%AC%E4%BA%8C%E8%8A%82-%E7%AD%9B%E9%80%89%E5%88%97%E8%A1%A8%E8%A7%86%E5%9B%BE"></a></p>
<p>您可以自定义列表视图，使其显示所有地标，或仅显示用户的收藏夹。为此，需要向<code>LandmarkList</code>类型添加<code>@State</code>。</p>
<p><code>@State</code>是一个值或一组值，可以随时间变化，并影响视图的行为、内容或布局。使用带有<code>@State</code>的属性将其添加到视图中。</p>
<p><img src="https://camo.githubusercontent.com/993c19c2ccd5c1576da45a2874e7e720ccfafac224f1bc41460a6ef299062cac/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f613536633730363461392f36303065356234632d643763372d343464632d386330612d3634326639316231353131372e706e67" alt=""></p>
<h2 id="步骤1-37">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-1"></a></p>
<p>在项目导航器中选择<code>LandmarkList.swift</code>。将名为<code>showFavoritesOnly</code>的<code>@State</code>属性添加到<code>LandmarkList</code>，其初始值设置为<code>false</code>。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showFavoritesOnly <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                    <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d9e7a2f4df6532c16478858c7ac5fb747e2b7cce72b4870b005aa83cf10b84fa/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f386633363332623561362f37323338653637622d343130352d343063342d396237372d3066666633373535363934622e706e67" alt=""></p>
<h2 id="步骤2-38">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-1"></a></p>
<p>单击“Resume”按钮刷新画布。</p>
<p>当您对视图的结构进行更改（如添加或修改属性）时，需要手动刷新画布。</p>
<p><img src="https://camo.githubusercontent.com/5aca50837582794c53801557c660bfbff1dfcf7f63a32ef319ba404a38abae1c/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663239623761393030382f65343364363039312d643238612d343433372d396231622d3062643566376664656533382e706e67" alt=""></p>
<h2 id="步骤3-33">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-1"></a></p>
<p>通过检查<code>showFavoritesOnly</code>属性和每个<code>landmark.isFavorite</code>值筛选地标列表。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showFavoritesOnly <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                    <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                        <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d9e7a2f4df6532c16478858c7ac5fb747e2b7cce72b4870b005aa83cf10b84fa/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f386633363332623561362f37323338653637622d343130352d343063342d396237372d3066666633373535363934622e706e67" alt=""></p>
<h2 id="第三节-添加控件以切换状态">第三节 添加控件以切换状态</h2>
<p><a href="#%E7%AC%AC%E4%B8%89%E8%8A%82-%E6%B7%BB%E5%8A%A0%E6%8E%A7%E4%BB%B6%E4%BB%A5%E5%88%87%E6%8D%A2%E7%8A%B6%E6%80%81"></a></p>
<p>要让用户控制列表的筛选器，需要添加一个控件，该控件可以单独更改<code>showFavoritesOnly</code>的值。通过绑定<code>toggle</code>控件来完成此操作。</p>
<p>绑定是对可变状态的引用。当用户从关闭切换到打开，然后再次关闭时，控件使用绑定相应地更新视图的状态。</p>
<p><img src="https://camo.githubusercontent.com/a67258caf2144ecc7ee1f4c04114a2eca407d5565529eda103eff177a46308c7/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f613630666538303030302f34646662386564632d663334362d346532612d623939382d3637373731356330663133662e706e67" alt=""></p>
<h2 id="步骤1-38">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-2"></a></p>
<p>将行嵌套到<code>ForEach</code>中。</p>
<p>若要在列表中组合静态视图和动态视图，或组合两个或多个不同的动态视图组，请使用<code>ForEach</code>类型，而不是将数据集合传递给列表。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showFavoritesOnly <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">ForEach</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                        <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                            <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/7620af575a013a7b2bd317f7e6763ac3e07576f079451bd0fa53706d2965258e/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393530313063356662382f35656135353237642d363630612d343461612d386437312d3265373364333064346564322e706e67" alt=""></p>
<h2 id="步骤2-39">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-2"></a></p>
<p>添加一个<code>Toggle</code>视图作为列表视图的第一个子视图，给<code>showFavoritesOnly</code>做一个绑定。</p>
<p>您可以使用<code>$</code>来访问状态变量或其绑定的属性。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showFavoritesOnly <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">Toggle</span>(isOn: <span class="variable">$showFavoritesOnly</span>) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Favorites only&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">ForEach</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                        <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                            <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/503097b42856f626d1afe9730df92456533c60be7d7776259a1bb245c308af61/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f626136656331626361632f66623362363937662d616464342d346337332d383064662d3133376161323333386132622e706e67" alt=""></p>
<h2 id="步骤3-34">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-2"></a></p>
<p>使用实时预览并通过点击切换来尝试此新功能。</p>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/_proj_1_3_live_preview.gif" alt=""></p>
<h2 id="第四节-使用Observable-Object进行存储">第四节 使用Observable Object进行存储</h2>
<p><a href="#%E7%AC%AC%E5%9B%9B%E8%8A%82-%E4%BD%BF%E7%94%A8observable-object%E8%BF%9B%E8%A1%8C%E5%AD%98%E5%82%A8"></a></p>
<p>为了让用户控制哪些特定的地标是最喜欢的，您首先要将地标数据存储在一个<code>Observable Object</code>中。</p>
<p><code>Observable Object</code>的自定义对象，可以从<code>SwiftUI</code>环境中的存储绑定到视图。<code>SwiftUI</code>监视可观察对象的任何可能影响视图的更改，并在更改后显示正确的视图。</p>
<p><img src="https://camo.githubusercontent.com/dce7da47901d2fab4ff422853ee6508ce178e39b5bd3a16888b1416566b994cf/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f343563373038333235352f38313337623930652d353763352d346364352d623937312d6162306435313966663939622e706e67" alt=""></p>
<h2 id="步骤1-39">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-3"></a></p>
<p>创建一个名为<code>UserData.Swift</code>的新<code>Swift</code>文件。</p>
<blockquote>
<p>UserData.swift</p>
</blockquote>
<h2 id="步骤2-40">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-3"></a></p>
<p>从组合框架中声明遵守<code>ObservableObject</code>协议的新模型类型。</p>
<p><code>SwiftUI</code>订阅您的<code>ObservableObject</code>，并在数据更改时更新任何需要刷新的视图。</p>
<blockquote>
<p>UserData.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">UserData</span>: <span class="title class_ inherited__">ObservableObject</span>  &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤3-35">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-3"></a></p>
<p>添加<code>showFavoritesOnly</code>和地标的存储属性及其初始值。</p>
<blockquote>
<p>UserData.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">UserData</span>: <span class="title class_ inherited__">ObservableObject</span>  &#123;</span><br><span class="line">    <span class="keyword">var</span> showFavoritesOnly <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="keyword">var</span> landmarks <span class="operator">=</span> landmarkData</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>ObservableObject</code>需要发布对其数据的任何更改，以便其订阅者可以获取更改。</p>
</blockquote>
<h2 id="步骤4-31">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44"></a></p>
<p>将<code>@Published</code>属性添加到模型中的每个属性</p>
<blockquote>
<p>UserData.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">UserData</span>: <span class="title class_ inherited__">ObservableObject</span>  &#123;</span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">var</span> showFavoritesOnly <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">var</span> landmarks <span class="operator">=</span> landmarkData</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="第五节-在视图中采用你的模型对象">第五节 在视图中采用你的模型对象</h2>
<p><a href="#%E7%AC%AC%E4%BA%94%E8%8A%82-%E5%9C%A8%E8%A7%86%E5%9B%BE%E4%B8%AD%E9%87%87%E7%94%A8%E4%BD%A0%E7%9A%84%E6%A8%A1%E5%9E%8B%E5%AF%B9%E8%B1%A1"></a></p>
<p>现在您已经创建了<code>UserData</code>对象，您需要更新视图以将其作为应用程序的数据存储。</p>
<p><img src="https://camo.githubusercontent.com/a5272502caa72f1589db85e4029efde08c1ecfa7373d6cb0103b975e7bb40daa/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f326336313065353134302f35356439366639322d323762352d346137382d393533632d6465333263343264376563342e706e67" alt=""></p>
<h2 id="步骤1-40">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-4"></a></p>
<p>在<code>LandmarkList.swift</code>中，用<code>@EnvironmentObject</code>属性替换<code>showFavoritesOnly</code>声明，并向预览添加<code>environmentObject（:）</code>修饰符。</p>
<p>只要<code>environmentObject（:）</code>修饰符已应用于父对象，此<code>userData</code>属性就会自动获取其值。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">Toggle</span>(isOn: <span class="variable">$showFavoritesOnly</span>) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Favorites only&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">ForEach</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                        <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                            <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">            .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤2-41">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-4"></a></p>
<p>通过访问<code>userData</code>上的相同属性来替换<code>showFavoritesOnly</code>的使用。</p>
<p>与<code>@State</code>属性一样，您可以使用<code>$</code>访问到<code>userData</code>对象成员的绑定。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">Toggle</span>(isOn: <span class="variable">$userData</span>.showFavoritesOnly) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Favorites only&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">ForEach</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.userData.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                        <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                            <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">            .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/b0e1c3a23091ea24ef4d8d54ada6adab9df6a85711ac1bb2a693acd7c7d76eed/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f633562616130616431332f64353737316334622d333738372d343964332d623065312d3732373731396438353463332e706e67" alt=""></p>
<h2 id="步骤3-36">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-4"></a></p>
<p>创建<code>ForEach</code>实例时使用<code>userData.landmarks</code>作为数据。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">Toggle</span>(isOn: <span class="variable">$userData</span>.showFavoritesOnly) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Favorites only&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">ForEach</span>(userData.landmarks) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.userData.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                        <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                            <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">            .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/b0e1c3a23091ea24ef4d8d54ada6adab9df6a85711ac1bb2a693acd7c7d76eed/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f633562616130616431332f64353737316334622d333738372d343964332d623065312d3732373731396438353463332e706e67" alt=""></p>
<h2 id="步骤4-32">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-1"></a></p>
<p>在<code>SceneDelegate.swift</code>中，将<code>environmentObject（:）</code>修饰符添加到<code>LandmarkList</code>。</p>
<p>如果您在模拟器或设备上构建并运行地标，而不是使用预览，则此更新将确保地标列表在环境中有一个<code>UserData</code>对象。</p>
<blockquote>
<p>SceneDelegate.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SceneDelegate</span>: <span class="title class_ inherited__">UIResponder</span>, <span class="title class_ inherited__">UIWindowSceneDelegate</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> window: <span class="type">UIWindow</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">scene</span>(<span class="keyword">_</span> <span class="params">scene</span>: <span class="type">UIScene</span>, <span class="params">willConnectTo</span> <span class="params">session</span>: <span class="type">UISceneSession</span>, <span class="params">options</span> <span class="params">connectionOptions</span>: <span class="type">UIScene</span>.<span class="type">ConnectionOptions</span>) &#123;</span><br><span class="line">        <span class="comment">// Use this method to optionally configure and attach the UIWindow `window` to the provided UIWindowScene `scene`.</span></span><br><span class="line">        <span class="comment">// If using a storyboard, the `window` property will automatically be initialized and attached to the scene.</span></span><br><span class="line">        <span class="comment">// This delegate does not imply the connecting scene or session are new (see `application:configurationForConnectingSceneSession` instead).</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Use a UIHostingController as window root view controller</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> windowScene <span class="operator">=</span> scene <span class="keyword">as?</span> <span class="type">UIWindowScene</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> window <span class="operator">=</span> <span class="type">UIWindow</span>(windowScene: windowScene)</span><br><span class="line">            window.rootViewController <span class="operator">=</span> <span class="type">UIHostingController</span>(</span><br><span class="line">                rootView: <span class="type">LandmarkList</span>()</span><br><span class="line">                    .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">self</span>.window <span class="operator">=</span> window</span><br><span class="line">            window.makeKeyAndVisible()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤5-20">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45"></a></p>
<p>更新<code>LandmarkDetail</code>视图以在环境中使用<code>UserData</code>对象。</p>
<p>在访问或更新地标的收藏状态时，您将使用地标索引，以便始终访问该数据的正确版本。</p>
<blockquote>
<p>LandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>(landmark: landmark)</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>(image: landmark.image)</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(landmark.name)</span><br><span class="line">                    .font(.title)</span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(landmark.park)</span><br><span class="line">                        .font(caption)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(landmark.state)</span><br><span class="line">                        .font(.caption)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="type">Text</span>(landmark.name), displayMode: .inline)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkDetail</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">            .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤6-14">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46"></a></p>
<p>切换回<code>LandmarkList.swift</code>并打开实时预览，以验证一切正常工作。</p>
<p><img src="https://camo.githubusercontent.com/211674563804b74ec03a0cc1d1b8f7240d5525d10802894e37aeac6f0612d6a6/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f363630353938333533362f63363063373334652d656232652d343639622d626465332d6364373062633739383562372e706e67" alt=""></p>
<h2 id="第六节-为每个地标创建收藏夹按钮">第六节 为每个地标创建收藏夹按钮</h2>
<p><a href="#%E7%AC%AC%E5%85%AD%E8%8A%82-%E4%B8%BA%E6%AF%8F%E4%B8%AA%E5%9C%B0%E6%A0%87%E5%88%9B%E5%BB%BA%E6%94%B6%E8%97%8F%E5%A4%B9%E6%8C%89%E9%92%AE"></a></p>
<p>地标应用程序现在可以在过滤和未经过滤的地标视图之间切换，但最喜欢的地标列表仍然是硬编码的。要允许用户添加和删除收藏，需要将收藏按钮添加到地标详情视图。</p>
<p><img src="https://camo.githubusercontent.com/2cb4907f49bdd9a91007cc4866569b2beac4d7e8d097cb42f4098447675c891c/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393737303763643363332f31313436653264392d363332352d343931302d393263642d3137393162626365646136302e706e67" alt=""></p>
<h2 id="步骤1-41">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-5"></a></p>
<p>在<code>LandmarkDetail.swift</code>中，将地标的名称嵌入<code>HStack</code>。</p>
<blockquote>
<p>LandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>(landmark: landmark)</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>(image: landmark.image)</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">HStack</span> &#123;</span><br><span class="line">                    <span class="type">Text</span>(landmark.name)</span><br><span class="line">                        .font(.title)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(landmark.park)</span><br><span class="line">                        .font(caption)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(landmark.state)</span><br><span class="line">                        .font(.caption)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="type">Text</span>(landmark.name), displayMode: .inline)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkDetail</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">            .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤2-42">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-5"></a></p>
<p>在地标名称旁边创建一个新按钮。使用<code>if-else</code>条件语句提供不同的图像，以指示地标是否收藏。</p>
<p>在按钮的<code>action</code>闭包中，代码使用带有<code>userData</code>对象的<code>landmarkIndex</code>来更新地标。</p>
<blockquote>
<p>LandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>(landmark: landmark)</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>(image: landmark.image)</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">HStack</span> &#123;</span><br><span class="line">                    <span class="type">Text</span>(landmark.name)</span><br><span class="line">                        .font(.title)</span><br><span class="line"></span><br><span class="line">                    <span class="type">Button</span>(action: &#123;</span><br><span class="line">                        <span class="keyword">self</span>.userData.landmarks[<span class="keyword">self</span>.landmarkIndex].isFavorite.toggle()</span><br><span class="line">                    &#125;) &#123;</span><br><span class="line">                        <span class="keyword">if</span> <span class="keyword">self</span>.userData.landmarks[<span class="keyword">self</span>.landmarkIndex].isFavorite &#123;</span><br><span class="line">                            <span class="type">Image</span>(systemName: <span class="string">&quot;star.fill&quot;</span>)</span><br><span class="line">                                .foregroundColor(<span class="type">Color</span>.yellow)</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="type">Image</span>(systemName: <span class="string">&quot;star&quot;</span>)</span><br><span class="line">                                .foregroundColor(<span class="type">Color</span>.gray)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(landmark.park)</span><br><span class="line">                        .font(caption)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(landmark.state)</span><br><span class="line">                        .font(.caption)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="type">Text</span>(landmark.name), displayMode: .inline)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkDetail</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">            .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤3-37">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-5"></a></p>
<p>切换回<code>LandmarkList.swift</code>，并打开实时预览。</p>
<p>当您从列表导航到详情信息并点击按钮时，这些更改将在您返回列表时保持不变。因为两个视图都在访问环境中的同一个模型对象，所以两个视图保持一致性。</p>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/_proj_1_3_complete.gif" alt=""></p>
<blockquote>
<p>User Interface</p>
</blockquote>
<h2 id="视图和控件">视图和控件</h2>
<p><a href="#%E8%A7%86%E5%9B%BE%E5%92%8C%E6%8E%A7%E4%BB%B6"></a></p>
<p>在屏幕上显示内容并处理用户交互。</p>
<h2 id="概述">概述</h2>
<p><a href="#%E6%A6%82%E8%BF%B0"></a></p>
<p>视图和控件是应用程序用户界面的可视化构建区块。使用它们在屏幕上显示应用程序的内容。视图可以描述文本、图像、形状、自定义绘图以及所有这些内容的组合。控件允许用户使用一致的API与其相应的平台和上下文进行交互。</p>
<p>使用指定其视觉关系和层次结构的容器合并视图。使用名为修饰符<code>modifiers</code>的方法自定义内置视图和为应用程序创建的视图的显示、行为和交互。</p>
<p>将修饰符<code>modifiers</code>应用于视图和控件：</p>
<ul>
<li>控制视图的大小、位置和外观属性。</li>
<li>响应轻触、手势和其他用户交互。</li>
<li>支持拖拽操作。</li>
<li>自定义动画和转场。</li>
<li>设置样式首选项和其他环境数据。</li>
</ul>
<p>有关如何使用视图和控件的其他信息，请参见人机界面指南。</p>
<h2 id="话题">话题</h2>
<p><a href="#%E8%AF%9D%E9%A2%98"></a></p>
<h3 id="摘要">摘要</h3>
<p><a href="#%E6%91%98%E8%A6%81"></a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/ly918/SwiftUI-Chinese-Documents/wiki/D1-View"><code>protocol View</code></a></p>
<p>视图:用来描述SwiftUI的视图类型。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/ly918/SwiftUI-Chinese-Documents/wiki/01-Creating-And-Combining-Views">Creating and Combining Views</a></p>
<p>创建并组合视图：本教程将指导您构建地标，这是一个iOS应用程序，用于发现和共享您喜欢的地方。您将首先构建显示地标的详情视图。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/ly918/SwiftUI-Chinese-Documents/wiki/02-Working-with-UI-Controls">Working with UI Controls</a></p>
<p>使用UI控件：在地标应用程序中，用户可以创建个人简介来表达他们的个性。为了让用户能够更改他们的个人简介，您将添加一个编辑模式并设计首选项页面。</p>
<h3 id="文本-Text">文本 Text</h3>
<p><a href="#%E6%96%87%E6%9C%AC-text"></a></p>
<p><code>struct Text</code></p>
<p>文本：显示一行或多行只读文本的视图。</p>
<p><code>struct TextField</code></p>
<p>文本输入框：显示可编辑文本的控件。</p>
<p><code>struct SecureField</code></p>
<p>密文输入框：用户安全输入私密文本的控件。</p>
<p><code>struct Font</code></p>
<p>字体：依赖于环境的字体。</p>
<h3 id="图像-Images">图像 Images</h3>
<p><a href="#%E5%9B%BE%E5%83%8F-images"></a></p>
<p><code>struct Image</code></p>
<p>图像：显示依赖于环境的图像视图。</p>
<h3 id="按钮-Buttons">按钮 Buttons</h3>
<p><a href="#%E6%8C%89%E9%92%AE-buttons"></a></p>
<p><code>struct Button</code></p>
<p>按钮：触控时执行操作的控件。</p>
<p><code>struct NavigationLink</code></p>
<p>导航链接：按下时触发导航显示的按钮。</p>
<p><code>struct MenuButton</code></p>
<p>菜单按钮：当按下时显示包含选项列表的菜单的按钮。</p>
<p><code>struct EditButton</code></p>
<p>编辑按钮：切换当前编辑范围的编辑模式的按钮。</p>
<p><code>struct PasteButton</code></p>
<p>粘贴按钮：触发从粘贴板读取数据的系统按钮。</p>
<h3 id="值选择器-Value-Selectors">值选择器 Value Selectors</h3>
<p><a href="#%E5%80%BC%E9%80%89%E6%8B%A9%E5%99%A8-value-selectors"></a></p>
<p><code>struct Toggle</code></p>
<p>开关：在打开和关闭状态之间切换的控件。</p>
<p><code>struct Picker</code></p>
<p>选择器：从一组互斥值中进行选择的控件。</p>
<p><code>struct DatePicker</code></p>
<p>日期选择器：用于选择绝对日期的控件。</p>
<p><code>struct Slider</code></p>
<p>滑块：从有界线性值范围中选择值的控件。</p>
<p><code>struct Stepper</code></p>
<p>步进器：用于执行递增和递减操作的控件。</p>
<h3 id="支持类型-Supporting-Types">支持类型 Supporting Types</h3>
<p><a href="#%E6%94%AF%E6%8C%81%E7%B1%BB%E5%9E%8B-supporting-types"></a></p>
<p><code>struct ViewBuilder</code></p>
<p>视图构建器：从闭包构造视图的自定义参数属性。</p>
<p><code>protocol ViewModifier</code></p>
<p>视图修饰器：应用于视图或其他视图的修饰器，生成原始值的不同版本。</p>
<blockquote>
<p>protocol</p>
</blockquote>
<h2 id="View">View</h2>
<p><a href="#view"></a></p>
<p>一个表示SwiftUI视图的类型。</p>
<p>代码释义</p>
<h2 id="声明">声明</h2>
<p><a href="#%E5%A3%B0%E6%98%8E"></a></p>
<blockquote>
<p>protocol View</p>
</blockquote>
<h2 id="概述-2">概述</h2>
<p><a href="#%E6%A6%82%E8%BF%B0"></a></p>
<p>通过声明遵守<code>View protocol</code>的类型来创建自定义视图。实现所需的<code>body</code>计算属性，以提供自定义视图的内容和行为。</p>
<h2 id="主题">主题</h2>
<p><a href="#%E4%B8%BB%E9%A2%98"></a></p>
<h3 id="1-Implementing-a-Custom-View-实现自定义视图">1 - Implementing a Custom View - 实现自定义视图</h3>
<p><a href="#1---implementing-a-custom-view---%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A7%86%E5%9B%BE"></a></p>
<h4 id="1-1-视图的内容和行为。必需的，默认实现。">1.1 视图的内容和行为。必需的，默认实现。</h4>
<p><a href="#11-%E8%A7%86%E5%9B%BE%E7%9A%84%E5%86%85%E5%AE%B9%E5%92%8C%E8%A1%8C%E4%B8%BA%E5%BF%85%E9%9C%80%E7%9A%84%E9%BB%98%E8%AE%A4%E5%AE%9E%E7%8E%B0"></a></p>
<blockquote>
<p>demo</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="comment">/// 1 - Implementing a Custom View - 实现自定义视图</span></span><br><span class="line">    <span class="comment">/// 视图的内容和行为。</span></span><br><span class="line">    <span class="comment">/// 必需的。默认实现。</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">            .background(<span class="type">Color</span>.yellow)</span><br><span class="line">            .border(<span class="type">Color</span>.red, width: <span class="number">2</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-Sizing-a-Views-制定视图的大小">2 - Sizing a Views - 制定视图的大小</h3>
<p><a href="#2---sizing-a-views---%E5%88%B6%E5%AE%9A%E8%A7%86%E5%9B%BE%E7%9A%84%E5%A4%A7%E5%B0%8F"></a></p>
<h4 id="2-1-将视图定位在具有指定大小的不可见框架中">2.1 将视图定位在具有指定大小的不可见框架中</h4>
<p><a href="#21-%E5%B0%86%E8%A7%86%E5%9B%BE%E5%AE%9A%E4%BD%8D%E5%9C%A8%E5%85%B7%E6%9C%89%E6%8C%87%E5%AE%9A%E5%A4%A7%E5%B0%8F%E7%9A%84%E4%B8%8D%E5%8F%AF%E8%A7%81%E6%A1%86%E6%9E%B6%E4%B8%AD"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">frame</span>(<span class="params">width</span>: <span class="type">CGFloat</span>?, <span class="params">height</span>: <span class="type">CGFloat</span>?, <span class="params">alignment</span>: <span class="type">Alignment</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="2-2-将视图定位在具有指定宽度和高度的不可见框架中。">2.2 将视图定位在具有指定宽度和高度的不可见框架中。</h4>
<p><a href="#22-%E5%B0%86%E8%A7%86%E5%9B%BE%E5%AE%9A%E4%BD%8D%E5%9C%A8%E5%85%B7%E6%9C%89%E6%8C%87%E5%AE%9A%E5%AE%BD%E5%BA%A6%E5%92%8C%E9%AB%98%E5%BA%A6%E7%9A%84%E4%B8%8D%E5%8F%AF%E8%A7%81%E6%A1%86%E6%9E%B6%E4%B8%AD"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">frame</span>(<span class="params">minWidth</span>: <span class="type">CGFloat</span>?, <span class="params">idealWidth</span>: <span class="type">CGFloat</span>?, <span class="params">maxWidth</span>: <span class="type">CGFloat</span>?, <span class="params">minHeight</span>: <span class="type">CGFloat</span>?, <span class="params">idealHeight</span>: <span class="type">CGFloat</span>?, <span class="params">maxHeight</span>: <span class="type">CGFloat</span>?, <span class="params">alignment</span>: <span class="type">Alignment</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="2-3-将视图修复为理想大小。">2.3 将视图修复为理想大小。</h4>
<p><a href="#23-%E5%B0%86%E8%A7%86%E5%9B%BE%E4%BF%AE%E5%A4%8D%E4%B8%BA%E7%90%86%E6%83%B3%E5%A4%A7%E5%B0%8F"></a></p>
<h4 id="2-4-将视图修复为理想大小，可指定垂直或水平方向的修复。">2.4 将视图修复为理想大小，可指定垂直或水平方向的修复。</h4>
<p><a href="#24-%E5%B0%86%E8%A7%86%E5%9B%BE%E4%BF%AE%E5%A4%8D%E4%B8%BA%E7%90%86%E6%83%B3%E5%A4%A7%E5%B0%8F%E5%8F%AF%E6%8C%87%E5%AE%9A%E5%9E%82%E7%9B%B4%E6%88%96%E6%B0%B4%E5%B9%B3%E6%96%B9%E5%90%91%E7%9A%84%E4%BF%AE%E5%A4%8D"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">fixedSize</span>(<span class="params">horizontal</span>: <span class="type">Bool</span>, <span class="params">vertical</span>: <span class="type">Bool</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="2-5-设置父布局应将空间分配给子布局的优先级，默认为0。">2.5 设置父布局应将空间分配给子布局的优先级，默认为0。</h4>
<p><a href="#25-%E8%AE%BE%E7%BD%AE%E7%88%B6%E5%B8%83%E5%B1%80%E5%BA%94%E5%B0%86%E7%A9%BA%E9%97%B4%E5%88%86%E9%85%8D%E7%BB%99%E5%AD%90%E5%B8%83%E5%B1%80%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%E9%BB%98%E8%AE%A4%E4%B8%BA0"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">layoutPriority</span>(<span class="type">Double</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>demo</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SizingInViews</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="comment">/// 2 - Sizing a Views - 制定视图大小</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="comment">/// 2.1 将视图定位在具有指定大小的不可见框架中。</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">                .background(<span class="type">Color</span>.yellow)</span><br><span class="line">                .border(<span class="type">Color</span>.red, width: <span class="number">2</span>)</span><br><span class="line">                .frame(width: <span class="number">200</span>, height: <span class="number">50</span>, alignment: .topLeading)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/// 2.2 将视图定位在具有指定宽度和高度的不可见框架中。</span></span><br><span class="line">           <span class="type">Text</span>(<span class="string">&quot;Hello, World 2Hello, World 2Hello, World 2Hello, World 2Hello, World 2Hello, World 2Hello&quot;</span>)</span><br><span class="line">                .background(<span class="type">Color</span>.yellow)</span><br><span class="line">                .border(<span class="type">Color</span>.red, width: <span class="number">2</span>)</span><br><span class="line">                .frame(minWidth: <span class="number">10</span>, idealWidth: <span class="number">60</span>, maxWidth: <span class="number">300</span>, minHeight: <span class="number">10</span>, idealHeight: <span class="number">60</span>, maxHeight: <span class="number">300</span>, alignment: .topTrailing)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/// 2.3 将视图固定在其理想大小。</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Hello, World3&quot;</span>)</span><br><span class="line">                .background(<span class="type">Color</span>.yellow)</span><br><span class="line">                .border(<span class="type">Color</span>.red, width: <span class="number">2</span>)</span><br><span class="line">                .fixedSize()</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/// 2.4 将视图修复为理想大小，可指定垂直或水平方向的修复。</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Hello, World4Hello, World4HelloHello, World4Hello, World4HelloHello&quot;</span>)</span><br><span class="line">                .background(<span class="type">Color</span>.yellow)</span><br><span class="line">                .border(<span class="type">Color</span>.red, width: <span class="number">2</span>)</span><br><span class="line">                .fixedSize(horizontal: <span class="literal">true</span>, vertical: <span class="literal">false</span>)</span><br><span class="line">                .frame(width: <span class="number">200</span>, height: <span class="number">200</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/// 2.5 指定布局优先级 默认为0</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Hello, World5&quot;</span>)</span><br><span class="line">                .background(<span class="type">Color</span>.yellow)</span><br><span class="line">                .border(<span class="type">Color</span>.red, width: <span class="number">2</span>)</span><br><span class="line">                .layoutPriority(<span class="number">1</span>)</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-Positioning-a-View-定位视图">3 - Positioning a View - 定位视图</h3>
<p><a href="#3---positioning-a-view---%E5%AE%9A%E4%BD%8D%E8%A7%86%E5%9B%BE"></a></p>
<h4 id="3-1-将视图的中心固定在其父坐标空间的指定点上。">3.1 将视图的中心固定在其父坐标空间的指定点上。</h4>
<p><a href="#31-%E5%B0%86%E8%A7%86%E5%9B%BE%E7%9A%84%E4%B8%AD%E5%BF%83%E5%9B%BA%E5%AE%9A%E5%9C%A8%E5%85%B6%E7%88%B6%E5%9D%90%E6%A0%87%E7%A9%BA%E9%97%B4%E7%9A%84%E6%8C%87%E5%AE%9A%E7%82%B9%E4%B8%8A"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">position</span>(<span class="type">CGPoint</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="3-2-将视图的中心固定在其父坐标空间中指定的坐标上。">3.2 将视图的中心固定在其父坐标空间中指定的坐标上。</h4>
<p><a href="#32-%E5%B0%86%E8%A7%86%E5%9B%BE%E7%9A%84%E4%B8%AD%E5%BF%83%E5%9B%BA%E5%AE%9A%E5%9C%A8%E5%85%B6%E7%88%B6%E5%9D%90%E6%A0%87%E7%A9%BA%E9%97%B4%E4%B8%AD%E6%8C%87%E5%AE%9A%E7%9A%84%E5%9D%90%E6%A0%87%E4%B8%8A"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">position</span>(<span class="params">x</span>: <span class="type">CGFloat</span>, <span class="params">y</span>: <span class="type">CGFloat</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="3-3-通过给定Size中的width和height偏移视图。">3.3 通过给定<code>Size</code>中的<code>width</code>和<code>height</code>偏移视图。</h4>
<p><a href="#33-%E9%80%9A%E8%BF%87%E7%BB%99%E5%AE%9Asize%E4%B8%AD%E7%9A%84width%E5%92%8Cheight%E5%81%8F%E7%A7%BB%E8%A7%86%E5%9B%BE"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">offset</span>(<span class="type">CGSize</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="3-4-通过指定的x和y值偏移视图。">3.4 通过指定的<code>x</code>和<code>y</code>值偏移视图。</h4>
<p><a href="#34-%E9%80%9A%E8%BF%87%E6%8C%87%E5%AE%9A%E7%9A%84x%E5%92%8Cy%E5%80%BC%E5%81%8F%E7%A7%BB%E8%A7%86%E5%9B%BE"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">offset</span>(<span class="params">x</span>: <span class="type">CGFloat</span>, <span class="params">y</span>: <span class="type">CGFloat</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="3-5-将视图延展到指定边缘的安全区域之外。">3.5 将视图延展到指定边缘的安全区域之外。</h4>
<p><a href="#35-%E5%B0%86%E8%A7%86%E5%9B%BE%E5%BB%B6%E5%B1%95%E5%88%B0%E6%8C%87%E5%AE%9A%E8%BE%B9%E7%BC%98%E7%9A%84%E5%AE%89%E5%85%A8%E5%8C%BA%E5%9F%9F%E4%B9%8B%E5%A4%96"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">edgesIgnoringSafeArea</span>(<span class="type">Edge</span>.<span class="type">Set</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="3-6-将名称分配给此视图的坐标空间，此视图的后代可以将其引用。">3.6 将名称分配给此视图的坐标空间，此视图的后代可以将其引用。</h4>
<p><a href="#36-%E5%B0%86%E5%90%8D%E7%A7%B0%E5%88%86%E9%85%8D%E7%BB%99%E6%AD%A4%E8%A7%86%E5%9B%BE%E7%9A%84%E5%9D%90%E6%A0%87%E7%A9%BA%E9%97%B4%E6%AD%A4%E8%A7%86%E5%9B%BE%E7%9A%84%E5%90%8E%E4%BB%A3%E5%8F%AF%E4%BB%A5%E5%B0%86%E5%85%B6%E5%BC%95%E7%94%A8"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">coordinateSpace</span>&lt;<span class="type">T</span>&gt;(<span class="params">name</span>: <span class="type">T</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>demo</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PositioningAViews</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="comment">/// 3  - Positioning a View - 定位视图</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span> &#123;</span><br><span class="line">            <span class="comment">/// 3.1 将视图的中心固定在其父坐标空间的指定点上。</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">                .background(<span class="type">Color</span>.red)</span><br><span class="line">                .position(<span class="type">CGPoint</span>(x: <span class="number">100</span>, y: <span class="number">0</span>))</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/// 3.2 将视图的中心固定在其父坐标空间中指定的坐标上。</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Hello, World2&quot;</span>)</span><br><span class="line">                .background(<span class="type">Color</span>.green)</span><br><span class="line">                .position(x: <span class="number">100</span>, y: <span class="number">30</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/// 3.3 通过给定`Size`中的`width`和`height`偏移视图。</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Hello, World3&quot;</span>)</span><br><span class="line">                .background(<span class="type">Color</span>.red)</span><br><span class="line">                .position(x: <span class="number">100</span>, y: <span class="number">60</span>)</span><br><span class="line">                .offset(<span class="type">CGSize</span>(width: <span class="number">30</span>, height: <span class="number">0</span>))</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/// 3.4 通过指定的`x`和`y`值偏移视图。</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Hello, World4&quot;</span>)</span><br><span class="line">                .background(<span class="type">Color</span>.green)</span><br><span class="line">                .position(x: <span class="number">100</span>, y: <span class="number">90</span>)</span><br><span class="line">                .offset(x: <span class="operator">-</span><span class="number">30</span>, y: <span class="number">0</span>)</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line">        .edgesIgnoringSafeArea(.top)<span class="comment">/// 3.5 将视图延展到指定边缘的安全区域之外。</span></span><br><span class="line">        .coordinateSpace(name: <span class="string">&quot;test&quot;</span>)<span class="comment">/// 3.6 将名称分配给此视图的坐标空间，此视图的后代可以将其引用。</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-Aligning-Views-设置视图的对其方式">4 - Aligning Views - 设置视图的对其方式</h3>
<p><a href="#4---aligning-views---%E8%AE%BE%E7%BD%AE%E8%A7%86%E5%9B%BE%E7%9A%84%E5%AF%B9%E5%85%B6%E6%96%B9%E5%BC%8F"></a></p>
<h4 id="4-1-设置视图的水平对齐方式。">4.1 设置视图的水平对齐方式。</h4>
<p><a href="#41-%E8%AE%BE%E7%BD%AE%E8%A7%86%E5%9B%BE%E7%9A%84%E6%B0%B4%E5%B9%B3%E5%AF%B9%E9%BD%90%E6%96%B9%E5%BC%8F"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">alignmentGuide</span>(<span class="type">HorizontalAlignment</span>, <span class="params">computeValue</span>: (<span class="type">ViewDimensions</span>) -&gt; <span class="type">CGFloat</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="4-2-设置视图的垂直">4.2 设置视图的垂直</h4>
<p><a href="#42-%E8%AE%BE%E7%BD%AE%E8%A7%86%E5%9B%BE%E7%9A%84%E5%9E%82%E7%9B%B4"></a></p>
<p>对齐方式。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">alignmentGuide</span>(<span class="type">VerticalAlignment</span>, <span class="params">computeValue</span>: (<span class="type">ViewDimensions</span>) -&gt; <span class="type">CGFloat</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="4-3-视图在其自身的坐标空间中的大小和对齐方式的规则。">4.3 视图在其自身的坐标空间中的大小和对齐方式的规则。</h4>
<p><a href="#43-%E8%A7%86%E5%9B%BE%E5%9C%A8%E5%85%B6%E8%87%AA%E8%BA%AB%E7%9A%84%E5%9D%90%E6%A0%87%E7%A9%BA%E9%97%B4%E4%B8%AD%E7%9A%84%E5%A4%A7%E5%B0%8F%E5%92%8C%E5%AF%B9%E9%BD%90%E6%96%B9%E5%BC%8F%E7%9A%84%E8%A7%84%E5%88%99"></a></p>
<h4 id="4-4-用于标识对齐规则的类型。">4.4 用于标识对齐规则的类型。</h4>
<p><a href="#44-%E7%94%A8%E4%BA%8E%E6%A0%87%E8%AF%86%E5%AF%B9%E9%BD%90%E8%A7%84%E5%88%99%E7%9A%84%E7%B1%BB%E5%9E%8B"></a></p>
<h3 id="5-Adjusting-the-Padding-of-a-View-调整视图边距">5 - Adjusting the Padding of a View - 调整视图边距</h3>
<p><a href="#5---adjusting-the-padding-of-a-view---%E8%B0%83%E6%95%B4%E8%A7%86%E5%9B%BE%E8%BE%B9%E8%B7%9D"></a></p>
<h4 id="5-1-将视图沿所有边缘内嵌填充指定的大小。">5.1 将视图沿所有边缘内嵌填充指定的大小。</h4>
<p><a href="#51-%E5%B0%86%E8%A7%86%E5%9B%BE%E6%B2%BF%E6%89%80%E6%9C%89%E8%BE%B9%E7%BC%98%E5%86%85%E5%B5%8C%E5%A1%AB%E5%85%85%E6%8C%87%E5%AE%9A%E7%9A%84%E5%A4%A7%E5%B0%8F"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">padding</span>(<span class="type">CGFloat</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="5-2-使用指定的EdgeInsets内嵌填充视图。">5.2 使用指定的<code>EdgeInsets</code>内嵌填充视图。</h4>
<p><a href="#52-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AE%9A%E7%9A%84edgeinsets%E5%86%85%E5%B5%8C%E5%A1%AB%E5%85%85%E8%A7%86%E5%9B%BE"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">padding</span>(<span class="type">EdgeInsets</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="5-3-使用指定的Edge集合内嵌填充指定大小。">5.3 使用指定的<code>Edge</code>集合内嵌填充指定大小。</h4>
<p><a href="#53-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AE%9A%E7%9A%84edge%E9%9B%86%E5%90%88%E5%86%85%E5%B5%8C%E5%A1%AB%E5%85%85%E6%8C%87%E5%AE%9A%E5%A4%A7%E5%B0%8F"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">padding</span>(<span class="type">Edge</span>.<span class="type">Set</span>, <span class="type">CGFloat</span>?) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="5-4-定义了矩形各边的内嵌距离的结构体。">5.4 定义了矩形各边的内嵌距离的结构体。</h4>
<p><a href="#54-%E5%AE%9A%E4%B9%89%E4%BA%86%E7%9F%A9%E5%BD%A2%E5%90%84%E8%BE%B9%E7%9A%84%E5%86%85%E5%B5%8C%E8%B7%9D%E7%A6%BB%E7%9A%84%E7%BB%93%E6%9E%84%E4%BD%93"></a></p>
<blockquote>
<p>demo</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">AdjustingPaddingView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="comment">/// 5 - Adjusting the Padding of a View - 调整视图边距</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span> &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="comment">/*@START_MENU_TOKEN@*/</span><span class="string">&quot;Hello, World!&quot;</span><span class="comment">/*@END_MENU_TOKEN@*/</span>)</span><br><span class="line">                .background(<span class="type">Color</span>.yellow)</span><br><span class="line">                .border(<span class="type">Color</span>.red, width: <span class="number">2</span>)</span><br><span class="line">                .position(x: <span class="number">100</span>, y: <span class="number">30</span>)</span><br><span class="line">                .padding()</span><br><span class="line">                </span><br><span class="line">        &#125;</span><br><span class="line">        .background(<span class="type">Color</span>.gray)</span><br><span class="line"><span class="comment">//        .padding()///  默认边距</span></span><br><span class="line"><span class="comment">//        .padding(30) /// 5.1 将视图沿所有边缘内嵌填充指定的大小。</span></span><br><span class="line"><span class="comment">//        .padding(EdgeInsets(top: 20, leading: 10, bottom: 60, trailing: 50)) /// 5.2 使用指定的`EdgeInsets`内嵌填充视图。</span></span><br><span class="line">        .padding([.leading,.trailing], <span class="number">20</span>) <span class="comment">/// 5.3 使用指定的`Edge`集合内嵌填充指定大小。</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../../../2023/10/15/Swift/SwiftUI%E6%96%87%E6%A1%A3/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../../../2023/07/14/Swift/swift%E9%AB%98%E7%BA%A7%E8%BF%90%E7%AE%97%E7%AC%A6/"
                            aria-label=": swift高级运算符"
                        >
                            swift高级运算符
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2023-07-14T10:13:17+08:00">
	
		    2023 年 7 月 14 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../">编程语言</a>, <a class="category-link" href="../../swift/">swift</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="高级运算符">高级运算符</h2>
<p>除了之前介绍过的 <a target="_blank" rel="noopener" href="https://www.runoob.com/manual/gitbook/swift5/source/_book/chapter2/02_Basic_Operators.html">基本运算符</a>，Swift 还提供了数种可以对数值进行复杂运算的高级运算符。它们包含了在 C 和 Objective-C 中已经被大家所熟知的位运算符和移位运算符。</p>
<p>与 C 语言中的算术运算符不同，Swift 中的算术运算符默认是不会溢出的。所有溢出行为都会被捕获并报告为错误。如果想让系统允许溢出行为，可以选择使用 Swift 中另一套默认支持溢出的运算符，比如溢出加法运算符（<code>&amp;+</code>）。所有的这些溢出运算符都是以 <code>&amp;</code> 开头的。</p>
<p>自定义结构体、类和枚举时，如果也为它们提供标准 Swift 运算符的实现，将会非常有用。在 Swift 中为这些运算符提供自定义的实现非常简单，运算符也会针对不同类型使用对应实现。</p>
<p>我们不用被预定义的运算符所限制。在 Swift 中可以自由地定义中缀、前缀、后缀和赋值运算符，它们具有自定义的优先级与关联值。这些运算符在代码中可以像预定义的运算符一样使用，你甚至可以扩展已有的类型以支持自定义运算符。</p>
<h2 id="位运算符">位运算符</h2>
<p><em>位运算符</em>可以操作数据结构中每个独立的比特位。它们通常被用在底层开发中，比如图形编程和创建设备驱动。位运算符在处理外部资源的原始数据时也十分有用，比如对自定义通信协议传输的数据进行编码和解码。</p>
<p>Swift 支持 C 语言中的全部位运算符，接下来会一一介绍。</p>
<h3 id="Bitwise-NOT-Operator（按位取反运算符）">Bitwise NOT Operator（按位取反运算符）</h3>
<p>*按位取反运算符（<code>~</code>）*对一个数值的全部比特位进行取反：</p>
<p><img src="https://docs.swift.org/swift-book/_images/bitwiseNOT_2x.png" alt="Art/bitwiseNOT_2x.png"></p>
<p>按位取反运算符是一个前缀运算符，直接放在运算数之前，并且它们之间不能添加任何空格：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> initialBits: <span class="type">UInt8</span> <span class="operator">=</span> <span class="number">0b00001111</span></span><br><span class="line"><span class="keyword">let</span> invertedBits <span class="operator">=</span> <span class="operator">~</span>initialBits <span class="comment">// 等于 0b11110000</span></span><br></pre></td></tr></table></figure>
<p><code>UInt8</code> 类型的整数有 8 个比特位，可以存储 <code>0 ~ 255</code> 之间的任意整数。这个例子初始化了一个 <code>UInt8</code> 类型的整数，并赋值为二进制的 <code>00001111</code>，它的前 4 位为 <code>0</code>，后 4 位为 <code>1</code>。这个值等价于十进制的 <code>15</code>。</p>
<p>接着使用按位取反运算符创建了一个名为 <code>invertedBits</code> 的常量，这个常量的值与全部位取反后的 <code>initialBits</code> 相等。即所有的 <code>0</code> 都变成了 <code>1</code>，同时所有的 <code>1</code> 都变成 <code>0</code>。<code>invertedBits</code> 的二进制值为 <code>11110000</code>，等价于无符号十进制数的 <code>240</code>。</p>
<h3 id="Bitwise-AND-Operator（按位与运算符）">Bitwise AND Operator（按位与运算符）</h3>
<p><em>按位与运算符（<code>&amp;</code>）</em> 对两个数的比特位进行合并。它返回一个新的数，只有当两个数的对应位<em>都</em>为 <code>1</code> 的时候，新数的对应位才为 <code>1</code>：</p>
<p><img src="https://docs.swift.org/swift-book/_images/bitwiseAND_2x.png" alt="Art/bitwiseAND_2x.png"></p>
<p>在下面的示例当中，<code>firstSixBits</code> 和 <code>lastSixBits</code> 中间 4 个位的值都为 <code>1</code>。使用按位与运算符之后，得到二进制数值 <code>00111100</code>，等价于无符号十进制数的 <code>60</code>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> firstSixBits: <span class="type">UInt8</span> <span class="operator">=</span> <span class="number">0b11111100</span></span><br><span class="line"><span class="keyword">let</span> lastSixBits: <span class="type">UInt8</span>  <span class="operator">=</span> <span class="number">0b00111111</span></span><br><span class="line"><span class="keyword">let</span> middleFourBits <span class="operator">=</span> firstSixBits <span class="operator">&amp;</span> lastSixBits <span class="comment">// 等于 00111100</span></span><br></pre></td></tr></table></figure>
<h3 id="Bitwise-OR-Operator（按位或运算符）">Bitwise OR Operator（按位或运算符）</h3>
<p><em>按位或运算符（<code>|</code>）<em>可以对两个数的比特位进行比较。它返回一个新的数，只要两个数的对应位中有</em>任意一个</em>为 <code>1</code> 时，新数的对应位就为 <code>1</code>：</p>
<p><img src="https://docs.swift.org/swift-book/_images/bitwiseOR_2x.png" alt="Art/bitwiseOR_2x.png"></p>
<p>在下面的示例中，<code>someBits</code> 和 <code>moreBits</code> 存在不同的位被设置为 <code>1</code>。使用按位或运算符之后，得到二进制数值 <code>11111110</code>，等价于无符号十进制数的 <code>254</code>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> someBits: <span class="type">UInt8</span> <span class="operator">=</span> <span class="number">0b10110010</span></span><br><span class="line"><span class="keyword">let</span> moreBits: <span class="type">UInt8</span> <span class="operator">=</span> <span class="number">0b01011110</span></span><br><span class="line"><span class="keyword">let</span> combinedbits <span class="operator">=</span> someBits <span class="operator">|</span> moreBits <span class="comment">// 等于 11111110</span></span><br></pre></td></tr></table></figure>
<h3 id="Bitwise-XOR-Operator（按位异或运算符）">Bitwise XOR Operator（按位异或运算符）</h3>
<p><em>按位异或运算符</em>，或称“排外的或运算符”（<code>^</code>），可以对两个数的比特位进行比较。它返回一个新的数，当两个数的对应位不相同时，新数的对应位就为 <code>1</code>，并且对应位相同时则为 <code>0</code>：</p>
<p><img src="https://docs.swift.org/swift-book/_images/bitwiseXOR_2x.png" alt="Art/bitwiseXOR_2x.png"></p>
<p>在下面的示例当中，<code>firstBits</code> 和 <code>otherBits</code> 都有一个自己为 <code>1</code>，而对方为 <code>0</code> 的位。按位异或运算符将新数的这两个位都设置为 <code>1</code>。在其余的位上 <code>firstBits</code> 和 <code>otherBits</code> 是相同的，所以设置为 <code>0</code>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> firstBits: <span class="type">UInt8</span> <span class="operator">=</span> <span class="number">0b00010100</span></span><br><span class="line"><span class="keyword">let</span> otherBits: <span class="type">UInt8</span> <span class="operator">=</span> <span class="number">0b00000101</span></span><br><span class="line"><span class="keyword">let</span> outputBits <span class="operator">=</span> firstBits <span class="operator">^</span> otherBits <span class="comment">// 等于 00010001</span></span><br></pre></td></tr></table></figure>
<h3 id="Bitwise-Left-and-Right-Shift-Operators（按位左移、右移运算符）">Bitwise Left and Right Shift Operators（按位左移、右移运算符）</h3>
<p><em>按位左移运算符（<code>&lt;&lt;</code>）</em> 和 *按位右移运算符（<code>&gt;&gt;</code>）*可以对一个数的所有位进行指定位数的左移和右移，但是需要遵守下面定义的规则。</p>
<p>对一个数进行按位左移或按位右移，相当于对这个数进行乘以 2 或除以 2 的运算。将一个整数左移一位，等价于将这个数乘以 2，同样地，将一个整数右移一位，等价于将这个数除以 2。</p>
<h4 id="无符号整数的移位运算">无符号整数的移位运算</h4>
<p>对无符号整数进行移位的规则如下：</p>
<ol>
<li>已存在的位按指定的位数进行左移和右移。</li>
<li>任何因移动而超出整型存储范围的位都会被丢弃。</li>
<li>用 <code>0</code> 来填充移位后产生的空白位。</li>
</ol>
<p>这种方法称为<em>逻辑移位</em>。</p>
<p>以下这张图展示了 <code>11111111 &lt;&lt; 1</code>（即把 <code>11111111</code> 向左移动 <code>1</code> 位），和 <code>11111111 &gt;&gt; 1</code>（即把 <code>11111111</code> 向右移动 <code>1</code> 位）的结果。蓝色的数字是被移位的，灰色的数字是被抛弃的，橙色的 <code>0</code> 则是被填充进来的：</p>
<p><img src="https://docs.swift.org/swift-book/_images/bitshiftUnsigned_2x.png" alt="Art/bitshiftUnsigned_2x.png"></p>
<p>下面的代码演示了 Swift 中的移位运算：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> shiftBits: <span class="type">UInt8</span> <span class="operator">=</span> <span class="number">4</span> <span class="comment">// 即二进制的 00000100</span></span><br><span class="line">shiftBits <span class="operator">&lt;&lt;</span> <span class="number">1</span>           <span class="comment">// 00001000</span></span><br><span class="line">shiftBits <span class="operator">&lt;&lt;</span> <span class="number">2</span>           <span class="comment">// 00010000</span></span><br><span class="line">shiftBits <span class="operator">&lt;&lt;</span> <span class="number">5</span>           <span class="comment">// 10000000</span></span><br><span class="line">shiftBits <span class="operator">&lt;&lt;</span> <span class="number">6</span>           <span class="comment">// 00000000</span></span><br><span class="line">shiftBits <span class="operator">&gt;&gt;</span> <span class="number">2</span>           <span class="comment">// 00000001</span></span><br></pre></td></tr></table></figure>
<p>可以使用移位运算对其他的数据类型进行编码和解码：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> pink: <span class="type">UInt32</span> <span class="operator">=</span> <span class="number">0xCC6699</span></span><br><span class="line"><span class="keyword">let</span> redComponent <span class="operator">=</span> (pink <span class="operator">&amp;</span> <span class="number">0xFF0000</span>) <span class="operator">&gt;&gt;</span> <span class="number">16</span>  <span class="comment">// redComponent 是 0xCC，即 204</span></span><br><span class="line"><span class="keyword">let</span> greenComponent <span class="operator">=</span> (pink <span class="operator">&amp;</span> <span class="number">0x00FF00</span>) <span class="operator">&gt;&gt;</span> <span class="number">8</span> <span class="comment">// greenComponent 是 0x66， 即 102</span></span><br><span class="line"><span class="keyword">let</span> blueComponent <span class="operator">=</span> pink <span class="operator">&amp;</span> <span class="number">0x0000FF</span>         <span class="comment">// blueComponent 是 0x99，即 153</span></span><br></pre></td></tr></table></figure>
<p>这个示例使用了一个命名为 <code>pink</code> 的 <code>UInt32</code> 型常量来存储 Cascading Style Sheets（CSS）中粉色的颜色值。该 CSS 的颜色值 <code>#CC6699</code>，在 Swift 中表示为十六进制的 <code>0xCC6699</code>。然后利用按位与运算符（<code>&amp;</code>）和按位右移运算符（<code>&gt;&gt;</code>）从这个颜色值中分解出红（<code>CC</code>）、绿（<code>66</code>）以及蓝（<code>99</code>）三个部分。</p>
<p>红色部分是通过对 <code>0xCC6699</code> 和 <code>0xFF0000</code> 进行按位与运算后得到的。<code>0xFF0000</code> 中的 <code>0</code> 部分“掩盖”了 <code>OxCC6699</code> 中的第二、第三个字节，使得数值中的 <code>6699</code> 被忽略，只留下 <code>0xCC0000</code>。</p>
<p>然后，将这个数向右移动 16 位（<code>&gt;&gt; 16</code>）。十六进制中每两个字符占用 8 个比特位，所以移动 16 位后 <code>0xCC0000</code> 就变为 <code>0x0000CC</code>。这个数和 <code>0xCC</code> 是等同的，也就是十进制数值的 <code>204</code>。</p>
<p>同样的，绿色部分通过对 <code>0xCC6699</code> 和 <code>0x00FF00</code> 进行按位与运算得到 <code>0x006600</code>。然后将这个数向右移动 8 位，得到 <code>0x66</code>，也就是十进制数值的 <code>102</code>。</p>
<p>最后，蓝色部分通过对 <code>0xCC6699</code> 和 <code>0x0000FF</code> 进行按位与运算得到 <code>0x000099</code>。这里不需要再向右移位，而 <code>0x000099</code> 也就是 <code>0x99</code> ，也就是十进制数值的 <code>153</code>。</p>
<h4 id="有符号整数的移位运算">有符号整数的移位运算</h4>
<p>对比无符号整数，有符号整数的移位运算相对复杂得多，这种复杂性源于有符号整数的二进制表现形式。（为了简单起见，以下的示例都是基于 8 比特的有符号整数，但是其中的原理对任何位数的有符号整数都是通用的。）</p>
<p>有符号整数使用第 1 个比特位（通常被称为<em>符号位</em>）来表示这个数的正负。符号位为 <code>0</code> 代表正数，为 <code>1</code> 代表负数。</p>
<p>其余的比特位（通常被称为<em>数值位</em>）存储了实际的值。有符号正整数和无符号数的存储方式是一样的，都是从 <code>0</code> 开始算起。这是值为 <code>4</code> 的 <code>Int8</code> 型整数的二进制位表现形式：</p>
<p><img src="https://docs.swift.org/swift-book/_images/bitshiftSignedFour_2x.png" alt="Art/bitshiftSignedFour_2x.png"></p>
<p>符号位为 <code>0</code>（代表这是一个“正数”），另外 7 位则代表了十进制数值 <code>4</code> 的二进制表示。</p>
<p>负数的存储方式略有不同。它存储 <code>2</code> 的 <code>n</code> 次方减去其实际值的绝对值，这里的 <code>n</code> 是数值位的位数。一个 8 比特位的数有 7 个比特位是数值位，所以是 <code>2</code> 的 <code>7</code> 次方，即 <code>128</code>。</p>
<p>这是值为 <code>-4</code> 的 <code>Int8</code> 型整数的二进制表现形式：</p>
<p><img src="https://docs.swift.org/swift-book/_images/bitshiftSignedMinusFour_2x.png" alt="Art/bitshiftSignedMinusFour_2x.png"></p>
<p>这次的符号位为 <code>1</code>，说明这是一个负数，另外 7 个位则代表了数值 <code>124</code>（即 <code>128 - 4</code>）的二进制表示：</p>
<p><img src="https://docs.swift.org/swift-book/_images/bitshiftSignedMinusFourValue_2x.png" alt="Art/bitshiftSignedMinusFourValue_2x.png"></p>
<p>负数的表示通常被称为<em>二进制补码</em>。用这种方法来表示负数乍看起来有点奇怪，但它有几个优点。</p>
<p>首先，如果想对 <code>-1</code> 和 <code>-4</code> 进行加法运算，我们只需要对这两个数的全部 8 个比特位执行标准的二进制相加（包括符号位），并且将计算结果中超出 8 位的数值丢弃：</p>
<p><img src="https://docs.swift.org/swift-book/_images/bitshiftSignedAddition_2x.png" alt="Art/bitshiftSignedAddition_2x.png"></p>
<p>其次，使用二进制补码可以使负数的按位左移和右移运算得到跟正数同样的效果，即每向左移一位就将自身的数值乘以 2，每向右一位就将自身的数值除以 2。要达到此目的，对有符号整数的右移有一个额外的规则：当对有符号整数进行按位右移运算时，遵循与无符号整数相同的规则，但是对于移位产生的空白位使用<em>符号位</em>进行填充，而不是用 <code>0</code>。</p>
<p><img src="https://docs.swift.org/swift-book/_images/bitshiftSigned_2x.png" alt="Art/bitshiftSigned_2x.png"></p>
<p>这个行为可以确保有符号整数的符号位不会因为右移运算而改变，这通常被称为<em>算术移位</em>。</p>
<p>由于正数和负数的特殊存储方式，在对它们进行右移的时候，会使它们越来越接近 <code>0</code>。在移位的过程中保持符号位不变，意味着负整数在接近 <code>0</code> 的过程中会一直保持为负。</p>
<h2 id="溢出运算符">溢出运算符</h2>
<p>当向一个整数类型的常量或者变量赋予超过它容量的值时，Swift 默认会报错，而不是允许生成一个无效的数。这个行为为我们在运算过大或者过小的数时提供了额外的安全性。</p>
<p>例如，<code>Int16</code> 型整数能容纳的有符号整数范围是 <code>-32768</code> 到 <code>32767</code>。当为一个 <code>Int16</code> 类型的变量或常量赋予的值超过这个范围时，系统就会报错：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> potentialOverflow <span class="operator">=</span> <span class="type">Int16</span>.max</span><br><span class="line"><span class="comment">// potentialOverflow 的值是 32767，这是 Int16 能容纳的最大整数</span></span><br><span class="line">potentialOverflow <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line"><span class="comment">// 这里会报错</span></span><br></pre></td></tr></table></figure>
<p>在赋值时为过大或者过小的情况提供错误处理，能让我们在处理边界值时更加灵活。</p>
<p>然而，当你希望的时候也可以选择让系统在数值溢出的时候采取截断处理，而非报错。Swift 提供的三个<em>溢出运算符</em>来让系统支持整数溢出运算。这些运算符都是以 <code>&amp;</code> 开头的：</p>
<ul>
<li>溢出加法 <code>&amp;+</code></li>
<li>溢出减法 <code>&amp;-</code></li>
<li>溢出乘法 <code>&amp;*</code></li>
</ul>
<h3 id="数值溢出">数值溢出</h3>
<p>数值有可能出现上溢或者下溢。</p>
<p>这个示例演示了当我们对一个无符号整数使用溢出加法（<code>&amp;+</code>）进行上溢运算时会发生什么：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> unsignedOverflow <span class="operator">=</span> <span class="type">UInt8</span>.max</span><br><span class="line"><span class="comment">// unsignedOverflow 等于 UInt8 所能容纳的最大整数 255</span></span><br><span class="line">unsignedOverflow <span class="operator">=</span> unsignedOverflow <span class="operator">&amp;+</span> <span class="number">1</span></span><br><span class="line"><span class="comment">// 此时 unsignedOverflow 等于 0</span></span><br></pre></td></tr></table></figure>
<p><code>unsignedOverflow</code> 被初始化为 <code>UInt8</code> 所能容纳的最大整数（<code>255</code>，以二进制表示即 <code>11111111</code>）。然后使用溢出加法运算符（<code>&amp;+</code>）对其进行加 <code>1</code> 运算。这使得它的二进制表示正好超出 <code>UInt8</code> 所能容纳的位数，也就导致了数值的溢出，如下图所示。数值溢出后，仍然留在 <code>UInt8</code> 边界内的值是 <code>00000000</code>，也就是十进制数值的 <code>0</code>。</p>
<p><img src="https://docs.swift.org/swift-book/_images/overflowAddition_2x.png" alt="Art/overflowAddition_2x.png"></p>
<p>当允许对一个无符号整数进行下溢运算时也会产生类似的情况。这里有一个使用溢出减法运算符（<code>&amp;-</code>）的例子：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> unsignedOverflow <span class="operator">=</span> <span class="type">UInt8</span>.min</span><br><span class="line"><span class="comment">// unsignedOverflow 等于 UInt8 所能容纳的最小整数 0</span></span><br><span class="line">unsignedOverflow <span class="operator">=</span> unsignedOverflow <span class="operator">&amp;-</span> <span class="number">1</span></span><br><span class="line"><span class="comment">// 此时 unsignedOverflow 等于 255</span></span><br></pre></td></tr></table></figure>
<p><code>UInt8</code> 型整数能容纳的最小值是 <code>0</code>，以二进制表示即 <code>00000000</code>。当使用溢出减法运算符对其进行减 <code>1</code> 运算时，数值会产生下溢并被截断为 <code>11111111</code>， 也就是十进制数值的 <code>255</code>。</p>
<p><img src="https://docs.swift.org/swift-book/_images/overflowUnsignedSubtraction_2x.png" alt="Art/overflowUnsignedSubtraction_2x.png"></p>
<p>溢出也会发生在有符号整型上。针对有符号整型的所有溢出加法或者减法运算都是按位运算的方式执行的，符号位也需要参与计算，正如 <a href="#bitwise_left_and_right_shift_operators">按位左移、右移运算符</a> 所描述的。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> signedOverflow <span class="operator">=</span> <span class="type">Int8</span>.min</span><br><span class="line"><span class="comment">// signedOverflow 等于 Int8 所能容纳的最小整数 -128</span></span><br><span class="line">signedOverflow <span class="operator">=</span> signedOverflow <span class="operator">&amp;-</span> <span class="number">1</span></span><br><span class="line"><span class="comment">// 此时 signedOverflow 等于 127</span></span><br></pre></td></tr></table></figure>
<p><code>Int8</code> 型整数能容纳的最小值是 <code>-128</code>，以二进制表示即 <code>10000000</code>。当使用溢出减法运算符对其进行减 <code>1</code> 运算时，符号位被翻转，得到二进制数值 <code>01111111</code>，也就是十进制数值的 <code>127</code>，这个值也是 <code>Int8</code> 型整所能容纳的最大值。</p>
<p><img src="https://docs.swift.org/swift-book/_images/overflowSignedSubtraction_2x.png" alt="Art/overflowSignedSubtraction_2x.png"></p>
<p>对于无符号与有符号整型数值来说，当出现上溢时，它们会从数值所能容纳的最大数变成最小数。同样地，当发生下溢时，它们会从所能容纳的最小数变成最大数。</p>
<h2 id="优先级和结合性">优先级和结合性</h2>
<p>运算符的<em>优先级</em>使得一些运算符优先于其他运算符；它们会先被执行。</p>
<p><em>结合性</em>定义了相同优先级的运算符是如何结合的，也就是说，是与左边结合为一组，还是与右边结合为一组。可以将其理解为“它们是与左边的表达式结合的”，或者“它们是与右边的表达式结合的”。</p>
<p>当考虑一个复合表达式的计算顺序时，运算符的优先级和结合性是非常重要的。举例来说，运算符优先级解释了为什么下面这个表达式的运算结果会是 <code>17</code>。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span> <span class="operator">+</span> <span class="number">3</span> <span class="operator">%</span> <span class="number">4</span> <span class="operator">*</span> <span class="number">5</span></span><br><span class="line"><span class="comment">// 结果是 17</span></span><br></pre></td></tr></table></figure>
<p>如果你直接从左到右进行运算，你可能认为运算的过程是这样的：</p>
<ul>
<li>2 + 3 = 5</li>
<li>5 % 4 = 1</li>
<li>1 * 5 = 5</li>
</ul>
<p>但是正确答案是 <code>17</code> 而不是 <code>5</code>。优先级高的运算符要先于优先级低的运算符进行计算。与 C 语言类似，在 Swift 中，乘法运算符（<code>*</code>）与取余运算符（<code>%</code>）的优先级高于加法运算符（<code>+</code>）。因此，它们的计算顺序要先于加法运算。</p>
<p>而乘法运算与取余运算的优先级<em>相同</em>。这时为了得到正确的运算顺序，还需要考虑结合性。乘法运算与取余运算都是左结合的。可以将这考虑成，从它们的左边开始为这两部分表达式都隐式地加上括号：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span> <span class="operator">+</span> ((<span class="number">3</span> <span class="operator">%</span> <span class="number">4</span>) <span class="operator">*</span> <span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<p><code>(3 % 4)</code> 等于 <code>3</code>，所以表达式相当于：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span> <span class="operator">+</span> (<span class="number">3</span> <span class="operator">*</span> <span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<p><code>3 * 5</code> 等于 <code>15</code>，所以表达式相当于：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span> <span class="operator">+</span> <span class="number">15</span></span><br></pre></td></tr></table></figure>
<p>因此计算结果为 <code>17</code>。</p>
<p>有关 Swift 标准库提供的操作符信息，包括操作符优先级组和结核性设置的完整列表，请参见 <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/swift/operator_declarations">操作符声明</a>。</p>
<blockquote>
<p>注意</p>
<p>相对 C 语言和 Objective-C 来说，Swift 的运算符优先级和结合性规则更加简洁和可预测。但是，这也意味着它们相较于 C 语言及其衍生语言并不是完全一致。在对现有的代码进行移植的时候，要注意确保运算符的行为仍然符合你的预期。</p>
</blockquote>
<h2 id="运算符函数">运算符函数</h2>
<p>类和结构体可以为现有的运算符提供自定义的实现。这通常被称为运算符<em>重载</em>。</p>
<p>下面的例子展示了如何让自定义的结构体支持加法运算符（<code>+</code>）。算术加法运算符是一个<em>二元运算符</em>，因为它是对两个值进行运算，同时它还可以称为<em>中缀</em>运算符，因为它出现在两个值中间。</p>
<p>例子中定义了一个名为 <code>Vector2D</code> 的结构体用来表示二维坐标向量 <code>(x, y)</code>，紧接着定义了一个可以将两个 <code>Vector2D</code> 结构体实例进行相加的<em>运算符函数</em>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Vector2D</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> x <span class="operator">=</span> <span class="number">0.0</span>, y <span class="operator">=</span> <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Vector2D</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">+</span> (<span class="params">left</span>: <span class="type">Vector2D</span>, <span class="params">right</span>: <span class="type">Vector2D</span>) -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Vector2D</span>(x: left.x <span class="operator">+</span> right.x, y: left.y <span class="operator">+</span> right.y)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该运算符函数被定义为 <code>Vector2D</code> 上的一个类方法，并且函数的名字与它要进行重载的 <code>+</code> 名字一致。因为加法运算并不是一个向量必需的功能，所以这个类方法被定义在 <code>Vector2D</code> 的一个扩展中，而不是 <code>Vector2D</code> 结构体声明内。而算术加法运算符是二元运算符，所以这个运算符函数接收两个类型为 <code>Vector2D</code> 的参数，同时有一个 <code>Vector2D</code> 类型的返回值。</p>
<p>在这个实现中，输入参数分别被命名为 <code>left</code> 和 <code>right</code>，代表在 <code>+</code> 运算符左边和右边的两个 <code>Vector2D</code> 实例。函数返回了一个新的 <code>Vector2D</code> 实例，这个实例的 <code>x</code> 和 <code>y</code> 分别等于作为参数的两个实例的 <code>x</code> 和 <code>y</code> 的值之和。</p>
<p>这个类方法可以在任意两个 <code>Vector2D</code> 实例中间作为中缀运算符来使用：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> vector <span class="operator">=</span> <span class="type">Vector2D</span>(x: <span class="number">3.0</span>, y: <span class="number">1.0</span>)</span><br><span class="line"><span class="keyword">let</span> anotherVector <span class="operator">=</span> <span class="type">Vector2D</span>(x: <span class="number">2.0</span>, y: <span class="number">4.0</span>)</span><br><span class="line"><span class="keyword">let</span> combinedVector <span class="operator">=</span> vector <span class="operator">+</span> anotherVector</span><br><span class="line"><span class="comment">// combinedVector 是一个新的 Vector2D 实例，值为 (5.0, 5.0)</span></span><br></pre></td></tr></table></figure>
<p>这个例子实现两个向量 <code>(3.0，1.0)</code> 和 <code>(2.0，4.0)</code> 的相加，并得到新的向量 <code>(5.0，5.0)</code>。这个过程如下图示：</p>
<p><img src="https://docs.swift.org/swift-book/_images/vectorAddition_2x.png" alt="Art/vectorAddition_2x.png"></p>
<h3 id="前缀和后缀运算符">前缀和后缀运算符</h3>
<p>上个例子演示了一个二元中缀运算符的自定义实现。类与结构体也能提供标准<em>一元运算符</em>的实现。一元运算符只运算一个值。当运算符出现在值之前时，它就是<em>前缀</em>的（例如 <code>-a</code>），而当它出现在值之后时，它就是<em>后缀</em>的（例如 <code>b!</code>）。</p>
<p>要实现前缀或者后缀运算符，需要在声明运算符函数的时候在 <code>func</code> 关键字之前指定 <code>prefix</code> 或者 <code>postfix</code> 修饰符：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">Vector2D</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">prefix</span> <span class="keyword">func</span> <span class="title function_">-</span> (<span class="params">vector</span>: <span class="type">Vector2D</span>) -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Vector2D</span>(x: <span class="operator">-</span>vector.x, y: <span class="operator">-</span>vector.y)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码为 <code>Vector2D</code> 类型实现了一元运算符（<code>-a</code>）。由于该运算符是前缀运算符，所以这个函数需要加上 <code>prefix</code> 修饰符。</p>
<p>对于简单数值，一元负号运算符可以对它们的正负性进行改变。对于 <code>Vector2D</code> 来说，该运算将其 <code>x</code> 和 <code>y</code> 属性的正负性都进行了改变：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> positive <span class="operator">=</span> <span class="type">Vector2D</span>(x: <span class="number">3.0</span>, y: <span class="number">4.0</span>)</span><br><span class="line"><span class="keyword">let</span> negative <span class="operator">=</span> <span class="operator">-</span>positive</span><br><span class="line"><span class="comment">// negative 是一个值为 (-3.0, -4.0) 的 Vector2D 实例</span></span><br><span class="line"><span class="keyword">let</span> alsoPositive <span class="operator">=</span> <span class="operator">-</span>negative</span><br><span class="line"><span class="comment">// alsoPositive 是一个值为 (3.0, 4.0) 的 Vector2D 实例</span></span><br></pre></td></tr></table></figure>
<h3 id="复合赋值运算符">复合赋值运算符</h3>
<p><em>复合赋值运算符</em>将赋值运算符（<code>=</code>）与其它运算符进行结合。例如，将加法与赋值结合成加法赋值运算符（<code>+=</code>）。在实现的时候，需要把运算符的左参数设置成 <code>inout</code> 类型，因为这个参数的值会在运算符函数内直接被修改。</p>
<p>在下面的例子中，对 <code>Vector2D</code> 实例实现了一个加法赋值运算符函数：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">Vector2D</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">+=</span> (<span class="params">left</span>: <span class="keyword">inout</span> <span class="type">Vector2D</span>, <span class="params">right</span>: <span class="type">Vector2D</span>) &#123;</span><br><span class="line">        left <span class="operator">=</span> left <span class="operator">+</span> right</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为加法运算在之前已经定义过了，所以在这里无需重新定义。在这里可以直接利用现有的加法运算符函数，用它来对左值和右值进行相加，并再次赋值给左值：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> original <span class="operator">=</span> <span class="type">Vector2D</span>(x: <span class="number">1.0</span>, y: <span class="number">2.0</span>)</span><br><span class="line"><span class="keyword">let</span> vectorToAdd <span class="operator">=</span> <span class="type">Vector2D</span>(x: <span class="number">3.0</span>, y: <span class="number">4.0</span>)</span><br><span class="line">original <span class="operator">+=</span> vectorToAdd</span><br><span class="line"><span class="comment">// original 的值现在为 (4.0, 6.0)</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意</p>
<p>不能对默认的赋值运算符（<code>=</code>）进行重载。只有复合赋值运算符可以被重载。同样地，也无法对三元条件运算符 （<code>a ? b : c</code>） 进行重载。</p>
</blockquote>
<h3 id="等价运算符">等价运算符</h3>
<p>通常情况下，自定义的类和结构体没有对<em>等价运算符</em>进行默认实现，等价运算符通常被称为<em>相等</em>运算符（<code>==</code>）与<em>不等</em>运算符（<code>!=</code>）。</p>
<p>为了使用等价运算符对自定义的类型进行判等运算，需要为“相等”运算符提供自定义实现，实现的方法与其它中缀运算符一样, 并且增加对标准库 <code>Equatable</code> 协议的遵循：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">Vector2D</span>: <span class="title class_ inherited__">Equatable</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">==</span> (<span class="params">left</span>: <span class="type">Vector2D</span>, <span class="params">right</span>: <span class="type">Vector2D</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (left.x <span class="operator">==</span> right.x) <span class="operator">&amp;&amp;</span> (left.y <span class="operator">==</span> right.y)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码实现了“相等”运算符（<code>==</code>）来判断两个 <code>Vector2D</code> 实例是否相等。对于 <code>Vector2D</code> 来说，“相等”意味着“两个实例的 <code>x</code> 和 <code>y</code> 都相等”，这也是代码中用来进行判等的逻辑。如果你已经实现了“相等”运算符，通常情况下你并不需要自己再去实现“不等”运算符（<code>!=</code>）。标准库对于“不等”运算符提供了默认的实现，它简单地将“相等”运算符的结果进行取反后返回。</p>
<p>现在我们可以使用这两个运算符来判断两个 <code>Vector2D</code> 实例是否相等：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> twoThree <span class="operator">=</span> <span class="type">Vector2D</span>(x: <span class="number">2.0</span>, y: <span class="number">3.0</span>)</span><br><span class="line"><span class="keyword">let</span> anotherTwoThree <span class="operator">=</span> <span class="type">Vector2D</span>(x: <span class="number">2.0</span>, y: <span class="number">3.0</span>)</span><br><span class="line"><span class="keyword">if</span> twoThree <span class="operator">==</span> anotherTwoThree &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;These two vectors are equivalent.&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 打印“These two vectors are equivalent.”</span></span><br></pre></td></tr></table></figure>
<p>多数简单情况下，您可以使用 Swift 为您提供的等价运算符默认实现。Swift 为以下数种自定义类型提供等价运算符的默认实现：</p>
<ul>
<li>只拥有存储属性，并且它们全都遵循 <code>Equatable</code> 协议的结构体</li>
<li>只拥有关联类型，并且它们全都遵循 <code>Equatable</code> 协议的枚举</li>
<li>没有关联类型的枚举</li>
</ul>
<p>在类型原始的声明中声明遵循 <code>Equatable</code> 来接收这些默认实现。</p>
<p>下面为三维位置向量 <code>(x, y, z)</code> 定义的 <code>Vector3D</code> 结构体，与 <code>Vector2D</code> 类似。由于 <code>x</code>，<code>y</code> 和 <code>z</code> 属性都是 <code>Equatable</code> 类型，<code>Vector3D</code> 获得了默认的等价运算符实现。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Vector3D</span>: <span class="title class_ inherited__">Equatable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> x <span class="operator">=</span> <span class="number">0.0</span>, y <span class="operator">=</span> <span class="number">0.0</span>, z <span class="operator">=</span> <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> twoThreeFour <span class="operator">=</span> <span class="type">Vector3D</span>(x: <span class="number">2.0</span>, y: <span class="number">3.0</span>, z: <span class="number">4.0</span>)</span><br><span class="line"><span class="keyword">let</span> anotherTwoThreeFour <span class="operator">=</span> <span class="type">Vector3D</span>(x: <span class="number">2.0</span>, y: <span class="number">3.0</span>, z: <span class="number">4.0</span>)</span><br><span class="line"><span class="keyword">if</span> twoThreeFour <span class="operator">==</span> anotherTwoThreeFour &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;These two vectors are also equivalent.&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 打印“These two vectors are also equivalent.”</span></span><br></pre></td></tr></table></figure>
<h2 id="自定义运算符">自定义运算符</h2>
<p>除了实现标准运算符，在 Swift 中还可以声明和实现<em>自定义运算符</em>。可以用来自定义运算符的字符列表请参考 <a target="_blank" rel="noopener" href="https://www.runoob.com/manual/gitbook/swift5/source/_book/chapter3/02_Lexical_Structure.html#operators">运算符</a>。</p>
<p>新的运算符要使用 <code>operator</code> 关键字在全局作用域内进行定义，同时还要指定 <code>prefix</code>、<code>infix</code> 或者 <code>postfix</code> 修饰符：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">prefix</span> <span class="keyword">operator</span> <span class="title">+++</span></span><br></pre></td></tr></table></figure>
<p>上面的代码定义了一个新的名为 <code>+++</code> 的前缀运算符。对于这个运算符，在 Swift 中并没有已知的意义，因此在针对 <code>Vector2D</code> 实例的特定上下文中，给予了它自定义的意义。对这个示例来讲，<code>+++</code> 被实现为“前缀双自增”运算符。它使用了前面定义的复合加法运算符来让矩阵与自身进行相加，从而让 <code>Vector2D</code> 实例的 <code>x</code> 属性和 <code>y</code> 属性值翻倍。你可以像下面这样通过对 <code>Vector2D</code> 添加一个 <code>+++</code> 类方法，来实现 <code>+++</code> 运算符：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">Vector2D</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">prefix</span> <span class="keyword">func</span> <span class="title function_">+++</span> (<span class="params">vector</span>: <span class="keyword">inout</span> <span class="type">Vector2D</span>) -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">        vector <span class="operator">+=</span> vector</span><br><span class="line">        <span class="keyword">return</span> vector</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> toBeDoubled <span class="operator">=</span> <span class="type">Vector2D</span>(x: <span class="number">1.0</span>, y: <span class="number">4.0</span>)</span><br><span class="line"><span class="keyword">let</span> afterDoubling <span class="operator">=</span> <span class="operator">+++</span>toBeDoubled</span><br><span class="line"><span class="comment">// toBeDoubled 现在的值为 (2.0, 8.0)</span></span><br><span class="line"><span class="comment">// afterDoubling 现在的值也为 (2.0, 8.0)</span></span><br></pre></td></tr></table></figure>
<h3 id="自定义中缀运算符的优先级">自定义中缀运算符的优先级</h3>
<p>每个自定义中缀运算符都属于某个优先级组。优先级组指定了这个运算符相对于其他中缀运算符的优先级和结合性。<a href="#precedence_and_associativity">优先级和结合性</a> 中详细阐述了这两个特性是如何对中缀运算符的运算产生影响的。</p>
<p>而没有明确放入某个优先级组的自定义中缀运算符将会被放到一个默认的优先级组内，其优先级高于三元运算符。</p>
<p>以下例子定义了一个新的自定义中缀运算符 <code>+-</code>，此运算符属于 <code>AdditionPrecedence</code> 优先组：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">infix</span> <span class="keyword">operator</span> <span class="title">+-</span>: <span class="type">AdditionPrecedence</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Vector2D</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">+-</span> (<span class="params">left</span>: <span class="type">Vector2D</span>, <span class="params">right</span>: <span class="type">Vector2D</span>) -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Vector2D</span>(x: left.x <span class="operator">+</span> right.x, y: left.y <span class="operator">-</span> right.y)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> firstVector <span class="operator">=</span> <span class="type">Vector2D</span>(x: <span class="number">1.0</span>, y: <span class="number">2.0</span>)</span><br><span class="line"><span class="keyword">let</span> secondVector <span class="operator">=</span> <span class="type">Vector2D</span>(x: <span class="number">3.0</span>, y: <span class="number">4.0</span>)</span><br><span class="line"><span class="keyword">let</span> plusMinusVector <span class="operator">=</span> firstVector <span class="operator">+-</span> secondVector</span><br><span class="line"><span class="comment">// plusMinusVector 是一个 Vector2D 实例，并且它的值为 (4.0, -2.0)</span></span><br></pre></td></tr></table></figure>
<p>这个运算符把两个向量的 <code>x</code> 值相加，同时从第一个向量的 <code>y</code> 中减去第二个向量的 <code>y</code> 。因为它本质上是属于“相加型”运算符，所以将它放置在 <code>+</code> 和 <code>-</code> 等默认中缀“相加型”运算符相同的优先级组中。关于 Swift 标准库提供的运算符，以及完整的运算符优先级组和结合性设置，请参考 <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/swift/operator_declarations">运算符声明</a>。而更多关于优先级组以及自定义操作符和优先级组的语法，请参考 <a target="_blank" rel="noopener" href="https://www.runoob.com/manual/gitbook/swift5/source/_book/chapter2/06_Declarations.md#operator_declaration">运算符声明</a>。</p>
<blockquote>
<p>注意</p>
<p>当定义前缀与后缀运算符的时候，我们并没有指定优先级。然而，如果对同一个值同时使用前缀与后缀运算符，则后缀运算符会先参与运算。</p>
</blockquote>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../../../2023/07/14/Swift/swift%E9%AB%98%E7%BA%A7%E8%BF%90%E7%AE%97%E7%AC%A6/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../../../2023/07/13/Swift/swift%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/"
                            aria-label=": swift访问控制"
                        >
                            swift访问控制
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2023-07-13T10:13:17+08:00">
	
		    2023 年 7 月 13 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../">编程语言</a>, <a class="category-link" href="../../swift/">swift</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="访问控制">访问控制</h2>
<p><em>访问控制</em>可以限定其它源文件或模块中的代码对你的代码的访问级别。这个特性可以让我们隐藏代码的一些实现细节，并且可以为其他人可以访问和使用的代码提供接口。</p>
<p>你可以明确地给单个类型（类、结构体、枚举）设置访问级别，也可以给这些类型的属性、方法、构造器、下标等设置访问级别。协议也可以被限定在一定的范围内使用，包括协议里的全局常量、变量和函数。</p>
<p>Swift 不仅提供了多种不同的访问级别，还为某些典型场景提供了默认的访问级别，这样就不需要我们在每段代码中都申明显式访问级别。其实，如果只是开发一个单一 target 的应用程序，我们完全可以不用显式声明代码的访问级别。</p>
<blockquote>
<p>注意</p>
<p>为了简单起见，对于代码中可以设置访问级别的特性（属性、基本类型、函数等），在下面的章节中我们会称之为“实体”。</p>
</blockquote>
<h2 id="模块和源文件">模块和源文件</h2>
<p>Swift 中的访问控制模型基于模块和源文件这两个概念。</p>
<p><em>模块</em>指的是独立的代码单元，框架或应用程序会作为一个独立的模块来构建和发布。在 Swift 中，一个模块可以使用 <code>import</code> 关键字导入另外一个模块。</p>
<p>在 Swift 中，Xcode 的每个 target（例如框架或应用程序）都被当作独立的模块处理。如果你是为了实现某个通用的功能，或者是为了封装一些常用方法而将代码打包成独立的框架，这个框架就是 Swift 中的一个模块。当它被导入到某个应用程序或者其他框架时，框架内容都将属于这个独立的模块。</p>
<p><em>源文件</em>就是 Swift 中的源代码文件，它通常属于一个模块，即一个应用程序或者框架。尽管我们一般会将不同的类型分别定义在不同的源文件中，但是同一个源文件也可以包含多个类型、函数之类的定义。</p>
<h2 id="访问级别">访问级别</h2>
<p>Swift 为代码中的实体提供了五种不同的<em>访问级别</em>。这些访问级别不仅与源文件中定义的实体相关，同时也与源文件所属的模块相关。</p>
<ul>
<li><em>Open</em> 和 <em>Public</em> 级别可以让实体被同一模块源文件中的所有实体访问，在模块外也可以通过导入该模块来访问源文件里的所有实体。通常情况下，你会使用 Open 或 Public 级别来指定框架的外部接口。Open 和 Public 的区别在后面会提到。</li>
<li><em>Internal</em> 级别让实体被同一模块源文件中的任何实体访问，但是不能被模块外的实体访问。通常情况下，如果某个接口只在应用程序或框架内部使用，就可以将其设置为 Internal 级别。</li>
<li><em>File-private</em> 限制实体只能在其定义的文件内部访问。如果功能的部分细节只需要在文件内使用时，可以使用 File-private 来将其隐藏。</li>
<li><em>Private</em> 限制实体只能在其定义的作用域，以及同一文件内的 extension 访问。如果功能的部分细节只需要在当前作用域内使用时，可以使用 Private 来将其隐藏。</li>
</ul>
<p>Open 为最高访问级别（限制最少），Private 为最低访问级别（限制最多）。</p>
<p>Open 只能作用于类和类的成员，它和 Public 的区别如下：</p>
<ul>
<li>Public 或者其它更严访问级别的类，只能在其定义的模块内部被继承。</li>
<li>Public 或者其它更严访问级别的类成员，只能在其定义的模块内部的子类中重写。</li>
<li>Open 的类，可以在其定义的模块中被继承，也可以在引用它的模块中被继承。</li>
<li>Open 的类成员，可以在其定义的模块中子类中重写，也可以在引用它的模块中的子类重写。</li>
</ul>
<p>把一个类标记为 <code>open</code>，明确的表示你已经充分考虑过外部模块使用此类作为父类的影响，并且设计好了你的类的代码了。</p>
<h3 id="访问级别基本原则">访问级别基本原则</h3>
<p>Swift 中的访问级别遵循一个基本原则：<em>实体不能定义在具有更低访问级别（更严格）的实体中</em>。</p>
<p>例如：</p>
<ul>
<li>一个 Public 的变量，其类型的访问级别不能是 Internal，File-private 或是 Private。因为无法保证变量的类型在使用变量的地方也具有访问权限。</li>
<li>函数的访问级别不能高于它的参数类型和返回类型的访问级别。因为这样就会出现函数可以在任何地方被访问，但是它的参数类型和返回类型却不可以的情况。</li>
</ul>
<p>关于此原则在各种情况下的具体表现，将在下文有所体现。</p>
<h3 id="默认访问级别">默认访问级别</h3>
<p>如果你没有为代码中的实体显式指定访问级别，那么它们默认为 <code>internal</code> 级别（有一些例外情况，稍后会进行说明）。因此，在大多数情况下，我们不需要显式指定实体的访问级别。</p>
<h3 id="单-target-应用程序的访问级别">单 target 应用程序的访问级别</h3>
<p>当你编写一个单目标应用程序时，应用的所有功能都是为该应用服务，而不需要提供给其他应用或者模块使用，所以我们不需要明确设置访问级别，使用默认的访问级别 Internal 即可。但是，你也可以使用 <code>fileprivate</code> 访问或 <code>private</code> 访问级别，用于隐藏一些功能的实现细节。</p>
<h3 id="框架的访问级别">框架的访问级别</h3>
<p>当你开发框架时，就需要把一些对外的接口定义为 Open 或 Public，以便使用者导入该框架后可以正常使用其功能。这些被你定义为对外的接口，就是这个框架的 API。</p>
<blockquote>
<p>注意</p>
<p>框架的内部实现仍然可以使用默认的访问级别 <code>internal</code>，当你需要对框架内部其它部分隐藏细节时可以使用 <code>private</code> 或 <code>fileprivate</code>。对于框架的对外 API 部分，你就需要将它们设置为 <code>open</code> 或 <code>public</code> 了。</p>
</blockquote>
<h3 id="单元测试-target-的访问级别">单元测试 target 的访问级别</h3>
<p>当你的应用程序包含单元测试 target 时，为了测试，测试模块需要访问应用程序模块中的代码。默认情况下只有 <code>open</code> 或 <code>public</code> 级别的实体才可以被其他模块访问。然而，如果在导入应用程序模块的语句前使用 <code>@testable</code> 特性，然后在允许测试的编译设置（<code>Build Options -&gt; Enable Testability</code>）下编译这个应用程序模块，单元测试目标就可以访问应用程序模块中所有内部级别的实体。</p>
<h2 id="访问控制语法">访问控制语法</h2>
<p>通过修饰符 <code>open</code>、<code>public</code>、<code>internal</code>、<code>fileprivate</code>、<code>private</code> 来声明实体的访问级别：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SomePublicClass</span> &#123;&#125;</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">SomeInternalClass</span> &#123;&#125;</span><br><span class="line"><span class="keyword">fileprivate</span> <span class="keyword">class</span> <span class="title class_">SomeFilePrivateClass</span> &#123;&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">SomePrivateClass</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> somePublicVariable <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">let</span> someInternalConstant <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">fileprivate</span> <span class="keyword">func</span> <span class="title function_">someFilePrivateFunction</span>() &#123;&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">somePrivateFunction</span>() &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>除非专门指定，否则实体默认的访问级别为 <code>internal</code>，可以查阅 <a href="#default_access_levels">默认访问级别</a> 这一节。这意味着在不使用修饰符显式声明访问级别的情况下，<code>SomeInternalClass</code> 和 <code>someInternalConstant</code> 仍然拥有隐式的 <code>internal</code>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SomeInternalClass</span> &#123;&#125;   <span class="comment">// 隐式 internal</span></span><br><span class="line"><span class="keyword">var</span> someInternalConstant <span class="operator">=</span> <span class="number">0</span> <span class="comment">// 隐式 internal</span></span><br></pre></td></tr></table></figure>
<h2 id="自定义类型">自定义类型</h2>
<p>如果想为一个自定义类型指定访问级别，在定义类型时进行指定即可。新类型只能在它的访问级别限制范围内使用。例如，你定义了一个 <code>fileprivate</code> 级别的类，那这个类就只能在定义它的源文件中使用，可以作为属性类型、函数参数类型或者返回类型，等等。</p>
<p>一个类型的访问级别也会影响到类型<em>成员</em>（属性、方法、构造器、下标）的默认访问级别。如果你将类型指定为 <code>private</code> 或者 <code>fileprivate</code> 级别，那么该类型的所有成员的默认访问级别也会变成 <code>private</code> 或者 <code>fileprivate</code> 级别。如果你将类型指定为 <code>internal</code> 或 <code>public</code>（或者不明确指定访问级别，而使用默认的 <code>internal</code> ），那么该类型的所有成员的默认访问级别将是 <code>internal</code>。</p>
<blockquote>
<p>重点</p>
<p>上面提到，一个 <code>public</code> 类型的所有成员的访问级别默认为 <code>internal</code> 级别，而不是 <code>public</code> 级别。如果你想将某个成员指定为 <code>public</code> 级别，那么你必须显式指定。这样做的好处是，在你定义公共接口的时候，可以明确地选择哪些接口是需要公开的，哪些是内部使用的，避免不小心将内部使用的接口公开。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SomePublicClass</span> &#123;                  <span class="comment">// 显式 public 类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> somePublicProperty <span class="operator">=</span> <span class="number">0</span>            <span class="comment">// 显式 public 类成员</span></span><br><span class="line">    <span class="keyword">var</span> someInternalProperty <span class="operator">=</span> <span class="number">0</span>                 <span class="comment">// 隐式 internal 类成员</span></span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">func</span> <span class="title function_">someFilePrivateMethod</span>() &#123;&#125;  <span class="comment">// 显式 fileprivate 类成员</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">somePrivateMethod</span>() &#123;&#125;          <span class="comment">// 显式 private 类成员</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SomeInternalClass</span> &#123;                       <span class="comment">// 隐式 internal 类</span></span><br><span class="line">    <span class="keyword">var</span> someInternalProperty <span class="operator">=</span> <span class="number">0</span>                 <span class="comment">// 隐式 internal 类成员</span></span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">func</span> <span class="title function_">someFilePrivateMethod</span>() &#123;&#125;  <span class="comment">// 显式 fileprivate 类成员</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">somePrivateMethod</span>() &#123;&#125;          <span class="comment">// 显式 private 类成员</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fileprivate</span> <span class="keyword">class</span> <span class="title class_">SomeFilePrivateClass</span> &#123;        <span class="comment">// 显式 fileprivate 类</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">someFilePrivateMethod</span>() &#123;&#125;              <span class="comment">// 隐式 fileprivate 类成员</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">somePrivateMethod</span>() &#123;&#125;          <span class="comment">// 显式 private 类成员</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">SomePrivateClass</span> &#123;                <span class="comment">// 显式 private 类</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">somePrivateMethod</span>() &#123;&#125;                  <span class="comment">// 隐式 private 类成员</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="元组类型">元组类型</h3>
<p>元组的访问级别将由元组中访问级别最严格的类型来决定。例如，如果你构建了一个包含两种不同类型的元组，其中一个类型为 <code>internal</code>，另一个类型为 <code>private</code>，那么这个元组的访问级别为 <code>private</code>。</p>
<blockquote>
<p>注意</p>
<p>元组不同于类、结构体、枚举、函数那样有单独的定义。元组的访问级别是在它被使用时自动推断出的，而无法明确指定。</p>
</blockquote>
<h3 id="函数类型">函数类型</h3>
<p>函数的访问级别根据访问级别最严格的参数类型或返回类型的访问级别来决定。但是，如果这种访问级别不符合函数定义所在环境的默认访问级别，那么就需要明确地指定该函数的访问级别。</p>
<p>下面的例子定义了一个名为 <code>someFunction()</code> 的全局函数，并且没有明确地指定其访问级别。也许你会认为该函数应该拥有默认的访问级别 <code>internal</code>，但事实并非如此。事实上，如果按下面这种写法，代码将无法通过编译：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">someFunction</span>() -&gt; (<span class="type">SomeInternalClass</span>, <span class="type">SomePrivateClass</span>) &#123;</span><br><span class="line">    <span class="comment">// 此处是函数实现部分</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到，这个函数的返回类型是一个元组，该元组中包含两个自定义的类（可查阅 <a href="#custom_types">自定义类型</a>）。其中一个类的访问级别是 <code>internal</code>，另一个的访问级别是 <code>private</code>，所以根据元组访问级别的原则，该元组的访问级别是 <code>private</code>（元组的访问级别与元组中访问级别最低的类型一致）。</p>
<p>因为该函数返回类型的访问级别是 <code>private</code>，所以你必须使用 <code>private</code> 修饰符，明确指定该函数的访问级别：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">someFunction</span>() -&gt; (<span class="type">SomeInternalClass</span>, <span class="type">SomePrivateClass</span>) &#123;</span><br><span class="line">    <span class="comment">// 此处是函数实现部分</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将该函数指定为 <code>public</code> 或 <code>internal</code>，或者使用默认的访问级别 <code>internal</code> 都是错误的，因为如果把该函数当做 <code>public</code> 或 <code>internal</code> 级别来使用的话，可能会无法访问 <code>private</code> 级别的返回值。</p>
<h3 id="枚举类型">枚举类型</h3>
<p>枚举成员的访问级别和该枚举类型相同，你不能为枚举成员单独指定不同的访问级别。</p>
<p>比如下面的例子，枚举 <code>CompassPoint</code> 被明确指定为 <code>public</code>，那么它的成员 <code>North</code>、<code>South</code>、<code>East</code>、<code>West</code> 的访问级别同样也是 <code>public</code>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">CompassPoint</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> north</span><br><span class="line">    <span class="keyword">case</span> south</span><br><span class="line">    <span class="keyword">case</span> east</span><br><span class="line">    <span class="keyword">case</span> west</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="原始值和关联值">原始值和关联值</h4>
<p>枚举定义中的任何原始值或关联值的类型的访问级别至少不能低于枚举类型的访问级别。例如，你不能在一个 <code>internal</code> 的枚举中定义 <code>private</code> 的原始值类型。</p>
<h3 id="嵌套类型">嵌套类型</h3>
<p>如果在 <code>private</code> 的类型中定义嵌套类型，那么该嵌套类型就自动拥有 <code>private</code> 访问级别。如果在 <code>public</code> 或者 <code>internal</code> 级别的类型中定义嵌套类型，那么该嵌套类型自动拥有 <code>internal</code> 访问级别。如果想让嵌套类型拥有 <code>public</code> 访问级别，那么需要明确指定该嵌套类型的访问级别。</p>
<h2 id="子类">子类</h2>
<p>子类的访问级别不得高于父类的访问级别。例如，父类的访问级别是 <code>internal</code>，子类的访问级别就不能是 <code>public</code>。</p>
<p>此外，你可以在符合当前访问级别的条件下重写任意类成员（方法、属性、构造器、下标等）。</p>
<p>可以通过重写为继承来的类成员提供更高的访问级别。下面的例子中，类 <code>A</code> 的访问级别是 <code>public</code>，它包含一个方法 <code>someMethod()</code>，访问级别为 <code>private</code>。类 <code>B</code> 继承自类 <code>A</code>，访问级别为 <code>internal</code>，但是在类 <code>B</code> 中重写了类 <code>A</code> 中访问级别为 <code>private</code> 的方法 <code>someMethod()</code>，并重新指定为 <code>internal</code> 级别。通过这种方式，我们就可以将某类中 <code>private</code> 级别的类成员重新指定为更高的访问级别，以便其他人使用：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">func</span> <span class="title function_">someMethod</span>() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">B</span>: <span class="title class_ inherited__">A</span> &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">internal</span> <span class="keyword">func</span> <span class="title function_">someMethod</span>() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们甚至可以在子类中，用子类成员去访问访问级别更低的父类成员，只要这一操作在相应访问级别的限制范围内（也就是说，在同一源文件中访问父类 <code>private</code> 级别的成员，在同一模块内访问父类 <code>internal</code> 级别的成员）：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">func</span> <span class="title function_">someMethod</span>() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">B</span>: <span class="title class_ inherited__">A</span> &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">internal</span> <span class="keyword">func</span> <span class="title function_">someMethod</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>.someMethod()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为父类 <code>A</code> 和子类 <code>B</code> 定义在同一个源文件中，所以在子类 <code>B</code> 可以在重写的 <code>someMethod()</code> 方法中调用 <code>super.someMethod()</code>。</p>
<h2 id="常量、变量、属性、下标">常量、变量、属性、下标</h2>
<p>常量、变量、属性不能拥有比它们的类型更高的访问级别。例如，你不能定义一个 <code>public</code> 级别的属性，但是它的类型却是 <code>private</code> 级别的。同样，下标也不能拥有比索引类型或返回类型更高的访问级别。</p>
<p>如果常量、变量、属性、下标的类型是 <code>private</code> 级别的，那么它们必须明确指定访问级别为 <code>private</code>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> privateInstance <span class="operator">=</span> <span class="type">SomePrivateClass</span>()</span><br></pre></td></tr></table></figure>
<h3 id="Getter-和-Setter">Getter 和 Setter</h3>
<p>常量、变量、属性、下标的 <code>Getters</code> 和 <code>Setters</code> 的访问级别和它们所属类型的访问级别相同。</p>
<p><code>Setter</code> 的访问级别可以低于对应的 <code>Getter</code> 的访问级别，这样就可以控制变量、属性或下标的读写权限。在 <code>var</code> 或 <code>subscript</code> 关键字之前，你可以通过 <code>fileprivate(set)</code>，<code>private(set)</code> 或 <code>internal(set)</code> 为它们的写入权限指定更低的访问级别。</p>
<blockquote>
<p>注意</p>
<p>这个规则同时适用于存储型属性和计算型属性。即使你不明确指定存储型属性的 <code>Getter</code> 和 <code>Setter</code>，Swift 也会隐式地为其创建 <code>Getter</code> 和 <code>Setter</code>，用于访问该属性的后备存储。使用 <code>fileprivate(set)</code>，<code>private(set)</code> 和 <code>internal(set)</code> 可以改变 <code>Setter</code> 的访问级别，这对计算型属性也同样适用。</p>
</blockquote>
<p>下面的例子中定义了一个名为 <code>TrackedString</code> 的结构体，它记录了 <code>value</code> 属性被修改的次数：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">TrackedString</span> &#123;</span><br><span class="line">    <span class="keyword">private(set)</span> <span class="keyword">var</span> numberOfEdits <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> value: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            numberOfEdits <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>TrackedString</code> 结构体定义了一个用于存储 <code>String</code> 值的属性 <code>value</code>，并将初始值设为 <code>&quot;&quot;</code>（一个空字符串）。该结构体还定义了另一个用于存储 <code>Int</code> 值的属性 <code>numberOfEdits</code>，它用于记录属性 <code>value</code> 被修改的次数。这个功能通过属性 <code>value</code> 的 <code>didSet</code> 观察器实现，每当给 <code>value</code> 赋新值时就会调用 <code>didSet</code> 方法，然后将 <code>numberOfEdits</code> 的值加一。</p>
<p>结构体 <code>TrackedString</code> 和它的属性 <code>value</code> 都没有显式地指定访问级别，所以它们都是用默认的访问级别 <code>internal</code>。但是该结构体的 <code>numberOfEdits</code> 属性使用了 <code>private(set)</code> 修饰符，这意味着 <code>numberOfEdits</code> 属性只能在结构体的定义中进行赋值。<code>numberOfEdits</code> 属性的 <code>Getter</code> 依然是默认的访问级别 <code>internal</code>，但是 <code>Setter</code> 的访问级别是 <code>private</code>，这表示该属性只能在内部修改，而在结构体的外部则表现为一个只读属性。</p>
<p>如果你实例化 <code>TrackedString</code> 结构体，并多次对 <code>value</code> 属性的值进行修改，你就会看到 <code>numberOfEdits</code> 的值会随着修改次数而变化：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stringToEdit <span class="operator">=</span> <span class="type">TrackedString</span>()</span><br><span class="line">stringToEdit.value <span class="operator">=</span> <span class="string">&quot;This string will be tracked.&quot;</span></span><br><span class="line">stringToEdit.value <span class="operator">+=</span> <span class="string">&quot; This edit will increment numberOfEdits.&quot;</span></span><br><span class="line">stringToEdit.value <span class="operator">+=</span> <span class="string">&quot; So will this one.&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The number of edits is <span class="subst">\(stringToEdit.numberOfEdits)</span>&quot;</span>)</span><br><span class="line"><span class="comment">// 打印“The number of edits is 3”</span></span><br></pre></td></tr></table></figure>
<p>虽然你可以在其他的源文件中实例化该结构体并且获取到 <code>numberOfEdits</code> 属性的值，但是你不能对其进行赋值。这一限制保护了该记录功能的实现细节，同时还提供了方便的访问方式。</p>
<p>你可以在必要时为 <code>Getter</code> 和 <code>Setter</code> 显式指定访问级别。下面的例子将 <code>TrackedString</code> 结构体明确指定为了 <code>public</code> 访问级别。结构体的成员（包括 <code>numberOfEdits</code> 属性）拥有默认的访问级别 <code>internal</code>。你可以结合 <code>public</code> 和 <code>private(set)</code> 修饰符把结构体中的 <code>numberOfEdits</code> 属性的 <code>Getter</code> 的访问级别设置为 <code>public</code>，而 <code>Setter</code> 的访问级别设置为 <code>private</code>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> <span class="title class_">TrackedString</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">private(set)</span> <span class="keyword">var</span> numberOfEdits <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> value: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            numberOfEdits <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="构造器">构造器</h2>
<p>自定义构造器的访问级别可以低于或等于其所属类型的访问级别。唯一的例外是 <a target="_blank" rel="noopener" href="https://www.runoob.com/manual/gitbook/swift5/source/_book/chapter2/14_Initialization.html#required_initializers">必要构造器</a>，它的访问级别必须和所属类型的访问级别相同。</p>
<p>如同函数或方法的参数，构造器参数的访问级别也不能低于构造器本身的访问级别。</p>
<h3 id="默认构造器">默认构造器</h3>
<p>如 <a target="_blank" rel="noopener" href="https://www.runoob.com/manual/gitbook/swift5/source/_book/chapter2/14_Initialization.html#default_initializers">默认构造器</a> 所述，Swift 会为结构体和类提供一个默认的无参数的构造器，只要它们为所有存储型属性设置了默认初始值，并且未提供自定义的构造器。</p>
<p>默认构造器的访问级别与所属类型的访问级别相同，除非类型的访问级别是 <code>public</code>。如果一个类型被指定为 <code>public</code> 级别，那么默认构造器的访问级别将为 <code>internal</code>。如果你希望一个 <code>public</code> 级别的类型也能在其他模块中使用这种无参数的默认构造器，你只能自己提供一个 <code>public</code> 访问级别的无参数构造器。</p>
<h3 id="结构体默认的成员逐一构造器">结构体默认的成员逐一构造器</h3>
<p>如果结构体中任意存储型属性的访问级别为 <code>private</code>，那么该结构体默认的成员逐一构造器的访问级别就是 <code>private</code>。否则，这种构造器的访问级别依然是 <code>internal</code>。</p>
<p>如同前面提到的默认构造器，如果你希望一个 <code>public</code> 级别的结构体也能在其他模块中使用其默认的成员逐一构造器，你依然只能自己提供一个 <code>public</code> 访问级别的成员逐一构造器。</p>
<h2 id="协议">协议</h2>
<p>如果想为一个协议类型明确地指定访问级别，在定义协议时指定即可。这将限制该协议只能在适当的访问级别范围内被遵循。</p>
<p>协议中的每一个要求都具有和该协议相同的访问级别。你不能将协议中的要求设置为其他访问级别。这样才能确保该协议的所有要求对于任意遵循者都将可用。</p>
<blockquote>
<p>注意</p>
<p>如果你定义了一个 <code>public</code> 访问级别的协议，那么该协议的所有实现也会是 <code>public</code> 访问级别。这一点不同于其他类型，例如，当类型是 <code>public</code> 访问级别时，其成员的访问级别却只是 <code>internal</code>。</p>
</blockquote>
<h3 id="协议继承">协议继承</h3>
<p>如果定义了一个继承自其他协议的新协议，那么新协议拥有的访问级别最高也只能和被继承协议的访问级别相同。例如，你不能将继承自 <code>internal</code> 协议的新协议定义为 <code>public</code> 协议。</p>
<h3 id="协议遵循">协议遵循</h3>
<p>一个类型可以遵循比它级别更低的协议。例如，你可以定义一个 <code>public</code> 级别类型，它能在别的模块中使用，但是如果它遵循一个 <code>internal</code> 协议，这个遵循的部分就只能在这个 <code>internal</code> 协议所在的模块中使用。</p>
<p>遵循协议时的上下文级别是类型和协议中级别最小的那个。如果一个类型是 <code>public</code> 级别，但它要遵循的协议是 <code>internal</code> 级别，那么这个类型对该协议的遵循上下文就是 <code>internal</code> 级别。</p>
<p>当你编写或扩展一个类型让它遵循一个协议时，你必须确保该类型对协议的每一个要求的实现，至少与遵循协议的上下文级别一致。例如，一个 <code>public</code> 类型遵循一个 <code>internal</code> 协议，这个类型对协议的所有实现至少都应是 <code>internal</code> 级别的。</p>
<blockquote>
<p>注意</p>
<p>Swift 和 Objective-C 一样，协议遵循是全局的，也就是说，在同一程序中，一个类型不可能用两种不同的方式实现同一个协议。</p>
</blockquote>
<h2 id="Extension">Extension</h2>
<p>Extension 可以在访问级别允许的情况下对类、结构体、枚举进行扩展。Extension 的成员具有和原始类型成员一致的访问级别。例如，你使用 extension 扩展了一个 <code>public</code> 或者 <code>internal</code> 类型，extension 中的成员就默认使用 <code>internal</code> 访问级别，和原始类型中的成员一致。如果你使用 extension 扩展了一个 <code>private</code> 类型，则 extension 的成员默认使用 <code>private</code> 访问级别。</p>
<p>或者，你可以明确指定 extension 的访问级别（例如，<code>private extension</code>），从而给该 extension 中的所有成员指定一个新的默认访问级别。这个新的默认访问级别仍然可以被单独指定的访问级别所覆盖。</p>
<p>如果你使用 extension 来遵循协议的话，就不能显式地声明 extension 的访问级别。extension 每个 protocol 要求的实现都默认使用 protocol 的访问级别。</p>
<h3 id="Extension-的私有成员">Extension 的私有成员</h3>
<p>扩展同一文件内的类，结构体或者枚举，extension 里的代码会表现得跟声明在原类型里的一模一样。也就是说你可以这样：</p>
<ul>
<li>在类型的声明里声明一个私有成员，在同一文件的 extension 里访问。</li>
<li>在 extension 里声明一个私有成员，在同一文件的另一个 extension 里访问。</li>
<li>在 extension 里声明一个私有成员，在同一文件的类型声明里访问。</li>
</ul>
<p>这意味着你可以像组织的代码去使用 extension，而且不受私有成员的影响。例如，给定下面这样一个简单的协议：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protocol</span> <span class="title class_">SomeProtocol</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">doSomething</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你可以使用 extension 来遵循协议，就像这样：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SomeStruct</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> privateVariable <span class="operator">=</span> <span class="number">12</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">SomeStruct</span>: <span class="title class_ inherited__">SomeProtocol</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">doSomething</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(privateVariable)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="泛型">泛型</h2>
<p>泛型类型或泛型函数的访问级别取决于泛型类型或泛型函数本身的访问级别，还需结合类型参数的类型约束的访问级别，根据这些访问级别中的最低访问级别来确定。</p>
<h2 id="类型别名">类型别名</h2>
<p>你定义的任何类型别名都会被当作不同的类型，以便于进行访问控制。类型别名的访问级别不可高于其表示的类型的访问级别。例如，<code>private</code> 级别的类型别名可以作为 <code>private</code>、<code>file-private</code>、<code>internal</code>、<code>public</code> 或者 <code>open</code> 类型的别名，但是 <code>public</code> 级别的类型别名只能作为 <code>public</code> 类型的别名，不能作为 <code>internal</code>、<code>file-private</code> 或 <code>private</code> 类型的别名。</p>
<blockquote>
<p>注意</p>
<p>这条规则也适用于为满足协议遵循而将类型别名用于关联类型的情况。</p>
</blockquote>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../../../2023/07/13/Swift/swift%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../../../2023/07/12/Swift/swift%E5%86%85%E5%AD%98%E5%AE%89%E5%85%A8/"
                            aria-label=": swift内存安全"
                        >
                            swift内存安全
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2023-07-12T10:13:17+08:00">
	
		    2023 年 7 月 12 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../">编程语言</a>, <a class="category-link" href="../../swift/">swift</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="内存安全">内存安全</h2>
<p>默认情况下，Swift 会阻止你代码里不安全的行为。例如，Swift 会保证变量在使用之前就完成初始化，在内存被回收之后就无法被访问，并且数组的索引会做越界检查。</p>
<p>Swift 也保证同时访问同一块内存时不会冲突，通过约束代码里对于存储地址的写操作，去获取那一块内存的访问独占权。因为 Swift 自动管理内存，所以大部分时候你完全不需要考虑内存访问的事情。然而，理解潜在的冲突也是很重要的，可以避免你写出访问冲突的代码。而如果你的代码确实存在冲突，那在编译时或者运行时就会得到错误。</p>
<h2 id="理解内存访问冲突">理解内存访问冲突</h2>
<p>内存的访问，会发生在你给变量赋值，或者传递参数给函数时。例如，下面的代码就包含了读和写的访问：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 向 one 所在的内存区域发起一次写操作</span></span><br><span class="line"><span class="keyword">var</span> one <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 向 one 所在的内存区域发起一次读操作</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;We&#x27;re number <span class="subst">\(one)</span>!&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>内存访问的冲突会发生在你的代码尝试同时访问同一个存储地址的时侯。同一个存储地址的多个访问同时发生会造成不可预计或不一致的行为。在 Swift 里，有很多修改值的行为都会持续好几行代码，在修改值的过程中进行访问是有可能发生的。</p>
<p>你可以思考一下预算表更新的过程，会看到同样的问题。更新预算表总共有两步：首先你把预算项的名字和费用加上，然后再更新总数来反映预算表的现况。在更新之前和之后，你都可以从预算表里读取任何信息并获得正确的答案，就像下面展示的那样。</p>
<p><img src="https://docs.swift.org/swift-book/_images/memory_shopping_2x.png" alt=""></p>
<p>而当你添加预算项进入表里的时候，它只是在一个临时的，错误的状态，因为总数还没有被更新。在添加数据的过程中读取总数就会读取到错误的信息。</p>
<p>这个例子也演示了你在修复内存访问冲突时会遇到的问题：有时修复的方式会有很多种，但哪一种是正确的就不总是那么明显了。在这个例子里，根据你是否需要更新后的总数，$5 和 $320 都可能是正确的值。在你修复访问冲突之前，你需要决定它的倾向。</p>
<blockquote>
<p>注意</p>
<p>如果你写过并发和多线程的代码，内存访问冲突也许是同样的问题。然而，这里访问冲突的讨论是在单线程的情境下讨论的，并没有使用并发或者多线程。</p>
<p>如果你曾经在单线程代码里有访问冲突，Swift 可以保证你在编译或者运行时会得到错误。对于多线程的代码，可以使用 <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/code_diagnostics/thread_sanitizer">Thread Sanitizer</a> 去帮助检测多线程的冲突。</p>
</blockquote>
<h3 id="内存访问性质">内存访问性质</h3>
<p>内存访问冲突时，要考虑内存访问上下文中的这三个性质：访问是读还是写，访问的时长，以及被访问的存储地址。特别是，冲突会发生在当你有两个访问符合下列的情况：</p>
<ul>
<li>至少有一个是写访问</li>
<li>它们访问的是同一个存储地址</li>
<li>它们的访问在时间线上部分重叠</li>
</ul>
<p>读和写访问的区别很明显：一个写访问会改变存储地址，而读操作不会。存储地址是指向正在访问的东西（例如一个变量，常量或者属性）的位置的值 。内存访问的时长要么是瞬时的，要么是长期的。</p>
<p>如果一个访问不可能在其访问期间被其它代码访问，那么就是一个瞬时访问。正常来说，两个瞬时访问是不可能同时发生的。大多数内存访问都是瞬时的。例如，下面列举的所有读和写访问都是瞬时的：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">oneMore</span>(<span class="params">than</span> <span class="params">number</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> number <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myNumber <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">myNumber <span class="operator">=</span> oneMore(than: myNumber)</span><br><span class="line"><span class="built_in">print</span>(myNumber)</span><br><span class="line"><span class="comment">// 打印“2”</span></span><br></pre></td></tr></table></figure>
<p>然而，有几种被称为长期访问的内存访问方式，会在别的代码执行时持续进行。瞬时访问和长期访问的区别在于别的代码有没有可能在访问期间同时访问，也就是在时间线上的重叠。一个长期访问可以被别的长期访问或瞬时访问重叠。</p>
<p>重叠的访问主要出现在使用 in-out 参数的函数和方法或者结构体的 mutating 方法里。Swift 代码里典型的长期访问会在后面进行讨论。</p>
<h2 id="In-Out-参数的访问冲突">In-Out 参数的访问冲突</h2>
<p>一个函数会对它所有的 in-out 参数进行长期写访问。in-out 参数的写访问会在所有非 in-out 参数处理完之后开始，直到函数执行完毕为止。如果有多个 in-out 参数，则写访问开始的顺序与参数的顺序一致。</p>
<p>长期访问的存在会造成一个结果，你不能在访问以 in-out 形式传入后的原变量，即使作用域原则和访问权限允许——任何访问原变量的行为都会造成冲突。例如：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stepSize <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">increment</span>(<span class="keyword">_</span> <span class="params">number</span>: <span class="keyword">inout</span> <span class="type">Int</span>) &#123;</span><br><span class="line">    number <span class="operator">+=</span> stepSize</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">increment(<span class="operator">&amp;</span>stepSize)</span><br><span class="line"><span class="comment">// 错误：stepSize 访问冲突</span></span><br></pre></td></tr></table></figure>
<p>在上面的代码里，<code>stepSize</code> 是一个全局变量，并且它可以在 <code>increment(_:)</code> 里正常访问。然而，对于 <code>stepSize</code> 的读访问与 <code>number</code> 的写访问重叠了。就像下面展示的那样，<code>number</code> 和 <code>stepSize</code> 都指向了同一个存储地址。同一块内存的读和写访问重叠了，就此产生了冲突。</p>
<p><img src="https://docs.swift.org/swift-book/_images/memory_increment_2x.png" alt=""></p>
<p>解决这个冲突的一种方式，是显示拷贝一份 <code>stepSize</code> ：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 显式拷贝</span></span><br><span class="line"><span class="keyword">var</span> copyOfStepSize <span class="operator">=</span> stepSize</span><br><span class="line">increment(<span class="operator">&amp;</span>copyOfStepSize)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新原来的值</span></span><br><span class="line">stepSize <span class="operator">=</span> copyOfStepSize</span><br><span class="line"><span class="comment">// stepSize 现在的值是 2</span></span><br></pre></td></tr></table></figure>
<p>当你在调用 <code>increment(_:)</code> 之前做一份拷贝，显然 <code>copyOfStepSize</code> 就会根据当前的 <code>stepSize</code> 增加。读访问在写操作之前就已经结束了，所以不会有冲突。</p>
<p>长期写访问的存在还会造成另一种结果，往同一个函数的多个 in-out 参数里传入同一个变量也会产生冲突，例如：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">balance</span>(<span class="keyword">_</span> <span class="params">x</span>: <span class="keyword">inout</span> <span class="type">Int</span>, <span class="keyword">_</span> <span class="params">y</span>: <span class="keyword">inout</span> <span class="type">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> sum <span class="operator">=</span> x <span class="operator">+</span> y</span><br><span class="line">    x <span class="operator">=</span> sum <span class="operator">/</span> <span class="number">2</span></span><br><span class="line">    y <span class="operator">=</span> sum <span class="operator">-</span> x</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> playerOneScore <span class="operator">=</span> <span class="number">42</span></span><br><span class="line"><span class="keyword">var</span> playerTwoScore <span class="operator">=</span> <span class="number">30</span></span><br><span class="line">balance(<span class="operator">&amp;</span>playerOneScore, <span class="operator">&amp;</span>playerTwoScore)  <span class="comment">// 正常</span></span><br><span class="line">balance(<span class="operator">&amp;</span>playerOneScore, <span class="operator">&amp;</span>playerOneScore)</span><br><span class="line"><span class="comment">// 错误：playerOneScore 访问冲突</span></span><br></pre></td></tr></table></figure>
<p>上面的 <code>balance(_:_:)</code> 函数会将传入的两个参数平均化。将 <code>playerOneScore</code> 和 <code>playerTwoScore</code> 作为参数传入不会产生错误 —— 有两个访问重叠了，但它们访问的是不同的内存位置。相反，将 <code>playerOneScore</code> 作为参数同时传入就会产生冲突，因为它会发起两个写访问，同时访问同一个的存储地址。</p>
<blockquote>
<p>注意</p>
<p>因为操作符也是函数，它们也会对 in-out 参数进行长期访问。例如，假设 <code>balance(_:_:)</code> 是一个名为 <code>&lt;^&gt;</code> 的操作符函数，那么 <code>playerOneScore &lt;^&gt; playerOneScore</code> 也会造成像 <code>balance(&amp;playerOneScore, &amp;playerOneScore)</code> 一样的冲突。</p>
</blockquote>
<h2 id="方法里-self-的访问冲突">方法里 self 的访问冲突</h2>
<p>一个结构体的 mutating 方法会在调用期间对 <code>self</code> 进行写访问。例如，想象一下这么一个游戏，每一个玩家都有血量，受攻击时血量会下降，并且有敌人的数量，使用特殊技能时会减少敌人数量。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Player</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> health: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> energy: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> maxHealth <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">restoreHealth</span>() &#123;</span><br><span class="line">        health <span class="operator">=</span> <span class="type">Player</span>.maxHealth</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的 <code>restoreHealth()</code> 方法里，一个对于 <code>self</code> 的写访问会从方法开始直到方法 return。在这种情况下，<code>restoreHealth()</code> 里的其它代码不可以对 <code>Player</code> 实例的属性发起重叠的访问。下面的 <code>shareHealth(with:)</code> 方法接受另一个 <code>Player</code> 的实例作为 in-out 参数，产生了访问重叠的可能性。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">Player</span> &#123;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">shareHealth</span>(<span class="params">with</span> <span class="params">teammate</span>: <span class="keyword">inout</span> <span class="type">Player</span>) &#123;</span><br><span class="line">        balance(<span class="operator">&amp;</span>teammate.health, <span class="operator">&amp;</span>health)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> oscar <span class="operator">=</span> <span class="type">Player</span>(name: <span class="string">&quot;Oscar&quot;</span>, health: <span class="number">10</span>, energy: <span class="number">10</span>)</span><br><span class="line"><span class="keyword">var</span> maria <span class="operator">=</span> <span class="type">Player</span>(name: <span class="string">&quot;Maria&quot;</span>, health: <span class="number">5</span>, energy: <span class="number">10</span>)</span><br><span class="line">oscar.shareHealth(with: <span class="operator">&amp;</span>maria)  <span class="comment">// 正常</span></span><br></pre></td></tr></table></figure>
<p>上面的例子里，调用 <code>shareHealth(with:)</code> 方法去把 <code>oscar</code> 玩家的血量分享给 <code>maria</code> 玩家并不会造成冲突。在方法调用期间会对 <code>oscar</code> 发起写访问，因为在 mutating 方法里 <code>self</code> 就是 <code>oscar</code>，同时对于 <code>maria</code> 也会发起写访问，因为 <code>maria</code> 作为 in-out 参数传入。过程如下，它们会访问内存的不同位置。即使两个写访问重叠了，它们也不会冲突。</p>
<p><img src="https://docs.swift.org/swift-book/_images/memory_share_health_maria_2x.png" alt=""></p>
<p>当然，如果你将 <code>oscar</code> 作为参数传入 <code>shareHealth(with:)</code> 里，就会产生冲突：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">oscar.shareHealth(with: <span class="operator">&amp;</span>oscar)</span><br><span class="line"><span class="comment">// 错误：oscar 访问冲突</span></span><br></pre></td></tr></table></figure>
<p>mutating 方法在调用期间需要对 <code>self</code> 发起写访问，而同时 in-out 参数也需要写访问。在方法里，<code>self</code> 和 <code>teammate</code> 都指向了同一个存储地址——就像下面展示的那样。对于同一块内存同时进行两个写访问，并且它们重叠了，就此产生了冲突。</p>
<p><img src="https://docs.swift.org/swift-book/_images/memory_share_health_oscar_2x.png" alt=""></p>
<h2 id="属性的访问冲突">属性的访问冲突</h2>
<p>如结构体，元组和枚举的类型都是由多个独立的值组成的，例如结构体的属性或元组的元素。因为它们都是值类型，修改值的任何一部分都是对于整个值的修改，意味着其中一个属性的读或写访问都需要访问整一个值。例如，元组元素的写访问重叠会产生冲突：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> playerInformation <span class="operator">=</span> (health: <span class="number">10</span>, energy: <span class="number">20</span>)</span><br><span class="line">balance(<span class="operator">&amp;</span>playerInformation.health, <span class="operator">&amp;</span>playerInformation.energy)</span><br><span class="line"><span class="comment">// 错误：playerInformation 的属性访问冲突</span></span><br></pre></td></tr></table></figure>
<p>上面的例子里，传入同一元组的元素对 <code>balance(_:_:)</code> 进行调用，产生了冲突，因为 <code>playerInformation</code> 的访问产生了写访问重叠。<code>playerInformation.health</code> 和 <code>playerInformation.energy</code> 都被作为 in-out 参数传入，意味着 <code>balance(_:_:)</code> 需要在函数调用期间对它们发起写访问。任何情况下，对于元组元素的写访问都需要对整个元组发起写访问。这意味着对于 <code>playerInfomation</code> 发起的两个写访问重叠了，造成冲突。</p>
<p>下面的代码展示了一样的错误，对于一个存储在全局变量里的结构体属性的写访问重叠了。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> holly <span class="operator">=</span> <span class="type">Player</span>(name: <span class="string">&quot;Holly&quot;</span>, health: <span class="number">10</span>, energy: <span class="number">10</span>)</span><br><span class="line">balance(<span class="operator">&amp;</span>holly.health, <span class="operator">&amp;</span>holly.energy)  <span class="comment">// 错误</span></span><br></pre></td></tr></table></figure>
<p>在实践中，大多数对于结构体属性的访问都会安全的重叠。例如，将上面例子里的变量 <code>holly</code> 改为本地变量而非全局变量，编译器就会可以保证这个重叠访问是安全的：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">someFunction</span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> oscar <span class="operator">=</span> <span class="type">Player</span>(name: <span class="string">&quot;Oscar&quot;</span>, health: <span class="number">10</span>, energy: <span class="number">10</span>)</span><br><span class="line">    balance(<span class="operator">&amp;</span>oscar.health, <span class="operator">&amp;</span>oscar.energy)  <span class="comment">// 正常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的例子里，<code>oscar</code> 的 <code>health</code> 和 <code>energy</code> 都作为 in-out 参数传入了 <code>balance(_:_:)</code> 里。编译器可以保证内存安全，因为两个存储属性任何情况下都不会相互影响。</p>
<p>限制结构体属性的重叠访问对于保证内存安全不是必要的。保证内存安全是必要的，但因为访问独占权的要求比内存安全还要更严格——意味着即使有些代码违反了访问独占权的原则，也是内存安全的，所以如果编译器可以保证这种非专属的访问是安全的，那 Swift 就会允许这种行为的代码运行。特别是当你遵循下面的原则时，它可以保证结构体属性的重叠访问是安全的：</p>
<ul>
<li>你访问的是实例的存储属性，而不是计算属性或类的属性</li>
<li>结构体是本地变量的值，而非全局变量</li>
<li>结构体要么没有被闭包捕获，要么只被非逃逸闭包捕获了</li>
</ul>
<p>如果编译器无法保证访问的安全性，它就不会允许那次访问。</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../../../2023/07/12/Swift/swift%E5%86%85%E5%AD%98%E5%AE%89%E5%85%A8/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../../../2023/07/11/Swift/swift%E8%87%AA%E5%8A%A8%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0/"
                            aria-label=": swift自动引用计数"
                        >
                            swift自动引用计数
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2023-07-11T10:13:17+08:00">
	
		    2023 年 7 月 11 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../">编程语言</a>, <a class="category-link" href="../../swift/">swift</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="自动引用计数">自动引用计数</h2>
<p>Swift 使用*自动引用计数（ARC）*机制来跟踪和管理你的应用程序的内存。通常情况下，Swift 内存管理机制会一直起作用，你无须自己来考虑内存的管理。ARC 会在类的实例不再被使用时，自动释放其占用的内存。</p>
<p>然而在少数情况下，为了能帮助你管理内存，ARC 需要更多的，代码之间关系的信息。本章描述了这些情况，并且为你示范怎样才能使 ARC 来管理你的应用程序的所有内存。在 Swift 使用 ARC 与在 Obejctive-C 中使用 ARC 非常类似，具体请参考 <a target="_blank" rel="noopener" href="https://developer.apple.com/library/content/releasenotes/ObjectiveC/RN-TransitioningToARC/Introduction/Introduction.html#//apple_ref/doc/uid/TP40011226">过渡到 ARC 的发布说明</a>。</p>
<blockquote>
<p>注意</p>
<p>引用计数仅仅应用于类的实例。结构体和枚举类型是值类型，不是引用类型，也不是通过引用的方式存储和传递。</p>
</blockquote>
<h2 id="自动引用计数的工作机制">自动引用计数的工作机制</h2>
<p>当你每次创建一个类的新的实例的时候，ARC 会分配一块内存来储存该实例信息。内存中会包含实例的类型信息，以及这个实例所有相关的存储型属性的值。</p>
<p>此外，当实例不再被使用时，ARC 释放实例所占用的内存，并让释放的内存能挪作他用。这确保了不再被使用的实例，不会一直占用内存空间。</p>
<p>然而，当 ARC 收回和释放了正在被使用中的实例，该实例的属性和方法将不能再被访问和调用。实际上，如果你试图访问这个实例，你的应用程序很可能会崩溃。</p>
<p>为了确保使用中的实例不会被销毁，ARC 会跟踪和计算每一个实例正在被多少属性，常量和变量所引用。哪怕实例的引用数为 1，ARC 都不会销毁这个实例。</p>
<p>为了使上述成为可能，无论你将实例赋值给属性、常量或变量，它们都会创建此实例的强引用。之所以称之为“强”引用，是因为它会将实例牢牢地保持住，只要强引用还在，实例是不允许被销毁的。</p>
<h2 id="自动引用计数实践">自动引用计数实践</h2>
<p>下面的例子展示了自动引用计数的工作机制。例子以一个简单的 <code>Person</code> 类开始，并定义了一个叫 <code>name</code> 的常量属性：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> is being initialized&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> is being deinitialized&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Person</code> 类有一个构造器，此构造器为实例的 <code>name</code> 属性赋值，并打印一条消息以表明初始化过程生效。<code>Person</code> 类也拥有一个析构器，这个析构器会在实例被销毁时打印一条消息。</p>
<p>接下来的代码片段定义了三个类型为 <code>Person?</code> 的变量，用来按照代码片段中的顺序，为新的 <code>Person</code> 实例建立多个引用。由于这些变量是被定义为可选类型（<code>Person?</code>，而不是 <code>Person</code>），它们的值会被自动初始化为 <code>nil</code>，目前还不会引用到 <code>Person</code> 类的实例。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reference1: <span class="type">Person</span>?</span><br><span class="line"><span class="keyword">var</span> reference2: <span class="type">Person</span>?</span><br><span class="line"><span class="keyword">var</span> reference3: <span class="type">Person</span>?</span><br></pre></td></tr></table></figure>
<p>现在你可以创建 <code>Person</code> 类的新实例，并且将它赋值给三个变量中的一个：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reference1 <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;John Appleseed&quot;</span>)</span><br><span class="line"><span class="comment">// 打印“John Appleseed is being initialized”</span></span><br></pre></td></tr></table></figure>
<p>应当注意到当你调用 <code>Person</code> 类的构造器的时候，<code>&quot;John Appleseed is being initialized&quot;</code> 会被打印出来。由此可以确定构造器被执行。</p>
<p>由于 <code>Person</code> 类的新实例被赋值给了 <code>reference1</code> 变量，所以 <code>reference1</code> 到 <code>Person</code> 类的新实例之间建立了一个强引用。正是因为这一个强引用，ARC 会保证 <code>Person</code> 实例被保持在内存中不被销毁。</p>
<p>如果你将同一个 <code>Person</code> 实例也赋值给其他两个变量，该实例又会多出两个强引用：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reference2 <span class="operator">=</span> reference1</span><br><span class="line">reference3 <span class="operator">=</span> reference1</span><br></pre></td></tr></table></figure>
<p>现在这一个 <code>Person</code> 实例已经有三个强引用了。</p>
<p>如果你通过给其中两个变量赋值 <code>nil</code> 的方式断开两个强引用（包括最先的那个强引用），只留下一个强引用，<code>Person</code> 实例不会被销毁：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reference1 <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">reference2 <span class="operator">=</span> <span class="literal">nil</span></span><br></pre></td></tr></table></figure>
<p>在你清楚地表明不再使用这个 <code>Person</code> 实例时，即第三个也就是最后一个强引用被断开时，ARC 会销毁它：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reference3 <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// 打印“John Appleseed is being deinitialized”</span></span><br></pre></td></tr></table></figure>
<h2 id="类实例之间的循环强引用">类实例之间的循环强引用</h2>
<p>在上面的例子中，ARC 会跟踪你所新创建的 <code>Person</code> 实例的引用数量，并且会在 <code>Person</code> 实例不再被需要时销毁它。</p>
<p>然而，我们可能会写出一个类实例的强引用数<em>永远不能</em>变成 <code>0</code> 的代码。如果两个类实例互相持有对方的强引用，因而每个实例都让对方一直存在，就是这种情况。这就是所谓的<em>循环强引用</em>。</p>
<p>你可以通过定义类之间的关系为弱引用或无主引用，以替代强引用，从而解决循环强引用的问题。具体的过程在 <a href="#resolving_strong_reference_cycles_between_class_instances">解决类实例之间的循环强引用</a> 中有描述。不管怎样，在你学习怎样解决循环强引用之前，很有必要了解一下它是怎样产生的。</p>
<p>下面展示了一个不经意产生循环强引用的例子。例子定义了两个类：<code>Person</code> 和 <code>Apartment</code>，用来建模公寓和它其中的居民：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123; <span class="keyword">self</span>.name <span class="operator">=</span> name &#125;</span><br><span class="line">    <span class="keyword">var</span> apartment: <span class="type">Apartment</span>?</span><br><span class="line">    <span class="keyword">deinit</span> &#123; <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> is being deinitialized&quot;</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Apartment</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> unit: <span class="type">String</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">unit</span>: <span class="type">String</span>) &#123; <span class="keyword">self</span>.unit <span class="operator">=</span> unit &#125;</span><br><span class="line">    <span class="keyword">var</span> tenant: <span class="type">Person</span>?</span><br><span class="line">    <span class="keyword">deinit</span> &#123; <span class="built_in">print</span>(<span class="string">&quot;Apartment <span class="subst">\(unit)</span> is being deinitialized&quot;</span>) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>每一个 <code>Person</code> 实例有一个类型为 <code>String</code>，名字为 <code>name</code> 的属性，并有一个可选的初始化为 <code>nil</code> 的 <code>apartment</code> 属性。<code>apartment</code> 属性是可选的，因为一个人并不总是拥有公寓。</p>
<p>类似的，每个 <code>Apartment</code> 实例有一个叫 <code>unit</code>，类型为 <code>String</code> 的属性，并有一个可选的初始化为 <code>nil</code> 的 <code>tenant</code> 属性。<code>tenant</code> 属性是可选的，因为一栋公寓并不总是有居民。</p>
<p>这两个类都定义了析构器，用以在类实例被析构的时候输出信息。这让你能够知晓 <code>Person</code> 和 <code>Apartment</code> 的实例是否像预期的那样被销毁。</p>
<p>接下来的代码片段定义了两个可选类型的变量 <code>john</code> 和 <code>unit4A</code>，并分别被设定为下面的 <code>Apartment</code> 和 <code>Person</code> 的实例。这两个变量都被初始化为 <code>nil</code>，这正是可选类型的优点：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> john: <span class="type">Person</span>?</span><br><span class="line"><span class="keyword">var</span> unit4A: <span class="type">Apartment</span>?</span><br></pre></td></tr></table></figure>
<p>现在你可以创建特定的 <code>Person</code> 和 <code>Apartment</code> 实例并将赋值给 <code>john</code> 和 <code>unit4A</code> 变量：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">john <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;John Appleseed&quot;</span>)</span><br><span class="line">unit4A <span class="operator">=</span> <span class="type">Apartment</span>(unit: <span class="string">&quot;4A&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>在两个实例被创建和赋值后，下图表现了强引用的关系。变量 <code>john</code> 现在有一个指向 <code>Person</code> 实例的强引用，而变量 <code>unit4A</code> 有一个指向 <code>Apartment</code> 实例的强引用：</p>
<p><img src="https://docs.swift.org/swift-book/_images/referenceCycle01_2x.png" alt=""></p>
<p>现在你能够将这两个实例关联在一起，这样人就能有公寓住了，而公寓也有了房客。注意感叹号是用来展开和访问可选变量 <code>john</code> 和 <code>unit4A</code> 中的实例，这样实例的属性才能被赋值：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">john<span class="operator">!</span>.apartment <span class="operator">=</span> unit4A</span><br><span class="line">unit4A<span class="operator">!</span>.tenant <span class="operator">=</span> john</span><br></pre></td></tr></table></figure>
<p>在将两个实例联系在一起之后，强引用的关系如图所示：</p>
<p><img src="https://docs.swift.org/swift-book/_images/referenceCycle02_2x.png" alt=""></p>
<p>不幸的是，这两个实例关联后会产生一个循环强引用。<code>Person</code> 实例现在有了一个指向 <code>Apartment</code> 实例的强引用，而 <code>Apartment</code> 实例也有了一个指向 <code>Person</code> 实例的强引用。因此，当你断开 <code>john</code> 和 <code>unit4A</code> 变量所持有的强引用时，引用计数并不会降为 <code>0</code>，实例也不会被 ARC 销毁：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">john <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">unit4A <span class="operator">=</span> <span class="literal">nil</span></span><br></pre></td></tr></table></figure>
<p>注意，当你把这两个变量设为 <code>nil</code> 时，没有任何一个析构器被调用。循环强引用会一直阻止 <code>Person</code> 和 <code>Apartment</code> 类实例的销毁，这就在你的应用程序中造成了内存泄漏。</p>
<p>在你将 <code>john</code> 和 <code>unit4A</code> 赋值为 <code>nil</code> 后，强引用关系如下图：</p>
<p><img src="https://docs.swift.org/swift-book/_images/referenceCycle03_2x.png" alt=""></p>
<p><code>Person</code> 和 <code>Apartment</code> 实例之间的强引用关系保留了下来并且不会被断开。</p>
<h2 id="解决实例之间的循环强引用">解决实例之间的循环强引用</h2>
<p>Swift 提供了两种办法用来解决你在使用类的属性时所遇到的循环强引用问题：弱引用（weak reference）和无主引用（unowned reference）。</p>
<p>弱引用和无主引用允许循环引用中的一个实例引用另一个实例而<em>不</em>保持强引用。这样实例能够互相引用而不产生循环强引用。</p>
<p>当其他的实例有更短的生命周期时，使用弱引用，也就是说，当其他实例析构在先时。在上面公寓的例子中，很显然一个公寓在它的生命周期内会在某个时间段没有它的主人，所以一个弱引用就加在公寓类里面，避免循环引用。相比之下，当其他实例有相同的或者更长生命周期时，请使用无主引用。</p>
<h3 id="弱引用">弱引用</h3>
<p><em>弱引用</em>不会对其引用的实例保持强引用，因而不会阻止 ARC 销毁被引用的实例。这个特性阻止了引用变为循环强引用。声明属性或者变量时，在前面加上 <code>weak</code> 关键字表明这是一个弱引用。</p>
<p>因为弱引用不会保持所引用的实例，即使引用存在，实例也有可能被销毁。因此，ARC 会在引用的实例被销毁后自动将其弱引用赋值为 <code>nil</code>。并且因为弱引用需要在运行时允许被赋值为 <code>nil</code>，所以它们会被定义为可选类型变量，而不是常量。</p>
<p>你可以像其他可选值一样，检查弱引用的值是否存在，你将永远不会访问已销毁的实例的引用。</p>
<blockquote>
<p>注意</p>
<p>当 ARC 设置弱引用为 <code>nil</code> 时，属性观察不会被触发。</p>
</blockquote>
<p>下面的例子跟上面 <code>Person</code> 和 <code>Apartment</code> 的例子一致，但是有一个重要的区别。这一次，<code>Apartment</code> 的 <code>tenant</code> 属性被声明为弱引用：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123; <span class="keyword">self</span>.name <span class="operator">=</span> name &#125;</span><br><span class="line">    <span class="keyword">var</span> apartment: <span class="type">Apartment</span>?</span><br><span class="line">    <span class="keyword">deinit</span> &#123; <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> is being deinitialized&quot;</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Apartment</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> unit: <span class="type">String</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">unit</span>: <span class="type">String</span>) &#123; <span class="keyword">self</span>.unit <span class="operator">=</span> unit &#125;</span><br><span class="line">    <span class="keyword">weak</span> <span class="keyword">var</span> tenant: <span class="type">Person</span>?</span><br><span class="line">    <span class="keyword">deinit</span> &#123; <span class="built_in">print</span>(<span class="string">&quot;Apartment <span class="subst">\(unit)</span> is being deinitialized&quot;</span>) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后跟之前一样，建立两个变量（<code>john</code> 和 <code>unit4A</code>）之间的强引用，并关联两个实例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> john: <span class="type">Person</span>?</span><br><span class="line"><span class="keyword">var</span> unit4A: <span class="type">Apartment</span>?</span><br><span class="line"></span><br><span class="line">john <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;John Appleseed&quot;</span>)</span><br><span class="line">unit4A <span class="operator">=</span> <span class="type">Apartment</span>(unit: <span class="string">&quot;4A&quot;</span>)</span><br><span class="line"></span><br><span class="line">john<span class="operator">!</span>.apartment <span class="operator">=</span> unit4A</span><br><span class="line">unit4A<span class="operator">!</span>.tenant <span class="operator">=</span> john</span><br></pre></td></tr></table></figure>
<p>现在，两个关联在一起的实例的引用关系如下图所示：</p>
<p><img src="https://docs.swift.org/swift-book/_images/weakReference01_2x.png" alt=""></p>
<p><code>Person</code> 实例依然保持对 <code>Apartment</code> 实例的强引用，但是 <code>Apartment</code> 实例只持有对 <code>Person</code> 实例的弱引用。这意味着当你通过把 <code>john</code> 变量赋值为 <code>nil</code> 而断开其所保持的强引用时，再也没有指向 <code>Person</code> 实例的强引用了：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">john <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// 打印“John Appleseed is being deinitialized”</span></span><br></pre></td></tr></table></figure>
<p>由于再也没有指向 <code>Person</code> 实例的强引用，该实例会被销毁，且 <code>tenant</code> 属性会被赋值为 <code>nil</code>：</p>
<p><img src="https://docs.swift.org/swift-book/_images/weakReference02_2x.png" alt=""></p>
<p>唯一剩下的指向 <code>Apartment</code> 实例的强引用来自于变量 <code>unit4A</code>。如果你断开这个强引用，再也没有指向 <code>Apartment</code> 实例的强引用了：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unit4A <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// 打印“Apartment 4A is being deinitialized”</span></span><br></pre></td></tr></table></figure>
<p>由于再也没有指向 <code>Person</code> 实例的强引用，该实例会被销毁：</p>
<p><img src="https://docs.swift.org/swift-book/_images/weakReference03_2x.png" alt=""></p>
<blockquote>
<p>注意</p>
<p>在使用垃圾收集的系统里，弱指针有时用来实现简单的缓冲机制，因为没有强引用的对象只会在内存压力触发垃圾收集时才被销毁。但是在 ARC 中，一旦值的最后一个强引用被移除，就会被立即销毁，这导致弱引用并不适合上面的用途。</p>
</blockquote>
<h3 id="无主引用">无主引用</h3>
<p>和弱引用类似，<em>无主引用</em>不会牢牢保持住引用的实例。和弱引用不同的是，无主引用在其他实例有相同或者更长的生命周期时使用。你可以在声明属性或者变量时，在前面加上关键字 <code>unowned</code> 表示这是一个无主引用。</p>
<p>无主引用通常都被期望拥有值。不过 ARC 无法在实例被销毁后将无主引用设为 <code>nil</code>，因为非可选类型的变量不允许被赋值为 <code>nil</code>。</p>
<blockquote>
<p>重点</p>
<p>使用无主引用，你<em>必须</em>确保引用始终指向一个未销毁的实例。</p>
<p>如果你试图在实例被销毁后，访问该实例的无主引用，会触发运行时错误。</p>
</blockquote>
<p>下面的例子定义了两个类，<code>Customer</code> 和 <code>CreditCard</code>，模拟了银行客户和客户的信用卡。这两个类中，每一个都将另外一个类的实例作为自身的属性。这种关系可能会造成循环强引用。</p>
<p><code>Customer</code> 和 <code>CreditCard</code> 之间的关系与前面弱引用例子中 <code>Apartment</code> 和 <code>Person</code> 的关系略微不同。在这个数据模型中，一个客户可能有或者没有信用卡，但是一张信用卡总是关联着一个客户。为了表示这种关系，<code>Customer</code> 类有一个可选类型的 <code>card</code> 属性，但是 <code>CreditCard</code> 类有一个非可选类型的 <code>customer</code> 属性。</p>
<p>此外，只能通过将一个 <code>number</code> 值和 <code>customer</code> 实例传递给 <code>CreditCard</code> 构造器的方式来创建 <code>CreditCard</code> 实例。这样可以确保当创建 <code>CreditCard</code> 实例时总是有一个 <code>customer</code> 实例与之关联。</p>
<p>由于信用卡总是关联着一个客户，因此将 <code>customer</code> 属性定义为无主引用，用以避免循环强引用：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Customer</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> card: <span class="type">CreditCard</span>?</span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">deinit</span> &#123; <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> is being deinitialized&quot;</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CreditCard</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> number: <span class="type">UInt64</span></span><br><span class="line">    <span class="keyword">unowned</span> <span class="keyword">let</span> customer: <span class="type">Customer</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">number</span>: <span class="type">UInt64</span>, <span class="params">customer</span>: <span class="type">Customer</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.number <span class="operator">=</span> number</span><br><span class="line">        <span class="keyword">self</span>.customer <span class="operator">=</span> customer</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">deinit</span> &#123; <span class="built_in">print</span>(<span class="string">&quot;Card #<span class="subst">\(number)</span> is being deinitialized&quot;</span>) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意</p>
<p><code>CreditCard</code> 类的 <code>number</code> 属性被定义为 <code>UInt64</code> 类型而不是 <code>Int</code> 类型，以确保 <code>number</code> 属性的存储量在 32 位和 64 位系统上都能足够容纳 16 位的卡号。</p>
</blockquote>
<p>下面的代码片段定义了一个叫 <code>john</code> 的可选类型 <code>Customer</code> 变量，用来保存某个特定客户的引用。由于是可选类型，所以变量被初始化为 <code>nil</code>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> john: <span class="type">Customer</span>?</span><br></pre></td></tr></table></figure>
<p>现在你可以创建 <code>Customer</code> 类的实例，用它初始化 <code>CreditCard</code> 实例，并将新创建的 <code>CreditCard</code> 实例赋值为客户的 <code>card</code> 属性：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">john <span class="operator">=</span> <span class="type">Customer</span>(name: <span class="string">&quot;John Appleseed&quot;</span>)</span><br><span class="line">john<span class="operator">!</span>.card <span class="operator">=</span> <span class="type">CreditCard</span>(number: <span class="number">1234_5678_9012_3456</span>, customer: john<span class="operator">!</span>)</span><br></pre></td></tr></table></figure>
<p>在你关联两个实例后，它们的引用关系如下图所示：</p>
<p><img src="https://docs.swift.org/swift-book/_images/unownedReference01_2x.png" alt=""></p>
<p><code>Customer</code> 实例持有对 <code>CreditCard</code> 实例的强引用，而 <code>CreditCard</code> 实例持有对 <code>Customer</code> 实例的无主引用。</p>
<p>由于 <code>customer</code> 的无主引用，当你断开 <code>john</code> 变量持有的强引用时，再也没有指向 <code>Customer</code> 实例的强引用了：</p>
<p><img src="https://docs.swift.org/swift-book/_images/unownedReference02_2x.png" alt=""></p>
<p>由于再也没有指向 <code>Customer</code> 实例的强引用，该实例被销毁了。其后，再也没有指向 <code>CreditCard</code> 实例的强引用，该实例也随之被销毁了：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">john <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// 打印“John Appleseed is being deinitialized”</span></span><br><span class="line"><span class="comment">// 打印“Card #1234567890123456 is being deinitialized”</span></span><br></pre></td></tr></table></figure>
<p>最后的代码展示了在 <code>john</code> 变量被设为 <code>nil</code> 后 <code>Customer</code> 实例和 <code>CreditCard</code> 实例的析构器都打印出了“销毁”的信息。</p>
<blockquote>
<p>注意</p>
<p>上面的例子展示了如何使用安全的无主引用。对于需要禁用运行时的安全检查的情况（例如，出于性能方面的原因），Swift 还提供了不安全的无主引用。与所有不安全的操作一样，你需要负责检查代码以确保其安全性。 你可以通过 <code>unowned(unsafe)</code> 来声明不安全无主引用。如果你试图在实例被销毁后，访问该实例的不安全无主引用，你的程序会尝试访问该实例之前所在的内存地址，这是一个不安全的操作。</p>
</blockquote>
<h3 id="无主引用和隐式解包可选值属性">无主引用和隐式解包可选值属性</h3>
<p>上面弱引用和无主引用的例子涵盖了两种常用的需要打破循环强引用的场景。</p>
<p><code>Person</code> 和 <code>Apartment</code> 的例子展示了两个属性的值都允许为 <code>nil</code>，并会潜在的产生循环强引用。这种场景最适合用弱引用来解决。</p>
<p><code>Customer</code> 和 <code>CreditCard</code> 的例子展示了一个属性的值允许为 <code>nil</code>，而另一个属性的值不允许为 <code>nil</code>，这也可能会产生循环强引用。这种场景最适合通过无主引用来解决。</p>
<p>然而，存在着第三种场景，在这种场景中，两个属性都必须有值，并且初始化完成后永远不会为 <code>nil</code>。在这种场景中，需要一个类使用无主属性，而另外一个类使用隐式解包可选值属性。</p>
<p>这使两个属性在初始化完成后能被直接访问（不需要可选展开），同时避免了循环引用。这一节将为你展示如何建立这种关系。</p>
<p>下面的例子定义了两个类，<code>Country</code> 和 <code>City</code>，每个类将另外一个类的实例保存为属性。在这个模型中，每个国家必须有首都，每个城市必须属于一个国家。为了实现这种关系，<code>Country</code> 类拥有一个 <code>capitalCity</code> 属性，而 <code>City</code> 类有一个 <code>country</code> 属性：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Country</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> capitalCity: <span class="type">City</span>!</span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>, <span class="params">capitalName</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">        <span class="keyword">self</span>.capitalCity <span class="operator">=</span> <span class="type">City</span>(name: capitalName, country: <span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">City</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">unowned</span> <span class="keyword">let</span> country: <span class="type">Country</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>, <span class="params">country</span>: <span class="type">Country</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">        <span class="keyword">self</span>.country <span class="operator">=</span> country</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了建立两个类的依赖关系，<code>City</code> 的构造器接受一个 <code>Country</code> 实例作为参数，并且将实例保存到 <code>country</code> 属性。</p>
<p><code>Country</code> 的构造器调用了 <code>City</code> 的构造器。然而，只有 <code>Country</code> 的实例完全初始化后，<code>Country</code> 的构造器才能把 <code>self</code> 传给 <code>City</code> 的构造器。在 <a target="_blank" rel="noopener" href="https://www.runoob.com/manual/gitbook/swift5/source/_book/chapter2/14_Initialization.html#two_phase_initialization">两段式构造过程</a> 中有具体描述。</p>
<p>为了满足这种需求，通过在类型结尾处加上感叹号（<code>City!</code>）的方式，将 <code>Country</code> 的 <code>capitalCity</code> 属性声明为隐式解包可选值类型的属性。这意味着像其他可选类型一样，<code>capitalCity</code> 属性的默认值为 <code>nil</code>，但是不需要展开它的值就能访问它。在 <a target="_blank" rel="noopener" href="https://www.runoob.com/manual/gitbook/swift5/source/_book/chapter2/01_The_Basics.html#implicityly_unwrapped_optionals">隐式解包可选值</a> 中有描述。</p>
<p>由于 <code>capitalCity</code> 默认值为 <code>nil</code>，一旦 <code>Country</code> 的实例在构造器中给 <code>name</code> 属性赋值后，整个初始化过程就完成了。这意味着一旦 <code>name</code> 属性被赋值后，<code>Country</code> 的构造器就能引用并传递隐式的 <code>self</code>。<code>Country</code> 的构造器在赋值 <code>capitalCity</code> 时，就能将 <code>self</code> 作为参数传递给 <code>City</code> 的构造器。</p>
<p>以上的意义在于你可以通过一条语句同时创建 <code>Country</code> 和 <code>City</code> 的实例，而不产生循环强引用，并且 <code>capitalCity</code> 的属性能被直接访问，而不需要通过感叹号来展开它的可选值：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> country <span class="operator">=</span> <span class="type">Country</span>(name: <span class="string">&quot;Canada&quot;</span>, capitalName: <span class="string">&quot;Ottawa&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(country.name)</span>&#x27;s capital city is called <span class="subst">\(country.capitalCity.name)</span>&quot;</span>)</span><br><span class="line"><span class="comment">// 打印“Canada&#x27;s capital city is called Ottawa”</span></span><br></pre></td></tr></table></figure>
<p>在上面的例子中，使用隐式解包可选值值意味着满足了类的构造器的两个构造阶段的要求。<code>capitalCity</code> 属性在初始化完成后，能像非可选值一样使用和存取，同时还避免了循环强引用。</p>
<h2 id="闭包的循环强引用">闭包的循环强引用</h2>
<p>前面我们看到了循环强引用是在两个类实例属性互相保持对方的强引用时产生的，还知道了如何用弱引用和无主引用来打破这些循环强引用。</p>
<p>循环强引用还会发生在当你将一个闭包赋值给类实例的某个属性，并且这个闭包体中又使用了这个类实例时。这个闭包体中可能访问了实例的某个属性，例如 <code>self.someProperty</code>，或者闭包中调用了实例的某个方法，例如 <code>self.someMethod()</code>。这两种情况都导致了闭包“捕获”<code>self</code>，从而产生了循环强引用。</p>
<p>循环强引用的产生，是因为闭包和类相似，都是引用类型。当你把一个闭包赋值给某个属性时，你是将这个闭包的引用赋值给了属性。实质上，这跟之前的问题是一样的——两个强引用让彼此一直有效。但是，和两个类实例不同，这次一个是类实例，另一个是闭包。</p>
<p>Swift 提供了一种优雅的方法来解决这个问题，称之为 <code>闭包捕获列表</code>（closure capture list）。同样的，在学习如何用闭包捕获列表打破循环强引用之前，先来了解一下这里的循环强引用是如何产生的，这对我们很有帮助。</p>
<p>下面的例子为你展示了当一个闭包引用了 <code>self</code> 后是如何产生一个循环强引用的。例子中定义了一个叫 <code>HTMLElement</code> 的类，用一种简单的模型表示 HTML 文档中的一个单独的元素：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HTMLElement</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> text: <span class="type">String</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">lazy</span> <span class="keyword">var</span> asHTML: () -&gt; <span class="type">String</span> <span class="operator">=</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> text <span class="operator">=</span> <span class="keyword">self</span>.text &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&lt;<span class="subst">\(<span class="keyword">self</span>.name)</span>&gt;<span class="subst">\(text)</span>&lt;/<span class="subst">\(<span class="keyword">self</span>.name)</span>&gt;&quot;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&lt;<span class="subst">\(<span class="keyword">self</span>.name)</span> /&gt;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>, <span class="params">text</span>: <span class="type">String</span>? <span class="operator">=</span> <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">        <span class="keyword">self</span>.text <span class="operator">=</span> text</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> is being deinitialized&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>HTMLElement</code> 类定义了一个 <code>name</code> 属性来表示这个元素的名称，例如代表头部元素的 <code>&quot;h1&quot;</code>，代表段落的 <code>&quot;p&quot;</code>，或者代表换行的 <code>&quot;br&quot;</code>。<code>HTMLElement</code> 还定义了一个可选属性 <code>text</code>，用来设置 HTML 元素呈现的文本。</p>
<p>除了上面的两个属性，<code>HTMLElement</code> 还定义了一个 <code>lazy</code> 属性 <code>asHTML</code>。这个属性引用了一个将 <code>name</code> 和 <code>text</code> 组合成 HTML 字符串片段的闭包。该属性是 <code>Void -&gt; String</code> 类型，或者可以理解为“一个没有参数，返回 <code>String</code> 的函数”。</p>
<p>默认情况下，闭包赋值给了 <code>asHTML</code> 属性，这个闭包返回一个代表 HTML 标签的字符串。如果 <code>text</code> 值存在，该标签就包含可选值 <code>text</code>；如果 <code>text</code> 不存在，该标签就不包含文本。对于段落元素，根据 <code>text</code> 是 <code>&quot;some text&quot;</code> 还是 <code>nil</code>，闭包会返回 <code>&quot;&lt;p&gt;some text&lt;/p&gt;&quot;</code> 或者 <code>&quot;&lt;p /&gt;&quot;</code>。</p>
<p>可以像实例方法那样去命名、使用 <code>asHTML</code> 属性。然而，由于 <code>asHTML</code> 是闭包而不是实例方法，如果你想改变特定 HTML 元素的处理方式的话，可以用自定义的闭包来取代默认值。</p>
<p>例如，可以将一个闭包赋值给 <code>asHTML</code> 属性，这个闭包能在 <code>text</code> 属性是 <code>nil</code> 时使用默认文本，这是为了避免返回一个空的 HTML 标签：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> heading <span class="operator">=</span> <span class="type">HTMLElement</span>(name: <span class="string">&quot;h1&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> defaultText <span class="operator">=</span> <span class="string">&quot;some default text&quot;</span></span><br><span class="line">heading.asHTML <span class="operator">=</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&lt;<span class="subst">\(heading.name)</span>&gt;<span class="subst">\(heading.text <span class="operator">??</span> defaultText)</span>&lt;/<span class="subst">\(heading.name)</span>&gt;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(heading.asHTML())</span><br><span class="line"><span class="comment">// 打印“&lt;h1&gt;some default text&lt;/h1&gt;”</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意</p>
<p><code>asHTML</code> 声明为 <code>lazy</code> 属性，因为只有当元素确实需要被处理为 HTML 输出的字符串时，才需要使用 <code>asHTML</code>。也就是说，在默认的闭包中可以使用 <code>self</code>，因为只有当初始化完成以及 <code>self</code> 确实存在后，才能访问 <code>lazy</code> 属性。</p>
</blockquote>
<p><code>HTMLElement</code> 类只提供了一个构造器，通过 <code>name</code> 和 <code>text</code>（如果有的话）参数来初始化一个新元素。该类也定义了一个析构器，当 <code>HTMLElement</code> 实例被销毁时，打印一条消息。</p>
<p>下面的代码展示了如何用 <code>HTMLElement</code> 类创建实例并打印消息：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> paragraph: <span class="type">HTMLElement</span>? <span class="operator">=</span> <span class="type">HTMLElement</span>(name: <span class="string">&quot;p&quot;</span>, text: <span class="string">&quot;hello, world&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(paragraph<span class="operator">!</span>.asHTML())</span><br><span class="line"><span class="comment">// 打印“&lt;p&gt;hello, world&lt;/p&gt;”</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意</p>
<p>上面的 <code>paragraph</code> 变量定义为可选类型的 <code>HTMLElement</code>，因此我们可以赋值 <code>nil</code> 给它来演示循环强引用。</p>
</blockquote>
<p>不幸的是，上面写的 <code>HTMLElement</code> 类产生了类实例和作为 <code>asHTML</code> 默认值的闭包之间的循环强引用。循环强引用如下图所示：</p>
<p><img src="https://docs.swift.org/swift-book/_images/closureReferenceCycle01_2x.png" alt=""></p>
<p>实例的 <code>asHTML</code> 属性持有闭包的强引用。但是，闭包在其闭包体内使用了 <code>self</code>（引用了 <code>self.name</code> 和 <code>self.text</code>），因此闭包捕获了 <code>self</code>，这意味着闭包又反过来持有了 <code>HTMLElement</code> 实例的强引用。这样两个对象就产生了循环强引用。（更多关于闭包捕获值的信息，请参考 <a target="_blank" rel="noopener" href="https://www.runoob.com/manual/gitbook/swift5/source/_book/chapter2/07_Closures.html#capturing_values">值捕获</a>）。</p>
<blockquote>
<p>注意</p>
<p>虽然闭包多次使用了 <code>self</code>，它只捕获 <code>HTMLElement</code> 实例的一个强引用。</p>
</blockquote>
<p>如果设置 <code>paragraph</code> 变量为 <code>nil</code>，打破它持有的 <code>HTMLElement</code> 实例的强引用，<code>HTMLElement</code> 实例和它的闭包都不会被销毁，也是因为循环强引用：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">paragraph <span class="operator">=</span> <span class="literal">nil</span></span><br></pre></td></tr></table></figure>
<p>注意，<code>HTMLElement</code> 的析构器中的消息并没有被打印，证明了 <code>HTMLElement</code> 实例并没有被销毁。</p>
<h2 id="解决闭包的循环强引用">解决闭包的循环强引用</h2>
<p>在定义闭包时同时定义捕获列表作为闭包的一部分，通过这种方式可以解决闭包和类实例之间的循环强引用。捕获列表定义了闭包体内捕获一个或者多个引用类型的规则。跟解决两个类实例间的循环强引用一样，声明每个捕获的引用为弱引用或无主引用，而不是强引用。应当根据代码关系来决定使用弱引用还是无主引用。</p>
<blockquote>
<p>注意</p>
<p>Swift 有如下要求：只要在闭包内使用 <code>self</code> 的成员，就要用 <code>self.someProperty</code> 或者 <code>self.someMethod()</code>（而不只是 <code>someProperty</code> 或 <code>someMethod()</code>）。这提醒你可能会一不小心就捕获了 <code>self</code>。</p>
</blockquote>
<h3 id="定义捕获列表">定义捕获列表</h3>
<p>捕获列表中的每一项都由一对元素组成，一个元素是 <code>weak</code> 或 <code>unowned</code> 关键字，另一个元素是类实例的引用（例如 <code>self</code>）或初始化过的变量（如 <code>delegate = self.delegate!</code>）。这些项在方括号中用逗号分开。</p>
<p>如果闭包有参数列表和返回类型，把捕获列表放在它们前面：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">lazy</span> <span class="keyword">var</span> someClosure: (<span class="type">Int</span>, <span class="type">String</span>) -&gt; <span class="type">String</span> <span class="operator">=</span> &#123;</span><br><span class="line">    [<span class="keyword">unowned</span> <span class="keyword">self</span>, <span class="keyword">weak</span> delegate <span class="operator">=</span> <span class="keyword">self</span>.delegate<span class="operator">!</span>] (index: <span class="type">Int</span>, stringToProcess: <span class="type">String</span>) -&gt; <span class="type">String</span> <span class="keyword">in</span></span><br><span class="line">    <span class="comment">// 这里是闭包的函数体</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果闭包没有指明参数列表或者返回类型，它们会通过上下文推断，那么可以把捕获列表和关键字 <code>in</code> 放在闭包最开始的地方：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">lazy</span> <span class="keyword">var</span> someClosure: () -&gt; <span class="type">String</span> <span class="operator">=</span> &#123;</span><br><span class="line">    [<span class="keyword">unowned</span> <span class="keyword">self</span>, <span class="keyword">weak</span> delegate <span class="operator">=</span> <span class="keyword">self</span>.delegate<span class="operator">!</span>] <span class="keyword">in</span></span><br><span class="line">    <span class="comment">// 这里是闭包的函数体</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="弱引用和无主引用">弱引用和无主引用</h3>
<p>在闭包和捕获的实例总是互相引用并且总是同时销毁时，将闭包内的捕获定义为 <code>无主引用</code>。</p>
<p>相反的，在被捕获的引用可能会变为 <code>nil</code> 时，将闭包内的捕获定义为 <code>弱引用</code>。弱引用总是可选类型，并且当引用的实例被销毁后，弱引用的值会自动置为 <code>nil</code>。这使我们可以在闭包体内检查它们是否存在。</p>
<blockquote>
<p>注意</p>
<p>如果被捕获的引用绝对不会变为 <code>nil</code>，应该用无主引用，而不是弱引用。</p>
</blockquote>
<p>前面的 <code>HTMLElement</code> 例子中，无主引用是正确的解决循环强引用的方法。这样编写 <code>HTMLElement</code> 类来避免循环强引用：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HTMLElement</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> text: <span class="type">String</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">lazy</span> <span class="keyword">var</span> asHTML: () -&gt; <span class="type">String</span> <span class="operator">=</span> &#123;</span><br><span class="line">        [<span class="keyword">unowned</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> text <span class="operator">=</span> <span class="keyword">self</span>.text &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&lt;<span class="subst">\(<span class="keyword">self</span>.name)</span>&gt;<span class="subst">\(text)</span>&lt;/<span class="subst">\(<span class="keyword">self</span>.name)</span>&gt;&quot;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&lt;<span class="subst">\(<span class="keyword">self</span>.name)</span> /&gt;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>, <span class="params">text</span>: <span class="type">String</span>? <span class="operator">=</span> <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">        <span class="keyword">self</span>.text <span class="operator">=</span> text</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> is being deinitialized&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的 <code>HTMLElement</code> 实现和之前的实现一致，除了在 <code>asHTML</code> 闭包中多了一个捕获列表。这里，捕获列表是 <code>[unowned self]</code>，表示“将 <code>self</code> 捕获为无主引用而不是强引用”。</p>
<p>和之前一样，我们可以创建并打印 <code>HTMLElement</code> 实例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> paragraph: <span class="type">HTMLElement</span>? <span class="operator">=</span> <span class="type">HTMLElement</span>(name: <span class="string">&quot;p&quot;</span>, text: <span class="string">&quot;hello, world&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(paragraph<span class="operator">!</span>.asHTML())</span><br><span class="line"><span class="comment">// 打印“&lt;p&gt;hello, world&lt;/p&gt;”</span></span><br></pre></td></tr></table></figure>
<p>使用捕获列表后引用关系如下图所示：</p>
<p><img src="https://docs.swift.org/swift-book/_images/closureReferenceCycle02_2x.png" alt=""></p>
<p>这一次，闭包以无主引用的形式捕获 <code>self</code>，并不会持有 <code>HTMLElement</code> 实例的强引用。如果将 <code>paragraph</code> 赋值为 <code>nil</code>，<code>HTMLElement</code> 实例将会被销毁，并能看到它的析构器打印出的消息：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">paragraph <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// 打印“p is being deinitialized”</span></span><br></pre></td></tr></table></figure>
<p>你可以查看 <a target="_blank" rel="noopener" href="https://www.runoob.com/manual/gitbook/swift5/source/_book/chapter3/04_Expressions.html">捕获列表</a> 章节，获取更多关于捕获列表的信息。</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../../../2023/07/11/Swift/swift%E8%87%AA%E5%8A%A8%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
          <li class="pagination-prev">
            <a
                class="btn btn--default btn--small"
                href="../../"
                aria-label="上一頁"
            >
              <i class="fa fa-angle-left text-base icon-mr"></i>
              <span>上一頁</span>
            </a>
          </li>
        
        
          <li class="pagination-next">
            <a
                class="btn btn--default btn--small"
                href="../3/"
                aria-label="下一頁"
            >
              <span>下一頁</span>
              <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
          </li>
        
        <li class="pagination-number">第 2 頁 共 11 頁</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Kein Chan. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="../../../../assets/images/profile.jpg" alt="作者的圖片"/>
        
            <h4 id="about-card-name">Kein Chan</h4>
        
            <div id="about-card-bio"><p>這是獨立全棧工程師Kein Chan的技術博客</br>分享一些技術教程,命令備忘(cheat-sheet)等</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>全棧工程師</br>資深技術顧問</br>數據科學家</br>Hit廣島觀光大使</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Tokyo/Macau
            </div>
        
    </div>
</div>

        
            <div id="algolia-search-modal" class="modal-container">
    <div class="modal">
        <div class="modal-header">
            <span class="close-button"><i class="fa fa-times"></i></span>
            <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
                <span class="searchby-algolia-text text-color-light text-small">by</span>
                <img class="searchby-algolia-logo" src="../assets/images/logo-algolia-nebula-blue-full.svg">
            </a>
            <i class="search-icon fa fa-search"></i>
            <form id="algolia-search-form">
                <input type="text" id="algolia-search-input" name="search"
                    class="form-control input--large search-input" placeholder="Search "
                    />
            </form>
        </div>
        <div class="modal-body">
            <div class="no-result text-color-light text-center">沒有找到文章</div>
            <div class="results">
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2013/04/27/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/"
                            aria-label=": R语言-环境安装"
                        >
                            <h3 class="media-heading">R语言-环境安装</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年4月27日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2013/04/28/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E5%9F%BA%E7%A1%80/"
                            aria-label=": R语言-基础"
                        >
                            <h3 class="media-heading">R语言-基础</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年4月28日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2013/05/01/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE/"
                            aria-label=": R语言-读取数据"
                        >
                            <h3 class="media-heading">R语言-读取数据</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月1日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2013/05/02/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E7%BB%98%E5%9B%BE/"
                            aria-label=": R语言-绘图"
                        >
                            <h3 class="media-heading">R语言-绘图</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月2日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2013/05/03/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/"
                            aria-label=": R语言-线性回归"
                        >
                            <h3 class="media-heading">R语言-线性回归</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月3日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2015/02/22/Algorithms/1.%E7%AE%97%E6%B3%95%E5%9C%A8%E8%AE%A1%E7%AE%97%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8/"
                            aria-label=": 1. 算法在计算中的作用"
                        >
                            <h3 class="media-heading">1. 算法在计算中的作用</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月22日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2015/02/23/Algorithms/2.%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80/"
                            aria-label=": 2. 算法基础"
                        >
                            <h3 class="media-heading">2. 算法基础</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月23日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2015/02/24/Algorithms/3.%E5%87%BD%E6%95%B0%E7%9A%84%E5%A2%9E%E9%95%BF/"
                            aria-label=": 3. 函数的增长"
                        >
                            <h3 class="media-heading">3. 函数的增长</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月24日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2015/02/25/Algorithms/4.%E5%88%86%E6%B2%BB%E7%AD%96%E7%95%A5/"
                            aria-label=": 4. 分治策略"
                        >
                            <h3 class="media-heading">4. 分治策略</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月25日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2015/02/26/Algorithms/5.%E6%A6%82%E7%8E%87%E5%88%86%E6%9E%90%E5%92%8C%E9%9A%8F%E6%9C%BA%E7%AE%97%E6%B3%95/"
                            aria-label=": 5. 概率分析和随机算法"
                        >
                            <h3 class="media-heading">5. 概率分析和随机算法</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月26日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <p class="results-count text-medium"
                data-message-zero="沒有找到文章"
                data-message-one="找到 1 篇文章"
                data-message-other="找到 {n} 篇文章">
                找到 235 篇文章
            </p>
        </div>
    </div>
</div>

        
        
<div id="cover" style="background-image:url('../../../../assets/images/cover.jpeg');"></div>
        <!--SCRIPTS-->

<script src="../../../../assets/js/script-qtzvvb63gamuirvfphht7lytrxkfllzng1escnm2phjtlt4tvvxi5gl0wx4o.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>


<!DOCTYPE html>
<html lang="zh-tw">
    
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css">

    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/min/moment.min.js"></script>
    
      <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/locale/zh-tw.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
    <script>
      window.algoliaConfig = {
        appId: 'AWFC86Q51O',
        apiKey: 'c9d952906eb1b154d75cf863e75c1ede',
        indexName: 'MyBlog'
      };
      var algoliaIndex = algoliasearch(
        algoliaConfig.appId,
        algoliaConfig.apiKey
      ).initIndex(algoliaConfig.indexName);
    </script>


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Kein&#39;s blog">
    <title>分類: 后端 - Kein&#39;s blog</title>
    <meta name="author" content="Kein Chan">
    
    
    
    <script type="application/ld+json">{}</script>
    <meta property="og:type" content="blog">
<meta property="og:title" content="Kein&#39;s blog">
<meta property="og:url" content="https://chankein.github.io/categories/%E5%90%8E%E7%AB%AF/index.html">
<meta property="og:site_name" content="Kein&#39;s blog">
<meta property="og:locale" content="zh_TW">
<meta property="article:author" content="Kein Chan">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="https://chankein.github.io../../assets/images/profile.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="../../assets/css/style-l9zwheso7r7pnk98nvirovsz9dl7fhkrc9mlb5vmuxw7tk5movrk0eevsrpr.min.css">

    <!--STYLES END-->
    

    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="../../index.html"
            aria-label=""
        >
            Kein&#39;s blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="打開鏈接: ../../#about"
            >
        
        
            <img class="header-picture" src="../../assets/images/profile.jpg" alt="作者的圖片"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="../../#about"
                    aria-label="閱讀有關作者的更多信息"
                >
                    <img class="sidebar-profile-picture" src="../../assets/images/profile.jpg" alt="作者的圖片"/>
                </a>
                <h4 class="sidebar-profile-name">Kein Chan</h4>
                
                    <h5 class="sidebar-profile-bio"><p>這是獨立全棧工程師Kein Chan的技術博客</br>分享一些技術教程,命令備忘(cheat-sheet)等</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../index.html"
                            
                            rel="noopener"
                            title="首頁"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首頁</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../all-categories"
                            
                            rel="noopener"
                            title="分類"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分類</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../all-tags"
                            
                            rel="noopener"
                            title="標籤"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">標籤</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../all-archives"
                            
                            rel="noopener"
                            title="所有文章"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">所有文章</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="搜尋"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">搜尋</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="關於"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">關於</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/chankein/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/profile/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../mailto:kein.chan85@gmail.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Email"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Email</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../atom.xml"
                            
                            rel="noopener"
                            title="Atom"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Atom</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../2025/05/15/cheat-sheet/Linux-cheat-sheet/"
                            aria-label=": Linux cheat sheet"
                        >
                            Linux cheat sheet
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2025-05-15T21:37:03+08:00">
	
		    2025 年 5 月 15 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="">后端</a>, <a class="category-link" href="linux/">linux</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h3 id="linux">linux:</h3>
<p><img src="/assets/images/Linux-Commands_Cheat-Sheet.png" alt="image"></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../2025/05/15/cheat-sheet/Linux-cheat-sheet/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../2022/11/05/Redis%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/"
                            aria-label=": Redis使用详解"
                        >
                            Redis使用详解
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-11-05T13:42:45+08:00">
	
		    2022 年 11 月 5 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="">后端</a>, <a class="category-link" href="Redis/">Redis</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="Redis使用详解">Redis使用详解</h2>
<h2 id="一、NoSQL简介">一、NoSQL简介</h2>
<h3 id="NoSQL分类">NoSQL分类</h3>
<ul>
<li>键值（Key-Value）存储数据库：这一类数据库主要会使用到一个hash表，如Redis、Oracle BDB</li>
<li>列存储数据库：通常是用来应对分布式存储的海量数据，键仍然存在但是他们指向了多个列，如HBase、Riak</li>
<li>文档型数据库：该类型的数据模型是版本化的文档，比如JSON,允许之间进行嵌套，如MongoDB</li>
</ul>
<h3 id="非关系型数据库特点">非关系型数据库特点</h3>
<ul>
<li>
<p>数据模型比较简单</p>
</li>
<li>
<p>对于数据库性能要求较高</p>
</li>
<li>
<p>不需要高度的数据一致性</p>
</li>
</ul>
<h2 id="二、Redis简介">二、Redis简介</h2>
<p>以key-value形式存储，不一定遵循传统数据库的一些基本要求（非关系的、分布式的、开源的、水平可扩展的）</p>
<p><strong>优点</strong>：对数据高并发读写</p>
<p>​ 对海量数据的高效率存储和访问</p>
<p>​ 对数据的可扩展性和高可用性</p>
<p><strong>缺点</strong>：无法做太复杂的关系模型</p>
<p><strong>Redis单线程</strong>：指处理我们的网络请求的时候只有一个线程来处理【文件刷盘等用的是多线程】</p>
<p><strong>Redis单线程的好处</strong>：</p>
<ul>
<li>
<p>Redis是基于内存的操作，CPU不是Redis的瓶颈，Redis的瓶颈最有可能是机器内存的大小或者网络带宽，单线程实现比较简单</p>
</li>
<li>
<p>单线程避免了不必要的上下文切换和竞争条件以及加锁释放锁操作</p>
</li>
<li>
<p>使用多路I/O复用模型，非阻塞IO</p>
</li>
</ul>
<h2 id="三、Redis的安装">三、Redis的安装</h2>
<p>第一步：准备工作【解压tar包，创建Redis相关目录】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf redis-5.0.2.tar.gz </span><br><span class="line">mkdir /opt/redis</span><br><span class="line">mkdir /opt/redis/conf</span><br><span class="line">mkdir /opt/redis/data</span><br></pre></td></tr></table></figure>
<p>第二步：编译redis</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#进入解压后的tar包执行</span><br><span class="line">make </span><br><span class="line">#执行结束之后进入src目录</span><br><span class="line">cd src</span><br><span class="line">make install PREFIX=/opt/redis</span><br></pre></td></tr></table></figure>
<p>第三步：移动配置文件到conf目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp redis.conf /opt/redis/conf</span><br></pre></td></tr></table></figure>
<p>额外配置：</p>
<ul>
<li>redis开机自启</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/rc.local</span><br><span class="line">#加入</span><br><span class="line">/opt/redis/bin/redis-server /opt/redis/conf/redis.conf</span><br></pre></td></tr></table></figure>
<ul>
<li>配置数据保存目录</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/redis/conf/redis.conf</span><br><span class="line">#修改</span><br><span class="line">dir ./    ---&gt;    dir /opt/redis/data/</span><br></pre></td></tr></table></figure>
<h2 id="四、Redis基本通用命令">四、Redis基本通用命令</h2>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>KEYS [pattern]</td>
<td>查找出匹配的key【生成环境禁止使用，数据量太大阻塞生成环境】</td>
</tr>
<tr>
<td>DBSIZE</td>
<td>统计key总数【使用的是redis的内部计数，并不是全部扫描，生产可用】</td>
</tr>
<tr>
<td>EXISTS key [key …]</td>
<td>检查key是否存在【存在返回1，不存在返回0】</td>
</tr>
<tr>
<td>DEL key [key…]</td>
<td>删除key【成功删除返回1，不存在此key返回0】</td>
</tr>
<tr>
<td>EXPIRE key seconds</td>
<td>设置过期时间</td>
</tr>
<tr>
<td>TTL key</td>
<td>查看剩余的过期时间【-2代表已不存在，-1代表永不过期】</td>
</tr>
<tr>
<td>PERSIST key</td>
<td>取消key的过期设置</td>
</tr>
<tr>
<td>TYPE key</td>
<td>查询key的类型</td>
</tr>
</tbody>
</table>
<h2 id="五、Redis数据类型及其使用">五、Redis数据类型及其使用</h2>
<blockquote>
<p>注意：redis操作下标都是闭区间的</p>
</blockquote>
<h3 id="字符串【String】">字符串【String】</h3>
<p>String的值类型可以为字符类型、数字类型、bit类型</p>
<p>String类型是包含很多中类型的特殊类型，并且是二进制安全的。比如序列化的对象进行存储，比如一张图片进行二进制存储，比如一个简单地字符串，数值等等。</p>
<p>使用场景：缓存、计数器、分布式锁等</p>
<table>
<thead>
<tr>
<th>常用命令格式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>{ <strong>GET</strong> key }，{ <strong>MGET</strong> key [key …] }</td>
<td>得到String</td>
</tr>
<tr>
<td>{ <strong>SET</strong> key value }，{ <strong>MSET</strong> key value [key value …] }</td>
<td>设置String</td>
</tr>
<tr>
<td>{ <strong>SETNX</strong> key value }，{ <strong>MSETNX</strong> key value [key value …] }</td>
<td>如果不存在则设置</td>
</tr>
<tr>
<td><strong>SET</strong> key value XX</td>
<td>如果存在则设置</td>
</tr>
<tr>
<td><strong>SETEX</strong> key second value</td>
<td>设置过期时间</td>
</tr>
<tr>
<td>{ <strong>INCR</strong> key }，{ <strong>INCRBY</strong> key increment }</td>
<td>自增操作</td>
</tr>
<tr>
<td>{ <strong>DECR</strong> key }，{ <strong>DECRBY</strong> key decrement }</td>
<td>自减操作</td>
</tr>
<tr>
<td><strong>GETSET</strong> key value</td>
<td>得到就值设置新值</td>
</tr>
<tr>
<td><strong>APPEND</strong> key value</td>
<td>追加字符串</td>
</tr>
<tr>
<td><strong>STRLEN</strong> key</td>
<td>得到字符串长度，内部存有计数</td>
</tr>
<tr>
<td><strong>GETRANGE</strong> key start end</td>
<td>得到指定长度的value</td>
</tr>
<tr>
<td><strong>SETRANGE</strong> key offset value</td>
<td>设置指定偏移量字符串内容</td>
</tr>
</tbody>
</table>
<h3 id="哈希【Hash】">哈希【Hash】</h3>
<p>使用场景：存储具有一定结构化的数据</p>
<table>
<thead>
<tr>
<th>常用命令格式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>HGET</strong> key field</td>
<td>得到key对应field的value</td>
</tr>
<tr>
<td><strong>HSET</strong> key field value</td>
<td>设置key对应field的value</td>
</tr>
<tr>
<td><strong>HDEL</strong> key field</td>
<td>删除key对应field的value</td>
</tr>
<tr>
<td><strong>HEXISTS</strong> key field</td>
<td>判断key的field是否存在</td>
</tr>
<tr>
<td><strong>HLEN</strong> key</td>
<td>获取指定key的filed数量【内部计数，生成环境可用】</td>
</tr>
<tr>
<td><strong>HMGET</strong> key field [field …]</td>
<td>批量获得hash的field对应的value</td>
</tr>
<tr>
<td><strong>HMSET</strong> key field value [field value …]</td>
<td>批量设置hash的field和value</td>
</tr>
<tr>
<td><strong>HINCRBY</strong> key field increment</td>
<td>增加指定increment的对应key的field</td>
</tr>
<tr>
<td><strong>HGETALL</strong> key</td>
<td>获取key对应所有field和value【生成环境慎用】</td>
</tr>
<tr>
<td><strong>HVALS</strong> key</td>
<td>返回key对应的所有value【生成环境慎用】</td>
</tr>
<tr>
<td><strong>HKEYS</strong> key</td>
<td>返回key对应的所有field【生成环境慎用】</td>
</tr>
<tr>
<td><strong>HSETNX</strong> key field value</td>
<td>不存在此key对应的field则设置</td>
</tr>
</tbody>
</table>
<h3 id="列表【List】">列表【List】</h3>
<p>列表为有序、可重复结构。可指定位置插入和删除、也可从左右插入和弹出（模拟栈结构）</p>
<table>
<thead>
<tr>
<th>常用命令格式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>**LPUSH</td>
<td>RPUSH** key value [value …]</td>
</tr>
<tr>
<td><strong>LINSERT</strong> key BEFORE</td>
<td>AFTER value newValue</td>
</tr>
<tr>
<td>**LPOP</td>
<td>RPOP** key</td>
</tr>
<tr>
<td><strong>LREM</strong> key count value</td>
<td>根据count值，从列表删除所有等于value的值【时间复杂度O(N)】</td>
</tr>
<tr>
<td>【count&gt;0，从左到右删除count个】</td>
<td></td>
</tr>
<tr>
<td>【count&lt;0，从右到坐删除count个】</td>
<td></td>
</tr>
<tr>
<td>【count=0，删除所有value相等的值】</td>
<td></td>
</tr>
<tr>
<td><strong>LTRIM</strong> key start end</td>
<td>按照索引范围保留list，删除大链表有用【时间复杂度O(N)】</td>
</tr>
<tr>
<td><strong>LRANGR</strong> key start end</td>
<td>获取列表指定索引范围内的值，数值为负则从右往左取值【时间复杂度O(N)】</td>
</tr>
<tr>
<td><strong>LINDEX</strong> key index</td>
<td>获取列表指定索引的值，数值为负则从右取值【时间复杂度O(N)】</td>
</tr>
<tr>
<td><strong>LLEN</strong> key</td>
<td>获取list长度【内部计数，生成环境可用】</td>
</tr>
<tr>
<td><strong>LSET</strong> key index newValue</td>
<td>设置指定位置的值【时间复杂度O(N)】</td>
</tr>
<tr>
<td>**BLPOP</td>
<td>RLPOP** key timeout</td>
</tr>
</tbody>
</table>
<p>使用技巧：</p>
<ul>
<li>LPUSH + LPOP = Stack</li>
<li>LPUSH + RPOP = Queue</li>
<li>LPUSH + LTRIM = Capped Collection【固定容量集合】</li>
<li>LPUSH + BRPOP = Block Queue</li>
</ul>
<h3 id="集合【Set】">集合【Set】</h3>
<p>Set无序、无重复、有集合间操作。</p>
<table>
<thead>
<tr>
<th>常用命令格式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>SADD</strong> key element [member …]</td>
<td>向集合key添加元素</td>
</tr>
<tr>
<td><strong>SREM</strong> key element</td>
<td>删除集合key中的element元素</td>
</tr>
<tr>
<td><strong>SCARD</strong> key</td>
<td>查询集合元素的个数【内部计数，生成环境可用】</td>
</tr>
<tr>
<td><strong>SISMEMBER</strong> key element</td>
<td>集合中是否存在element元素</td>
</tr>
<tr>
<td><strong>SRANDMEMBER</strong> key</td>
<td>随机得到一个元素</td>
</tr>
<tr>
<td><strong>SMEMBERS</strong> key</td>
<td>获取集合所有元素【慎用】</td>
</tr>
<tr>
<td><strong>SPOP</strong> key</td>
<td>随机弹出一个元素</td>
</tr>
<tr>
<td>{ <strong>SDIFF</strong> key [key …] }、{ <strong>SDIFFSTORE</strong> destination key [key …] }</td>
<td>返回/存储一个集合的全部成员，该集合是所有给定集合之间的差集</td>
</tr>
<tr>
<td>{ <strong>SINTER</strong> key [key …] }、{ <strong>SINTERSTORE</strong> destination key [key …] }</td>
<td>返回/存储一个集合的全部成员，该集合是所有给定集合的交集</td>
</tr>
<tr>
<td>{ <strong>SUNION</strong> key [key …] }、{ <strong>SUNIONSTORE</strong> destination key [key …] }</td>
<td>返回/存储一个集合的全部成员，该集合是所有给定集合的并集</td>
</tr>
</tbody>
</table>
<p>使用技巧</p>
<ul>
<li>
<p>SADD = Tagging</p>
</li>
<li>
<p>SPOP/SRANDMEMBER = Random Item</p>
</li>
<li>
<p>SADD + SINTER = Social Graph【共同关注、有着相同兴趣等】</p>
</li>
</ul>
<h3 id="有序集合【ZSet】">有序集合【ZSet】</h3>
<p>ZSet有序、无重复、包含分值与元素，有集合间操作。</p>
<p>使用场景：排行榜</p>
<table>
<thead>
<tr>
<th>常用命令格式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ZADD</strong> key score member [score member …]</td>
<td>向集合添加元素</td>
</tr>
<tr>
<td><strong>ZREM</strong> key member [member …]</td>
<td>移除集合中的元素</td>
</tr>
<tr>
<td><strong>ZSCORE</strong> key member</td>
<td>得到元素的分数</td>
</tr>
<tr>
<td><strong>ZINCRBY</strong> key increment member</td>
<td>增长元素的分数</td>
</tr>
<tr>
<td><strong>ZCARD</strong> key</td>
<td>获得集合中元素的个数</td>
</tr>
<tr>
<td><strong>ZRANK</strong> key member</td>
<td>成员按分值递减(从小到大)排列的排名</td>
</tr>
<tr>
<td><strong>ZRANGE</strong> key start stop [WITHSCORES]</td>
<td>按score值递增(从小到大)排序，WITHSCORES返回分数</td>
</tr>
<tr>
<td><strong>ZRANGEBYSCORE</strong> key max min [WITHSCORES]</td>
<td>返回分数范围内数据，按score值递增(从小到大)排序，WITHSCORES返回分数</td>
</tr>
<tr>
<td><strong>ZCOUNT</strong> key min max</td>
<td>统计得到分数在min和max之间的元素个数</td>
</tr>
<tr>
<td>{ <strong>ZREMRANGEBYRANK</strong> key start stop }、{ <strong>ZREMRANGEBYSCORE</strong> key min max}</td>
<td>按照排名/分数范围删除元素</td>
</tr>
<tr>
<td><strong>ZREVRANK</strong> key member</td>
<td>成员按分值递减(从大到小)排列的排名</td>
</tr>
<tr>
<td><strong>ZREVRANGE</strong> key start stop [WITHSCORES]</td>
<td>按score值递增(从大到小)排序，WITHSCORES返回分数</td>
</tr>
<tr>
<td><strong>ZREVRANGEBYSCORE</strong> key max min [WITHSCORES]</td>
<td>返回分数范围内数据，按score值递增(从大到小)排序，WITHSCORES返回分数</td>
</tr>
</tbody>
</table>
<h2 id="六、Redis高级功能">六、Redis高级功能</h2>
<h3 id="慢查询日志">慢查询日志</h3>
<p><img src="https://mynamelancelot.github.io/img/redis/Redis-Life-Cycle.png" alt="Redis-Life-Cycle"></p>
<ul>
<li>慢查询发生在第三阶段</li>
<li>客户端超时不一定是慢查询导致，但慢查询可导致客户端超时</li>
</ul>
<p><strong>慢查询队列简介</strong></p>
<ul>
<li>先进先出的队列</li>
<li>固定长度</li>
<li>长度不够时，丢弃最早记录</li>
<li>保存在内存中</li>
</ul>
<p><strong>慢查询设置</strong></p>
<ul>
<li>
<p>slow-max-len【慢查询队列长度，默认128】</p>
</li>
<li>
<p>slowlog-log-slower-than【慢查询的阙值（微秒，1000000 微秒=1 秒），默认10000（10毫秒），建议为1000（1毫秒）】</p>
</li>
</ul>
<blockquote>
<p>更改慢查询参数建议使用<code>CONFIG SET parameter value</code>方式，而不是更改redis.conf文件重启redis</p>
</blockquote>
<p><strong>慢查询命令</strong></p>
<table>
<thead>
<tr>
<th>常用命令格式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>slowlog get n</td>
<td>获取慢查询队列一条记录</td>
</tr>
<tr>
<td>slowlog len</td>
<td>获取慢查询队列长度</td>
</tr>
<tr>
<td>slowlog reset</td>
<td>清空慢查询队列</td>
</tr>
</tbody>
</table>
<p><strong>查询结果示例</strong></p>
<p><img src="https://mynamelancelot.github.io/img/redis/Redis-Slow-Examples.png" alt="Redis-Slow-Examples"></p>
<h3 id="Pipeline">Pipeline</h3>
<p><img src="https://mynamelancelot.github.io/img/redis/Redis-Process.png" alt="Redis-Process"></p>
<p>一般情况下客户端发送一条命令到Redis，Redis处理结束返回结果，即 N条命令 = N次网络时间 + N次计算时间</p>
<p>PipeLine将命令打包发送给客户端，Redis处理完返回结果，PipLine是一个异步处理方式，并不等待Redis返回。</p>
<p>Pipeline(N条命令) = 1次网络时间 + N次计算时间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * Jest执行参考</span><br><span class="line"> */</span><br><span class="line">long oldPipeline = Instant.now().toEpochMilli();</span><br><span class="line">for (int i = 0; i &lt; 100; i++) &#123;</span><br><span class="line">    Pipeline pipeline = jedis.pipelined();</span><br><span class="line">    for (int j = 0; j &lt; 100; j++) &#123;</span><br><span class="line">        pipeline.sadd(&quot;S&quot; + i * 100 + j, j + &quot;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    //pipeline.sync();异步不接受返回结果</span><br><span class="line">    pipeline.syncAndReturnAll(); //异步接受返回结果</span><br><span class="line">&#125;</span><br><span class="line">long nowPipeline = Instant.now().toEpochMilli();</span><br><span class="line">System.out.println(nowPipeline - oldPipeline);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">  * Spring Data Redis参考</span><br><span class="line">  */</span><br><span class="line">// 批量插入</span><br><span class="line">redisTemplate.executePipelined(new RedisCallback&lt;Void&gt;() &#123;</span><br><span class="line">  @Override</span><br><span class="line">  public Void doInRedis(RedisConnection connection) throws DataAccessException &#123;</span><br><span class="line">    String keyPrefix = &quot;pipeline-&quot;;</span><br><span class="line">    for (int i = 0; i &lt; 10000; i++) &#123;</span><br><span class="line">      String key = keyPrefix + i;</span><br><span class="line">      connection.set(key.getBytes(), String.valueOf(i).getBytes());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 批量获取</span><br><span class="line">List&lt;Object&gt; data = redisTemplate.executePipelined(new RedisCallback&lt;String&gt;() &#123;</span><br><span class="line">  @Override</span><br><span class="line">  public String doInRedis(RedisConnection connection) throws DataAccessException &#123;</span><br><span class="line">    String keyPrefix = &quot;pipeline-&quot;;</span><br><span class="line">    for (int i = 0; i &lt; 10000; i++) &#123;</span><br><span class="line">      String key = keyPrefix + i;</span><br><span class="line">      connection.get(key.getBytes());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">data.stream().forEach(System.out::println);</span><br></pre></td></tr></table></figure>
<h3 id="发布订阅">发布订阅</h3>
<table>
<thead>
<tr>
<th>常用命令格式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>PUBLISH</strong> channel message</td>
<td>将信息 <code>message</code> 发送到指定的频道 <code>channel</code></td>
</tr>
<tr>
<td><strong>SUBSCRIBE</strong> channel [channel …]</td>
<td>订阅给定的一个或多个频道的信息</td>
</tr>
<tr>
<td><strong>PSUBSCRIBE</strong> pattern [pattern …]</td>
<td>订阅一个或多个符合给定pattern的频道</td>
</tr>
<tr>
<td><strong>UNSUBSCRIBE</strong> [channel [channel …]]</td>
<td>取消订阅</td>
</tr>
</tbody>
</table>
<h3 id="Bitmap">Bitmap</h3>
<table>
<thead>
<tr>
<th>常用命令格式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>SETBIT</strong> key offset value</td>
<td>对 key所储存的字符串值，设置或清除指定偏移量上的位(bit)</td>
</tr>
<tr>
<td><strong>GETBIT</strong> key offset</td>
<td>对 key所储存的字符串值，获取指定偏移量上的位(bit)</td>
</tr>
<tr>
<td><strong>BITCOUNT</strong> key [start] [end]</td>
<td>计算给定字符串中，被设置为 1的比特位的数量</td>
</tr>
<tr>
<td><strong>BITOP</strong> operation destkey key [key …]</td>
<td>对一个或多个保存二进制位的字符串 key进行位元操作，并将结果保存到 destkey上</td>
</tr>
<tr>
<td><code>operation</code> 可以是 <code>AND</code> 、 <code>OR</code> 、 <code>NOT</code> 、 <code>XOR</code> 这四种操作中的任意一种</td>
<td></td>
</tr>
<tr>
<td><strong>BITPOS</strong> key bit [start] [end]</td>
<td>返回位图中第一个值为 <code>bit</code>的二进制位的位置</td>
</tr>
</tbody>
</table>
<h3 id="HyperLogLog">HyperLogLog</h3>
<p>实质：用String类型实现，不能取出具体值，有错误率</p>
<p>作用：极小的空间实现独立数量统计</p>
<table>
<thead>
<tr>
<th>常用命令格式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>PFADD</strong> key element [element …]</td>
<td>将任意数量的元素添加到指定的HyperLogLog</td>
</tr>
<tr>
<td><strong>PFCOUNT</strong> key [key …]</td>
<td>计算HyperLogLog有多少值</td>
</tr>
<tr>
<td><strong>PFMERGE</strong> destkey sourcekey [sourcekey …]</td>
<td>将多个HyperLogLog合并为一个HyperLogLog</td>
</tr>
</tbody>
</table>
<h3 id="Geo">Geo</h3>
<p>Geo(地理信息定位)：存储经纬度，计算两地距离，范围计算等</p>
<p>Geo是使用ZSet实现</p>
<table>
<thead>
<tr>
<th>常用命令格式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>GEOADD</strong> key longitude latitude member [longitude latitude member …]</td>
<td>longitude：经度，latitude：维度，member：标识</td>
</tr>
<tr>
<td><strong>GEOPOS</strong> key member [member …]</td>
<td>返回经纬度</td>
</tr>
<tr>
<td><strong>GEODIST</strong> key member1 member2 [unit]</td>
<td>返回两个给定位置之间的距离</td>
</tr>
<tr>
<td><strong>GEORADIUS</strong> key longitude latitude radius m</td>
<td>km</td>
</tr>
<tr>
<td><strong>ZREM</strong> key member</td>
<td>删除成员</td>
</tr>
</tbody>
</table>
<h2 id="七、Redis持久化">七、Redis持久化</h2>
<h3 id="RDB【Redis-Database】">RDB【Redis Database】</h3>
<p>​ RDB是Redis用来进行持久化的一种方式，是把当前内存中的数据集快照写入磁盘，也就是 Snapshot 快照（数据库中所有键值对数据）。恢复时是将快照文件直接读到内存里。</p>
<p><strong>触发机制</strong></p>
<ul>
<li>
<p>save</p>
<p>手动触发，同步命令，会阻塞线程</p>
</li>
<li>
<p>bgsave</p>
<p>手动触发，fork出一个子进程，异步命令，不会阻塞线程【阻塞仅仅会发生在fork出子进程的阶段】</p>
</li>
<li>
<p>自动</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">save 900 1            #900秒改变1个就生成rdb文件</span><br><span class="line">save 300 10           #300秒改变10个就生成rdb文件</span><br><span class="line">save 60  10000        #60秒改变10000个就生成rdb文件</span><br></pre></td></tr></table></figure>
<p>一般情况下建议关闭自动策略</p>
</li>
<li>
<p>全量复制</p>
<p>从节点执行全量复制操作的时候，主节点会自动触发bgsave命令生存rdb文件并发送给从节点</p>
</li>
<li>
<p>debug reload</p>
<p>在执行debug reload重新加载redis的时候，也会自动触发bgsave</p>
</li>
<li>
<p>shutdown</p>
<p>默认情况下执行shutdown命令，如果没有开启AOF持久化功能，就会自动执行bgsave</p>
</li>
</ul>
<p><strong>RDB配置参数</strong></p>
<table>
<thead>
<tr>
<th>命令格式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>rdbcompression</td>
<td>压缩RDB文件，默认yes</td>
</tr>
<tr>
<td>rdbchecksum</td>
<td>RDB文件是否进行校验，默认yes</td>
</tr>
<tr>
<td>dbfilename dump.rdb</td>
<td>RDB文件名【可使用dump-端口号.rdb区分不同的redis实例】</td>
</tr>
<tr>
<td>dir ./</td>
<td>RDB文件存储的目录</td>
</tr>
<tr>
<td>stop-writes-on-bgsave-error</td>
<td>bgsave出现错误时是否停止写入，默认yes</td>
</tr>
</tbody>
</table>
<h3 id="AOF【Append-Only-File】">AOF【Append-Only File】</h3>
<p>​ AOF是一个追加写入的日志文件从而实现持久化的方式，生成的AOF文件是可识别的纯文本文件。Redis默认使用RDB持久，开启AOF持久化需要设置<code>appendonly</code>为<code>yes</code></p>
<p><strong>AOF文件生成策略</strong></p>
<ul>
<li>
<p>always 不丢失数据，每次更新记录数据就进行io操作</p>
</li>
<li>
<p>everysec 可能会丢失1s数据，但io小</p>
</li>
<li>
<p>no 不启用AOF</p>
</li>
</ul>
<p><strong>AOF重写</strong></p>
<p>​ AOF支持AOF文件重写（从内存中读取的数据，并非读取上次的AOF文件进行重写）。AOF重写可以减少硬盘占用、加速恢复速度。</p>
<p><img src="https://mynamelancelot.github.io/img/redis/Aof-Rewrite.png" alt="Aof-Rewrite"></p>
<p><strong>AOF配置参数</strong></p>
<table>
<thead>
<tr>
<th>命令格式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>appendonly</td>
<td>是否开启AOF，默认no</td>
</tr>
<tr>
<td>appendfilename</td>
<td>生成AOF文件明【可使用appendonly-端口号.aof区分不同的redis实例】</td>
</tr>
<tr>
<td>appendfsync</td>
<td>刷盘策略，默认everysecond</td>
</tr>
<tr>
<td>dir</td>
<td>保存文件的目录，默认./</td>
</tr>
<tr>
<td>no-appendfsync-on-rewrite</td>
<td>AOF重写过程中是否禁止append操作，默认no允许append</td>
</tr>
<tr>
<td>auto-aof-rewrite-min-size</td>
<td>进行AOF时文件最小尺寸，默认64mb</td>
</tr>
<tr>
<td>auto-aof-rewrite-percentage</td>
<td>下次进行AOF操作时的增量，默认100</td>
</tr>
<tr>
<td>aof-load-truncated</td>
<td>AOF文件结尾不完整，Redis重启忽略不完整记录，默认yes</td>
</tr>
</tbody>
</table>
<p>命令</p>
<ul>
<li>bgrewriteaof 手动进行AOF重写操作</li>
<li>aof_current_size 查看AOF当前尺寸</li>
</ul>
<p><code>redis-cli info Persistence</code>可以查看统计信息<code>aof_current_size</code>【当前AOF文件大小】和<code>aof_base_size</code>【上次重写AOF文件大小】</p>
<h3 id="RDB与AOF比较">RDB与AOF比较</h3>
<table>
<thead>
<tr>
<th>命令</th>
<th>RDB</th>
<th>AOF</th>
</tr>
</thead>
<tbody>
<tr>
<td>启动优先级</td>
<td>低</td>
<td>高</td>
</tr>
<tr>
<td>体积</td>
<td>小</td>
<td>大</td>
</tr>
<tr>
<td>恢复</td>
<td>快</td>
<td>慢</td>
</tr>
<tr>
<td>数据安全性</td>
<td>丢数据</td>
<td>根据策略决定</td>
</tr>
<tr>
<td>轻重</td>
<td>重</td>
<td>轻</td>
</tr>
</tbody>
</table>
<h3 id="混合持久化">混合持久化</h3>
<p>Redis 4.0 开始支持 rdb 和 aof 的混合持久化(默认开启)，这样做的好处是可以结合 rdb 和 aof 的优点, 快速加载同时避免丢失过多的数据。缺点 aof 里面的 rdb 部分就是压缩格式不再是 aof 格式，可读性差。</p>
<ul>
<li>
<p>配置开启混合持久化<code>aof-use-rdb-preamble yes</code></p>
</li>
<li>
<p>命令开启混合持久化<code>config set aof-use-rdb-preamble yes</code></p>
</li>
</ul>
<p>开启混合持久化时，aof rewrite 的时候就直接把 rdb 的内容写到 aof 文件开头。aof 文件内容会变成如下</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+------------------------+</span><br><span class="line">|                        |   </span><br><span class="line">|                        |   </span><br><span class="line">|          RDB           |   </span><br><span class="line">|         FORMAT         |   </span><br><span class="line">|                        |   </span><br><span class="line">|                        |   </span><br><span class="line">|                        |   </span><br><span class="line">+------------------------+</span><br><span class="line">|                        |   </span><br><span class="line">|        AOF             |   </span><br><span class="line">|       FORMAT           |   </span><br><span class="line">+------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="持久化相关优化">持久化相关优化</h3>
<p><strong>fork操作优化</strong></p>
<ul>
<li>
<p>控制redis实例最大可用内存：maxmemory</p>
</li>
<li>
<p>合理配置Linux内存分配策略：vm.overcommit_momory=1(默认0，当内存少时fork阻塞不进行)</p>
</li>
<li>
<p>降低fork频率：例如放宽AOF重写自动触发时机，不必要的全量复制</p>
</li>
</ul>
<p><strong>子进程</strong></p>
<ul>
<li>
<p>cpu</p>
<p>开销：RDB和AOF文件生成，属于CPU密集型</p>
<p>优化：不做CPU绑定，不和CPU密集型服务部署</p>
</li>
<li>
<p>内存</p>
<p>开销：fork内存开销，使用了linux的copy-on-write【父进程未发生改变的内存页，不进行copy-write】</p>
<p>优化：echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled【不分配大内存页】</p>
</li>
<li>
<p>硬盘</p>
<p>开销：AOF和RDB文件写入，可以结合iostat，iotop分析</p>
<p>优化：不和高硬盘负载服务部署一起，<code>no-appendfsync-on-rewrite</code>设置为yes</p>
</li>
</ul>
<h2 id="八、Redis主从复制原理和优化">八、Redis主从复制原理和优化</h2>
<ul>
<li>一个master可以有多个slave</li>
<li>一个slave只能有一个master</li>
<li>数据流向是单向的，master到slave</li>
</ul>
<h3 id="主从实现两种方式">主从实现两种方式</h3>
<ul>
<li>
<p>在从机上执行<code>slaveof masterIp masterPort</code>，此命令是异步。<code>slaveof no one</code>结束从属关系。</p>
</li>
<li>
<p>修改redis配置文件</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">slaveof masterIp masterPort               #配置主从</span><br><span class="line">slave-read-only  yes                      #从节点只读</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>主从状态查看<code>info replication</code></p>
</blockquote>
<h3 id="全量复制和部分复制">全量复制和部分复制</h3>
<p>redis4后使用psync2实现复制使redis重启也可使用部分同步，还为解决在主库故障时候从库切换为主库时候使用部分同步机制。redis从库默认开启复制积压缓冲区功能，以便从库故障切换变化master后，其他落后该从库可以从缓冲区中获取缺少的命令。该过程的实现通过两组replid、offset替换原来的master runid和offset变量实现：</p>
<ul>
<li>
<p>第一组：master_replid和master_repl_offset</p>
<p>如果redis是主实例，则表示为自己的replid和复制偏移量； 如果redis是从实例，则表示为自己主实例的replid1和同步主实例的复制偏移量。</p>
</li>
<li>
<p>第二组：master_replid2和second_repl_offset</p>
<p>无论主从，都表示自己上次主实例repid1和复制偏移量；用于兄弟实例或级联复制，主库故障切换psync</p>
</li>
</ul>
<p>判断是否使用部分复制条件：如果从库提供的master_replid与master的replid不同，且与master的replid2不同，或同步速度快于master； 就必须进行全量复制，否则执行部分复制。</p>
<p>以下常见的主从切换都可以使用部分复制：</p>
<ul>
<li>一主一从发生切换，A-&gt;B 切换变成 B-&gt;A</li>
<li>一主多从发生切换，兄弟节点变成父子节点时</li>
<li>级别复制发生切换， A-&gt;B-&gt;C 切换变成 B-&gt;C-&gt;A</li>
</ul>
<h3 id="全量复制开销">全量复制开销</h3>
<ul>
<li>bgsave时间</li>
<li>RDB文件网络时间</li>
<li>从节点清空数据时间</li>
<li>从节点加载RDB时间</li>
<li>可能的AOF重写时间</li>
</ul>
<p>当从库与主库断开时间过长导致自己的偏移量不在<code>master_repl_offset</code>允许的范围之内，会触发全量复制</p>
<h3 id="主从相关参数配置">主从相关参数配置</h3>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">##############从库##############</span><br><span class="line"></span><br><span class="line">slaveof &lt;masterip&gt; &lt;masterport&gt; </span><br><span class="line">#设置该数据库为其他数据库的从数据库</span><br><span class="line"></span><br><span class="line">masterauth &lt;master-password&gt;</span><br><span class="line">#主从复制中，设置连接master服务器的密码（前提master启用了认证）</span><br><span class="line"></span><br><span class="line">slave-serve-stale-data yes</span><br><span class="line"># 当从库同主库失去连接或者复制正在进行，从库有两种运行方式：</span><br><span class="line"># 1) 如果slave-serve-stale-data设置为yes(默认设置)，从库会继续相应客户端的请求</span><br><span class="line"># 2) 如果slave-serve-stale-data设置为no，除了INFO和SLAVOF命令之外的任何请求都会返回一个错误&quot;SYNC with master in progress&quot;</span><br><span class="line"></span><br><span class="line">slave-priority 100</span><br><span class="line">#当主库发生宕机时候，哨兵会选择优先级最高的一个称为主库，从库优先级配置默认100，数值越小优先级越高</span><br><span class="line"></span><br><span class="line">slave-read-only yes</span><br><span class="line">#从节点是否只读；默认yes只读，为了保持数据一致性，应保持默认</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##############主库##############</span><br><span class="line"></span><br><span class="line">repl-disable-tcp-nodelay no</span><br><span class="line">#在slave和master同步后（发送psync/sync），后续的同步是否设置成TCP_NODELAY假如设置成yes，则redis会合并小的TCP包从而节省带宽，但会增加同步延迟（40ms），造成master与slave数据不一致假如设置成no，则redis master会立即发送同步数据，没有延迟</span><br><span class="line">#前者关注性能，后者关注一致性</span><br><span class="line"></span><br><span class="line">repl-ping-slave-period 10</span><br><span class="line">#从库会按照一个时间间隔向主库发送PING命令来判断主服务器是否在线，默认是10秒</span><br><span class="line"></span><br><span class="line">repl-backlog-size 1mb</span><br><span class="line">#复制积压缓冲区大小设置</span><br><span class="line"></span><br><span class="line">repl-backlog-ttl 3600</span><br><span class="line">#master没有slave一段时间会释放复制缓冲区的内存，repl-backlog-ttl用来设置该时间长度。单位为秒。</span><br><span class="line"></span><br><span class="line">min-slaves-to-write 3</span><br><span class="line">min-slaves-max-lag 10</span><br><span class="line">#设置某个时间断内，如果从库数量小于该某个值则不允许主机进行写操作，以上参数表示10秒内如果主库的从节点小于3个，则主库不接受写请求，min-slaves-to-write 0代表关闭此功能。</span><br></pre></td></tr></table></figure>
<p><strong>主从配置问题</strong></p>
<p>maxmomory不一致导致丢失数据</p>
<p>数据结构参数优化只有优化了主机，从机未配置导致内存不一致，数据错误或丢失</p>
<h2 id="九、Redis-Sentinel">九、Redis Sentinel</h2>
<ul>
<li>主观下线：Sentinel根据配置条件，发现redis节点达到故障标准，则此Sentinel认为此redis节点下线</li>
<li>客观下线：当Sentinel中认为此redis客观下线的总数达到配置阙值，则认为此节点客观下线</li>
</ul>
<h3 id="安装Sentinel">安装Sentinel</h3>
<p>配置sentinel.conf文件</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#没有开启bind和密码的情况下，保护模式默认被开启。只接受来自环回IPv4和IPv6地址的连接。拒绝外部连接</span><br><span class="line">bind 127.0.0.1 192.168.1.1</span><br><span class="line">protected-mode no</span><br><span class="line"></span><br><span class="line">#端口</span><br><span class="line">port 26379</span><br><span class="line"></span><br><span class="line">#是否守护进程模式运行</span><br><span class="line">daemonize no</span><br><span class="line"></span><br><span class="line">#pid以及日志文件位置</span><br><span class="line">pidfile /var/run/redis-sentinel.pid</span><br><span class="line">logfile &quot;&quot;</span><br><span class="line"></span><br><span class="line">#工作目录</span><br><span class="line">dir /tmp</span><br><span class="line"></span><br><span class="line">#监控的master</span><br><span class="line">#mymaster指此主从组的名称【Sentinel可以监控多个主从组】</span><br><span class="line">#最后一个数字代码多少个sentinel主观认为此master宕机为客观宕机事实</span><br><span class="line">sentinel monitor mymaster 127.0.0.1 6379 2</span><br><span class="line"></span><br><span class="line">#当多少毫秒master不返回ping结果即认为主观宕机</span><br><span class="line">sentinel down-after-milliseconds mymaster 30000</span><br><span class="line"></span><br><span class="line">#master重新选举之后slave并发复制master数据的并发量</span><br><span class="line">sentinel parallel-syncs mymaster 1</span><br><span class="line"></span><br><span class="line">#故障转移超时时间，默认为3分钟</span><br><span class="line">sentinel failover-timeout mymaster 180000</span><br><span class="line"></span><br><span class="line">#当sentinel有任何警告级别的事件发生时（比如说redis实例的主观失效和客观失效等等），将会调用这个脚本</span><br><span class="line">#如果脚本以“1”退出，则稍后重试执行（最多可执行10次），脚本的最长运行时间为60秒</span><br><span class="line">#sentinel notification-script mymaster /var/redis/notify.sh</span><br><span class="line"></span><br><span class="line">#当master因failover而发生改变，这个脚本将被调用，通知相关的客户端关于master地址已经发生改变的信息</span><br><span class="line">#sentinel client-reconfig-script mymaster /var/redis/reconfig.sh</span><br><span class="line"></span><br><span class="line">#不允许使用SENTINEL SET设置notification-script和client-reconfig-script</span><br><span class="line">sentinel deny-scripts-reconfig yes</span><br></pre></td></tr></table></figure>
<h3 id="Sentinel三个定时任务">Sentinel三个定时任务</h3>
<ul>
<li>每10秒每个sentinel对master和slave执行info
<ul>
<li>发现slave</li>
<li>确认主从关系</li>
</ul>
</li>
<li>每2秒每个sentinel通过master节点的channel交换信息（pub/sub模式）
<ul>
<li>通过<code>__sentinel__:hello</code>频道交互</li>
<li>交互各节点的“看法”及自身信息</li>
</ul>
</li>
<li>每1秒每个sentinel对其他sentinel和redis节点执行ping
<ul>
<li>心跳检查、失败依据</li>
</ul>
</li>
</ul>
<h3 id="Master选举过程">Master选举过程</h3>
<p><strong>第一步：Sentinel选举出leader</strong></p>
<p>原因：只需要一个Sentinel完成故障转移</p>
<p>选举：通过<code>sentinel is-master-down-by-addr</code>命令都希望自己成为领导者</p>
<ul>
<li>每个做主观下线的Sentinel节点向其它Sentinel节点发送命令，要求它给自己投票</li>
<li>收到命令的Sentinel节点如果没有同意其它Sentinel节点发送的命令，则同意投票否则拒绝</li>
<li>如果该Sentinel节点发现自己的票数已经超过Sentinel半数，那么它将成为leader</li>
<li>如果此过程未选出leader则等待一段时间继续选举</li>
</ul>
<p><strong>第二步：故障转移选举Master</strong></p>
<ul>
<li>
<p>从slave节点中选出一个“合适”的节点作为新的master节点</p>
<ul>
<li>选择<code>slave-prority</code>最高的slave节点，如果存在则返回【一般不修改】</li>
<li>选择复制偏移量最大的slave节点，如果存在则返回</li>
<li>选择runId最小的slave节点</li>
</ul>
</li>
<li>
<p>对上面的slave节点执行<code>slaveof no one</code>命令让其成为master节点</p>
</li>
<li>
<p>向剩余的slave节点发送<code>slaveof</code>命令，让它们成为master节点的slave节点，复制规则和<code>paraller-sync</code>参数有关</p>
</li>
<li>
<p>更新对原来master节点配置为slave，并保存对其“关注”，当其恢复后命令它去复制新的master节点</p>
</li>
</ul>
<blockquote>
<p>手动下线master机器<code>sentinel failover &lt;masterName&gt;</code></p>
</blockquote>
<h2 id="十、Redis-Cluster">十、Redis Cluster</h2>
<h3 id="数据分布概论">数据分布概论</h3>
<p><img src="https://mynamelancelot.github.io/img/redis/Data-Distribution.png" alt="Data-Distribution"></p>
<table>
<thead>
<tr>
<th>分布方式</th>
<th>特点</th>
<th>典型产品</th>
</tr>
</thead>
<tbody>
<tr>
<td>哈希分布</td>
<td>数据分散度高</td>
<td></td>
</tr>
<tr>
<td>Memcache</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Redis Cluster</p>
<p>|<br>
| 键值分布业务无关 |<br>
| 无法顺序访问 |<br>
| 支持批量操作 |<br>
| 顺序分布 | 数据分散度易倾斜 |</p>
<p>BigTable</p>
<p>HBase</p>
<p>|<br>
| 键值分布业务相关 |<br>
| 可顺序访问 |<br>
| 支持批量操作 |</p>
<h3 id="哈希分布方式">哈希分布方式</h3>
<p><strong>节点取余分区</strong></p>
<p><img src="https://mynamelancelot.github.io/img/redis/Delivery-Partition.png" alt="Delivery-Partition"></p>
<p>进行取模运算，将余数相等的放入同一节点，简单易操作，增加节点时数据偏移,导致数据的前移达到80%，翻倍扩容可以使数据迁移从80%降到50%</p>
<p><strong>一致性hash分区</strong></p>
<p><img src="https://mynamelancelot.github.io/img/redis/Consistency-Hash.png" alt="Consistency-Hash"></p>
<p>为系统中每个节点分配一个token，范围一般在0~2的32次方，这些token构成哈希环。数据读写执行节点查找操作时，先根据key计算hash值，然后顺时针找到第一个大于等于该哈希值的token节点，往往一个节点会对应多个token。加减节点会造成哈希环中部分数据无法命中，需要手动处理或者忽略这些数据，常用于缓存场景</p>
<p><strong>虚拟哈希分区</strong></p>
<p><img src="https://mynamelancelot.github.io/img/redis/Slot-Partition.png" alt="Slot-Partition"></p>
<p>虚拟分槽使用哈希函数把所有数据映射到一个固定范围的整数集合中，整数定义为槽（slot）。槽数范围远远大于节点数（redisCluster槽的范围是0~16383），每一个节点负责维护一部分槽以及所映射的键值数据</p>
<h3 id="基本架构">基本架构</h3>
<p><img src="https://mynamelancelot.github.io/img/redis/cluster-architecture.jpg" alt="cluster-architecture"></p>
<ul>
<li>
<p>所有的redis节点彼此互联(PING-PONG机制),内部使用二进制协议优化传输速度和带宽</p>
</li>
<li>
<p>节点的fail是通过集群中超过半数的master节点检测失效时才生效</p>
</li>
<li>
<p>客户端与redis节点直连,不需要中间proxy层.客户端连接集群中任何一个可用节点即可</p>
</li>
<li>
<p>redis-cluster把所有的物理节点映射到[0-16383]slot上,cluster 负责维护node&lt;-&gt;slot&lt;-&gt;key</p>
</li>
</ul>
<h3 id="安装Cluster">安装Cluster</h3>
<p>修改redis配置文件</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cluster-enable yes</span><br><span class="line">cluster-config-file nodes-$&#123;port&#125;.conf</span><br></pre></td></tr></table></figure>
<p><strong>原生安装</strong></p>
<ul>
<li>
<p>启动所有节点</p>
</li>
<li>
<p>执行<code>redis-cli -p $&#123;port&#125; cluster meet $&#123;ip&#125; $&#123;port&#125;</code>使节点相遇</p>
</li>
<li>
<p>执行<code>cluster addslots slot [slot...]</code>分配槽</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">start=$1</span><br><span class="line">end=$2</span><br><span class="line">port=$3</span><br><span class="line">for slot in `seq $&#123;start&#125; $&#123;end&#125;`</span><br><span class="line">do</span><br><span class="line">  echo &quot;slot:$&#123;slot&#125;&quot;</span><br><span class="line">  /opt/redis/bin/redis-cli -p $&#123;port&#125; cluster addslots $&#123;slot&#125;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>执行<code>redis-cli -p $&#123;port&#125; cluster replicate $&#123;nodeId&#125;</code>执行主从分配</p>
</li>
</ul>
<p><strong>集群命令安装</strong></p>
<ul>
<li>
<p><code>redis-cli --cluster create --cluster-replicas 1 127.0.0.1:7000 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005</code></p>
<p>–cluster-replicas代表集群的每个主节点的从节点个数</p>
<blockquote>
<p>ruby安装已废弃</p>
</blockquote>
</li>
</ul>
<p><strong>cluster配置参数</strong></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cluster-enable yes</span><br><span class="line">cluster-config-file nodes-$&#123;port&#125;.conf</span><br><span class="line">cluster-node-timeout 15000</span><br><span class="line">cluster-require-full-coverage yes 		#必须集群所有节点能提供服务才提供服务</span><br></pre></td></tr></table></figure>
<h3 id="集群伸缩">集群伸缩</h3>
<p><strong>扩展集群</strong></p>
<p>扩展步骤原理</p>
<ol>
<li>对目标节点发送cluster setslot {slot} importing {targetNodeId}命令，让目标节点准备导入槽的数据</li>
<li>对源节点发送cluster setslot {slot} migrating {sourceNodeId}命令，让源节点准备槽数据的导出</li>
<li>源节点上循环执行cluster getkeyinslot {slot} count 命令，每次获取属于这个槽中键的个数</li>
<li>在源节点上执行migrate {sourceIp} {sourcePort} key 0 {timeout}命令，迁移指定的key</li>
<li>重复执行步骤3~4直到槽下所有数据完成迁移</li>
<li>向集群内所有主节点发送cluster setslot {slot} node {targetNodeId}命令，通知槽分配给目标节点</li>
</ol>
<p><img src="https://mynamelancelot.github.io/img/redis/Cluster-Expend.png" alt="Cluster-Expend"></p>
<p>扩展执行步骤</p>
<ul>
<li>
<p>加入集群</p>
<p>执行<code>redis-cli -p $&#123;port&#125; cluster meet $&#123;ip&#125; $&#123;port&#125;</code>将节点加入集群</p>
</li>
<li>
<p>设置主从关系</p>
<p><code>redis-cli -p $&#123;port&#125; cluster replicate $&#123;nodeId&#125;</code>设置主从关系</p>
</li>
<li>
<p>任意节点执行迁移槽命令，后续过程根据提示进行</p>
<p><code>redis-cli --cluster reshard &#123;ip&#125;:&#123;port&#125;</code></p>
</li>
<li>
<p>查看节点分配情况</p>
<p><code>redis-cli -p &#123;prot&#125; cluster nodes | grep master</code></p>
</li>
</ul>
<p><strong>集群缩容</strong></p>
<p><img src="https://mynamelancelot.github.io/img/redis/Cluster-Shrink.png" alt="Cluster-Shrink"></p>
<p>迁移槽命令和扩展集群的迁移命令相同，迁移完成之后使用<code>redis-cli cluster forget &#123;downNodeId&#125;</code>下线节点</p>
<ul>
<li>
<p>迁移数据</p>
<p><code>redis-cli --cluster reshard &#123;ip&#125;:&#123;port&#125; --cluster-from &#123;sourceNodeId&#125; --cluster-to &#123;targetNodeId&#125; --cluster-slots &#123;slotsNum&#125;</code></p>
</li>
<li>
<p>下线节点</p>
<p><code>redis-cli --cluster del-node &#123;ip&#125;:&#123;port&#125; &#123;shutdownNodeId&#125;</code></p>
</li>
</ul>
<h3 id="客户端路由">客户端路由</h3>
<blockquote>
<p>使用cluster keyslot ${key}可查看key对应的hash值</p>
</blockquote>
<p><strong>moved重定向</strong></p>
<p><img src="https://mynamelancelot.github.io/img/redis/Cluster-Move.png" alt="Cluster-Move"></p>
<p><strong>ask重定向</strong></p>
<p><img src="https://mynamelancelot.github.io/img/redis/Cluster-Ask.png" alt="Cluster-Ask"></p>
<p><strong>smart客户端</strong></p>
<p>实现原理：追求性能</p>
<ol>
<li>从集群中选一个可运行节点，使用<code>cluster slots</code>初始化槽和节点映射</li>
<li>将cluster slots的结果映射到本地缓存，为每个节点创建JedisPool</li>
<li>准备执行命令(使用CRC16计算key对应的槽，找到映射节点执行)</li>
</ol>
<p><img src="https://mynamelancelot.github.io/img/redis/Smart-Client.png" alt="Smart-Client"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    Set&lt;HostAndPort&gt; nodes = new HashSet&lt;HostAndPort&gt;();</span><br><span class="line">    nodes.add(new HostAndPort(&quot;192.168.1.158&quot;, 7000));</span><br><span class="line">    nodes.add(new HostAndPort(&quot;192.168.1.158&quot;, 7001));</span><br><span class="line">    nodes.add(new HostAndPort(&quot;192.168.1.158&quot;, 7002));</span><br><span class="line">    nodes.add(new HostAndPort(&quot;192.168.1.158&quot;, 7003));</span><br><span class="line">    nodes.add(new HostAndPort(&quot;192.168.1.158&quot;, 7004));</span><br><span class="line">    nodes.add(new HostAndPort(&quot;192.168.1.158&quot;, 7005));</span><br><span class="line">    JedisCluster jedisCluster = new JedisCluster(nodes);</span><br><span class="line">    jedisCluster.set(&quot;hello&quot;, &quot;cluster&quot;);</span><br><span class="line">    System.out.println(jedisCluster.get(&quot;hello&quot;));</span><br><span class="line">    jedisCluster.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="批量操作">批量操作</h3>
<p>Redis主要提供了以下几种批量操作方式：</p>
<ul>
<li>批量get/set(multi get/set)</li>
<li>管道(pipelining)</li>
<li>事务(transaction)</li>
<li>基于事务的管道(transaction in pipelining)</li>
</ul>
<p>批量操作必须key在同一个槽，导致以上用法异常苛刻</p>
<p><strong>方案一：传统的串行IO操作，也就说n个key，分n次串行操作来获取key，复杂度是o(n)</strong></p>
<p><strong>方案二：将mget操作(n个key)，利用已知的hash函数算出key对应的节点，这样就可以得到一个这样的关系：Map&lt;node, somekeys&gt;，也就是每个节点对应的一些keys，这样将之前的o(n)的效率降低到o(node.size())</strong></p>
<p><img src="https://mynamelancelot.github.io/img/redis/MuliCmd-Serial-Io.webp" alt="MuliCmd-Serial-Io"></p>
<p><strong>方案三：在方案二的基础上将串行取数据改为并行取数据，进一步提高效率</strong></p>
<p><img src="https://mynamelancelot.github.io/img/redis/MuliCmd-parell-Io.webp" alt="MuliCmd-parell-Io"></p>
<p><strong>方案四：通过redis自带的hashtag功能，强制一批key分配到某台机器上【不建议，大量数据会造成数据倾斜】</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//使用&#123;user&#125;作为key，使key统一</span><br><span class="line">jedisCluster.mset(&quot;&#123;user&#125;1001&quot;,&quot;zhangsan&quot;,&quot;&#123;user&#125;1002&quot;,&quot;lisi&quot;,&quot;&#123;user&#125;1003&quot;,&quot;wangwu&quot;);</span><br><span class="line">List&lt;String&gt; users = jedisCluster.mget(&quot;&#123;user&#125;1001&quot;,&quot;&#123;user&#125;1002&quot;,&quot;&#123;user&#125;1003&quot;);</span><br></pre></td></tr></table></figure>
<h3 id="故障转移">故障转移</h3>
<p><strong>故障发现</strong></p>
<ul>
<li>通过ping/pong信息实现故障发现，当半数以上持有槽的主节点都标记某节点主观下线则为客观下线【向集群广播下线节点的fail消息】</li>
<li>客观下线发送通知故障节点的从节点触发故障转义流程</li>
</ul>
<p><strong>故障恢复</strong></p>
<ul>
<li>资格审查
<ul>
<li>每个从节点检查与故障主节点的断线时间</li>
<li>超过<code>cluster-node-timeout * cluster-slave-validity-factor</code>取消资格</li>
<li><code>cluster-slave-validity-factor</code>默认是10</li>
</ul>
</li>
<li>准备选举时间
<ul>
<li>最接近主节点的偏移量的从节点率先发起选举，稍后其他从节点发起选举</li>
</ul>
</li>
<li>选举投票
<ul>
<li>收集票数大于N/2+1即为选举成功</li>
</ul>
</li>
<li>替换主节点
<ul>
<li>当前从节点取消复制变为主节点（slave no one）</li>
<li>执行clusterDelSlot撤销故障主节点负责的槽，并执行clusterAddSlot把这些槽分配给自己</li>
<li>向集群广播自己的pong消息，表明已经替换了故障从节点</li>
</ul>
</li>
</ul>
<h3 id="集群运维问题">集群运维问题</h3>
<p><strong>集群完整性</strong></p>
<p><code>cluster-require-full-coverage yes</code>默认为yes</p>
<ul>
<li>集群中16384个槽全部可用：保证集群完整性</li>
<li>节点故障或者正在故障转移，集群不可使用</li>
</ul>
<p>大多数情况下业务无法容忍，建议<code>cluster-require-full-coverage</code>设置为no</p>
<p><strong>PubSub广播</strong></p>
<p>任意节点发布消息所有节点都会订阅到消息，消耗带宽较多。JedisCluster只会订阅任意一个节点</p>
<p><strong>数据倾斜</strong></p>
<p>造成的原因：</p>
<ul>
<li>节点槽分配不均</li>
<li>不同槽对应的键值数量差异较大【可能存在hashTag】</li>
<li>包含bigkey</li>
<li>内存相关配置不一致</li>
</ul>
<blockquote>
<p>使用<code>redis-cli --cluster info &#123;ip&#125;:&#123;port&#125;</code>可以查看key、slot分布情况</p>
<p>使用<code>redis-cli --cluster rebalance &#123;ip&#125;:&#123;port&#125;</code>进行数据平衡【慎用】</p>
</blockquote>
<p><strong>从机读写问题</strong></p>
<p>在集群模式下从节点不接受任何读写请求</p>
<ul>
<li>命令会重定向到负责槽的主节点</li>
<li>readonly命令可以读取【连接级别】</li>
</ul>
<p><strong>数据迁移</strong></p>
<p>官方工具不只能从单机向集群迁移，不支持断点续传，不支持在线迁移，单线程影响速度，不建议使用官方工具</p>
<h2 id="十一、缓存设计与优化">十一、缓存设计与优化</h2>
<h3 id="缓存使用的成本">缓存使用的成本</h3>
<ul>
<li>数据不一致：缓存层和数据层有时间窗口不一致，和更新策略有关</li>
<li>代码维护成本：多了一层缓存逻辑</li>
<li>运维成本：例如Redis Cluster</li>
</ul>
<h3 id="缓存更新策略">缓存更新策略</h3>
<p>redis里面存储的过期时间，都是绝对时间点，所以如果两台机器时钟不同步，那么超过的数据会全部删除。</p>
<ul>
<li>slaves不会独立删除数据，而是等待master给它发送删除指令的时候，再删除数据</li>
<li>如果slave当选为master的时候，会先淘汰keys，然后再成为master</li>
</ul>
<hr>
<ul>
<li>
<p>设置<code>maxmemory-policy</code>值指定算法</p>
<table>
<thead>
<tr>
<th>更新策略</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>volatile-lru</td>
<td>过期的键使用LRU策略剔除，没有可删除对象则退回到noeviction</td>
</tr>
<tr>
<td>allkeys-lru</td>
<td>所有键均使用LRU策略剔除，直到腾出足够空间</td>
</tr>
<tr>
<td>volatile-lfu</td>
<td>过期的键使用LFU策略剔除，没有可删除对象则退回到noeviction</td>
</tr>
<tr>
<td>allkeys-lfu</td>
<td>所有键均使用LFU策略剔除，直到腾出足够空间</td>
</tr>
<tr>
<td>volatile-random</td>
<td>过期的键使用随机策略剔除，没有可删除对象则退回到noeviction</td>
</tr>
<tr>
<td>allkeys-random</td>
<td>所有键均使用随机策略剔除，直到腾出足够空间</td>
</tr>
<tr>
<td>volatile-ttl</td>
<td>剔除TTL最小的键，没有可删除对象则退回到noeviction</td>
</tr>
<tr>
<td>noeviction</td>
<td>默认策略，不做任何事，返回写错误</td>
</tr>
</tbody>
</table>
<blockquote>
<p>LRU【Least Recently Used】最近最少被使用</p>
<p>LFU【Least Frequently Used】最不常用</p>
</blockquote>
</li>
<li>
<p>被动更新</p>
<p>当客户端方位key的时候，主动检测这些key是否过期，过期就删除</p>
</li>
<li>
<p>主动更新</p>
<p>每秒检测10次以下操作，测试随机的20个keys进行相关过期检测，删除所有的过期的keys，如果有多于25%的keys过期，重复此操作</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>策略</th>
<th>一致性</th>
<th>维护成本</th>
</tr>
</thead>
<tbody>
<tr>
<td>算法剔除</td>
<td>最差</td>
<td>低</td>
</tr>
<tr>
<td>被动更新</td>
<td>较差</td>
<td>低</td>
</tr>
<tr>
<td>主动更新</td>
<td>强</td>
<td>高</td>
</tr>
</tbody>
</table>
<blockquote>
<p>低一致性：最大内存和淘汰策略</p>
<p>高一致性：超时剔除和主动更新结合，最大内存和淘汰策略兜底</p>
</blockquote>
<h3 id="缓存穿透-缓存雪崩-无底洞">缓存穿透&amp;缓存雪崩&amp;无底洞</h3>
<p><strong>缓存穿透</strong></p>
<p><img src="https://mynamelancelot.github.io/img/redis/Cache-Miss.png" alt="Cache-Miss"></p>
<p>特点：</p>
<p>当缓存和数据库中都没有数据的时候，当查询Redis没有数据的时候，会继续查询数据库，数据库也没有数据，当大量查询请求发生或遭到恶意攻击时，这些访问全部透过Redis，并且数据库也没有数据，这种现象称为“缓存穿透”。</p>
<p>解决方案：</p>
<ol>
<li>缓存空对象，storage返回一个空对象，将键存储在缓存层，下次请求此键之间返回空对象
<ul>
<li>需要更多的键，建议设置过期时间</li>
<li>缓存层和存储层数据“短期”不一致</li>
</ul>
</li>
<li><a href="#bloomFilter">布隆过滤器</a></li>
</ol>
<p><strong>缓存击穿</strong></p>
<p>特点：</p>
<p>当Redis的热点数据key失效时，大量并发查询直接打到数据库，此时数据库负载压力骤增，这种现象称为“缓存击穿”</p>
<p><img src="https://mynamelancelot.github.io/img/redis/hotkey-expir.png" alt="hotkey-expir"></p>
<p>解决方案：</p>
<p>1.设置key值永不过期</p>
<p>2.使用互斥锁，查到后就回填缓存</p>
<p><strong>缓存雪崩</strong></p>
<p>特点：</p>
<p>缓存雪崩是指在短时间内，有大量缓存同时过期，导致大量的请求直接查询数据库，从而对数据库造成了巨大的压力，严重情况下可能会导致数据库宕机的情况叫做缓存雪崩。</p>
<p><img src="https://mynamelancelot.github.io/img/redis/crash.png" alt="crash"></p>
<p>解决方案：</p>
<ul>
<li>随机设置key过期时间</li>
<li>随机延时，让一部分查询先将数据缓存起来</li>
<li>设置key值永不过期</li>
</ul>
<p><strong>无底洞问题</strong></p>
<p>现象：增加节点机器性能没提升反而下降</p>
<p><img src="https://mynamelancelot.github.io/img/redis/Cache-Node-Add.png" alt="Cache-Node-Add"></p>
<p>解决方案参考<a href="#Multi-Operator">批量操作</a></p>
<h3 id="热点key的重建优化">热点key的重建优化</h3>
<p><img src="https://mynamelancelot.github.io/img/redis/Hot-Key.png" alt="Hot-Key"></p>
<p>现象：热点key缓存重建过程过长导致浪费了不必要的资源</p>
<p>解决方案：</p>
<ol>
<li>
<p>互斥锁【使用redis构建锁机制】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">String get(String key) &#123;</span><br><span class="line">    String value = redis.get(key);</span><br><span class="line">    if(value == null) &#123;</span><br><span class="line">        String mutexKey = &quot;mutex:key:&quot;+key;</span><br><span class="line">        if(redis.SetParams.setParams().ex(180).nx()) &#123;</span><br><span class="line">            value = db.get(key);</span><br><span class="line">            redis.set(key,value);</span><br><span class="line">            redis.delete(mutexKey);</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            Thread.sleep(1000);</span><br><span class="line">            get(key);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>永不过期</p>
<ul>
<li>缓存层面：没有设置过期时间</li>
<li>功能层面：为每个value添加逻辑过期时间，但发现超过逻辑过期时间后，会使用单独的线程取构建缓存</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>方案</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody>
<tr>
<td>互斥锁</td>
<td>思路简单</td>
<td>代码复杂度增加</td>
</tr>
<tr>
<td>保证一致性</td>
<td>存在死锁的风险</td>
<td></td>
</tr>
<tr>
<td>永不过期</td>
<td>基本杜绝热点key重建问题</td>
<td>不保证一致性</td>
</tr>
<tr>
<td>逻辑过期时间增加维护成本和内存成本</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="十二、Redis布隆过滤器">十二、Redis布隆过滤器</h2>
<h3 id="布隆过滤器的原理">布隆过滤器的原理</h3>
<p><img src="https://mynamelancelot.github.io/img/redis/Bloom-Filter.jpg" alt="Bloom-Filter"></p>
<ol>
<li>首先需要k个hash函数，每个函数可以把key散列成为1个整数</li>
<li>初始化时，需要一个长度为n比特的数组，每个比特位初始化为0</li>
<li>某个key加入集合时，用k个hash函数计算出k个散列值，并把数组中对应的比特位置为1</li>
<li>判断某个key是否在集合时，用k个hash函数计算出k个散列值，并查询数组中对应的比特位，如果所有的比特位都是1，认为在集合中</li>
</ol>
<p>优点：不需要存储key，节省空间</p>
<p>缺点：算法判断key在集合中时，有一定的概率key其实不在集合中，且无法删除</p>
<blockquote>
<p>google-guava库实现了java版的布隆过滤器</p>
</blockquote>
<h3 id="Redis布隆过滤器">Redis布隆过滤器</h3>
<p><strong>使用插件的方式部署</strong></p>
<p>redis4.0之后支持使用插件的方式使用Bloom filters和cuckoo filters，redis4.0之前需手动使用代码的方式编写布隆过滤器，安装步骤参考下列链接</p>
<p><a target="_blank" rel="noopener" href="https://github.com/RedisLabsModules/redisbloom">GitHub地址</a> <a target="_blank" rel="noopener" href="http://redisbloom.io/">使用文档</a></p>
<p>建议在conf配置文件中配置，不使用<code>redis-server --loadmodule /path/to/rebloom.so</code>启动</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loadmodule /path/to/rebloom.so</span><br></pre></td></tr></table></figure>
<p><strong>布隆过滤器命令</strong></p>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>BF.RESERVE</strong> {key} {error_rate} {size}</td>
<td>创建布隆过滤器，error_rate为错误率，size为预期数据大小</td>
</tr>
<tr>
<td><strong>BF.ADD</strong> {key} {item}</td>
<td>添加item到指定布隆过滤器</td>
</tr>
<tr>
<td><strong>BF.MADD</strong> {key} {item} [item …]</td>
<td>批量添加item到指定布隆过滤器</td>
</tr>
<tr>
<td><strong>BF.EXISTS</strong> {key} {item}</td>
<td>判断item是否存在与指定布隆过滤器</td>
</tr>
<tr>
<td><strong>BF.MEXISTS</strong> {key} {item} [item …]</td>
<td>批量判断item是否存在与指定布隆过滤器</td>
</tr>
</tbody>
</table>
<p><strong>JavaAPI</strong></p>
<p>导入maven依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.redislabs&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jrebloom&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.1.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>Api使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    JedisPool jedisPool = new JedisPool(&quot;192.168.1.158&quot;, 6379);</span><br><span class="line">    Client client = new Client(jedisPool);</span><br><span class="line">    client.createFilter(&quot;main6&quot;, 10000, 0.000001);</span><br><span class="line">    //批量插入数据</span><br><span class="line">    for (int i = 0; i &lt;100; i++) &#123;</span><br><span class="line">        String values[] = new String[100];</span><br><span class="line">        for (int j = 0; j &lt; 100; j++) &#123;</span><br><span class="line">            String value = &quot;item&quot; + (i * 100 +j);</span><br><span class="line">            values[j] = value;</span><br><span class="line">        &#125;</span><br><span class="line">        client.addMulti(&quot;main6&quot;, values);</span><br><span class="line">    &#125;</span><br><span class="line">	//判断是否存在</span><br><span class="line">    System.out.println(client.exists(&quot;main6&quot;, &quot;item1&quot;));</span><br><span class="line">    System.out.println(client.exists(&quot;main6&quot;, &quot;a&quot;));</span><br><span class="line">    jedisPool.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="十三、Redis开发规范">十三、Redis开发规范</h2>
<h3 id="BigKey处理">BigKey处理</h3>
<p><strong>发现BigKey</strong></p>
<ul>
<li><code>debug object &#123;key&#125;</code> 查看指定key的详细信息</li>
<li><code>redis-cli --bigkeys</code> 扫描出BigKey【全表扫描，阻塞，建议从节点本地执行】</li>
</ul>
<p><strong>BigKey删除</strong></p>
<p>场景：当key非常大时，delete命令执行十分缓慢，会发生阻塞【过期bigkey也是进行删除操作也会阻塞】</p>
<p>redis4.0之后：可以使用<code>unlink</code>命令进行后台删除，不阻塞前台</p>
<h3 id="生命周期管理">生命周期管理</h3>
<ul>
<li>
<p>使用<code>OBJECT IDLETIME &#123;key&#125;</code>查看key的闲置时间</p>
</li>
<li>
<p>过期时间不易集中</p>
</li>
</ul>
<h3 id="命令优化">命令优化</h3>
<p>有遍历需求可以使用<code>hscan</code>、<code>sscan</code>、<code>zscan</code>代替【<strong>这些扫描命令在field较少时COUNT参数不会生效</strong>】</p>
<p>必要情况下使用<code>monitor</code>命令监控，注意时间不要过长</p>
<h3 id="Java客户端优化">Java客户端优化</h3>
<table>
<thead>
<tr>
<th>参数名</th>
<th>含义</th>
<th>默认值</th>
<th>建议</th>
</tr>
</thead>
<tbody>
<tr>
<td>testWhileIdle</td>
<td>是否开启空闲资源检测</td>
<td>false</td>
<td>true</td>
</tr>
<tr>
<td>timeBetweenEvictionRunsMillis</td>
<td>空闲资源检测周期</td>
<td>-1</td>
<td>自选，也可使用JedisPoolConfig中的默认值</td>
</tr>
<tr>
<td>minEvictiableIdleTimeMillis</td>
<td>资源池中资源最小空闲时间</td>
<td>30分钟</td>
<td>自选，也可使用JedisPoolConfig中的默认值</td>
</tr>
<tr>
<td>numTestsPerEvictionRun</td>
<td>做空闲资源检测每次的采样数</td>
<td>3</td>
<td>自选，如果设置为-1则为全部做空闲检测</td>
</tr>
</tbody>
</table>
<p>maxIdle需要设置为接近maxTotal</p>
<blockquote>
<p>预估maxTotal方法的例子：</p>
<p>一次命令时间平均耗时1ms，一个连接QPS大约1000，业务期忘的QPS时50000，理论上maxTotal=50000/1000=50</p>
</blockquote>
<h2 id="十四、内存管理">十四、内存管理</h2>
<h3 id="内存消耗">内存消耗</h3>
<p><strong>内存统计</strong></p>
<p>执行<code>info memory</code>命令可以查看内存信息</p>
<table>
<thead>
<tr>
<th>主要属性名</th>
<th>属性说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>used_memory</td>
<td>实际存储数据的内存总量</td>
</tr>
<tr>
<td>used_memory_rss</td>
<td>redis进程占用的总物理内存</td>
</tr>
<tr>
<td>maxmemory</td>
<td>最大内存</td>
</tr>
<tr>
<td>maxmemory_policy</td>
<td>内存剔除策略</td>
</tr>
<tr>
<td>mem_fragmentation_ratio</td>
<td>used_memory_rss/used_memory比值，表示内存碎片率</td>
</tr>
</tbody>
</table>
<p><strong>内存消耗划分</strong></p>
<p><img src="https://mynamelancelot.github.io/img/redis/Memory-Used.png" alt="Memory-Used"></p>
<ul>
<li>
<p>客户端缓冲区设置规则</p>
<p>client-output-buffer-limit <class> <hard limit> <soft limit> <soft seconds></p>
<p><class>:客户端类型，分为三种</p>
<p>​ (a)normal:普通客户端</p>
<p>​ (b)slave:用从节点用于复制，伪裝成客户端</p>
<p>​ ©pubsub:发布订阅客户端 <hardlimit>:如客户使用的输出冲区大于hardlimit客户端会被立即关闭</p>
<p><soft limit> 和<soft seconds>:如果客户端使用的输出缓冲区超过了 <soft limit>并且持续了<soft seconds>，客户会被立即关闭</p>
<ul>
<li>普通客户端默认：client-output-buffer-limit normal 0 0 0</li>
<li>salve客户端默认：client-output-buffer-limit slave 256mb 64mb 60</li>
<li>pubsub客户端默认：client-output-buffer-limit slave 32mb 8mb 60</li>
</ul>
</li>
<li>
<p>复制缓冲区：用于slave和master断开重连时不进行全量复制保存偏移数据使用</p>
<p>默认为<code>repl-backlog-size 1mb</code></p>
</li>
<li>
<p>AOF缓冲区：AOF重写期间，AOF缓冲区，没有容量限制</p>
</li>
</ul>
<h3 id="内存回收策略">内存回收策略</h3>
<p>删除过期值</p>
<ul>
<li>惰性删除：访问key-&gt;expired dict-&gt;del key【先在过期表中找，发现过期删除key，返回null】</li>
<li>定时删除：每秒运行10次，采样删除</li>
</ul>
<p>超过maxmemory使用maxmemory-policy进行控制，参见<a href="#cache_update">缓存更新策略</a></p>
<h2 id="十五、开发运维事项">十五、开发运维事项</h2>
<h3 id="Linux内核优化">Linux内核优化</h3>
<p><strong>vm.overcommit_memory</strong></p>
<p>Redis建议vm.overcommit_memory = 1(影响fork操作）</p>
<p>立即生效：</p>
<p>永久生效：vm.overcommit_memory = 1写入到/etc/sysctl.conf文件中</p>
<table>
<thead>
<tr>
<th>值</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>表示内核将检查是否有足够可用的内存。如果有足够可用的内存，内存申请通过，否则内存申请失败，并返回错误给进程</td>
</tr>
<tr>
<td>1</td>
<td>表示内核允许超量使用内存直到用完为止</td>
</tr>
<tr>
<td>2</td>
<td>表示内存绝不过量使用，即整个系统内存不能超过swap+50%的RAM值</td>
</tr>
</tbody>
</table>
<p><strong>swappiness</strong></p>
<table>
<thead>
<tr>
<th>值</th>
<th>策略</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Linux3.5及以上：宁愿OOM Killer也不用swap</td>
</tr>
<tr>
<td>Linux3.5及以下：宁愿swap也不用OOM Killer</td>
<td></td>
</tr>
<tr>
<td>1</td>
<td>Linux3.5及以上：宁愿swap也不用OOM Killer</td>
</tr>
<tr>
<td>60</td>
<td>默认值</td>
</tr>
<tr>
<td>100</td>
<td>操作系统会主动使用swap</td>
</tr>
</tbody>
</table>
<p>建议：Linux3.5以上vm.swappiness = 1，否则vm.swappiness = 0</p>
<p>立即生效：echo {bestValue} &gt; /proc/sys/vm/swappiness</p>
<p>永久生效：vm.swappiness = {bestValue} 写入到/etc/sysctl.conf</p>
<p><strong>THP(Transparent huge page)</strong></p>
<p>建议禁用，Centos7在<code>/sys/kernel/mm/transparent_hugepage/enabled</code>下设置为never即可</p>
<p>THP为大内存页时fork子线程时Copy-On-Write可能造成延迟</p>
<p><strong>ulimit</strong></p>
<p>建议将Redis启动用户的文件句柄限制调成10032，限制文件<code>etc/security/limits</code></p>
<p><strong>TCP backlog</strong></p>
<p>建议将<code>/proc/sys/net/core/somaxconn</code>系统TCP backlog的限制设置为与Redis一样默认511</p>
<h3 id="Redis安全问题">Redis安全问题</h3>
<p>在配置文件中配置</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#将命令更改为另一个字符串，原命令失效。如果字符串为空则表示禁用此命令</span><br><span class="line">rename-command &#123;cmd&#125; &#123;str&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>附各种数据类型的内部编码：</p>
<p><img src="https://mynamelancelot.github.io/img/redis/Data-Encoding.png" alt="Data-Encoding"></p>
<p>附Redis云平台CacheCloud【一键部署、监控、运维、数据迁移工具等】 <a target="_blank" rel="noopener" href="https://github.com/sohutv/cachecloud">GitHub项目地址</a></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../2022/11/05/Redis%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../2022/10/27/%E5%85%A8%E6%96%87%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E-Elasticsearch-%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/"
                            aria-label=": 全文搜索引擎 Elasticsearch 入门教程"
                        >
                            全文搜索引擎 Elasticsearch 入门教程
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-10-27T13:35:38+08:00">
	
		    2022 年 10 月 27 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="">后端</a>, <a class="category-link" href="Elasticsearch/">Elasticsearch</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%85%A8%E6%96%87%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E">全文搜索</a>属于最常见的需求，开源的 <a target="_blank" rel="noopener" href="https://www.elastic.co/">Elasticsearch</a> （以下简称 Elastic）是目前全文搜索引擎的首选。</p>
<p>它可以快速地储存、搜索和分析海量数据。维基百科、Stack Overflow、Github 都采用它。</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2017/bg2017081701.jpg" alt=""></p>
<p>Elastic 的底层是开源库 <a target="_blank" rel="noopener" href="https://lucene.apache.org/">Lucene</a>。但是，你没法直接用 Lucene，必须自己写代码去调用它的接口。Elastic 是 Lucene 的封装，提供了 REST API 的操作接口，开箱即用。</p>
<p>本文从零开始，讲解如何使用 Elastic 搭建自己的全文搜索引擎。每一步都有详细的说明，大家跟着做就能学会。</p>
<h2 id="一、安装">一、安装</h2>
<p>Elastic 需要 Java 8 环境。如果你的机器还没安装 Java，可以参考<a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-install-java-with-apt-get-on-debian-8">这篇文章</a>，注意要保证环境变量<code>JAVA_HOME</code>正确设置。</p>
<p>安装完 Java，就可以跟着<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/zip-targz.html">官方文档</a>安装 Elastic。直接下载压缩包比较简单。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.5.1.zip</span><br><span class="line">$ unzip elasticsearch-5.5.1.zip</span><br><span class="line">$ <span class="built_in">cd</span> elasticsearch-5.5.1/ </span><br></pre></td></tr></table></figure>
</blockquote>
<p>接着，进入解压后的目录，运行下面的命令，启动 Elastic。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ ./bin/elasticsearch</span><br></pre></td></tr></table></figure>
</blockquote>
<p>如果这时<a target="_blank" rel="noopener" href="https://github.com/spujadas/elk-docker/issues/92">报错</a>&quot;max virtual memory areas vm.max<em>map</em>count [65530] is too low&quot;，要运行下面的命令。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ <span class="built_in">sudo</span> sysctl -w vm.max_map_count=262144</span><br></pre></td></tr></table></figure>
</blockquote>
<p>如果一切正常，Elastic 就会在默认的9200端口运行。这时，打开另一个命令行窗口，请求该端口，会得到说明信息。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ curl localhost:9200</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span> : <span class="string">&quot;atntrTf&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;elasticsearch&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;tf9250XhQ6ee4h7YI11anA&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;number&quot;</span> : <span class="string">&quot;5.5.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_hash&quot;</span> : <span class="string">&quot;19c13d0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_date&quot;</span> : <span class="string">&quot;2017-07-18T20:44:24.823Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_snapshot&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;lucene_version&quot;</span> : <span class="string">&quot;6.6.0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;tagline&quot;</span> : <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码中，请求9200端口，Elastic 返回一个 JSON 对象，包含当前节点、集群、版本等信息。</p>
<p>按下 Ctrl + C，Elastic 就会停止运行。</p>
<p>默认情况下，Elastic 只允许本机访问，如果需要远程访问，可以修改 Elastic 安装目录的<code>config/elasticsearch.yml</code>文件，去掉<code>network.host</code>的注释，将它的值改成<code>0.0.0.0</code>，然后重新启动 Elastic。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">network.host: 0.0.0.0</span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码中，设成<code>0.0.0.0</code>让任何人都可以访问。线上服务不要这样设置，要设成具体的 IP。</p>
<h2 id="二、基本概念">二、基本概念</h2>
<h3 id="2-1-Node-与-Cluster">2.1 Node 与 Cluster</h3>
<p>Elastic 本质上是一个分布式数据库，允许多台服务器协同工作，每台服务器可以运行多个 Elastic 实例。</p>
<p>单个 Elastic 实例称为一个节点（node）。一组节点构成一个集群（cluster）。</p>
<h3 id="2-2-Index">2.2 Index</h3>
<p>Elastic 会索引所有字段，经过处理后写入一个反向索引（Inverted Index）。查找数据的时候，直接查找该索引。</p>
<p>所以，Elastic 数据管理的顶层单位就叫做 Index（索引）。它是单个数据库的同义词。每个 Index （即数据库）的名字必须是小写。</p>
<p>下面的命令可以查看当前节点的所有 Index。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ curl -X GET <span class="string">&#x27;http://localhost:9200/_cat/indices?v&#x27;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="2-3-Document">2.3 Document</h3>
<p>Index 里面单条的记录称为 Document（文档）。许多条 Document 构成了一个 Index。</p>
<p>Document 使用 JSON 格式表示，下面是一个例子。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;user&quot;</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">  <span class="string">&quot;title&quot;</span>: <span class="string">&quot;工程师&quot;</span>,</span><br><span class="line">  <span class="string">&quot;desc&quot;</span>: <span class="string">&quot;数据库管理&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>同一个 Index 里面的 Document，不要求有相同的结构（scheme），但是最好保持相同，这样有利于提高搜索效率。</p>
<h3 id="2-4-Type">2.4 Type</h3>
<p>Document 可以分组，比如<code>weather</code>这个 Index 里面，可以按城市分组（北京和上海），也可以按气候分组（晴天和雨天）。这种分组就叫做 Type，它是虚拟的逻辑分组，用来过滤 Document。</p>
<p>不同的 Type 应该有相似的结构（schema），举例来说，<code>id</code>字段不能在这个组是字符串，在另一个组是数值。这是与关系型数据库的表的<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/guide/current/mapping.html">一个区别</a>。性质完全不同的数据（比如<code>products</code>和<code>logs</code>）应该存成两个 Index，而不是一个 Index 里面的两个 Type（虽然可以做到）。</p>
<p>下面的命令可以列出每个 Index 所包含的 Type。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ curl <span class="string">&#x27;localhost:9200/_mapping?pretty=true&#x27;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>根据<a target="_blank" rel="noopener" href="https://www.elastic.co/blog/index-type-parent-child-join-now-future-in-elasticsearch">规划</a>，Elastic 6.x 版只允许每个 Index 包含一个 Type，7.x 版将会彻底移除 Type。</p>
<h2 id="三、新建和删除-Index">三、新建和删除 Index</h2>
<p>新建 Index，可以直接向 Elastic 服务器发出 PUT 请求。下面的例子是新建一个名叫<code>weather</code>的 Index。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ curl -X PUT <span class="string">&#x27;localhost:9200/weather&#x27;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>服务器返回一个 JSON 对象，里面的<code>acknowledged</code>字段表示操作成功。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;acknowledged&quot;</span>:<span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;shards_acknowledged&quot;</span>:<span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>然后，我们发出 DELETE 请求，删除这个 Index。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ curl -X DELETE <span class="string">&#x27;localhost:9200/weather&#x27;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="四、中文分词设置">四、中文分词设置</h2>
<p>首先，安装中文分词插件。这里使用的是 <a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik/">ik</a>，也可以考虑其他插件（比如 <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/plugins/current/analysis-smartcn.html">smartcn</a>）。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ ./bin/elasticsearch-plugin install <span class="attr">https</span>:<span class="comment">//github.com/medcl/elasticsearch-analysis-ik/releases/download/v5.5.1/elasticsearch-analysis-ik-5.5.1.zip</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码安装的是5.5.1版的插件，与 Elastic 5.5.1 配合使用。</p>
<p>接着，重新启动 Elastic，就会自动加载这个新安装的插件。</p>
<p>然后，新建一个 Index，指定需要分词的字段。这一步根据数据结构而异，下面的命令只针对本文。基本上，凡是需要搜索的中文字段，都要单独设置一下。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ curl -X PUT <span class="string">&#x27;localhost:9200/accounts&#x27;</span> -d <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;mappings&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;person&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;properties&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;user&quot;: &#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;: &quot;text&quot;,</span></span><br><span class="line"><span class="string">          &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span></span><br><span class="line"><span class="string">          &quot;search_analyzer&quot;: &quot;ik_max_word&quot;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &quot;title&quot;: &#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;: &quot;text&quot;,</span></span><br><span class="line"><span class="string">          &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span></span><br><span class="line"><span class="string">          &quot;search_analyzer&quot;: &quot;ik_max_word&quot;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &quot;desc&quot;: &#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;: &quot;text&quot;,</span></span><br><span class="line"><span class="string">          &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span></span><br><span class="line"><span class="string">          &quot;search_analyzer&quot;: &quot;ik_max_word&quot;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码中，首先新建一个名称为<code>accounts</code>的 Index，里面有一个名称为<code>person</code>的 Type。<code>person</code>有三个字段。</p>
<blockquote>
<ul>
<li>user</li>
<li>title</li>
<li>desc</li>
</ul>
</blockquote>
<p>这三个字段都是中文，而且类型都是文本（text），所以需要指定中文分词器，不能使用默认的英文分词器。</p>
<p>Elastic 的分词器称为 <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis.html">analyzer</a>。我们对每个字段指定分词器。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">&quot;user&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;ik_max_word&quot;</span>,</span><br><span class="line">  <span class="string">&quot;search_analyzer&quot;</span>: <span class="string">&quot;ik_max_word&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码中，<code>analyzer</code>是字段文本的分词器，<code>search_analyzer</code>是搜索词的分词器。<code>ik_max_word</code>分词器是插件<code>ik</code>提供的，可以对文本进行最大数量的分词。</p>
<h2 id="五、数据操作">五、数据操作</h2>
<h3 id="5-1-新增记录">5.1 新增记录</h3>
<p>向指定的 /Index/Type 发送 PUT 请求，就可以在 Index 里面新增一条记录。比如，向<code>/accounts/person</code>发送请求，就可以新增一条人员记录。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ curl -X PUT <span class="string">&#x27;localhost:9200/accounts/person/1&#x27;</span> -d <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;user&quot;: &quot;张三&quot;,</span></span><br><span class="line"><span class="string">  &quot;title&quot;: &quot;工程师&quot;,</span></span><br><span class="line"><span class="string">  &quot;desc&quot;: &quot;数据库管理&quot;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span> </span><br></pre></td></tr></table></figure>
</blockquote>
<p>服务器返回的 JSON 对象，会给出 Index、Type、Id、Version 等信息。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;_index&quot;</span>:<span class="string">&quot;accounts&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_type&quot;</span>:<span class="string">&quot;person&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_version&quot;</span>:<span class="number">1</span>,</span><br><span class="line">  <span class="string">&quot;result&quot;</span>:<span class="string">&quot;created&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_shards&quot;</span>:&#123;<span class="string">&quot;total&quot;</span>:<span class="number">2</span>,<span class="string">&quot;successful&quot;</span>:<span class="number">1</span>,<span class="string">&quot;failed&quot;</span>:<span class="number">0</span>&#125;,</span><br><span class="line">  <span class="string">&quot;created&quot;</span>:<span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>如果你仔细看，会发现请求路径是<code>/accounts/person/1</code>，最后的<code>1</code>是该条记录的 Id。它不一定是数字，任意字符串（比如<code>abc</code>）都可以。</p>
<p>新增记录的时候，也可以不指定 Id，这时要改成 POST 请求。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ curl -X POST <span class="string">&#x27;localhost:9200/accounts/person&#x27;</span> -d <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;user&quot;: &quot;李四&quot;,</span></span><br><span class="line"><span class="string">  &quot;title&quot;: &quot;工程师&quot;,</span></span><br><span class="line"><span class="string">  &quot;desc&quot;: &quot;系统管理&quot;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码中，向<code>/accounts/person</code>发出一个 POST 请求，添加一个记录。这时，服务器返回的 JSON 对象里面，<code>_id</code>字段就是一个随机字符串。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;_index&quot;</span>:<span class="string">&quot;accounts&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_type&quot;</span>:<span class="string">&quot;person&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_id&quot;</span>:<span class="string">&quot;AV3qGfrC6jMbsbXb6k1p&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_version&quot;</span>:<span class="number">1</span>,</span><br><span class="line">  <span class="string">&quot;result&quot;</span>:<span class="string">&quot;created&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_shards&quot;</span>:&#123;<span class="string">&quot;total&quot;</span>:<span class="number">2</span>,<span class="string">&quot;successful&quot;</span>:<span class="number">1</span>,<span class="string">&quot;failed&quot;</span>:<span class="number">0</span>&#125;,</span><br><span class="line">  <span class="string">&quot;created&quot;</span>:<span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>注意，如果没有先创建 Index（这个例子是<code>accounts</code>），直接执行上面的命令，Elastic 也不会报错，而是直接生成指定的 Index。所以，打字的时候要小心，不要写错 Index 的名称。</p>
<h3 id="5-2-查看记录">5.2 查看记录</h3>
<p>向<code>/Index/Type/Id</code>发出 GET 请求，就可以查看这条记录。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ curl <span class="string">&#x27;localhost:9200/accounts/person/1?pretty=true&#x27;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码请求查看<code>/accounts/person/1</code>这条记录，URL 的参数<code>pretty=true</code>表示以易读的格式返回。</p>
<p>返回的数据中，<code>found</code>字段表示查询成功，<code>_source</code>字段返回原始记录。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;accounts&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_type&quot;</span> : <span class="string">&quot;person&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_version&quot;</span> : <span class="number">1</span>,</span><br><span class="line">  <span class="string">&quot;found&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;_source&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;user&quot;</span> : <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">    <span class="string">&quot;title&quot;</span> : <span class="string">&quot;工程师&quot;</span>,</span><br><span class="line">    <span class="string">&quot;desc&quot;</span> : <span class="string">&quot;数据库管理&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>如果 Id 不正确，就查不到数据，<code>found</code>字段就是<code>false</code>。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ curl <span class="string">&#x27;localhost:9200/weather/beijing/abc?pretty=true&#x27;</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;accounts&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_type&quot;</span> : <span class="string">&quot;person&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;abc&quot;</span>,</span><br><span class="line">  <span class="string">&quot;found&quot;</span> : <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="5-3-删除记录">5.3 删除记录</h3>
<p>删除记录就是发出 DELETE 请求。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ curl -X DELETE <span class="string">&#x27;localhost:9200/accounts/person/1&#x27;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>这里先不要删除这条记录，后面还要用到。</p>
<h3 id="5-4-更新记录">5.4 更新记录</h3>
<p>更新记录就是使用 PUT 请求，重新发送一次数据。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ curl -X PUT <span class="string">&#x27;localhost:9200/accounts/person/1&#x27;</span> -d <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    &quot;user&quot; : &quot;张三&quot;,</span></span><br><span class="line"><span class="string">    &quot;title&quot; : &quot;工程师&quot;,</span></span><br><span class="line"><span class="string">    &quot;desc&quot; : &quot;数据库管理，软件开发&quot;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span> </span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;_index&quot;</span>:<span class="string">&quot;accounts&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_type&quot;</span>:<span class="string">&quot;person&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_version&quot;</span>:2,</span><br><span class="line">  <span class="string">&quot;result&quot;</span>:<span class="string">&quot;updated&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_shards&quot;</span>:&#123;<span class="string">&quot;total&quot;</span>:2,<span class="string">&quot;successful&quot;</span>:1,<span class="string">&quot;failed&quot;</span>:0&#125;,</span><br><span class="line">  <span class="string">&quot;created&quot;</span>:<span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码中，我们将原始数据从&quot;数据库管理&quot;改成&quot;数据库管理，软件开发&quot;。 返回结果里面，有几个字段发生了变化。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">&quot;_version&quot;</span> : 2,</span><br><span class="line"><span class="string">&quot;result&quot;</span> : <span class="string">&quot;updated&quot;</span>,</span><br><span class="line"><span class="string">&quot;created&quot;</span> : <span class="literal">false</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>可以看到，记录的 Id 没变，但是版本（version）从<code>1</code>变成<code>2</code>，操作类型（result）从<code>created</code>变成<code>updated</code>，<code>created</code>字段变成<code>false</code>，因为这次不是新建记录。</p>
<h2 id="六、数据查询">六、数据查询</h2>
<h3 id="6-1-返回所有记录">6.1 返回所有记录</h3>
<p>使用 GET 方法，直接请求<code>/Index/Type/_search</code>，就会返回所有记录。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ curl <span class="string">&#x27;localhost:9200/accounts/person/_search&#x27;</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;took&quot;</span>:2,</span><br><span class="line">  <span class="string">&quot;timed_out&quot;</span>:<span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;_shards&quot;</span>:&#123;<span class="string">&quot;total&quot;</span>:5,<span class="string">&quot;successful&quot;</span>:5,<span class="string">&quot;failed&quot;</span>:0&#125;,</span><br><span class="line">  <span class="string">&quot;hits&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span>:2,</span><br><span class="line">    <span class="string">&quot;max_score&quot;</span>:1.0,</span><br><span class="line">    <span class="string">&quot;hits&quot;</span>:[</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;_index&quot;</span>:<span class="string">&quot;accounts&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_type&quot;</span>:<span class="string">&quot;person&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_id&quot;</span>:<span class="string">&quot;AV3qGfrC6jMbsbXb6k1p&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_score&quot;</span>:1.0,</span><br><span class="line">        <span class="string">&quot;_source&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;user&quot;</span>: <span class="string">&quot;李四&quot;</span>,</span><br><span class="line">          <span class="string">&quot;title&quot;</span>: <span class="string">&quot;工程师&quot;</span>,</span><br><span class="line">          <span class="string">&quot;desc&quot;</span>: <span class="string">&quot;系统管理&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;_index&quot;</span>:<span class="string">&quot;accounts&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_type&quot;</span>:<span class="string">&quot;person&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_score&quot;</span>:1.0,</span><br><span class="line">        <span class="string">&quot;_source&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;user&quot;</span> : <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">          <span class="string">&quot;title&quot;</span> : <span class="string">&quot;工程师&quot;</span>,</span><br><span class="line">          <span class="string">&quot;desc&quot;</span> : <span class="string">&quot;数据库管理，软件开发&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码中，返回结果的 <code>took</code>字段表示该操作的耗时（单位为毫秒），<code>timed_out</code>字段表示是否超时，<code>hits</code>字段表示命中的记录，里面子字段的含义如下。</p>
<blockquote>
<ul>
<li><code>total</code>：返回记录数，本例是2条。</li>
<li><code>max_score</code>：最高的匹配程度，本例是<code>1.0</code>。</li>
<li><code>hits</code>：返回的记录组成的数组。</li>
</ul>
</blockquote>
<p>返回的记录中，每条记录都有一个<code>_score</code>字段，表示匹配的程序，默认是按照这个字段降序排列。</p>
<h3 id="6-2-全文搜索">6.2 全文搜索</h3>
<p>Elastic 的查询非常特别，使用自己的<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/5.5/query-dsl.html">查询语法</a>，要求 GET 请求带有数据体。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ curl <span class="string">&#x27;localhost:9200/accounts/person/_search&#x27;</span>  -d <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;query&quot; : &#123; &quot;match&quot; : &#123; &quot;desc&quot; : &quot;软件&quot; &#125;&#125;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码使用 <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/5.5/query-dsl-match-query.html">Match 查询</a>，指定的匹配条件是<code>desc</code>字段里面包含&quot;软件&quot;这个词。返回结果如下。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;took&quot;</span>:<span class="number">3</span>,</span><br><span class="line">  <span class="string">&quot;timed_out&quot;</span>:<span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;_shards&quot;</span>:&#123;<span class="string">&quot;total&quot;</span>:<span class="number">5</span>,<span class="string">&quot;successful&quot;</span>:<span class="number">5</span>,<span class="string">&quot;failed&quot;</span>:<span class="number">0</span>&#125;,</span><br><span class="line">  <span class="string">&quot;hits&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;max_score&quot;</span>:<span class="number">0.28582606</span>,</span><br><span class="line">    <span class="string">&quot;hits&quot;</span>:[</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;_index&quot;</span>:<span class="string">&quot;accounts&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_type&quot;</span>:<span class="string">&quot;person&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_score&quot;</span>:<span class="number">0.28582606</span>,</span><br><span class="line">        <span class="string">&quot;_source&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;user&quot;</span> : <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">          <span class="string">&quot;title&quot;</span> : <span class="string">&quot;工程师&quot;</span>,</span><br><span class="line">          <span class="string">&quot;desc&quot;</span> : <span class="string">&quot;数据库管理，软件开发&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>Elastic 默认一次返回10条结果，可以通过<code>size</code>字段改变这个设置。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ curl <span class="string">&#x27;localhost:9200/accounts/person/_search&#x27;</span>  -d <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;query&quot; : &#123; &quot;match&quot; : &#123; &quot;desc&quot; : &quot;管理&quot; &#125;&#125;,</span></span><br><span class="line"><span class="string">  &quot;size&quot;: 1</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码指定，每次只返回一条结果。</p>
<p>还可以通过<code>from</code>字段，指定位移。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ curl <span class="string">&#x27;localhost:9200/accounts/person/_search&#x27;</span>  -d <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;query&quot; : &#123; &quot;match&quot; : &#123; &quot;desc&quot; : &quot;管理&quot; &#125;&#125;,</span></span><br><span class="line"><span class="string">  &quot;from&quot;: 1,</span></span><br><span class="line"><span class="string">  &quot;size&quot;: 1</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码指定，从位置1开始（默认是从位置0开始），只返回一条结果。</p>
<h3 id="6-3-逻辑运算">6.3 逻辑运算</h3>
<p>如果有多个搜索关键字， Elastic 认为它们是<code>or</code>关系。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ curl <span class="string">&#x27;localhost:9200/accounts/person/_search&#x27;</span>  -d <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;query&quot; : &#123; &quot;match&quot; : &#123; &quot;desc&quot; : &quot;软件 系统&quot; &#125;&#125;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码搜索的是<code>软件 or 系统</code>。</p>
<p>如果要执行多个关键词的<code>and</code>搜索，必须使用<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/5.5/query-dsl-bool-query.html">布尔查询</a>。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ curl <span class="string">&#x27;localhost:9200/accounts/person/_search&#x27;</span>  -d <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;query&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;bool&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;must&quot;: [</span></span><br><span class="line"><span class="string">        &#123; &quot;match&quot;: &#123; &quot;desc&quot;: &quot;软件&quot; &#125; &#125;,</span></span><br><span class="line"><span class="string">        &#123; &quot;match&quot;: &#123; &quot;desc&quot;: &quot;系统&quot; &#125; &#125;</span></span><br><span class="line"><span class="string">      ]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="七、参考链接">七、参考链接</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started.html">ElasticSearch 官方手册</a></li>
<li><a target="_blank" rel="noopener" href="https://www.elastic.co/blog/a-practical-introduction-to-elasticsearch">A Practical Introduction to Elasticsearch</a></li>
</ul>
<p>（完）</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../2022/10/27/%E5%85%A8%E6%96%87%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E-Elasticsearch-%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../2021/01/12/VPC/"
                            aria-label=": VPC"
                        >
                            VPC
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-01-12T23:15:39+08:00">
	
		    2021 年 1 月 12 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="">后端</a>, <a class="category-link" href="AWS/">AWS</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <ol>
<li>
<p>Security Group(SG):</p>
<ol>
<li>所有设定默认是拒绝，只可以设定许可规则，拒否ルールは指定できません。</li>
<li>特征是不单可以指定CIDR等IP,还可以指定SG</li>
<li>安全组是有状态的 — 如果您从实例发送一个请求，则无论入站安全组规则如何，都将允许该请求的响应流量流入。如果是为响应已允许的入站流量，则该响应可以出站，此时可忽略出站规则。セキュリティグループはステートフルです。</li>
</ol>
</li>
<li>
<p>Access Control List(ACL):</p>
<ol>
<li>VPC 自动带有可修改的默认网络 ACL。默认情况下，它允许所有入站和出站 IPv4 流量以及 IPv6 流量 (如果适用)。</li>
<li>可以创建自定义网络 ACL 并将其与子网相关联。默认情况下，每个自定义网络 ACL 都拒绝所有入站和出站流量，直至您添加规则。</li>
<li>VPC 中的每个子网都必须与一个网络 ACL 相关联。如果您没有明确地将子网与网络 ACL 相关联，则子网将自动与默认网络 ACL 关联。</li>
<li>可以将网络 ACL 与多个子网关联。但是，一个子网一次只能与一个网络 ACL 关联。当您将一个网络 ACL 与一个子网关联时，将删除之前的关联。</li>
<li>网络 ACL 包含规则的编号列表。我们按顺序评估（从编号最小的规则开始）规则，以判断是否允许流量进入或离开任何与网络 ACL 关联的子网。您可以使用的最高规则编号为 32766。我们建议您开始先以增量方式创建规则（例如，以 10 或 100 的增量增加），这样您可以在稍后需要时插入新的规则。</li>
<li>网络 ACL 有单独的入站和出站规则，每项规则都或是允许或是拒绝数据流。</li>
<li>网络 ACL 没有任何状态，这意味着对允许入站数据流的响应会随着出站数据流规则的变化而改变（反之亦然）。(ネットワーク ACL はステートレスです。許可されているインバウンドトラフィックに対する応答は、アウトバウンドトラフィックのルールに従います（その逆の場合も同様です）。)</li>
<li>ルール番号。ルールは、最も低い番号のルールから評価されます。ルールがトラフィックに一致すると、それと相反するより高い数値のルールの有無にかかわらず、すぐに適用されます。</li>
<li>タイプ。トラフィックのタイプ（SSH など）。また、すべてのトラフィックまたはカスタム範囲を指定することもできます。</li>
</ol>
</li>
</ol>
<p>セキュリティグループはステートフルです。（レスポンスでも明示する必要なしで許可。）<br>
ACLはステートレスです。（レスポンスでも明示する必要ある。）</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../2021/01/12/VPC/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../2020/11/17/linux/17-%E7%B3%BB%E7%BB%9F%E7%BB%B4%E6%8A%A4/"
                            aria-label=": 17.系统维护"
                        >
                            17.系统维护
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-11-17T14:01:48+08:00">
	
		    2020 年 11 月 17 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="">后端</a>, <a class="category-link" href="linux/">linux</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1>从源代码安装软件笔记整理</h1>
<h2 id="1-安装C语言开源软件的三个主要步骤">1. 安装C语言开源软件的三个主要步骤</h2>
<ol>
<li>解压源代码</li>
<li>编译成二进制文件</li>
<li>将二进制文件安装到适当的文件夹</li>
</ol>
<h2 id="2-解压源代码">2. 解压源代码</h2>
<h3 id="常用解压命令">常用解压命令</h3>
<table>
<thead>
<tr>
<th>命令格式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>gunzip [文件名]</code></td>
<td>解压.gz文件</td>
</tr>
<tr>
<td><code>gzip [option] [文件名]</code></td>
<td>压缩/解压文件</td>
</tr>
<tr>
<td><code>bunzip [文件名]</code></td>
<td>解压.bz2文件</td>
</tr>
<tr>
<td><code>bzip [option] [文件名]</code></td>
<td>压缩/解压文件</td>
</tr>
</tbody>
</table>
<h3 id="gzip-bzip-选项说明">gzip/bzip 选项说明</h3>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-d</code></td>
<td>解压压缩文件</td>
</tr>
<tr>
<td><code>-c</code></td>
<td>解压压缩文件到标准输出</td>
</tr>
</tbody>
</table>
<h2 id="3-patch命令">3. patch命令</h2>
<p>用于应用补丁文件</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-d 文件夹</code></td>
<td>移动到指定文件夹后处理</td>
</tr>
<tr>
<td><code>-p</code></td>
<td>修正patch文件内的path: <br><code>-p0</code>: 不修正path <br><code>-p1</code>: 删除最初的’/’ <br><code>-p2</code>: 删除下一级文件夹</td>
</tr>
<tr>
<td><code>patch</code></td>
<td>应用补丁</td>
</tr>
<tr>
<td><code>-C</code></td>
<td>测试(不实际应用补丁)</td>
</tr>
<tr>
<td><code>-R</code></td>
<td>取消补丁，恢复到补丁前状态</td>
</tr>
</tbody>
</table>
<h2 id="4-生成Makefile">4. 生成Makefile</h2>
<p>运行config脚本根据环境配置config文件:</p>
<h3 id="config脚本主要选项">config脚本主要选项</h3>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--help</code></td>
<td>显示帮助说明</td>
</tr>
<tr>
<td><code>--prefix=文件夹</code></td>
<td>指定安装目标的top路径</td>
</tr>
</tbody>
</table>
<h2 id="5-编译和安装">5. 编译和安装</h2>
<h3 id="make命令">make命令</h3>
<p>根据当前文件夹内的Makefile编译源代码</p>
<p>基本格式：</p>
<pre><code class="language-bash">make [option] [目标]</code></pre>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../2020/11/17/linux/17-%E7%B3%BB%E7%BB%9F%E7%BB%B4%E6%8A%A4/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../2020/11/16/linux/16-%E7%BD%91%E7%BB%9C/"
                            aria-label=": 16.网络"
                        >
                            16.网络
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-11-16T14:01:40+08:00">
	
		    2020 年 11 月 16 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="">后端</a>, <a class="category-link" href="linux/">linux</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="1-网络设备管理">1. 网络设备管理</h2>
<h3 id="1-1-网络接口命名规则">1.1 网络接口命名规则</h3>
<table>
<thead>
<tr>
<th>接口名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>eth0</code></td>
<td>第一个 Ethernet 接口</td>
</tr>
<tr>
<td><code>eth1</code></td>
<td>第二个 Ethernet 接口</td>
</tr>
<tr>
<td><code>ppp0</code></td>
<td>第一个 PPP 接口</td>
</tr>
<tr>
<td><code>lo</code></td>
<td>Loopback 接口</td>
</tr>
</tbody>
</table>
<h3 id="1-2-网络设备识别命令">1.2 网络设备识别命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dmesg | grep eth  <span class="comment"># 查看内核识别的网络设备</span></span><br></pre></td></tr></table></figure>
<h3 id="1-3-网络接口配置命令">1.3 网络接口配置命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig [-a] [IF名] [参数]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-a</code></td>
<td>显示所有接口</td>
</tr>
<tr>
<td><code>IF名</code></td>
<td>指定接口名称</td>
</tr>
<tr>
<td><code>IP地址</code></td>
<td>设置 IP 地址</td>
</tr>
<tr>
<td><code>netmask</code></td>
<td>设置子网掩码</td>
</tr>
<tr>
<td><code>up</code></td>
<td>激活接口（等价于 <code>ifup</code>）</td>
</tr>
<tr>
<td><code>down</code></td>
<td>停止接口（等价于 <code>ifdown</code>）</td>
</tr>
</tbody>
</table>
<p><strong>示例</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig eth0 192.168.120.27 netmask 255.255.255.0 up</span><br></pre></td></tr></table></figure>
<h3 id="1-4-NIC-组合与虚拟网络接口">1.4 NIC 组合与虚拟网络接口</h3>
<ul>
<li><strong>NIC 组合</strong>：允许将多个物理以太网适配器分组为虚拟网络适配器，提高性能和容错能力。</li>
<li><strong>MAC 地址设置</strong>：在 “交换机独立” 模式下，团队会将 MAC 地址设置为出站流量。</li>
<li><strong>IP 别名</strong>：在同一个网卡上分配不同 IP 地址。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig eth0:0 192.168.0.1 netmask 255.255.255.0 up</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="2-ARP-协议管理">2. ARP 协议管理</h2>
<h3 id="2-1-ARP-协议简介">2.1 ARP 协议简介</h3>
<p>ARP (Address Resolution Protocol) 用于将 IP 地址解析为 MAC 地址。</p>
<h3 id="2-2-ARP-命令">2.2 ARP 命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arp [option]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-a [host]</code></td>
<td>显示指定主机或全部 ARP 表</td>
</tr>
<tr>
<td><code>-f 文件名</code></td>
<td>从文件读取主机:MAC 对应表</td>
</tr>
<tr>
<td><code>-n</code></td>
<td>显示 IP 地址而非主机名</td>
</tr>
<tr>
<td><code>-d [host]</code></td>
<td>删除指定主机的 ARP 记录</td>
</tr>
<tr>
<td><code>-i [IF名]</code></td>
<td>指定接口</td>
</tr>
<tr>
<td><code>-s [host] [MAC地址]</code></td>
<td>添加主机和 MAC 地址的对应关系</td>
</tr>
</tbody>
</table>
<p><strong>示例</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arp -s h001.example.com 00:01:02:03:04:05</span><br></pre></td></tr></table></figure>
<h3 id="2-3-ARP-监视工具">2.3 ARP 监视工具</h3>
<ul>
<li><code>arpwatch</code>：监视网络中的 ARP 活动。</li>
</ul>
<h2 id="3-网络管理命令">3. 网络管理命令</h2>
<h3 id="3-1-Ping-命令">3.1 Ping 命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping [host名或IP] [option]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-n</code></td>
<td>不解析主机名，显示 IP 地址</td>
</tr>
<tr>
<td><code>-c 次数</code></td>
<td>发送指定次数的 ICMP 包</td>
</tr>
<tr>
<td><code>-i 间隔</code></td>
<td>按指定间隔发送 ICMP 包</td>
</tr>
</tbody>
</table>
<p><strong>示例</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping -c 4 192.168.1.1</span><br></pre></td></tr></table></figure>
<h3 id="3-2-Traceroute-命令">3.2 Traceroute 命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">traceroute [option] [host名或IP]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-i [IF]</code></td>
<td>指定接口</td>
</tr>
<tr>
<td><code>-n</code></td>
<td>显示 IP 地址而非主机名</td>
</tr>
</tbody>
</table>
<h3 id="3-3-Tcpdump-命令">3.3 Tcpdump 命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump [option] [条件式]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-i IF名</code></td>
<td>指定监视的接口</td>
</tr>
<tr>
<td><code>-s 比特数</code></td>
<td>指定从包中提取的比特数</td>
</tr>
<tr>
<td><code>-X</code></td>
<td>显示十六进制和 ASCII 文本</td>
</tr>
<tr>
<td><code>-n</code></td>
<td>不解析 ARP 地址</td>
</tr>
<tr>
<td><code>-l</code></td>
<td>缓存标准输出</td>
</tr>
<tr>
<td><code>-t</code></td>
<td>不显示时间</td>
</tr>
<tr>
<td><code>-v</code></td>
<td>显示详细信息</td>
</tr>
</tbody>
</table>
<p><strong>条件式</strong>:</p>
<ul>
<li><code>port</code>：指定端口</li>
</ul>
<p><strong>示例</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -nli eth0 port 53</span><br></pre></td></tr></table></figure>
<h3 id="3-4-Wireshark">3.4 Wireshark</h3>
<ul>
<li>图形化网络监视工具。</li>
</ul>
<h3 id="3-5-Netstat-命令">3.5 Netstat 命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat [option]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-a</code></td>
<td>显示所有 socket</td>
</tr>
<tr>
<td><code>-c</code></td>
<td>每秒刷新</td>
</tr>
<tr>
<td><code>-i</code></td>
<td>显示接口状态</td>
</tr>
<tr>
<td><code>-l</code></td>
<td>只显示监听状态的端口</td>
</tr>
<tr>
<td><code>-n</code></td>
<td>显示地址和端口</td>
</tr>
<tr>
<td><code>-p</code></td>
<td>显示 PID 和进程</td>
</tr>
<tr>
<td><code>-r</code></td>
<td>显示路由表</td>
</tr>
<tr>
<td><code>-t</code></td>
<td>显示 TCP 连接</td>
</tr>
<tr>
<td><code>-u</code></td>
<td>显示 UDP 连接</td>
</tr>
</tbody>
</table>
<h3 id="3-6-IP-命令">3.6 IP 命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip [option] 操作对象 [命令] [设备]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-s</code></td>
<td>显示状态</td>
</tr>
<tr>
<td><code>-r</code></td>
<td>解析名称</td>
</tr>
</tbody>
</table>
<p><strong>操作对象</strong>:</p>
<ul>
<li><code>link</code>：接口详细信息</li>
<li><code>addr</code>：IP 地址</li>
<li><code>route</code>：路由表</li>
<li><code>neigh</code>：ARP 缓存</li>
</ul>
<p><strong>命令</strong>:</p>
<ul>
<li><code>show</code>：显示指定对象</li>
<li><code>add</code>：设置指定对象的参数</li>
</ul>
<p><strong>示例</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip <span class="built_in">link</span> show eth0</span><br></pre></td></tr></table></figure>
<h2 id="4-路由设置">4. 路由设置</h2>
<h3 id="4-1-Route-命令">4.1 Route 命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route [option]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-n</code></td>
<td>不解析主机名</td>
</tr>
<tr>
<td><code>-F</code></td>
<td>显示内核路由表</td>
</tr>
<tr>
<td><code>-C</code></td>
<td>显示内核路由缓存</td>
</tr>
</tbody>
</table>
<p><strong>路由表项目</strong>:</p>
<ul>
<li><code>Destination</code>：目标网络或主机</li>
<li><code>Gateway</code>：网关</li>
<li><code>Genmask</code>：目标子网掩码</li>
<li><code>Flags</code>：路由状态（U:有效, H:目标主机, G:使用网关, !:无效）</li>
<li><code>Metric</code>：到达目标的距离</li>
<li><code>Ref</code>：路由引用数</li>
<li><code>Use</code>：路径引用次数</li>
<li><code>Iface</code>：使用的接口</li>
</ul>
<p><strong>示例</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">route add -net 192.168.100.0 netmask 255.255.255.0 gw 172.16.0.1</span><br><span class="line">route add default gw 192.168.0.50</span><br><span class="line">route del -net 192.168.100.0 netmask 255.255.255.0 gw 172.16.0.1</span><br></pre></td></tr></table></figure>
<h2 id="5-无线网络设置">5. 无线网络设置</h2>
<h3 id="5-1-无线规格与安全标准">5.1 无线规格与安全标准</h3>
<table>
<thead>
<tr>
<th>规格</th>
<th>频率</th>
<th>传送速度</th>
</tr>
</thead>
<tbody>
<tr>
<td>IEEE 802.11a</td>
<td>5.2GHz</td>
<td>54Mbps</td>
</tr>
<tr>
<td>IEEE 802.11b</td>
<td>2.4GHz</td>
<td>11Mbps</td>
</tr>
<tr>
<td>IEEE 802.11g</td>
<td>2.4GHz</td>
<td>54Mbps</td>
</tr>
<tr>
<td>IEEE 802.11n</td>
<td>2.4GHz/5GHz</td>
<td>600Mbps</td>
</tr>
<tr>
<td>IEEE 802.11ac</td>
<td>5GHz</td>
<td>433Mbps~7Gbps</td>
</tr>
</tbody>
</table>
<p><strong>安全标准</strong>:</p>
<ul>
<li><strong>WEP</strong>：使用 RC4 算法，存在漏洞。</li>
<li><strong>WPA</strong>：多种加密技术（TKIP, AES），用户认证由 IEEE 802.1x 等实现。WPA-AES 比 WPA-TKIP 更安全。</li>
</ul>
<h3 id="5-2-无线接口状态确认">5.2 无线接口状态确认</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iwconfig [wlanN] [essid ESSID] [key [s:]WEP key]</span><br></pre></td></tr></table></figure>
<p><strong>示例</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iwconfig wlan0 essid <span class="string">&quot;windsor&quot;</span></span><br><span class="line">iwconfig wlan0 key s:abc12345</span><br></pre></td></tr></table></figure>
<h3 id="5-3-获取无线接口信息">5.3 获取无线接口信息</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iwlist [无线IF] [参数]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>scanning [essid ID]</code></td>
<td>显示可接入的热点列表</td>
</tr>
<tr>
<td><code>channel</code></td>
<td>显示可设置的频道</td>
</tr>
<tr>
<td><code>rate</code></td>
<td>显示传送速度</td>
</tr>
</tbody>
</table>
<h2 id="6-高级网络设置">6. 高级网络设置</h2>
<h3 id="6-1-网络相关文件">6.1 网络相关文件</h3>
<table>
<thead>
<tr>
<th>文件</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/etc/hostname</code></td>
<td>记录主机名</td>
</tr>
<tr>
<td><code>/etc/hosts</code></td>
<td>记录主机名、别名和 IP 的对应关系</td>
</tr>
<tr>
<td><code>/etc/networks</code></td>
<td>记录网络和 IP 的对应关系</td>
</tr>
<tr>
<td><code>/etc/nsswitch.conf</code></td>
<td>规定信息查找顺序</td>
</tr>
<tr>
<td><code>/etc/resolv.conf</code></td>
<td>记录 DNS 服务器和域名</td>
</tr>
<tr>
<td><code>/etc/sysconfig/network</code></td>
<td>网络功能、主机名、默认网关等设置</td>
</tr>
<tr>
<td><code>/etc/sysconfig/network-scripts/</code></td>
<td>存放网络接口设置文件</td>
</tr>
<tr>
<td><code>/etc/network/interfaces</code></td>
<td>Debian 系统的网络接口设置文件</td>
</tr>
</tbody>
</table>
<h3 id="6-2-配置文件示例">6.2 配置文件示例</h3>
<p><strong>/etc/sysconfig/network-scripts/ifcfg-eth0</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DEVICE=eth0</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">IPADDR=192.168.0.6</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">NETWORK=192.168.0.0</span><br><span class="line">BROADCAST=192.168.0.255</span><br><span class="line">ONBOOT=<span class="built_in">yes</span></span><br></pre></td></tr></table></figure>
<p><strong>/etc/network/interfaces (Debian)</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line">allow-hotplug eth0</span><br><span class="line">iface eth0 inet static </span><br><span class="line">    address 192.168.0.6</span><br><span class="line">    netmask 255.255.255.0</span><br><span class="line">    gateway 192.168.0.1</span><br><span class="line">    dns-domain example.com</span><br><span class="line">    dns-nameservers 192.168.1.1</span><br></pre></td></tr></table></figure>
<h2 id="7-网络问题排查">7. 网络问题排查</h2>
<h3 id="7-1-排查步骤">7.1 排查步骤</h3>
<ol>
<li>
<p><strong>Ping 测试</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping 172.16.0.1</span><br><span class="line">ping h001.s16.la.net</span><br></pre></td></tr></table></figure>
<ul>
<li>如果 IP 能 Ping 通，但主机名失败，可能是 DNS 问题，检查 <code>/etc/resolv.conf</code>。</li>
</ul>
</li>
<li>
<p><strong>局域网连通但无法访问互联网</strong>：</p>
<ul>
<li>检查默认网关或路由表：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route</span><br></pre></td></tr></table></figure>
</li>
<li>如果没有默认路由，添加默认网关：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route add default gw 172.16.0.1</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p><strong>网络连接不通</strong>：</p>
<ul>
<li>使用 <code>traceroute</code> 或 <code>tracepath</code> 查看路径：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">traceroute www.lpi.jp</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p><strong>网络接口问题</strong>：</p>
<ul>
<li>检查网卡状态：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br></pre></td></tr></table></figure>
</li>
<li>如果只显示 <code>lo</code>，启动接口：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ifup eth0</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">ifconfig eth0 up</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h3 id="7-2-需要确认的配置文件">7.2 需要确认的配置文件</h3>
<table>
<thead>
<tr>
<th>文件</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/etc/resolv.conf</code></td>
<td>DNS 服务器设置</td>
</tr>
<tr>
<td><code>/etc/sysconfig/network-scripts/*</code></td>
<td>网络接口设置（RHEL/CentOS）</td>
</tr>
<tr>
<td><code>/etc/network/interfaces</code></td>
<td>网络接口设置（Debian）</td>
</tr>
<tr>
<td><code>/etc/hosts.allow</code>, <code>/etc/hosts.deny</code></td>
<td>连接控制</td>
</tr>
</tbody>
</table>
<hr>
<p><strong>补充说明</strong>：</p>
<ul>
<li><strong>IP 别名</strong>：允许在同一个网卡上分配多个 IP 地址，常用于服务器提供多种服务。</li>
<li><strong>ARP 缓存</strong>：存储 IP 地址与 MAC 地址的映射关系，可通过 <code>arp -d</code> 手动清除缓存。</li>
<li><strong>无线安全</strong>：建议使用 WPA2 或 WPA3 加密方式，避免使用不安全的 WEP。</li>
<li><strong>路由表</strong>：理解目标网络、网关、子网掩码和接口的关系，确保数据包正确转发。</li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../2020/11/16/linux/16-%E7%BD%91%E7%BB%9C/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../2020/11/15/linux/15-%E9%AB%98%E5%BA%A6%E7%9A%84%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/"
                            aria-label=": 15.高度的存储管理"
                        >
                            15.高度的存储管理
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-11-15T14:01:30+08:00">
	
		    2020 年 11 月 15 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="">后端</a>, <a class="category-link" href="linux/">linux</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1>1. RAID (冗余磁盘阵列)</h1>
<p>RAID（Redundant Arrays of Inexpensive Disks）是一种将多个硬盘组合以提高性能或数据冗余的技术。</p>
<h2 id="Linux-上的-RAID">Linux 上的 RAID</h2>
<p>在 Linux 上应用 RAID，有软件 RAID 和硬件 RAID 之分。通常，硬件 RAID 会被视作 SCSI 设备。</p>
<h2 id="RAID-各个等级：">RAID 各个等级：</h2>
<ul>
<li>
<p><strong>RAID 0 (条带化)</strong></p>
<ul>
<li>多个硬盘组合成一个大磁盘，没有备份，提供较好的性能但没有容灾能力。</li>
<li>示例：三台 100GB 硬盘组成一个 300GB 的 RAID 0。</li>
</ul>
</li>
<li>
<p><strong>RAID 1 (镜像)</strong></p>
<ul>
<li>多台硬盘写入相同数据，提供冗余备份。</li>
<li>示例：三个 100GB 硬盘组成一个 100GB 的 RAID 1。</li>
</ul>
</li>
<li>
<p><strong>RAID 4</strong></p>
<ul>
<li>至少需要 3 台硬盘，其中一台用作备份分区。性能瓶颈在于备份分区。</li>
<li>示例：三个 100GB 硬盘组成一个 200GB 的 RAID 4。</li>
</ul>
</li>
<li>
<p><strong>RAID 5</strong></p>
<ul>
<li>使用分布式备份技术，性能较 RAID 4 好，且不需要专门的备份硬盘。</li>
<li>示例：三个 100GB 硬盘组成一个 200GB 的 RAID 5。</li>
</ul>
</li>
<li>
<p><strong>其他 RAID 等级：</strong></p>
<ul>
<li><strong>RAID LINEAR</strong>：类似 RAID 0。</li>
<li><strong>RAID 0+1 (RAID01)</strong>：RAID 0 组成的 RAID 1。</li>
<li><strong>RAID 10 (RAID+0)</strong>：RAID 1 组成的 RAID 0。</li>
<li><strong>RAID 6</strong>：比 RAID 5 多一台备份区。</li>
</ul>
</li>
</ul>
<h2 id="mdadm-命令控制-RAID-阵列"><code>mdadm</code> 命令控制 RAID 阵列</h2>
<p><code>mdadm [option] [设备名]</code></p>
<h3 id="常用选项：">常用选项：</h3>
<table>
<thead>
<tr>
<th>选项</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-C</code>, <code>--create</code></td>
<td>创建 RAID 阵列并生成相关设备</td>
</tr>
<tr>
<td><code>-a</code></td>
<td>自动生成必要的设备文件</td>
</tr>
<tr>
<td><code>-c</code></td>
<td>指定 Chunk 大小</td>
</tr>
<tr>
<td><code>-l</code>, <code>--level</code></td>
<td>指定 RAID 级别</td>
</tr>
<tr>
<td><code>-n</code>, <code>--raid-devices</code></td>
<td>指定 RAID 阵列中的设备数量</td>
</tr>
<tr>
<td><code>-x</code>, <code>--spare-devices</code></td>
<td>指定备用设备数量</td>
</tr>
<tr>
<td><code>--manage</code></td>
<td>管理 RAID 阵列</td>
</tr>
<tr>
<td><code>-a</code>, <code>--add</code></td>
<td>添加设备</td>
</tr>
<tr>
<td><code>-r</code>, <code>--remove</code></td>
<td>删除设备</td>
</tr>
<tr>
<td><code>-f</code>, <code>--fail</code></td>
<td>标记设备为失效</td>
</tr>
<tr>
<td><code>--query</code></td>
<td>查询 RAID 状态</td>
</tr>
<tr>
<td><code>--detail</code></td>
<td>查看 RAID 详细状态</td>
</tr>
<tr>
<td><code>--stop</code></td>
<td>停止指定的 RAID 阵列</td>
</tr>
<tr>
<td><code>--stop --scan</code></td>
<td>停止所有 RAID 阵列</td>
</tr>
</tbody>
</table>
<hr>
<h1>2. LVM (逻辑卷管理)</h1>
<p>LVM 是 Linux 下的一种磁盘管理工具，可以灵活地管理硬盘、分区和逻辑卷。</p>
<h3 id="LVM-结构：">LVM 结构：</h3>
<ol>
<li><strong>PV (Physical Volume)</strong>：一个硬盘或一个分区作为物理空间。</li>
<li><strong>PE (Physical Extent)</strong>：PV 组成 PE。</li>
<li><strong>VG (Volume Group)</strong>：PE 组成 VG。</li>
<li><strong>LV (Logical Volume)</strong>：VG 内的 PE 分配为 LV。</li>
</ol>
<h3 id="创建-LVM：">创建 LVM：</h3>
<ol>
<li>
<p>准备 LVM 用的分区：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fdisk /dev/sda</span><br><span class="line">fdisk /dev/sdb</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>初始化 PV：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pvcreate /dev/sda1 /dev/sdb1</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>创建 VG：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vgcreate testvg /dev/sda1 /dev/sdb1</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>创建 LV：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lvcreate -L 1G -n lv01 testvg</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>创建文件系统并挂载：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mke2fs -j /dev/testvg/lv01</span><br><span class="line">mount /dev/testvg/lv01 /mnt</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="管理-LVM：">管理 LVM：</h3>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>pvdisplay</code></td>
<td>显示物理 PV 信息</td>
</tr>
<tr>
<td><code>pvscan</code></td>
<td>显示 PV 状态</td>
</tr>
<tr>
<td><code>pvmove</code></td>
<td>移动 PV 中的 PE</td>
</tr>
<tr>
<td><code>pvremove</code></td>
<td>删除 PV</td>
</tr>
<tr>
<td><code>vgextend</code></td>
<td>扩展 VG</td>
</tr>
<tr>
<td><code>vgreduce</code></td>
<td>缩小 VG</td>
</tr>
<tr>
<td><code>vgdisplay</code></td>
<td>显示 VG 详情</td>
</tr>
<tr>
<td><code>lvdisplay</code></td>
<td>显示 LV 详情</td>
</tr>
<tr>
<td><code>lvextend</code></td>
<td>扩展 LV</td>
</tr>
<tr>
<td><code>lvreduce</code></td>
<td>缩小 LV</td>
</tr>
<tr>
<td><code>lvremove</code></td>
<td>删除 LV</td>
</tr>
<tr>
<td><code>lvcreate -s</code></td>
<td>创建快照</td>
</tr>
</tbody>
</table>
<hr>
<h1>3. 访问记忆装置</h1>
<h3 id="设备文件说明：">设备文件说明：</h3>
<table>
<thead>
<tr>
<th>设备文件</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/dev/hda</code></td>
<td>IDE 主硬盘</td>
</tr>
<tr>
<td><code>/dev/hdb</code></td>
<td>IDE 从硬盘</td>
</tr>
<tr>
<td><code>/dev/sda</code></td>
<td>第一个 SCSI/STAT/USB 硬盘</td>
</tr>
<tr>
<td><code>/dev/sdb</code></td>
<td>第二个 SCSI/STAT/USB 硬盘</td>
</tr>
<tr>
<td><code>/dev/sr0</code></td>
<td>第一个 SCSI/STAT/USB CD/DVD</td>
</tr>
<tr>
<td><code>/dev/st0</code></td>
<td>第一个 SCSI 磁带设备</td>
</tr>
</tbody>
</table>
<h3 id="硬盘管理：">硬盘管理：</h3>
<p>Linux 将 IDE 以外的硬盘识别为 SCSI 设备。硬盘的数据传送模式有 PIO（Programmed I/O）和 DMA（Direct Memory Access）模式。通常使用 DMA 模式。</p>
<h3 id="检查-DMA-模式：">检查 DMA 模式：</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdparm -i /dev/sda</span><br></pre></td></tr></table></figure>
<h3 id="硬盘控制：">硬盘控制：</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdparm -d1 /dev/sda  <span class="comment"># 启用 DMA 模式</span></span><br></pre></td></tr></table></figure>
<h3 id="使用-SCSI-STAT-USB：">使用 SCSI/STAT/USB：</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sdparm [option] [设备文件]</span><br></pre></td></tr></table></figure>
<hr>
<h1>4. iSCSI (Internet Small Computer System Interface)</h1>
<p>iSCSI 是基于 TCP/IP 的 SCSI 协议，可以使远程存储设备像本地设备一样使用。</p>
<h2 id="iSCSI-配置步骤：">iSCSI 配置步骤：</h2>
<ol>
<li>
<p>配置 <code>targets.conf</code> 文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">target</span> <span class="attr">iqn.2014.01.com.example.lpic:target0</span>&gt;</span></span><br><span class="line">   backing-store /dev/sdb2</span><br><span class="line">   initiator-address 192.168.11.2</span><br><span class="line">   initiator-address 192.168.11.4</span><br><span class="line">   incominguser centuser password</span><br><span class="line"><span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>启动 iSCSI target 服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service tgtd start</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>使用 <code>tgtadm</code> 命令查看 target 状态：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tgtadm --mode target --op show</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>使用 <code>iscsiadm</code> 从 initiator 查询 target：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iscsiadm -m discovery -t sendtargets -p 192.168.11.3</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>配置认证方式：<br>
修改 <code>/etc/iscsi/iscid.conf</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node.session.auth.authmethod = CHAP</span><br><span class="line">node.session.auth.username = centuser</span><br><span class="line">node.session.auth.password = password</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>登录 iSCSI：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iscsiadm -m node --login</span><br></pre></td></tr></table></figure>
<p>登录后，使用 <code>cat /proc/partitions</code> 查看 iSCSI 目标是否添加成功。</p>
</li>
</ol>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../2020/11/15/linux/15-%E9%AB%98%E5%BA%A6%E7%9A%84%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../2020/11/14/linux/14-%E8%AE%BE%E5%A4%87%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"
                            aria-label=": 14.设备和文件系统"
                        >
                            14.设备和文件系统
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-11-14T14:01:10+08:00">
	
		    2020 年 11 月 14 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="">后端</a>, <a class="category-link" href="linux/">linux</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="1-文件系统基础">1. 文件系统基础</h2>
<h3 id="etc-fstab-文件格式解析">/etc/fstab 文件格式解析</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">设备/标签/UUID  挂载点  文件系统类型  挂载选项  dump标志  fsck顺序</span><br></pre></td></tr></table></figure>
<p><strong>字段说明：</strong></p>
<table>
<thead>
<tr>
<th>字段</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>设备标识</td>
<td>/dev/sda1, UUID=xxxx, LABEL=root</td>
</tr>
<tr>
<td>2</td>
<td>挂载路径</td>
<td>/, /home, /boot</td>
</tr>
<tr>
<td>3</td>
<td>文件系统类型</td>
<td>ext4, xfs, nfs</td>
</tr>
<tr>
<td>4</td>
<td>挂载选项</td>
<td>defaults, noatime</td>
</tr>
<tr>
<td>5</td>
<td>dump备份标志</td>
<td>0(不备份), 1(备份)</td>
</tr>
<tr>
<td>6</td>
<td>fsck检查顺序</td>
<td>0(不检查), 1(优先), 2(次级)</td>
</tr>
</tbody>
</table>
<h3 id="文件系统类型对比">文件系统类型对比</h3>
<table>
<thead>
<tr>
<th>类型</th>
<th>特点</th>
<th>适用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td>ext4</td>
<td>日志式, 最大16TB文件</td>
<td>通用Linux系统</td>
</tr>
<tr>
<td>XFS</td>
<td>高性能, 最大8EB文件</td>
<td>大文件处理</td>
</tr>
<tr>
<td>Btrfs</td>
<td>写时复制, 快照功能</td>
<td>高级存储需求</td>
</tr>
<tr>
<td>FAT32</td>
<td>兼容性好</td>
<td>U盘/移动设备</td>
</tr>
<tr>
<td>NTFS</td>
<td>Windows兼容</td>
<td>双系统共享分区</td>
</tr>
</tbody>
</table>
<h3 id="常用挂载选项">常用挂载选项</h3>
<table>
<thead>
<tr>
<th>选项</th>
<th>作用</th>
<th>性能影响</th>
</tr>
</thead>
<tbody>
<tr>
<td>async</td>
<td>异步写入</td>
<td>提升性能</td>
</tr>
<tr>
<td>noatime</td>
<td>不更新访问时间</td>
<td>显著提升</td>
</tr>
<tr>
<td>nodiratime</td>
<td>不更新目录访问时间</td>
<td>小幅提升</td>
</tr>
<tr>
<td>discard</td>
<td>TRIM支持(SSD)</td>
<td>延长SSD寿命</td>
</tr>
<tr>
<td>data=writeback</td>
<td>ext4日志模式</td>
<td>性能最佳</td>
</tr>
</tbody>
</table>
<p><strong>查看支持的文件系统：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/filesystems</span><br></pre></td></tr></table></figure>
<p><strong>查看已挂载文件系统：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/mtab   <span class="comment"># 或</span></span><br><span class="line"><span class="built_in">cat</span> /proc/mounts</span><br></pre></td></tr></table></figure>
<h2 id="2-挂载管理命令">2. 挂载管理命令</h2>
<h3 id="mount-命令详解">mount 命令详解</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount [选项] [设备] [挂载点]</span><br></pre></td></tr></table></figure>
<p><strong>常用选项：</strong></p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-t</td>
<td>指定文件系统类型</td>
</tr>
<tr>
<td>-o</td>
<td>指定挂载选项(多选项用逗号分隔)</td>
</tr>
<tr>
<td>-a</td>
<td>挂载/etc/fstab中所有文件系统</td>
</tr>
<tr>
<td>–bind</td>
<td>目录绑定挂载</td>
</tr>
<tr>
<td>-l</td>
<td>显示标签</td>
</tr>
</tbody>
</table>
<p><strong>示例：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t ext4 -o noatime /dev/sdb1 /mnt/data</span><br></pre></td></tr></table></figure>
<h3 id="umount-命令">umount 命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount [选项] [设备|挂载点]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-a</td>
<td>卸载所有文件系统</td>
</tr>
<tr>
<td>-t</td>
<td>按类型卸载</td>
</tr>
<tr>
<td>-l</td>
<td>延迟卸载(强制)</td>
</tr>
<tr>
<td>-f</td>
<td>强制卸载</td>
</tr>
</tbody>
</table>
<p><strong>强制卸载流程：</strong></p>
<ol>
<li><code>fuser -vm /mountpoint</code> 查看占用进程</li>
<li><code>kill -9 PID</code> 结束进程</li>
<li><code>umount -f /mountpoint</code></li>
</ol>
<h2 id="3-SWAP-管理">3. SWAP 管理</h2>
<h3 id="创建SWAP文件">创建SWAP文件</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建1GB交换文件</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/swapfile bs=1M count=1024</span><br><span class="line"><span class="built_in">chmod</span> 600 /swapfile</span><br><span class="line">mkswap /swapfile</span><br><span class="line">swapon /swapfile</span><br></pre></td></tr></table></figure>
<h3 id="SWAP管理命令">SWAP管理命令</h3>
<table>
<thead>
<tr>
<th>命令</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>swapon -a</code></td>
<td>启用所有swap</td>
</tr>
<tr>
<td><code>swapon -s</code></td>
<td>查看swap使用</td>
</tr>
<tr>
<td><code>swapoff -a</code></td>
<td>禁用所有swap</td>
</tr>
</tbody>
</table>
<p><strong>优化建议：</strong></p>
<ul>
<li>物理内存&lt;8GB时，SWAP=1.5倍内存</li>
<li>物理内存≥8GB时，SWAP=8GB</li>
</ul>
<h2 id="4-文件系统创建与维护">4. 文件系统创建与维护</h2>
<h3 id="创建工具对比">创建工具对比</h3>
<table>
<thead>
<tr>
<th>命令</th>
<th>对应文件系统</th>
<th>特点</th>
</tr>
</thead>
<tbody>
<tr>
<td>mkfs.ext4</td>
<td>ext4</td>
<td>默认日志模式</td>
</tr>
<tr>
<td>mkfs.xfs</td>
<td>XFS</td>
<td>高性能大文件</td>
</tr>
<tr>
<td>mkfs.btrfs</td>
<td>Btrfs</td>
<td>高级功能支持</td>
</tr>
</tbody>
</table>
<p><strong>ext4创建示例：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkfs.ext4 -b 4096 -m 1 -L DATA /dev/sdb1</span><br></pre></td></tr></table></figure>
<p><strong>XFS创建示例：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkfs.xfs -f -L BIGDATA /dev/sdc1</span><br></pre></td></tr></table></figure>
<h3 id="文件系统检查">文件系统检查</h3>
<p><strong>ext系列检查：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fsck -y /dev/sda1   <span class="comment"># 自动修复</span></span><br><span class="line">e2fsck -f /dev/sda1 <span class="comment"># 强制检查</span></span><br></pre></td></tr></table></figure>
<p><strong>XFS检查：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xfs_repair /dev/sdb1</span><br></pre></td></tr></table></figure>
<p><strong>检查时机：</strong></p>
<ul>
<li>异常关机后</li>
<li>定期维护时(建议每6个月)</li>
<li>出现I/O错误时</li>
</ul>
<h2 id="5-高级文件系统特性">5. 高级文件系统特性</h2>
<h3 id="ext4-特性管理">ext4 特性管理</h3>
<p><strong>转换ext3→ext4：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tune2fs -O extent,uninit_bg,dir_index /dev/sda1</span><br><span class="line">fsck -pf /dev/sda1</span><br></pre></td></tr></table></figure>
<p><strong>调整参数：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tune2fs -c 30 -i 7d /dev/sda1  <span class="comment"># 每30次挂载或7天检查</span></span><br><span class="line">tune2fs -m 5 /dev/sda1         <span class="comment"># 保留5%空间</span></span><br></pre></td></tr></table></figure>
<h3 id="XFS-高级功能">XFS 高级功能</h3>
<p><strong>查看信息：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xfs_info /dev/sdb1</span><br><span class="line">xfs_admin -l /dev/sdb1</span><br></pre></td></tr></table></figure>
<p><strong>备份恢复：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xfsdump -l 0 -f /backup/root.xfsdump /dev/sda1</span><br><span class="line">xfsrestore -f /backup/root.xfsdump /mnt/restore</span><br></pre></td></tr></table></figure>
<h2 id="6-光盘与加密文件系统">6. 光盘与加密文件系统</h2>
<h3 id="光盘制作">光盘制作</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建ISO</span></span><br><span class="line">mkisofs -JR -V <span class="string">&quot;BACKUP_2023&quot;</span> -o backup.iso /backup</span><br><span class="line"></span><br><span class="line"><span class="comment"># 刻录光盘</span></span><br><span class="line">cdrecord -v dev=1,0,0 speed=24 backup.iso</span><br></pre></td></tr></table></figure>
<h3 id="加密文件系统">加密文件系统</h3>
<p><strong>LUKS加密：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cryptsetup luksFormat /dev/sdb1</span><br><span class="line">cryptsetup luksOpen /dev/sdb1 secret</span><br><span class="line">mkfs.ext4 /dev/mapper/secret</span><br><span class="line">mount /dev/mapper/secret /mnt/secure</span><br></pre></td></tr></table></figure>
<p><strong>关闭加密卷：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">umount /mnt/secure</span><br><span class="line">cryptsetup luksClose secret</span><br></pre></td></tr></table></figure>
<h2 id="7-磁盘健康监控">7. 磁盘健康监控</h2>
<h3 id="S-M-A-R-T-监控">S.M.A.R.T. 监控</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">smartctl -a /dev/sda          <span class="comment"># 查看详细信息</span></span><br><span class="line">smartctl -H /dev/sda          <span class="comment"># 健康状态</span></span><br><span class="line">smartctl -t long /dev/sda     <span class="comment"># 启动长测试</span></span><br></pre></td></tr></table></figure>
<p><strong>关键监控指标：</strong></p>
<ul>
<li>Reallocated_Sector_Ct</li>
<li>Current_Pending_Sector</li>
<li>Temperature_Celsius</li>
</ul>
<h2 id="8-故障处理流程">8. 故障处理流程</h2>
<h3 id="文件系统修复步骤">文件系统修复步骤</h3>
<ol>
<li>
<p><strong>卸载文件系统</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount /dev/sda1</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>进入单用户模式</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">init 1</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>执行检查修复</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fsck -y /dev/sda1</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>严重损坏时</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">debugfs /dev/sda1</span><br><span class="line">&gt; lsdel      <span class="comment"># 查看已删除inode</span></span><br><span class="line">&gt; dump &lt;inode&gt; /tmp/recover_file</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="应急恢复方案">应急恢复方案</h3>
<table>
<thead>
<tr>
<th>问题现象</th>
<th>解决方案</th>
</tr>
</thead>
<tbody>
<tr>
<td>无法挂载</td>
<td><code>fsck -y /dev/sdX</code></td>
</tr>
<tr>
<td>Superblock损坏</td>
<td><code>e2fsck -b 32768 /dev/sdX</code></td>
</tr>
<tr>
<td>只读文件系统</td>
<td><code>mount -o remount,rw /</code></td>
</tr>
</tbody>
</table>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../2020/11/14/linux/14-%E8%AE%BE%E5%A4%87%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../2020/11/10/linux/13-%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8/"
                            aria-label=": 13.系统启动"
                        >
                            13.系统启动
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-11-10T14:01:10+08:00">
	
		    2020 年 11 月 10 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="">后端</a>, <a class="category-link" href="linux/">linux</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="1-系统启动流程">1. 系统启动流程</h2>
<h3 id="1-1-启动阶段详解">1.1 启动阶段详解</h3>
<table>
<thead>
<tr>
<th>阶段</th>
<th>组件</th>
<th>功能说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>BIOS</td>
<td>- 硬件自检(POST)<br>- 读取CMOS设置<br>- 检测启动设备顺序<br>- 加载MBR中的BootLoader</td>
</tr>
<tr>
<td>2</td>
<td>MBR</td>
<td>- 512字节(启动代码+分区表)<br>- 包含第一阶段BootLoader<br>- 标识活动分区</td>
</tr>
<tr>
<td>3</td>
<td>BootLoader</td>
<td>- 阶段1: MBR中的初始代码<br>- 阶段1.5: 文件系统识别<br>- 阶段2: 加载内核(/boot/grub/)</td>
</tr>
<tr>
<td>4</td>
<td>内核</td>
<td>- 硬件检测与初始化<br>- 加载驱动模块<br>- 挂载根文件系统<br>- 启动init进程(PID=1)</td>
</tr>
<tr>
<td>5</td>
<td>init进程</td>
<td>- 根据/etc/inittab初始化系统<br>- 启动运行级别对应服务<br>- 生成所有后续进程</td>
</tr>
</tbody>
</table>
<h3 id="1-2-inittab-文件格式">1.2 inittab 文件格式</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id:runlevels:action:process</span><br></pre></td></tr></table></figure>
<h4 id="主要action类型">主要action类型</h4>
<table>
<thead>
<tr>
<th>action</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>boot</td>
<td>系统启动时执行，不等待完成</td>
</tr>
<tr>
<td>bootwait</td>
<td>系统启动时执行，等待完成</td>
</tr>
<tr>
<td>ctrlaltdel</td>
<td>捕获Ctrl+Alt+Del组合键</td>
</tr>
<tr>
<td>initdefault</td>
<td>设置默认运行级别</td>
</tr>
<tr>
<td>once</td>
<td>进入运行级别时执行一次</td>
</tr>
<tr>
<td>respawn</td>
<td>进程终止后自动重启</td>
</tr>
<tr>
<td>sysinit</td>
<td>系统初始化脚本</td>
</tr>
<tr>
<td>wait</td>
<td>进入运行级别时执行并等待</td>
</tr>
</tbody>
</table>
<h3 id="1-3-运行级别管理">1.3 运行级别管理</h3>
<h4 id="标准运行级别">标准运行级别</h4>
<table>
<thead>
<tr>
<th>级别</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>关机</td>
</tr>
<tr>
<td>1/S</td>
<td>单用户模式</td>
</tr>
<tr>
<td>2</td>
<td>多用户无NFS</td>
</tr>
<tr>
<td>3</td>
<td>完整多用户模式</td>
</tr>
<tr>
<td>4</td>
<td>自定义</td>
</tr>
<tr>
<td>5</td>
<td>图形界面</td>
</tr>
<tr>
<td>6</td>
<td>重启</td>
</tr>
</tbody>
</table>
<h4 id="服务管理脚本">服务管理脚本</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/service [<span class="built_in">command</span>]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>start</td>
<td>启动服务</td>
</tr>
<tr>
<td>stop</td>
<td>停止服务</td>
</tr>
<tr>
<td>restart</td>
<td>重启服务</td>
</tr>
<tr>
<td>reload</td>
<td>重载配置</td>
</tr>
<tr>
<td>status</td>
<td>查看状态</td>
</tr>
</tbody>
</table>
<h4 id="服务自启动管理">服务自启动管理</h4>
<p><strong>RedHat系(chkconfig):</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig [选项] 服务名 [on|off]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>–list</td>
<td>显示服务状态</td>
</tr>
<tr>
<td>–level</td>
<td>指定运行级别</td>
</tr>
<tr>
<td>–add</td>
<td>添加服务</td>
</tr>
<tr>
<td>–del</td>
<td>删除服务</td>
</tr>
</tbody>
</table>
<p><strong>Debian系(update-rc.d):</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update-rc.d [选项] 服务名 [commands]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-n</td>
<td>模拟执行</td>
</tr>
<tr>
<td>-f</td>
<td>强制操作</td>
</tr>
<tr>
<td>remove</td>
<td>删除链接</td>
</tr>
</tbody>
</table>
<h3 id="1-4-Upstart-事件驱动">1.4 Upstart 事件驱动</h3>
<p><strong>主要命令:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">initctl [<span class="built_in">command</span>] job</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>命令</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>start</td>
<td>启动作业</td>
</tr>
<tr>
<td>stop</td>
<td>停止作业</td>
</tr>
<tr>
<td>restart</td>
<td>重启作业</td>
</tr>
<tr>
<td>status</td>
<td>查看状态</td>
</tr>
<tr>
<td>list</td>
<td>列出所有作业</td>
</tr>
</tbody>
</table>
<p><strong>配置文件位置:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init/*.conf</span><br></pre></td></tr></table></figure>
<h2 id="2-GRUB-引导加载器">2. GRUB 引导加载器</h2>
<h3 id="2-1-GRUB-Legacy-vs-GRUB2">2.1 GRUB Legacy vs GRUB2</h3>
<table>
<thead>
<tr>
<th>特性</th>
<th>GRUB Legacy</th>
<th>GRUB2</th>
</tr>
</thead>
<tbody>
<tr>
<td>版本</td>
<td>0.9x</td>
<td>1.9x</td>
</tr>
<tr>
<td>配置文件</td>
<td>menu.lst</td>
<td>grub.cfg</td>
</tr>
<tr>
<td>生成方式</td>
<td>直接编辑</td>
<td>update-grub</td>
</tr>
<tr>
<td>分区表示</td>
<td>(hd0,0)</td>
<td>hd0,msdos1</td>
</tr>
</tbody>
</table>
<h3 id="2-2-GRUB-Legacy-配置">2.2 GRUB Legacy 配置</h3>
<p><strong>/boot/grub/menu.lst 示例:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">timeout 5</span><br><span class="line">default 0</span><br><span class="line">title CentOS</span><br><span class="line">root (hd0,0)</span><br><span class="line">kernel /vmlinuz ro root=/dev/sda1</span><br><span class="line">initrd /initrd.img</span><br></pre></td></tr></table></figure>
<p><strong>常用命令:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grub&gt; root (hd0,0)     <span class="comment"># 设置根分区</span></span><br><span class="line">grub&gt; setup (hd0)      <span class="comment"># 安装到MBR</span></span><br><span class="line">grub&gt; <span class="built_in">cat</span> /grub/menu.lst <span class="comment"># 查看配置</span></span><br></pre></td></tr></table></figure>
<h3 id="2-3-GRUB2-配置">2.3 GRUB2 配置</h3>
<p><strong>/etc/default/grub 关键参数:</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>GRUB_DEFAULT</td>
<td>默认启动项</td>
</tr>
<tr>
<td>GRUB_TIMEOUT</td>
<td>菜单超时</td>
</tr>
<tr>
<td>GRUB_CMDLINE_LINUX</td>
<td>内核参数</td>
</tr>
</tbody>
</table>
<p><strong>生成配置:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update-grub</span><br></pre></td></tr></table></figure>
<h3 id="2-4-内核启动参数">2.4 内核启动参数</h3>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>root=/dev/sda1</td>
<td>指定根分区</td>
</tr>
<tr>
<td>ro/rw</td>
<td>只读/读写挂载</td>
</tr>
<tr>
<td>init=/bin/bash</td>
<td>指定初始化程序</td>
</tr>
<tr>
<td>single</td>
<td>单用户模式</td>
</tr>
<tr>
<td>mem=1024M</td>
<td>限制内存大小</td>
</tr>
</tbody>
</table>
<p><strong>查看当前参数:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/cmdline</span><br></pre></td></tr></table></figure>
<h2 id="3-其他引导加载器">3. 其他引导加载器</h2>
<h3 id="3-1-LILO-配置">3.1 LILO 配置</h3>
<p><strong>/etc/lilo.conf 示例:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">boot=/dev/sda</span><br><span class="line">map=/boot/map</span><br><span class="line">default=linux</span><br><span class="line">image=/boot/vmlinuz</span><br><span class="line">label=linux</span><br><span class="line">root=/dev/sda1</span><br></pre></td></tr></table></figure>
<p><strong>应用配置:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lilo -v</span><br></pre></td></tr></table></figure>
<h3 id="3-2-SYSLINUX-系列">3.2 SYSLINUX 系列</h3>
<table>
<thead>
<tr>
<th>类型</th>
<th>文件系统</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>SYSLINUX</td>
<td>FAT</td>
<td>USB启动</td>
</tr>
<tr>
<td>ISOLINUX</td>
<td>ISO9660</td>
<td>光盘启动</td>
</tr>
<tr>
<td>EXTLINUX</td>
<td>ext2/3/4</td>
<td>硬盘启动</td>
</tr>
<tr>
<td>PXELINUX</td>
<td>网络</td>
<td>网络启动</td>
</tr>
</tbody>
</table>
<p><strong>PXE启动环境搭建:</strong></p>
<ol>
<li>安装必要服务:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install dhcp tftp-server syslinux</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>配置DHCP:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filename &quot;pxelinux.0&quot;;</span><br><span class="line">next-server 192.168.1.100;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>准备TFTP目录:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/</span><br><span class="line"><span class="built_in">mkdir</span> /var/lib/tftpboot/pxelinux.cfg</span><br></pre></td></tr></table></figure>
<h2 id="4-系统恢复方法">4. 系统恢复方法</h2>
<h3 id="4-1-救援模式操作">4.1 救援模式操作</h3>
<ol>
<li>使用安装介质启动</li>
<li>进入救援模式</li>
<li>挂载原系统:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chroot</span> /mnt/sysimage</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>修复引导:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grub-install /dev/sda</span><br></pre></td></tr></table></figure>
<h3 id="4-2-常见修复场景">4.2 常见修复场景</h3>
<table>
<thead>
<tr>
<th>问题</th>
<th>解决方案</th>
</tr>
</thead>
<tbody>
<tr>
<td>MBR损坏</td>
<td><code>dd if=/usr/share/syslinux/mbr.bin of=/dev/sda</code></td>
</tr>
<tr>
<td>GRUB损坏</td>
<td><code>grub-install /dev/sda</code></td>
</tr>
<tr>
<td>文件系统错误</td>
<td><code>fsck -y /dev/sda1</code></td>
</tr>
<tr>
<td>密码重置</td>
<td><code>init=/bin/bash</code> 启动后修改密码</td>
</tr>
</tbody>
</table>
<h2 id="5-启动优化技巧">5. 启动优化技巧</h2>
<ol>
<li><strong>并行启动</strong>:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/init/rc-sysinit.conf</span><br><span class="line"><span class="comment"># 修改为:</span></span><br><span class="line"><span class="built_in">env</span> DEFAULT_RUNLEVEL=2</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><strong>禁用不需要的服务</strong>:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --list | grep 3:on</span><br><span class="line">chkconfig servicename off</span><br></pre></td></tr></table></figure>
<ol start="3">
<li><strong>使用readahead</strong>:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service readahead-early restart</span><br></pre></td></tr></table></figure>
<ol start="4">
<li><strong>SSD优化</strong>:<br>
在/etc/fstab添加:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">noatime,discard</span><br></pre></td></tr></table></figure>
                    
                        


                    
                    
                        <p>
                            <a
                                href="../../2020/11/10/linux/13-%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../2020/11/08/linux/12-%E5%86%85%E6%A0%B8/"
                            aria-label=": 12.内核"
                        >
                            12.内核
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-11-08T21:06:24+08:00">
	
		    2020 年 11 月 8 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="">后端</a>, <a class="category-link" href="linux/">linux</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="1-内核版本管理">1. 内核版本管理</h2>
<h3 id="版本号说明">版本号说明</h3>
<ul>
<li>
<p><strong>2.X.Y 旧版本格式</strong>：</p>
<ul>
<li>X：偶数表示稳定版，奇数表示开发版</li>
<li>Y：修订版本号</li>
<li>后缀说明：
<ul>
<li><code>-rcN</code>：Release Candidate（候选版本）</li>
<li><code>-gitN</code>：开发中的Git版本</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>3.0+ 新版本分类</strong>：</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Prepatch</td>
<td>稳定版前的测试版本</td>
</tr>
<tr>
<td>Mainline</td>
<td>包含新特性的主线开发版本</td>
</tr>
<tr>
<td>Stable</td>
<td>稳定版本</td>
</tr>
<tr>
<td>Longterm</td>
<td>长期支持版本(LTS)</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h3 id="版本查询命令">版本查询命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uname</span> [选项]</span><br></pre></td></tr></table></figure>
<h4 id="常用选项">常用选项</h4>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-a</td>
<td>显示全部系统信息</td>
</tr>
<tr>
<td>-r</td>
<td>显示内核版本</td>
</tr>
<tr>
<td>-m</td>
<td>显示硬件架构</td>
</tr>
</tbody>
</table>
<h4 id="其他查询方式">其他查询方式</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看/proc版本信息</span></span><br><span class="line"><span class="built_in">cat</span> /proc/version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过Makefile查看</span></span><br><span class="line"><span class="built_in">head</span> -4 /usr/src/linux/Makefile</span><br></pre></td></tr></table></figure>
<h2 id="2-内核模块管理">2. 内核模块管理</h2>
<h3 id="核心命令对比">核心命令对比</h3>
<table>
<thead>
<tr>
<th>命令</th>
<th>功能说明</th>
<th>特点</th>
</tr>
</thead>
<tbody>
<tr>
<td>lsmod</td>
<td>显示已加载模块</td>
<td>读取/proc/modules</td>
</tr>
<tr>
<td>insmod</td>
<td>加载单个模块</td>
<td>不处理依赖关系</td>
</tr>
<tr>
<td>rmmod</td>
<td>卸载模块</td>
<td>需确保无依赖</td>
</tr>
<tr>
<td>modprobe</td>
<td>智能加载/卸载模块</td>
<td>自动处理依赖关系</td>
</tr>
<tr>
<td>depmod</td>
<td>生成模块依赖关系文件</td>
<td>创建modules.dep</td>
</tr>
</tbody>
</table>
<h3 id="命令详解">命令详解</h3>
<h4 id="lsmod-输出说明">lsmod 输出说明</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Module                  Size  Used by    Dependent modules</span><br></pre></td></tr></table></figure>
<ul>
<li>显示模块名、大小、引用计数和被哪些模块使用</li>
</ul>
<h4 id="modinfo-模块信息">modinfo 模块信息</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modinfo [选项] 模块名</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-a</td>
<td>显示作者信息</td>
</tr>
<tr>
<td>-d</td>
<td>显示描述信息</td>
</tr>
<tr>
<td>-l</td>
<td>显示许可证信息</td>
</tr>
<tr>
<td>-n</td>
<td>显示模块文件路径</td>
</tr>
</tbody>
</table>
<h4 id="modprobe-高级用法">modprobe 高级用法</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modprobe [选项] 模块名</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-a</td>
<td>加载所有匹配模块</td>
</tr>
<tr>
<td>-c</td>
<td>显示当前配置</td>
</tr>
<tr>
<td>-l</td>
<td>列出所有可用模块</td>
</tr>
<tr>
<td>-r</td>
<td>递归卸载模块及依赖</td>
</tr>
<tr>
<td>-t 类型</td>
<td>仅操作指定类型模块</td>
</tr>
<tr>
<td>–show-depends</td>
<td>显示模块依赖关系</td>
</tr>
</tbody>
</table>
<h3 id="配置文件">配置文件</h3>
<ul>
<li><code>/etc/modprobe.conf</code>：模块别名和参数配置<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alias eth0 e1000</span><br><span class="line">options e1000 speed=1000 duplex=full</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="3-内核编译流程">3. 内核编译流程</h2>
<h3 id="编译步骤">编译步骤</h3>
<ol>
<li><strong>准备源代码</strong></li>
<li><strong>配置内核</strong>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">make oldconfig    <span class="comment"># 基于旧配置更新</span></span><br><span class="line">make menuconfig  <span class="comment"># 文本界面配置</span></span><br><span class="line">make xconfig     <span class="comment"># Qt图形界面配置</span></span><br><span class="line">make gconfig     <span class="comment"># GTK图形界面配置</span></span><br></pre></td></tr></table></figure>
</li>
<li><strong>编译内核</strong>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make           <span class="comment"># 编译内核和模块</span></span><br><span class="line">make bzImage   <span class="comment"># 仅编译内核</span></span><br><span class="line">make modules   <span class="comment"># 仅编译模块</span></span><br></pre></td></tr></table></figure>
</li>
<li><strong>安装组件</strong>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make modules_install  <span class="comment"># 安装模块到/lib/modules/</span></span><br><span class="line">make install          <span class="comment"># 自动安装内核</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="手动安装示例">手动安装示例</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 复制内核文件</span></span><br><span class="line"><span class="built_in">cp</span> <span class="built_in">arch</span>/x86/boot/bzImage /boot/vmlinuz-2.6.32</span><br><span class="line"><span class="built_in">cp</span> System.map /boot/System.map-2.6.32</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建链接</span></span><br><span class="line"><span class="built_in">ln</span> -s /boot/vmlinuz-2.6.32 /boot/vmlinuz</span><br><span class="line"><span class="built_in">ln</span> -s /boot/System.map-2.6.32 /boot/System.map</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成initramfs</span></span><br><span class="line">mkinitramfs -o /boot/initrd-2.6.32.img 2.6.32</span><br></pre></td></tr></table></figure>
<h3 id="其他make目标">其他make目标</h3>
<table>
<thead>
<tr>
<th>目标</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>clean</td>
<td>清除编译文件</td>
</tr>
<tr>
<td>mrproper</td>
<td>彻底清除(含配置)</td>
</tr>
<tr>
<td>rpm-pkg</td>
<td>生成RPM包</td>
</tr>
<tr>
<td>deb-pkg</td>
<td>生成Debian包</td>
</tr>
</tbody>
</table>
<h2 id="4-内核参数调优">4. 内核参数调优</h2>
<h3 id="proc-sys-关键参数">/proc/sys 关键参数</h3>
<table>
<thead>
<tr>
<th>路径</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>kernel/ctrl-alt-del</td>
<td>Ctrl+Alt+Del行为</td>
</tr>
<tr>
<td>kernel/shmall</td>
<td>共享内存页数上限</td>
</tr>
<tr>
<td>kernel/shmmax</td>
<td>共享内存段最大大小</td>
</tr>
<tr>
<td>net/ipv4/ip_forward</td>
<td>IP转发开关(1/0)</td>
</tr>
<tr>
<td>fs/file-max</td>
<td>系统最大文件句柄数</td>
</tr>
</tbody>
</table>
<h3 id="sysctl-工具">sysctl 工具</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl [选项] [参数=值]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-a</td>
<td>显示所有可用参数</td>
</tr>
<tr>
<td>-p</td>
<td>从/etc/sysctl.conf加载配置</td>
</tr>
<tr>
<td>-w</td>
<td>临时修改参数</td>
</tr>
</tbody>
</table>
<h3 id="initramfs-管理">initramfs 管理</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建initramfs</span></span><br><span class="line">mkinitramfs -o initrd.img 3.16.0-4-amd64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压分析</span></span><br><span class="line"><span class="built_in">mkdir</span> initrd &amp;&amp; <span class="built_in">cd</span> initrd</span><br><span class="line">zcat ../initrd.img | cpio -<span class="built_in">id</span></span><br></pre></td></tr></table></figure>
<h2 id="5-内核调试与设备管理">5. 内核调试与设备管理</h2>
<h3 id="proc-关键文件">/proc 关键文件</h3>
<table>
<thead>
<tr>
<th>文件</th>
<th>内容说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>/proc/cpuinfo</td>
<td>CPU详细信息</td>
</tr>
<tr>
<td>/proc/meminfo</td>
<td>内存使用情况</td>
</tr>
<tr>
<td>/proc/modules</td>
<td>已加载模块列表</td>
</tr>
<tr>
<td>/proc/partitions</td>
<td>分区信息</td>
</tr>
</tbody>
</table>
<h3 id="硬件信息工具">硬件信息工具</h3>
<h4 id="lspci">lspci</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lspci [选项]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-vv</td>
<td>超详细输出</td>
</tr>
<tr>
<td>-t</td>
<td>树状显示设备层级</td>
</tr>
</tbody>
</table>
<h4 id="lsusb">lsusb</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsusb [选项]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-v</td>
<td>详细输出设备描述符</td>
</tr>
<tr>
<td>-t</td>
<td>树状显示USB设备拓扑</td>
</tr>
</tbody>
</table>
<h3 id="udev-设备管理">udev 设备管理</h3>
<h4 id="规则文件示例">规则文件示例</h4>
<p><code>/etc/udev/rules.d/70-persistent-net.rules</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SUBSYSTEM==&quot;net&quot;, ACTION==&quot;add&quot;, DRIVERS==&quot;?*&quot;, </span><br><span class="line">ATTR&#123;address&#125;==&quot;08:00:27:aa:11:3c&quot;, NAME=&quot;eth0&quot;</span><br></pre></td></tr></table></figure>
<h4 id="udevadm-工具">udevadm 工具</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">udevadm info [选项]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-a</td>
<td>显示父设备属性</td>
</tr>
<tr>
<td>-n</td>
<td>指定设备节点路径</td>
</tr>
</tbody>
</table>
<h4 id="实时监控">实时监控</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">udevadm monitor</span><br></pre></td></tr></table></figure>
                    
                        


                    
                    
                        <p>
                            <a
                                href="../../2020/11/08/linux/12-%E5%86%85%E6%A0%B8/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
          <li class="pagination-next">
            <a
                class="btn btn--default btn--small"
                href="page/2/"
                aria-label="下一頁"
            >
              <span>下一頁</span>
              <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
          </li>
        
        <li class="pagination-number">第 1 頁 共 3 頁</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Kein Chan. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="../../assets/images/profile.jpg" alt="作者的圖片"/>
        
            <h4 id="about-card-name">Kein Chan</h4>
        
            <div id="about-card-bio"><p>這是獨立全棧工程師Kein Chan的技術博客</br>分享一些技術教程,命令備忘(cheat-sheet)等</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>全棧工程師</br>資深技術顧問</br>數據科學家</br>Hit廣島觀光大使</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Tokyo/Macau
            </div>
        
    </div>
</div>

        
            <div id="algolia-search-modal" class="modal-container">
    <div class="modal">
        <div class="modal-header">
            <span class="close-button"><i class="fa fa-times"></i></span>
            <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
                <span class="searchby-algolia-text text-color-light text-small">by</span>
                <img class="searchby-algolia-logo" src="../assets/images/logo-algolia-nebula-blue-full.svg">
            </a>
            <i class="search-icon fa fa-search"></i>
            <form id="algolia-search-form">
                <input type="text" id="algolia-search-input" name="search"
                    class="form-control input--large search-input" placeholder="Search "
                    />
            </form>
        </div>
        <div class="modal-body">
            <div class="no-result text-color-light text-center">沒有找到文章</div>
            <div class="results">
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2013/04/27/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/"
                            aria-label=": R语言-环境安装"
                        >
                            <h3 class="media-heading">R语言-环境安装</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年4月27日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2013/04/28/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E5%9F%BA%E7%A1%80/"
                            aria-label=": R语言-基础"
                        >
                            <h3 class="media-heading">R语言-基础</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年4月28日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2013/05/01/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE/"
                            aria-label=": R语言-读取数据"
                        >
                            <h3 class="media-heading">R语言-读取数据</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月1日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2013/05/02/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E7%BB%98%E5%9B%BE/"
                            aria-label=": R语言-绘图"
                        >
                            <h3 class="media-heading">R语言-绘图</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月2日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2013/05/03/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/"
                            aria-label=": R语言-线性回归"
                        >
                            <h3 class="media-heading">R语言-线性回归</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月3日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2015/02/22/Algorithms/1.%E7%AE%97%E6%B3%95%E5%9C%A8%E8%AE%A1%E7%AE%97%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8/"
                            aria-label=": 1. 算法在计算中的作用"
                        >
                            <h3 class="media-heading">1. 算法在计算中的作用</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月22日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2015/02/23/Algorithms/2.%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80/"
                            aria-label=": 2. 算法基础"
                        >
                            <h3 class="media-heading">2. 算法基础</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月23日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2015/02/24/Algorithms/3.%E5%87%BD%E6%95%B0%E7%9A%84%E5%A2%9E%E9%95%BF/"
                            aria-label=": 3. 函数的增长"
                        >
                            <h3 class="media-heading">3. 函数的增长</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月24日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2015/02/25/Algorithms/4.%E5%88%86%E6%B2%BB%E7%AD%96%E7%95%A5/"
                            aria-label=": 4. 分治策略"
                        >
                            <h3 class="media-heading">4. 分治策略</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月25日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://chankein.github.io/2015/02/26/Algorithms/5.%E6%A6%82%E7%8E%87%E5%88%86%E6%9E%90%E5%92%8C%E9%9A%8F%E6%9C%BA%E7%AE%97%E6%B3%95/"
                            aria-label=": 5. 概率分析和随机算法"
                        >
                            <h3 class="media-heading">5. 概率分析和随机算法</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月26日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <p class="results-count text-medium"
                data-message-zero="沒有找到文章"
                data-message-one="找到 1 篇文章"
                data-message-other="找到 {n} 篇文章">
                找到 199 篇文章
            </p>
        </div>
    </div>
</div>

        
        
<div id="cover" style="background-image:url('../../assets/images/cover.jpeg');"></div>
        <!--SCRIPTS-->

<script src="../../assets/js/script-qtzvvb63gamuirvfphht7lytrxkfllzng1escnm2phjtlt4tvvxi5gl0wx4o.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>


<!DOCTYPE html>
<html lang="zh-tw">
    
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css">

    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/min/moment.min.js"></script>
    
      <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/locale/zh-tw.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
    <script>
      window.algoliaConfig = {
        appId: 'AWFC86Q51O',
        apiKey: 'c9d952906eb1b154d75cf863e75c1ede',
        indexName: 'MyBlog'
      };
      var algoliaIndex = algoliasearch(
        algoliaConfig.appId,
        algoliaConfig.apiKey
      ).initIndex(algoliaConfig.indexName);
    </script>


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Kein&#39;s blog">
    <title>所有文章 - Kein&#39;s blog</title>
    <meta name="author" content="Kein Chan">
    
    
    
    <script type="application/ld+json">{}</script>
    <meta property="og:type" content="blog">
<meta property="og:title" content="Kein&#39;s blog">
<meta property="og:url" content="https://keinchan.com/archives/page/3/index.html">
<meta property="og:site_name" content="Kein&#39;s blog">
<meta property="og:locale" content="zh_TW">
<meta property="article:author" content="Kein Chan">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="https://keinchan.com../../../assets/images/profile.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="../../../assets/css/style-l9zwheso7r7pnk98nvirovsz9dl7fhkrc9mlb5vmuxw7tk5movrk0eevsrpr.min.css">

    <!--STYLES END-->
    

    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="../../../index.html"
            aria-label=""
        >
            Kein&#39;s blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="打開鏈接: ../../../#about"
            >
        
        
            <img class="header-picture" src="../../../assets/images/profile.jpg" alt="作者的圖片"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="../../../#about"
                    aria-label="閱讀有關作者的更多信息"
                >
                    <img class="sidebar-profile-picture" src="../../../assets/images/profile.jpg" alt="作者的圖片"/>
                </a>
                <h4 class="sidebar-profile-name">Kein Chan</h4>
                
                    <h5 class="sidebar-profile-bio"><p>這是獨立全棧工程師Kein Chan的技術博客</br>分享一些技術教程,命令備忘(cheat-sheet)等</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../../index.html"
                            
                            rel="noopener"
                            title="首頁"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首頁</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../../all-categories"
                            
                            rel="noopener"
                            title="分類"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分類</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../../all-tags"
                            
                            rel="noopener"
                            title="標籤"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">標籤</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../../all-archives"
                            
                            rel="noopener"
                            title="所有文章"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">所有文章</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="搜尋"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">搜尋</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="關於"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">關於</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/chankein/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/profile/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../../mailto:kein.chan85@gmail.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Email"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Email</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="../../../atom.xml"
                            
                            rel="noopener"
                            title="Atom"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Atom</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../../2024/01/16/JavaScript/JavaScript-jQuery/"
                            aria-label=": JavaScript-jQuery"
                        >
                            JavaScript-jQuery
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2024-01-16T21:51:07+08:00">
	
		    2024 年 1 月 16 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../../categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a>, <a class="category-link" href="../../../categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/JavaScript/">JavaScript</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="jQuery">jQuery</h2>
<p>你可能听说过jQuery，它名字起得很土，但却是JavaScript世界中使用最广泛的一个库。</p>
<p>江湖传言，全世界大约有80~90%的网站直接或间接地使用了jQuery。鉴于它如此流行，又如此好用，所以每一个入门JavaScript的前端工程师都应该了解和学习它。</p>
<p>jQuery这么流行，肯定是因为它解决了一些很重要的问题。实际上，jQuery能帮我们干这些事情：</p>
<ul>
<li>消除浏览器差异：你不需要自己写冗长的代码来针对不同的浏览器来绑定事件，编写AJAX等代码；</li>
<li>简洁的操作DOM的方法：写<code>$('#test')</code>肯定比<code>document.getElementById('test')</code>来得简洁；</li>
<li>轻松实现动画、修改CSS等各种操作。</li>
</ul>
<p>jQuery的理念“Write Less, Do More“，让你写更少的代码，完成更多的工作！</p>
<h3 id="jQuery版本">jQuery版本</h3>
<p>从<a target="_blank" rel="noopener" href="https://jquery.com/download/">jQuery官网</a>可以下载最新版本。jQuery只是一个<code>jquery-xxx.js</code>文件，但你会看到有compressed（已压缩）和uncompressed（未压缩）两种版本，使用时完全一样，但如果你想深入研究jQuery源码，那就用uncompressed版本。</p>
<h3 id="使用jQuery">使用jQuery</h3>
<p>使用jQuery只需要在页面的<code>&lt;head&gt;</code>引入jQuery文件即可：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>好消息是，当你在学习这个教程时，已经引用了jQuery，所以你可以直接使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(&#x27;jQuery版本：&#x27; + $.fn.jquery);</span><br></pre></td></tr></table></figure>
<h3 id="符号">$符号</h3>
<p><code>$</code>是著名的jQuery符号。实际上，jQuery把所有功能全部封装在一个全局变量<code>jQuery</code>中，而<code>$</code>也是一个合法的变量名，它是变量<code>jQuery</code>的别名：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">jQuery</span>; <span class="comment">// jQuery(selector, context)</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">$</span>; <span class="comment">// jQuery(selector, context)</span></span><br><span class="line">$ === jQuery; <span class="comment">// true</span></span><br><span class="line"><span class="title function_">typeof</span>($); <span class="comment">// &#x27;function&#x27;</span></span><br></pre></td></tr></table></figure>
<p><code>$</code>本质上就是一个函数，但是函数也是对象，于是<code>$</code>除了可以直接调用外，也可以有很多其他属性。</p>
<p><em>注意</em>，你看到的<code>$</code>函数名可能不是<code>jQuery(selector, context)</code>，因为很多JavaScript压缩工具可以对函数名和参数改名，所以压缩过的jQuery源码<code>$</code>函数可能变成<code>a(b,c)</code>。</p>
<p>绝大多数时候，我们都直接用<code>$</code>（因为写起来更简单嘛）。但是，如果<code>$</code>这个变量不幸地被占用了，而且还不能改，那我们就只能让<code>jQuery</code>把<code>$</code>变量交出来，然后就只能使用<code>jQuery</code>这个变量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$; <span class="comment">// jQuery(selector, context)</span></span><br><span class="line">jQuery.<span class="title function_">noConflict</span>();</span><br><span class="line">$; <span class="comment">// undefined</span></span><br><span class="line">jQuery; <span class="comment">// jQuery(selector, context)</span></span><br></pre></td></tr></table></figure>
<p>这种黑魔法的原理是jQuery在占用<code>$</code>之前，先在内部保存了原来的<code>$</code>,调用<code>jQuery.noConflict()</code>时会把原来保存的变量还原。</p>
<hr>
<hr>
<p>选择器是jQuery的核心。一个选择器写出来类似<code>$('#dom-id')</code>。</p>
<p>为什么jQuery要发明选择器？回顾一下DOM操作中我们经常使用的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 按ID查找：</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;dom-id&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按tag查找：</span></span><br><span class="line"><span class="keyword">let</span> divs = <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找&lt;p class=&quot;red&quot;&gt;：</span></span><br><span class="line"><span class="keyword">let</span> ps = <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;p&#x27;</span>);</span><br><span class="line"><span class="comment">// 过滤出class=&quot;red&quot;:</span></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找&lt;table class=&quot;green&quot;&gt;里面的所有&lt;tr&gt;：</span></span><br><span class="line"><span class="keyword">let</span> table = ...</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;table.<span class="property">children</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 过滤出&lt;tr&gt;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这些代码实在太繁琐了，并且，在层级关系中，例如，查找<code>&lt;table class=&quot;green&quot;&gt;</code>里面的所有<code>&lt;tr&gt;</code>，一层循环实际上是错的，因为<code>&lt;table&gt;</code>的标准写法是：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span>...<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span>...<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>很多时候，需要递归查找所有子节点。</p>
<p>jQuery的选择器就是帮助我们快速定位到一个或多个DOM节点。</p>
<h3 id="按ID查找">按ID查找</h3>
<p>如果某个DOM节点有<code>id</code>属性，利用jQuery查找如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查找&lt;div id=&quot;abc&quot;&gt;:</span></span><br><span class="line"><span class="keyword">let</span> div = $(<span class="string">&#x27;#abc&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><em>注意</em>，<code>#abc</code>以<code>#</code>开头。返回的对象是jQuery对象。</p>
<p>什么是jQuery对象？jQuery对象类似数组，它的每个元素都是一个引用了DOM节点的对象。</p>
<p>以上面的查找为例，如果<code>id</code>为<code>abc</code>的<code>&lt;div&gt;</code>存在，返回的jQuery对象如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;abc&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>]</span><br></pre></td></tr></table></figure>
<p>如果<code>id</code>为<code>abc</code>的<code>&lt;div&gt;</code>不存在，返回的jQuery对象如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[]</span><br></pre></td></tr></table></figure>
<p>总之jQuery的选择器不会返回<code>undefined</code>或者<code>null</code>，这样的好处是你不必在下一行判断<code>if (div === undefined)</code>。</p>
<p>jQuery对象和DOM对象之间可以互相转化：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> div = $(<span class="string">&#x27;#abc&#x27;</span>); <span class="comment">// jQuery对象</span></span><br><span class="line"><span class="keyword">let</span> divDom = div.<span class="title function_">get</span>(<span class="number">0</span>); <span class="comment">// 假设存在div，获取第1个DOM元素</span></span><br><span class="line"><span class="keyword">let</span> another = $(divDom); <span class="comment">// 重新把DOM包装为jQuery对象</span></span><br></pre></td></tr></table></figure>
<p>通常情况下你不需要获取DOM对象，直接使用jQuery对象更加方便。如果你拿到了一个DOM对象，那可以简单地调用<code>$(aDomObject)</code>把它变成jQuery对象，这样就可以方便地使用jQuery的API了。</p>
<h3 id="按tag查找">按tag查找</h3>
<p>按tag查找只需要写上tag名称就可以了：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ps = $(<span class="string">&#x27;p&#x27;</span>); <span class="comment">// 返回所有&lt;p&gt;节点</span></span><br><span class="line">ps.<span class="property">length</span>; <span class="comment">// 数一数页面有多少个&lt;p&gt;节点</span></span><br></pre></td></tr></table></figure>
<h3 id="按class查找">按class查找</h3>
<p>按class查找注意在class名称前加一个<code>.</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = $(<span class="string">&#x27;.red&#x27;</span>); <span class="comment">// 所有节点包含`class=&quot;red&quot;`都将返回</span></span><br><span class="line"><span class="comment">// 例如:</span></span><br><span class="line"><span class="comment">// &lt;div class=&quot;red&quot;&gt;...&lt;/div&gt;</span></span><br><span class="line"><span class="comment">// &lt;p class=&quot;green red&quot;&gt;...&lt;/p&gt;</span></span><br></pre></td></tr></table></figure>
<p>通常很多节点有多个class，我们可以查找同时包含<code>red</code>和<code>green</code>的节点：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = $(<span class="string">&#x27;.red.green&#x27;</span>); <span class="comment">// 注意没有空格！</span></span><br><span class="line"><span class="comment">// 符合条件的节点：</span></span><br><span class="line"><span class="comment">// &lt;div class=&quot;red green&quot;&gt;...&lt;/div&gt;</span></span><br><span class="line"><span class="comment">// &lt;div class=&quot;blue green red&quot;&gt;...&lt;/div&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="按属性查找">按属性查找</h3>
<p>一个DOM节点除了<code>id</code>和<code>class</code>外还可以有很多属性，很多时候按属性查找会非常方便，比如在一个表单中按属性来查找：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> email = $(<span class="string">&#x27;[name=email]&#x27;</span>); <span class="comment">// 找出&lt;??? name=&quot;email&quot;&gt;</span></span><br><span class="line"><span class="keyword">let</span> passwordInput = $(<span class="string">&#x27;[type=password]&#x27;</span>); <span class="comment">// 找出&lt;??? type=&quot;password&quot;&gt;</span></span><br><span class="line"><span class="keyword">let</span> a = $(<span class="string">&#x27;[items=&quot;A B&quot;]&#x27;</span>); <span class="comment">// 找出&lt;??? items=&quot;A B&quot;&gt;</span></span><br></pre></td></tr></table></figure>
<p>当属性的值包含空格等特殊字符时，需要用双引号括起来。</p>
<p>按属性查找还可以使用前缀查找或者后缀查找：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> icons = $(<span class="string">&#x27;[name^=icon]&#x27;</span>); <span class="comment">// 找出所有name属性值以icon开头的DOM</span></span><br><span class="line"><span class="comment">// 例如: name=&quot;icon-1&quot;, name=&quot;icon-2&quot;</span></span><br><span class="line"><span class="keyword">let</span> names = $(<span class="string">&#x27;[name$=with]&#x27;</span>); <span class="comment">// 找出所有name属性值以with结尾的DOM</span></span><br><span class="line"><span class="comment">// 例如: name=&quot;startswith&quot;, name=&quot;endswith&quot;</span></span><br></pre></td></tr></table></figure>
<p>这个方法尤其适合通过class属性查找，且不受class包含多个名称的影响：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> icons = $(<span class="string">&#x27;[class^=&quot;icon-&quot;]&#x27;</span>); <span class="comment">// 找出所有class包含至少一个以`icon-`开头的DOM</span></span><br><span class="line"><span class="comment">// 例如: class=&quot;icon-clock&quot;, class=&quot;abc icon-home&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="组合查找">组合查找</h3>
<p>组合查找就是把上述简单选择器组合起来使用。如果我们查找<code>$('[name=email]')</code>，很可能把表单外的<code>&lt;div name=&quot;email&quot;&gt;</code>也找出来，但我们只希望查找<code>&lt;input&gt;</code>，就可以这么写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> emailInput = $(<span class="string">&#x27;input[name=email]&#x27;</span>); <span class="comment">// 不会找出&lt;div name=&quot;email&quot;&gt;</span></span><br></pre></td></tr></table></figure>
<p>同样的，根据tag和class来组合查找也很常见：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> tr = $(<span class="string">&#x27;tr.red&#x27;</span>); <span class="comment">// 找出&lt;tr class=&quot;red ...&quot;&gt;...&lt;/tr&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="多项选择器">多项选择器</h3>
<p>多项选择器就是把多个选择器用<code>,</code>组合起来一块选：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;p,div&#x27;</span>); <span class="comment">// 把&lt;p&gt;和&lt;div&gt;都选出来</span></span><br><span class="line">$(<span class="string">&#x27;p.red,p.green&#x27;</span>); <span class="comment">// 把&lt;p class=&quot;red&quot;&gt;和&lt;p class=&quot;green&quot;&gt;都选出来</span></span><br></pre></td></tr></table></figure>
<p>要注意的是，选出来的元素是按照它们在HTML中出现的顺序排列的，而且不会有重复元素。例如，<code>&lt;p class=&quot;red green&quot;&gt;</code>不会被上面的<code>$('p.red,p.green')</code>选择两次。</p>
<h3 id="练习">练习</h3>
<p>使用jQuery选择器分别选出指定元素：</p>
<ul>
<li>仅选择JavaScript</li>
<li>仅选择Erlang</li>
<li>选择JavaScript和Erlang</li>
<li>选择所有编程语言</li>
<li>选择名字input</li>
<li>选择邮件和名字input</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;test-jquery&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;para-1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;color-red&quot;</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;para-2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;color-green&quot;</span>&gt;</span>Haskell<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;color-red color-green&quot;</span>&gt;</span>Erlang<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">class</span>=<span class="string">&quot;color-black&quot;</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;test-form&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">action</span>=<span class="string">&quot;#0&quot;</span> <span class="attr">onsubmit</span>=<span class="string">&quot;return false;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">legend</span>&gt;</span>注册新用户<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span>名字: <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span>邮件: <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span>口令: <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>JavaScript</p>
<p>Haskell</p>
<p>Erlang</p>
<p>Python</p>
<p>运行查看结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">let selected = null;</span><br><span class="line"></span><br><span class="line">selected = ???;</span><br><span class="line"></span><br><span class="line">// 高亮结果:</span><br><span class="line">if (!(selected instanceof jQuery)) &#123;</span><br><span class="line">    return console.log(&#x27;不是有效的jQuery对象!&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">$(&#x27;#test-jquery&#x27;).find(&#x27;*&#x27;).css(&#x27;background-color&#x27;, &#x27;&#x27;);</span><br><span class="line">selected.css(&#x27;background-color&#x27;, &#x27;#ff8000&#x27;);</span><br></pre></td></tr></table></figure>
<p>除了基本的选择器外，jQuery的层级选择器更加灵活，也更强大。</p>
<p>因为DOM的结构就是层级结构，所以我们经常要根据层级关系进行选择。</p>
<h3 id="层级选择器（Descendant-Selector）">层级选择器（Descendant Selector）</h3>
<p>如果两个DOM元素具有层级关系，就可以用<code>$('ancestor descendant')</code>来选择，层级之间用空格隔开。例如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;testing&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;lang&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lang-javascript&quot;</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lang-python&quot;</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lang-lua&quot;</span>&gt;</span>Lua<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>要选出JavaScript，可以用层级选择器：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;ul.lang li.lang-javascript&#x27;</span>); <span class="comment">// [&lt;li class=&quot;lang-javascript&quot;&gt;JavaScript&lt;/li&gt;]</span></span><br><span class="line">$(<span class="string">&#x27;div.testing li.lang-javascript&#x27;</span>); <span class="comment">// [&lt;li class=&quot;lang-javascript&quot;&gt;JavaScript&lt;/li&gt;]</span></span><br></pre></td></tr></table></figure>
<p>因为<code>&lt;div&gt;</code>和<code>&lt;ul&gt;</code>都是<code>&lt;li&gt;</code>的祖先节点，所以上面两种方式都可以选出相应的<code>&lt;li&gt;</code>节点。</p>
<p>要选择所有的<code>&lt;li&gt;</code>节点，用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;ul.lang li&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>这种层级选择器相比单个的选择器好处在于，它缩小了选择范围，因为首先要定位父节点，才能选择相应的子节点，这样避免了页面其他不相关的元素。</p>
<p>例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;form[name=upload] input&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>就把选择范围限定在<code>name</code>属性为<code>upload</code>的表单里。如果页面有很多表单，其他表单的<code>&lt;input&gt;</code>不会被选择。</p>
<p>多层选择也是允许的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;form.test p input&#x27;</span>); <span class="comment">// 在form表单选择被&lt;p&gt;包含的&lt;input&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="子选择器（Child-Selector）">子选择器（Child Selector）</h3>
<p>子选择器<code>$('parent&gt;child')</code>类似层级选择器，但是限定了层级关系必须是父子关系，就是<code>&lt;child&gt;</code>节点必须是<code>&lt;parent&gt;</code>节点的直属子节点。还是以上面的例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;ul.lang&gt;li.lang-javascript&#x27;</span>); <span class="comment">// 可以选出[&lt;li class=&quot;lang-javascript&quot;&gt;JavaScript&lt;/li&gt;]</span></span><br><span class="line">$(<span class="string">&#x27;div.testing&gt;li.lang-javascript&#x27;</span>); <span class="comment">// [], 无法选出，因为&lt;div&gt;和&lt;li&gt;不构成父子关系</span></span><br></pre></td></tr></table></figure>
<h3 id="过滤器（Filter）">过滤器（Filter）</h3>
<p>过滤器一般不单独使用，它通常附加在选择器上，帮助我们更精确地定位元素。观察过滤器的效果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;ul.lang li&#x27;</span>); <span class="comment">// 选出JavaScript、Python和Lua 3个节点</span></span><br><span class="line">$(<span class="string">&#x27;ul.lang li:first-child&#x27;</span>); <span class="comment">// 仅选出JavaScript</span></span><br><span class="line">$(<span class="string">&#x27;ul.lang li:last-child&#x27;</span>); <span class="comment">// 仅选出Lua</span></span><br><span class="line">$(<span class="string">&#x27;ul.lang li:nth-child(2)&#x27;</span>); <span class="comment">// 选出第N个元素，N从1开始</span></span><br><span class="line">$(<span class="string">&#x27;ul.lang li:nth-child(even)&#x27;</span>); <span class="comment">// 选出序号为偶数的元素</span></span><br><span class="line">$(<span class="string">&#x27;ul.lang li:nth-child(odd)&#x27;</span>); <span class="comment">// 选出序号为奇数的元素</span></span><br></pre></td></tr></table></figure>
<h3 id="表单相关">表单相关</h3>
<p>针对表单元素，jQuery还有一组特殊的选择器：</p>
<ul>
<li><code>:input</code>：可以选择<code>&lt;input&gt;</code>，<code>&lt;textarea&gt;</code>，<code>&lt;select&gt;</code>和<code>&lt;button&gt;</code>；</li>
<li><code>:file</code>：可以选择<code>&lt;input type=&quot;file&quot;&gt;</code>，和<code>input[type=file]</code>一样；</li>
<li><code>:checkbox</code>：可以选择复选框，和<code>input[type=checkbox]</code>一样；</li>
<li><code>:radio</code>：可以选择单选框，和<code>input[type=radio]</code>一样；</li>
<li><code>:focus</code>：可以选择当前输入焦点的元素，例如把光标放到一个<code>&lt;input&gt;</code>上，用<code>$('input:focus')</code>就可以选出；</li>
<li><code>:checked</code>：选择当前勾上的单选框和复选框，用这个选择器可以立刻获得用户选择的项目，如<code>$('input[type=radio]:checked')</code>；</li>
<li><code>:enabled</code>：可以选择可以正常输入的<code>&lt;input&gt;</code>、<code>&lt;select&gt;</code> 等，也就是没有灰掉的输入；</li>
<li><code>:disabled</code>：和<code>:enabled</code>正好相反，选择那些不能输入的。</li>
</ul>
<p>此外，jQuery还有很多有用的选择器，例如，选出可见的或隐藏的元素：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;div:visible&#x27;</span>); <span class="comment">// 所有可见的div</span></span><br><span class="line">$(<span class="string">&#x27;div:hidden&#x27;</span>); <span class="comment">// 所有隐藏的div</span></span><br></pre></td></tr></table></figure>
<h3 id="练习-2">练习</h3>
<p>针对如下HTML结构：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;test-selector&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;test-lang&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lang-javascript&quot;</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lang-python&quot;</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lang-lua&quot;</span>&gt;</span>Lua<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ol</span> <span class="attr">class</span>=<span class="string">&quot;test-lang&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lang-swift&quot;</span>&gt;</span>Swift<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lang-java&quot;</span>&gt;</span>Java<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lang-c&quot;</span>&gt;</span>C<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>JavaScript</li>
<li>Python</li>
<li>Lua</li>
</ul>
<ol>
<li>Swift</li>
<li>Java</li>
<li>C</li>
</ol>
<p>选出相应的内容并观察效果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 分别选择所有语言，所有动态语言，所有静态语言，JavaScript，Lua，C等:</span><br><span class="line">let selected = ???</span><br><span class="line"></span><br><span class="line">// 高亮结果:</span><br><span class="line">if (!(selected instanceof jQuery)) &#123;</span><br><span class="line">    return console.log(&#x27;不是有效的jQuery对象!&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">$(&#x27;#test-jquery&#x27;).find(&#x27;*&#x27;).css(&#x27;background-color&#x27;, &#x27;&#x27;);</span><br><span class="line">selected.css(&#x27;background-color&#x27;, &#x27;#ff8000&#x27;);</span><br></pre></td></tr></table></figure>
<p>通常情况下选择器可以直接定位到我们想要的元素，但是，当我们拿到一个jQuery对象后，还可以以这个对象为基准，进行查找和过滤。</p>
<p>最常见的查找是在某个节点的所有子节点中查找，使用<code>find()</code>方法，它本身又接收一个任意的选择器。例如如下的HTML结构：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- HTML结构 --&gt;</span><br><span class="line">&lt;ul class=&quot;lang&quot;&gt;</span><br><span class="line">    &lt;li class=&quot;js dy&quot;&gt;JavaScript&lt;/li&gt;</span><br><span class="line">    &lt;li class=&quot;dy&quot;&gt;Python&lt;/li&gt;</span><br><span class="line">    &lt;li id=&quot;swift&quot;&gt;Swift&lt;/li&gt;</span><br><span class="line">    &lt;li class=&quot;dy&quot;&gt;Scheme&lt;/li&gt;</span><br><span class="line">    &lt;li name=&quot;haskell&quot;&gt;Haskell&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>JavaScript</li>
<li>Python</li>
<li>Swift</li>
<li>Scheme</li>
<li>Haskell</li>
</ul>
<p>用<code>find()</code>查找：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ul = $(<span class="string">&#x27;ul.lang&#x27;</span>); <span class="comment">// 获得&lt;ul&gt;</span></span><br><span class="line"><span class="keyword">let</span> dy = ul.<span class="title function_">find</span>(<span class="string">&#x27;.dy&#x27;</span>); <span class="comment">// 获得JavaScript, Python, Scheme</span></span><br><span class="line"><span class="keyword">let</span> swf = ul.<span class="title function_">find</span>(<span class="string">&#x27;#swift&#x27;</span>); <span class="comment">// 获得Swift</span></span><br><span class="line"><span class="keyword">let</span> hsk = ul.<span class="title function_">find</span>(<span class="string">&#x27;[name=haskell]&#x27;</span>); <span class="comment">// 获得Haskell</span></span><br></pre></td></tr></table></figure>
<p>如果要从当前节点开始向上查找，使用<code>parent()</code>方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> swf = $(<span class="string">&#x27;#swift&#x27;</span>); <span class="comment">// 获得Swift</span></span><br><span class="line"><span class="keyword">let</span> parent = swf.<span class="title function_">parent</span>(); <span class="comment">// 获得Swift的上层节点&lt;ul&gt;</span></span><br><span class="line"><span class="keyword">let</span> a = swf.<span class="title function_">parent</span>(<span class="string">&#x27;.red&#x27;</span>); <span class="comment">// 获得Swift的上层节点&lt;ul&gt;，同时传入过滤条件。如果ul不符合条件，返回空jQuery对象</span></span><br></pre></td></tr></table></figure>
<p>对于位于同一层级的节点，可以通过<code>next()</code>和<code>prev()</code>方法，例如：</p>
<p>当我们已经拿到<code>Swift</code>节点后：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> swift = $(<span class="string">&#x27;#swift&#x27;</span>);</span><br><span class="line"></span><br><span class="line">swift.<span class="title function_">next</span>(); <span class="comment">// Scheme</span></span><br><span class="line">swift.<span class="title function_">next</span>(<span class="string">&#x27;[name=haskell]&#x27;</span>); <span class="comment">// 空的jQuery对象，因为Swift的下一个元素Scheme不符合条件[name=haskell]</span></span><br><span class="line"></span><br><span class="line">swift.<span class="title function_">prev</span>(); <span class="comment">// Python</span></span><br><span class="line">swift.<span class="title function_">prev</span>(<span class="string">&#x27;.dy&#x27;</span>); <span class="comment">// Python，因为Python同时符合过滤器条件.dy</span></span><br></pre></td></tr></table></figure>
<h3 id="过滤">过滤</h3>
<p>和函数式编程的map、filter类似，jQuery对象也有类似的方法。</p>
<p><code>filter()</code>方法可以过滤掉不符合选择器条件的节点：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> langs = $(<span class="string">&#x27;ul.lang li&#x27;</span>); <span class="comment">// 拿到JavaScript, Python, Swift, Scheme和Haskell</span></span><br><span class="line"><span class="keyword">let</span> a = langs.<span class="title function_">filter</span>(<span class="string">&#x27;.dy&#x27;</span>); <span class="comment">// 拿到JavaScript, Python, Scheme</span></span><br></pre></td></tr></table></figure>
<p>或者传入一个函数，要特别注意函数内部的<code>this</code>被绑定为DOM对象，不是jQuery对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> langs = $(<span class="string">&#x27;ul.lang li&#x27;</span>); <span class="comment">// 拿到JavaScript, Python, Swift, Scheme和Haskell</span></span><br><span class="line">langs.<span class="title function_">filter</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">innerHTML</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;S&#x27;</span>) === <span class="number">0</span>; <span class="comment">// 返回S开头的节点</span></span><br><span class="line">&#125;); <span class="comment">// 拿到Swift, Scheme</span></span><br></pre></td></tr></table></figure>
<p><code>map()</code>方法把一个jQuery对象包含的若干DOM节点转化为其他对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> langs = $(<span class="string">&#x27;ul.lang li&#x27;</span>); <span class="comment">// 拿到JavaScript, Python, Swift, Scheme和Haskell</span></span><br><span class="line"><span class="keyword">let</span> arr = langs.<span class="title function_">map</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">innerHTML</span>;</span><br><span class="line">&#125;).<span class="title function_">get</span>(); <span class="comment">// 用get()拿到包含string的Array：[&#x27;JavaScript&#x27;, &#x27;Python&#x27;, &#x27;Swift&#x27;, &#x27;Scheme&#x27;, &#x27;Haskell&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>此外，一个jQuery对象如果包含了不止一个DOM节点，<code>first()</code>、<code>last()</code>和<code>slice()</code>方法可以返回一个新的jQuery对象，把不需要的DOM节点去掉：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> langs = $(<span class="string">&#x27;ul.lang li&#x27;</span>); <span class="comment">// 拿到JavaScript, Python, Swift, Scheme和Haskell</span></span><br><span class="line"><span class="keyword">let</span> js = langs.<span class="title function_">first</span>(); <span class="comment">// JavaScript，相当于$(&#x27;ul.lang li:first-child&#x27;)</span></span><br><span class="line"><span class="keyword">let</span> haskell = langs.<span class="title function_">last</span>(); <span class="comment">// Haskell, 相当于$(&#x27;ul.lang li:last-child&#x27;)</span></span><br><span class="line"><span class="keyword">let</span> sub = langs.<span class="title function_">slice</span>(<span class="number">2</span>, <span class="number">4</span>); <span class="comment">// Swift, Scheme, 参数和数组的slice()方法一致</span></span><br></pre></td></tr></table></figure>
<h3 id="练习-3">练习</h3>
<p>对于下面的表单：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;test-form&quot;</span> <span class="attr">action</span>=<span class="string">&quot;#0&quot;</span> <span class="attr">onsubmit</span>=<span class="string">&quot;return false;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span>Name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span>Email: <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span>Password: <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Gender: <span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">value</span>=<span class="string">&quot;m&quot;</span> <span class="attr">checked</span>&gt;</span> Male<span class="tag">&lt;/<span class="name">label</span>&gt;</span> <span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">value</span>=<span class="string">&quot;f&quot;</span>&gt;</span> Female<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span>City: <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;city&quot;</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;BJ&quot;</span> <span class="attr">selected</span>&gt;</span>Beijing<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;SH&quot;</span>&gt;</span>Shanghai<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;CD&quot;</span>&gt;</span>Chengdu<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;XM&quot;</span>&gt;</span>Xiamen<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>输入值后，用jQuery获取表单的JSON字符串，key和value分别对应每个输入的name和相应的value，例如：<code>&#123;&quot;name&quot;:&quot;Michael&quot;,&quot;email&quot;:...&#125;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let json = ???;</span><br><span class="line"></span><br><span class="line">// 显示结果:</span><br><span class="line">if (typeof(json) === &#x27;string&#x27;) &#123;</span><br><span class="line">    console.log(json);</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">    console.log(&#x27;json变量不是string!&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>jQuery的选择器很强大，用起来又简单又灵活，但是搞了这么久，我拿到了jQuery对象，到底要干什么？</p>
<p>答案当然是操作对应的DOM节点啦！</p>
<p>回顾一下修改DOM的CSS、文本、设置HTML有多么麻烦，而且有的浏览器只有innerHTML，有的浏览器支持innerText，有了jQuery对象，不需要考虑浏览器差异了，全部统一操作！</p>
<h3 id="修改Text和HTML">修改Text和HTML</h3>
<p>jQuery对象的<code>text()</code>和<code>html()</code>方法分别获取节点的文本和原始HTML文本，例如，如下的HTML结构：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;test-ul&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;js&quot;</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">name</span>=<span class="string">&quot;book&quot;</span>&gt;</span>Java <span class="symbol">&amp;amp;</span> JavaScript<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>分别获取文本和HTML：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#test-ul li[name=book]&#x27;</span>).<span class="title function_">text</span>(); <span class="comment">// &#x27;Java &amp; JavaScript&#x27;</span></span><br><span class="line">$(<span class="string">&#x27;#test-ul li[name=book]&#x27;</span>).<span class="title function_">html</span>(); <span class="comment">// &#x27;Java &amp;amp; JavaScript&#x27;</span></span><br></pre></td></tr></table></figure>
<p>如何设置文本或HTML？jQuery的API设计非常巧妙：无参数调用<code>text()</code>是获取文本，传入参数就变成设置文本，HTML也是类似操作，自己动手试试：</p>
<ul>
<li>JavaScript</li>
<li>Java &amp; JavaScript</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let j1 = $(&#x27;#test-ul li.js&#x27;);</span><br><span class="line">let j2 = $(&#x27;#test-ul li[name=book]&#x27;);</span><br><span class="line"></span><br><span class="line">j1.html(&#x27;&lt;span style=&quot;color: #c00&quot;&gt;JavaScript&lt;/span&gt;&#x27;);</span><br><span class="line">j2.text(&#x27;JavaScript &amp; ECMAScript&#x27;);</span><br></pre></td></tr></table></figure>
<p>一个jQuery对象可以包含0个或任意个DOM对象，它的方法实际上会作用在对应的每个DOM节点上。在上面的例子中试试：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#test-ul li&#x27;</span>).<span class="title function_">text</span>(<span class="string">&#x27;JS&#x27;</span>); <span class="comment">// 是不是两个节点都变成了JS？</span></span><br></pre></td></tr></table></figure>
<p>所以jQuery对象的另一个好处是我们可以执行一个操作，作用在对应的一组DOM节点上。即使选择器没有返回任何DOM节点，调用jQuery对象的方法仍然不会报错：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果不存在id为not-exist的节点：</span></span><br><span class="line">$(<span class="string">&#x27;#not-exist&#x27;</span>).<span class="title function_">text</span>(<span class="string">&#x27;Hello&#x27;</span>); <span class="comment">// 代码不报错，没有节点被设置为&#x27;Hello&#x27;</span></span><br></pre></td></tr></table></figure>
<p>这意味着jQuery帮你免去了许多<code>if</code>语句。</p>
<h3 id="修改CSS">修改CSS</h3>
<p>jQuery对象有“批量操作”的特点，这用于修改CSS实在是太方便了。考虑下面的HTML结构：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;test-css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lang dy&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lang&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>Java<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lang dy&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lang&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>Swift<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lang dy&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>Scheme<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>要高亮显示动态语言，调用jQuery对象的<code>css('name', 'value')</code>方法，我们用一行语句实现：</p>
<ul>
<li>JavaScript</li>
<li>Java</li>
<li>Python</li>
<li>Swift</li>
<li>Scheme</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(&#x27;#test-css li.dy&gt;span&#x27;).css(&#x27;background-color&#x27;, &#x27;#ff0&#x27;).css(&#x27;color&#x27;, &#x27;#c00&#x27;);</span><br></pre></td></tr></table></figure>
<p><em>注意</em>，jQuery对象的所有方法都返回一个jQuery对象（可能是新的也可能是自身），这样我们可以进行链式调用，非常方便。</p>
<p>jQuery对象的<code>css()</code>方法可以这么用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> div = $(<span class="string">&#x27;#test-div&#x27;</span>);</span><br><span class="line">div.<span class="title function_">css</span>(<span class="string">&#x27;color&#x27;</span>); <span class="comment">// &#x27;#000033&#x27;, 获取CSS属性</span></span><br><span class="line">div.<span class="title function_">css</span>(<span class="string">&#x27;color&#x27;</span>, <span class="string">&#x27;#336699&#x27;</span>); <span class="comment">// 设置CSS属性</span></span><br><span class="line">div.<span class="title function_">css</span>(<span class="string">&#x27;color&#x27;</span>, <span class="string">&#x27;&#x27;</span>); <span class="comment">// 清除CSS属性</span></span><br></pre></td></tr></table></figure>
<p>为了和JavaScript保持一致，CSS属性可以用<code>'background-color'</code>和<code>'backgroundColor'</code>两种格式。</p>
<p><code>css()</code>方法将作用于DOM节点的<code>style</code>属性，具有最高优先级。如果要修改<code>class</code>属性，可以用jQuery提供的下列方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> div = $(<span class="string">&#x27;#test-div&#x27;</span>);</span><br><span class="line">div.<span class="title function_">hasClass</span>(<span class="string">&#x27;highlight&#x27;</span>); <span class="comment">// false， class是否包含highlight</span></span><br><span class="line">div.<span class="title function_">addClass</span>(<span class="string">&#x27;highlight&#x27;</span>); <span class="comment">// 添加highlight这个class</span></span><br><span class="line">div.<span class="title function_">removeClass</span>(<span class="string">&#x27;highlight&#x27;</span>); <span class="comment">// 删除highlight这个class</span></span><br></pre></td></tr></table></figure>
<p>练习：分别用<code>css()</code>方法和<code>addClass()</code>方法高亮显示JavaScript：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.highlight</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#c00</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#ff0</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;test-highlight-css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;py&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;js&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;sw&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>Swift<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;hk&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>Haskell<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Python</li>
<li>JavaScript</li>
<li>Swift</li>
<li>Haskell</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let div = $(&#x27;#test-highlight-css&#x27;);</span><br><span class="line">// TODO:</span><br></pre></td></tr></table></figure>
<h3 id="显示和隐藏DOM">显示和隐藏DOM</h3>
<p>要隐藏一个DOM，我们可以设置CSS的<code>display</code>属性为<code>none</code>，利用<code>css()</code>方法就可以实现。不过，要显示这个DOM就需要恢复原有的<code>display</code>属性，这就得先记下来原有的<code>display</code>属性到底是<code>block</code>还是<code>inline</code>还是别的值。</p>
<p>考虑到显示和隐藏DOM元素使用非常普遍，jQuery直接提供<code>show()</code>和<code>hide()</code>方法，我们不用关心它是如何修改<code>display</code>属性的，总之它能正常工作：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = $(<span class="string">&#x27;a[target=_blank]&#x27;</span>);</span><br><span class="line">a.<span class="title function_">hide</span>(); <span class="comment">// 隐藏</span></span><br><span class="line">a.<span class="title function_">show</span>(); <span class="comment">// 显示</span></span><br></pre></td></tr></table></figure>
<p><em>注意</em>，隐藏DOM节点并未改变DOM树的结构，它只影响DOM节点的显示。这和删除DOM节点是不同的。</p>
<h3 id="获取DOM信息">获取DOM信息</h3>
<p>利用jQuery对象的若干方法，我们直接可以获取DOM的高宽等信息，而无需针对不同浏览器编写特定代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 浏览器可视窗口大小:</span></span><br><span class="line">$(<span class="variable language_">window</span>).<span class="title function_">width</span>(); <span class="comment">// 800</span></span><br><span class="line">$(<span class="variable language_">window</span>).<span class="title function_">height</span>(); <span class="comment">// 600</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// HTML文档大小:</span></span><br><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">width</span>(); <span class="comment">// 800</span></span><br><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">height</span>(); <span class="comment">// 3500</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 某个div的大小:</span></span><br><span class="line"><span class="keyword">let</span> div = $(<span class="string">&#x27;#test-div&#x27;</span>);</span><br><span class="line">div.<span class="title function_">width</span>(); <span class="comment">// 600</span></span><br><span class="line">div.<span class="title function_">height</span>(); <span class="comment">// 300</span></span><br><span class="line">div.<span class="title function_">width</span>(<span class="number">400</span>); <span class="comment">// 设置CSS属性 width: 400px，是否生效要看CSS是否有效</span></span><br><span class="line">div.<span class="title function_">height</span>(<span class="string">&#x27;200px&#x27;</span>); <span class="comment">// 设置CSS属性 height: 200px，是否生效要看CSS是否有效</span></span><br></pre></td></tr></table></figure>
<p><code>attr()</code>和<code>removeAttr()</code>方法用于操作DOM节点的属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;div id=&quot;test-div&quot; name=&quot;Test&quot; start=&quot;1&quot;&gt;...&lt;/div&gt;</span></span><br><span class="line"><span class="keyword">let</span> div = $(<span class="string">&#x27;#test-div&#x27;</span>);</span><br><span class="line">div.<span class="title function_">attr</span>(<span class="string">&#x27;data&#x27;</span>); <span class="comment">// undefined, 属性不存在</span></span><br><span class="line">div.<span class="title function_">attr</span>(<span class="string">&#x27;name&#x27;</span>); <span class="comment">// &#x27;Test&#x27;</span></span><br><span class="line">div.<span class="title function_">attr</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;Hello&#x27;</span>); <span class="comment">// div的name属性变为&#x27;Hello&#x27;</span></span><br><span class="line">div.<span class="title function_">removeAttr</span>(<span class="string">&#x27;name&#x27;</span>); <span class="comment">// 删除name属性</span></span><br><span class="line">div.<span class="title function_">attr</span>(<span class="string">&#x27;name&#x27;</span>); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<p><code>prop()</code>方法和<code>attr()</code>类似，但是HTML5规定有一种属性在DOM节点中可以没有值，只有出现与不出现两种，例如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;test-radio&quot;</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;test&quot;</span> <span class="attr">checked</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>等价于：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;test-radio&quot;</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;test&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>attr()</code>和<code>prop()</code>对于属性<code>checked</code>处理有所不同：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> radio = $(<span class="string">&#x27;#test-radio&#x27;</span>);</span><br><span class="line">radio.<span class="title function_">attr</span>(<span class="string">&#x27;checked&#x27;</span>); <span class="comment">// &#x27;checked&#x27;</span></span><br><span class="line">radio.<span class="title function_">prop</span>(<span class="string">&#x27;checked&#x27;</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p><code>prop()</code>返回值更合理一些。不过，用<code>is()</code>方法判断更好：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> radio = $(<span class="string">&#x27;#test-radio&#x27;</span>);</span><br><span class="line">radio.<span class="title function_">is</span>(<span class="string">&#x27;:checked&#x27;</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>类似的属性还有<code>selected</code>，处理时最好用<code>is(':selected')</code>。</p>
<h3 id="操作表单">操作表单</h3>
<p>对于表单元素，jQuery对象统一提供<code>val()</code>方法获取和设置对应的<code>value</code>属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    &lt;input id=&quot;test-input&quot; name=&quot;email&quot; value=&quot;test&quot;&gt;</span></span><br><span class="line"><span class="comment">    &lt;select id=&quot;test-select&quot; name=&quot;city&quot;&gt;</span></span><br><span class="line"><span class="comment">        &lt;option value=&quot;BJ&quot; selected&gt;Beijing&lt;/option&gt;</span></span><br><span class="line"><span class="comment">        &lt;option value=&quot;SH&quot;&gt;Shanghai&lt;/option&gt;</span></span><br><span class="line"><span class="comment">        &lt;option value=&quot;SZ&quot;&gt;Shenzhen&lt;/option&gt;</span></span><br><span class="line"><span class="comment">    &lt;/select&gt;</span></span><br><span class="line"><span class="comment">    &lt;textarea id=&quot;test-textarea&quot;&gt;Hello&lt;/textarea&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">let</span></span><br><span class="line">    input = $(<span class="string">&#x27;#test-input&#x27;</span>),</span><br><span class="line">    select = $(<span class="string">&#x27;#test-select&#x27;</span>),</span><br><span class="line">    textarea = $(<span class="string">&#x27;#test-textarea&#x27;</span>);</span><br><span class="line"></span><br><span class="line">input.<span class="title function_">val</span>(); <span class="comment">// &#x27;test&#x27;</span></span><br><span class="line">input.<span class="title function_">val</span>(<span class="string">&#x27;abc@example.com&#x27;</span>); <span class="comment">// 文本框的内容已变为abc@example.com</span></span><br><span class="line"></span><br><span class="line">select.<span class="title function_">val</span>(); <span class="comment">// &#x27;BJ&#x27;</span></span><br><span class="line">select.<span class="title function_">val</span>(<span class="string">&#x27;SH&#x27;</span>); <span class="comment">// 选择框已变为Shanghai</span></span><br><span class="line"></span><br><span class="line">textarea.<span class="title function_">val</span>(); <span class="comment">// &#x27;Hello&#x27;</span></span><br><span class="line">textarea.<span class="title function_">val</span>(<span class="string">&#x27;Hi&#x27;</span>); <span class="comment">// 文本区域已更新为&#x27;Hi&#x27;</span></span><br></pre></td></tr></table></figure>
<p>可见，一个<code>val()</code>就统一了各种输入框的取值和赋值的问题。</p>
<p>直接使用浏览器提供的API对DOM结构进行修改，不但代码复杂，而且要针对浏览器写不同的代码。</p>
<p>有了jQuery，我们就专注于操作jQuery对象本身，底层的DOM操作由jQuery完成就可以了，这样一来，修改DOM也大大简化了。</p>
<h3 id="添加DOM">添加DOM</h3>
<p>要添加新的DOM节点，除了通过jQuery的<code>html()</code>这种暴力方法外，还可以用<code>append()</code>方法，例如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;test-div&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>Swift<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如何向列表新增一个语言？首先要拿到<code>&lt;ul&gt;</code>节点：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ul = $(<span class="string">&#x27;#test-div&gt;ul&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>然后，调用<code>append()</code>传入HTML片段：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ul.<span class="title function_">append</span>(<span class="string">&#x27;&lt;li&gt;&lt;span&gt;Haskell&lt;/span&gt;&lt;/li&gt;&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>除了接受字符串，<code>append()</code>还可以传入原始的DOM对象，jQuery对象和函数对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建DOM对象:</span></span><br><span class="line"><span class="keyword">let</span> ps = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;li&#x27;</span>);</span><br><span class="line">ps.<span class="property">innerHTML</span> = <span class="string">&#x27;&lt;span&gt;Pascal&lt;/span&gt;&#x27;</span>;</span><br><span class="line"><span class="comment">// 添加DOM对象:</span></span><br><span class="line">ul.<span class="title function_">append</span>(ps);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加jQuery对象:</span></span><br><span class="line">ul.<span class="title function_">append</span>($(<span class="string">&#x27;#scheme&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加函数对象:</span></span><br><span class="line">ul.<span class="title function_">append</span>(<span class="keyword">function</span> (<span class="params">index, html</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&lt;li&gt;&lt;span&gt;Language - &#x27;</span> + index + <span class="string">&#x27;&lt;/span&gt;&lt;/li&gt;&#x27;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>传入函数时，要求返回一个字符串、DOM对象或者jQuery对象。因为jQuery的<code>append()</code>可能作用于一组DOM节点，只有传入函数才能针对每个DOM生成不同的子节点。</p>
<p><code>append()</code>把DOM添加到最后，<code>prepend()</code>则把DOM添加到最前。</p>
<p>另外注意，如果要添加的DOM节点已经存在于HTML文档中，它会首先从文档移除，然后再添加，也就是说，用<code>append()</code>，你可以移动一个DOM节点。</p>
<p>如果要把新节点插入到指定位置，例如，JavaScript和Python之间，那么，可以先定位到JavaScript，然后用<code>after()</code>方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> js = $(<span class="string">&#x27;#test-div&gt;ul&gt;li:first-child&#x27;</span>);</span><br><span class="line">js.<span class="title function_">after</span>(<span class="string">&#x27;&lt;li&gt;&lt;span&gt;Lua&lt;/span&gt;&lt;/li&gt;&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>也就是说，同级节点可以用<code>after()</code>或者<code>before()</code>方法。</p>
<h3 id="删除节点">删除节点</h3>
<p>要删除DOM节点，拿到jQuery对象后直接调用<code>remove()</code>方法就可以了。如果jQuery对象包含若干DOM节点，实际上可以一次删除多个DOM节点：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> li = $(<span class="string">&#x27;#test-div&gt;ul&gt;li&#x27;</span>);</span><br><span class="line">li.<span class="title function_">remove</span>(); <span class="comment">// 所有&lt;li&gt;全被删除</span></span><br></pre></td></tr></table></figure>
<h3 id="练习-4">练习</h3>
<p>除了列出的3种语言外，请再添加Pascal、Lua和Ruby，然后按字母顺序排序节点：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;test-div&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>Swift<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>JavaScript</li>
<li>Python</li>
<li>Swift</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// TODO:</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">(function () &#123;</span><br><span class="line">    let s = $(&#x27;#test-div&gt;ul&gt;li&#x27;).map(function () &#123;</span><br><span class="line">        return $(this).text();</span><br><span class="line">    &#125;).get().join(&#x27;,&#x27;);</span><br><span class="line">    if (s === &#x27;JavaScript,Lua,Pascal,Python,Ruby,Swift&#x27;) &#123;</span><br><span class="line">        console.log(&#x27;测试通过!&#x27;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(&#x27;测试失败: &#x27; + s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>因为JavaScript在浏览器中以单线程模式运行，页面加载后，一旦页面上所有的JavaScript代码被执行完后，就只能依赖触发事件来执行JavaScript代码。</p>
<p>浏览器在接收到用户的鼠标或键盘输入后，会自动在对应的DOM节点上触发相应的事件。如果该节点已经绑定了对应的JavaScript处理函数，该函数就会自动调用。</p>
<p>由于不同的浏览器绑定事件的代码都不太一样，所以用jQuery来写代码，就屏蔽了不同浏览器的差异，我们总是编写相同的代码。</p>
<p>举个例子，假设要在用户点击了超链接时弹出提示框，我们用jQuery这样绑定一个<code>click</code>事件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/* HTML:</span><br><span class="line"> *</span><br><span class="line"> * &lt;a id=&quot;test-link&quot; href=&quot;#0&quot;&gt;点我试试&lt;/a&gt;</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">// 获取超链接的jQuery对象:</span><br><span class="line">let a = $(&#x27;#test-link&#x27;);</span><br><span class="line">a.on(&#x27;click&#x27;, function () &#123;</span><br><span class="line">    alert(&#x27;Hello!&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>实测：<a href="#0">点我试试</a></p>
<p><code>on</code>方法用来绑定一个事件，我们需要传入事件名称和对应的处理函数。</p>
<p>另一种更简化的写法是直接调用<code>click()</code>方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a.<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;Hello!&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>两者完全等价。我们通常用后面的写法。</p>
<p>jQuery能够绑定的事件主要包括：</p>
<h3 id="鼠标事件">鼠标事件</h3>
<ul>
<li>click: 鼠标单击时触发；</li>
<li>dblclick：鼠标双击时触发；</li>
<li>mouseenter：鼠标进入时触发；</li>
<li>mouseleave：鼠标移出时触发；</li>
<li>mousemove：鼠标在DOM内部移动时触发；</li>
<li>hover：鼠标进入和退出时触发两个函数，相当于mouseenter加上mouseleave。</li>
</ul>
<h3 id="键盘事件">键盘事件</h3>
<p>键盘事件仅作用在当前焦点的DOM上，通常是<code>&lt;input&gt;</code>和<code>&lt;textarea&gt;</code>。</p>
<ul>
<li>keydown：键盘按下时触发；</li>
<li>keyup：键盘松开时触发；</li>
<li>keypress：按一次键后触发。</li>
</ul>
<h3 id="其他事件">其他事件</h3>
<ul>
<li>focus：当DOM获得焦点时触发；</li>
<li>blur：当DOM失去焦点时触发；</li>
<li>change：当<code>&lt;input&gt;</code>、<code>&lt;select&gt;</code>或<code>&lt;textarea&gt;</code>的内容改变时触发；</li>
<li>submit：当<code>&lt;form&gt;</code>提交时触发；</li>
<li>ready：当页面被载入并且DOM树完成初始化后触发。</li>
</ul>
<p>其中，<code>ready</code>仅作用于<code>document</code>对象。由于<code>ready</code>事件在DOM完成初始化后触发，且只触发一次，所以非常适合用来写其他的初始化代码。假设我们想给一个<code>&lt;form&gt;</code>表单绑定<code>submit</code>事件，下面的代码没有预期的效果：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 代码有误:</span></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&#x27;#testForm&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;submit&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(<span class="string">&#x27;submit!&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;testForm&quot;</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>因为JavaScript在此执行的时候，<code>&lt;form&gt;</code>尚未载入浏览器，所以<code>$('#testForm)</code>返回<code>[]</code>，并没有绑定事件到任何DOM上。</p>
<p>所以我们自己的初始化代码必须放到<code>document</code>对象的<code>ready</code>事件中，保证DOM已完成初始化：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">        $(document).on(&#x27;ready&#x27;, function () &#123;</span><br><span class="line">            $(&#x27;#testForm).on(&#x27;submit&#x27;, function () &#123;</span><br><span class="line">                alert(&#x27;submit!&#x27;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;testForm&quot;</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样写就没有问题了。因为相关代码会在DOM树初始化后再执行。</p>
<p>由于<code>ready</code>事件使用非常普遍，所以可以这样简化：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// on(&#x27;submit&#x27;, function)也可以简化:</span></span><br><span class="line">    $(<span class="string">&#x27;#testForm).submit(function () &#123;</span></span><br><span class="line"><span class="string">        alert(&#x27;</span>submit!<span class="string">&#x27;);</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">&#125;);</span></span><br></pre></td></tr></table></figure>
<p>甚至还可以再简化为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// init...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>上面的这种写法最为常见。如果你遇到<code>$(function () &#123;...&#125;)</code>的形式，牢记这是<code>document</code>对象的<code>ready</code>事件处理函数。</p>
<p>完全可以反复绑定事件处理函数，它们会依次执行：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;init A...&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">$(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;init B...&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">$(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;init C...&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="事件参数">事件参数</h3>
<p>有些事件，如<code>mousemove</code>和<code>keypress</code>，我们需要获取鼠标位置和按键的值，否则监听这些事件就没什么意义了。所有事件都会传入<code>Event</code>对象作为参数，可以从<code>Event</code>对象上获取到更多的信息：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    $(<span class="string">&#x27;#testMouseMoveDiv&#x27;</span>).<span class="title function_">mousemove</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        $(<span class="string">&#x27;#testMouseMoveSpan&#x27;</span>).<span class="title function_">text</span>(<span class="string">&#x27;pageX = &#x27;</span> + e.<span class="property">pageX</span> + <span class="string">&#x27;, pageY = &#x27;</span> + e.<span class="property">pageY</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="取消绑定">取消绑定</h3>
<p>一个已被绑定的事件可以解除绑定，通过<code>off('click', function)</code>实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hello</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;hello!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a.<span class="title function_">click</span>(hello); <span class="comment">// 绑定事件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 10秒钟后解除绑定:</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    a.<span class="title function_">off</span>(<span class="string">&#x27;click&#x27;</span>, hello);</span><br><span class="line">&#125;, <span class="number">10000</span>);</span><br></pre></td></tr></table></figure>
<p>需要特别注意的是，下面这种写法是无效的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 绑定事件:</span></span><br><span class="line">a.<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;hello!&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解除绑定:</span></span><br><span class="line">a.<span class="title function_">off</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;hello!&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这是因为两个匿名函数虽然长得一模一样，但是它们是两个<em>不同</em>的函数对象，<code>off('click', function () &#123;...&#125;)</code>无法移除已绑定的第一个匿名函数。</p>
<p>为了实现移除效果，可以使用<code>off('click')</code>一次性移除已绑定的<code>click</code>事件的所有处理函数。</p>
<p>同理，无参数调用<code>off()</code>一次性移除已绑定的所有类型的事件处理函数。</p>
<h3 id="事件触发条件">事件触发条件</h3>
<p>一个需要注意的问题是，事件的触发总是由用户操作引发的。例如，我们监控文本框的内容改动：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> input = $(<span class="string">&#x27;#test-input&#x27;</span>);</span><br><span class="line">input.<span class="title function_">change</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;changed...&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当用户在文本框中输入时，就会触发<code>change</code>事件。但是，如果用JavaScript代码去改动文本框的值，将<em>不会</em>触发<code>change</code>事件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> input = $(<span class="string">&#x27;#test-input&#x27;</span>);</span><br><span class="line">input.<span class="title function_">val</span>(<span class="string">&#x27;change it!&#x27;</span>); <span class="comment">// 无法触发change事件</span></span><br></pre></td></tr></table></figure>
<p>有些时候，我们希望用代码触发<code>change</code>事件，可以直接调用无参数的<code>change()</code>方法来触发该事件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> input = $(<span class="string">&#x27;#test-input&#x27;</span>);</span><br><span class="line">input.<span class="title function_">val</span>(<span class="string">&#x27;change it!&#x27;</span>);</span><br><span class="line">input.<span class="title function_">change</span>(); <span class="comment">// 触发change事件</span></span><br></pre></td></tr></table></figure>
<p><code>input.change()</code>相当于<code>input.trigger('change')</code>，它是<code>trigger()</code>方法的简写。</p>
<p>为什么我们希望手动触发一个事件呢？如果不这么做，很多时候，我们就得写两份一模一样的代码。</p>
<h3 id="练习-5">练习</h3>
<p>对如下的Form表单：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;test-form&quot;</span> <span class="attr">action</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">legend</span>&gt;</span>请选择想要学习的编程语言：<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;selectAll&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;selectAll&quot;</span>&gt;</span>全选<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;deselectAll&quot;</span>&gt;</span>全不选<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#0&quot;</span> <span class="attr">class</span>=<span class="string">&quot;invertSelect&quot;</span>&gt;</span>反选<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lang&quot;</span> <span class="attr">value</span>=<span class="string">&quot;javascript&quot;</span>&gt;</span> JavaScript<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lang&quot;</span> <span class="attr">value</span>=<span class="string">&quot;python&quot;</span>&gt;</span> Python<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lang&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ruby&quot;</span>&gt;</span> Ruby<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lang&quot;</span> <span class="attr">value</span>=<span class="string">&quot;haskell&quot;</span>&gt;</span> Haskell<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lang&quot;</span> <span class="attr">value</span>=<span class="string">&quot;scheme&quot;</span>&gt;</span> Scheme<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>绑定合适的事件处理函数，实现以下逻辑：</p>
<p>当用户勾上“全选”时，自动选中所有语言，并把“全选”变成“全不选”；</p>
<p>当用户去掉“全不选”时，自动不选中所有语言；</p>
<p>当用户点击“反选”时，自动把所有语言状态反转（选中的变为未选，未选的变为选中）；</p>
<p>当用户把所有语言都手动勾上时，“全选”被自动勾上，并变为“全不选”；</p>
<p>当用户手动去掉选中至少一种语言时，“全不选”自动被去掉选中，并变为“全选”。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">let</span><br><span class="line">    form = $(&#x27;#test-form&#x27;),</span><br><span class="line">    langs = form.find(&#x27;[name=lang]&#x27;),</span><br><span class="line">    selectAll = form.find(&#x27;label.selectAll :checkbox&#x27;),</span><br><span class="line">    selectAllLabel = form.find(&#x27;label.selectAll span.selectAll&#x27;),</span><br><span class="line">    deselectAllLabel = form.find(&#x27;label.selectAll span.deselectAll&#x27;),</span><br><span class="line">    invertSelect = form.find(&#x27;a.invertSelect&#x27;);</span><br><span class="line"></span><br><span class="line">// 重置初始化状态:</span><br><span class="line">form.find(&#x27;*&#x27;).show().off();</span><br><span class="line">form.find(&#x27;:checkbox&#x27;).prop(&#x27;checked&#x27;, false).off();</span><br><span class="line">deselectAllLabel.hide();</span><br><span class="line">// 拦截form提交事件:</span><br><span class="line">form.off().submit(function (e) &#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    alert(form.serialize());</span><br><span class="line">&#125;);</span><br><span class="line">// TODO:绑定事件</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">console.log(&#x27;请测试功能是否正常。&#x27;);</span><br></pre></td></tr></table></figure>
<p>用JavaScript实现动画，原理非常简单：我们只需要以固定的时间间隔（例如，0.1秒），每次把DOM元素的CSS样式修改一点（例如，高宽各增加10%），看起来就像动画了。</p>
<p>但是要用JavaScript手动实现动画效果，需要编写非常复杂的代码。如果想要把动画效果用函数封装起来便于复用，那考虑的事情就更多了。</p>
<p>使用jQuery实现动画，代码已经简单得不能再简化了：只需要一行代码！</p>
<p>让我们先来看看jQuery内置的几种动画样式：</p>
<h3 id="show-hide">show / hide</h3>
<p>直接以无参数形式调用<code>show()</code>和<code>hide()</code>，会显示和隐藏DOM元素。但是，只要传递一个时间参数进去，就变成了动画：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> div = $(<span class="string">&#x27;#test-show-hide&#x27;</span>);</span><br><span class="line">div.<span class="title function_">hide</span>(<span class="number">3000</span>); <span class="comment">// 在3秒钟内逐渐消失</span></span><br></pre></td></tr></table></figure>
<p>时间以毫秒为单位，但也可以是<code>'slow'</code>，<code>'fast'</code>这些字符串：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> div = $(<span class="string">&#x27;#test-show-hide&#x27;</span>);</span><br><span class="line">div.<span class="title function_">show</span>(<span class="string">&#x27;slow&#x27;</span>); <span class="comment">// 在0.6秒钟内逐渐显示</span></span><br></pre></td></tr></table></figure>
<p><code>toggle()</code>方法则根据当前状态决定是<code>show()</code>还是<code>hide()</code>。</p>
<p>效果实测：</p>
<h3 id="slideUp-slideDown">slideUp / slideDown</h3>
<p>你可能已经看出来了，<code>show()</code>和<code>hide()</code>是从左上角逐渐展开或收缩的，而<code>slideUp()</code>和<code>slideDown()</code>则是在垂直方向逐渐展开或收缩的。</p>
<p><code>slideUp()</code>把一个可见的DOM元素收起来，效果跟拉上窗帘似的，<code>slideDown()</code>相反，而<code>slideToggle()</code>则根据元素是否可见来决定下一步动作：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> div = $(<span class="string">&#x27;#test-slide&#x27;</span>);</span><br><span class="line">div.<span class="title function_">slideUp</span>(<span class="number">3000</span>); <span class="comment">// 在3秒钟内逐渐向上消失</span></span><br></pre></td></tr></table></figure>
<p>效果实测：</p>
<h3 id="fadeIn-fadeOut">fadeIn / fadeOut</h3>
<p><code>fadeIn()</code>和<code>fadeOut()</code>的动画效果是淡入淡出，也就是通过不断设置DOM元素的<code>opacity</code>属性来实现，而<code>fadeToggle()</code>则根据元素是否可见来决定下一步动作：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> div = $(<span class="string">&#x27;#test-fade&#x27;</span>);</span><br><span class="line">div.<span class="title function_">fadeOut</span>(<span class="string">&#x27;slow&#x27;</span>); <span class="comment">// 在0.6秒内淡出</span></span><br></pre></td></tr></table></figure>
<h3 id="自定义动画">自定义动画</h3>
<p>如果上述动画效果还不能满足你的要求，那就祭出最后大招：<code>animate()</code>，它可以实现任意动画效果，我们需要传入的参数就是DOM元素最终的CSS状态和时间，jQuery在时间段内不断调整CSS直到达到我们设定的值：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> div = $(<span class="string">&#x27;#test-animate&#x27;</span>);</span><br><span class="line">div.<span class="title function_">animate</span>(&#123;</span><br><span class="line">    <span class="attr">opacity</span>: <span class="number">0.25</span>,</span><br><span class="line">    <span class="attr">width</span>: <span class="string">&#x27;256px&#x27;</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="string">&#x27;256px&#x27;</span></span><br><span class="line">&#125;, <span class="number">3000</span>); <span class="comment">// 在3秒钟内CSS过渡到设定值</span></span><br></pre></td></tr></table></figure>
<p><code>animate()</code>还可以再传入一个函数，当动画结束时，该函数将被调用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> div = $(<span class="string">&#x27;#test-animate&#x27;</span>);</span><br><span class="line">div.<span class="title function_">animate</span>(&#123;</span><br><span class="line">    <span class="attr">opacity</span>: <span class="number">0.25</span>,</span><br><span class="line">    <span class="attr">width</span>: <span class="string">&#x27;256px&#x27;</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="string">&#x27;256px&#x27;</span></span><br><span class="line">&#125;, <span class="number">3000</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;动画已结束&#x27;</span>);</span><br><span class="line">    <span class="comment">// 恢复至初始状态:</span></span><br><span class="line">    $(<span class="variable language_">this</span>).<span class="title function_">css</span>(<span class="string">&#x27;opacity&#x27;</span>, <span class="string">&#x27;1.0&#x27;</span>).<span class="title function_">css</span>(<span class="string">&#x27;width&#x27;</span>, <span class="string">&#x27;128px&#x27;</span>).<span class="title function_">css</span>(<span class="string">&#x27;height&#x27;</span>, <span class="string">&#x27;128px&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>实际上这个回调函数参数对于基本动画也是适用的。</p>
<p>有了<code>animate()</code>，你就可以实现各种自定义动画效果了：</p>
<h3 id="串行动画">串行动画</h3>
<p>jQuery的动画效果还可以串行执行，通过<code>delay()</code>方法还可以实现暂停，这样，我们可以实现更复杂的动画效果，而代码却相当简单：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> div = $(<span class="string">&#x27;#test-animates&#x27;</span>);</span><br><span class="line"><span class="comment">// 动画效果：slideDown - 暂停 - 放大 - 暂停 - 缩小</span></span><br><span class="line">div.<span class="title function_">slideDown</span>(<span class="number">2000</span>)</span><br><span class="line">   .<span class="title function_">delay</span>(<span class="number">1000</span>)</span><br><span class="line">   .<span class="title function_">animate</span>(&#123;</span><br><span class="line">       <span class="attr">width</span>: <span class="string">&#x27;256px&#x27;</span>,</span><br><span class="line">       <span class="attr">height</span>: <span class="string">&#x27;256px&#x27;</span></span><br><span class="line">   &#125;, <span class="number">2000</span>)</span><br><span class="line">   .<span class="title function_">delay</span>(<span class="number">1000</span>)</span><br><span class="line">   .<span class="title function_">animate</span>(&#123;</span><br><span class="line">       <span class="attr">width</span>: <span class="string">&#x27;128px&#x27;</span>,</span><br><span class="line">       <span class="attr">height</span>: <span class="string">&#x27;128px&#x27;</span></span><br><span class="line">   &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>因为动画需要执行一段时间，所以jQuery必须不断返回新的Promise对象才能后续执行操作。简单地把动画封装在函数中是不够的。</p>
<p>效果实测：</p>
<h3 id="为什么有的动画没有效果">为什么有的动画没有效果</h3>
<p>你可能会遇到，有的动画如<code>slideUp()</code>根本没有效果。这是因为jQuery动画的原理是逐渐改变CSS的值，如<code>height</code>从<code>100px</code>逐渐变为<code>0</code>。但是很多不是block性质的DOM元素，对它们设置<code>height</code>根本就不起作用，所以动画也就没有效果。</p>
<p>此外，jQuery也没有实现对<code>background-color</code>的动画效果，用<code>animate()</code>设置<code>background-color</code>也没有效果。这种情况下可以使用CSS3的<code>transition</code>实现动画效果。</p>
<h3 id="练习-6">练习</h3>
<p>在执行删除操作时，给用户显示一个动画比直接调用<code>remove()</code>要更好。请在表格删除一行的时候添加一个淡出的动画效果：</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Email</th>
<th>Address</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>Bart Simpson</td>
<td>bart.s@primary.school</td>
<td>Springfield</td>
<td>Active</td>
</tr>
<tr>
<td>Michael Scofield</td>
<td><a href="mailto:m.scofield@escape.org">m.scofield@escape.org</a></td>
<td>Fox River</td>
<td>Locked</td>
</tr>
<tr>
<td>Optimus Prime</td>
<td><a href="mailto:prime@cybertron.org">prime@cybertron.org</a></td>
<td>Cybertron</td>
<td>Active</td>
</tr>
<tr>
<td>Peter Parker</td>
<td><a href="mailto:spider@movie.org">spider@movie.org</a></td>
<td>New York</td>
<td>Active</td>
</tr>
<tr>
<td>Thor Odinson</td>
<td><a href="mailto:thor@asgard.org">thor@asgard.org</a></td>
<td>Asgard</td>
<td>Active</td>
</tr>
</tbody>
</table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function deleteFirstTR() &#123;</span><br><span class="line">    let tr = $(&#x27;#test-table&gt;tbody&gt;tr:visible&#x27;).first();</span><br><span class="line">    // TODO:</span><br><span class="line">    tr.remove();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">deleteFirstTR();</span><br></pre></td></tr></table></figure>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../../2024/01/16/JavaScript/JavaScript-jQuery/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../../2024/01/15/JavaScript/JavaScript-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/"
                            aria-label=": JavaScript-错误处理"
                        >
                            JavaScript-错误处理
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2024-01-15T21:45:51+08:00">
	
		    2024 年 1 月 15 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../../categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a>, <a class="category-link" href="../../../categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/JavaScript/">JavaScript</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>在执行JavaScript代码的时候，有些情况下会发生错误。</p>
<p>错误分两种，一种是程序写的逻辑不对，导致代码执行异常。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">let</span> len = s.<span class="property">length</span>; <span class="comment">// TypeError：null变量没有length属性</span></span><br></pre></td></tr></table></figure>
<p>对于这种错误，要修复程序。</p>
<p>一种是执行过程中，程序可能遇到无法预测的异常情况而报错，例如，网络连接中断，读取不存在的文件，没有操作权限等。</p>
<p>对于这种错误，我们需要处理它，并可能需要给用户反馈。</p>
<p>错误处理是程序设计时必须要考虑的问题。对于C这样贴近系统底层的语言，错误是通过错误码返回的：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> fd = open(<span class="string">&quot;/path/to/file&quot;</span>, O_RDONLY);</span><br><span class="line"><span class="keyword">if</span> (fd == <span class="number">-1</span>) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Error when open file!&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// TODO</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过错误码返回错误，就需要约定什么是正确的返回值，什么是错误的返回值。上面的<code>open()</code>函数约定返回<code>-1</code>表示错误。</p>
<p>显然，这种用错误码表示错误在编写程序时十分不便。</p>
<p>因此，高级语言通常都提供了更抽象的错误处理逻辑try … catch … finally，JavaScript也不例外。</p>
<h3 id="try-…-catch-…-finally">try … catch … finally</h3>
<p>使用try … catch … finally处理错误时，我们编写的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">let r1, r2, s = null;</span><br><span class="line">try &#123;</span><br><span class="line">    r1 = s.length; // 此处应产生错误</span><br><span class="line">    r2 = 100; // 该语句不会执行</span><br><span class="line">&#125; catch (e) &#123;</span><br><span class="line">    console.log(&#x27;出错了：&#x27; + e);</span><br><span class="line">&#125; finally &#123;</span><br><span class="line">    console.log(&#x27;finally&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">console.log(&#x27;r1 = &#x27; + r1); // r1应为undefined</span><br><span class="line">console.log(&#x27;r2 = &#x27; + r2); // r2应为undefined</span><br></pre></td></tr></table></figure>
<p>运行后可以发现，输出提示类似“出错了：TypeError: Cannot read property ‘length’ of null”。</p>
<p>我们来分析一下使用try … catch … finally的执行流程。</p>
<p>当代码块被<code>try &#123; ... &#125;</code>包裹的时候，就表示这部分代码执行过程中可能会发生错误，一旦发生错误，就不再继续执行后续代码，转而跳到<code>catch</code>块。<code>catch (e) &#123; ... &#125;</code>包裹的代码就是错误处理代码，变量<code>e</code>表示捕获到的错误。最后，无论有没有错误，<code>finally</code>一定会被执行。</p>
<p>所以，有错误发生时，执行流程像这样：</p>
<ol>
<li>先执行<code>try &#123; ... &#125;</code>的代码；</li>
<li>执行到出错的语句时，后续语句不再继续执行，转而执行<code>catch (e) &#123; ... &#125;</code>代码；</li>
<li>最后执行<code>finally &#123; ... &#125;</code>代码。</li>
</ol>
<p>而没有错误发生时，执行流程像这样：</p>
<ol>
<li>先执行<code>try &#123; ... &#125;</code>的代码；</li>
<li>因为没有出错，<code>catch (e) &#123; ... &#125;</code>代码不会被执行；</li>
<li>最后执行<code>finally &#123; ... &#125;</code>代码。</li>
</ol>
<p>最后请注意，<code>catch</code>和<code>finally</code>可以不必都出现。也就是说，<code>try</code>语句一共有三种形式：</p>
<p>完整的try … catch … finally：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>只有try … catch，没有finally：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>只有try … finally，没有catch：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="错误类型">错误类型</h3>
<p>JavaScript有一个标准的<code>Error</code>对象表示错误，还有从<code>Error</code>派生的<code>TypeError</code>、<code>ReferenceError</code>等错误对象。我们在处理错误时，可以通过<code>catch(e)</code>捕获的变量<code>e</code>访问错误对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">if</span> (e <span class="keyword">instanceof</span> <span class="title class_">TypeError</span>) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&#x27;Type error!&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> <span class="title class_">Error</span>) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(e.<span class="property">message</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&#x27;Error: &#x27;</span> + e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用变量<code>e</code>是一个习惯用法，也可以以其他变量名命名，如<code>catch(ex)</code>。</p>
<h3 id="抛出错误">抛出错误</h3>
<p>程序也可以主动抛出一个错误，让执行流程直接跳转到<code>catch</code>块。抛出错误使用<code>throw</code>语句。</p>
<p>例如，下面的代码让用户输入一个数字，程序接收到的实际上是一个字符串，然后用<code>parseInt()</code>转换为整数。当用户输入不合法的时候，我们就抛出错误：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">let r, n, s;</span><br><span class="line">try &#123;</span><br><span class="line">    s = prompt(&#x27;请输入一个数字&#x27;);</span><br><span class="line">    n = parseInt(s);</span><br><span class="line">    if (isNaN(n)) &#123;</span><br><span class="line">        throw new Error(&#x27;输入错误&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    // 计算平方:</span><br><span class="line">    r = n * n;</span><br><span class="line">    console.log(n + &#x27; * &#x27; + n + &#x27; = &#x27; + r);</span><br><span class="line">&#125; catch (e) &#123;</span><br><span class="line">    console.log(&#x27;出错了：&#x27; + e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实际上，JavaScript允许抛出任意对象，包括数字、字符串。但是，最好还是抛出一个Error对象。</p>
<p>最后，当我们用catch捕获错误时，一定要编写错误处理语句：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> n = <span class="number">0</span>, s;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    n = s.<span class="property">length</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(n);</span><br></pre></td></tr></table></figure>
<p>哪怕仅仅把错误打印出来，也不要什么也不干：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> n = <span class="number">0</span>, s;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    n = s.<span class="property">length</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(n);</span><br></pre></td></tr></table></figure>
<p>因为catch到错误却什么都不执行，就不知道程序执行过程中到底有没有发生错误。</p>
<p>处理错误时，请不要简单粗暴地用<code>alert()</code>把错误显示给用户。教程的代码使用<code>alert()</code>是为了便于演示。</p>
<h2 id="错误传播">错误传播</h2>
<p>如果代码发生了错误，又没有被try … catch捕获，那么，程序执行流程会跳转到哪呢？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getLength</span>(<span class="params">s</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> s.<span class="property">length</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">printLength</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getLength</span>(<span class="string">&#x27;abc&#x27;</span>)); <span class="comment">// 3</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getLength</span>(<span class="literal">null</span>)); <span class="comment">// Error!</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">printLength</span>();</span><br></pre></td></tr></table></figure>
<p>如果在一个函数内部发生了错误，它自身没有捕获，错误就会被抛到外层调用函数，如果外层函数也没有捕获，该错误会一直沿着函数调用链向上抛出，直到被JavaScript引擎捕获，代码终止执行。</p>
<p>所以，我们不必在每一个函数内部捕获错误，只需要在合适的地方来个统一捕获，一网打尽：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">function main(s) &#123;</span><br><span class="line">    console.log(&#x27;BEGIN main()&#x27;);</span><br><span class="line">    try &#123;</span><br><span class="line">        foo(s);</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">        console.log(&#x27;出错了：&#x27; + e);</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(&#x27;END main()&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function foo(s) &#123;</span><br><span class="line">    console.log(&#x27;BEGIN foo()&#x27;);</span><br><span class="line">    bar(s);</span><br><span class="line">    console.log(&#x27;END foo()&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function bar(s) &#123;</span><br><span class="line">    console.log(&#x27;BEGIN bar()&#x27;);</span><br><span class="line">    console.log(&#x27;length = &#x27; + s.length);</span><br><span class="line">    console.log(&#x27;END bar()&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main(null);</span><br></pre></td></tr></table></figure>
<p>当<code>bar()</code>函数传入参数<code>null</code>时，代码会报错，错误会向上抛给调用方<code>foo()</code>函数，<code>foo()</code>函数没有try … catch语句，所以错误继续向上抛给调用方<code>main()</code>函数，<code>main()</code>函数有try … catch语句，所以错误最终在<code>main()</code>函数被处理了。</p>
<p>至于在哪些地方捕获错误比较合适，需要视情况而定。</p>
<hr>
<hr>
<h2 id="异步错误处理">异步错误处理</h2>
<p>编写JavaScript代码时，我们要时刻牢记，JavaScript引擎是一个事件驱动的执行引擎，代码总是以单线程执行，而回调函数的执行需要等到下一个满足条件的事件出现后，才会被执行。</p>
<p>例如，<code>setTimeout()</code>函数可以传入回调函数，并在指定若干毫秒后执行：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">printTime</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;It is time!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(printTime, <span class="number">1000</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;done&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>上面的代码会先打印<code>done</code>，1秒后才会打印<code>It is time!</code>。</p>
<p>如果<code>printTime()</code>函数内部发生了错误，我们试图用try包裹<code>setTimeout()</code>是无效的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function printTime() &#123;</span><br><span class="line">    throw new Error();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">try &#123;</span><br><span class="line">    setTimeout(printTime, 1000);</span><br><span class="line">    console.log(&#x27;done&#x27;);</span><br><span class="line">&#125; catch (e) &#123;</span><br><span class="line">    console.log(&#x27;error&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>原因就在于调用<code>setTimeout()</code>函数时，传入的<code>printTime</code>函数并未立刻执行！紧接着，JavaScript引擎会继续执行<code>console.log('done');</code>语句，而此时并没有错误发生。直到1秒钟后，执行<code>printTime</code>函数时才发生错误，但此时除了在<code>printTime</code>函数内部捕获错误外，外层代码并无法捕获。</p>
<p>所以，涉及到异步代码，无法在调用时捕获，原因就是在捕获的当时，回调函数并未执行。</p>
<p>类似的，当我们处理一个事件时，在绑定事件的代码处，无法捕获事件处理函数的错误。</p>
<p>例如，针对以下的表单：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;x&quot;</span>&gt;</span> + <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;y&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;calc&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span>&gt;</span>计算<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们用下面的代码给button绑定click事件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">let btn = document.querySelector(&#x27;#calc&#x27;);</span><br><span class="line"></span><br><span class="line">// 取消已绑定的事件:</span><br><span class="line">btn.onclick = null;</span><br><span class="line"></span><br><span class="line">try &#123;</span><br><span class="line">    btn.onclick = function () &#123;</span><br><span class="line">        let</span><br><span class="line">            x = parseFloat(document.querySelector(&#x27;#x&#x27;).value),</span><br><span class="line">            y = parseFloat(document.querySelector(&#x27;#y&#x27;).value),</span><br><span class="line">            r;</span><br><span class="line">        if (isNaN(x) || isNaN(y)) &#123;</span><br><span class="line">            throw new Error(&#x27;输入有误&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">        r = x + y;</span><br><span class="line">        alert(&#x27;计算结果：&#x27; + r);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125; catch (e) &#123;</span><br><span class="line">    alert(&#x27;输入有误！&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是，用户输入错误时，处理函数并未捕获到错误。请修复错误处理代码。</p>
<hr>
<hr>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../../2024/01/15/JavaScript/JavaScript-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../../2024/01/14/JavaScript/JavaScript-%E6%B5%8F%E8%A7%88%E5%99%A8/"
                            aria-label=": JavaScript-浏览器"
                        >
                            JavaScript-浏览器
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2024-01-14T21:31:30+08:00">
	
		    2024 年 1 月 14 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../../categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a>, <a class="category-link" href="../../../categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/JavaScript/">JavaScript</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>JavaScript可以获取浏览器提供的很多对象，并进行操作。</p>
<h3 id="window">window</h3>
<p><code>window</code>对象不但充当全局作用域，而且表示浏览器窗口。</p>
<p><code>window</code>对象有<code>innerWidth</code>和<code>innerHeight</code>属性，可以获取浏览器窗口的内部宽度和高度。内部宽高是指除去菜单栏、工具栏、边框等占位元素后，用于显示网页的净宽高。</p>
<p>兼容性：IE&lt;=8不支持。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 可以调整浏览器窗口大小试试:</span><br><span class="line">console.log(&#x27;window inner size: &#x27; + window.innerWidth + &#x27; x &#x27; + window.innerHeight);</span><br></pre></td></tr></table></figure>
<p>对应的，还有一个<code>outerWidth</code>和<code>outerHeight</code>属性，可以获取浏览器窗口的整个宽高。</p>
<h3 id="navigator">navigator</h3>
<p><code>navigator</code>对象表示浏览器的信息，最常用的属性包括：</p>
<ul>
<li>navigator.appName：浏览器名称；</li>
<li>navigator.appVersion：浏览器版本；</li>
<li>navigator.language：浏览器设置的语言；</li>
<li>navigator.platform：操作系统类型；</li>
<li>navigator.userAgent：浏览器设定的<code>User-Agent</code>字符串。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">console.log(&#x27;appName = &#x27; + navigator.appName);</span><br><span class="line">console.log(&#x27;appVersion = &#x27; + navigator.appVersion);</span><br><span class="line">console.log(&#x27;language = &#x27; + navigator.language);</span><br><span class="line">console.log(&#x27;platform = &#x27; + navigator.platform);</span><br><span class="line">console.log(&#x27;userAgent = &#x27; + navigator.userAgent);</span><br></pre></td></tr></table></figure>
<p><em>请注意</em>，<code>navigator</code>的信息可以很容易地被用户修改，所以JavaScript读取的值不一定是正确的。很多初学者为了针对不同浏览器编写不同的代码，喜欢用<code>if</code>判断浏览器版本，例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> width;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">getIEVersion</span>(navigator.<span class="property">userAgent</span>) &lt; <span class="number">9</span>) &#123;</span><br><span class="line">    width = <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientWidth</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    width = <span class="variable language_">window</span>.<span class="property">innerWidth</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但这样既可能判断不准确，也很难维护代码。正确的方法是充分利用JavaScript对不存在属性返回<code>undefined</code>的特性，直接用短路运算符<code>||</code>计算：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> width = <span class="variable language_">window</span>.<span class="property">innerWidth</span> || <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientWidth</span>;</span><br></pre></td></tr></table></figure>
<h3 id="screen">screen</h3>
<p><code>screen</code>对象表示屏幕的信息，常用的属性有：</p>
<ul>
<li>screen.width：屏幕宽度，以像素为单位；</li>
<li>screen.height：屏幕高度，以像素为单位；</li>
<li>screen.colorDepth：返回颜色位数，如8、16、24。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(&#x27;Screen size = &#x27; + screen.width + &#x27; x &#x27; + screen.height);</span><br></pre></td></tr></table></figure>
<h3 id="location">location</h3>
<p><code>location</code>对象表示当前页面的URL信息。例如，一个完整的URL：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.example.com:8080/path/index.html?a=1&amp;b=2#TOP</span><br></pre></td></tr></table></figure>
<p>可以用<code>location.href</code>获取。要获得URL各个部分的值，可以这么写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location.<span class="property">protocol</span>; <span class="comment">// &#x27;http&#x27;</span></span><br><span class="line">location.<span class="property">host</span>; <span class="comment">// &#x27;www.example.com&#x27;</span></span><br><span class="line">location.<span class="property">port</span>; <span class="comment">// &#x27;8080&#x27;</span></span><br><span class="line">location.<span class="property">pathname</span>; <span class="comment">// &#x27;/path/index.html&#x27;</span></span><br><span class="line">location.<span class="property">search</span>; <span class="comment">// &#x27;?a=1&amp;b=2&#x27;</span></span><br><span class="line">location.<span class="property">hash</span>; <span class="comment">// &#x27;TOP&#x27;</span></span><br></pre></td></tr></table></figure>
<p>要加载一个新页面，可以调用<code>location.assign()</code>。如果要重新加载当前页面，调用<code>location.reload()</code>方法非常方便。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if (confirm(&#x27;重新加载当前页&#x27; + location.href + &#x27;?&#x27;)) &#123;</span><br><span class="line">    location.reload();</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    location.assign(&#x27;/&#x27;); // 设置一个新的URL地址</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="document">document</h3>
<p><code>document</code>对象表示当前页面。由于HTML在浏览器中以DOM形式表示为树形结构，<code>document</code>对象就是整个DOM树的根节点。</p>
<p><code>document</code>的<code>title</code>属性是从HTML文档中的<code>&lt;title&gt;xxx&lt;/title&gt;</code>读取的，但是可以动态改变：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.title = &#x27;努力学习JavaScript!&#x27;;</span><br></pre></td></tr></table></figure>
<p>请观察浏览器窗口标题的变化。</p>
<p>要查找DOM树的某个节点，需要从<code>document</code>对象开始查找。最常用的查找是根据ID和Tag Name。</p>
<p>我们先准备HTML数据：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dl</span> <span class="attr">id</span>=<span class="string">&quot;drink-menu&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border:solid 1px #ccc;padding:6px;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dt</span>&gt;</span>摩卡<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span>热摩卡咖啡<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dt</span>&gt;</span>酸奶<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span>北京老酸奶<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dt</span>&gt;</span>果汁<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span>鲜榨苹果汁<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>摩卡</p>
<p>热摩卡咖啡</p>
<p>酸奶</p>
<p>北京老酸奶</p>
<p>果汁</p>
<p>鲜榨苹果汁</p>
<p>用<code>document</code>对象提供的<code>getElementById()</code>和<code>getElementsByTagName()</code>可以按ID获得一个DOM节点和按Tag名称获得一组DOM节点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let menu = document.getElementById(&#x27;drink-menu&#x27;);</span><br><span class="line">let drinks = document.getElementsByTagName(&#x27;dt&#x27;);</span><br><span class="line">let s = &#x27;提供的饮料有:&#x27;;</span><br><span class="line"></span><br><span class="line">for (let i=0; i&lt;drinks.length; i++) &#123;</span><br><span class="line">    s = s + drinks[i].innerHTML + &#x27;,&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">console.log(s);</span><br></pre></td></tr></table></figure>
<p><code>document</code>对象还有一个<code>cookie</code>属性，可以获取当前页面的Cookie。</p>
<p>Cookie是由服务器发送的key-value标示符。因为HTTP协议是无状态的，但是服务器要区分到底是哪个用户发过来的请求，就可以用Cookie来区分。当一个用户成功登录后，服务器发送一个Cookie给浏览器，例如<code>user=ABC123XYZ(加密的字符串)...</code>，此后，浏览器访问该网站时，会在请求头附上这个Cookie，服务器根据Cookie即可区分出用户。</p>
<p>Cookie还可以存储网站的一些设置，例如，页面显示的语言等等。</p>
<p>JavaScript可以通过<code>document.cookie</code>读取到当前页面的Cookie：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="property">cookie</span>; <span class="comment">// &#x27;v=123; remember=true; prefer=zh&#x27;</span></span><br></pre></td></tr></table></figure>
<p>由于JavaScript能读取到页面的Cookie，而用户的登录信息通常也存在Cookie中，这就造成了巨大的安全隐患，这是因为在HTML页面中引入第三方的JavaScript代码是允许的：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 当前页面在wwwexample.com --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://www.foo.com/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果引入的第三方的JavaScript中存在恶意代码，则<code>www.foo.com</code>网站将直接获取到<code>www.example.com</code>网站的用户登录信息。</p>
<p>为了解决这个问题，服务器在设置Cookie时可以使用<code>httpOnly</code>，设定了<code>httpOnly</code>的Cookie将不能被JavaScript读取。这个行为由浏览器实现，主流浏览器均支持<code>httpOnly</code>选项，IE从IE6 SP1开始支持。</p>
<p>为了确保安全，服务器端在设置Cookie时，应该始终坚持使用<code>httpOnly</code>。</p>
<h3 id="history">history</h3>
<p><code>history</code>对象保存了浏览器的历史记录，JavaScript可以调用<code>history</code>对象的<code>back()</code>或<code>forward ()</code>，相当于用户点击了浏览器的“后退”或“前进”按钮。</p>
<p>这个对象属于历史遗留对象，对于现代Web页面来说，由于大量使用AJAX和页面交互，简单粗暴地调用<code>history.back()</code>可能会让用户感到非常愤怒。</p>
<p>新手开始设计Web页面时喜欢在登录页登录成功时调用<code>history.back()</code>，试图回到登录前的页面。这是一种错误的方法。</p>
<p>对使用AJAX动态加载的页面，如果希望页面更新时同时更新<code>history</code>对象，应当使用<code>history.pushState()</code>方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// when AJAX is done:</span></span><br><span class="line"><span class="keyword">let</span> state = <span class="string">&#x27;any-data&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> newUrl = <span class="string">&#x27;/ajax.html#signin&#x27;</span>;</span><br><span class="line">history.<span class="title function_">pushState</span>(state, <span class="string">&#x27;&#x27;</span>, newUrl);</span><br></pre></td></tr></table></figure>
<p>当用户点击“后退”时，浏览器并不会刷新页面，而是触发<code>popstate</code>事件，可由JavaScript捕获并更新相应的部分页面内容。</p>
<h3 id="参考">参考</h3>
<p>常用浏览器对象参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/Window">Window</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/Navigator">Navigator</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/Screen">Screen</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/Location">Location</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/Document">Document</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/History_API">History</a></li>
</ul>
<h2 id="操作DOM">操作DOM</h2>
<p>由于HTML文档被浏览器解析后就是一棵DOM树，要改变HTML的结构，就需要通过JavaScript来操作DOM。</p>
<p>始终记住DOM是一个树形结构。操作一个DOM节点实际上就是这么几个操作：</p>
<ul>
<li>更新：更新该DOM节点的内容，相当于更新了该DOM节点表示的HTML的内容；</li>
<li>遍历：遍历该DOM节点下的子节点，以便进行进一步操作；</li>
<li>添加：在该DOM节点下新增一个子节点，相当于动态增加了一个HTML节点；</li>
<li>删除：将该节点从HTML中删除，相当于删掉了该DOM节点的内容以及它包含的所有子节点。</li>
</ul>
<p>在操作一个DOM节点前，我们需要通过各种方式先拿到这个DOM节点。最常用的方法是<code>document.getElementById()</code>和<code>document.getElementsByTagName()</code>，以及CSS选择器<code>document.getElementsByClassName()</code>。</p>
<p>由于ID在HTML文档中是唯一的，所以<code>document.getElementById()</code>可以直接定位唯一的一个DOM节点。<code>document.getElementsByTagName()</code>和<code>document.getElementsByClassName()</code>总是返回一组DOM节点。要精确地选择DOM，可以先定位父节点，再从父节点开始选择，以缩小范围。</p>
<p>例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回ID为&#x27;test&#x27;的节点：</span></span><br><span class="line"><span class="keyword">let</span> test = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 先定位ID为&#x27;test-table&#x27;的节点，再返回其内部所有tr节点：</span></span><br><span class="line"><span class="keyword">let</span> trs = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;test-table&#x27;</span>).<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;tr&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 先定位ID为&#x27;test-div&#x27;的节点，再返回其内部所有class包含red的节点：</span></span><br><span class="line"><span class="keyword">let</span> reds = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;test-div&#x27;</span>).<span class="title function_">getElementsByClassName</span>(<span class="string">&#x27;red&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取节点test下的所有直属子节点:</span></span><br><span class="line"><span class="keyword">let</span> cs = test.<span class="property">children</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取节点test下第一个、最后一个子节点：</span></span><br><span class="line"><span class="keyword">let</span> first = test.<span class="property">firstElementChild</span>;</span><br><span class="line"><span class="keyword">let</span> last = test.<span class="property">lastElementChild</span>;</span><br></pre></td></tr></table></figure>
<p>第二种方法是使用<code>querySelector()</code>和<code>querySelectorAll()</code>，需要了解selector语法，然后使用条件来获取节点，更加方便：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过querySelector获取ID为q1的节点：</span></span><br><span class="line"><span class="keyword">let</span> q1 = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#q1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过querySelectorAll获取q1节点内的符合条件的所有节点：</span></span><br><span class="line"><span class="keyword">let</span> ps = q1.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;div.highlighted &gt; p&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>注意：低版本的IE&lt;8不支持<code>querySelector</code>和<code>querySelectorAll</code>。IE8仅有限支持。</p>
<p>严格地讲，我们这里的DOM节点是指<code>Element</code>，但是DOM节点实际上是<code>Node</code>，在HTML中，<code>Node</code>包括<code>Element</code>、<code>Comment</code>、<code>CDATA_SECTION</code>等很多种，以及根节点<code>Document</code>类型，但是，绝大多数时候我们只关心<code>Element</code>，也就是实际控制页面结构的<code>Node</code>，其他类型的<code>Node</code>忽略即可。根节点<code>Document</code>已经自动绑定为全局变量<code>document</code>。</p>
<h3 id="练习">练习</h3>
<p>如下的HTML结构：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;test-div&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;c-red&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;test-p&quot;</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Java<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;c-red c-green&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Ruby<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Swift<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;c-green&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Scheme<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Haskell<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>请选择出指定条件的节点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// 选择&lt;p&gt;JavaScript&lt;/p&gt;:</span><br><span class="line">let js = ???;</span><br><span class="line"></span><br><span class="line">// 选择&lt;p&gt;Python&lt;/p&gt;,&lt;p&gt;Ruby&lt;/p&gt;,&lt;p&gt;Swift&lt;/p&gt;:</span><br><span class="line">let arr = ???;</span><br><span class="line"></span><br><span class="line">// 选择&lt;p&gt;Haskell&lt;/p&gt;:</span><br><span class="line">let haskell = ???;</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">if (!js || js.innerText !== &#x27;JavaScript&#x27;) &#123;</span><br><span class="line">    alert(&#x27;选择JavaScript失败!&#x27;);</span><br><span class="line">&#125; else if (!arr || arr.length !== 3 || !arr[0] || !arr[1] || !arr[2] || arr[0].innerText !== &#x27;Python&#x27; || arr[1].innerText !== &#x27;Ruby&#x27; || arr[2].innerText !== &#x27;Swift&#x27;) &#123;</span><br><span class="line">    console.log(&#x27;选择Python,Ruby,Swift失败!&#x27;);</span><br><span class="line">&#125; else if (!haskell || haskell.innerText !== &#x27;Haskell&#x27;) &#123;</span><br><span class="line">    console.log(&#x27;选择Haskell失败!&#x27;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    console.log(&#x27;测试通过!&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<hr>
<h2 id="更新DOM">更新DOM</h2>
<p>拿到一个DOM节点后，我们可以对它进行更新。</p>
<p>可以直接修改节点的文本，方法有两种：</p>
<p>一种是修改<code>innerHTML</code>属性，这个方式非常强大，不但可以修改一个DOM节点的文本内容，还可以直接通过HTML片段修改DOM节点内部的子树：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取&lt;p id=&quot;p-id&quot;&gt;...&lt;/p&gt;</span></span><br><span class="line"><span class="keyword">let</span> p = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;p-id&#x27;</span>);</span><br><span class="line"><span class="comment">// 设置文本为abc:</span></span><br><span class="line">p.<span class="property">innerHTML</span> = <span class="string">&#x27;ABC&#x27;</span>; <span class="comment">// &lt;p id=&quot;p-id&quot;&gt;ABC&lt;/p&gt;</span></span><br><span class="line"><span class="comment">// 设置HTML:</span></span><br><span class="line">p.<span class="property">innerHTML</span> = <span class="string">&#x27;ABC &lt;span style=&quot;color:red&quot;&gt;RED&lt;/span&gt; XYZ&#x27;</span>;</span><br><span class="line"><span class="comment">// &lt;p&gt;...&lt;/p&gt;的内部结构已修改</span></span><br></pre></td></tr></table></figure>
<p>用<code>innerHTML</code>时要注意，是否需要写入HTML。如果写入的字符串是通过网络拿到的，要注意对字符编码来避免XSS攻击。</p>
<p>第二种是修改<code>innerText</code>或<code>textContent</code>属性，这样可以自动对字符串进行HTML编码，保证无法设置任何HTML标签：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取&lt;p id=&quot;p-id&quot;&gt;...&lt;/p&gt;</span></span><br><span class="line"><span class="keyword">let</span> p = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;p-id&#x27;</span>);</span><br><span class="line"><span class="comment">// 设置文本:</span></span><br><span class="line">p.<span class="property">innerText</span> = <span class="string">&#x27;&lt;script&gt;alert(&quot;Hi&quot;)&lt;/script&gt;&#x27;</span>;</span><br><span class="line"><span class="comment">// HTML被自动编码，无法设置一个&lt;script&gt;节点:</span></span><br><span class="line"><span class="comment">// &lt;p id=&quot;p-id&quot;&gt;&amp;lt;script&amp;gt;alert(&quot;Hi&quot;)&amp;lt;/script&amp;gt;&lt;/p&gt;</span></span><br></pre></td></tr></table></figure>
<p>两者的区别在于读取属性时，<code>innerText</code>不返回隐藏元素的文本，而<code>textContent</code>返回所有文本。另外注意IE&lt;9不支持<code>textContent</code>。</p>
<p>修改CSS也是经常需要的操作。DOM节点的<code>style</code>属性对应所有的CSS，可以直接获取或设置。因为CSS允许<code>font-size</code>这样的名称，但它并非JavaScript有效的属性名，所以需要在JavaScript中改写为驼峰式命名<code>fontSize</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取&lt;p id=&quot;p-id&quot;&gt;...&lt;/p&gt;</span></span><br><span class="line"><span class="keyword">let</span> p = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;p-id&#x27;</span>);</span><br><span class="line"><span class="comment">// 设置CSS:</span></span><br><span class="line">p.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&#x27;#ff0000&#x27;</span>;</span><br><span class="line">p.<span class="property">style</span>.<span class="property">fontSize</span> = <span class="string">&#x27;20px&#x27;</span>;</span><br><span class="line">p.<span class="property">style</span>.<span class="property">paddingTop</span> = <span class="string">&#x27;2em&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="练习-2">练习</h3>
<p>有如下的HTML结构：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;test-div&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;test-js&quot;</span>&gt;</span>javascript<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Java<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>请尝试获取指定节点并修改：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// 获取&lt;p&gt;javascript&lt;/p&gt;节点:</span><br><span class="line">let js = ???;</span><br><span class="line"></span><br><span class="line">// 修改文本为JavaScript:</span><br><span class="line">// TODO:</span><br><span class="line"></span><br><span class="line">// 修改CSS为: color: #ff0000, font-weight: bold</span><br><span class="line">// TODO:</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">if (js &amp;&amp; js.parentNode &amp;&amp; js.parentNode.id === &#x27;test-div&#x27; &amp;&amp; js.id === &#x27;test-js&#x27;) &#123;</span><br><span class="line">    if (js.innerText === &#x27;JavaScript&#x27;) &#123;</span><br><span class="line">        if (js.style &amp;&amp; js.style.fontWeight === &#x27;bold&#x27; &amp;&amp; (js.style.color === &#x27;red&#x27; || js.style.color === &#x27;#ff0000&#x27; || js.style.color === &#x27;#f00&#x27; || js.style.color === &#x27;rgb(255, 0, 0)&#x27;)) &#123;</span><br><span class="line">            console.log(&#x27;测试通过!&#x27;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            console.log(&#x27;CSS样式测试失败!&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(&#x27;文本测试失败!&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    console.log(&#x27;节点测试失败!&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<hr>
<p>当我们获得了某个DOM节点，想在这个DOM节点内插入新的DOM，应该如何做？</p>
<p>如果这个DOM节点是空的，例如，<code>&lt;div&gt;&lt;/div&gt;</code>，那么，直接使用<code>innerHTML = '&lt;span&gt;child&lt;/span&gt;'</code>就可以修改DOM节点的内容，相当于“插入”了新的DOM节点。</p>
<p>如果这个DOM节点不是空的，那就不能这么做，因为<code>innerHTML</code>会直接替换掉原来的所有子节点。</p>
<p>有两个办法可以插入新的节点。一个是使用<code>appendChild</code>，把一个子节点添加到父节点的最后一个子节点。例如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;js&quot;</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;java&quot;</span>&gt;</span>Java<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;python&quot;</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;scheme&quot;</span>&gt;</span>Scheme<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>把<code>&lt;p id=&quot;js&quot;&gt;JavaScript&lt;/p&gt;</code>添加到<code>&lt;div id=&quot;list&quot;&gt;</code>的最后一项：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span></span><br><span class="line">    js = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;js&#x27;</span>),</span><br><span class="line">    list = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;list&#x27;</span>);</span><br><span class="line">list.<span class="title function_">appendChild</span>(js);</span><br></pre></td></tr></table></figure>
<p>现在，HTML结构变成了这样：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;java&quot;</span>&gt;</span>Java<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;python&quot;</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;scheme&quot;</span>&gt;</span>Scheme<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;js&quot;</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>因为我们插入的<code>js</code>节点已经存在于当前的文档树，因此这个节点首先会从原先的位置删除，再插入到新的位置。</p>
<p>更多的时候我们会从零创建一个新的节点，然后插入到指定位置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span></span><br><span class="line">    list = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;list&#x27;</span>),</span><br><span class="line">    haskell = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;p&#x27;</span>);</span><br><span class="line">haskell.<span class="property">id</span> = <span class="string">&#x27;haskell&#x27;</span>;</span><br><span class="line">haskell.<span class="property">innerText</span> = <span class="string">&#x27;Haskell&#x27;</span>;</span><br><span class="line">list.<span class="title function_">appendChild</span>(haskell);</span><br></pre></td></tr></table></figure>
<p>这样我们就动态添加了一个新的节点：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;java&quot;</span>&gt;</span>Java<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;python&quot;</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;scheme&quot;</span>&gt;</span>Scheme<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;haskell&quot;</span>&gt;</span>Haskell<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>动态创建一个节点然后添加到DOM树中，可以实现很多功能。举个例子，下面的代码动态创建了一个<code>&lt;style&gt;</code>节点，然后把它添加到<code>&lt;head&gt;</code>节点的末尾，这样就动态地给文档添加了新的CSS定义：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> d = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;style&#x27;</span>);</span><br><span class="line">d.<span class="title function_">setAttribute</span>(<span class="string">&#x27;type&#x27;</span>, <span class="string">&#x27;text/css&#x27;</span>);</span><br><span class="line">d.<span class="property">innerHTML</span> = <span class="string">&#x27;p &#123; color: red &#125;&#x27;</span>;</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;head&#x27;</span>)[<span class="number">0</span>].<span class="title function_">appendChild</span>(d);</span><br></pre></td></tr></table></figure>
<p>可以在Chrome的控制台执行上述代码，观察页面样式的变化。</p>
<h3 id="insertBefore">insertBefore</h3>
<p>如果我们要把子节点插入到指定的位置怎么办？可以使用<code>parentElement.insertBefore(newElement, referenceElement);</code>，子节点会插入到<code>referenceElement</code>之前。</p>
<p>还是以上面的HTML为例，假定我们要把<code>Haskell</code>插入到<code>Python</code>之前：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;java&quot;</span>&gt;</span>Java<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;python&quot;</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;scheme&quot;</span>&gt;</span>Scheme<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>可以这么写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span></span><br><span class="line">    list = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;list&#x27;</span>),</span><br><span class="line">    ref = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;python&#x27;</span>),</span><br><span class="line">    haskell = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;p&#x27;</span>);</span><br><span class="line">haskell.<span class="property">id</span> = <span class="string">&#x27;haskell&#x27;</span>;</span><br><span class="line">haskell.<span class="property">innerText</span> = <span class="string">&#x27;Haskell&#x27;</span>;</span><br><span class="line">list.<span class="title function_">insertBefore</span>(haskell, ref);</span><br></pre></td></tr></table></figure>
<p>新的HTML结构如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;java&quot;</span>&gt;</span>Java<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;haskell&quot;</span>&gt;</span>Haskell<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;python&quot;</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;scheme&quot;</span>&gt;</span>Scheme<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>可见，使用<code>insertBefore</code>重点是要拿到一个“参考子节点”的引用。很多时候，需要循环一个父节点的所有子节点，可以通过迭代<code>children</code>属性实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span></span><br><span class="line">    i, c,</span><br><span class="line">    list = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;list&#x27;</span>);</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; list.<span class="property">children</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    c = list.<span class="property">children</span>[i]; <span class="comment">// 拿到第i个子节点</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="练习-3">练习</h3>
<p>对于一个已有的HTML结构：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- HTML结构 --&gt;</span><br><span class="line">&lt;ol id=&quot;test-list&quot;&gt;</span><br><span class="line">    &lt;li class=&quot;lang&quot;&gt;Scheme&lt;/li&gt;</span><br><span class="line">    &lt;li class=&quot;lang&quot;&gt;JavaScript&lt;/li&gt;</span><br><span class="line">    &lt;li class=&quot;lang&quot;&gt;Python&lt;/li&gt;</span><br><span class="line">    &lt;li class=&quot;lang&quot;&gt;Ruby&lt;/li&gt;</span><br><span class="line">    &lt;li class=&quot;lang&quot;&gt;Haskell&lt;/li&gt;</span><br><span class="line">&lt;/ol&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>Scheme</li>
<li>JavaScript</li>
<li>Python</li>
<li>Ruby</li>
<li>Haskell</li>
</ol>
<p>按字符串顺序重新排序DOM节点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">// sort list:</span><br><span class="line">TODO</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">(function () &#123;</span><br><span class="line">    let</span><br><span class="line">        arr, i,</span><br><span class="line">        t = document.getElementById(&#x27;test-list&#x27;);</span><br><span class="line">    if (t &amp;&amp; t.children &amp;&amp; t.children.length === 5) &#123;</span><br><span class="line">        arr = [];</span><br><span class="line">        for (i=0; i&lt;t.children.length; i++) &#123;</span><br><span class="line">            arr.push(t.children[i].innerText);</span><br><span class="line">        &#125;</span><br><span class="line">        if (arr.toString() === [&#x27;Haskell&#x27;, &#x27;JavaScript&#x27;, &#x27;Python&#x27;, &#x27;Ruby&#x27;, &#x27;Scheme&#x27;].toString()) &#123;</span><br><span class="line">            console.log(&#x27;测试通过!&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            console.log(&#x27;测试失败: &#x27; + arr.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        console.log(&#x27;测试失败!&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<h2 id="删除DOM">删除DOM</h2>
<p>删除一个DOM节点就比插入要容易得多。</p>
<p>要删除一个节点，首先要获得该节点本身以及它的父节点，然后，调用父节点的<code>removeChild</code>把自己删掉：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 拿到待删除节点:</span></span><br><span class="line"><span class="keyword">let</span> self = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;to-be-removed&#x27;</span>);</span><br><span class="line"><span class="comment">// 拿到父节点:</span></span><br><span class="line"><span class="keyword">let</span> parent = self.<span class="property">parentElement</span>;</span><br><span class="line"><span class="comment">// 删除:</span></span><br><span class="line"><span class="keyword">let</span> removed = parent.<span class="title function_">removeChild</span>(self);</span><br><span class="line">removed === self; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>注意到删除后的节点虽然不在文档树中了，但其实它还在内存中，可以随时再次被添加到别的位置。</p>
<p>当你遍历一个父节点的子节点并进行删除操作时，要注意，<code>children</code>属性是一个只读属性，并且它在子节点变化时会实时更新。</p>
<p>例如，对于如下HTML结构：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;parent&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>First<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Second<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当我们用如下代码删除子节点时：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> parent = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;parent&#x27;</span>);</span><br><span class="line">parent.<span class="title function_">removeChild</span>(parent.<span class="property">children</span>[<span class="number">0</span>]);</span><br><span class="line">parent.<span class="title function_">removeChild</span>(parent.<span class="property">children</span>[<span class="number">1</span>]); <span class="comment">// &lt;-- 浏览器报错</span></span><br></pre></td></tr></table></figure>
<p>浏览器报错：<code>parent.children[1]</code>不是一个有效的节点。原因就在于，当<code>&lt;p&gt;First&lt;/p&gt;</code>节点被删除后，<code>parent.children</code>的节点数量已经从2变为了1，索引<code>[1]</code>已经不存在了。</p>
<p>因此，删除多个节点时，要注意<code>children</code>属性时刻都在变化。</p>
<h3 id="练习-4">练习</h3>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;test-list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>Swift<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>HTML<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>ANSI C<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>CSS<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>DirectX<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>JavaScript</li>
<li>Swift</li>
<li>HTML</li>
<li>ANSI C</li>
<li>CSS</li>
<li>DirectX</li>
</ul>
<p>把与Web开发技术不相关的节点删掉：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// TODO</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">(function () &#123;</span><br><span class="line">    let</span><br><span class="line">        arr, i,</span><br><span class="line">        t = document.getElementById(&#x27;test-list&#x27;);</span><br><span class="line">    if (t &amp;&amp; t.children &amp;&amp; t.children.length === 3) &#123;</span><br><span class="line">        arr = [];</span><br><span class="line">        for (i = 0; i &lt; t.children.length; i ++) &#123;</span><br><span class="line">            arr.push(t.children[i].innerText);</span><br><span class="line">        &#125;</span><br><span class="line">        if (arr.toString() === [&#x27;JavaScript&#x27;, &#x27;HTML&#x27;, &#x27;CSS&#x27;].toString()) &#123;</span><br><span class="line">            console.log(&#x27;测试通过!&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            console.log(&#x27;测试失败: &#x27; + arr.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        console.log(&#x27;测试失败!&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<hr>
<hr>
<p>用JavaScript操作表单和操作DOM是类似的，因为表单本身也是DOM树。</p>
<p>不过表单的输入框、下拉框等可以接收用户输入，所以用JavaScript来操作表单，可以获得用户输入的内容，或者对一个输入框设置新的内容。</p>
<p>HTML表单的输入控件主要有以下几种：</p>
<ul>
<li>文本框，对应的<code>&lt;input type=&quot;text&quot;&gt;</code>，用于输入文本；</li>
<li>口令框，对应的<code>&lt;input type=&quot;password&quot;&gt;</code>，用于输入口令；</li>
<li>单选框，对应的<code>&lt;input type=&quot;radio&quot;&gt;</code>，用于选择一项；</li>
<li>复选框，对应的<code>&lt;input type=&quot;checkbox&quot;&gt;</code>，用于选择多项；</li>
<li>下拉框，对应的<code>&lt;select&gt;</code>，用于选择一项；</li>
<li>隐藏文本，对应的<code>&lt;input type=&quot;hidden&quot;&gt;</code>，用户不可见，但表单提交时会把隐藏文本发送到服务器。</li>
</ul>
<h3 id="获取值">获取值</h3>
<p>如果我们获得了一个<code>&lt;input&gt;</code>节点的引用，就可以直接调用<code>value</code>获得对应的用户输入值：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;input type=&quot;text&quot; id=&quot;email&quot;&gt;</span></span><br><span class="line"><span class="keyword">let</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;email&#x27;</span>);</span><br><span class="line">input.<span class="property">value</span>; <span class="comment">// &#x27;用户输入的值&#x27;</span></span><br></pre></td></tr></table></figure>
<p>这种方式可以应用于<code>text</code>、<code>password</code>、<code>hidden</code>以及<code>select</code>。但是，对于单选框和复选框，<code>value</code>属性返回的永远是HTML预设的值，而我们需要获得的实际是用户是否“勾上了”选项，所以应该用<code>checked</code>判断：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;label&gt;&lt;input type=&quot;radio&quot; name=&quot;weekday&quot; id=&quot;monday&quot; value=&quot;1&quot;&gt; Monday&lt;/label&gt;</span></span><br><span class="line"><span class="comment">// &lt;label&gt;&lt;input type=&quot;radio&quot; name=&quot;weekday&quot; id=&quot;tuesday&quot; value=&quot;2&quot;&gt; Tuesday&lt;/label&gt;</span></span><br><span class="line"><span class="keyword">let</span> mon = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;monday&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> tue = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;tuesday&#x27;</span>);</span><br><span class="line">mon.<span class="property">value</span>; <span class="comment">// &#x27;1&#x27;</span></span><br><span class="line">tue.<span class="property">value</span>; <span class="comment">// &#x27;2&#x27;</span></span><br><span class="line">mon.<span class="property">checked</span>; <span class="comment">// true或者false</span></span><br><span class="line">tue.<span class="property">checked</span>; <span class="comment">// true或者false</span></span><br></pre></td></tr></table></figure>
<h3 id="设置值">设置值</h3>
<p>设置值和获取值类似，对于<code>text</code>、<code>password</code>、<code>hidden</code>以及<code>select</code>，直接设置<code>value</code>就可以：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;input type=&quot;text&quot; id=&quot;email&quot;&gt;</span></span><br><span class="line"><span class="keyword">let</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;email&#x27;</span>);</span><br><span class="line">input.<span class="property">value</span> = <span class="string">&#x27;test@example.com&#x27;</span>; <span class="comment">// 文本框的内容已更新</span></span><br></pre></td></tr></table></figure>
<p>对于单选框和复选框，设置<code>checked</code>为<code>true</code>或<code>false</code>即可。</p>
<h3 id="HTML5控件">HTML5控件</h3>
<p>HTML5新增了大量标准控件，常用的包括<code>date</code>、<code>datetime</code>、<code>datetime-local</code>、<code>color</code>等，它们都使用<code>&lt;input&gt;</code>标签：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;date&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2021-12-02&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;datetime-local&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2021-12-02T20:21:12&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;color&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#ff0000&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>不支持HTML5的浏览器无法识别新的控件，会把它们当做<code>type=&quot;text&quot;</code>来显示。支持HTML5的浏览器将获得格式化的字符串。例如，<code>type=&quot;date&quot;</code>类型的<code>input</code>的<code>value</code>将保证是一个有效的<code>YYYY-MM-DD</code>格式的日期，或者空字符串。</p>
<h3 id="提交表单">提交表单</h3>
<p>最后，JavaScript可以以两种方式来处理表单的提交（AJAX方式在后面章节介绍）。</p>
<p>方式一是通过<code>&lt;form&gt;</code>元素的<code>submit()</code>方法提交一个表单，例如，响应一个<code>&lt;button&gt;</code>的<code>click</code>事件，在JavaScript代码中提交表单：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;test-form&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;doSubmitForm()&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">doSubmitForm</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> form = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;test-form&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 可以在此修改form的input...</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 提交form:</span></span></span><br><span class="line"><span class="language-javascript">    form.<span class="title function_">submit</span>();</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这种方式的缺点是扰乱了浏览器对form的正常提交。浏览器默认点击<code>&lt;button type=&quot;submit&quot;&gt;</code>时提交表单，或者用户在最后一个输入框按回车键。因此，第二种方式是响应<code>&lt;form&gt;</code>本身的<code>onsubmit</code>事件，在提交form时作修改：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;test-form&quot;</span> <span class="attr">onsubmit</span>=<span class="string">&quot;return checkForm()&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">checkForm</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> form = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;test-form&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 可以在此修改form的input...</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 继续下一步:</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意要<code>return true</code>来告诉浏览器继续提交，如果<code>return false</code>，浏览器将不会继续提交form，这种情况通常对应用户输入有误，提示用户错误信息后终止提交form。</p>
<p>在检查和修改<code>&lt;input&gt;</code>时，要充分利用<code>&lt;input type=&quot;hidden&quot;&gt;</code>来传递数据。</p>
<p>例如，很多登录表单希望用户输入用户名和口令，但是，安全考虑，提交表单时不传输明文口令，而是口令的MD5。普通JavaScript开发人员会直接修改<code>&lt;input&gt;</code>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;login-form&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">onsubmit</span>=<span class="string">&quot;return checkForm()&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">checkForm</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> pwd = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;password&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 把用户输入的明文变为MD5:</span></span></span><br><span class="line"><span class="language-javascript">    pwd.<span class="property">value</span> = <span class="title function_">toMD5</span>(pwd.<span class="property">value</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 继续下一步:</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个做法看上去没啥问题，但用户输入了口令提交时，口令框的显示会突然从几个<code>*</code>变成32个<code>*</code>（因为MD5有32个字符）。</p>
<p>要想不改变用户的输入，可以利用<code>&lt;input type=&quot;hidden&quot;&gt;</code>实现：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;login-form&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">onsubmit</span>=<span class="string">&quot;return checkForm()&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;input-password&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">id</span>=<span class="string">&quot;md5-password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">checkForm</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> input_pwd = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;input-password&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> md5_pwd = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;md5-password&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 把用户输入的明文变为MD5:</span></span></span><br><span class="line"><span class="language-javascript">    md5_pwd.<span class="property">value</span> = <span class="title function_">toMD5</span>(input_pwd.<span class="property">value</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 继续下一步:</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意到<code>id</code>为<code>md5-password</code>的<code>&lt;input&gt;</code>标记了<code>name=&quot;password&quot;</code>，而用户输入的<code>id</code>为<code>input-password</code>的<code>&lt;input&gt;</code>没有<code>name</code>属性。没有<code>name</code>属性的<code>&lt;input&gt;</code>的数据不会被提交。</p>
<h3 id="练习-5">练习</h3>
<p>利用JavaScript检查用户注册信息是否正确，在以下情况不满足时报错并阻止提交表单：</p>
<ul>
<li>用户名必须是3-10位英文字母或数字；</li>
<li>口令必须是6-20位；</li>
<li>两次输入口令必须一致。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;test-register&quot;</span> <span class="attr">action</span>=<span class="string">&quot;#&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">onsubmit</span>=<span class="string">&quot;return checkRegisterForm()&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;test-error&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color:red&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        用户名: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        口令: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        重复口令: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password-2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span> <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;reset&quot;</span>&gt;</span>重置<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">window.checkRegisterForm = function () &#123;</span><br><span class="line">    // TODO:</span><br><span class="line">    return false;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">(function () &#123;</span><br><span class="line">    window.testFormHandler = window.checkRegisterForm;</span><br><span class="line">    let form = document.getElementById(&#x27;test-register&#x27;);</span><br><span class="line">    if (form.dispatchEvent) &#123;</span><br><span class="line">        let event = new Event(&#x27;submit&#x27;, &#123;</span><br><span class="line">    		bubbles: true,</span><br><span class="line">    		cancelable: true</span><br><span class="line">  		&#125;);</span><br><span class="line">        form.dispatchEvent(event);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        form.fireEvent(&#x27;onsubmit&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>在HTML表单中，可以上传文件的唯一控件就是<code>&lt;input type=&quot;file&quot;&gt;</code>。</p>
<p><em>注意</em>：当一个表单包含<code>&lt;input type=&quot;file&quot;&gt;</code>时，表单的<code>enctype</code>必须指定为<code>multipart/form-data</code>，<code>method</code>必须指定为<code>post</code>，浏览器才能正确编码并以<code>multipart/form-data</code>格式发送表单的数据。</p>
<p>出于安全考虑，浏览器只允许用户点击<code>&lt;input type=&quot;file&quot;&gt;</code>来选择本地文件，用JavaScript对<code>&lt;input type=&quot;file&quot;&gt;</code>的<code>value</code>赋值是没有任何效果的。当用户选择了上传某个文件后，JavaScript也无法获得该文件的真实路径：</p>
<p>通常，上传的文件都由后台服务器处理，JavaScript可以在提交表单时对文件扩展名做检查，以便防止用户上传无效格式的文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> f = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;test-file-upload&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> filename = f.<span class="property">value</span>; <span class="comment">// &#x27;C:\fakepath\test.png&#x27;</span></span><br><span class="line"><span class="keyword">if</span> (!filename || !(filename.<span class="title function_">endsWith</span>(<span class="string">&#x27;.jpg&#x27;</span>) || filename.<span class="title function_">endsWith</span>(<span class="string">&#x27;.png&#x27;</span>) || filename.<span class="title function_">endsWith</span>(<span class="string">&#x27;.gif&#x27;</span>))) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;Can only upload image file.&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="File-API">File API</h3>
<p>由于JavaScript对用户上传的文件操作非常有限，尤其是无法读取文件内容，使得很多需要操作文件的网页不得不用Flash这样的第三方插件来实现。</p>
<p>随着HTML5的普及，新增的File API允许JavaScript读取文件内容，获得更多的文件信息。</p>
<p>HTML5的File API提供了<code>File</code>和<code>FileReader</code>两个主要对象，可以获得文件信息并读取文件。</p>
<p>下面的例子演示了如何读取用户选取的图片文件，并在一个<code>&lt;div&gt;</code>中预览图像：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span></span><br><span class="line">    fileInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;test-image-file&#x27;</span>),</span><br><span class="line">    info = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;test-file-info&#x27;</span>),</span><br><span class="line">    preview = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;test-image-preview&#x27;</span>);</span><br><span class="line"><span class="comment">// 监听change事件:</span></span><br><span class="line">fileInput.<span class="title function_">addEventListener</span>(<span class="string">&#x27;change&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 清除背景图片:</span></span><br><span class="line">    preview.<span class="property">style</span>.<span class="property">backgroundImage</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="comment">// 检查文件是否选择:</span></span><br><span class="line">    <span class="keyword">if</span> (!fileInput.<span class="property">value</span>) &#123;</span><br><span class="line">        info.<span class="property">innerHTML</span> = <span class="string">&#x27;没有选择文件&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取File引用:</span></span><br><span class="line">    <span class="keyword">let</span> file = fileInput.<span class="property">files</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// 获取File信息:</span></span><br><span class="line">    info.<span class="property">innerHTML</span> = <span class="string">&#x27;文件: &#x27;</span> + file.<span class="property">name</span> + <span class="string">&#x27;&lt;br&gt;&#x27;</span> +</span><br><span class="line">                     <span class="string">&#x27;大小: &#x27;</span> + file.<span class="property">size</span> + <span class="string">&#x27;&lt;br&gt;&#x27;</span> +</span><br><span class="line">                     <span class="string">&#x27;修改: &#x27;</span> + file.<span class="property">lastModified</span>;</span><br><span class="line">    <span class="keyword">if</span> (file.<span class="property">type</span> !== <span class="string">&#x27;image/jpeg&#x27;</span> &amp;&amp; file.<span class="property">type</span> !== <span class="string">&#x27;image/png&#x27;</span> &amp;&amp; file.<span class="property">type</span> !== <span class="string">&#x27;image/gif&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&#x27;不是有效的图片文件!&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 读取文件:</span></span><br><span class="line">    <span class="keyword">let</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line">    reader.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span></span><br><span class="line">            data = e.<span class="property">target</span>.<span class="property">result</span>; <span class="comment">// &#x27;data:image/jpeg;base64,/9j/4AAQSk...(base64编码)...&#x27;            </span></span><br><span class="line">        preview.<span class="property">style</span>.<span class="property">backgroundImage</span> = <span class="string">&#x27;url(&#x27;</span> + data + <span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 以DataURL的形式读取文件:</span></span><br><span class="line">    reader.<span class="title function_">readAsDataURL</span>(file);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>上面的代码演示了如何通过HTML5的File API读取文件内容。以DataURL的形式读取到的文件是一个字符串，类似于<code>data:image/jpeg;base64,/9j/4AAQSk...(base64编码)...</code>，常用于设置图像。如果需要服务器端处理，把字符串<code>base64,</code>后面的字符发送给服务器并用Base64解码就可以得到原始文件的二进制内容。</p>
<h3 id="回调">回调</h3>
<p>上面的代码还演示了JavaScript的一个重要的特性就是单线程执行模式。在JavaScript中，浏览器的JavaScript执行引擎在执行JavaScript代码时，总是以单线程模式执行，也就是说，任何时候，JavaScript代码都不可能同时有多于1个线程在执行。</p>
<p>你可能会问，单线程模式执行的JavaScript，如何处理多任务？</p>
<p>在JavaScript中，执行多任务实际上都是异步调用，比如上面的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reader.<span class="title function_">readAsDataURL</span>(file);</span><br></pre></td></tr></table></figure>
<p>就会发起一个异步操作来读取文件内容。因为是异步操作，所以我们在JavaScript代码中就不知道什么时候操作结束，因此需要先设置一个回调函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reader.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="comment">// 当文件读取完成后，自动调用此函数:</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>当文件读取完成后，JavaScript引擎将自动调用我们设置的回调函数。执行回调函数时，文件已经读取完毕，所以我们可以在回调函数内部安全地获得文件内容。</p>
<p>AJAX不是JavaScript的规范，它只是一个哥们“发明”的缩写：Asynchronous JavaScript and XML，意思就是用JavaScript执行异步网络请求。</p>
<p>如果仔细观察一个Form的提交，你就会发现，一旦用户点击“Submit”按钮，表单开始提交，浏览器就会刷新页面，然后在新页面里告诉你操作是成功了还是失败了。如果不幸由于网络太慢或者其他原因，就会得到一个404页面。</p>
<p>这就是Web的运作原理：一次HTTP请求对应一个页面。</p>
<p>如果要让用户留在当前页面中，同时发出新的HTTP请求，就必须用JavaScript发送这个新请求，接收到数据后，再用JavaScript更新页面，这样一来，用户就感觉自己仍然停留在当前页面，但是数据却可以不断地更新。</p>
<p>最早大规模使用AJAX的就是Gmail，Gmail的页面在首次加载后，剩下的所有数据都依赖于AJAX来更新。</p>
<p>用JavaScript写一个完整的AJAX代码并不复杂，但是需要注意：AJAX请求是异步执行的，也就是说，要通过回调函数获得响应。</p>
<p>在现代浏览器上写AJAX主要依靠<code>XMLHttpRequest</code>对象，如果不考虑早期浏览器的兼容性问题，现代浏览器还提供了原生支持的Fetch API，以<a target="_blank" rel="noopener" href="https://liaoxuefeng.com/books/javascript/browser/promise/index.html">Promise</a>方式提供。使用Fetch API发送HTTP请求代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">async function get(url) &#123;</span><br><span class="line">    let resp = await fetch(url);</span><br><span class="line">    let result = await resp.text();</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 发送异步请求:</span><br><span class="line">get(&#x27;./content.html&#x27;).then(data =&gt; &#123;</span><br><span class="line">    let textarea = document.getElementById(&#x27;fetch-response-text&#x27;);</span><br><span class="line">    textarea.value = data;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>使用Fetch API配合<a target="_blank" rel="noopener" href="https://liaoxuefeng.com/books/javascript/browser/async/index.html">async</a>写法，代码更加简单。</p>
<p>Fetch API的详细用法可以参考<a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/Fetch_API">MDN文档</a>。</p>
<h3 id="安全限制">安全限制</h3>
<p>上面代码的URL使用的是相对路径。如果你把它改为<code>'https://www.sina.com.cn/'</code>，再运行，肯定报错。在Chrome的控制台里，还可以看到错误信息。</p>
<p>这是因为浏览器的同源策略导致的。默认情况下，JavaScript在发送AJAX请求时，URL的域名必须和当前页面完全一致。</p>
<p>完全一致的意思是，域名要相同（<code>www.example.com</code>和<code>example.com</code>不同），协议要相同（<code>http</code>和<code>https</code>不同），端口号要相同（http默认是<code>:80</code>端口，它和<code>:8080</code>就不同）。有的浏览器口子松一点，允许端口不同，大多数浏览器都会严格遵守这个限制。</p>
<p>那是不是用JavaScript无法请求外域（就是其他网站）的URL了呢？方法还是有的，大概有这么几种：</p>
<p>一是通过Flash插件发送HTTP请求，这种方式可以绕过浏览器的安全限制，但必须安装Flash，并且跟Flash交互。不过Flash用起来麻烦，而且现在用得也越来越少了。</p>
<p>二是通过在同源域名下架设一个代理服务器来转发，JavaScript负责把请求发送到代理服务器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;/proxy?url=https://www.sina.com.cn&#x27;</span><br></pre></td></tr></table></figure>
<p>代理服务器再把结果返回，这样就遵守了浏览器的同源策略。这种方式麻烦之处在于需要服务器端额外做开发。</p>
<p>第三种方式称为JSONP，它有个限制，只能用GET请求，并且要求返回JavaScript。这种方式跨域实际上是利用了浏览器允许跨域引用JavaScript资源：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://example.com/abc.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>JSONP通常以函数调用的形式返回，例如，返回JavaScript内容如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">foo</span>(<span class="string">&#x27;data&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>这样一来，我们如果在页面中先准备好<code>foo()</code>函数，然后给页面动态加一个<code>&lt;script&gt;</code>节点，相当于动态读取外域的JavaScript资源，最后就等着接收回调了。</p>
<h3 id="CORS">CORS</h3>
<p>如果浏览器支持HTML5，那么就可以一劳永逸地使用新的跨域策略：CORS了。</p>
<p>CORS全称Cross-Origin Resource Sharing，是HTML5规范定义的如何跨域访问资源。</p>
<p>了解CORS前，我们先搞明白概念：</p>
<p>Origin表示本域，也就是浏览器当前页面的域。当JavaScript向外域（<a target="_blank" rel="noopener" href="http://xn--sina-f96g.com">如sina.com</a>）发起请求后，浏览器收到响应后，首先检查<code>Access-Control-Allow-Origin</code>是否包含本域，如果是，则此次跨域请求成功，如果不是，则请求失败，JavaScript将无法获取到响应的任何数据。</p>
<p>用一个图来表示就是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">         GET /res/abc.data</span><br><span class="line">         Host: sina.com</span><br><span class="line">┌──────┐ Origin: http://my.com                      ┌────────┐</span><br><span class="line">│my.com│───────────────────────────────────────────▶│sina.com│</span><br><span class="line">│      │◀───────────────────────────────────────────│        │</span><br><span class="line">└──────┘ HTTP/1.1 200 OK                            └────────┘</span><br><span class="line">         Access-Control-Allow-Origin: http://my.com</span><br><span class="line">         Content-Type: text/xml</span><br><span class="line"></span><br><span class="line">         &lt;xml data...&gt;</span><br></pre></td></tr></table></figure>
<p>假设本域是<code>my.com</code>，外域是<code>sina.com</code>，只要响应头<code>Access-Control-Allow-Origin</code>为<code>http://my.com</code>，或者是<code>*</code>，本次请求就可以成功。</p>
<p>可见，跨域能否成功，取决于对方服务器是否愿意给你设置一个正确的<code>Access-Control-Allow-Origin</code>，决定权始终在对方手中。</p>
<p>上面这种跨域请求，称之为“简单请求”。简单请求包括GET、HEAD和POST（POST的Content-Type类型 仅限<code>application/x-www-form-urlencoded</code>、<code>multipart/form-data</code>和<code>text/plain</code>），并且不能出现任何自定义头（例如，<code>X-Custom: 12345</code>），通常能满足90%的需求。</p>
<p>无论你是否需要用JavaScript通过CORS跨域请求资源，你都要了解CORS的原理。最新的浏览器全面支持HTML5。在引用外域资源时，除了JavaScript和CSS外，都要验证CORS。例如，当你引用了某个第三方CDN上的字体文件时：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* CSS */</span></span><br><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&#x27;FontAwesome&#x27;</span>;</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&#x27;http://cdn.com/fonts/fontawesome.ttf&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;truetype&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果该CDN服务商未正确设置<code>Access-Control-Allow-Origin</code>，那么浏览器无法加载字体资源。</p>
<p>对于PUT、DELETE以及其他类型如<code>application/json</code>的POST请求，在发送AJAX请求之前，浏览器会先发送一个<code>OPTIONS</code>请求（称为preflighted请求）到这个URL上，询问目标服务器是否接受：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">OPTIONS /path/to/resource HTTP/1.1</span><br><span class="line">Host: bar.com</span><br><span class="line">Origin: http://my.com</span><br><span class="line">Access-Control-Request-Method: POST</span><br></pre></td></tr></table></figure>
<p>服务器必须响应并明确指出允许的Method：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Access-Control-Allow-Origin: http://my.com</span><br><span class="line">Access-Control-Allow-Methods: POST, GET, PUT, OPTIONS</span><br><span class="line">Access-Control-Max-Age: 86400</span><br></pre></td></tr></table></figure>
<p>浏览器确认服务器响应的<code>Access-Control-Allow-Methods</code>头确实包含将要发送的AJAX请求的Method，才会继续发送AJAX，否则，抛出一个错误。</p>
<p>由于以<code>POST</code>、<code>PUT</code>方式传送JSON格式的数据在REST中很常见，所以要跨域正确处理<code>POST</code>和<code>PUT</code>请求，服务器端必须正确响应<code>OPTIONS</code>请求。</p>
<p>需要深入了解CORS的童鞋请移步<a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/HTTP/CORS">MDN文档</a>和<a target="_blank" rel="noopener" href="http://www.w3.org/TR/cors/">W3C文档</a>。</p>
<p>在JavaScript的世界中，所有代码都是单线程执行的。</p>
<p>由于这个“缺陷”，导致JavaScript的所有网络操作，浏览器事件，都必须是异步执行。异步执行可以用回调函数实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">callback</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Done&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;before setTimeout()&#x27;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(callback, <span class="number">1000</span>); <span class="comment">// 1秒钟后调用callback函数</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;after setTimeout()&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>观察上述代码执行，在Chrome的控制台输出可以看到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">before setTimeout()</span><br><span class="line">after setTimeout()</span><br><span class="line">(等待1秒后)</span><br><span class="line">Done</span><br></pre></td></tr></table></figure>
<p>可见，异步操作会在将来的某个时间点触发一个函数调用。</p>
<p>AJAX就是典型的异步操作：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (request.<span class="property">readyState</span> === <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (request.<span class="property">status</span> === <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">success</span>(request.<span class="property">responseText</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">fail</span>(request.<span class="property">status</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>把回调函数<code>success(request.responseText)</code>和<code>fail(request.status)</code>写到一个AJAX操作里很正常，但是不好看，而且不利于代码复用。</p>
<p>有没有更好的写法？比如写成这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ajax = <span class="title function_">ajaxGet</span>(<span class="string">&#x27;http://...&#x27;</span>);</span><br><span class="line">ajax.<span class="title function_">ifSuccess</span>(success)</span><br><span class="line">    .<span class="title function_">ifFail</span>(fail);</span><br></pre></td></tr></table></figure>
<p>这种链式写法的好处在于，先统一执行AJAX逻辑，不关心如何处理结果，然后，根据结果是成功还是失败，在将来的某个时候调用<code>success</code>函数或<code>fail</code>函数。</p>
<p>古人云：“君子一诺千金”，这种“承诺将来会执行”的对象在JavaScript中称为Promise对象。</p>
<p>Promise有各种开源实现，在ES6中被统一规范，由浏览器直接支持。先测试一下你的浏览器是否支持Promise：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">new Promise(function () &#123;&#125;);</span><br><span class="line"></span><br><span class="line">// 直接运行测试:</span><br><span class="line">console.log(&#x27;支持Promise!&#x27;);</span><br></pre></td></tr></table></figure>
<p>我们先看一个最简单的Promise例子：生成一个0-2之间的随机数，如果小于1，则等待一段时间后返回成功，否则返回失败：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> timeOut = <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">2</span>;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;set timeout to: &#x27;</span> + timeOut + <span class="string">&#x27; seconds.&#x27;</span>);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (timeOut &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="title function_">log</span>(<span class="string">&#x27;call resolve()...&#x27;</span>);</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="string">&#x27;200 OK&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">log</span>(<span class="string">&#x27;call reject()...&#x27;</span>);</span><br><span class="line">            <span class="title function_">reject</span>(<span class="string">&#x27;timeout in &#x27;</span> + timeOut + <span class="string">&#x27; seconds.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, timeOut * <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个<code>test()</code>函数有两个参数，这两个参数都是函数，如果执行成功，我们将调用<code>resolve('200 OK')</code>，如果执行失败，我们将调用<code>reject('timeout in ' + timeOut + ' seconds.')</code>。可以看出，<code>test()</code>函数只关心自身的逻辑，并不关心具体的<code>resolve</code>和<code>reject</code>将如何处理结果。</p>
<p>有了执行函数，我们就可以用一个Promise对象来执行它，并在将来某个时刻获得成功或失败的结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(test);</span><br><span class="line"><span class="keyword">let</span> p2 = p1.<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;成功：&#x27;</span> + result);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">let</span> p3 = p2.<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">reason</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;失败：&#x27;</span> + reason);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>变量<code>p1</code>是一个Promise对象，它负责执行<code>test</code>函数。由于<code>test</code>函数在内部是异步执行的，当<code>test</code>函数执行成功时，我们告诉Promise对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果成功，执行这个函数：</span></span><br><span class="line">p1.<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;成功：&#x27;</span> + result);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当<code>test</code>函数执行失败时，我们告诉Promise对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p2.<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">reason</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;失败：&#x27;</span> + reason);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Promise对象可以串联起来，所以上述代码可以简化为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(test).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;成功：&#x27;</span> + result);</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">reason</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;失败：&#x27;</span> + reason);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>实际测试一下，看看Promise是如何异步执行的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">// 清除log:</span><br><span class="line">let logging = document.getElementById(&#x27;test-promise-log&#x27;);</span><br><span class="line">while (logging.children.length &gt; 1) &#123;</span><br><span class="line">    logging.removeChild(logging.children[logging.children.length - 1]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 输出log到页面:</span><br><span class="line">function log(s) &#123;</span><br><span class="line">    let p = document.createElement(&#x27;p&#x27;);</span><br><span class="line">    p.innerHTML = s;</span><br><span class="line">    logging.appendChild(p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">new Promise(function (resolve, reject) &#123;</span><br><span class="line">    log(&#x27;start new Promise...&#x27;);</span><br><span class="line">    let timeOut = Math.random() * 2;</span><br><span class="line">    log(&#x27;set timeout to: &#x27; + timeOut + &#x27; seconds.&#x27;);</span><br><span class="line">    setTimeout(function () &#123;</span><br><span class="line">        if (timeOut &lt; 1) &#123;</span><br><span class="line">            log(&#x27;call resolve()...&#x27;);</span><br><span class="line">            resolve(&#x27;200 OK&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            log(&#x27;call reject()...&#x27;);</span><br><span class="line">            reject(&#x27;timeout in &#x27; + timeOut + &#x27; seconds.&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, timeOut * 1000);</span><br><span class="line">&#125;).then(function (r) &#123;</span><br><span class="line">    log(&#x27;Done: &#x27; + r);</span><br><span class="line">&#125;).catch(function (reason) &#123;</span><br><span class="line">    log(&#x27;Failed: &#x27; + reason);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Log:</p>
<p>可见Promise最大的好处是在异步执行的流程中，把执行代码和处理结果的代码清晰地分离了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">                                   ┌──────────────────┐</span><br><span class="line">                           then    │on_resolve(data) &#123;│</span><br><span class="line">                       ┌──────────▶│    // TODO       │</span><br><span class="line">                       │           │&#125;                 │</span><br><span class="line">┌────────────────────────┐         └──────────────────┘</span><br><span class="line">│   new Promise(async)   │</span><br><span class="line">└────────────────────────┘         ┌──────────────────┐</span><br><span class="line">             │         │           │on_reject(data) &#123; │</span><br><span class="line">             │         └──────────▶│    // TODO       │</span><br><span class="line">      promise│             catch   │&#125;                 │</span><br><span class="line">             │                     └──────────────────┘</span><br><span class="line">             ▼</span><br><span class="line">┌────────────────────────┐</span><br><span class="line">│async(resolve, reject) &#123;│</span><br><span class="line">│    // TODO             │</span><br><span class="line">│&#125;                       │</span><br><span class="line">└────────────────────────┘</span><br></pre></td></tr></table></figure>
<p>Promise还可以做更多的事情，比如，有若干个异步任务，需要先做任务1，如果成功后再做任务2，任何任务失败则不再继续并执行错误处理函数。</p>
<p>要串行执行这样的异步任务，不用Promise需要写一层一层的嵌套代码。有了Promise，我们只需要简单地写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">job1.<span class="title function_">then</span>(job2).<span class="title function_">then</span>(job3).<span class="title function_">catch</span>(handleError);</span><br></pre></td></tr></table></figure>
<p>其中，<code>job1</code>、<code>job2</code>和<code>job3</code>都是Promise对象。</p>
<p>下面的例子演示了如何串行执行一系列需要异步计算获得结果的任务：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">let logging = document.getElementById(&#x27;test-promise2-log&#x27;);</span><br><span class="line">while (logging.children.length &gt; 1) &#123;</span><br><span class="line">    logging.removeChild(logging.children[logging.children.length - 1]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function log(s) &#123;</span><br><span class="line">    let p = document.createElement(&#x27;p&#x27;);</span><br><span class="line">    p.innerHTML = s;</span><br><span class="line">    logging.appendChild(p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 0.5秒后返回input*input的计算结果:</span><br><span class="line">function multiply(input) &#123;</span><br><span class="line">    return new Promise(function (resolve, reject) &#123;</span><br><span class="line">        log(&#x27;calculating &#x27; + input + &#x27; x &#x27; + input + &#x27;...&#x27;);</span><br><span class="line">        setTimeout(resolve, 500, input * input);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 0.5秒后返回input+input的计算结果:</span><br><span class="line">function add(input) &#123;</span><br><span class="line">    return new Promise(function (resolve, reject) &#123;</span><br><span class="line">        log(&#x27;calculating &#x27; + input + &#x27; + &#x27; + input + &#x27;...&#x27;);</span><br><span class="line">        setTimeout(resolve, 500, input + input);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let p = new Promise(function (resolve, reject) &#123;</span><br><span class="line">    log(&#x27;start new Promise...&#x27;);</span><br><span class="line">    resolve(123);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p.then(multiply)</span><br><span class="line"> .then(add)</span><br><span class="line"> .then(multiply)</span><br><span class="line"> .then(add)</span><br><span class="line"> .then(function (result) &#123;</span><br><span class="line">    log(&#x27;Got value: &#x27; + result);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Log:</p>
<p><code>setTimeout</code>可以看成一个模拟网络等异步执行的函数。</p>
<p>除了串行执行若干异步任务外，Promise还可以并行执行异步任务。</p>
<p>试想一个页面聊天系统，我们需要从两个不同的URL分别获得用户的个人信息和好友列表，这两个任务是可以并行执行的，用<code>Promise.all()</code>实现如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(resolve, <span class="number">500</span>, <span class="string">&#x27;P1&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">let</span> p2 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(resolve, <span class="number">600</span>, <span class="string">&#x27;P2&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 同时执行p1和p2，并在它们都完成后执行then:</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([p1, p2]).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">results</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(results); <span class="comment">// 获得一个Array: [&#x27;P1&#x27;, &#x27;P2&#x27;]</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>有些时候，多个异步任务是为了容错。比如，同时向两个URL读取用户的个人信息，只需要获得先返回的结果即可。这种情况下，用<code>Promise.race()</code>实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(resolve, <span class="number">500</span>, <span class="string">&#x27;P1&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">let</span> p2 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(resolve, <span class="number">600</span>, <span class="string">&#x27;P2&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">race</span>([p1, p2]).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(result); <span class="comment">// &#x27;P1&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>由于<code>p1</code>执行较快，Promise的<code>then()</code>将获得结果<code>'P1'</code>。<code>p2</code>仍在继续执行，但执行结果将被丢弃。</p>
<p>如果我们组合使用Promise，就可以把很多异步任务以并行和串行的方式组合起来执行。</p>
<p>我们说JavaScript异步操作需要通过Promise实现，一个Promise对象在操作网络时是异步的，等到返回后再调用回调函数，执行正确就调用<code>then()</code>，执行错误就调用<code>catch()</code>，虽然异步实现了，不会让用户感觉到页面“卡住”了，但是一堆<code>then()</code>、<code>catch()</code>写起来麻烦看起来也乱。</p>
<p>有没有更简单的写法？</p>
<p>可以用关键字<code>async</code>配合<code>await</code>调用Promise，实现异步操作，但代码却和同步写法类似：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">url</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> resp = <span class="keyword">await</span> <span class="title function_">fetch</span>(url);</span><br><span class="line">    <span class="keyword">let</span> result = <span class="keyword">await</span> resp.<span class="title function_">json</span>();</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用<code>async function</code>可以定义一个异步函数，异步函数和Promise可以看作是等价的，在async function内部，用<code>await</code>调用另一个异步函数，写起来和同步代码没啥区别，但执行起来是异步的。</p>
<p>也就是说：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> resp = <span class="keyword">await</span> <span class="title function_">fetch</span>(url);</span><br></pre></td></tr></table></figure>
<p>自动实现了异步调用，它和下面的Promise代码等价：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="title function_">fetch</span>(url);</span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function">(<span class="params">resp</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 拿到resp</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>如果我们要实现<code>catch()</code>怎么办？用Promise的写法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="title function_">fetch</span>(url);</span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function">(<span class="params">resp</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 拿到resp</span></span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 出错了</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>用<code>await</code>调用时，直接用传统的<code>try &#123; ... &#125; catch</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">url</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> resp = <span class="keyword">await</span> <span class="title function_">fetch</span>(url);</span><br><span class="line">        <span class="keyword">let</span> result = <span class="keyword">await</span> resp.<span class="title function_">json</span>();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="comment">// 出错了</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用async定义异步函数，用await调用异步函数，写起来和同步代码差不多，但可读性大大提高。</p>
<p>需要特别注意的是，<code>await</code>调用必须在async function中，不能在传统的同步代码中调用。那么问题来了，一个同步function怎么调用async function呢？</p>
<p>首先，普通function直接用await调用异步函数将报错：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">async function get(url) &#123;</span><br><span class="line">    let resp = await fetch(url);</span><br><span class="line">    return resp.json();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function doGet() &#123;</span><br><span class="line">    let data = await get(&#x27;/api/categories&#x27;);</span><br><span class="line">    console.log(data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">doGet();</span><br></pre></td></tr></table></figure>
<p>如果把<code>await</code>去掉，调用实际上发生了，但我们拿不到结果，因为我们拿到的并不是异步结果，而是一个Promise对象：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">async function get(url) &#123;</span><br><span class="line">    let resp = await fetch(url);</span><br><span class="line">    let result = await resp.text();</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function doGet() &#123;</span><br><span class="line">    let promise = get(&#x27;./content.html&#x27;);</span><br><span class="line">    console.log(promise);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">doGet();</span><br></pre></td></tr></table></figure>
<p>因此，在普通function中调用async function，不能使用await，但可以直接调用async function拿到Promise对象，后面加上<code>then()</code>和<code>catch()</code>就可以拿到结果或错误了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">async function get(url) &#123;</span><br><span class="line">    let resp = await fetch(url);</span><br><span class="line">    let result = await resp.text();</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function doGet() &#123;</span><br><span class="line">    let promise = get(&#x27;./content.html&#x27;);</span><br><span class="line">    promise.then(data =&gt; &#123;</span><br><span class="line">        // 拿到data</span><br><span class="line">        document.getElementById(&#x27;test-response-text&#x27;).value = JSON.stringify(data);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">doGet();</span><br></pre></td></tr></table></figure>
<p>因此，定义异步任务时，使用async function比Promise简单，调用异步任务时，使用await比Promise简单，捕获错误时，按传统的<code>try...catch</code>写法，也比Promise简单。只要浏览器支持，完全可以用<code>async</code>简洁地实现异步操作。</p>
<p>Canvas是HTML5新增的组件，它就像一块幕布，可以用JavaScript在上面绘制各种图表、动画等。</p>
<p>没有Canvas的年代，绘图只能借助Flash插件实现，页面不得不用JavaScript和Flash进行交互。有了Canvas，我们就再也不需要Flash了，直接使用JavaScript完成绘制。</p>
<p>一个Canvas定义了一个指定尺寸的矩形框，在这个范围内我们可以随意绘制：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;test-canvas&quot;</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> <span class="attr">height</span>=<span class="string">&quot;200&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>由于浏览器对HTML5标准支持不一致，所以，通常在<code>&lt;canvas&gt;</code>内部添加一些说明性HTML代码，如果浏览器支持Canvas，它将忽略<code>&lt;canvas&gt;</code>内部的HTML，如果浏览器不支持Canvas，它将显示<code>&lt;canvas&gt;</code>内部的HTML。在使用Canvas前，用<code>canvas.getContext</code>来测试浏览器是否支持Canvas：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML代码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;test-canvas&quot;</span> <span class="attr">width</span>=<span class="string">&quot;200&quot;</span> <span class="attr">heigth</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>你的浏览器不支持Canvas<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>你的浏览器不支持Canvas</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let canvas = document.getElementById(&#x27;test-canvas&#x27;);</span><br><span class="line">if (canvas.getContext) &#123;</span><br><span class="line">    console.log(&#x27;你的浏览器支持Canvas!&#x27;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    console.log(&#x27;你的浏览器不支持Canvas!&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>getContext('2d')</code>方法让我们拿到一个<code>CanvasRenderingContext2D</code>对象，所有的绘图操作都需要通过这个对象完成。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>如果需要绘制3D怎么办？HTML5还有一个WebGL规范，允许在Canvas中绘制3D图形：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gl = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;webgl&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>本节我们只专注于绘制2D图形。</p>
<h3 id="绘制形状">绘制形状</h3>
<p>我们可以在Canvas上绘制各种形状。在绘制前，我们需要先了解一下Canvas的坐标系统：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> 0,0                20</span><br><span class="line">  ┌───────────────────────▶ x</span><br><span class="line">  │                 │</span><br><span class="line">  │</span><br><span class="line">  │                 │</span><br><span class="line">10│─ ─ ─ ─ ─ ─ ─ ─ ─●</span><br><span class="line">  │                  20,10</span><br><span class="line">  ▼</span><br><span class="line">  y</span><br></pre></td></tr></table></figure>
<p>Canvas的坐标以左上角为原点，水平向右为X轴，垂直向下为Y轴，以像素为单位，所以每个点都是非负整数。</p>
<p><code>CanvasRenderingContext2D</code>对象有若干方法来绘制图形：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">let</span><br><span class="line">    canvas = document.getElementById(&#x27;test-shape-canvas&#x27;),</span><br><span class="line">    ctx = canvas.getContext(&#x27;2d&#x27;);</span><br><span class="line"></span><br><span class="line">ctx.clearRect(0, 0, 200, 200); // 擦除(0,0)位置大小为200x200的矩形，擦除的意思是把该区域变为透明</span><br><span class="line">ctx.fillStyle = &#x27;#dddddd&#x27;; // 设置颜色</span><br><span class="line">ctx.fillRect(10, 10, 130, 130); // 把(10,10)位置大小为130x130的矩形涂色</span><br><span class="line">// 利用Path绘制复杂路径:</span><br><span class="line">let path=new Path2D();</span><br><span class="line">path.arc(75, 75, 50, 0, Math.PI*2, true);</span><br><span class="line">path.moveTo(110,75);</span><br><span class="line">path.arc(75, 75, 35, 0, Math.PI, false);</span><br><span class="line">path.moveTo(65, 65);</span><br><span class="line">path.arc(60, 65, 5, 0, Math.PI*2, true);</span><br><span class="line">path.moveTo(95, 65);</span><br><span class="line">path.arc(90, 65, 5, 0, Math.PI*2, true);</span><br><span class="line">ctx.strokeStyle = &#x27;#0000ff&#x27;;</span><br><span class="line">ctx.stroke(path);</span><br></pre></td></tr></table></figure>
<h3 id="绘制文本">绘制文本</h3>
<p>绘制文本就是在指定的位置输出文本，可以设置文本的字体、样式、阴影等，与CSS完全一致：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">let</span><br><span class="line">    canvas = document.getElementById(&#x27;test-text-canvas&#x27;),</span><br><span class="line">    ctx = canvas.getContext(&#x27;2d&#x27;);</span><br><span class="line"></span><br><span class="line">ctx.fillStyle = &#x27;#fff&#x27;;</span><br><span class="line">ctx.fillRect(0, 0, 300, 100);</span><br><span class="line">ctx.shadowOffsetX = 2;</span><br><span class="line">ctx.shadowOffsetY = 2;</span><br><span class="line">ctx.shadowBlur = 2;</span><br><span class="line">ctx.shadowColor = &#x27;#ccc&#x27;;</span><br><span class="line">ctx.font = &#x27;28px Arial&#x27;;</span><br><span class="line">ctx.fillStyle = &#x27;#999&#x27;;</span><br><span class="line">ctx.fillText(&#x27;带阴影的文字&#x27;, 20, 40);</span><br></pre></td></tr></table></figure>
<p>Canvas除了能绘制基本的形状和文本，还可以实现动画、缩放、各种滤镜和像素转换等高级操作。如果要实现非常复杂的操作，考虑以下优化方案：</p>
<ul>
<li>通过创建一个不可见的Canvas来绘图，然后将最终绘制结果复制到页面的可见Canvas中；</li>
<li>尽量使用整数坐标而不是浮点数；</li>
<li>可以创建多个重叠的Canvas绘制不同的层，而不是在一个Canvas中绘制非常复杂的图；</li>
<li>背景图片如果不变可以直接用<code>&lt;img&gt;</code>标签并放到最底层。</li>
</ul>
<h3 id="练习-6">练习</h3>
<p>请根据天气API返回的JSON数据在Canvas上绘制未来天气预报，如下图所示：</p>
<p><img src="https://liaoxuefeng.com/books/javascript/browser/canvas/weather.jpg" alt="weather"></p>
<p><a href="#0">下载</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">let data = [</span><br><span class="line">    &#123; high: 35, low: 22 &#125;,</span><br><span class="line">    &#123; high: 37, low: 24 &#125;,</span><br><span class="line">    &#123; high: 37, low: 25 &#125;,</span><br><span class="line">    &#123; high: 34, low: 24 &#125;,</span><br><span class="line">    &#123; high: 33, low: 23 &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">let canvas = document.getElementById(&#x27;weather-canvas&#x27;);</span><br><span class="line">// TODO: 绘图</span><br><span class="line">// 400x200</span><br><span class="line"></span><br><span class="line">// 下载:</span><br><span class="line">let download = document.getElementById(&#x27;weather-download&#x27;);</span><br><span class="line">download.href = canvas.toDataURL();</span><br></pre></td></tr></table></figure>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../../2024/01/14/JavaScript/JavaScript-%E6%B5%8F%E8%A7%88%E5%99%A8/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../../2024/01/13/JavaScript/JavaScript-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/"
                            aria-label=": JavaScript-面向对象编程"
                        >
                            JavaScript-面向对象编程
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2024-01-13T21:16:23+08:00">
	
		    2024 年 1 月 13 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../../categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a>, <a class="category-link" href="../../../categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/JavaScript/">JavaScript</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>JavaScript的所有数据都可以看成对象，那是不是我们已经在使用面向对象编程了呢？</p>
<p>当然不是。如果我们只使用<code>Number</code>、<code>Array</code>、<code>string</code>以及基本的<code>&#123;...&#125;</code>定义的对象，还无法发挥出面向对象编程的威力。</p>
<p>JavaScript的面向对象编程和大多数其他语言如Java、C#的面向对象编程都不太一样。如果你熟悉Java或C#，很好，你一定明白面向对象的两个基本概念：</p>
<ol>
<li>类：类是对象的类型模板，例如，定义<code>Student</code>类来表示学生，类本身是一种类型，<code>Student</code>表示学生类型，但不表示任何具体的某个学生；</li>
<li>实例：实例是根据类创建的对象，例如，根据<code>Student</code>类可以创建出<code>xiaoming</code>、<code>xiaohong</code>、<code>xiaojun</code>等多个实例，每个实例表示一个具体的学生，他们全都属于<code>Student</code>类型。</li>
</ol>
<p>所以，类和实例是大多数面向对象编程语言的基本概念。</p>
<p>不过，在JavaScript中，这个概念需要改一改。JavaScript不区分类和实例的概念，而是通过原型（prototype）来实现面向对象编程。</p>
<p>原型是指当我们想要创建<code>xiaoming</code>这个具体的学生时，我们并没有一个<code>Student</code>类型可用。那怎么办？恰好有这么一个现成的对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> robot = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Robot&#x27;</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">1.6</span>,</span><br><span class="line">    <span class="attr">run</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27; is running...&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>我们看这个<code>robot</code>对象有名字，有身高，还会跑，有点像小明，干脆就根据它来“创建”小明得了！</p>
<p>于是我们把它改名为<code>Student</code>，然后创建出<code>xiaoming</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title class_">Student</span> = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Robot&#x27;</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">1.2</span>,</span><br><span class="line">    <span class="attr">run</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27; is running...&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xiaoming.<span class="property">__proto__</span> = <span class="title class_">Student</span>;</span><br></pre></td></tr></table></figure>
<p>注意最后一行代码把<code>xiaoming</code>的原型指向了对象<code>Student</code>，看上去<code>xiaoming</code>仿佛是从<code>Student</code>继承下来的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xiaoming.<span class="property">name</span>; <span class="comment">// &#x27;小明&#x27;</span></span><br><span class="line">xiaoming.<span class="title function_">run</span>(); <span class="comment">// 小明 is running...</span></span><br></pre></td></tr></table></figure>
<p><code>xiaoming</code>有自己的<code>name</code>属性，但并没有定义<code>run()</code>方法。不过，由于小明是从<code>Student</code>继承而来，只要<code>Student</code>有<code>run()</code>方法，<code>xiaoming</code>也可以调用：</p>
<p><img src="https://liaoxuefeng.com/books/javascript/oop/proto.jpg" alt="xiaoming-prototype"></p>
<p>JavaScript的原型链和Java的Class区别就在，它没有“Class”的概念，所有对象都是实例，所谓继承关系不过是把一个对象的原型指向另一个对象而已。</p>
<p>如果你把<code>xiaoming</code>的原型指向其他对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title class_">Bird</span> = &#123;</span><br><span class="line">    <span class="attr">fly</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27; is flying...&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xiaoming.<span class="property">__proto__</span> = <span class="title class_">Bird</span>;</span><br></pre></td></tr></table></figure>
<p>现在<code>xiaoming</code>已经无法<code>run()</code>了，他已经变成了一只鸟：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xiaoming.<span class="title function_">fly</span>(); <span class="comment">// 小明 is flying...</span></span><br></pre></td></tr></table></figure>
<p>在JavaScrip代码运行时期，你可以把<code>xiaoming</code>从<code>Student</code>变成<code>Bird</code>，或者变成任何对象。</p>
<p><em>请注意</em>，上述代码仅用于演示目的。在编写JavaScript代码时，不要直接用<code>obj.__proto__</code>去改变一个对象的原型，并且，低版本的IE也无法使用<code>__proto__</code>。<code>Object.create()</code>方法可以传入一个原型对象，并创建一个基于该原型的新对象，但是新对象什么属性都没有，因此，我们可以编写一个函数来创建<code>xiaoming</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 原型对象:</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">Student</span> = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Robot&#x27;</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">1.2</span>,</span><br><span class="line">    <span class="attr">run</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27; is running...&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createStudent</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="comment">// 基于Student原型创建一个新对象:</span></span><br><span class="line">    <span class="keyword">let</span> s = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Student</span>);</span><br><span class="line">    <span class="comment">// 初始化新对象:</span></span><br><span class="line">    s.<span class="property">name</span> = name;</span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> xiaoming = <span class="title function_">createStudent</span>(<span class="string">&#x27;小明&#x27;</span>);</span><br><span class="line">xiaoming.<span class="title function_">run</span>(); <span class="comment">// 小明 is running...</span></span><br><span class="line">xiaoming.<span class="property">__proto__</span> === <span class="title class_">Student</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>这是创建原型继承的一种方法，JavaScript还有其他方法来创建对象，我们在后面会一一讲到。</p>
<p>JavaScript对每个创建的对象都会设置一个原型，指向它的原型对象。</p>
<p>当我们用<code>obj.xxx</code>访问一个对象的属性时，JavaScript引擎先在当前对象上查找该属性，如果没有找到，就到其原型对象上找，如果还没有找到，就一直上溯到<code>Object.prototype</code>对象，最后，如果还没有找到，就只能返回<code>undefined</code>。</p>
<p>例如，创建一个<code>Array</code>对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br></pre></td></tr></table></figure>
<p>其原型链是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">       null</span><br><span class="line">         ▲</span><br><span class="line">         │</span><br><span class="line">┌─────────────────┐</span><br><span class="line">│Object.prototype │</span><br><span class="line">└─────────────────┘</span><br><span class="line">         ▲</span><br><span class="line">         │</span><br><span class="line">┌─────────────────┐</span><br><span class="line">│ Array.prototype │</span><br><span class="line">└─────────────────┘</span><br><span class="line">         ▲</span><br><span class="line">         │</span><br><span class="line">┌─────────────────┐</span><br><span class="line">│       arr       │</span><br><span class="line">└─────────────────┘</span><br></pre></td></tr></table></figure>
<p><code>Array.prototype</code>定义了<code>indexOf()</code>、<code>shift()</code>等方法，因此你可以在所有的<code>Array</code>对象上直接调用这些方法。</p>
<p>当我们创建一个函数时：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>函数也是一个对象，它的原型链是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">        null</span><br><span class="line">          ▲</span><br><span class="line">          │</span><br><span class="line">┌───────────────────┐</span><br><span class="line">│ Object.prototype  │</span><br><span class="line">└───────────────────┘</span><br><span class="line">          ▲</span><br><span class="line">          │</span><br><span class="line">┌───────────────────┐</span><br><span class="line">│Function.prototype │</span><br><span class="line">└───────────────────┘</span><br><span class="line">          ▲</span><br><span class="line">          │</span><br><span class="line">┌───────────────────┐</span><br><span class="line">│        foo        │</span><br><span class="line">└───────────────────┘</span><br></pre></td></tr></table></figure>
<p>由于<code>Function.prototype</code>定义了<code>apply()</code>等方法，因此，所有函数都可以调用<code>apply()</code>方法。</p>
<p>很容易想到，如果原型链很长，那么访问一个对象的属性就会因为花更多的时间查找而变得更慢，因此要注意不要把原型链搞得太长。</p>
<h3 id="构造函数">构造函数</h3>
<p>除了直接用<code>&#123; ... &#125;</code>创建一个对象外，JavaScript还可以用一种构造函数的方法来创建对象。它的用法是，先定义一个构造函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hello</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&#x27;Hello, &#x27;</span> + <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27;!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你会问，咦，这不是一个普通函数吗？</p>
<p>这确实是一个普通函数，但是在JavaScript中，可以用关键字<code>new</code>来调用这个函数，并返回一个对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xiaoming = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&#x27;小明&#x27;</span>);</span><br><span class="line">xiaoming.<span class="property">name</span>; <span class="comment">// &#x27;小明&#x27;</span></span><br><span class="line">xiaoming.<span class="title function_">hello</span>(); <span class="comment">// Hello, 小明!</span></span><br></pre></td></tr></table></figure>
<p><em>注意</em>，如果不写<code>new</code>，这就是一个普通函数，它返回<code>undefined</code>。但是，如果写了<code>new</code>，它就变成了一个构造函数，它绑定的<code>this</code>指向新创建的对象，并默认返回<code>this</code>，也就是说，不需要在最后写<code>return this;</code>。</p>
<p>新创建的<code>xiaoming</code>的原型链是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">       null</span><br><span class="line">         ▲</span><br><span class="line">         │</span><br><span class="line">┌─────────────────┐</span><br><span class="line">│Object.prototype │</span><br><span class="line">└─────────────────┘</span><br><span class="line">         ▲</span><br><span class="line">         │</span><br><span class="line">┌─────────────────┐</span><br><span class="line">│Student.prototype│</span><br><span class="line">└─────────────────┘</span><br><span class="line">         ▲</span><br><span class="line">         │</span><br><span class="line">┌─────────────────┐</span><br><span class="line">│    xiaoming     │</span><br><span class="line">└─────────────────┘</span><br></pre></td></tr></table></figure>
<p>也就是说，<code>xiaoming</code>的原型指向函数<code>Student</code>的原型。如果你又创建了<code>xiaohong</code>、<code>xiaojun</code>，那么这些对象的原型与<code>xiaoming</code>是一样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">              null</span><br><span class="line">                ▲</span><br><span class="line">                │</span><br><span class="line">       ┌─────────────────┐</span><br><span class="line">       │Object.prototype │</span><br><span class="line">       └─────────────────┘</span><br><span class="line">                ▲</span><br><span class="line">                │</span><br><span class="line">       ┌─────────────────┐</span><br><span class="line">       │Student.prototype│</span><br><span class="line">       └─────────────────┘</span><br><span class="line">         ▲      ▲      ▲</span><br><span class="line">         │      │      │</span><br><span class="line">┌─────────┐┌─────────┐┌─────────┐</span><br><span class="line">│xiaoming ││xiaohong ││ xiaojun │</span><br><span class="line">└─────────┘└─────────┘└─────────┘</span><br></pre></td></tr></table></figure>
<p>用<code>new Student()</code>创建的对象还从原型上获得了一个<code>constructor</code>属性，它指向函数<code>Student</code>本身：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xiaoming.<span class="property">constructor</span> === <span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span>; <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> === <span class="title class_">Student</span>; <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(xiaoming) === <span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">xiaoming <span class="keyword">instanceof</span> <span class="title class_">Student</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>看晕了吧？用一张图来表示这些乱七八糟的关系就是：</p>
<p><img src="https://liaoxuefeng.com/books/javascript/oop/create-object/prototypes.jpg" alt="prototypes"></p>
<p>红色箭头是原型链。注意，<code>Student.prototype</code>指向的对象就是<code>xiaoming</code>、<code>xiaohong</code>的原型对象，这个原型对象自己还有个属性<code>constructor</code>，指向<code>Student</code>函数本身。</p>
<p>另外，函数<code>Student</code>恰好有个属性<code>prototype</code>指向<code>xiaoming</code>、<code>xiaohong</code>的原型对象，但是<code>xiaoming</code>、<code>xiaohong</code>这些对象可没有<code>prototype</code>这个属性，不过可以用<code>__proto__</code>这个非标准用法来查看。</p>
<p>现在我们就认为<code>xiaoming</code>、<code>xiaohong</code>这些对象“继承”自<code>Student</code>。</p>
<p>不过还有一个小问题，注意观察：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xiaoming.<span class="property">name</span>; <span class="comment">// &#x27;小明&#x27;</span></span><br><span class="line">xiaohong.<span class="property">name</span>; <span class="comment">// &#x27;小红&#x27;</span></span><br><span class="line">xiaoming.<span class="property">hello</span>; <span class="comment">// function: Student.hello()</span></span><br><span class="line">xiaohong.<span class="property">hello</span>; <span class="comment">// function: Student.hello()</span></span><br><span class="line">xiaoming.<span class="property">hello</span> === xiaohong.<span class="property">hello</span>; <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p><code>xiaoming</code>和<code>xiaohong</code>各自的<code>name</code>不同，这是对的，否则我们无法区分谁是谁了。</p>
<p><code>xiaoming</code>和<code>xiaohong</code>各自的<code>hello</code>是一个函数，但它们是两个不同的函数，虽然函数名称和代码都是相同的！</p>
<p>如果我们通过<code>new Student()</code>创建了很多对象，这些对象的<code>hello</code>函数实际上只需要共享同一个函数就可以了，这样可以节省很多内存。</p>
<p>要让创建的对象共享一个<code>hello</code>函数，根据对象的属性查找原则，我们只要把<code>hello</code>函数移动到<code>xiaoming</code>、<code>xiaohong</code>这些对象共同的原型上就可以了，也就是<code>Student.prototype</code>：</p>
<p><img src="https://liaoxuefeng.com/books/javascript/oop/create-object/proto-share.jpg" alt="protos2"></p>
<p>修改代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hello</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;Hello, &#x27;</span> + <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27;!&#x27;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>用<code>new</code>创建基于原型的JavaScript的对象就是这么简单！</p>
<h3 id="忘记写new怎么办">忘记写new怎么办</h3>
<p>如果一个函数被定义为用于创建对象的构造函数，但是调用时忘记了写<code>new</code>怎么办？</p>
<p>在strict模式下，<code>this.name = name</code>将报错，因为<code>this</code>绑定为<code>undefined</code>，在非strict模式下，<code>this.name = name</code>不报错，因为<code>this</code>绑定为<code>window</code>，于是无意间创建了全局变量<code>name</code>，并且返回<code>undefined</code>，这个结果更糟糕。</p>
<p>所以，调用构造函数千万不要忘记写<code>new</code>。为了区分普通函数和构造函数，按照约定，构造函数首字母应当大写，而普通函数首字母应当小写，这样，一些语法检查工具如<a target="_blank" rel="noopener" href="https://www.jslint.com/">jslint</a>将可以帮你检测到漏写的<code>new</code>。</p>
<p>最后，我们还可以编写一个<code>createStudent()</code>函数，在内部封装所有的<code>new</code>操作。一个常用的编程模式像这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = props.<span class="property">name</span> || <span class="string">&#x27;匿名&#x27;</span>; <span class="comment">// 默认值为&#x27;匿名&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grade</span> = props.<span class="property">grade</span> || <span class="number">1</span>; <span class="comment">// 默认值为1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hello</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;Hello, &#x27;</span> + <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27;!&#x27;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createStudent</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Student</span>(props || &#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个<code>createStudent()</code>函数有几个巨大的优点：一是不需要<code>new</code>来调用，二是参数非常灵活，可以不传，也可以这么传：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xiaoming = <span class="title function_">createStudent</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">xiaoming.<span class="property">grade</span>; <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p>如果创建的对象有很多属性，我们只需要传递需要的某些属性，剩下的属性可以用默认值。由于参数是一个Object，我们无需记忆参数的顺序。如果恰好从<code>JSON</code>拿到了一个对象，就可以直接创建出<code>xiaoming</code>。</p>
<h3 id="练习">练习</h3>
<p>请利用构造函数定义<code>Cat</code>，并让所有的Cat对象有一个<code>name</code>属性，并共享一个方法<code>say()</code>，返回字符串<code>'Hello, xxx!'</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function Cat(name) &#123;</span><br><span class="line">    // TODO:</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">let kitty = new Cat(&#x27;Kitty&#x27;);</span><br><span class="line">let doraemon = new Cat(&#x27;哆啦A梦&#x27;);</span><br><span class="line">if (kitty &amp;&amp; kitty.name === &#x27;Kitty&#x27;</span><br><span class="line">    &amp;&amp; kitty.say</span><br><span class="line">    &amp;&amp; typeof kitty.say === &#x27;function&#x27;</span><br><span class="line">    &amp;&amp; kitty.say() === &#x27;Hello, Kitty!&#x27;</span><br><span class="line">    &amp;&amp; kitty.say === doraemon.say</span><br><span class="line">) &#123;</span><br><span class="line">    console.log(&#x27;测试通过!&#x27;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    console.log(&#x27;测试失败!&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在传统的基于Class的语言如Java、C++中，继承的本质是扩展一个已有的Class，并生成新的Subclass。</p>
<p>由于这类语言严格区分类和实例，继承实际上是类型的扩展。但是，JavaScript由于采用原型继承，我们无法直接扩展一个Class，因为根本不存在Class这种类型。</p>
<p>但是办法还是有的。我们先回顾<code>Student</code>构造函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = props.<span class="property">name</span> || <span class="string">&#x27;Unnamed&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hello</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;Hello, &#x27;</span> + <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27;!&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以及<code>Student</code>的原型链：</p>
<p><img src="https://liaoxuefeng.com/books/javascript/oop/prototype/prototype-chain.jpg" alt="js-proto"></p>
<p>现在，我们要基于<code>Student</code>扩展出<code>PrimaryStudent</code>，可以先定义出<code>PrimaryStudent</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">PrimaryStudent</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="comment">// 调用Student构造函数，绑定this变量:</span></span><br><span class="line">    <span class="title class_">Student</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grade</span> = props.<span class="property">grade</span> || <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是，调用了<code>Student</code>构造函数不等于继承了<code>Student</code>，<code>PrimaryStudent</code>创建的对象的原型是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new PrimaryStudent() --&gt; PrimaryStudent.prototype --&gt; Object.prototype --&gt; null</span><br></pre></td></tr></table></figure>
<p>必须想办法把原型链修改为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new PrimaryStudent() --&gt; PrimaryStudent.prototype --&gt; Student.prototype --&gt; Object.prototype --&gt; null</span><br></pre></td></tr></table></figure>
<p>这样，原型链对了，继承关系就对了。新的基于<code>PrimaryStudent</code>创建的对象不但能调用<code>PrimaryStudent.prototype</code>定义的方法，也可以调用<code>Student.prototype</code>定义的方法。</p>
<p>如果你想用最简单粗暴的方法这么干：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">PrimaryStudent</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>;</span><br></pre></td></tr></table></figure>
<p>是不行的！如果这样的话，<code>PrimaryStudent</code>和<code>Student</code>共享一个原型对象，那还要定义<code>PrimaryStudent</code>干啥？</p>
<p>我们必须借助一个中间对象来实现正确的原型链，这个中间对象的原型要指向<code>Student.prototype</code>。为了实现这一点，参考道爷（就是发明JSON的那个道格拉斯）的代码，中间对象可以用一个空函数<code>F</code>来实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PrimaryStudent构造函数:</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">PrimaryStudent</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="title class_">Student</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grade</span> = props.<span class="property">grade</span> || <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 空函数F:</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>) &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把F的原型指向Student.prototype:</span></span><br><span class="line">F.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把PrimaryStudent的原型指向一个新的F对象，F对象的原型正好指向Student.prototype:</span></span><br><span class="line"><span class="title class_">PrimaryStudent</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title function_">F</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把PrimaryStudent原型的构造函数修复为PrimaryStudent:</span></span><br><span class="line"><span class="title class_">PrimaryStudent</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">PrimaryStudent</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 继续在PrimaryStudent原型（就是new F()对象）上定义方法：</span></span><br><span class="line"><span class="title class_">PrimaryStudent</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getGrade</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">grade</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建xiaoming:</span></span><br><span class="line"><span class="keyword">let</span> xiaoming = <span class="keyword">new</span> <span class="title class_">PrimaryStudent</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">grade</span>: <span class="number">2</span></span><br><span class="line">&#125;);</span><br><span class="line">xiaoming.<span class="property">name</span>; <span class="comment">// &#x27;小明&#x27;</span></span><br><span class="line">xiaoming.<span class="property">grade</span>; <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证原型:</span></span><br><span class="line">xiaoming.<span class="property">__proto__</span> === <span class="title class_">PrimaryStudent</span>.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// true</span></span><br><span class="line">xiaoming.<span class="property">__proto__</span>.<span class="property">__proto__</span> === <span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证继承关系:</span></span><br><span class="line">xiaoming <span class="keyword">instanceof</span> <span class="title class_">PrimaryStudent</span>; <span class="comment">// true</span></span><br><span class="line">xiaoming <span class="keyword">instanceof</span> <span class="title class_">Student</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>用一张图来表示新的原型链：</p>
<p><img src="https://liaoxuefeng.com/books/javascript/oop/prototype/prototype-inherit.jpg" alt="js-proto-inherit"></p>
<p>注意，函数<code>F</code>仅用于桥接，我们仅创建了一个<code>new F()</code>实例，而且，没有改变原有的<code>Student</code>定义的原型链。</p>
<p>如果把继承这个动作用一个<code>inherits()</code>函数封装起来，还可以隐藏<code>F</code>的定义，并简化代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">inherits</span>(<span class="params">Child, Parent</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> F = <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;;</span><br><span class="line">    F.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Parent</span>.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">    <span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title function_">F</span>();</span><br><span class="line">    <span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Child</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个<code>inherits()</code>函数可以复用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = props.<span class="property">name</span> || <span class="string">&#x27;Unnamed&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hello</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;Hello, &#x27;</span> + <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27;!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">PrimaryStudent</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="title class_">Student</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grade</span> = props.<span class="property">grade</span> || <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现原型继承链:</span></span><br><span class="line"><span class="title function_">inherits</span>(<span class="title class_">PrimaryStudent</span>, <span class="title class_">Student</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定其他方法到PrimaryStudent原型:</span></span><br><span class="line"><span class="title class_">PrimaryStudent</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getGrade</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">grade</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="小结">小结</h3>
<p>JavaScript的原型继承实现方式就是：</p>
<ol>
<li>定义新的构造函数，并在内部用<code>call()</code>调用希望“继承”的构造函数，并绑定<code>this</code>；</li>
<li>借助中间函数<code>F</code>实现原型链继承，最好通过封装的<code>inherits</code>函数完成；</li>
<li>继续在新的构造函数的原型上定义新方法。</li>
</ol>
<h2 id="class继承">class继承</h2>
<p>在上面的章节中我们看到了JavaScript的对象模型是基于原型实现的，特点是简单，缺点是理解起来比传统的类－实例模型要困难，最大的缺点是继承的实现需要编写大量代码，并且需要正确实现原型链。</p>
<p>有没有更简单的写法？有！</p>
<p>新的关键字<code>class</code>从ES6开始正式被引入到JavaScript中。<code>class</code>的目的就是让定义类更简单。</p>
<p>我们先回顾用函数实现<code>Student</code>的方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hello</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;Hello, &#x27;</span> + <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27;!&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果用新的<code>class</code>关键字来编写<code>Student</code>，可以这样写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">hello</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&#x27;Hello, &#x27;</span> + <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27;!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>比较一下就可以发现，<code>class</code>的定义包含了构造函数<code>constructor</code>和定义在原型对象上的函数<code>hello()</code>（注意没有<code>function</code>关键字），这样就避免了<code>Student.prototype.hello = function () &#123;...&#125;</code>这样分散的代码。</p>
<p>最后，创建一个<code>Student</code>对象代码和前面章节完全一样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xiaoming = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&#x27;小明&#x27;</span>);</span><br><span class="line">xiaoming.<span class="title function_">hello</span>();</span><br></pre></td></tr></table></figure>
<h3 id="class继承-2">class继承</h3>
<p>用<code>class</code>定义对象的另一个巨大的好处是继承更方便了。想一想我们从<code>Student</code>派生一个<code>PrimaryStudent</code>需要编写的代码量。现在，原型继承的中间对象，原型对象的构造函数等等都不需要考虑了，直接通过<code>extends</code>来实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PrimaryStudent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Student</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name, grade</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(name); <span class="comment">// 记得用super调用父类的构造方法!</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">grade</span> = grade;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">myGrade</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&#x27;I am at grade &#x27;</span> + <span class="variable language_">this</span>.<span class="property">grade</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意<code>PrimaryStudent</code>的定义也是class关键字实现的，而<code>extends</code>则表示原型链对象来自<code>Student</code>。子类的构造函数可能会与父类不太相同，例如，<code>PrimaryStudent</code>需要<code>name</code>和<code>grade</code>两个参数，并且需要通过<code>super(name)</code>来调用父类的构造函数，否则父类的<code>name</code>属性无法正常初始化。</p>
<p><code>PrimaryStudent</code>已经自动获得了父类<code>Student</code>的<code>hello</code>方法，我们又在子类中定义了新的<code>myGrade</code>方法。</p>
<p>ES6引入的<code>class</code>和原有的JavaScript原型继承有什么区别呢？实际上它们没有任何区别，<code>class</code>的作用就是让JavaScript引擎去实现原来需要我们自己编写的原型链代码。简而言之，用<code>class</code>的好处就是极大地简化了原型链代码。</p>
<h3 id="练习-2">练习</h3>
<p>请利用<code>class</code>重新定义<code>Cat</code>，并让它从已有的<code>Animal</code>继承，然后新增一个方法<code>say()</code>，返回字符串<code>'Hello, xxx!'</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">class Animal &#123;</span><br><span class="line">    constructor(name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// FIXME:</span><br><span class="line">class Cat ???</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">let kitty = new Cat(&#x27;Kitty&#x27;);</span><br><span class="line">let doraemon = new Cat(&#x27;哆啦A梦&#x27;);</span><br><span class="line">if ((new Cat(&#x27;x&#x27;) instanceof Animal)</span><br><span class="line">    &amp;&amp; kitty </span><br><span class="line">    &amp;&amp; kitty.name === &#x27;Kitty&#x27;</span><br><span class="line">    &amp;&amp; kitty.say</span><br><span class="line">    &amp;&amp; typeof kitty.say === &#x27;function&#x27;</span><br><span class="line">    &amp;&amp; kitty.say() === &#x27;Hello, Kitty!&#x27;</span><br><span class="line">    &amp;&amp; kitty.say === doraemon.say)</span><br><span class="line">&#123;</span><br><span class="line">    console.log(&#x27;测试通过!&#x27;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    console.log(&#x27;测试失败!&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个练习需要浏览器支持ES6的<code>class</code>，如果遇到SyntaxError，则说明浏览器不支持<code>class</code>语法，请换一个最新的浏览器试试。</p>
<hr>
<hr>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../../2024/01/13/JavaScript/JavaScript-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../../2024/01/12/JavaScript/JavaScript-%E6%A0%87%E5%87%86%E5%AF%B9%E8%B1%A1/"
                            aria-label=": JavaScript-标准对象"
                        >
                            JavaScript-标准对象
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2024-01-12T21:14:28+08:00">
	
		    2024 年 1 月 12 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../../categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a>, <a class="category-link" href="../../../categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/JavaScript/">JavaScript</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="标准对象">标准对象</h2>
<p>在JavaScript的世界里，一切都是对象。</p>
<p>但是某些对象还是和其他对象不太一样。为了区分对象的类型，我们用<code>typeof</code>操作符获取对象的类型，它总是返回一个字符串：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span> <span class="number">123</span>; <span class="comment">// &#x27;number&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="number">123n</span>; <span class="comment">// &#x27;bigint&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="title class_">NaN</span>; <span class="comment">// &#x27;number&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="string">&#x27;str&#x27;</span>; <span class="comment">// &#x27;string&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">true</span>; <span class="comment">// &#x27;boolean&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">undefined</span>; <span class="comment">// &#x27;undefined&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="title class_">Math</span>.<span class="property">abs</span>; <span class="comment">// &#x27;function&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">null</span>; <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> []; <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> &#123;&#125;; <span class="comment">// &#x27;object&#x27;</span></span><br></pre></td></tr></table></figure>
<p>可见，<code>number</code>、<code>bigint</code>、<code>string</code>、<code>boolean</code>、<code>function</code>和<code>undefined</code>有别于其他类型。特别注意<code>null</code>的类型是<code>object</code>，<code>Array</code>的类型也是<code>object</code>，如果我们用<code>typeof</code>将无法区分出<code>null</code>、<code>Array</code>和通常意义上的object——<code>&#123;&#125;</code>。</p>
<h3 id="包装对象">包装对象</h3>
<p>除了这些类型外，JavaScript还提供了包装对象，熟悉Java的小伙伴肯定很清楚<code>int</code>和<code>Integer</code>这种暧昧关系。</p>
<p><code>number</code>、<code>boolean</code>和<code>string</code>都有包装对象。没错，在JavaScript中，字符串也区分<code>string</code>类型和它的包装类型。包装对象用<code>new</code>创建：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> n = <span class="keyword">new</span> <span class="title class_">Number</span>(<span class="number">123</span>); <span class="comment">// 123,生成了新的包装类型</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> <span class="title class_">Boolean</span>(<span class="literal">true</span>); <span class="comment">// true,生成了新的包装类型</span></span><br><span class="line"><span class="keyword">let</span> s = <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&#x27;str&#x27;</span>); <span class="comment">// &#x27;str&#x27;,生成了新的包装类型</span></span><br></pre></td></tr></table></figure>
<p>虽然包装对象看上去和原来的值一模一样，显示出来也是一模一样，但他们的类型已经变为<code>object</code>了！所以，包装对象和原始值用<code>===</code>比较会返回<code>false</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span> <span class="keyword">new</span> <span class="title class_">Number</span>(<span class="number">123</span>); <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Number</span>(<span class="number">123</span>) === <span class="number">123</span>; <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> <span class="keyword">new</span> <span class="title class_">Boolean</span>(<span class="literal">true</span>); <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Boolean</span>(<span class="literal">true</span>) === <span class="literal">true</span>; <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&#x27;str&#x27;</span>); <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&#x27;str&#x27;</span>) === <span class="string">&#x27;str&#x27;</span>; <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>所以<em>闲的蛋疼也不要使用包装对象</em>！尤其是针对<code>string</code>类型！！！</p>
<p>如果我们在使用<code>Number</code>、<code>Boolean</code>和<code>String</code>时，没有写<code>new</code>会发生什么情况？</p>
<p>此时，<code>Number()</code>、<code>Boolean</code>和<code>String()</code>被当做普通函数，把任何类型的数据转换为<code>number</code>、<code>boolean</code>和<code>string</code>类型（注意不是其包装类型）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> n = <span class="title class_">Number</span>(<span class="string">&#x27;123&#x27;</span>); <span class="comment">// 123，相当于parseInt()或parseFloat()</span></span><br><span class="line"><span class="keyword">typeof</span> n; <span class="comment">// &#x27;number&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = <span class="title class_">Boolean</span>(<span class="string">&#x27;true&#x27;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="keyword">typeof</span> b; <span class="comment">// &#x27;boolean&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b2 = <span class="title class_">Boolean</span>(<span class="string">&#x27;false&#x27;</span>); <span class="comment">// true! &#x27;false&#x27;字符串转换结果为true！因为它是非空字符串！</span></span><br><span class="line"><span class="keyword">let</span> b3 = <span class="title class_">Boolean</span>(<span class="string">&#x27;&#x27;</span>); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> s = <span class="title class_">String</span>(<span class="number">123.45</span>); <span class="comment">// &#x27;123.45&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> s; <span class="comment">// &#x27;string&#x27;</span></span><br></pre></td></tr></table></figure>
<p>是不是感觉头大了？这就是JavaScript特有的催眠魅力！</p>
<p>总结一下，有这么几条规则需要遵守：</p>
<ul>
<li>不要使用<code>new Number()</code>、<code>new Boolean()</code>、<code>new String()</code>创建包装对象；</li>
<li>用<code>parseInt()</code>或<code>parseFloat()</code>来转换任意类型到<code>number</code>；</li>
<li>用<code>String()</code>来转换任意类型到<code>string</code>，或者直接调用某个对象的<code>toString()</code>方法；</li>
<li>通常不必把任意类型转换为<code>boolean</code>再判断，因为可以直接写<code>if (myVar) &#123;...&#125;</code>；</li>
<li><code>typeof</code>操作符可以判断出<code>number</code>、<code>boolean</code>、<code>string</code>、<code>function</code>和<code>undefined</code>；</li>
<li>判断<code>Array</code>要使用<code>Array.isArray(arr)</code>；</li>
<li>判断<code>null</code>请使用<code>myVar === null</code>；</li>
<li>判断某个全局变量是否存在用<code>typeof window.myVar === 'undefined'</code>；</li>
<li>函数内部判断某个变量是否存在用<code>typeof myVar === 'undefined'</code>。</li>
</ul>
<p>最后有细心的同学指出，任何对象都有<code>toString()</code>方法吗？<code>null</code>和<code>undefined</code>就没有！确实如此，这两个特殊值要除外，虽然<code>null</code>还伪装成了<code>object</code>类型。</p>
<p>更细心的同学指出，<code>number</code>对象调用<code>toString()</code>报SyntaxError：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">123.</span><span class="title function_">toString</span>(); <span class="comment">// SyntaxError</span></span><br></pre></td></tr></table></figure>
<p>遇到这种情况，要特殊处理一下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">123.</span>.<span class="title function_">toString</span>(); <span class="comment">// &#x27;123&#x27;, 注意是两个点！</span></span><br><span class="line">(<span class="number">123</span>).<span class="title function_">toString</span>(); <span class="comment">// &#x27;123&#x27;</span></span><br></pre></td></tr></table></figure>
<p>不要问为什么，这就是JavaScript代码的乐趣！</p>
<hr>
<hr>
<p>在JavaScript中，<code>Date</code>对象用来表示日期和时间。</p>
<p>要获取系统当前时间，用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">now; <span class="comment">// Wed Jun 24 2015 19:49:22 GMT+0800 (CST)</span></span><br><span class="line">now.<span class="title function_">getFullYear</span>(); <span class="comment">// 2015, 年份</span></span><br><span class="line">now.<span class="title function_">getMonth</span>(); <span class="comment">// 5, 月份，注意月份范围是0~11，5表示六月</span></span><br><span class="line">now.<span class="title function_">getDate</span>(); <span class="comment">// 24, 表示24号</span></span><br><span class="line">now.<span class="title function_">getDay</span>(); <span class="comment">// 3, 表示星期三</span></span><br><span class="line">now.<span class="title function_">getHours</span>(); <span class="comment">// 19, 24小时制</span></span><br><span class="line">now.<span class="title function_">getMinutes</span>(); <span class="comment">// 49, 分钟</span></span><br><span class="line">now.<span class="title function_">getSeconds</span>(); <span class="comment">// 22, 秒</span></span><br><span class="line">now.<span class="title function_">getMilliseconds</span>(); <span class="comment">// 875, 毫秒数</span></span><br><span class="line">now.<span class="title function_">getTime</span>(); <span class="comment">// 1435146562875, 以number形式表示的时间戳</span></span><br></pre></td></tr></table></figure>
<p>注意，当前时间是浏览器从本机操作系统获取的时间，所以不一定准确，因为用户可以把当前时间设定为任何值。</p>
<p>如果要创建一个指定日期和时间的<code>Date</code>对象，可以用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> d = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">2015</span>, <span class="number">5</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">15</span>, <span class="number">30</span>, <span class="number">123</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(d); <span class="comment">// Fri Jun 19 2015 20:15:30 GMT+0800 (CST)</span></span><br></pre></td></tr></table></figure>
<p>你可能观察到了一个<em>非常非常坑爹</em>的地方，就是JavaScript的月份范围用整数表示是0~11，<code>0</code>表示一月，<code>1</code>表示二月……，所以要表示6月，我们传入的是<code>5</code>！这绝对是JavaScript的设计者当时脑抽了一下，但是现在要修复已经不可能了。</p>
<p>特别注意</p>
<p>JavaScript的Date对象月份值从0开始，牢记0=1月，1=2月，2=3月，……，11=12月。</p>
<p>第二种创建一个指定日期和时间的方法是解析一个符合<a target="_blank" rel="noopener" href="https://www.w3.org/TR/NOTE-datetime">ISO 8601</a>格式的字符串：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> d = <span class="title class_">Date</span>.<span class="title function_">parse</span>(<span class="string">&#x27;2015-06-24T19:49:22.875+08:00&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(d); <span class="comment">// 1435146562875</span></span><br></pre></td></tr></table></figure>
<p>但它返回的不是<code>Date</code>对象，而是一个时间戳。不过有时间戳就可以很容易地把它转换为一个<code>Date</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> d = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">1435146562875</span>);</span><br><span class="line">d; <span class="comment">// Wed Jun 24 2015 19:49:22 GMT+0800 (CST)</span></span><br><span class="line">d.<span class="title function_">getMonth</span>(); <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>
<p>注意</p>
<p>使用Date.parse()时传入的字符串使用实际月份01~12，转换为Date对象后getMonth()获取的月份值为0~11。</p>
<h3 id="时区">时区</h3>
<p><code>Date</code>对象表示的时间总是按浏览器所在时区显示的，不过我们既可以显示本地时间，也可以显示调整后的UTC时间：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> d = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">1435146562875</span>);</span><br><span class="line">d.<span class="title function_">toLocaleString</span>(); <span class="comment">// &#x27;2015/6/24 下午7:49:22&#x27;，本地时间（北京时区+8:00），显示的字符串与操作系统设定的格式有关</span></span><br><span class="line">d.<span class="title function_">toUTCString</span>(); <span class="comment">// &#x27;Wed, 24 Jun 2015 11:49:22 GMT&#x27;，UTC时间，与本地时间相差8小时</span></span><br></pre></td></tr></table></figure>
<p>那么在JavaScript中如何进行时区转换呢？实际上，只要我们传递的是一个<code>number</code>类型的时间戳，我们就不用关心时区转换。任何浏览器都可以把一个时间戳正确转换为本地时间。</p>
<p>时间戳是个什么东西？时间戳是一个自增的整数，它表示从1970年1月1日零时整的GMT时区开始的那一刻，到现在的毫秒数。假设浏览器所在电脑的时间是准确的，那么世界上无论哪个时区的电脑，它们此刻产生的时间戳数字都是一样的，所以，时间戳可以精确地表示一个时刻，并且与时区无关。</p>
<p>所以，我们只需要传递时间戳，或者把时间戳从数据库里读出来，再让JavaScript自动转换为当地时间就可以了。</p>
<p>要获取当前时间戳，可以用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 方法1:</span><br><span class="line">console.log(Date.now());</span><br><span class="line"></span><br><span class="line">// 方法2:</span><br><span class="line">console.log(new Date().getTime());</span><br></pre></td></tr></table></figure>
<h3 id="练习">练习</h3>
<p>小明为了和女友庆祝情人节，特意制作了网页，并提前预定了法式餐厅。小明打算用JavaScript给女友一个惊喜留言：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let today = new Date();</span><br><span class="line">if (today.getMonth() === 2 &amp;&amp; today.getDate() === 14) &#123;</span><br><span class="line">    alert(&#x27;亲爱的，我预定了晚餐，晚上6点在餐厅见！&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果女友并未出现。小明非常郁闷，请你帮忙分析他的JavaScript代码有何问题。</p>
<p><img src="https://liaoxuefeng.com/books/javascript/standard-object/date/zgs.jpg" alt="注孤生"></p>
<p>字符串是编程时涉及到的最多的一种数据结构，对字符串进行操作的需求几乎无处不在。比如判断一个字符串是否是合法的Email地址，虽然可以编程提取<code>@</code>前后的子串，再分别判断是否是单词和域名，但这样做不但麻烦，而且代码难以复用。</p>
<p>正则表达式是一种用来匹配字符串的强有力的武器。它的设计思想是用一种描述性的语言来给字符串定义一个规则，凡是符合规则的字符串，我们就认为它“匹配”了，否则，该字符串就是不合法的。</p>
<p>所以我们判断一个字符串是否是合法的Email的方法是：</p>
<ol>
<li>创建一个匹配Email的正则表达式；</li>
<li>用该正则表达式去匹配用户的输入来判断是否合法。</li>
</ol>
<p>因为正则表达式也是用字符串表示的，所以，我们要首先了解如何用字符来描述字符。</p>
<p>在正则表达式中，如果直接给出字符，就是精确匹配。用<code>\d</code>可以匹配一个数字，<code>\w</code>可以匹配一个字母或数字，所以：</p>
<ul>
<li><code>'00\d'</code>可以匹配<code>'007'</code>，但无法匹配<code>'00A'</code>；</li>
<li><code>'\d\d\d'</code>可以匹配<code>'010'</code>；</li>
<li><code>'\w\w'</code>可以匹配<code>'js'</code>；</li>
</ul>
<p><code>.</code>可以匹配任意字符，所以：</p>
<ul>
<li><code>'js.'</code>可以匹配<code>'jsp'</code>、<code>'jss'</code>、<code>'js!'</code>等等。</li>
</ul>
<p>要匹配变长的字符，在正则表达式中，用<code>*</code>表示任意个字符（包括0个），用<code>+</code>表示至少一个字符，用<code>?</code>表示0个或1个字符，用<code>&#123;n&#125;</code>表示n个字符，用<code>&#123;n,m&#125;</code>表示n-m个字符：</p>
<p>来看一个复杂的例子：<code>\d&#123;3&#125;\s+\d&#123;3,8&#125;</code>。</p>
<p>我们来从左到右解读一下：</p>
<ol>
<li><code>\d&#123;3&#125;</code>表示匹配3个数字，例如<code>'010'</code>；</li>
<li><code>\s</code>可以匹配一个空格（也包括Tab等空白符），所以<code>\s+</code>表示至少有一个空格，例如匹配<code>' '</code>，<code>'\t\t'</code>等；</li>
<li><code>\d&#123;3,8&#125;</code>表示3-8个数字，例如<code>'1234567'</code>。</li>
</ol>
<p>综合起来，上面的正则表达式可以匹配以任意个空格隔开的带区号的电话号码。</p>
<p>如果要匹配<code>'010-12345'</code>这样的号码呢？由于<code>'-'</code>是特殊字符，在正则表达式中，要用<code>'\'</code>转义，所以，上面的正则是<code>\d&#123;3&#125;\-\d&#123;3,8&#125;</code>。</p>
<p>但是，仍然无法匹配<code>'010 - 12345'</code>，因为带有空格。所以我们需要更复杂的匹配方式。</p>
<h3 id="进阶">进阶</h3>
<p>要做更精确地匹配，可以用<code>[]</code>表示范围，比如：</p>
<ul>
<li><code>[0-9a-zA-Z\_]</code>可以匹配一个数字、字母或者下划线；</li>
<li><code>[0-9a-zA-Z\_]+</code>可以匹配至少由一个数字、字母或者下划线组成的字符串，比如<code>'a100'</code>，<code>'0_Z'</code>，<code>'js2015'</code>等等；</li>
<li><code>[a-zA-Z\_\$][0-9a-zA-Z\_\$]*</code>可以匹配由字母或下划线、开头，后接任意个由一个数字、字母或者下划线、开头，后接任意个由一个数字、字母或者下划线、组成的字符串，也就是JavaScript允许的变量名；</li>
<li><code>[a-zA-Z\_\$][0-9a-zA-Z\_\$]&#123;0, 19&#125;</code>更精确地限制了变量的长度是1-20个字符（前面1个字符+后面最多19个字符）。</li>
</ul>
<p><code>A|B</code>可以匹配A或B，所以<code>(J|j)ava(S|s)cript</code>可以匹配<code>'JavaScript'</code>、<code>'Javascript'</code>、<code>'javaScript'</code>或者<code>'javascript'</code>。</p>
<p><code>^</code>表示行的开头，<code>^\d</code>表示必须以数字开头。</p>
<p><code>$</code>表示行的结束，<code>\d$</code>表示必须以数字结束。</p>
<p>你可能注意到了，<code>js</code>也可以匹配<code>'jsp'</code>，但是加上<code>^js$</code>就变成了整行匹配，就只能匹配<code>'js'</code>了。</p>
<h3 id="RegExp">RegExp</h3>
<p>有了准备知识，我们就可以在JavaScript中使用正则表达式了。</p>
<p>JavaScript有两种方式创建一个正则表达式：</p>
<p>第一种方式是直接通过<code>/正则表达式/</code>写出来，第二种方式是通过<code>new RegExp('正则表达式')</code>创建一个RegExp对象。</p>
<p>两种写法是一样的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> re1 = <span class="regexp">/ABC\-001/</span>;</span><br><span class="line"><span class="keyword">let</span> re2 = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&#x27;ABC\\-001&#x27;</span>);</span><br><span class="line"></span><br><span class="line">re1; <span class="comment">// /ABC\-001/</span></span><br><span class="line">re2; <span class="comment">// /ABC\-001/</span></span><br></pre></td></tr></table></figure>
<p>注意，如果使用第二种写法，因为字符串的转义问题，字符串的两个<code>\\</code>实际上是一个<code>\</code>。</p>
<p>先看看如何判断正则表达式是否匹配：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> re = <span class="regexp">/^\d&#123;3&#125;\-\d&#123;3,8&#125;$/</span>;</span><br><span class="line">re.<span class="title function_">test</span>(<span class="string">&#x27;010-12345&#x27;</span>); <span class="comment">// true</span></span><br><span class="line">re.<span class="title function_">test</span>(<span class="string">&#x27;010-1234x&#x27;</span>); <span class="comment">// false</span></span><br><span class="line">re.<span class="title function_">test</span>(<span class="string">&#x27;010 12345&#x27;</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>RegExp对象的<code>test()</code>方法用于测试给定的字符串是否符合条件。</p>
<h3 id="切分字符串">切分字符串</h3>
<p>用正则表达式切分字符串比用固定的字符更灵活，请看正常的切分代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;a b   c&#x27;</span>.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>); <span class="comment">// [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;c&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>嗯，无法识别连续的空格，用正则表达式试试：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;a b   c&#x27;</span>.<span class="title function_">split</span>(<span class="regexp">/\s+/</span>); <span class="comment">// [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>无论多少个空格都可以正常分割。加入<code>,</code>试试：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;a,b, c  d&#x27;</span>.<span class="title function_">split</span>(<span class="regexp">/[\s\,]+/</span>); <span class="comment">// [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>再加入<code>;</code>试试：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;a,b;; c  d&#x27;</span>.<span class="title function_">split</span>(<span class="regexp">/[\s\,\;]+/</span>); <span class="comment">// [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>如果用户输入了一组标签，下次记得用正则表达式来把不规范的输入转化成正确的数组。</p>
<h3 id="分组">分组</h3>
<p>除了简单地判断是否匹配之外，正则表达式还有提取子串的强大功能。用<code>()</code>表示的就是要提取的分组（Group）。比如：</p>
<p><code>^(\d&#123;3&#125;)-(\d&#123;3,8&#125;)$</code>分别定义了两个组，可以直接从匹配的字符串中提取出区号和本地号码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> re = <span class="regexp">/^(\d&#123;3&#125;)-(\d&#123;3,8&#125;)$/</span>;</span><br><span class="line">re.<span class="title function_">exec</span>(<span class="string">&#x27;010-12345&#x27;</span>); <span class="comment">// [&#x27;010-12345&#x27;, &#x27;010&#x27;, &#x27;12345&#x27;]</span></span><br><span class="line">re.<span class="title function_">exec</span>(<span class="string">&#x27;010 12345&#x27;</span>); <span class="comment">// null</span></span><br></pre></td></tr></table></figure>
<p>如果正则表达式中定义了组，就可以在<code>RegExp</code>对象上用<code>exec()</code>方法提取出子串来。</p>
<p><code>exec()</code>方法在匹配成功后，会返回一个<code>Array</code>，第一个元素是正则表达式匹配到的整个字符串，后面的字符串表示匹配成功的子串。</p>
<p><code>exec()</code>方法在匹配失败时返回<code>null</code>。</p>
<p>提取子串非常有用。来看一个更凶残的例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> re = <span class="regexp">/^(0[0-9]|1[0-9]|2[0-3]|[0-9])\:(0[0-9]|1[0-9]|2[0-9]|3[0-9]|4[0-9]|5[0-9]|[0-9])\:(0[0-9]|1[0-9]|2[0-9]|3[0-9]|4[0-9]|5[0-9]|[0-9])$/</span>;</span><br><span class="line">re.<span class="title function_">exec</span>(<span class="string">&#x27;19:05:30&#x27;</span>); <span class="comment">// [&#x27;19:05:30&#x27;, &#x27;19&#x27;, &#x27;05&#x27;, &#x27;30&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>这个正则表达式可以直接识别合法的时间。但是有些时候，用正则表达式也无法做到完全验证，比如识别日期：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> re = <span class="regexp">/^(0[1-9]|1[0-2]|[0-9])-(0[1-9]|1[0-9]|2[0-9]|3[0-1]|[0-9])$/</span>;</span><br></pre></td></tr></table></figure>
<p>对于<code>'2-30'</code>，<code>'4-31'</code>这样的非法日期，用正则还是识别不了，或者说写出来非常困难，这时就需要程序配合识别了。</p>
<h3 id="贪婪匹配">贪婪匹配</h3>
<p>需要特别指出的是，正则匹配默认是贪婪匹配，也就是匹配尽可能多的字符。举例如下，匹配出数字后面的<code>0</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> re = <span class="regexp">/^(\d+)(0*)$/</span>;</span><br><span class="line">re.<span class="title function_">exec</span>(<span class="string">&#x27;102300&#x27;</span>); <span class="comment">// [&#x27;102300&#x27;, &#x27;102300&#x27;, &#x27;&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>由于<code>\d+</code>采用贪婪匹配，直接把后面的<code>0</code>全部匹配了，结果<code>0*</code>只能匹配空字符串了。</p>
<p>必须让<code>\d+</code>采用非贪婪匹配（也就是尽可能少匹配），才能把后面的<code>0</code>匹配出来，加个<code>?</code>就可以让<code>\d+</code>采用非贪婪匹配：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> re = <span class="regexp">/^(\d+?)(0*)$/</span>;</span><br><span class="line">re.<span class="title function_">exec</span>(<span class="string">&#x27;102300&#x27;</span>); <span class="comment">// [&#x27;102300&#x27;, &#x27;1023&#x27;, &#x27;00&#x27;]</span></span><br></pre></td></tr></table></figure>
<h3 id="全局搜索">全局搜索</h3>
<p>JavaScript的正则表达式还有几个特殊的标志，最常用的是<code>g</code>，表示全局匹配：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> r1 = <span class="regexp">/test/g</span>;</span><br><span class="line"><span class="comment">// 等价于:</span></span><br><span class="line"><span class="keyword">let</span> r2 = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;g&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>全局匹配可以多次执行<code>exec()</code>方法来搜索一个匹配的字符串。当我们指定<code>g</code>标志后，每次运行<code>exec()</code>，正则表达式本身会更新<code>lastIndex</code>属性，表示上次匹配到的最后索引：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">&#x27;JavaScript, VBScript, JScript and ECMAScript&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> re=<span class="regexp">/[a-zA-Z]+Script/g</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用全局匹配:</span></span><br><span class="line">re.<span class="title function_">exec</span>(s); <span class="comment">// [&#x27;JavaScript&#x27;]</span></span><br><span class="line">re.<span class="property">lastIndex</span>; <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line">re.<span class="title function_">exec</span>(s); <span class="comment">// [&#x27;VBScript&#x27;]</span></span><br><span class="line">re.<span class="property">lastIndex</span>; <span class="comment">// 20</span></span><br><span class="line"></span><br><span class="line">re.<span class="title function_">exec</span>(s); <span class="comment">// [&#x27;JScript&#x27;]</span></span><br><span class="line">re.<span class="property">lastIndex</span>; <span class="comment">// 29</span></span><br><span class="line"></span><br><span class="line">re.<span class="title function_">exec</span>(s); <span class="comment">// [&#x27;ECMAScript&#x27;]</span></span><br><span class="line">re.<span class="property">lastIndex</span>; <span class="comment">// 44</span></span><br><span class="line"></span><br><span class="line">re.<span class="title function_">exec</span>(s); <span class="comment">// null，直到结束仍没有匹配到</span></span><br></pre></td></tr></table></figure>
<p>全局匹配类似搜索，因此不能使用<code>/^...$/</code>，那样只会最多匹配一次。</p>
<p>正则表达式还可以指定<code>i</code>标志，表示忽略大小写，<code>m</code>标志，表示执行多行匹配。</p>
<h3 id="小结">小结</h3>
<p>正则表达式非常强大，要在短短的一节里讲完是不可能的。要讲清楚正则的所有内容，可以写一本厚厚的书了。如果你经常遇到正则表达式的问题，你可能需要一本正则表达式的参考书。</p>
<h3 id="练习-2">练习</h3>
<p>请尝试写一个验证Email地址的正则表达式。版本一应该可以验证出类似的Email：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">let re = /^$/;</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">let</span><br><span class="line">    i,</span><br><span class="line">    success = true,</span><br><span class="line">    should_pass = [&#x27;someone@gmail.com&#x27;, &#x27;bill.gates@microsoft.com&#x27;, &#x27;tom@voyager.org&#x27;, &#x27;bob2015@163.com&#x27;],</span><br><span class="line">    should_fail = [&#x27;test#gmail.com&#x27;, &#x27;bill@microsoft&#x27;, &#x27;bill%gates@ms.com&#x27;, &#x27;@voyager.org&#x27;];</span><br><span class="line">for (i = 0; i &lt; should_pass.length; i++) &#123;</span><br><span class="line">    if (!re.test(should_pass[i])) &#123;</span><br><span class="line">        console.log(&#x27;测试失败: &#x27; + should_pass[i]);</span><br><span class="line">        success = false;</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">for (i = 0; i &lt; should_fail.length; i++) &#123;</span><br><span class="line">    if (re.test(should_fail[i])) &#123;</span><br><span class="line">        console.log(&#x27;测试失败: &#x27; + should_fail[i]);</span><br><span class="line">        success = false;</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if (success) &#123;</span><br><span class="line">    console.log(&#x27;测试通过!&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>版本二可以验证并提取出带名字的Email地址：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">let re = /^$/;</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">let r = re.exec(&#x27;&lt;Tom Paris&gt; tom@voyager.org&#x27;);</span><br><span class="line">if (r === null || r.toString() !== [&#x27;&lt;Tom Paris&gt; tom@voyager.org&#x27;, &#x27;Tom Paris&#x27;, &#x27;tom@voyager.org&#x27;].toString()) &#123;</span><br><span class="line">    console.log(&#x27;测试失败!&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">    console.log(&#x27;测试成功!&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JSON是JavaScript Object Notation的缩写，它是一种数据交换格式。</p>
<p>在JSON出现之前，大家一直用XML来传递数据。因为XML是一种纯文本格式，所以它适合在网络上交换数据。XML本身不算复杂，但是，加上DTD、XSD、XPath、XSLT等一大堆复杂的规范以后，任何正常的软件开发人员碰到XML都会感觉头大了，最后大家发现，即使你努力钻研几个月，也未必搞得清楚XML的规范。</p>
<p>终于，在2002年的一天，道格拉斯·克罗克福特（Douglas Crockford）同学为了拯救深陷水深火热同时又被某几个巨型软件企业长期愚弄的软件工程师，发明了JSON这种超轻量级的数据交换格式。</p>
<p>道格拉斯同学长期担任雅虎的高级架构师，自然钟情于JavaScript。他设计的JSON实际上是JavaScript的一个子集。在JSON中，一共就这么几种数据类型：</p>
<ul>
<li>number：和JavaScript的<code>number</code>完全一致；</li>
<li>boolean：就是JavaScript的<code>true</code>或<code>false</code>；</li>
<li>string：就是JavaScript的<code>string</code>；</li>
<li>null：就是JavaScript的<code>null</code>；</li>
<li>array：就是JavaScript的<code>Array</code>表示方式——<code>[]</code>；</li>
<li>object：就是JavaScript的<code>&#123; ... &#125;</code>表示方式。</li>
</ul>
<p>以及上面的任意组合。</p>
<p>并且，JSON还定死了字符集必须是UTF-8，表示多语言就没有问题了。为了统一解析，JSON的字符串规定必须用双引号<code>&quot;&quot;</code>，Object的键也必须用双引号<code>&quot;&quot;</code>。</p>
<p>由于JSON非常简单，很快就风靡Web世界，并且成为ECMA标准。几乎所有编程语言都有解析JSON的库，而在JavaScript中，我们可以直接使用JSON，因为JavaScript内置了JSON的解析。</p>
<p>把任何JavaScript对象变成JSON，就是把这个对象序列化成一个JSON格式的字符串，这样才能够通过网络传递给其他计算机。</p>
<p>如果我们收到一个JSON格式的字符串，只需要把它反序列化成一个JavaScript对象，就可以在JavaScript中直接使用这个对象了。</p>
<h3 id="序列化">序列化</h3>
<p>让我们先把小明这个对象序列化成JSON格式的字符串：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">let xiaoming = &#123;</span><br><span class="line">    name: &#x27;小明&#x27;,</span><br><span class="line">    age: 14,</span><br><span class="line">    gender: true,</span><br><span class="line">    height: 1.65,</span><br><span class="line">    grade: null,</span><br><span class="line">    &#x27;middle-school&#x27;: &#x27;\&quot;W3C\&quot; Middle School&#x27;,</span><br><span class="line">    skills: [&#x27;JavaScript&#x27;, &#x27;Java&#x27;, &#x27;Python&#x27;, &#x27;Lisp&#x27;]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let s = JSON.stringify(xiaoming);</span><br><span class="line">console.log(s);</span><br></pre></td></tr></table></figure>
<p>要输出得好看一些，可以加上参数，按缩进输出：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>(xiaoming, <span class="literal">null</span>, <span class="string">&#x27;  &#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小明&quot;</span>,</span><br><span class="line">  <span class="string">&quot;age&quot;</span>: <span class="number">14</span>,</span><br><span class="line">  <span class="string">&quot;gender&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;height&quot;</span>: <span class="number">1.65</span>,</span><br><span class="line">  <span class="string">&quot;grade&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;middle-school&quot;</span>: <span class="string">&quot;\&quot;W3C\&quot; Middle School&quot;</span>,</span><br><span class="line">  <span class="string">&quot;skills&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;JavaScript&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Java&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Python&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Lisp&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二个参数用于控制如何筛选对象的键值，如果我们只想输出指定的属性，可以传入<code>Array</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>(xiaoming, [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;skills&#x27;</span>], <span class="string">&#x27;  &#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小明&quot;</span>,</span><br><span class="line">  <span class="string">&quot;skills&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;JavaScript&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Java&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Python&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Lisp&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还可以传入一个函数，这样对象的每个键值对都会被函数先处理：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">convert</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> value.<span class="title function_">toUpperCase</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>(xiaoming, convert, <span class="string">&#x27;  &#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>上面的代码把所有属性值都变成大写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小明&quot;</span>,</span><br><span class="line">  <span class="string">&quot;age&quot;</span>: <span class="number">14</span>,</span><br><span class="line">  <span class="string">&quot;gender&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;height&quot;</span>: <span class="number">1.65</span>,</span><br><span class="line">  <span class="string">&quot;grade&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;middle-school&quot;</span>: <span class="string">&quot;\&quot;W3C\&quot; MIDDLE SCHOOL&quot;</span>,</span><br><span class="line">  <span class="string">&quot;skills&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;JAVASCRIPT&quot;</span>,</span><br><span class="line">    <span class="string">&quot;JAVA&quot;</span>,</span><br><span class="line">    <span class="string">&quot;PYTHON&quot;</span>,</span><br><span class="line">    <span class="string">&quot;LISP&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果我们还想要精确控制如何序列化小明，可以给<code>xiaoming</code>定义一个<code>toJSON()</code>的方法，直接返回JSON应该序列化的数据：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">14</span>,</span><br><span class="line">    <span class="attr">gender</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">1.65</span>,</span><br><span class="line">    <span class="attr">grade</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">&#x27;middle-school&#x27;</span>: <span class="string">&#x27;\&quot;W3C\&quot; Middle School&#x27;</span>,</span><br><span class="line">    <span class="attr">skills</span>: [<span class="string">&#x27;JavaScript&#x27;</span>, <span class="string">&#x27;Java&#x27;</span>, <span class="string">&#x27;Python&#x27;</span>, <span class="string">&#x27;Lisp&#x27;</span>],</span><br><span class="line">    <span class="attr">toJSON</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="comment">// 只输出name和age，并且改变了key：</span></span><br><span class="line">            <span class="string">&#x27;Name&#x27;</span>: <span class="variable language_">this</span>.<span class="property">name</span>,</span><br><span class="line">            <span class="string">&#x27;Age&#x27;</span>: <span class="variable language_">this</span>.<span class="property">age</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>(xiaoming); <span class="comment">// &#x27;&#123;&quot;Name&quot;:&quot;小明&quot;,&quot;Age&quot;:14&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="反序列化">反序列化</h3>
<p>拿到一个JSON格式的字符串，我们直接用<code>JSON.parse()</code>把它变成一个JavaScript对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="string">&#x27;[1,2,3,true]&#x27;</span>); <span class="comment">// [1, 2, 3, true]</span></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="string">&#x27;&#123;&quot;name&quot;:&quot;小明&quot;,&quot;age&quot;:14&#125;&#x27;</span>); <span class="comment">// Object &#123;name: &#x27;小明&#x27;, age: 14&#125;</span></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="string">&#x27;true&#x27;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="string">&#x27;123.45&#x27;</span>); <span class="comment">// 123.45</span></span><br></pre></td></tr></table></figure>
<p><code>JSON.parse()</code>还可以接收一个函数，用来转换解析出的属性：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let obj = JSON.parse(&#x27;&#123;&quot;name&quot;:&quot;小明&quot;,&quot;age&quot;:14&#125;&#x27;, function (key, value) &#123;</span><br><span class="line">    if (key === &#x27;name&#x27;) &#123;</span><br><span class="line">        return value + &#x27;同学&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    return value;</span><br><span class="line">&#125;);</span><br><span class="line">console.log(JSON.stringify(obj)); // &#123;name: &#x27;小明同学&#x27;, age: 14&#125;</span><br></pre></td></tr></table></figure>
<p>在JavaScript中使用JSON，就是这么简单！</p>
<h3 id="练习-3">练习</h3>
<p>用浏览器访问OpenWeatherMap的<a target="_blank" rel="noopener" href="https://api.openweathermap.org/data/2.5/forecast?q=Beijing,cn&amp;appid=800f49846586c3ba6e7052cfc89af16c">天气API</a>，查看返回的JSON数据，然后返回城市、天气预报等信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">let url = &#x27;https://api.openweathermap.org/data/2.5/forecast?q=Beijing,cn&amp;appid=800f49846586c3ba6e7052cfc89af16c&#x27;;</span><br><span class="line">fetch(url).then(resp =&gt; &#123;</span><br><span class="line">    resp.json().then(data =&gt; &#123;</span><br><span class="line">        let info = &#123;</span><br><span class="line">            city: data.city.name,</span><br><span class="line">            weather: data.list[0].weather[0].main,</span><br><span class="line">            time: data.list[0].dt_txt</span><br><span class="line">        &#125;;</span><br><span class="line">        alert(JSON.stringify(info, null, &#x27;  &#x27;));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../../2024/01/12/JavaScript/JavaScript-%E6%A0%87%E5%87%86%E5%AF%B9%E8%B1%A1/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../../2024/01/11/JavaScript/JavaScript-%E5%87%BD%E6%95%B0/"
                            aria-label=": JavaScript-函数"
                        >
                            JavaScript-函数
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2024-01-11T21:05:28+08:00">
	
		    2024 年 1 月 11 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../../categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a>, <a class="category-link" href="../../../categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/JavaScript/">JavaScript</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="函数">函数</h2>
<p>我们知道圆的面积计算公式为：</p>
<p>当我们知道半径<code>r</code>的值时，就可以根据公式计算出面积。假设我们需要计算3个不同大小的圆的面积：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> r1 = <span class="number">12.34</span>;</span><br><span class="line"><span class="keyword">let</span> r2 = <span class="number">9.08</span>;</span><br><span class="line"><span class="keyword">let</span> r3 = <span class="number">73.1</span>;</span><br><span class="line"><span class="keyword">let</span> s1 = <span class="number">3.14</span> * r1 * r1;</span><br><span class="line"><span class="keyword">let</span> s2 = <span class="number">3.14</span> * r2 * r2;</span><br><span class="line"><span class="keyword">let</span> s3 = <span class="number">3.14</span> * r3 * r3;</span><br></pre></td></tr></table></figure>
<p>当代码出现有规律的重复的时候，你就需要当心了，每次写<code>3.14 * x * x</code>不仅很麻烦，而且，如果要把<code>3.14</code>改成<code>3.1416</code>的时候，得全部替换。</p>
<p>有了函数，我们就不再每次写<code>s = 3.14 * x * x</code>，而是写成更有意义的函数调用<code>s = area_of_circle(x)</code>，而函数<code>area_of_circle</code>本身只需要写一次，就可以多次调用。</p>
<p>基本上所有的高级语言都支持函数，JavaScript也不例外。JavaScript的函数不但是“头等公民”，而且可以像变量一样使用，具有非常强大的抽象能力。</p>
<h3 id="抽象">抽象</h3>
<p>抽象是数学中非常常见的概念。举个例子：</p>
<p>计算数列的和，比如：<code>1 + 2 + 3 + ... + 100</code>，写起来十分不方便，于是数学家发明了求和符号∑，可以把<code>1 + 2 + 3 + ... + 100</code>记作：</p>
<p>这种抽象记法非常强大，因为我们看到 ∑ 就可以理解成求和，而不是还原成低级的加法运算。</p>
<p>而且，这种抽象记法是可扩展的，比如：</p>
<p>还原成加法运算就变成了：</p>
<p>可见，借助抽象，我们才能不关心底层的具体计算过程，而直接在更高的层次上思考问题。</p>
<p>写计算机程序也是一样，函数就是最基本的一种代码抽象的方式。</p>
<hr>
<hr>
<h3 id="定义函数">定义函数</h3>
<p>在JavaScript中，定义函数的方式如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">abs</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (x &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述<code>abs()</code>函数的定义如下：</p>
<ul>
<li><code>function</code>指出这是一个函数定义；</li>
<li><code>abs</code>是函数的名称；</li>
<li><code>(x)</code>括号内列出函数的参数，多个参数以<code>,</code>分隔；</li>
<li><code>&#123; ... &#125;</code>之间的代码是函数体，可以包含若干语句，甚至可以没有任何语句。</li>
</ul>
<p>请注意，函数体内部的语句在执行时，一旦执行到<code>return</code>时，函数就执行完毕，并将结果返回。因此，函数内部通过条件判断和循环可以实现非常复杂的逻辑。</p>
<p>如果没有<code>return</code>语句，函数执行完毕后也会返回结果，只是结果为<code>undefined</code>。</p>
<p>由于JavaScript的函数也是一个对象，上述定义的<code>abs()</code>函数实际上是一个函数对象，而函数名<code>abs</code>可以视为指向该函数的变量。</p>
<p>因此，第二种定义函数的方式如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> abs = <span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (x &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在这种方式下，<code>function (x) &#123; ... &#125;</code>是一个匿名函数，它没有函数名。但是，这个匿名函数赋值给了变量<code>abs</code>，所以，通过变量<code>abs</code>就可以调用该函数。</p>
<p>上述两种定义<em>完全等价</em>，注意第二种方式按照完整语法需要在函数体末尾加一个<code>;</code>，表示赋值语句结束。</p>
<h3 id="调用函数">调用函数</h3>
<p>调用函数时，按顺序传入参数即可：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">abs</span>(<span class="number">10</span>); <span class="comment">// 返回10</span></span><br><span class="line"><span class="title function_">abs</span>(-<span class="number">9</span>); <span class="comment">// 返回9</span></span><br></pre></td></tr></table></figure>
<p>由于JavaScript允许传入任意个参数而不影响调用，因此传入的参数比定义的参数多也没有问题，虽然函数内部并不需要这些参数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">abs</span>(<span class="number">10</span>, <span class="string">&#x27;blablabla&#x27;</span>); <span class="comment">// 返回10</span></span><br><span class="line"><span class="title function_">abs</span>(-<span class="number">9</span>, <span class="string">&#x27;haha&#x27;</span>, <span class="string">&#x27;hehe&#x27;</span>, <span class="literal">null</span>); <span class="comment">// 返回9</span></span><br></pre></td></tr></table></figure>
<p>传入的参数比定义的少也没有问题：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">abs</span>(); <span class="comment">// 返回NaN</span></span><br></pre></td></tr></table></figure>
<p>此时<code>abs(x)</code>函数的参数<code>x</code>将收到<code>undefined</code>，计算结果为<code>NaN</code>。</p>
<p>要避免收到<code>undefined</code>，可以对参数进行检查：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">abs</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> x !== <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="string">&#x27;Not a number&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (x &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="arguments">arguments</h3>
<p>JavaScript还有一个免费赠送的关键字<code>arguments</code>，它只在函数内部起作用，并且永远指向当前函数的调用者传入的所有参数。<code>arguments</code>类似<code>Array</code>但它不是一个<code>Array</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function foo(x) &#123;</span><br><span class="line">    console.log(&#x27;x = &#x27; + x); // 10</span><br><span class="line">    for (let i=0; i&lt;arguments.length; i++) &#123;</span><br><span class="line">        console.log(&#x27;arg &#x27; + i + &#x27; = &#x27; + arguments[i]); // 10, 20, 30</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">foo(10, 20, 30);</span><br></pre></td></tr></table></figure>
<p>利用<code>arguments</code>，你可以获得调用者传入的所有参数。也就是说，即使函数不定义任何参数，还是可以拿到参数的值：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">abs</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> x = <span class="variable language_">arguments</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">return</span> x &gt;= <span class="number">0</span> ? x : -x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">abs</span>(); <span class="comment">// 0</span></span><br><span class="line"><span class="title function_">abs</span>(<span class="number">10</span>); <span class="comment">// 10</span></span><br><span class="line"><span class="title function_">abs</span>(-<span class="number">9</span>); <span class="comment">// 9</span></span><br></pre></td></tr></table></figure>
<p>实际上<code>arguments</code>最常用于判断传入参数的个数。你可能会看到这样的写法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// foo(a[, b], c)</span></span><br><span class="line"><span class="comment">// 接收2~3个参数，b是可选参数，如果只传2个参数，b默认为null：</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">a, b, c</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="comment">// 实际拿到的参数是a和b，c为undefined</span></span><br><span class="line">        c = b; <span class="comment">// 把b赋给c</span></span><br><span class="line">        b = <span class="literal">null</span>; <span class="comment">// b变为默认值</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>要把中间的参数<code>b</code>变为“可选”参数，就只能通过<code>arguments</code>判断，然后重新调整参数并赋值。</p>
<h3 id="rest参数">rest参数</h3>
<p>由于JavaScript函数允许接收任意个参数，于是我们就不得不用<code>arguments</code>来获取所有参数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> i, rest = [];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> &gt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">2</span>; i&lt;<span class="variable language_">arguments</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            rest.<span class="title function_">push</span>(<span class="variable language_">arguments</span>[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;a = &#x27;</span> + a);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;b = &#x27;</span> + b);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(rest);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了获取除了已定义参数<code>a</code>、<code>b</code>之外的参数，我们不得不用<code>arguments</code>，并且循环要从索引<code>2</code>开始以便排除前两个参数，这种写法很别扭，只是为了获得额外的<code>rest</code>参数，有没有更好的方法？</p>
<p>ES6标准引入了rest参数，上面的函数可以改写为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">a, b, ...rest</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;a = &#x27;</span> + a);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;b = &#x27;</span> + b);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(rest);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line"><span class="comment">// 结果:</span></span><br><span class="line"><span class="comment">// a = 1</span></span><br><span class="line"><span class="comment">// b = 2</span></span><br><span class="line"><span class="comment">// Array [ 3, 4, 5 ]</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(<span class="number">1</span>);</span><br><span class="line"><span class="comment">// 结果:</span></span><br><span class="line"><span class="comment">// a = 1</span></span><br><span class="line"><span class="comment">// b = undefined</span></span><br><span class="line"><span class="comment">// Array []</span></span><br></pre></td></tr></table></figure>
<p>rest参数只能写在最后，前面用<code>...</code>标识，从运行结果可知，传入的参数先绑定<code>a</code>、<code>b</code>，多余的参数以数组形式交给变量<code>rest</code>，所以，不再需要<code>arguments</code>我们就获取了全部参数。</p>
<p>如果传入的参数连正常定义的参数都没填满，也不要紧，rest参数会接收一个空数组（注意不是<code>undefined</code>）。</p>
<p>因为rest参数是ES6新标准，所以你需要测试一下浏览器是否支持。请用rest参数编写一个<code>sum()</code>函数，接收任意个参数并返回它们的和：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function sum(...rest) &#123;</span><br><span class="line">   ???</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">let i, args = [];</span><br><span class="line">for (i=1; i&lt;=100; i++) &#123;</span><br><span class="line">    args.push(i);</span><br><span class="line">&#125;</span><br><span class="line">if (sum() !== 0) &#123;</span><br><span class="line">    console.log(&#x27;测试失败: sum() = &#x27; + sum());</span><br><span class="line">&#125; else if (sum(1) !== 1) &#123;</span><br><span class="line">    console.log(&#x27;测试失败: sum(1) = &#x27; + sum(1));</span><br><span class="line">&#125; else if (sum(2, 3) !== 5) &#123;</span><br><span class="line">    console.log(&#x27;测试失败: sum(2, 3) = &#x27; + sum(2, 3));</span><br><span class="line">&#125; else if (sum.apply(null, args) !== 5050) &#123;</span><br><span class="line">    console.log(&#x27;测试失败: sum(1, 2, 3, ..., 100) = &#x27; + sum.apply(null, args));</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    console.log(&#x27;测试通过!&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="小心你的return语句">小心你的return语句</h3>
<p>前面我们讲到了JavaScript引擎有一个在行末自动添加分号的机制，这可能让你栽到return语句的一个大坑：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">name</span>: <span class="string">&#x27;foo&#x27;</span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(); <span class="comment">// &#123; name: &#x27;foo&#x27; &#125;</span></span><br></pre></td></tr></table></figure>
<p>如果把return语句拆成两行：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">        &#123; <span class="attr">name</span>: <span class="string">&#x27;foo&#x27;</span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<p><em>要小心了</em>，由于JavaScript引擎在行末自动添加分号的机制，上面的代码实际上变成了：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>; <span class="comment">// 自动添加了分号，相当于return undefined;</span></span><br><span class="line">        &#123; <span class="attr">name</span>: <span class="string">&#x27;foo&#x27;</span> &#125;; <span class="comment">// 这行语句已经没法执行到了</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以正确的多行写法是：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="comment">// 这里不会自动加分号，因为&#123;表示语句尚未结束</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;foo&#x27;</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="练习">练习</h3>
<p>定义一个计算圆面积的函数<code>area_of_circle()</code>，它有两个参数：</p>
<ul>
<li>r: 表示圆的半径；</li>
<li>pi: 表示π的值，如果不传，则默认3.14</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function area_of_circle(r, pi) &#123;</span><br><span class="line">    // FIXME:</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line">// 测试:</span><br><span class="line">if (area_of_circle(2) === 12.56 &amp;&amp; area_of_circle(2, 3.1416) === 12.5664) &#123;</span><br><span class="line">    console.log(&#x27;测试通过&#x27;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    console.log(&#x27;测试失败&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>小明是一个JavaScript新手，他写了一个<code>max()</code>函数，返回两个数中较大的那个：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function max(a, b) &#123;</span><br><span class="line">    if (a &gt; b) &#123;</span><br><span class="line">        return</span><br><span class="line">                a;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return</span><br><span class="line">                b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">console.log(max(15, 20));</span><br></pre></td></tr></table></figure>
<p>但是小明抱怨他的浏览器出问题了，无论传入什么数，<code>max()</code>函数总是返回<code>undefined</code>。请帮他指出问题并修复。</p>
<p>在JavaScript中，用<code>var</code>申明的变量实际上是有作用域的。</p>
<p>如果一个变量在函数体内部申明，则该变量的作用域为整个函数体，在函数体外不可引用该变量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line">    x = x + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">x = x + <span class="number">2</span>; <span class="comment">// ReferenceError! 无法在函数体外引用变量x</span></span><br></pre></td></tr></table></figure>
<p>如果两个不同的函数各自申明了同一个变量，那么该变量只在各自的函数体内起作用。换句话说，不同函数内部的同名变量互相独立，互不影响：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line">    x = x + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">    x = x + <span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于JavaScript的函数可以嵌套，此时，内部函数可以访问外部函数定义的变量，反过来则不行：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> y = x + <span class="number">1</span>; <span class="comment">// bar可以访问foo的变量x!</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> z = y + <span class="number">1</span>; <span class="comment">// ReferenceError! foo不可以访问bar的变量y!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果内部函数和外部函数的变量名重名怎么办？来测试一下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function foo() &#123;</span><br><span class="line">    var x = 1;</span><br><span class="line">    function bar() &#123;</span><br><span class="line">        var x = &#x27;A&#x27;;</span><br><span class="line">        console.log(&#x27;x in bar() = &#x27; + x); // &#x27;A&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(&#x27;x in foo() = &#x27; + x); // 1</span><br><span class="line">    bar();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo();</span><br></pre></td></tr></table></figure>
<p>这说明JavaScript的函数在查找变量时从自身函数定义开始，从“内”向“外”查找。如果内部函数定义了与外部函数重名的变量，则内部函数的变量将“屏蔽”外部函数的变量。</p>
<h3 id="变量提升">变量提升</h3>
<p>JavaScript的函数定义有个特点，它会先扫描整个函数体的语句，把所有用<code>var</code>申明的变量“提升”到函数顶部：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="string">&#x27;Hello, &#x27;</span> + y;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span><br><span class="line">    <span class="keyword">var</span> y = <span class="string">&#x27;Bob&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>();</span><br></pre></td></tr></table></figure>
<p>虽然是strict模式，但语句<code>var x = 'Hello, ' + y;</code>并不报错，原因是变量<code>y</code>在稍后申明了。但是<code>console.log</code>显示<code>Hello, undefined</code>，说明变量<code>y</code>的值为<code>undefined</code>。这正是因为JavaScript引擎自动提升了变量<code>y</code>的声明，但不会提升变量<code>y</code>的赋值。</p>
<p>对于上述<code>foo()</code>函数，JavaScript引擎看到的代码相当于：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> y; <span class="comment">// 提升变量y的申明，此时y为undefined</span></span><br><span class="line">    <span class="keyword">var</span> x = <span class="string">&#x27;Hello, &#x27;</span> + y;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span><br><span class="line">    y = <span class="string">&#x27;Bob&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于JavaScript的这一怪异的“特性”，我们在函数内部定义变量时，请严格遵守“在函数内部首先申明所有变量”这一规则。最常见的做法是用一个<code>var</code>申明函数内部用到的所有变量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span></span><br><span class="line">        x = <span class="number">1</span>, <span class="comment">// x初始化为1</span></span><br><span class="line">        y = x + <span class="number">1</span>, <span class="comment">// y初始化为2</span></span><br><span class="line">        z, i; <span class="comment">// z和i为undefined</span></span><br><span class="line">    <span class="comment">// 其他语句:</span></span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果不需要兼容低版本浏览器，完全可以用<code>let</code>代替<code>var</code>来申明变量。</p>
<p>注意</p>
<p>建议使用let申明变量，避免var申明变量时带来的隐患。</p>
<h3 id="全局作用域">全局作用域</h3>
<p>不在任何函数内定义的变量就具有全局作用域。实际上，JavaScript默认有一个全局对象<code>window</code>，全局作用域的变量实际上被绑定到<code>window</code>的一个属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> course = <span class="string">&#x27;Learn JavaScript&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(course); <span class="comment">// &#x27;Learn JavaScript&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">course</span>); <span class="comment">// &#x27;Learn JavaScript&#x27;</span></span><br></pre></td></tr></table></figure>
<p>因此，直接访问全局变量<code>course</code>和访问<code>window.course</code>是完全一样的。</p>
<p>你可能猜到了，由于函数定义有两种方式，以变量方式<code>var foo = function () &#123;&#125;</code>定义的函数实际上也是一个全局变量，因此，顶层函数的定义也被视为一个全局变量，并绑定到<code>window</code>对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(); <span class="comment">// 直接调用foo()</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">foo</span>(); <span class="comment">// 通过window.foo()调用</span></span><br></pre></td></tr></table></figure>
<p>进一步大胆地猜测，我们每次直接调用的<code>alert()</code>函数其实也是<code>window</code>的一个变量：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">window.alert(&#x27;调用window.alert()&#x27;);</span><br><span class="line">// 把alert保存到另一个变量:</span><br><span class="line">let old_alert = window.alert;</span><br><span class="line">// 给alert赋一个新函数:</span><br><span class="line">window.alert = function () &#123;&#125;</span><br><span class="line"></span><br><span class="line">alert(&#x27;无法用alert()显示了!&#x27;);</span><br><span class="line"></span><br><span class="line">// 恢复alert:</span><br><span class="line">window.alert = old_alert;</span><br><span class="line">alert(&#x27;又可以用alert()了!&#x27;);</span><br></pre></td></tr></table></figure>
<p>这说明JavaScript实际上只有一个全局作用域。任何变量（函数也视为变量），如果没有在当前函数作用域中找到，就会继续往上查找，最后如果在全局作用域中也没有找到，则报<code>ReferenceError</code>错误。</p>
<h3 id="名字空间">名字空间</h3>
<p>全局变量会绑定到<code>window</code>上，不同的JavaScript文件如果使用了相同的全局变量，或者定义了相同名字的顶层函数，都会造成命名冲突，并且很难被发现。</p>
<p>减少冲突的一个方法是把自己的所有变量和函数全部绑定到一个全局变量中。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 唯一的全局变量MYAPP:</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable constant_">MYAPP</span> = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 其他变量:</span></span><br><span class="line"><span class="variable constant_">MYAPP</span>.<span class="property">name</span> = <span class="string">&#x27;myapp&#x27;</span>;</span><br><span class="line"><span class="variable constant_">MYAPP</span>.<span class="property">version</span> = <span class="number">1.0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 其他函数:</span></span><br><span class="line"><span class="variable constant_">MYAPP</span>.<span class="property">foo</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;foo&#x27;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>把自己的代码全部放入唯一的名字空间<code>MYAPP</code>中，会大大减少全局变量冲突的可能。</p>
<p>许多著名的JavaScript库都是这么干的：jQuery，YUI，underscore等等。</p>
<h3 id="局部作用域">局部作用域</h3>
<p>由于JavaScript的变量作用域实际上是函数内部，我们在<code>for</code>循环等语句块中是无法定义具有局部作用域的变量的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">    i += <span class="number">100</span>; <span class="comment">// 仍然可以引用变量i</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了解决块级作用域，ES6引入了新的关键字<code>let</code>，用<code>let</code>替代<code>var</code>可以申明一个块级作用域的变量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</span><br><span class="line">        sum += i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// SyntaxError:</span></span><br><span class="line">    i += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="常量">常量</h3>
<p>由于<code>var</code>和<code>let</code>申明的是变量，如果要申明一个常量，在ES6之前是不行的，我们通常用全部大写的变量来表示“这是一个常量，不要修改它的值”：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable constant_">PI</span> = <span class="number">3.14</span>;</span><br></pre></td></tr></table></figure>
<p>ES6标准引入了新的关键字<code>const</code>来定义常量，<code>const</code>与<code>let</code>都具有块级作用域：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">PI</span> = <span class="number">3.14</span>;</span><br><span class="line"><span class="variable constant_">PI</span> = <span class="number">3</span>; <span class="comment">// 某些浏览器不报错，但是无效果！</span></span><br><span class="line"><span class="variable constant_">PI</span>; <span class="comment">// 3.14</span></span><br></pre></td></tr></table></figure>
<h3 id="解构赋值">解构赋值</h3>
<p>从ES6开始，JavaScript引入了解构赋值，可以同时对一组变量进行赋值。</p>
<p>什么是解构赋值？我们先看看传统的做法，如何把一个数组的元素分别赋值给几个变量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> array = [<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;JavaScript&#x27;</span>, <span class="string">&#x27;ES6&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> x = array[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">let</span> y = array[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">let</span> z = array[<span class="number">2</span>];</span><br></pre></td></tr></table></figure>
<p>现在，在ES6中，可以使用解构赋值，直接对多个变量同时赋值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 如果浏览器支持解构赋值就不会报错:</span><br><span class="line">let [x, y, z] = [&#x27;hello&#x27;, &#x27;JavaScript&#x27;, &#x27;ES6&#x27;];</span><br><span class="line"></span><br><span class="line">// x, y, z分别被赋值为数组对应元素:</span><br><span class="line">console.log(`x = $&#123;x&#125;, y = $&#123;y&#125;, z = $&#123;z&#125;`);</span><br></pre></td></tr></table></figure>
<p>注意，对数组元素进行解构赋值时，多个变量要用<code>[...]</code>括起来。</p>
<p>如果数组本身还有嵌套，也可以通过下面的形式进行解构赋值，注意嵌套层次和位置要保持一致：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [x, [y, z]] = [<span class="string">&#x27;hello&#x27;</span>, [<span class="string">&#x27;JavaScript&#x27;</span>, <span class="string">&#x27;ES6&#x27;</span>]];</span><br><span class="line">x; <span class="comment">// &#x27;hello&#x27;</span></span><br><span class="line">y; <span class="comment">// &#x27;JavaScript&#x27;</span></span><br><span class="line">z; <span class="comment">// &#x27;ES6&#x27;</span></span><br></pre></td></tr></table></figure>
<p>解构赋值还可以忽略某些元素：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [, , z] = [<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;JavaScript&#x27;</span>, <span class="string">&#x27;ES6&#x27;</span>]; <span class="comment">// 忽略前两个元素，只对z赋值第三个元素</span></span><br><span class="line">z; <span class="comment">// &#x27;ES6&#x27;</span></span><br></pre></td></tr></table></figure>
<p>如果需要从一个对象中取出若干属性，也可以使用解构赋值，便于快速获取对象的指定属性：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">let person = &#123;</span><br><span class="line">    name: &#x27;小明&#x27;,</span><br><span class="line">    age: 20,</span><br><span class="line">    gender: &#x27;male&#x27;,</span><br><span class="line">    passport: &#x27;G-12345678&#x27;,</span><br><span class="line">    school: &#x27;No.4 middle school&#x27;</span><br><span class="line">&#125;;</span><br><span class="line">let &#123;name, age, passport&#125; = person;</span><br><span class="line"></span><br><span class="line">// name, age, passport分别被赋值为对应属性:</span><br><span class="line">console.log(`name = $&#123;name&#125;, age = $&#123;age&#125;, passport = $&#123;passport&#125;`);</span><br></pre></td></tr></table></figure>
<p>对一个对象进行解构赋值时，同样可以直接对嵌套的对象属性进行赋值，只要保证对应的层次是一致的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">gender</span>: <span class="string">&#x27;male&#x27;</span>,</span><br><span class="line">    <span class="attr">passport</span>: <span class="string">&#x27;G-12345678&#x27;</span>,</span><br><span class="line">    <span class="attr">school</span>: <span class="string">&#x27;No.4 middle school&#x27;</span>,</span><br><span class="line">    <span class="attr">address</span>: &#123;</span><br><span class="line">        <span class="attr">city</span>: <span class="string">&#x27;Beijing&#x27;</span>,</span><br><span class="line">        <span class="attr">street</span>: <span class="string">&#x27;No.1 Road&#x27;</span>,</span><br><span class="line">        <span class="attr">zipcode</span>: <span class="string">&#x27;100001&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> &#123;name, <span class="attr">address</span>: &#123;city, zip&#125;&#125; = person;</span><br><span class="line">name; <span class="comment">// &#x27;小明&#x27;</span></span><br><span class="line">city; <span class="comment">// &#x27;Beijing&#x27;</span></span><br><span class="line">zip; <span class="comment">// undefined, 因为属性名是zipcode而不是zip</span></span><br><span class="line"><span class="comment">// 注意: address不是变量，而是为了让city和zip获得嵌套的address对象的属性:</span></span><br><span class="line">address; <span class="comment">// Uncaught ReferenceError: address is not defined</span></span><br></pre></td></tr></table></figure>
<p>使用解构赋值对对象属性进行赋值时，如果对应的属性不存在，变量将被赋值为<code>undefined</code>，这和引用一个不存在的属性获得<code>undefined</code>是一致的。如果要使用的变量名和属性名不一致，可以用下面的语法获取：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">gender</span>: <span class="string">&#x27;male&#x27;</span>,</span><br><span class="line">    <span class="attr">passport</span>: <span class="string">&#x27;G-12345678&#x27;</span>,</span><br><span class="line">    <span class="attr">school</span>: <span class="string">&#x27;No.4 middle school&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把passport属性赋值给变量id:</span></span><br><span class="line"><span class="keyword">let</span> &#123;name, <span class="attr">passport</span>:id&#125; = person;</span><br><span class="line">name; <span class="comment">// &#x27;小明&#x27;</span></span><br><span class="line">id; <span class="comment">// &#x27;G-12345678&#x27;</span></span><br><span class="line"><span class="comment">// 注意: passport不是变量，而是为了让变量id获得passport属性:</span></span><br><span class="line">passport; <span class="comment">// Uncaught ReferenceError: passport is not defined</span></span><br></pre></td></tr></table></figure>
<p>解构赋值还可以使用默认值，这样就避免了不存在的属性返回<code>undefined</code>的问题：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">gender</span>: <span class="string">&#x27;male&#x27;</span>,</span><br><span class="line">    <span class="attr">passport</span>: <span class="string">&#x27;G-12345678&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果person对象没有single属性，默认赋值为true:</span></span><br><span class="line"><span class="keyword">let</span> &#123;name, single=<span class="literal">true</span>&#125; = person;</span><br><span class="line">name; <span class="comment">// &#x27;小明&#x27;</span></span><br><span class="line">single; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>有些时候，如果变量已经被声明了，再次赋值的时候，正确的写法也会报语法错误：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明变量:</span></span><br><span class="line"><span class="keyword">let</span> x, y;</span><br><span class="line"><span class="comment">// 解构赋值:</span></span><br><span class="line">&#123;x, y&#125; = &#123; <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>, <span class="attr">x</span>: <span class="number">100</span>, <span class="attr">y</span>: <span class="number">200</span>&#125;;</span><br><span class="line"><span class="comment">// 语法错误: Uncaught SyntaxError: Unexpected token =</span></span><br></pre></td></tr></table></figure>
<p>这是因为JavaScript引擎把<code>&#123;</code>开头的语句当作了块处理，于是<code>=</code>不再合法。解决方法是用小括号括起来：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&#123;x, y&#125; = &#123; <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>, <span class="attr">x</span>: <span class="number">100</span>, <span class="attr">y</span>: <span class="number">200</span>&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="使用场景">使用场景</h3>
<p>解构赋值在很多时候可以大大简化代码。例如，交换两个变量<code>x</code>和<code>y</code>的值，可以这么写，不再需要临时变量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x=<span class="number">1</span>, y=<span class="number">2</span>;</span><br><span class="line">[x, y] = [y, x]</span><br></pre></td></tr></table></figure>
<p>快速获取当前页面的域名和路径：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;<span class="attr">hostname</span>:domain, <span class="attr">pathname</span>:path&#125; = location;</span><br></pre></td></tr></table></figure>
<p>如果一个函数接收一个对象作为参数，那么，可以使用解构直接把对象的属性绑定到变量中。例如，下面的函数可以快速创建一个<code>Date</code>对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">buildDate</span>(<span class="params">&#123;year, month, day, hour=<span class="number">0</span>, minute=<span class="number">0</span>, second=<span class="number">0</span>&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">`<span class="subst">$&#123;year&#125;</span>-<span class="subst">$&#123;month&#125;</span>-<span class="subst">$&#123;day&#125;</span> <span class="subst">$&#123;hour&#125;</span>:<span class="subst">$&#123;minute&#125;</span>:<span class="subst">$&#123;second&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>它的方便之处在于传入的对象只需要<code>year</code>、<code>month</code>和<code>day</code>这三个属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">buildDate</span>(&#123; <span class="attr">year</span>: <span class="number">2017</span>, <span class="attr">month</span>: <span class="number">1</span>, <span class="attr">day</span>: <span class="number">1</span> &#125;);</span><br><span class="line"><span class="comment">// Sun Jan 01 2017 00:00:00 GMT+0800 (CST)</span></span><br></pre></td></tr></table></figure>
<p>也可以传入<code>hour</code>、<code>minute</code>和<code>second</code>属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">buildDate</span>(&#123; <span class="attr">year</span>: <span class="number">2017</span>, <span class="attr">month</span>: <span class="number">1</span>, <span class="attr">day</span>: <span class="number">1</span>, <span class="attr">hour</span>: <span class="number">20</span>, <span class="attr">minute</span>: <span class="number">15</span> &#125;);</span><br><span class="line"><span class="comment">// Sun Jan 01 2017 20:15:00 GMT+0800 (CST)</span></span><br></pre></td></tr></table></figure>
<p>使用解构赋值可以减少代码量，但是，需要在支持ES6解构赋值特性的现代浏览器中才能正常运行。目前支持解构赋值的浏览器包括Chrome，Firefox，Edge等。</p>
<p>在一个对象中绑定函数，称为这个对象的方法。</p>
<p>在JavaScript中，对象的定义是这样的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>但是，如果我们给<code>xiaoming</code>绑定一个函数，就可以做更多的事情。比如，写个<code>age()</code>方法，返回<code>xiaoming</code>的年龄：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> y = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>();</span><br><span class="line">        <span class="keyword">return</span> y - <span class="variable language_">this</span>.<span class="property">birth</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xiaoming.<span class="property">age</span>; <span class="comment">// function xiaoming.age()</span></span><br><span class="line">xiaoming.<span class="title function_">age</span>(); <span class="comment">// 今年调用是25,明年调用就变成26了</span></span><br></pre></td></tr></table></figure>
<p>绑定到对象上的函数称为方法，和普通函数也没啥区别，但是它在内部使用了一个<code>this</code>关键字，这个东东是什么？</p>
<p>在一个方法内部，<code>this</code>是一个特殊变量，它始终指向当前对象，也就是<code>xiaoming</code>这个变量。所以，<code>this.birth</code>可以拿到<code>xiaoming</code>的<code>birth</code>属性。</p>
<p>让我们拆开写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getAge</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> y = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>();</span><br><span class="line">    <span class="keyword">return</span> y - <span class="variable language_">this</span>.<span class="property">birth</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span>,</span><br><span class="line">    <span class="attr">age</span>: getAge</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xiaoming.<span class="title function_">age</span>(); <span class="comment">// 25, 正常结果</span></span><br><span class="line"><span class="title function_">getAge</span>(); <span class="comment">// NaN</span></span><br></pre></td></tr></table></figure>
<p>单独调用函数<code>getAge()</code>怎么返回了<code>NaN</code>？<em>请注意</em>，我们已经进入到了JavaScript的一个大坑里。</p>
<p>JavaScript的函数内部如果调用了<code>this</code>，那么这个<code>this</code>到底指向谁？</p>
<p>答案是，视情况而定！</p>
<p>如果以对象的方法形式调用，比如<code>xiaoming.age()</code>，该函数的<code>this</code>指向被调用的对象，也就是<code>xiaoming</code>，这是符合我们预期的。</p>
<p>如果单独调用函数，比如<code>getAge()</code>，此时，该函数的<code>this</code>指向全局对象，也就是<code>window</code>。</p>
<p>坑爹啊！</p>
<p>更坑爹的是，如果这么写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fn = xiaoming.<span class="property">age</span>; <span class="comment">// 先拿到xiaoming的age函数</span></span><br><span class="line"><span class="title function_">fn</span>(); <span class="comment">// NaN</span></span><br></pre></td></tr></table></figure>
<p>也是不行的！要保证<code>this</code>指向正确，必须用<code>obj.xxx()</code>的形式调用！</p>
<p>由于这是一个巨大的设计错误，要想纠正可没那么简单。ECMA决定，在strict模式下让函数的<code>this</code>指向<code>undefined</code>，因此，在strict模式下，你会得到一个错误：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> y = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>();</span><br><span class="line">        <span class="keyword">return</span> y - <span class="variable language_">this</span>.<span class="property">birth</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> fn = xiaoming.<span class="property">age</span>;</span><br><span class="line"><span class="title function_">fn</span>(); <span class="comment">// Uncaught TypeError: Cannot read property &#x27;birth&#x27; of undefined</span></span><br></pre></td></tr></table></figure>
<p>这个决定只是让错误及时暴露出来，并没有解决<code>this</code>应该指向的正确位置。</p>
<p>有些时候，喜欢重构的你把方法重构了一下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">getAgeFromBirth</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> y = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>();</span><br><span class="line">            <span class="keyword">return</span> y - <span class="variable language_">this</span>.<span class="property">birth</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">getAgeFromBirth</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xiaoming.<span class="title function_">age</span>(); <span class="comment">// Uncaught TypeError: Cannot read property &#x27;birth&#x27; of undefined</span></span><br></pre></td></tr></table></figure>
<p>结果又报错了！原因是<code>this</code>指针只在<code>age</code>方法的函数内指向<code>xiaoming</code>，在函数内部定义的函数，<code>this</code>又指向<code>undefined</code>了！（在非strict模式下，它重新指向全局对象<code>window</code>！）</p>
<p>修复的办法也不是没有，我们用一个<code>that</code>变量首先捕获<code>this</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> that = <span class="variable language_">this</span>; <span class="comment">// 在方法内部一开始就捕获this</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">getAgeFromBirth</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> y = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>();</span><br><span class="line">            <span class="keyword">return</span> y - that.<span class="property">birth</span>; <span class="comment">// 用that而不是this</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">getAgeFromBirth</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xiaoming.<span class="title function_">age</span>(); <span class="comment">// 25</span></span><br></pre></td></tr></table></figure>
<p>用<code>let that = this;</code>，你就可以放心地在方法内部定义其他函数，而不是把所有语句都堆到一个方法中。</p>
<h3 id="apply">apply</h3>
<p>虽然在一个独立的函数调用中，根据是否是strict模式，<code>this</code>指向<code>undefined</code>或<code>window</code>，不过，我们还是可以控制<code>this</code>的指向的！</p>
<p>要指定函数的<code>this</code>指向哪个对象，可以用函数本身的<code>apply</code>方法，它接收两个参数，第一个参数就是需要绑定的<code>this</code>变量，第二个参数是<code>Array</code>，表示函数本身的参数。</p>
<p>用<code>apply</code>修复<code>getAge()</code>调用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getAge</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> y = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>();</span><br><span class="line">    <span class="keyword">return</span> y - <span class="variable language_">this</span>.<span class="property">birth</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span>,</span><br><span class="line">    <span class="attr">age</span>: getAge</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xiaoming.<span class="title function_">age</span>(); <span class="comment">// 25</span></span><br><span class="line">getAge.<span class="title function_">apply</span>(xiaoming, []); <span class="comment">// 25, this指向xiaoming, 参数为空</span></span><br></pre></td></tr></table></figure>
<p>另一个与<code>apply()</code>类似的方法是<code>call()</code>，唯一区别是：</p>
<ul>
<li><code>apply()</code>把参数打包成<code>Array</code>再传入；</li>
<li><code>call()</code>把参数按顺序传入。</li>
</ul>
<p>比如调用<code>Math.max(3, 5, 4)</code>，分别用<code>apply()</code>和<code>call()</code>实现如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Math</span>.<span class="property">max</span>.<span class="title function_">apply</span>(<span class="literal">null</span>, [<span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>]); <span class="comment">// 5</span></span><br><span class="line"><span class="title class_">Math</span>.<span class="property">max</span>.<span class="title function_">call</span>(<span class="literal">null</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>); <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>
<p>对普通函数调用，我们通常把<code>this</code>绑定为<code>null</code>。</p>
<h3 id="装饰器">装饰器</h3>
<p>利用<code>apply()</code>，我们还可以动态改变函数的行为。</p>
<p>JavaScript的所有对象都是动态的，即使内置的函数，我们也可以重新指向新的函数。</p>
<p>现在假定我们想统计一下代码一共调用了多少次<code>parseInt()</code>，可以把所有的调用都找出来，然后手动加上<code>count += 1</code>，不过这样做太傻了。最佳方案是用我们自己的函数替换掉默认的<code>parseInt()</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x27;use strict&#x27;;</span><br><span class="line"></span><br><span class="line">let count = 0;</span><br><span class="line">let oldParseInt = parseInt; // 保存原函数</span><br><span class="line"></span><br><span class="line">window.parseInt = function () &#123;</span><br><span class="line">    count += 1;</span><br><span class="line">    return oldParseInt.apply(null, arguments); // 调用原函数</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">parseInt(&#x27;10&#x27;);</span><br><span class="line">parseInt(&#x27;20&#x27;);</span><br><span class="line">parseInt(&#x27;30&#x27;);</span><br><span class="line">console.log(&#x27;count = &#x27; + count); // 3</span><br></pre></td></tr></table></figure>
<p>高阶函数英文叫Higher-order function。那么什么是高阶函数？</p>
<p>JavaScript的函数其实都指向某个变量。既然变量可以指向函数，函数的参数能接收变量，那么一个函数就可以接收另一个函数作为参数，这种函数就称之为高阶函数。</p>
<p>一个最简单的高阶函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">x, y, f</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">f</span>(x) + <span class="title function_">f</span>(y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们调用<code>add(-5, 6, Math.abs)</code>时，参数<code>x</code>，<code>y</code>和<code>f</code>分别接收<code>-5</code>，<code>6</code>和函数<code>Math.abs</code>，根据函数定义，我们可以推导计算过程为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x = -5;</span><br><span class="line">y = 6;</span><br><span class="line">f = Math.abs;</span><br><span class="line">f(x) + f(y) ==&gt; Math.abs(-5) + Math.abs(6) ==&gt; 11;</span><br><span class="line">return 11;</span><br></pre></td></tr></table></figure>
<p>用代码验证一下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function add(x, y, f) &#123;</span><br><span class="line">    return f(x) + f(y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let x = add(-5, 6, Math.abs);</span><br><span class="line">console.log(x); // 11</span><br></pre></td></tr></table></figure>
<p>编写高阶函数，就是让函数的参数能够接收别的函数。</p>
<p>如果你读过Google的那篇大名鼎鼎的论文“<a target="_blank" rel="noopener" href="https://research.google/pubs/mapreduce-simplified-data-processing-on-large-clusters/">MapReduce: Simplified Data Processing on Large Clusters</a>”，你就能大概明白map/reduce的概念。</p>
<h3 id="map">map</h3>
<p>举例说明，比如我们有一个函数f(x)=x2，要把这个函数作用在一个数组<code>[1, 2, 3, 4, 5, 6, 7, 8, 9]</code>上，就可以用<code>map</code>实现如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">            f(x) = x * x</span><br><span class="line"></span><br><span class="line">                  │</span><br><span class="line">                  │</span><br><span class="line">  ┌───┬───┬───┬───┼───┬───┬───┬───┐</span><br><span class="line">  │   │   │   │   │   │   │   │   │</span><br><span class="line">  ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼</span><br><span class="line"></span><br><span class="line">[ 1   2   3   4   5   6   7   8   9 ]</span><br><span class="line"></span><br><span class="line">  │   │   │   │   │   │   │   │   │</span><br><span class="line">  │   │   │   │   │   │   │   │   │</span><br><span class="line">  ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼</span><br><span class="line"></span><br><span class="line">[ 1   4   9  16  25  36  49  64  81 ]</span><br></pre></td></tr></table></figure>
<p>由于<code>map()</code>方法定义在JavaScript的<code>Array</code>中，我们调用<code>Array</code>的<code>map()</code>方法，传入我们自己的函数，就得到了一个新的<code>Array</code>作为结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function pow(x) &#123;</span><br><span class="line">    return x * x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let arr = [1, 2, 3, 4, 5, 6, 7, 8, 9];</span><br><span class="line">let results = arr.map(pow); // [1, 4, 9, 16, 25, 36, 49, 64, 81]</span><br><span class="line">console.log(results);</span><br></pre></td></tr></table></figure>
<p>注意：<code>map()</code>传入的参数是<code>pow</code>，即函数对象本身。</p>
<p>你可能会想，不需要<code>map()</code>，写一个循环，也可以计算出结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> f = <span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>];</span><br><span class="line"><span class="keyword">let</span> result = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    result.<span class="title function_">push</span>(<span class="title function_">f</span>(arr[i]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>的确可以，但是，从上面的循环代码，我们无法一眼看明白“把f(x)作用在Array的每一个元素并把结果生成一个新的Array”。</p>
<p>所以，<code>map()</code>作为高阶函数，事实上它把运算规则抽象了，因此，我们不但可以计算简单的f(x)=x2，还可以计算任意复杂的函数，比如，把<code>Array</code>的所有数字转为字符串：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>];</span><br><span class="line">arr.<span class="title function_">map</span>(<span class="title class_">String</span>); <span class="comment">// [&#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;, &#x27;6&#x27;, &#x27;7&#x27;, &#x27;8&#x27;, &#x27;9&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>只需要一行代码。</p>
<h3 id="reduce">reduce</h3>
<p>再看reduce的用法。Array的<code>reduce()</code>把一个函数作用在这个<code>Array</code>的<code>[x1, x2, x3...]</code>上，这个函数必须接收两个参数，<code>reduce()</code>把结果继续和序列的下一个元素做累积计算，其效果就是：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[x1, x2, x3, x4].<span class="title function_">reduce</span>(f) = <span class="title function_">f</span>(<span class="title function_">f</span>(<span class="title function_">f</span>(x1, x2), x3), x4)</span><br></pre></td></tr></table></figure>
<p>比方说对一个<code>Array</code>求和，就可以用<code>reduce</code>实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>];</span><br><span class="line">arr.<span class="title function_">reduce</span>(<span class="keyword">function</span> (<span class="params">x, y</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;); <span class="comment">// 25</span></span><br></pre></td></tr></table></figure>
<p>如果数组元素只有1个，那么还需要提供一个额外的初始参数以便至少凑够两：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">123</span>];</span><br><span class="line">arr.<span class="title function_">reduce</span>(<span class="keyword">function</span> (<span class="params">x, y</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;, <span class="number">0</span>); <span class="comment">// 123</span></span><br></pre></td></tr></table></figure>
<p>练习：利用<code>reduce()</code>求积：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function product(arr) &#123;</span><br><span class="line">    // FIXME:</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">if (product([1, 2, 3, 4]) === 24 &amp;&amp; product([0, 1, 2]) === 0 &amp;&amp; product([99, 88, 77, 66]) === 44274384) &#123;</span><br><span class="line">    console.log(&#x27;测试通过!&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">    console.log(&#x27;测试失败!&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>要把<code>[1, 3, 5, 7, 9]</code>变换成整数13579，<code>reduce()</code>也能派上用场：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>];</span><br><span class="line">arr.<span class="title function_">reduce</span>(<span class="keyword">function</span> (<span class="params">x, y</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x * <span class="number">10</span> + y;</span><br><span class="line">&#125;); <span class="comment">// 13579</span></span><br></pre></td></tr></table></figure>
<p>如果我们继续改进这个例子，想办法把一个字符串<code>13579</code>先变成<code>Array</code>——<code>[1, 3, 5, 7, 9]</code>，再利用<code>reduce()</code>就可以写出一个把字符串转换为Number的函数。</p>
<p>练习：不要使用JavaScript内置的<code>parseInt()</code>函数，利用map和reduce操作实现一个<code>string2int()</code>函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function string2int(s) &#123;</span><br><span class="line">    // FIXME:</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">if (string2int(&#x27;0&#x27;) === 0 &amp;&amp; string2int(&#x27;12345&#x27;) === 12345 &amp;&amp; string2int(&#x27;12300&#x27;) === 12300) &#123;</span><br><span class="line">    if (string2int.toString().indexOf(&#x27;parseInt&#x27;) !== -1) &#123;</span><br><span class="line">        console.log(&#x27;请勿使用parseInt()!&#x27;);</span><br><span class="line">    &#125; else if (string2int.toString().indexOf(&#x27;Number&#x27;) !== -1) &#123;</span><br><span class="line">        console.log(&#x27;请勿使用Number()!&#x27;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(&#x27;测试通过!&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">    console.log(&#x27;测试失败!&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="练习-2">练习</h3>
<p>请把用户输入的不规范的英文名字，变为首字母大写，其他小写的规范名字。输入：<code>['adam', 'LISA', 'barT']</code>，输出：<code>['Adam', 'Lisa', 'Bart']</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function normalize(arr) &#123;</span><br><span class="line">    // FIXME:</span><br><span class="line">    return [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">if (normalize([&#x27;adam&#x27;, &#x27;LISA&#x27;, &#x27;barT&#x27;]).toString() === [&#x27;Adam&#x27;, &#x27;Lisa&#x27;, &#x27;Bart&#x27;].toString()) &#123;</span><br><span class="line">    console.log(&#x27;测试通过!&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">    console.log(&#x27;测试失败!&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>小明希望利用<code>map()</code>把字符串变成整数，他写的代码很简洁：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let arr = [&#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;];</span><br><span class="line">let r;</span><br><span class="line"></span><br><span class="line">r = arr.map(parseInt);</span><br><span class="line">console.log(r);</span><br></pre></td></tr></table></figure>
<p>结果竟然是<code>1</code>, <code>NaN</code>, <code>NaN</code>，小明百思不得其解，请帮他找到原因并修正代码。</p>
<p>提示：参考<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/map">Array.prototype.map()的文档</a>。</p>
<p>原因分析:</p>
<p>由于map()接收的回调函数可以有3个参数：callback(currentValue, index, array)，通常我们仅需要第一个参数，而忽略了传入的后面两个参数。不幸的是，parseInt(string, radix)没有忽略第二个参数，导致实际执行的函数分别是：</p>
<p>parseInt(‘1’, 0); // 1, 按十进制转换<br>
parseInt(‘2’, 1); // NaN, 没有一进制<br>
parseInt(‘3’, 2); // NaN, 按二进制转换不允许出现3<br>
可以改为r = arr.map(Number);，因为Number(value)函数仅接收一个参数。</p>
<p>filter也是一个常用的操作，它用于把<code>Array</code>的某些元素过滤掉，然后返回剩下的元素。</p>
<p>和<code>map()</code>类似，<code>Array</code>的<code>filter()</code>也接收一个函数。和<code>map()</code>不同的是，<code>filter()</code>把传入的函数依次作用于每个元素，然后根据返回值是<code>true</code>还是<code>false</code>决定保留还是丢弃该元素。</p>
<p>例如，在一个<code>Array</code>中，删掉偶数，只保留奇数，可以这么写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">15</span>];</span><br><span class="line"><span class="keyword">let</span> r = arr.<span class="title function_">filter</span>(<span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x % <span class="number">2</span> !== <span class="number">0</span>;</span><br><span class="line">&#125;);</span><br><span class="line">r; <span class="comment">// [1, 5, 9, 15]</span></span><br></pre></td></tr></table></figure>
<p>把一个<code>Array</code>中的空字符串删掉，可以这么写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="literal">null</span>, <span class="literal">undefined</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;  &#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> r = arr.<span class="title function_">filter</span>(<span class="keyword">function</span> (<span class="params">s</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> s &amp;&amp; s.<span class="title function_">trim</span>(); <span class="comment">// 注意：IE9以下的版本没有trim()方法</span></span><br><span class="line">&#125;);</span><br><span class="line">r; <span class="comment">// [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>可见用<code>filter()</code>这个高阶函数，关键在于正确实现一个“筛选”函数。</p>
<h3 id="回调函数">回调函数</h3>
<p><code>filter()</code>接收的回调函数，其实可以有多个参数。通常我们仅使用第一个参数，表示<code>Array</code>的某个元素。回调函数还可以接收另外两个参数，表示元素的位置和数组本身：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> r = arr.<span class="title function_">filter</span>(<span class="keyword">function</span> (<span class="params">element, index, self</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(element); <span class="comment">// 依次打印&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(index); <span class="comment">// 依次打印0, 1, 2</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(self); <span class="comment">// self就是变量arr</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>利用<code>filter</code>，可以巧妙地去除<code>Array</code>的重复元素：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let</span><br><span class="line">    r,</span><br><span class="line">    arr = [&#x27;apple&#x27;, &#x27;strawberry&#x27;, &#x27;banana&#x27;, &#x27;pear&#x27;, &#x27;apple&#x27;, &#x27;orange&#x27;, &#x27;orange&#x27;, &#x27;strawberry&#x27;];</span><br><span class="line"></span><br><span class="line">r = arr.filter(function (element, index, self) &#123;</span><br><span class="line">    return self.indexOf(element) === index;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">console.log(r);</span><br></pre></td></tr></table></figure>
<p>去除重复元素依靠的是<code>indexOf</code>总是返回第一个元素的位置，后续的重复元素位置与<code>indexOf</code>返回的位置不相等，因此被<code>filter</code>滤掉了。</p>
<h3 id="练习-3">练习</h3>
<p>请尝试用<code>filter()</code>筛选出素数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function get_primes(arr) &#123;</span><br><span class="line">    // FIXME:</span><br><span class="line">    return [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">let</span><br><span class="line">    x,</span><br><span class="line">    r,</span><br><span class="line">    arr = [];</span><br><span class="line">for (x = 1; x &lt; 100; x++) &#123;</span><br><span class="line">    arr.push(x);</span><br><span class="line">&#125;</span><br><span class="line">r = get_primes(arr);</span><br><span class="line">if (r.toString() === [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97].toString()) &#123;</span><br><span class="line">    console.log(&#x27;测试通过!&#x27;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    console.log(&#x27;测试失败: &#x27; + r.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="排序算法">排序算法</h3>
<p>排序也是在程序中经常用到的算法。无论使用冒泡排序还是快速排序，排序的核心是比较两个元素的大小。如果是数字，我们可以直接比较，但如果是字符串或者两个对象呢？直接比较数学上的大小是没有意义的，因此，比较的过程必须通过函数抽象出来。通常规定，对于两个元素<code>x</code>和<code>y</code>，如果认为<code>x &lt; y</code>，则返回<code>-1</code>，如果认为<code>x == y</code>，则返回<code>0</code>，如果认为<code>x &gt; y</code>，则返回<code>1</code>，这样，排序算法就不用关心具体的比较过程，而是根据比较结果直接排序。</p>
<p>JavaScript的<code>Array</code>的<code>sort()</code>方法就是用于排序的，但是排序结果可能让你大吃一惊：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 看上去正常的结果:</span></span><br><span class="line">[<span class="string">&#x27;Google&#x27;</span>, <span class="string">&#x27;Apple&#x27;</span>, <span class="string">&#x27;Microsoft&#x27;</span>].<span class="title function_">sort</span>(); <span class="comment">// [&#x27;Apple&#x27;, &#x27;Google&#x27;, &#x27;Microsoft&#x27;];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// apple排在了最后:</span></span><br><span class="line">[<span class="string">&#x27;Google&#x27;</span>, <span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;Microsoft&#x27;</span>].<span class="title function_">sort</span>(); <span class="comment">// [&#x27;Google&#x27;, &#x27;Microsoft&quot;, &#x27;apple&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 无法理解的结果:</span></span><br><span class="line">[<span class="number">10</span>, <span class="number">20</span>, <span class="number">1</span>, <span class="number">2</span>].<span class="title function_">sort</span>(); <span class="comment">// [1, 10, 2, 20]</span></span><br></pre></td></tr></table></figure>
<p>第二个排序把<code>apple</code>排在了最后，是因为字符串根据ASCII码进行排序，而小写字母<code>a</code>的ASCII码在大写字母之后。</p>
<p>第三个排序结果是什么鬼？简单的数字排序都能错？</p>
<p>这是因为<code>Array</code>的<code>sort()</code>方法默认把所有元素先转换为String再排序，结果<code>'10'</code>排在了<code>'2'</code>的前面，因为字符<code>'1'</code>比字符<code>'2'</code>的ASCII码小。</p>
<p><img src="https://liaoxuefeng.com/books/javascript/function/higher-order-function/sort/douwo.jpg" alt="douwo"></p>
<p>如果不知道<code>sort()</code>方法的默认排序规则，直接对数字排序，绝对栽进坑里！</p>
<p>幸运的是，<code>sort()</code>方法也是一个高阶函数，它还可以接收一个比较函数来实现自定义的排序。</p>
<p>要按数字大小排序，我们可以这么写：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">let arr = [10, 20, 1, 2];</span><br><span class="line"></span><br><span class="line">arr.sort(function (x, y) &#123;</span><br><span class="line">    if (x &lt; y) &#123;</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line">    if (x &gt; y) &#123;</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">console.log(arr); // [1, 2, 10, 20]</span><br></pre></td></tr></table></figure>
<p>如果要倒序排序，我们可以把大的数放前面：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">10</span>, <span class="number">20</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">arr.<span class="title function_">sort</span>(<span class="keyword">function</span> (<span class="params">x, y</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> y - x;</span><br><span class="line">&#125;); <span class="comment">// [20, 10, 2, 1]</span></span><br></pre></td></tr></table></figure>
<p>给<code>sort()</code>传入的比较函数接受<code>x</code>和<code>y</code>两个参数，如果<code>x&lt;y</code>，应返回负数，如果<code>x&gt;y</code>，应返回正数，如果<code>x=y</code>，应返回0。</p>
<p>默认情况下，对字符串排序，是按照ASCII的大小比较的，现在，我们提出排序应该忽略大小写，按照字母序排序。要实现这个算法，不必对现有代码大加改动，只要我们能定义出忽略大小写的比较算法就可以：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;Google&#x27;</span>, <span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;Microsoft&#x27;</span>];</span><br><span class="line">arr.<span class="title function_">sort</span>(<span class="keyword">function</span> (<span class="params">s1, s2</span>) &#123;</span><br><span class="line">    x1 = s1.<span class="title function_">toUpperCase</span>();</span><br><span class="line">    x2 = s2.<span class="title function_">toUpperCase</span>();</span><br><span class="line">    <span class="keyword">if</span> (x1 &lt; x2) &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (x1 &gt; x2) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;); <span class="comment">// [&#x27;apple&#x27;, &#x27;Google&#x27;, &#x27;Microsoft&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>忽略大小写来比较两个字符串，实际上就是先把字符串都变成大写（或者都变成小写），再比较。</p>
<p>从上述例子可以看出，高阶函数的抽象能力是非常强大的，而且，核心代码可以保持得非常简洁。</p>
<p>最后友情提示，<code>sort()</code>方法会直接对<code>Array</code>进行修改，它返回的结果仍是当前<code>Array</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 = [<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;C&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> a2 = a1.<span class="title function_">sort</span>();</span><br><span class="line">a1; <span class="comment">// [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;]</span></span><br><span class="line">a2; <span class="comment">// [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;]</span></span><br><span class="line">a1 === a2; <span class="comment">// true, a1和a2是同一对象</span></span><br></pre></td></tr></table></figure>
<h2 id="Array">Array</h2>
<p>对于数组，除了<code>map()</code>、<code>reduce</code>、<code>filter()</code>、<code>sort()</code>这些方法可以传入一个函数外，<code>Array</code>对象还提供了很多非常实用的高阶函数。</p>
<h3 id="every">every</h3>
<p><code>every()</code>方法可以判断数组的所有元素是否满足测试条件。</p>
<p>例如，给定一个包含若干字符串的数组，判断所有字符串是否满足指定的测试条件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let arr = [&#x27;Apple&#x27;, &#x27;pear&#x27;, &#x27;orange&#x27;];</span><br><span class="line">console.log(arr.every(function (s) &#123;</span><br><span class="line">    return s.length &gt; 0;</span><br><span class="line">&#125;)); // true, 因为每个元素都满足s.length&gt;0</span><br><span class="line"></span><br><span class="line">console.log(arr.every(function (s) &#123;</span><br><span class="line">    return s.toLowerCase() === s;</span><br><span class="line">&#125;)); // false, 因为不是每个元素都全部是小写</span><br></pre></td></tr></table></figure>
<h3 id="find">find</h3>
<p><code>find()</code>方法用于查找符合条件的第一个元素，如果找到了，返回这个元素，否则，返回<code>undefined</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let arr = [&#x27;Apple&#x27;, &#x27;pear&#x27;, &#x27;orange&#x27;];</span><br><span class="line">console.log(arr.find(function (s) &#123;</span><br><span class="line">    return s.toLowerCase() === s;</span><br><span class="line">&#125;)); // &#x27;pear&#x27;, 因为pear全部是小写</span><br><span class="line"></span><br><span class="line">console.log(arr.find(function (s) &#123;</span><br><span class="line">    return s.toUpperCase() === s;</span><br><span class="line">&#125;)); // undefined, 因为没有全部是大写的元素</span><br></pre></td></tr></table></figure>
<h3 id="findIndex">findIndex</h3>
<p><code>findIndex()</code>和<code>find()</code>类似，也是查找符合条件的第一个元素，不同之处在于<code>findIndex()</code>会返回这个元素的索引，如果没有找到，返回<code>-1</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let arr = [&#x27;Apple&#x27;, &#x27;pear&#x27;, &#x27;orange&#x27;];</span><br><span class="line">console.log(arr.findIndex(function (s) &#123;</span><br><span class="line">    return s.toLowerCase() === s;</span><br><span class="line">&#125;)); // 1, 因为&#x27;pear&#x27;的索引是1</span><br><span class="line"></span><br><span class="line">console.log(arr.findIndex(function (s) &#123;</span><br><span class="line">    return s.toUpperCase() === s;</span><br><span class="line">&#125;)); // -1</span><br></pre></td></tr></table></figure>
<h3 id="forEach">forEach</h3>
<p><code>forEach()</code>和<code>map()</code>类似，它也把每个元素依次作用于传入的函数，但不会返回新的数组。<code>forEach()</code>常用于遍历数组，因此，传入的函数不需要返回值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let arr = [&#x27;Apple&#x27;, &#x27;pear&#x27;, &#x27;orange&#x27;];</span><br><span class="line">arr.forEach(x=&gt;console.log(x)); // 依次打印每个元素</span><br></pre></td></tr></table></figure>
<hr>
<hr>
<h3 id="函数作为返回值">函数作为返回值</h3>
<p>高阶函数除了可以接受函数作为参数外，还可以把函数作为结果值返回。</p>
<p>我们来实现一个对<code>Array</code>的求和。通常情况下，求和的函数是这样定义的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> arr.<span class="title function_">reduce</span>(<span class="keyword">function</span> (<span class="params">x, y</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">sum</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]); <span class="comment">// 15</span></span><br></pre></td></tr></table></figure>
<p>但是，如果不需要立刻求和，而是在后面的代码中，根据需要再计算怎么办？可以不返回求和的结果，而是返回求和的函数！</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">lazy_sum</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> sum = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> arr.<span class="title function_">reduce</span>(<span class="keyword">function</span> (<span class="params">x, y</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> x + y;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们调用<code>lazy_sum()</code>时，返回的并不是求和结果，而是求和函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> f = <span class="title function_">lazy_sum</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]); <span class="comment">// function sum()</span></span><br></pre></td></tr></table></figure>
<p>调用函数<code>f</code>时，才真正计算求和的结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">f</span>(); <span class="comment">// 15</span></span><br></pre></td></tr></table></figure>
<p>在这个例子中，我们在函数<code>lazy_sum</code>中又定义了函数<code>sum</code>，并且，内部函数<code>sum</code>可以引用外部函数<code>lazy_sum</code>的参数和局部变量，当<code>lazy_sum</code>返回函数<code>sum</code>时，相关参数和变量都保存在返回的函数中，这种称为“闭包（Closure）”的程序结构拥有极大的威力。</p>
<p>请再注意一点，当我们调用<code>lazy_sum()</code>时，每次调用都会返回一个新的函数，即使传入相同的参数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> f1 = <span class="title function_">lazy_sum</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line"><span class="keyword">let</span> f2 = <span class="title function_">lazy_sum</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line">f1 === f2; <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p><code>f1()</code>和<code>f2()</code>的调用结果互不影响。</p>
<h3 id="闭包">闭包</h3>
<p>注意到返回的函数在其定义内部引用了局部变量<code>arr</code>，所以，当一个函数返回了一个函数后，其内部的局部变量还被新函数引用，所以，闭包用起来简单，实现起来可不容易。</p>
<p>另一个需要注意的问题是，返回的函数并没有立刻执行，而是直到调用了<code>f()</code>才执行。我们来看一个例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">count</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">1</span>; i&lt;=<span class="number">3</span>; i++) &#123;</span><br><span class="line">        arr.<span class="title function_">push</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> i * i;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> results = <span class="title function_">count</span>();</span><br><span class="line"><span class="keyword">let</span> [f1, f2, f3] = results;</span><br></pre></td></tr></table></figure>
<p>在上面的例子中，每次循环，都创建了一个新的函数，然后，把创建的3个函数都添加到一个<code>Array</code>中返回了。</p>
<p>你可能认为调用<code>f1()</code>，<code>f2()</code>和<code>f3()</code>结果应该是<code>1</code>，<code>4</code>，<code>9</code>，但实际结果是：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">f1</span>(); <span class="comment">// 16</span></span><br><span class="line"><span class="title function_">f2</span>(); <span class="comment">// 16</span></span><br><span class="line"><span class="title function_">f3</span>(); <span class="comment">// 16</span></span><br></pre></td></tr></table></figure>
<p>全部都是<code>16</code>！原因就在于返回的函数引用了用<code>var</code>定义的变量<code>i</code>，但它并非立刻执行。等到3个函数都返回时，它们所引用的变量<code>i</code>已经变成了<code>4</code>，因此最终结果为<code>16</code>。</p>
<p>返回闭包时牢记的一点就是：返回函数不要引用任何循环变量，或者后续会发生变化的变量。</p>
<p>如果一定要引用循环变量怎么办？方法是再创建一个函数，用该函数的参数绑定循环变量当前的值，无论该循环变量后续如何更改，已绑定到函数参数的值不变：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">count</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">1</span>; i&lt;=<span class="number">3</span>; i++) &#123;</span><br><span class="line">        arr.<span class="title function_">push</span>((<span class="keyword">function</span> (<span class="params">n</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> n * n;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)(i));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [f1, f2, f3] = <span class="title function_">count</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_">f1</span>(); <span class="comment">// 1</span></span><br><span class="line"><span class="title function_">f2</span>(); <span class="comment">// 4</span></span><br><span class="line"><span class="title function_">f3</span>(); <span class="comment">// 9</span></span><br></pre></td></tr></table></figure>
<p>注意这里用了一个“创建一个匿名函数并立刻执行”的语法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;)(<span class="number">3</span>); <span class="comment">// 9</span></span><br></pre></td></tr></table></figure>
<p>理论上讲，创建一个匿名函数并立刻执行可以这么写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> (<span class="params">x</span>) &#123; <span class="keyword">return</span> x * x &#125; (<span class="number">3</span>);</span><br></pre></td></tr></table></figure>
<p>但是由于JavaScript语法解析的问题，会报SyntaxError错误，因此需要用括号把整个函数定义括起来：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params">x</span>) &#123; <span class="keyword">return</span> x * x &#125;) (<span class="number">3</span>);</span><br></pre></td></tr></table></figure>
<p>通常，一个立即执行的匿名函数可以把函数体拆开，一般这么写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;)(<span class="number">3</span>);</span><br></pre></td></tr></table></figure>
<p>另一个方法是把循环变量<code>i</code>用<code>let</code>定义在<code>for</code>循环体中，<code>let</code>作用域决定了在每次循环时都会绑定新的<code>i</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">count</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">1</span>; i&lt;=<span class="number">3</span>; i++) &#123;</span><br><span class="line">        arr.<span class="title function_">push</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> i * i;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但如果<code>i</code>定义在<code>for</code>循环外面，则仍然是错误的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">count</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = [];</span><br><span class="line">    <span class="keyword">let</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;=<span class="number">3</span>; i++) &#123;</span><br><span class="line">        arr.<span class="title function_">push</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> i * i;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因此，最好的办法还是返回函数不要引用任何循环变量。</p>
<p>说了这么多，难道闭包就是为了返回一个函数然后延迟执行吗？</p>
<p>当然不是！闭包有非常强大的功能。举个栗子：</p>
<p>在面向对象的程序设计语言里，比如Java和C++，要在对象内部封装一个私有变量，可以用<code>private</code>修饰一个成员变量。</p>
<p>在没有<code>class</code>机制，只有函数的语言里，借助闭包，同样可以封装一个私有变量。我们用JavaScript创建一个计数器：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">create_counter</span>(<span class="params">initial</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> x = initial || <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">inc</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            x += <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>它用起来像这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> c1 = <span class="title function_">create_counter</span>();</span><br><span class="line">c1.<span class="title function_">inc</span>(); <span class="comment">// 1</span></span><br><span class="line">c1.<span class="title function_">inc</span>(); <span class="comment">// 2</span></span><br><span class="line">c1.<span class="title function_">inc</span>(); <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> c2 = <span class="title function_">create_counter</span>(<span class="number">10</span>);</span><br><span class="line">c2.<span class="title function_">inc</span>(); <span class="comment">// 11</span></span><br><span class="line">c2.<span class="title function_">inc</span>(); <span class="comment">// 12</span></span><br><span class="line">c2.<span class="title function_">inc</span>(); <span class="comment">// 13</span></span><br></pre></td></tr></table></figure>
<p>在返回的对象中，实现了一个闭包，该闭包携带了局部变量<code>x</code>，并且，从外部代码根本无法访问到变量<code>x</code>。换句话说，闭包就是携带状态的函数，并且它的状态可以完全对外隐藏起来。</p>
<p>闭包还可以把多参数的函数变成单参数的函数。例如，要计算xy可以用<code>Math.pow(x, y)</code>函数，不过考虑到经常计算x2或x3，我们可以利用闭包创建新的函数<code>pow2</code>和<code>pow3</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function make_pow(n) &#123;</span><br><span class="line">    return function (x) &#123;</span><br><span class="line">        return Math.pow(x, n);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 创建两个新函数:</span><br><span class="line">let pow2 = make_pow(2);</span><br><span class="line">let pow3 = make_pow(3);</span><br><span class="line"></span><br><span class="line">console.log(pow2(5)); // 25</span><br><span class="line">console.log(pow3(7)); // 343</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://weibo.com/liaoxuefeng"><img src="http://thirdqq.qlogo.cn/ek_qqapp/AQVJKMtqeFCGNEZqicOj7qb7mnpcJiaZNlEOf0iasx2DicuEycbIG9cQktWUBxWR1dFWfLMI2Ilt/100" alt=""></a></p>
<p><a target="_blank" rel="noopener" href="https://weibo.com/liaoxuefeng">廖雪峰</a><a target="_blank" rel="noopener" href="https://github.com/michaelliao"></a><a target="_blank" rel="noopener" href="https://weibo.com/liaoxuefeng"></a><a target="_blank" rel="noopener" href="https://zhihu.com/people/liaoxuefeng"></a><a target="_blank" rel="noopener" href="https://twitter.com/liaoxuefeng"></a><br>
资深软件开发工程师，业余马拉松选手。</p>
<p>ES6标准新增了一种新的函数：箭头函数（Arrow Function）。</p>
<p>为什么叫箭头函数？因为它的定义用的就是一个箭头：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x =&gt; x * x</span><br></pre></td></tr></table></figure>
<p>上面的箭头函数相当于：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在继续学习箭头函数之前，请测试你的浏览器是否支持ES6的Arrow Function：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let fn = x =&gt; x * x;</span><br><span class="line">console.log(&#x27;你的浏览器支持ES6的Arrow Function!&#x27;);</span><br></pre></td></tr></table></figure>
<p>箭头函数相当于匿名函数，并且简化了函数定义。箭头函数有两种格式，一种像上面的，只包含一个表达式，连<code>&#123; ... &#125;</code>和<code>return</code>都省略掉了。还有一种可以包含多条语句，这时候就不能省略<code>&#123; ... &#125;</code>和<code>return</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">x =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> x * x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> - x * x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果参数不是一个，就需要用括号<code>()</code>括起来：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 两个参数:</span></span><br><span class="line">(x, y) =&gt; x * x + y * y</span><br><span class="line"></span><br><span class="line"><span class="comment">// 无参数:</span></span><br><span class="line">() =&gt; <span class="number">3.14</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可变参数:</span></span><br><span class="line">(x, y, ...rest) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> i, sum = x + y;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;rest.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        sum += rest[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果要返回一个对象，就要注意，如果是单表达式，这么写的话会报错：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SyntaxError:</span></span><br><span class="line">x =&gt; &#123; <span class="attr">foo</span>: x &#125;</span><br></pre></td></tr></table></figure>
<p>因为和函数体的<code>&#123; ... &#125;</code>有语法冲突，所以要改为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ok:</span></span><br><span class="line">x =&gt; (&#123; <span class="attr">foo</span>: x &#125;)</span><br></pre></td></tr></table></figure>
<h3 id="this">this</h3>
<p>箭头函数看上去是匿名函数的一种简写，但实际上，箭头函数和匿名函数有个明显的区别：箭头函数内部的<code>this</code>是词法作用域，由上下文确定。</p>
<p>回顾前面的例子，由于JavaScript函数对<code>this</code>绑定的错误处理，下面的例子无法得到预期结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span>,</span><br><span class="line">    <span class="attr">getAge</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> b = <span class="variable language_">this</span>.<span class="property">birth</span>; <span class="comment">// 1990</span></span><br><span class="line">        <span class="keyword">let</span> fn = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>() - <span class="variable language_">this</span>.<span class="property">birth</span>; <span class="comment">// this指向window或undefined</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">fn</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>现在，箭头函数完全修复了<code>this</code>的指向，<code>this</code>总是指向词法作用域，也就是外层调用者<code>obj</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span>,</span><br><span class="line">    <span class="attr">getAge</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> b = <span class="variable language_">this</span>.<span class="property">birth</span>; <span class="comment">// 1990</span></span><br><span class="line">        <span class="keyword">let</span> <span class="title function_">fn</span> = (<span class="params"></span>) =&gt; <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>() - <span class="variable language_">this</span>.<span class="property">birth</span>; <span class="comment">// this指向obj对象</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">fn</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">obj.<span class="title function_">getAge</span>(); <span class="comment">// 25</span></span><br></pre></td></tr></table></figure>
<p>如果使用箭头函数，以前的那种hack写法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> that = <span class="variable language_">this</span>;</span><br></pre></td></tr></table></figure>
<p>就不再需要了。</p>
<p>由于<code>this</code>在箭头函数中已经按照词法作用域绑定了，所以，用<code>call()</code>或者<code>apply()</code>调用箭头函数时，无法对<code>this</code>进行绑定，即传入的第一个参数被忽略：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span>,</span><br><span class="line">    <span class="attr">getAge</span>: <span class="keyword">function</span> (<span class="params">year</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> b = <span class="variable language_">this</span>.<span class="property">birth</span>; <span class="comment">// 1990</span></span><br><span class="line">        <span class="keyword">let</span> <span class="title function_">fn</span> = (<span class="params">y</span>) =&gt; y - <span class="variable language_">this</span>.<span class="property">birth</span>; <span class="comment">// this.birth仍是1990</span></span><br><span class="line">        <span class="keyword">return</span> fn.<span class="title function_">call</span>(&#123;<span class="attr">birth</span>:<span class="number">2000</span>&#125;, year);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">obj.<span class="title function_">getAge</span>(<span class="number">2015</span>); <span class="comment">// 25</span></span><br></pre></td></tr></table></figure>
<h3 id="练习-4">练习</h3>
<p>请使用箭头函数简化排序时传入的函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let arr = [10, 20, 1, 2];</span><br><span class="line">arr.sort((x, y) =&gt; &#123;</span><br><span class="line">    ???</span><br><span class="line">&#125;);</span><br><span class="line">console.log(arr); // [1, 2, 10, 20]</span><br></pre></td></tr></table></figure>
<h2 id="标签函数">标签函数</h2>
<p><a target="_blank" rel="noopener" href="https://weibo.com/liaoxuefeng"><img src="http://thirdqq.qlogo.cn/ek_qqapp/AQVJKMtqeFCGNEZqicOj7qb7mnpcJiaZNlEOf0iasx2DicuEycbIG9cQktWUBxWR1dFWfLMI2Ilt/100" alt=""></a></p>
<p><a target="_blank" rel="noopener" href="https://weibo.com/liaoxuefeng">廖雪峰</a><a target="_blank" rel="noopener" href="https://github.com/michaelliao"></a><a target="_blank" rel="noopener" href="https://weibo.com/liaoxuefeng"></a><a target="_blank" rel="noopener" href="https://zhihu.com/people/liaoxuefeng"></a><a target="_blank" rel="noopener" href="https://twitter.com/liaoxuefeng"></a><br>
资深软件开发工程师，业余马拉松选手。</p>
<p>前面我们介绍了<a target="_blank" rel="noopener" href="https://liaoxuefeng.com/books/javascript/quick-start/string/index.html">模板字符串</a>，它可以非常方便地引用变量，并合并出最终的字符串：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let name = &#x27;小明&#x27;;</span><br><span class="line">let age = 20;</span><br><span class="line">let s = `你好, $&#123;name&#125;, 你今年$&#123;age&#125;岁了!`;</span><br><span class="line">console.log(s);</span><br></pre></td></tr></table></figure>
<p>对于模板字符串，除了方便引用变量构造字符串外，还有一种更强大的功能，即可以使用标签函数（Tag Function）。</p>
<p>什么是标签函数？让我们看一个例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const email = &quot;test@example.com&quot;;</span><br><span class="line">const password = &#x27;hello123&#x27;;</span><br><span class="line"></span><br><span class="line">function sql(strings, ...exps) &#123;</span><br><span class="line">    console.log(`SQL: $&#123;strings.join(&#x27;?&#x27;)&#125;`);</span><br><span class="line">    console.log(`SQL parameters: $&#123;JSON.stringify(exps)&#125;`);</span><br><span class="line">    return &#123;</span><br><span class="line">        name: &#x27;小明&#x27;,</span><br><span class="line">        age: 20</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const result = sql`SELECT * FROM users WHERE email=$&#123;email&#125; AND password=$&#123;password&#125;`;</span><br><span class="line"></span><br><span class="line">console.log(JSON.stringify(result));</span><br></pre></td></tr></table></figure>
<p>这里出现了一个奇怪的语法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sql<span class="string">`SELECT * FROM users WHERE email=<span class="subst">$&#123;email&#125;</span> AND password=<span class="subst">$&#123;password&#125;</span>`</span></span><br></pre></td></tr></table></figure>
<p>模板字符串前面以<code>sql</code>开头，实际上这是一个标签函数，上述语法会自动转换为对<code>sql()</code>函数的调用。我们关注的是，传入<code>sql()</code>函数的参数是什么。</p>
<p><code>sql()</code>函数实际上接收两个参数：</p>
<p>第一个参数<code>strings</code>是一个字符串数组，它是<code>[&quot;SELECT * FROM users WHERE email=&quot;, &quot; AND password=&quot;, &quot;&quot;]</code>，即除去<code>$&#123;xxx&#125;</code>剩下的字符组成的数组；</p>
<p>第二个参数<code>...exps</code>是一个可变参数，它接收的也是一个数组，但数组的内容是由模板字符串里所有的<code>$&#123;xxx&#125;</code>的实际值组成，即<code>[&quot;test@example.com&quot;, &quot;hello123&quot;]</code>，因为解析<code>$&#123;email&#125;</code>得到<code>&quot;test@example.com&quot;</code>，解析<code>$&#123;password&#125;</code>得到<code>&quot;hello123&quot;</code>。</p>
<p>标签函数<code>sql()</code>实际上是一个普通函数，我们在内部把<code>strings</code>拼接成一个SQL字符串，把<code>...exps</code>作为参数，就可以实现一个安全的SQL查询，并返回查询结果。此处并没有真正的数据库连接，因此返回一个固定的Object。</p>
<p>标签函数和普通函数的定义区别仅仅在于参数，如果我们想对数据库进行修改，完全可以定义一个标签函数如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">update</span>(<span class="params">strings, ...exps</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> sql = strings.<span class="title function_">join</span>(<span class="string">&#x27;?&#x27;</span>);</span><br><span class="line">    <span class="comment">// 执行数据库更新</span></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>函数调用可以简化为带标签的模板字符串：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> id = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">let</span> age = <span class="number">21</span>;</span><br><span class="line"><span class="keyword">let</span> score = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line"></span><br><span class="line">update<span class="string">`UPDATE users SET age=<span class="subst">$&#123;age&#125;</span>, score=<span class="subst">$&#123;score&#125;</span> WHERE id=<span class="subst">$&#123;id&#125;</span>`</span>;</span><br></pre></td></tr></table></figure>
<p>是不是非常简洁？</p>
<hr>
<hr>
<p><a target="_blank" rel="noopener" href="https://weibo.com/liaoxuefeng"><img src="http://thirdqq.qlogo.cn/ek_qqapp/AQVJKMtqeFCGNEZqicOj7qb7mnpcJiaZNlEOf0iasx2DicuEycbIG9cQktWUBxWR1dFWfLMI2Ilt/100" alt=""></a></p>
<p><a target="_blank" rel="noopener" href="https://weibo.com/liaoxuefeng">廖雪峰</a><a target="_blank" rel="noopener" href="https://github.com/michaelliao"></a><a target="_blank" rel="noopener" href="https://weibo.com/liaoxuefeng"></a><a target="_blank" rel="noopener" href="https://zhihu.com/people/liaoxuefeng"></a><a target="_blank" rel="noopener" href="https://twitter.com/liaoxuefeng"></a><br>
资深软件开发工程师，业余马拉松选手。</p>
<p>生成器（generator）是ES6标准引入的新的数据类型。一个生成器看上去像一个函数，但可以返回多次。</p>
<p>ES6定义生成器标准的哥们借鉴了Python的generator的概念和语法，如果你对Python的generator很熟悉，那么ES6的generator就是小菜一碟了。如果你对Python还不熟，赶快恶补<a target="_blank" rel="noopener" href="https://liaoxuefeng.com/books/python/index.html">Python教程</a>！。</p>
<p>我们先复习函数的概念。一个函数是一段完整的代码，调用一个函数就是传入参数，然后返回结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x + x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> r = <span class="title function_">foo</span>(<span class="number">1</span>); <span class="comment">// 调用foo函数</span></span><br></pre></td></tr></table></figure>
<p>函数在执行过程中，如果没有遇到<code>return</code>语句（函数末尾如果没有<code>return</code>，就是隐含的<code>return undefined;</code>），控制权无法交回被调用的代码。</p>
<p>generator跟函数很像，定义如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">foo</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">yield</span> x + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">yield</span> x + <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> x + <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>generator和函数不同的是，generator由<code>function*</code>定义（注意多出的<code>*</code>号），并且，除了<code>return</code>语句，还可以用<code>yield</code>返回多次。</p>
<p>大多数同学立刻就晕了，generator就是能够返回多次的“函数”？返回多次有啥用？</p>
<p>还是举个栗子吧。</p>
<p>我们以一个著名的斐波那契数列为例，它由<code>0</code>，<code>1</code>开头：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">8</span> <span class="number">13</span> <span class="number">21</span> <span class="number">34</span> ...</span><br></pre></td></tr></table></figure>
<p>要编写一个产生斐波那契数列的函数，可以这么写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fib</span>(<span class="params">max</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span></span><br><span class="line">        t,</span><br><span class="line">        a = <span class="number">0</span>,</span><br><span class="line">        b = <span class="number">1</span>,</span><br><span class="line">        arr = [<span class="number">0</span>, <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">while</span> (arr.<span class="property">length</span> &lt; max) &#123;</span><br><span class="line">        [a, b] = [b, a + b];</span><br><span class="line">        arr.<span class="title function_">push</span>(b);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试:</span></span><br><span class="line"><span class="title function_">fib</span>(<span class="number">5</span>); <span class="comment">// [0, 1, 1, 2, 3]</span></span><br><span class="line"><span class="title function_">fib</span>(<span class="number">10</span>); <span class="comment">// [0, 1, 1, 2, 3, 5, 8, 13, 21, 34]</span></span><br></pre></td></tr></table></figure>
<p>函数只能返回一次，所以必须返回一个<code>Array</code>。但是，如果换成generator，就可以一次返回一个数，不断返回多次。用generator改写如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">fib</span>(<span class="params">max</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span></span><br><span class="line">        t,</span><br><span class="line">        a = <span class="number">0</span>,</span><br><span class="line">        b = <span class="number">1</span>,</span><br><span class="line">        n = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (n &lt; max) &#123;</span><br><span class="line">        <span class="keyword">yield</span> a;</span><br><span class="line">        [a, b] = [b, a + b];</span><br><span class="line">        n ++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>直接调用试试：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fib</span>(<span class="number">5</span>); <span class="comment">// fib &#123;[[GeneratorStatus]]: &quot;suspended&quot;, [[GeneratorReceiver]]: Window&#125;</span></span><br></pre></td></tr></table></figure>
<p>直接调用一个generator和调用函数不一样，<code>fib(5)</code>仅仅是创建了一个generator对象，还没有去执行它。</p>
<p>调用generator对象有两个方法，一是不断地调用generator对象的<code>next()</code>方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> f = <span class="title function_">fib</span>(<span class="number">5</span>);</span><br><span class="line">f.<span class="title function_">next</span>(); <span class="comment">// &#123;value: 0, done: false&#125;</span></span><br><span class="line">f.<span class="title function_">next</span>(); <span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line">f.<span class="title function_">next</span>(); <span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line">f.<span class="title function_">next</span>(); <span class="comment">// &#123;value: 2, done: false&#125;</span></span><br><span class="line">f.<span class="title function_">next</span>(); <span class="comment">// &#123;value: 3, done: false&#125;</span></span><br><span class="line">f.<span class="title function_">next</span>(); <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>
<p><code>next()</code>方法会执行generator的代码，然后，每次遇到<code>yield x;</code>就返回一个对象<code>&#123;value: x, done: true/false&#125;</code>，然后“暂停”。返回的<code>value</code>就是<code>yield</code>的返回值，<code>done</code>表示这个generator是否已经执行结束了。如果<code>done</code>为<code>true</code>，则<code>value</code>就是<code>return</code>的返回值。</p>
<p>当执行到<code>done</code>为<code>true</code>时，这个generator对象就已经全部执行完毕，不要再继续调用<code>next()</code>了。</p>
<p>第二个方法是直接用<code>for ... of</code>循环迭代generator对象，这种方式不需要我们自己判断<code>done</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function* fib(max) &#123;</span><br><span class="line">    let</span><br><span class="line">        a = 0,</span><br><span class="line">        b = 1,</span><br><span class="line">        n = 0;</span><br><span class="line">    while (n &lt; max) &#123;</span><br><span class="line">        yield a;</span><br><span class="line">        [a, b] = [b, a + b];</span><br><span class="line">        n ++;</span><br><span class="line">    &#125;</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">for (let x of fib(10)) &#123;</span><br><span class="line">    console.log(x); // 依次输出0, 1, 1, 2, 3, ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>generator和普通函数相比，有什么用？</p>
<p>因为generator可以在执行过程中多次返回，所以它看上去就像一个可以记住执行状态的函数，利用这一点，写一个generator就可以实现需要用面向对象才能实现的功能。例如，用一个对象来保存状态，得这么写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fib = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">b</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">n</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">max</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">next</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span></span><br><span class="line">            r = <span class="variable language_">this</span>.<span class="property">a</span>,</span><br><span class="line">            t = <span class="variable language_">this</span>.<span class="property">a</span> + <span class="variable language_">this</span>.<span class="property">b</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">a</span> = <span class="variable language_">this</span>.<span class="property">b</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">b</span> = t;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">n</span> &lt; <span class="variable language_">this</span>.<span class="property">max</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">n</span> ++;</span><br><span class="line">            <span class="keyword">return</span> r;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>用对象的属性来保存状态，相当繁琐。</p>
<p>generator还有另一个巨大的好处，就是把异步回调代码变成“同步”代码。这个好处要等到后面学了AJAX以后才能体会到。</p>
<p>没有generator之前的黑暗时代，用AJAX时需要这么写代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">ajax</span>(<span class="string">&#x27;http://url-1&#x27;</span>, data1, <span class="keyword">function</span> (<span class="params">err, result</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">handle</span>(err);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">ajax</span>(<span class="string">&#x27;http://url-2&#x27;</span>, data2, <span class="keyword">function</span> (<span class="params">err, result</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">handle</span>(err);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">ajax</span>(<span class="string">&#x27;http://url-3&#x27;</span>, data3, <span class="keyword">function</span> (<span class="params">err, result</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">handle</span>(err);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">success</span>(result);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>回调越多，代码越难看。</p>
<p>有了generator的美好时代，用AJAX时可以这么写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    r1 = <span class="keyword">yield</span> <span class="title function_">ajax</span>(<span class="string">&#x27;http://url-1&#x27;</span>, data1);</span><br><span class="line">    r2 = <span class="keyword">yield</span> <span class="title function_">ajax</span>(<span class="string">&#x27;http://url-2&#x27;</span>, data2);</span><br><span class="line">    r3 = <span class="keyword">yield</span> <span class="title function_">ajax</span>(<span class="string">&#x27;http://url-3&#x27;</span>, data3);</span><br><span class="line">    <span class="title function_">success</span>(r3);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="title function_">handle</span>(err);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看上去是同步的代码，实际执行是异步的。</p>
<h3 id="练习-5">练习</h3>
<p>要生成一个自增的ID，可以编写一个<code>next_id()</code>函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> current_id = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">next_id</span>(<span class="params"></span>) &#123;</span><br><span class="line">    current_id ++;</span><br><span class="line">    <span class="keyword">return</span> current_id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于函数无法保存状态，故需要一个全局变量<code>current_id</code>来保存数字。</p>
<p>不用闭包，试用generator改写：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function* next_id() &#123;</span><br><span class="line">    ???</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 测试:</span><br><span class="line">let</span><br><span class="line">    x,</span><br><span class="line">    pass = true,</span><br><span class="line">    g = next_id();</span><br><span class="line">for (x = 1; x &lt; 100; x ++) &#123;</span><br><span class="line">    if (g.next().value !== x) &#123;</span><br><span class="line">        pass = false;</span><br><span class="line">        console.log(&#x27;测试失败!&#x27;);</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if (pass) &#123;</span><br><span class="line">    console.log(&#x27;测试通过!&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../../2024/01/11/JavaScript/JavaScript-%E5%87%BD%E6%95%B0/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../../2024/01/10/JavaScript/JavaScript-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"
                            aria-label=": JavaScript-快速入门"
                        >
                            JavaScript-快速入门
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2024-01-10T20:56:13+08:00">
	
		    2024 年 1 月 10 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../../categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a>, <a class="category-link" href="../../../categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/JavaScript/">JavaScript</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>JavaScript代码可以直接嵌在网页的任何地方，不过通常我们都把JavaScript代码放到<code>&lt;head&gt;</code>中：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">alert</span>(<span class="string">&#x27;Hello, world&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>由<code>&lt;script&gt;...&lt;/script&gt;</code>包含的代码就是JavaScript代码，它将直接被浏览器执行。</p>
<p>第二种方法是把JavaScript代码放到一个单独的<code>.js</code>文件，然后在HTML中通过<code>&lt;script src=&quot;...&quot;&gt;&lt;/script&gt;</code>引入这个文件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/js/abc.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样，<code>/static/js/abc.js</code>就会被浏览器执行。</p>
<p>把JavaScript代码放入一个单独的<code>.js</code>文件中更利于维护代码，并且多个页面可以各自引用同一份<code>.js</code>文件。</p>
<p>可以在同一个页面中引入多个<code>.js</code>文件，还可以在页面中多次编写<code>&lt;script&gt; js代码... &lt;/script&gt;</code>，浏览器按照顺序依次执行。</p>
<p>有些时候你会看到<code>&lt;script&gt;</code>标签还设置了一个<code>type</code>属性：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>但这是没有必要的，因为默认的<code>type</code>就是JavaScript，所以不必显式地把<code>type</code>指定为JavaScript。</p>
<h3 id="如何编写JavaScript">如何编写JavaScript</h3>
<p>可以用任何文本编辑器来编写JavaScript代码。这里我们推荐以下几种文本编辑器：</p>
<h4 id="Visual-Studio-Code">Visual Studio Code</h4>
<p>微软出的<a target="_blank" rel="noopener" href="https://code.visualstudio.com/">Visual Studio Code</a>，可以看做迷你版Visual Studio，免费，跨平台，内置JavaScript支持，强烈推荐使用！</p>
<h4 id="Sublime-Text">Sublime Text</h4>
<p><a target="_blank" rel="noopener" href="https://www.sublimetext.com/">Sublime Text</a>是一个好用的文本编辑器，免费，但不注册会不定时弹出提示框。</p>
<p><em>注意</em>：不可以用Word或写字板来编写JavaScript或HTML，因为带格式的文本保存后不是<em>纯文本文件</em>，无法被浏览器正常读取。也尽量不要用记事本编写，它会自作聪明地在保存UTF-8格式文本时添加BOM头。</p>
<h3 id="如何运行JavaScript">如何运行JavaScript</h3>
<p>要让浏览器运行JavaScript，必须先有一个HTML页面，在HTML页面中引入JavaScript，然后，让浏览器加载该HTML页面，就可以执行JavaScript代码。</p>
<p>你也许会想，直接在我的硬盘上创建好HTML和JavaScript文件，然后用浏览器打开，不就可以看到效果了吗？</p>
<p>这种方式运行部分JavaScript代码没有问题，但由于浏览器的安全限制，以<code>file://</code>开头的地址无法执行如联网等JavaScript代码，最终，你还是需要架设一个Web服务器，然后以<code>http://</code>开头的地址来正常执行所有JavaScript代码。</p>
<p>不过，开始学习阶段，你无须关心如何搭建开发环境的问题，我们提供在页面输入JavaScript代码并直接运行的功能，让你专注于JavaScript的学习。</p>
<p>试试直接点击“Run”按钮执行下面的JavaScript代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 以双斜杠开头直到行末的是注释，注释是给人看的，会被浏览器忽略</span><br><span class="line">/* 在这中间的也是注释，将被浏览器忽略 */</span><br><span class="line">// 第一个JavaScript代码:</span><br><span class="line"></span><br><span class="line">alert(&#x27;Hello, world&#x27;); // 观察执行效果</span><br></pre></td></tr></table></figure>
<p>浏览器将弹出一个对话框，显示“Hello, world”。你也可以修改两个单引号中间的内容，再试着运行。</p>
<h3 id="调试">调试</h3>
<p>俗话说得好，“工欲善其事，必先利其器。”，写JavaScript的时候，如果期望显示<code>ABC</code>，结果却显示<code>XYZ</code>，到底代码哪里出了问题？不要抓狂，也不要泄气，作为小白，要坚信：JavaScript本身没有问题，浏览器执行也没有问题，有问题的一定是我的代码。</p>
<p>如何找出问题代码？这就需要调试。</p>
<p>怎么在浏览器中调试JavaScript代码呢？</p>
<p>首先，你需要安装Google Chrome浏览器，Chrome浏览器对开发者非常友好，可以让你方便地调试JavaScript代码。从这里<a target="_blank" rel="noopener" href="https://www.google.com/chrome/?system=true&amp;standalone=1">下载Chrome浏览器</a>。打开网页出问题的童鞋请移步<a target="_blank" rel="noopener" href="https://www.google.cn/chrome/?system=true&amp;standalone=1">国内镜像</a>。</p>
<p>安装后，随便打开一个网页，然后点击菜单“查看(View)”-“开发者(Developer)”-“开发者工具(Developer Tools)”，浏览器窗口就会一分为二，下方就是开发者工具：</p>
<p><img src="https://liaoxuefeng.com/books/javascript/quick-start/dev-tools.jpg" alt="chrome dev tools"></p>
<p>先点击“控制台(Console)“，在这个面板里可以直接输入JavaScript代码，按回车后执行。</p>
<p>要查看一个变量的内容，在Console中输入<code>console.log(a);</code>，回车后显示的值就是变量的内容。</p>
<p>关闭Console请点击右上角的“×”按钮。请熟练掌握Console的使用方法，在编写JavaScript代码时，经常需要在Console运行测试代码。</p>
<p>如果你对自己还有更高的要求，可以研究开发者工具的“源码(Sources)”，掌握断点、单步执行等高级调试技巧。</p>
<h3 id="练习">练习</h3>
<p>打开<a target="_blank" rel="noopener" href="http://www.sina.com.cn/">新浪首页</a>，然后查看页面源代码，找一找引入的JavaScript文件和直接编写在页面中的JavaScript代码。然后在Chrome中打开开发者工具，在控制台输入<code>console.log('Hello');</code>，回车查看JavaScript代码执行结果。</p>
<h2 id="基本语法">基本语法</h2>
<p>JavaScript的语法和Java语言类似，每个语句以<code>;</code>结束，语句块用<code>&#123;...&#125;</code>。但是，JavaScript并不强制要求在每个语句的结尾加<code>;</code>，浏览器中负责执行JavaScript代码的引擎会自动在每个语句的结尾补上<code>;</code>。</p>
<p>提示</p>
<p>让JavaScript引擎自动加分号在某些情况下会改变程序的语义，导致运行结果与期望不一致。在本教程中，我们不会省略;，所有语句都会添加;。</p>
<p>例如，下面的一行代码就是一个完整的赋值语句：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>下面的一行代码是一个字符串，但仍然可以视为一个完整的语句：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;Hello, world&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>下面的一行代码包含两个语句，每个语句用<code>;</code>表示语句结束：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>; <span class="keyword">var</span> y = <span class="number">2</span>; <span class="comment">// 不建议一行写多个语句!</span></span><br></pre></td></tr></table></figure>
<p>语句块是一组语句的集合，例如，下面的代码先做了一个判断，如果判断成立，将执行<code>&#123;...&#125;</code>中的所有语句：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="number">2</span> &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    x = <span class="number">1</span>;</span><br><span class="line">    y = <span class="number">2</span>;</span><br><span class="line">    z = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意花括号<code>&#123;...&#125;</code>内的语句具有缩进，通常是4个空格。缩进不是JavaScript语法要求必须的，但缩进有助于我们理解代码的层次，所以编写代码时要遵守缩进规则。很多文本编辑器具有“自动缩进”的功能，可以帮助整理代码。</p>
<p><code>&#123;...&#125;</code>还可以嵌套，形成层级结构：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="number">2</span> &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    x = <span class="number">1</span>;</span><br><span class="line">    y = <span class="number">2</span>;</span><br><span class="line">    z = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; y) &#123;</span><br><span class="line">        z = <span class="number">4</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; y) &#123;</span><br><span class="line">        z = <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JavaScript本身对嵌套的层级没有限制，但是过多的嵌套无疑会大大增加看懂代码的难度。遇到这种情况，需要把部分代码抽出来，作为函数来调用，这样可以减少代码的复杂度。</p>
<h3 id="注释">注释</h3>
<p>以<code>//</code>开头直到行末的字符被视为行注释，注释是给开发人员看到，JavaScript引擎会自动忽略：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这是一行注释</span></span><br><span class="line"><span class="title function_">alert</span>(<span class="string">&#x27;hello&#x27;</span>); <span class="comment">// 这也是注释</span></span><br></pre></td></tr></table></figure>
<p>另一种块注释是用<code>/*...*/</code>把多行字符包裹起来，把一大“块”视为一个注释：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 从这里开始是块注释</span></span><br><span class="line"><span class="comment">仍然是注释</span></span><br><span class="line"><span class="comment">仍然是注释</span></span><br><span class="line"><span class="comment">注释结束 */</span></span><br></pre></td></tr></table></figure>
<h3 id="练习-2">练习</h3>
<p>分别利用行注释和块注释把下面的语句注释掉，使它不再执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 请注释掉下面的语句:</span><br><span class="line">alert(&#x27;我不想执行&#x27;);</span><br><span class="line">alert(&#x27;我也不想执行&#x27;);</span><br></pre></td></tr></table></figure>
<h3 id="大小写">大小写</h3>
<p>请注意，JavaScript严格区分大小写，如果弄错了大小写，程序将报错或者运行不正常。</p>
<hr>
<hr>
<h3 id="数据类型">数据类型</h3>
<p>计算机顾名思义就是可以做数学计算的机器，因此，计算机程序理所当然地可以处理各种数值。但是，计算机能处理的远不止数值，还可以处理文本、图形、音频、视频、网页等各种各样的数据，不同的数据，需要定义不同的数据类型。在JavaScript中定义了以下几种数据类型：</p>
<h4 id="Number">Number</h4>
<p>JavaScript不区分整数和浮点数，统一用Number表示，以下都是合法的Number类型：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">123</span>; <span class="comment">// 整数123</span></span><br><span class="line"><span class="number">0.456</span>; <span class="comment">// 浮点数0.456</span></span><br><span class="line"><span class="number">1.2345e3</span>; <span class="comment">// 科学计数法表示1.2345x1000，等同于1234.5</span></span><br><span class="line">-<span class="number">99</span>; <span class="comment">// 负数</span></span><br><span class="line"><span class="title class_">NaN</span>; <span class="comment">// NaN表示Not a Number，当无法计算结果时用NaN表示</span></span><br><span class="line"><span class="title class_">Infinity</span>; <span class="comment">// Infinity表示无限大，当数值超过了JavaScript的Number所能表示的最大值时，就表示为Infinity</span></span><br></pre></td></tr></table></figure>
<p>计算机由于使用二进制，所以，有时候用十六进制表示整数比较方便，十六进制用0x前缀和0-9，a-f表示，例如：<code>0xff00</code>，<code>0xa5b4c3d2</code>，等等，它们和十进制表示的数值完全一样。</p>
<p>Number可以直接做四则运算，规则和数学一致：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> + <span class="number">2</span>; <span class="comment">// 3</span></span><br><span class="line">(<span class="number">1</span> + <span class="number">2</span>) * <span class="number">5</span> / <span class="number">2</span>; <span class="comment">// 7.5</span></span><br><span class="line"><span class="number">2</span> / <span class="number">0</span>; <span class="comment">// Infinity</span></span><br><span class="line"><span class="number">0</span> / <span class="number">0</span>; <span class="comment">// NaN</span></span><br><span class="line"><span class="number">10</span> % <span class="number">3</span>; <span class="comment">// 1</span></span><br><span class="line"><span class="number">10.5</span> % <span class="number">3</span>; <span class="comment">// 1.5</span></span><br></pre></td></tr></table></figure>
<p>注意<code>%</code>是求余运算。</p>
<p>要注意，JavaScript的Number不区分整数和浮点数，也就是说，<code>12.00 === 12</code>。（在大多数其他语言中，整数和浮点数不能直接比较）并且，JavaScript的整数最大范围不是±263，而是±253，因此，超过253的整数就可能无法精确表示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 计算圆面积:</span><br><span class="line">var r = 123.456;</span><br><span class="line">var s = 3.14 * r * r;</span><br><span class="line">console.log(s); // 47857.94555904001</span><br><span class="line"></span><br><span class="line">// 打印Number能表示的最大整数:</span><br><span class="line">console.log(Number.MAX_SAFE_INTEGER); // 9007199254740991</span><br></pre></td></tr></table></figure>
<h4 id="字符串">字符串</h4>
<p>字符串是以单引号’或双引号&quot;括起来的任意文本，比如<code>'abc'</code>，<code>&quot;xyz&quot;</code>等等。请注意，<code>''</code>或<code>&quot;&quot;</code>本身只是一种表示方式，不是字符串的一部分，因此，字符串<code>'abc'</code>只有<code>a</code>，<code>b</code>，<code>c</code>这3个字符。</p>
<h4 id="布尔值">布尔值</h4>
<p>布尔值和布尔代数的表示完全一致，一个布尔值只有<code>true</code>、<code>false</code>两种值，要么是<code>true</code>，要么是<code>false</code>，可以直接用<code>true</code>、<code>false</code>表示布尔值，也可以通过布尔运算计算出来：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">true</span>; <span class="comment">// 这是一个true值</span></span><br><span class="line"><span class="literal">false</span>; <span class="comment">// 这是一个false值</span></span><br><span class="line"><span class="number">2</span> &gt; <span class="number">1</span>; <span class="comment">// 这是一个true值</span></span><br><span class="line"><span class="number">2</span> &gt;= <span class="number">3</span>; <span class="comment">// 这是一个false值</span></span><br></pre></td></tr></table></figure>
<p><code>&amp;&amp;</code>运算是与运算，只有所有都为<code>true</code>，<code>&amp;&amp;</code>运算结果才是<code>true</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">true</span> &amp;&amp; <span class="literal">true</span>; <span class="comment">// 这个&amp;&amp;语句计算结果为true</span></span><br><span class="line"><span class="literal">true</span> &amp;&amp; <span class="literal">false</span>; <span class="comment">// 这个&amp;&amp;语句计算结果为false</span></span><br><span class="line"><span class="literal">false</span> &amp;&amp; <span class="literal">true</span> &amp;&amp; <span class="literal">false</span>; <span class="comment">// 这个&amp;&amp;语句计算结果为false</span></span><br></pre></td></tr></table></figure>
<p><code>||</code>运算是或运算，只要其中有一个为<code>true</code>，<code>||</code>运算结果就是<code>true</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">false</span> || <span class="literal">false</span>; <span class="comment">// 这个||语句计算结果为false</span></span><br><span class="line"><span class="literal">true</span> || <span class="literal">false</span>; <span class="comment">// 这个||语句计算结果为true</span></span><br><span class="line"><span class="literal">false</span> || <span class="literal">true</span> || <span class="literal">false</span>; <span class="comment">// 这个||语句计算结果为true</span></span><br></pre></td></tr></table></figure>
<p><code>!</code>运算是非运算，它是一个单目运算符，把<code>true</code>变成<code>false</code>，<code>false</code>变成<code>true</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">! <span class="literal">true</span>; <span class="comment">// 结果为false</span></span><br><span class="line">! <span class="literal">false</span>; <span class="comment">// 结果为true</span></span><br><span class="line">! (<span class="number">2</span> &gt; <span class="number">5</span>); <span class="comment">// 结果为true</span></span><br></pre></td></tr></table></figure>
<p>布尔值经常用在条件判断中，比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> age = <span class="number">15</span>;</span><br><span class="line"><span class="keyword">if</span> (age &gt;= <span class="number">18</span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;adult&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;teenager&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="比较运算符">比较运算符</h3>
<p>当我们对Number做比较时，可以通过比较运算符得到一个布尔值：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span> &gt; <span class="number">5</span>; <span class="comment">// false</span></span><br><span class="line"><span class="number">5</span> &gt;= <span class="number">2</span>; <span class="comment">// true</span></span><br><span class="line"><span class="number">7</span> == <span class="number">7</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>实际上，JavaScript允许对任意数据类型做比较：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">false</span> == <span class="number">0</span>; <span class="comment">// true</span></span><br><span class="line"><span class="literal">false</span> === <span class="number">0</span>; <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>要特别注意相等运算符<code>==</code>。JavaScript在设计时，有两种比较运算符：</p>
<p>第一种是<code>==</code>比较，它会自动转换数据类型再比较，很多时候，会得到非常诡异的结果；</p>
<p>第二种是<code>===</code>比较，它不会自动转换数据类型，如果数据类型不一致，返回<code>false</code>，如果一致，再比较。</p>
<p>由于JavaScript这个设计缺陷，<em>不要</em>使用<code>==</code>比较，始终坚持使用<code>===</code>比较。</p>
<p>另一个例外是<code>NaN</code>这个特殊的Number与所有其他值都不相等，包括它自己：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">NaN</span> === <span class="title class_">NaN</span>; <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>唯一能判断<code>NaN</code>的方法是通过<code>isNaN()</code>函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">isNaN</span>(<span class="title class_">NaN</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>最后要注意浮点数的相等比较：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> / <span class="number">3</span> === (<span class="number">1</span> - <span class="number">2</span> / <span class="number">3</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>这不是JavaScript的设计缺陷。浮点数在运算过程中会产生误差，因为计算机无法精确表示无限循环小数。要比较两个浮点数是否相等，只能计算它们之差的绝对值，看是否小于某个阈值：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="number">1</span> / <span class="number">3</span> - (<span class="number">1</span> - <span class="number">2</span> / <span class="number">3</span>)) &lt; <span class="number">0.0000001</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h4 id="BigInt">BigInt</h4>
<p>要精确表示比253还大的整数，可以使用内置的BigInt类型，它的表示方法是在整数后加一个<code>n</code>，例如<code>9223372036854775808n</code>，也可以使用<code>BigInt()</code>把Number和字符串转换成BigInt：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 使用BigInt:</span><br><span class="line">var bi1 = 9223372036854775807n;</span><br><span class="line">var bi2 = BigInt(12345);</span><br><span class="line">var bi3 = BigInt(&quot;0x7fffffffffffffff&quot;);</span><br><span class="line">console.log(bi1 === bi2); // false</span><br><span class="line">console.log(bi1 === bi3); // true</span><br><span class="line">console.log(bi1 + bi2);</span><br></pre></td></tr></table></figure>
<p>使用BigInt可以正常进行加减乘除等运算，结果仍然是一个BigInt，但不能把一个BigInt和一个Number放在一起运算：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 使用BigInt:</span><br><span class="line">console.log(1234567n + 3456789n); // OK</span><br><span class="line">console.log(1234567n / 789n); // 1564, 除法运算结果仍然是BigInt</span><br><span class="line">console.log(1234567n % 789n); // 571, 求余</span><br><span class="line">console.log(1234567n + 3456789); // Uncaught TypeError: Cannot mix BigInt and other types</span><br></pre></td></tr></table></figure>
<h4 id="null和undefined">null和undefined</h4>
<p><code>null</code>表示一个“空”的值，它和<code>0</code>以及空字符串<code>''</code>不同，<code>0</code>是一个数值，<code>''</code>表示长度为0的字符串，而<code>null</code>表示“空”。</p>
<p>在其他语言中，也有类似JavaScript的<code>null</code>的表示，例如Java也用<code>null</code>，Swift用<code>nil</code>，Python用<code>None</code>表示。但是，在JavaScript中，还有一个和<code>null</code>类似的<code>undefined</code>，它表示“未定义”。</p>
<p>JavaScript的设计者希望用<code>null</code>表示一个空的值，而<code>undefined</code>表示值未定义。事实证明，这并没有什么卵用，区分两者的意义不大。大多数情况下，我们都应该用<code>null</code>。<code>undefined</code>仅仅在判断函数参数是否传递的情况下有用。</p>
<h4 id="数组">数组</h4>
<p>数组是一组按顺序排列的集合，集合的每个值称为元素。JavaScript的数组可以包括任意数据类型。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3.14</span>, <span class="string">&#x27;Hello&#x27;</span>, <span class="literal">null</span>, <span class="literal">true</span>];</span><br></pre></td></tr></table></figure>
<p>上述数组包含6个元素。数组用<code>[]</code>表示，元素之间用<code>,</code>分隔。</p>
<p>另一种创建数组的方法是通过<code>Array()</code>函数实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>); <span class="comment">// 创建了数组[1, 2, 3]</span></span><br></pre></td></tr></table></figure>
<p>然而，出于代码的可读性考虑，强烈建议直接使用<code>[]</code>。</p>
<p>数组的元素可以通过索引来访问。请注意，索引的起始值为<code>0</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1, 2, 3.14, &#x27;Hello&#x27;, null, true];</span><br><span class="line">arr[0]; // 返回索引为0的元素，即1</span><br><span class="line">arr[5]; // 返回索引为5的元素，即true</span><br><span class="line">arr[6]; // 索引超出了范围，返回undefined</span><br><span class="line">console.log(arr[0], arr[5], arr[6]);</span><br></pre></td></tr></table></figure>
<h4 id="对象">对象</h4>
<p>JavaScript的对象是一组由键-值组成的无序集合，例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Bob&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">tags</span>: [<span class="string">&#x27;js&#x27;</span>, <span class="string">&#x27;web&#x27;</span>, <span class="string">&#x27;mobile&#x27;</span>],</span><br><span class="line">    <span class="attr">city</span>: <span class="string">&#x27;Beijing&#x27;</span>,</span><br><span class="line">    <span class="attr">hasCar</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">zipcode</span>: <span class="literal">null</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>JavaScript对象的键都是字符串类型，值可以是任意数据类型。上述<code>person</code>对象一共定义了6个键值对，其中每个键又称为对象的属性，例如，<code>person</code>的<code>name</code>属性为<code>'Bob'</code>，<code>zipcode</code>属性为<code>null</code>。</p>
<p>要获取一个对象的属性，我们用<code>对象变量.属性名</code>的方式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">person.<span class="property">name</span>; <span class="comment">// &#x27;Bob&#x27;</span></span><br><span class="line">person.<span class="property">zipcode</span>; <span class="comment">// null</span></span><br></pre></td></tr></table></figure>
<h3 id="变量">变量</h3>
<p>变量的概念基本上和初中代数的方程变量是一致的，只是在计算机程序中，变量不仅可以是数字，还可以是任意数据类型。</p>
<p>变量在JavaScript中就是用一个变量名表示，变量名是大小写英文、数字、<code>$</code>和<code>_</code>的组合，且不能用数字开头。变量名也不能是JavaScript的关键字，如<code>if</code>、<code>while</code>等。申明一个变量用<code>var</code>语句，比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a; <span class="comment">// 申明了变量a，此时a的值为undefined</span></span><br><span class="line"><span class="keyword">var</span> $b = <span class="number">1</span>; <span class="comment">// 申明了变量$b，同时给$b赋值，此时$b的值为1</span></span><br><span class="line"><span class="keyword">var</span> s_007 = <span class="string">&#x27;007&#x27;</span>; <span class="comment">// s_007是一个字符串</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Answer</span> = <span class="literal">true</span>; <span class="comment">// Answer是一个布尔值true</span></span><br><span class="line"><span class="keyword">var</span> t = <span class="literal">null</span>; <span class="comment">// t的值是null</span></span><br></pre></td></tr></table></figure>
<p>变量名也可以用中文，但是，请不要给自己找麻烦。</p>
<p>在JavaScript中，使用等号<code>=</code>对变量进行赋值。可以把任意数据类型赋值给变量，同一个变量可以反复赋值，而且可以是不同类型的变量，但是要注意只能用<code>var</code>申明一次，例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">123</span>; <span class="comment">// a的值是整数123</span></span><br><span class="line">a = <span class="string">&#x27;ABC&#x27;</span>; <span class="comment">// a变为字符串</span></span><br></pre></td></tr></table></figure>
<p>这种变量本身类型不固定的语言称之为动态语言，与之对应的是静态语言。静态语言在定义变量时必须指定变量类型，如果赋值的时候类型不匹配，就会报错。例如Java是静态语言，赋值语句如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">123</span>; <span class="comment">// a是整数类型变量，类型用int申明</span></span><br><span class="line">a = <span class="string">&quot;ABC&quot;</span>; <span class="comment">// 错误：不能把字符串赋给整型变量</span></span><br></pre></td></tr></table></figure>
<p>和静态语言相比，动态语言更灵活，就是这个原因。</p>
<p>请不要把赋值语句的等号等同于数学的等号。比如下面的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">10</span>;</span><br><span class="line">x = x + <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<p>如果从数学上理解<code>x = x + 2</code>那无论如何是不成立的，在程序中，赋值语句先计算右侧的表达式<code>x + 2</code>，得到结果<code>12</code>，再赋给变量<code>x</code>。由于<code>x</code>之前的值是<code>10</code>，重新赋值后，<code>x</code>的值变成<code>12</code>。</p>
<p>要显示变量的内容，可以用<code>console.log(x)</code>，打开Chrome的控制台就可以看到结果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 打印变量x</span><br><span class="line">var x = 100;</span><br><span class="line">console.log(x);</span><br></pre></td></tr></table></figure>
<p>使用<code>console.log()</code>代替<code>alert()</code>的好处是可以避免弹出烦人的对话框。</p>
<h3 id="strict模式">strict模式</h3>
<p>JavaScript在设计之初，为了方便初学者学习，并不强制要求用<code>var</code>申明变量。这个设计错误带来了严重的后果：如果一个变量没有通过<code>var</code>申明就被使用，那么该变量就自动被申明为全局变量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">10</span>; <span class="comment">// i现在是全局变量</span></span><br></pre></td></tr></table></figure>
<p>在同一个页面的不同的JavaScript文件中，如果都不用<code>var</code>申明，恰好都使用了变量<code>i</code>，将造成变量<code>i</code>互相影响，产生难以调试的错误结果。</p>
<p>使用<code>var</code>申明的变量则不是全局变量，它的范围被限制在该变量被申明的函数体内（函数的概念将稍后讲解），同名变量在不同的函数体内互不冲突。</p>
<p>为了修补JavaScript这一严重设计缺陷，ECMA在后续规范中推出了strict模式，在strict模式下运行的JavaScript代码，强制通过<code>var</code>申明变量，未使用<code>var</code>申明变量就使用的，将导致运行错误。</p>
<p>启用strict模式的方法是在JavaScript代码的第一行写上：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>这是一个字符串，不支持strict模式的浏览器会把它当做一个字符串语句执行，支持strict模式的浏览器将开启strict模式运行JavaScript。</p>
<p>来测试一下你的浏览器是否能支持strict模式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function hello() &#123;</span><br><span class="line">    &#x27;use strict&#x27;;</span><br><span class="line">    // 如果浏览器支持strict模式，</span><br><span class="line">    // 下面的代码将报ReferenceError错误:</span><br><span class="line">    helloStr = &#x27;hello&#x27;;</span><br><span class="line">    console.log(helloStr);</span><br><span class="line">&#125;</span><br><span class="line">hello();</span><br></pre></td></tr></table></figure>
<p>运行代码，如果浏览器报错，请修复后再运行。如果浏览器不报错，说明你的浏览器太古老了，需要尽快升级。</p>
<p>不用<code>var</code>申明的变量会被视为全局变量，为了避免这一缺陷，所有的JavaScript代码都应该使用strict模式。我们在后面编写的JavaScript代码将全部采用strict模式。</p>
<p>另一种申明变量的方式是<code>let</code>，这也是现代JavaScript推荐的方式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 用let申明变量:</span><br><span class="line">let s = &#x27;hello&#x27;;</span><br><span class="line">console.log(s);</span><br></pre></td></tr></table></figure>
<p>后续我们还会详细讨论<code>var</code>和<code>let</code>的区别。</p>
<p>JavaScript的字符串就是用<code>''</code>或<code>&quot;&quot;</code>括起来的字符表示。</p>
<p>如果<code>'</code>本身也是一个字符，那就可以用<code>&quot;&quot;</code>括起来，比如<code>&quot;I'm OK&quot;</code>包含的字符是<code>I</code>，<code>'</code>，<code>m</code>，空格，<code>O</code>，<code>K</code>这6个字符。</p>
<p>如果字符串内部既包含<code>'</code>又包含<code>&quot;</code>怎么办？可以用转义字符<code>\</code>来标识，比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;I\&#x27;m \&quot;OK\&quot;!&#x27;</span>; <span class="comment">// I&#x27;m &quot;OK&quot;!</span></span><br></pre></td></tr></table></figure>
<p>表示的字符串内容是：<code>I'm &quot;OK&quot;!</code></p>
<p>转义字符<code>\</code>可以转义很多字符，比如<code>\n</code>表示换行，<code>\t</code>表示制表符，字符<code>\</code>本身也要转义，所以<code>\\</code>表示的字符就是<code>\</code>。</p>
<p>ASCII字符可以以<code>\x##</code>形式的十六进制表示，例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;\x41&#x27;</span>; <span class="comment">// 完全等同于 &#x27;A&#x27;</span></span><br></pre></td></tr></table></figure>
<p>还可以用<code>\u####</code>表示一个Unicode字符：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;\u4e2d\u6587&#x27;</span>; <span class="comment">// 完全等同于 &#x27;中文&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="多行字符串">多行字符串</h3>
<p>由于多行字符串用<code>\n</code>写起来比较费事，所以最新的ES6标准新增了一种多行字符串的表示方法，用反引号`…`表示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">`这是一个</span></span><br><span class="line"><span class="string">多行</span></span><br><span class="line"><span class="string">字符串`</span>;</span><br></pre></td></tr></table></figure>
<p><em>注意</em>：反引号在键盘的<code>ESC</code>下方，数字键<code>1</code>的左边：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">┌─────┐ ┌─────┬─────┬─────┬─────┐</span><br><span class="line">│ ESC │ │ F1  │ F2  │ F3  │ F4  │</span><br><span class="line">└─────┘ └─────┴─────┴─────┴─────┘</span><br><span class="line">┌─────┬─────┬─────┬─────┬─────┐</span><br><span class="line">│  ~  │  !  │  @  │  #  │  $  │</span><br><span class="line">│  `  │  1  │  2  │  3  │  4  │</span><br><span class="line">├─────┴──┬──┴──┬──┴──┬──┴──┬──┘</span><br><span class="line">│        │     │     │     │</span><br><span class="line">│  tab   │  Q  │  W  │  E  │</span><br><span class="line">├────────┴──┬──┴──┬──┴──┬──┘</span><br><span class="line">│           │     │     │</span><br><span class="line">│ caps lock │  A  │  S  │</span><br><span class="line">└───────────┴─────┴─────┘</span><br></pre></td></tr></table></figure>
<p>练习：测试你的浏览器是否支持ES6标准，如果不支持，请把多行字符串用<code>\n</code>重新表示出来：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 如果浏览器不支持ES6，将报SyntaxError错误:</span><br><span class="line">console.log(`多行</span><br><span class="line">字符串</span><br><span class="line">测试`);</span><br></pre></td></tr></table></figure>
<h3 id="模板字符串">模板字符串</h3>
<p>要把多个字符串连接起来，可以用<code>+</code>号连接：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">&#x27;小明&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> age = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">let</span> message = <span class="string">&#x27;你好, &#x27;</span> + name + <span class="string">&#x27;, 你今年&#x27;</span> + age + <span class="string">&#x27;岁了!&#x27;</span>;</span><br><span class="line"><span class="title function_">alert</span>(message);</span><br></pre></td></tr></table></figure>
<p>如果有很多变量需要连接，用<code>+</code>号就比较麻烦。ES6新增了一种模板字符串，表示方法和上面的多行字符串一样，但是它会自动替换字符串中的变量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">&#x27;小明&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> age = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">let</span> message = <span class="string">`你好, <span class="subst">$&#123;name&#125;</span>, 你今年<span class="subst">$&#123;age&#125;</span>岁了!`</span>;</span><br><span class="line"><span class="title function_">alert</span>(message);</span><br></pre></td></tr></table></figure>
<p>练习：测试你的浏览器是否支持ES6模板字符串，如果不支持，请把模板字符串改为<code>+</code>连接的普通字符串：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 如果浏览器支持模板字符串，将会替换字符串内部的变量:</span><br><span class="line">let name = &#x27;小明&#x27;;</span><br><span class="line">let age = 20;</span><br><span class="line">console.log(`你好, $&#123;name&#125;, 你今年$&#123;age&#125;岁了!`);</span><br></pre></td></tr></table></figure>
<h3 id="操作字符串">操作字符串</h3>
<p>字符串常见的操作如下：</p>
<p>获取字符串长度：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">&#x27;Hello, world!&#x27;</span>;</span><br><span class="line">s.<span class="property">length</span>; <span class="comment">// 13</span></span><br></pre></td></tr></table></figure>
<p>要获取字符串某个指定位置的字符，使用类似Array的下标操作，索引号从0开始：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">&#x27;Hello, world!&#x27;</span>;</span><br><span class="line"></span><br><span class="line">s[<span class="number">0</span>]; <span class="comment">// &#x27;H&#x27;</span></span><br><span class="line">s[<span class="number">6</span>]; <span class="comment">// &#x27; &#x27;</span></span><br><span class="line">s[<span class="number">7</span>]; <span class="comment">// &#x27;w&#x27;</span></span><br><span class="line">s[<span class="number">12</span>]; <span class="comment">// &#x27;!&#x27;</span></span><br><span class="line">s[<span class="number">13</span>]; <span class="comment">// undefined 超出范围的索引不会报错，但一律返回undefined</span></span><br></pre></td></tr></table></figure>
<p><em>需要特别注意的是</em>，字符串是不可变的，如果对字符串的某个索引赋值，不会有任何错误，但是，也没有任何效果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">&#x27;Test&#x27;</span>;</span><br><span class="line">s[<span class="number">0</span>] = <span class="string">&#x27;X&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s); <span class="comment">// s仍然为&#x27;Test&#x27;</span></span><br></pre></td></tr></table></figure>
<p>JavaScript为字符串提供了一些常用方法，注意，调用这些方法本身不会改变原有字符串的内容，而是返回一个新字符串：</p>
<h3 id="toUpperCase">toUpperCase</h3>
<p><code>toUpperCase()</code>把一个字符串全部变为大写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">&#x27;Hello&#x27;</span>;</span><br><span class="line">s.<span class="title function_">toUpperCase</span>(); <span class="comment">// 返回&#x27;HELLO&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="toLowerCase">toLowerCase</h3>
<p><code>toLowerCase()</code>把一个字符串全部变为小写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">&#x27;Hello&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> lower = s.<span class="title function_">toLowerCase</span>(); <span class="comment">// 返回&#x27;hello&#x27;并赋值给变量lower</span></span><br><span class="line">lower; <span class="comment">// &#x27;hello&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="indexOf">indexOf</h3>
<p><code>indexOf()</code>会搜索指定字符串出现的位置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">&#x27;hello, world&#x27;</span>;</span><br><span class="line">s.<span class="title function_">indexOf</span>(<span class="string">&#x27;world&#x27;</span>); <span class="comment">// 返回7</span></span><br><span class="line">s.<span class="title function_">indexOf</span>(<span class="string">&#x27;World&#x27;</span>); <span class="comment">// 没有找到指定的子串，返回-1</span></span><br></pre></td></tr></table></figure>
<h3 id="substring">substring</h3>
<p><code>substring()</code>返回指定索引区间的子串：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">&#x27;hello, world&#x27;</span></span><br><span class="line">s.<span class="title function_">substring</span>(<span class="number">0</span>, <span class="number">5</span>); <span class="comment">// 从索引0开始到5（不包括5），返回&#x27;hello&#x27;</span></span><br><span class="line">s.<span class="title function_">substring</span>(<span class="number">7</span>); <span class="comment">// 从索引7开始到结束，返回&#x27;world&#x27;</span></span><br></pre></td></tr></table></figure>
<p>JavaScript的<code>Array</code>可以包含任意数据类型，并通过索引来访问每个元素。</p>
<p>要取得<code>Array</code>的长度，直接访问<code>length</code>属性：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// Array.length:</span><br><span class="line">let arr = [1, 2, 3.14, &#x27;Hello&#x27;, null, true];</span><br><span class="line">console.log(arr.length); // 6</span><br></pre></td></tr></table></figure>
<p><em>请注意</em>，直接给<code>Array</code>的<code>length</code>赋一个新的值会导致<code>Array</code>大小的变化：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let arr = [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;];</span><br><span class="line">console.log(arr.length); // 3</span><br><span class="line">// 调整数组大小:</span><br><span class="line">arr.length = 6;</span><br><span class="line">console.log(arr); // arr变为[&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, undefined, undefined, undefined]</span><br><span class="line">// 调整数组大小:</span><br><span class="line">arr.length = 2;</span><br><span class="line">console.log(arr); // arr变为[&#x27;A&#x27;, &#x27;B&#x27;]</span><br></pre></td></tr></table></figure>
<p><code>Array</code>可以通过索引把对应的元素修改为新的值，因此，对<code>Array</code>的索引进行赋值会直接修改这个<code>Array</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// Array index:</span><br><span class="line">let arr = [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;];</span><br><span class="line">arr[1] = 99;</span><br><span class="line">console.log(arr); // arr现在变为[&#x27;A&#x27;, 99, &#x27;C&#x27;]</span><br><span class="line">console.log(arr[1]); // 99</span><br></pre></td></tr></table></figure>
<p><em>请注意</em>，如果通过索引赋值时，索引超过了范围，同样会引起<code>Array</code>大小的变化：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 索引超出范围会导致数组大小自动调整:</span><br><span class="line">let arr = [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;];</span><br><span class="line">arr[5] = &#x27;x&#x27;;</span><br><span class="line">console.log(arr); // arr变为[&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, undefined, undefined, &#x27;x&#x27;]</span><br></pre></td></tr></table></figure>
<p>大多数其他编程语言不允许直接改变数组的大小，越界访问索引会报错。然而，JavaScript的<code>Array</code>却不会有任何错误。在编写代码时，不建议直接修改<code>Array</code>的大小，访问索引时要确保索引不会越界。</p>
<h3 id="indexOf-2">indexOf</h3>
<p>与String类似，<code>Array</code>也可以通过<code>indexOf()</code>来搜索一个指定的元素的位置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">10</span>, <span class="number">20</span>, <span class="string">&#x27;30&#x27;</span>, <span class="string">&#x27;xyz&#x27;</span>];</span><br><span class="line">arr.<span class="title function_">indexOf</span>(<span class="number">10</span>); <span class="comment">// 元素10的索引为0</span></span><br><span class="line">arr.<span class="title function_">indexOf</span>(<span class="number">20</span>); <span class="comment">// 元素20的索引为1</span></span><br><span class="line">arr.<span class="title function_">indexOf</span>(<span class="number">30</span>); <span class="comment">// 元素30没有找到，返回-1</span></span><br><span class="line">arr.<span class="title function_">indexOf</span>(<span class="string">&#x27;30&#x27;</span>); <span class="comment">// 元素&#x27;30&#x27;的索引为2</span></span><br></pre></td></tr></table></figure>
<p>注意了，数字<code>30</code>和字符串<code>'30'</code>是不同的元素。</p>
<h3 id="slice">slice</h3>
<p><code>slice()</code>就是对应String的<code>substring()</code>版本，它截取<code>Array</code>的部分元素，然后返回一个新的<code>Array</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>];</span><br><span class="line">arr.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">3</span>); <span class="comment">// 从索引0开始，到索引3结束，但不包括索引3: [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;]</span></span><br><span class="line">arr.<span class="title function_">slice</span>(<span class="number">3</span>); <span class="comment">// 从索引3开始到结束: [&#x27;D&#x27;, &#x27;E&#x27;, &#x27;F&#x27;, &#x27;G&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>注意到<code>slice()</code>的起止参数包括开始索引，不包括结束索引。</p>
<p>如果不给<code>slice()</code>传递任何参数，它就会从头到尾截取所有元素。利用这一点，我们可以很容易地复制一个<code>Array</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> aCopy = arr.<span class="title function_">slice</span>();</span><br><span class="line">aCopy; <span class="comment">// [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, &#x27;D&#x27;, &#x27;E&#x27;, &#x27;F&#x27;, &#x27;G&#x27;]</span></span><br><span class="line">aCopy === arr; <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h3 id="push和pop">push和pop</h3>
<p><code>push()</code>向<code>Array</code>的末尾添加若干元素，<code>pop()</code>则把<code>Array</code>的最后一个元素删除掉：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">arr.<span class="title function_">push</span>(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>); <span class="comment">// 返回Array新的长度: 4</span></span><br><span class="line">arr; <span class="comment">// [1, 2, &#x27;A&#x27;, &#x27;B&#x27;]</span></span><br><span class="line">arr.<span class="title function_">pop</span>(); <span class="comment">// pop()返回&#x27;B&#x27;</span></span><br><span class="line">arr; <span class="comment">// [1, 2, &#x27;A&#x27;]</span></span><br><span class="line">arr.<span class="title function_">pop</span>(); arr.<span class="title function_">pop</span>(); arr.<span class="title function_">pop</span>(); <span class="comment">// 连续pop 3次</span></span><br><span class="line">arr; <span class="comment">// []</span></span><br><span class="line">arr.<span class="title function_">pop</span>(); <span class="comment">// 空数组继续pop不会报错，而是返回undefined</span></span><br><span class="line">arr; <span class="comment">// []</span></span><br></pre></td></tr></table></figure>
<h3 id="unshift和shift">unshift和shift</h3>
<p>如果要往<code>Array</code>的头部添加若干元素，使用<code>unshift()</code>方法，<code>shift()</code>方法则把<code>Array</code>的第一个元素删掉：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">arr.<span class="title function_">unshift</span>(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>); <span class="comment">// 返回Array新的长度: 4</span></span><br><span class="line">arr; <span class="comment">// [&#x27;A&#x27;, &#x27;B&#x27;, 1, 2]</span></span><br><span class="line">arr.<span class="title function_">shift</span>(); <span class="comment">// &#x27;A&#x27;</span></span><br><span class="line">arr; <span class="comment">// [&#x27;B&#x27;, 1, 2]</span></span><br><span class="line">arr.<span class="title function_">shift</span>(); arr.<span class="title function_">shift</span>(); arr.<span class="title function_">shift</span>(); <span class="comment">// 连续shift 3次</span></span><br><span class="line">arr; <span class="comment">// []</span></span><br><span class="line">arr.<span class="title function_">shift</span>(); <span class="comment">// 空数组继续shift不会报错，而是返回undefined</span></span><br><span class="line">arr; <span class="comment">// []</span></span><br></pre></td></tr></table></figure>
<h3 id="sort">sort</h3>
<p><code>sort()</code>可以对当前<code>Array</code>进行排序，它会直接修改当前<code>Array</code>的元素位置，直接调用时，按照默认顺序排序：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;A&#x27;</span>];</span><br><span class="line">arr.<span class="title function_">sort</span>();</span><br><span class="line">arr; <span class="comment">// [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>能否按照我们自己指定的顺序排序呢？完全可以，我们将在后面的函数中讲到。</p>
<h3 id="reverse">reverse</h3>
<p><code>reverse()</code>把整个<code>Array</code>的元素给调个个，也就是反转：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;three&#x27;</span>];</span><br><span class="line">arr.<span class="title function_">reverse</span>(); </span><br><span class="line">arr; <span class="comment">// [&#x27;three&#x27;, &#x27;two&#x27;, &#x27;one&#x27;]</span></span><br></pre></td></tr></table></figure>
<h3 id="splice">splice</h3>
<p><code>splice()</code>方法是修改<code>Array</code>的“万能方法”，它可以从指定的索引开始删除若干元素，然后再从该位置添加若干元素：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;Microsoft&#x27;</span>, <span class="string">&#x27;Apple&#x27;</span>, <span class="string">&#x27;Yahoo&#x27;</span>, <span class="string">&#x27;AOL&#x27;</span>, <span class="string">&#x27;Excite&#x27;</span>, <span class="string">&#x27;Oracle&#x27;</span>];</span><br><span class="line"><span class="comment">// 从索引2开始删除3个元素,然后再添加两个元素:</span></span><br><span class="line">arr.<span class="title function_">splice</span>(<span class="number">2</span>, <span class="number">3</span>, <span class="string">&#x27;Google&#x27;</span>, <span class="string">&#x27;Facebook&#x27;</span>); <span class="comment">// 返回删除的元素 [&#x27;Yahoo&#x27;, &#x27;AOL&#x27;, &#x27;Excite&#x27;]</span></span><br><span class="line">arr; <span class="comment">// [&#x27;Microsoft&#x27;, &#x27;Apple&#x27;, &#x27;Google&#x27;, &#x27;Facebook&#x27;, &#x27;Oracle&#x27;]</span></span><br><span class="line"><span class="comment">// 只删除,不添加:</span></span><br><span class="line">arr.<span class="title function_">splice</span>(<span class="number">2</span>, <span class="number">2</span>); <span class="comment">// [&#x27;Google&#x27;, &#x27;Facebook&#x27;]</span></span><br><span class="line">arr; <span class="comment">// [&#x27;Microsoft&#x27;, &#x27;Apple&#x27;, &#x27;Oracle&#x27;]</span></span><br><span class="line"><span class="comment">// 只添加,不删除:</span></span><br><span class="line">arr.<span class="title function_">splice</span>(<span class="number">2</span>, <span class="number">0</span>, <span class="string">&#x27;Google&#x27;</span>, <span class="string">&#x27;Facebook&#x27;</span>); <span class="comment">// 返回[],因为没有删除任何元素</span></span><br><span class="line">arr; <span class="comment">// [&#x27;Microsoft&#x27;, &#x27;Apple&#x27;, &#x27;Google&#x27;, &#x27;Facebook&#x27;, &#x27;Oracle&#x27;]</span></span><br></pre></td></tr></table></figure>
<h3 id="concat">concat</h3>
<p><code>concat()</code>方法把当前的<code>Array</code>和另一个<code>Array</code>连接起来，并返回一个新的<code>Array</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> added = arr.<span class="title function_">concat</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line">added; <span class="comment">// [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, 1, 2, 3]</span></span><br><span class="line">arr; <span class="comment">// [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;]</span></span><br></pre></td></tr></table></figure>
<p><em>请注意</em>，<code>concat()</code>方法并没有修改当前<code>Array</code>，而是返回了一个新的<code>Array</code>。</p>
<p>实际上，<code>concat()</code>方法可以接收任意个元素和<code>Array</code>，并且自动把<code>Array</code>拆开，然后全部添加到新的<code>Array</code>里：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>];</span><br><span class="line">arr.<span class="title function_">concat</span>(<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>]); <span class="comment">// [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, 1, 2, 3, 4]</span></span><br></pre></td></tr></table></figure>
<h3 id="join">join</h3>
<p><code>join()</code>方法是一个非常实用的方法，它把当前<code>Array</code>的每个元素都用指定的字符串连接起来，然后返回连接后的字符串：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">arr.<span class="title function_">join</span>(<span class="string">&#x27;-&#x27;</span>); <span class="comment">// &#x27;A-B-C-1-2-3&#x27;</span></span><br></pre></td></tr></table></figure>
<p>练习：在新生欢迎会上，你已经拿到了新同学的名单，请排序后显示：欢迎XXX，XXX，XXX和XXX同学！：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let arr = [&#x27;小明&#x27;, &#x27;小红&#x27;, &#x27;大军&#x27;, &#x27;阿黄&#x27;];</span><br><span class="line"></span><br><span class="line">console.log(&#x27;???&#x27;);</span><br></pre></td></tr></table></figure>
<p>如果<code>Array</code>的元素不是字符串，将自动转换为字符串后再连接。</p>
<h3 id="多维数组">多维数组</h3>
<p>如果数组的某个元素又是一个<code>Array</code>，则可以形成多维数组，例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">400</span>, <span class="number">500</span>, <span class="number">600</span>], <span class="string">&#x27;-&#x27;</span>];</span><br></pre></td></tr></table></figure>
<p>上述<code>Array</code>包含3个元素，其中头两个元素本身也是<code>Array</code>。</p>
<p>练习：如何通过索引取到<code>500</code>这个值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let arr = [[1, 2, 3], [400, 500, 600], &#x27;-&#x27;];</span><br><span class="line"></span><br><span class="line">let x = ??;</span><br><span class="line">console.log(x); // x应该为500</span><br></pre></td></tr></table></figure>
<h3 id="小结">小结</h3>
<p><code>Array</code>提供了一种顺序存储一组元素的功能，并可以按索引来读写。</p>
<p>JavaScript的对象是一种无序的集合数据类型，它由若干键值对组成。</p>
<p>JavaScript的对象用于描述现实世界中的某个对象。例如，为了描述“小明”这个淘气的小朋友，我们可以用若干键值对来描述他：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span>,</span><br><span class="line">    <span class="attr">school</span>: <span class="string">&#x27;No.1 Middle School&#x27;</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">1.70</span>,</span><br><span class="line">    <span class="attr">weight</span>: <span class="number">65</span>,</span><br><span class="line">    <span class="attr">score</span>: <span class="literal">null</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>JavaScript用一个<code>&#123;...&#125;</code>表示一个对象，键值对以<code>xxx: xxx</code>形式申明，用<code>,</code>隔开。注意，最后一个键值对不需要在末尾加<code>,</code>，如果加了，有的浏览器（如低版本的IE）将报错。</p>
<p>上述对象申明了一个<code>name</code>属性，值是<code>'小明'</code>，<code>birth</code>属性，值是<code>1990</code>，以及其他一些属性。最后，把这个对象赋值给变量<code>xiaoming</code>后，就可以通过变量<code>xiaoming</code>来获取小明的属性了：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xiaoming.<span class="property">name</span>; <span class="comment">// &#x27;小明&#x27;</span></span><br><span class="line">xiaoming.<span class="property">birth</span>; <span class="comment">// 1990</span></span><br></pre></td></tr></table></figure>
<p>访问属性是通过<code>.</code>操作符完成的，但这要求属性名必须是一个有效的变量名。如果属性名包含特殊字符，就必须用<code>''</code>括起来：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xiaohong = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小红&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;middle-school&#x27;</span>: <span class="string">&#x27;No.1 Middle School&#x27;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>xiaohong</code>的属性名<code>middle-school</code>不是一个有效的变量，就需要用<code>''</code>括起来。访问这个属性也无法使用<code>.</code>操作符，必须用<code>['xxx']</code>来访问：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xiaohong[<span class="string">&#x27;middle-school&#x27;</span>]; <span class="comment">// &#x27;No.1 Middle School&#x27;</span></span><br><span class="line">xiaohong[<span class="string">&#x27;name&#x27;</span>]; <span class="comment">// &#x27;小红&#x27;</span></span><br><span class="line">xiaohong.<span class="property">name</span>; <span class="comment">// &#x27;小红&#x27;</span></span><br></pre></td></tr></table></figure>
<p>也可以用<code>xiaohong['name']</code>来访问<code>xiaohong</code>的<code>name</code>属性，不过<code>xiaohong.name</code>的写法更简洁。我们在编写JavaScript代码的时候，属性名尽量使用标准的变量名，这样就可以直接通过<code>object.prop</code>的形式访问一个属性了。</p>
<p>实际上JavaScript对象的所有属性都是字符串，不过属性对应的值可以是任意数据类型。</p>
<p>如果访问一个不存在的属性会返回什么呢？JavaScript规定，访问不存在的属性不报错，而是返回<code>undefined</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x27;use strict&#x27;;</span><br><span class="line"></span><br><span class="line">let xiaoming = &#123;</span><br><span class="line">    name: &#x27;小明&#x27;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">console.log(xiaoming.name);</span><br><span class="line">console.log(xiaoming.age); // undefined</span><br></pre></td></tr></table></figure>
<p>由于JavaScript的对象是动态类型，你可以自由地给一个对象添加或删除属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line">xiaoming.<span class="property">age</span>; <span class="comment">// undefined</span></span><br><span class="line">xiaoming.<span class="property">age</span> = <span class="number">18</span>; <span class="comment">// 新增一个age属性</span></span><br><span class="line">xiaoming.<span class="property">age</span>; <span class="comment">// 18</span></span><br><span class="line"><span class="keyword">delete</span> xiaoming.<span class="property">age</span>; <span class="comment">// 删除age属性</span></span><br><span class="line">xiaoming.<span class="property">age</span>; <span class="comment">// undefined</span></span><br><span class="line"><span class="keyword">delete</span> xiaoming[<span class="string">&#x27;name&#x27;</span>]; <span class="comment">// 删除name属性</span></span><br><span class="line">xiaoming.<span class="property">name</span>; <span class="comment">// undefined</span></span><br><span class="line"><span class="keyword">delete</span> xiaoming.<span class="property">school</span>; <span class="comment">// 删除一个不存在的school属性也不会报错</span></span><br></pre></td></tr></table></figure>
<p>如果我们要检测<code>xiaoming</code>是否拥有某一属性，可以用<code>in</code>操作符：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">birth</span>: <span class="number">1990</span>,</span><br><span class="line">    <span class="attr">school</span>: <span class="string">&#x27;No.1 Middle School&#x27;</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">1.70</span>,</span><br><span class="line">    <span class="attr">weight</span>: <span class="number">65</span>,</span><br><span class="line">    <span class="attr">score</span>: <span class="literal">null</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="string">&#x27;name&#x27;</span> <span class="keyword">in</span> xiaoming; <span class="comment">// true</span></span><br><span class="line"><span class="string">&#x27;grade&#x27;</span> <span class="keyword">in</span> xiaoming; <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>不过要小心，如果<code>in</code>判断一个属性存在，这个属性不一定是<code>xiaoming</code>的，它可能是<code>xiaoming</code>继承得到的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;toString&#x27;</span> <span class="keyword">in</span> xiaoming; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>因为<code>toString</code>定义在<code>object</code>对象中，而所有对象最终都会在原型链上指向<code>object</code>，所以<code>xiaoming</code>也拥有<code>toString</code>属性。</p>
<p>要判断一个属性是否是<code>xiaoming</code>自身拥有的，而不是继承得到的，可以用<code>hasOwnProperty()</code>方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xiaoming = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line">xiaoming.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;name&#x27;</span>); <span class="comment">// true</span></span><br><span class="line">xiaoming.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;toString&#x27;</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h2 id="条件判断">条件判断</h2>
<p>JavaScript使用<code>if () &#123; ... &#125; else &#123; ... &#125;</code>来进行条件判断。例如，根据年龄显示不同内容，可以用<code>if</code>语句实现如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> age = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">if</span> (age &gt;= <span class="number">18</span>) &#123; <span class="comment">// 如果age &gt;= 18为true，则执行if语句块</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;adult&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123; <span class="comment">// 否则执行else语句块</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;teenager&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中<code>else</code>语句是可选的。如果语句块只包含一条语句，那么可以省略<code>&#123;&#125;</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> age = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">if</span> (age &gt;= <span class="number">18</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;adult&#x27;</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;teenager&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>省略<code>&#123;&#125;</code>的危险之处在于，如果后来想添加一些语句，却忘了写<code>&#123;&#125;</code>，就改变了<code>if...else...</code>的语义，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let age = 20;</span><br><span class="line">if (age &gt;= 18)</span><br><span class="line">    console.log(&#x27;adult&#x27;);</span><br><span class="line">else</span><br><span class="line">    console.log(&#x27;age &lt; 18&#x27;); // 添加一行日志</span><br><span class="line">    console.log(&#x27;teenager&#x27;); // &lt;- 这行语句已经不在else的控制范围了</span><br></pre></td></tr></table></figure>
<p>上述代码的<code>else</code>子句实际上只负责执行<code>console.log('age &lt; 18');</code>，原有的<code>console.log('teenager');</code>已经不属于<code>if...else...</code>的控制范围了，它每次都会执行。</p>
<p>相反地，有<code>&#123;&#125;</code>的语句就不会出错：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let age = 20;</span><br><span class="line">if (age &gt;= 18) &#123;</span><br><span class="line">    console.log(&#x27;adult&#x27;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    console.log(&#x27;age &lt; 18&#x27;);</span><br><span class="line">    console.log(&#x27;teenager&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这就是为什么我们建议永远都要写上<code>&#123;&#125;</code>。</p>
<h3 id="多行条件判断">多行条件判断</h3>
<p>如果还要更细致地判断条件，可以使用多个<code>if...else...</code>的组合：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> age = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">if</span> (age &gt;= <span class="number">18</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;adult&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (age &gt;= <span class="number">6</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;teenager&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;kid&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述多个<code>if...else...</code>的组合实际上相当于两层<code>if...else...</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> age = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">if</span> (age &gt;= <span class="number">18</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;adult&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (age &gt;= <span class="number">6</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;teenager&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;kid&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是我们通常把<code>else if</code>连写在一起，来增加可读性。这里的<code>else</code>略掉了<code>&#123;&#125;</code>是没有问题的，因为它只包含一个<code>if</code>语句。注意最后一个单独的<code>else</code>不要略掉<code>&#123;&#125;</code>。</p>
<p><em>请注意</em>，<code>if...else...</code>语句的执行特点是二选一，在多个<code>if...else...</code>语句中，如果某个条件成立，则后续就不再继续判断了。</p>
<p>试解释为什么下面的代码显示的是<code>teenager</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x27;use strict&#x27;;</span><br><span class="line">let age = 20;</span><br><span class="line"></span><br><span class="line">if (age &gt;= 6) &#123;</span><br><span class="line">    console.log(&#x27;teenager&#x27;);</span><br><span class="line">&#125; else if (age &gt;= 18) &#123;</span><br><span class="line">    console.log(&#x27;adult&#x27;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    console.log(&#x27;kid&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于<code>age</code>的值为<code>20</code>，它实际上同时满足条件<code>age &gt;= 6</code>和<code>age &gt;= 18</code>，这说明条件判断的顺序非常重要。请修复后让其显示<code>adult</code>。</p>
<p>如果<code>if</code>的条件判断语句结果不是<code>true</code>或<code>false</code>怎么办？例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (s.<span class="property">length</span>) &#123; <span class="comment">// 条件计算结果为3</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JavaScript把<code>null</code>、<code>undefined</code>、<code>0</code>、<code>NaN</code>和空字符串<code>''</code>视为<code>false</code>，其他值一概视为<code>true</code>，因此上述代码条件判断的结果是<code>true</code>。</p>
<h3 id="练习-3">练习</h3>
<p>小明身高1.75，体重80.5kg。请根据BMI公式（体重除以身高的平方）帮小明计算他的BMI指数，并根据BMI指数：</p>
<ul>
<li>低于18.5：过轻</li>
<li>18.5-25：正常</li>
<li>25-28：过重</li>
<li>28-32：肥胖</li>
<li>高于32：严重肥胖</li>
</ul>
<p>用<code>if...else...</code>判断并显示结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let height = parseFloat(prompt(&#x27;请输入身高(m):&#x27;));</span><br><span class="line">let weight = parseFloat(prompt(&#x27;请输入体重(kg):&#x27;));</span><br><span class="line"></span><br><span class="line">// TODO:</span><br><span class="line">let bmi = ???;</span><br><span class="line">if ...</span><br></pre></td></tr></table></figure>
<hr>
<hr>
<p>要计算1+2+3，我们可以直接写表达式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> + <span class="number">2</span> + <span class="number">3</span>; <span class="comment">// 6</span></span><br></pre></td></tr></table></figure>
<p>要计算1+2+3+…+10，勉强也能写出来。</p>
<p>但是，要计算1+2+3+…+10000，直接写表达式就不可能了。</p>
<p>为了让计算机能计算成千上万次的重复运算，我们就需要循环语句。</p>
<p>JavaScript的循环有两种，一种是<code>for</code>循环，通过初始条件、结束条件和递增条件来循环执行语句块：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> i;</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;=<span class="number">10000</span>; i++) &#123;</span><br><span class="line">    x = x + i;</span><br><span class="line">&#125;</span><br><span class="line">x; <span class="comment">// 50005000</span></span><br></pre></td></tr></table></figure>
<p>让我们来分析一下<code>for</code>循环的控制条件：</p>
<ul>
<li>i=1 这是初始条件，将变量i置为1；</li>
<li>i&lt;=10000 这是判断条件，满足时就继续循环，不满足就退出循环；</li>
<li>i++ 这是每次循环后的递增条件，由于每次循环后变量i都会加1，因此它终将在若干次循环后不满足判断条件<code>i&lt;=10000</code>而退出循环。</li>
</ul>
<p>练习：利用<code>for</code>循环计算<code>1 * 2 * 3 * ... * 10</code>的结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">let x = ?;</span><br><span class="line">let i;</span><br><span class="line">for ...</span><br><span class="line"></span><br><span class="line">if (x === 3628800) &#123;</span><br><span class="line">    console.log(&#x27;1 x 2 x 3 x ... x 10 = &#x27; + x);</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">    console.log(&#x27;计算错误&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>for</code>循环最常用的地方是利用索引来遍历数组：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;Apple&#x27;</span>, <span class="string">&#x27;Google&#x27;</span>, <span class="string">&#x27;Microsoft&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> i, x;</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    x = arr[i];</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>for</code>循环的3个条件都是可以省略的，如果没有退出循环的判断条件，就必须使用<code>break</code>语句退出循环，否则就是死循环：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (;;) &#123; <span class="comment">// 将无限循环下去</span></span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">100</span>) &#123;</span><br><span class="line">        <span class="keyword">break</span>; <span class="comment">// 通过if判断来退出循环</span></span><br><span class="line">    &#125;</span><br><span class="line">    x ++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="for-…-in">for … in</h3>
<p><code>for</code>循环的一个变体是<code>for ... in</code>循环，它可以把一个对象的所有属性依次循环出来：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Jack&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">city</span>: <span class="string">&#x27;Beijing&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> o) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key); <span class="comment">// &#x27;name&#x27;, &#x27;age&#x27;, &#x27;city&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>要过滤掉对象继承的属性，用<code>hasOwnProperty()</code>来实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Jack&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">city</span>: <span class="string">&#x27;Beijing&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> o) &#123;</span><br><span class="line">    <span class="keyword">if</span> (o.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(key); <span class="comment">// &#x27;name&#x27;, &#x27;age&#x27;, &#x27;city&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于<code>Array</code>也是对象，而它的每个元素的索引被视为对象的属性，因此，<code>for ... in</code>循环可以直接循环出<code>Array</code>的索引：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> a) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(i); <span class="comment">// &#x27;0&#x27;, &#x27;1&#x27;, &#x27;2&#x27;</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a[i]); <span class="comment">// &#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>请注意</em>，<code>for ... in</code>对<code>Array</code>的循环得到的是<code>String</code>而不是<code>Number</code>。</p>
<h3 id="while">while</h3>
<p><code>for</code>循环在已知循环的初始和结束条件时非常有用。而上述忽略了条件的<code>for</code>循环容易让人看不清循环的逻辑，此时用<code>while</code>循环更佳。</p>
<p><code>while</code>循环只有一个判断条件，条件满足，就不断循环，条件不满足时则退出循环。比如我们要计算100以内所有奇数之和，可以用while循环实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> n = <span class="number">99</span>;</span><br><span class="line"><span class="keyword">while</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    x = x + n;</span><br><span class="line">    n = n - <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line">x; <span class="comment">// 2500</span></span><br></pre></td></tr></table></figure>
<p>在循环内部变量<code>n</code>不断自减，直到变为<code>-1</code>时，不再满足<code>while</code>条件，循环退出。</p>
<h3 id="do-…-while">do … while</h3>
<p>最后一种循环是<code>do &#123; ... &#125; while()</code>循环，它和<code>while</code>循环的唯一区别在于，不是在每次循环开始的时候判断条件，而是在每次循环完成的时候判断条件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> n = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    n = n + <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">while</span> (n &lt; <span class="number">100</span>);</span><br><span class="line">n; <span class="comment">// 100</span></span><br></pre></td></tr></table></figure>
<p>用<code>do &#123; ... &#125; while()</code>循环要小心，循环体会至少执行1次，而<code>for</code>和<code>while</code>循环则可能一次都不执行。</p>
<h3 id="练习-4">练习</h3>
<p>请利用循环遍历数组中的每个名字，并显示<code>Hello, xxx!</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let arr = [&#x27;Bart&#x27;, &#x27;Lisa&#x27;, &#x27;Adam&#x27;];</span><br><span class="line"></span><br><span class="line">for ...</span><br></pre></td></tr></table></figure>
<p>请尝试<code>for</code>循环和<code>while</code>循环，并以正序、倒序两种方式遍历。</p>
<h3 id="小结-2">小结</h3>
<p>循环是让计算机做重复任务的有效的方法，有些时候，如果代码写得有问题，会让程序陷入“死循环”，也就是永远循环下去。JavaScript的死循环会让浏览器无法正常显示或执行当前页面的逻辑，有的浏览器会直接挂掉，有的浏览器会在一段时间后提示你强行终止JavaScript的执行，因此，要特别注意死循环的问题。</p>
<p>在编写循环代码时，务必小心编写初始条件和判断条件，尤其是边界值。特别注意<code>i &lt; 100</code>和<code>i &lt;= 100</code>是不同的判断逻辑。</p>
<p>JavaScript的默认对象表示方式<code>&#123;&#125;</code>可以视为其他语言中的<code>Map</code>或<code>Dictionary</code>的数据结构，即一组键值对。</p>
<p>但是JavaScript的对象有个小问题，就是键必须是字符串。但实际上Number或者其他数据类型作为键也是非常合理的。</p>
<p>为了解决这个问题，最新的ES6规范引入了新的数据类型<code>Map</code>。要测试你的浏览器是否支持ES6规范，请执行以下代码，如果浏览器报ReferenceError错误，那么你需要换一个支持ES6的浏览器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let m = new Map();</span><br><span class="line">let s = new Set();</span><br><span class="line">console.log(&#x27;你的浏览器支持Map和Set！&#x27;);</span><br><span class="line">// 直接运行测试</span><br></pre></td></tr></table></figure>
<h3 id="Map">Map</h3>
<p><code>Map</code>是一组键值对的结构，具有极快的查找速度。</p>
<p>举个例子，假设要根据同学的名字查找对应的成绩，如果用<code>Array</code>实现，需要两个<code>Array</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> names = [<span class="string">&#x27;Michael&#x27;</span>, <span class="string">&#x27;Bob&#x27;</span>, <span class="string">&#x27;Tracy&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> scores = [<span class="number">95</span>, <span class="number">75</span>, <span class="number">85</span>];</span><br></pre></td></tr></table></figure>
<p>给定一个名字，要查找对应的成绩，就先要在names中找到对应的位置，再从scores取出对应的成绩，Array越长，耗时越长。</p>
<p>如果用Map实现，只需要一个“名字”-“成绩”的对照表，直接根据名字查找成绩，无论这个表有多大，查找速度都不会变慢。用JavaScript写一个Map如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> m = <span class="keyword">new</span> <span class="title class_">Map</span>([[<span class="string">&#x27;Michael&#x27;</span>, <span class="number">95</span>], [<span class="string">&#x27;Bob&#x27;</span>, <span class="number">75</span>], [<span class="string">&#x27;Tracy&#x27;</span>, <span class="number">85</span>]]);</span><br><span class="line">m.<span class="title function_">get</span>(<span class="string">&#x27;Michael&#x27;</span>); <span class="comment">// 95</span></span><br></pre></td></tr></table></figure>
<p>初始化<code>Map</code>需要一个二维数组，或者直接初始化一个空<code>Map</code>。<code>Map</code>具有以下方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> m = <span class="keyword">new</span> <span class="title class_">Map</span>(); <span class="comment">// 空Map</span></span><br><span class="line">m.<span class="title function_">set</span>(<span class="string">&#x27;Adam&#x27;</span>, <span class="number">67</span>); <span class="comment">// 添加新的key-value</span></span><br><span class="line">m.<span class="title function_">set</span>(<span class="string">&#x27;Bob&#x27;</span>, <span class="number">59</span>);</span><br><span class="line">m.<span class="title function_">has</span>(<span class="string">&#x27;Adam&#x27;</span>); <span class="comment">// 是否存在key &#x27;Adam&#x27;: true</span></span><br><span class="line">m.<span class="title function_">get</span>(<span class="string">&#x27;Adam&#x27;</span>); <span class="comment">// 67</span></span><br><span class="line">m.<span class="title function_">delete</span>(<span class="string">&#x27;Adam&#x27;</span>); <span class="comment">// 删除key &#x27;Adam&#x27;</span></span><br><span class="line">m.<span class="title function_">get</span>(<span class="string">&#x27;Adam&#x27;</span>); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<p>由于一个key只能对应一个value，所以，多次对一个key放入value，后面的值会把前面的值冲掉：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> m = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">m.<span class="title function_">set</span>(<span class="string">&#x27;Adam&#x27;</span>, <span class="number">67</span>);</span><br><span class="line">m.<span class="title function_">set</span>(<span class="string">&#x27;Adam&#x27;</span>, <span class="number">88</span>);</span><br><span class="line">m.<span class="title function_">get</span>(<span class="string">&#x27;Adam&#x27;</span>); <span class="comment">// 88</span></span><br></pre></td></tr></table></figure>
<h3 id="Set">Set</h3>
<p><code>Set</code>和<code>Map</code>类似，也是一组key的集合，但不存储value。由于key不能重复，所以，在<code>Set</code>中，没有重复的key。</p>
<p>要创建一个<code>Set</code>，需要提供一个<code>Array</code>作为输入，或者直接创建一个空<code>Set</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="keyword">new</span> <span class="title class_">Set</span>(); <span class="comment">// 空Set</span></span><br><span class="line"><span class="keyword">let</span> s2 = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]); <span class="comment">// 含1, 2, 3</span></span><br></pre></td></tr></table></figure>
<p>重复元素在<code>Set</code>中自动被过滤：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="string">&#x27;3&#x27;</span>]);</span><br><span class="line">s; <span class="comment">// Set &#123;1, 2, 3, &quot;3&quot;&#125;</span></span><br></pre></td></tr></table></figure>
<p>注意数字<code>3</code>和字符串<code>'3'</code>是不同的元素。</p>
<p>通过<code>add(key)</code>方法可以添加元素到<code>Set</code>中，可以重复添加，但不会有效果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s.<span class="title function_">add</span>(<span class="number">4</span>);</span><br><span class="line">s; <span class="comment">// Set &#123;1, 2, 3, 4&#125;</span></span><br><span class="line">s.<span class="title function_">add</span>(<span class="number">4</span>);</span><br><span class="line">s; <span class="comment">// 仍然是 Set &#123;1, 2, 3, 4&#125;</span></span><br></pre></td></tr></table></figure>
<p>通过<code>delete(key)</code>方法可以删除元素：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line">s; <span class="comment">// Set &#123;1, 2, 3&#125;</span></span><br><span class="line">s.<span class="title function_">delete</span>(<span class="number">3</span>);</span><br><span class="line">s; <span class="comment">// Set &#123;1, 2&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="小结-3">小结</h3>
<p><code>Map</code>和<code>Set</code>是ES6标准新增的数据类型，请根据浏览器的支持情况决定是否要使用。</p>
<p>遍历<code>Array</code>可以采用下标循环，遍历<code>Map</code>和<code>Set</code>就无法使用下标。为了统一集合类型，ES6标准引入了新的<code>iterable</code>类型，<code>Array</code>、<code>Map</code>和<code>Set</code>都属于<code>iterable</code>类型。</p>
<p>具有<code>iterable</code>类型的集合可以通过新的<code>for ... of</code>循环来遍历。</p>
<p><code>for ... of</code>循环是ES6引入的新的语法，请测试你的浏览器是否支持：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let a = [1, 2, 3];</span><br><span class="line">for (let x of a) &#123;</span><br><span class="line">&#125;</span><br><span class="line">console.log(&#x27;你的浏览器支持for ... of&#x27;);</span><br><span class="line">// 请直接运行测试</span><br></pre></td></tr></table></figure>
<p>用<code>for ... of</code>循环遍历集合，用法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> s = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>]);</span><br><span class="line"><span class="keyword">let</span> m = <span class="keyword">new</span> <span class="title class_">Map</span>([[<span class="number">1</span>, <span class="string">&#x27;x&#x27;</span>], [<span class="number">2</span>, <span class="string">&#x27;y&#x27;</span>], [<span class="number">3</span>, <span class="string">&#x27;z&#x27;</span>]]);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> x <span class="keyword">of</span> a) &#123; <span class="comment">// 遍历Array</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> x <span class="keyword">of</span> s) &#123; <span class="comment">// 遍历Set</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> x <span class="keyword">of</span> m) &#123; <span class="comment">// 遍历Map</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x[<span class="number">0</span>] + <span class="string">&#x27;=&#x27;</span> + x[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你可能会有疑问，<code>for ... of</code>循环和<code>for ... in</code>循环有何区别？</p>
<p><code>for ... in</code>循环由于历史遗留问题，它遍历的实际上是对象的属性名称。一个<code>Array</code>数组实际上也是一个对象，它的每个元素的索引被视为一个属性。</p>
<p>当我们手动给<code>Array</code>对象添加了额外的属性后，<code>for ... in</code>循环将带来意想不到的意外效果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>];</span><br><span class="line">a.<span class="property">name</span> = <span class="string">&#x27;Hello&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> x <span class="keyword">in</span> a) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x); <span class="comment">// &#x27;0&#x27;, &#x27;1&#x27;, &#x27;2&#x27;, &#x27;name&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>for ... in</code>循环将把<code>name</code>包括在内，但<code>Array</code>的<code>length</code>属性却不包括在内。</p>
<p><code>for ... of</code>循环则完全修复了这些问题，它只循环集合本身的元素：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>];</span><br><span class="line">a.<span class="property">name</span> = <span class="string">&#x27;Hello&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> x <span class="keyword">of</span> a) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x); <span class="comment">// &#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这就是为什么要引入新的<code>for ... of</code>循环。</p>
<p>然而，更好的方式是直接使用<code>iterable</code>内置的<code>forEach</code>方法，它接收一个函数，每次迭代就自动回调该函数。以<code>Array</code>为例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let a = [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;];</span><br><span class="line">a.forEach(function (element, index, array) &#123;</span><br><span class="line">    // element: 指向当前元素的值</span><br><span class="line">    // index: 指向当前索引</span><br><span class="line">    // array: 指向Array对象本身</span><br><span class="line">    console.log(`$&#123;element&#125;, index = $&#123;index&#125;`);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><em>注意</em>，<code>forEach()</code>方法是ES5.1标准引入的，你需要测试浏览器是否支持。</p>
<p><code>Set</code>与<code>Array</code>类似，但<code>Set</code>没有索引，因此回调函数的前两个参数都是元素本身：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>]);</span><br><span class="line">s.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">element, sameElement, set</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(element);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>Map</code>的回调函数参数依次为<code>value</code>、<code>key</code>和<code>map</code>本身：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> m = <span class="keyword">new</span> <span class="title class_">Map</span>([[<span class="number">1</span>, <span class="string">&#x27;x&#x27;</span>], [<span class="number">2</span>, <span class="string">&#x27;y&#x27;</span>], [<span class="number">3</span>, <span class="string">&#x27;z&#x27;</span>]]);</span><br><span class="line">m.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">value, key, map</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>如果对某些参数不感兴趣，由于JavaScript的函数调用不要求参数必须一致，因此可以忽略它们。例如，只需要获得<code>Array</code>的<code>element</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>];</span><br><span class="line">a.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">element</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(element);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../../2024/01/10/JavaScript/JavaScript-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../../2023/10/25/Swift/SwiftUI%E5%85%A8%E9%9D%A2%E6%8C%87%E5%8D%97-%E8%A7%86%E5%9B%BE-%E4%BF%AE%E9%A5%B0%E7%AC%A6-%E7%BB%84%E4%BB%B6%E4%B8%8EMVVM%E6%9E%B6%E6%9E%84/"
                            aria-label=": SwiftUI全面指南:视图,修饰符,组件与MVVM架构"
                        >
                            SwiftUI全面指南:视图,修饰符,组件与MVVM架构
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2023-10-25T00:14:52+08:00">
	
		    2023 年 10 月 25 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../../categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a>, <a class="category-link" href="../../../categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/SwiftUI/">SwiftUI</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>SwiftUI 是 Apple 推出的声明式框架，用于构建用户界面（UI）。 自2019年首次发布以来，SwiftUI 已成为 iOS、macOS、watchOS 和 tvOS 应用开发的重要工具。 本文将深入介绍 SwiftUI 的基本概念，包括视图(View)、修饰符(Modifiers)、内置修饰符、如何自定义视图、 组件化开发以及 MVVM 架构在 SwiftUI 中的应用。无论你是刚开始学习 SwiftUI，还是希望巩固基础，这篇指南都将为你提供有价值的知识。</p>
<h2 id="什么是-SwiftUI​">什么是 SwiftUI<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#what-is-swiftui" title="什么是 SwiftUI的直接链接">​</a></h2>
<p>SwiftUI 是 Apple 推出的用于构建用户界面的框架，采用声明式语法，使开发者能够更简洁、高效地创建复杂的界面。与传统的 UIKit 不同，SwiftUI 允许开发者通过声明视图的状态和布局来自动管理 UI 更新，从而减少了大量的样板代码。</p>
<h3 id="SwiftUI-的优势​">SwiftUI 的优势<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#swiftui-%E7%9A%84%E4%BC%98%E5%8A%BF" title="SwiftUI 的优势的直接链接">​</a></h3>
<ul>
<li><strong>声明式语法</strong>：通过描述界面的状态，SwiftUI 自动处理界面的更新。</li>
<li><strong>跨平台支持</strong>：适用于 iOS、macOS、watchOS 和 tvOS。</li>
<li><strong>实时预览</strong>：Xcode 提供的 Canvas 允许开发者实时预览和调试 UI。</li>
<li><strong>高效开发</strong>：减少样板代码，提高开发效率。</li>
<li><strong>响应式编程</strong>：SwiftUI 内置支持响应式编程范式，简化数据与UI的绑定。</li>
</ul>
<h2 id="什么是视图-View-​">什么是视图(View)<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#what-is-view" title="什么是视图(View)的直接链接">​</a></h2>
<p>在 SwiftUI 中，<strong>视图(View)</strong> 是构建用户界面的基本单元。每一个视图都代表 UI 的一个部分，例如文本、按钮、图像等。视图可以嵌套和组合，以创建复杂的界面。</p>
<h3 id="常见的-SwiftUI-视图​">常见的 SwiftUI 视图<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#%E5%B8%B8%E8%A7%81%E7%9A%84-swiftui-%E8%A7%86%E5%9B%BE" title="常见的 SwiftUI 视图的直接链接">​</a></h3>
<ul>
<li><code>Text</code>：显示文本内容。</li>
<li><code>Image</code>：显示图片。</li>
<li><code>Button</code>：交互式按钮。</li>
<li><code>VStack</code> 和 <code>HStack</code>：垂直和水平堆叠视图。</li>
<li><code>List</code>：显示可滚动的列表。</li>
<li><code>ScrollView</code>：实现可滚动的内容视图。</li>
<li><code>Spacer</code>：在堆叠视图中添加弹性空间。</li>
<li><code>NavigationView</code>：实现导航功能。</li>
</ul>
<h3 id="示例：创建一个简单的文本视图​">示例：创建一个简单的文本视图<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#%E7%A4%BA%E4%BE%8B%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%96%87%E6%9C%AC%E8%A7%86%E5%9B%BE" title="示例：创建一个简单的文本视图的直接链接">​</a></h3>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUIstruct ContentView: View &#123;    var body: some View &#123;        Text(&quot;Hello, SwiftUI!&quot;)    &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>在上述示例中，<code>Text</code> 视图用于显示一段文本。</p>
<h2 id="什么是修饰符-Modifiers-​">什么是修饰符(Modifiers)<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#what-is-modifiers" title="什么是修饰符(Modifiers)的直接链接">​</a></h2>
<p><strong>修饰符(Modifiers)</strong> 是 SwiftUI 中用于修改视图属性的方法。通过链式调用修饰符，开发者可以轻松地调整视图的外观和行为，例如颜色、字体、边距等。</p>
<h3 id="使用修饰符的示例​">使用修饰符的示例<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#%E4%BD%BF%E7%94%A8%E4%BF%AE%E9%A5%B0%E7%AC%A6%E7%9A%84%E7%A4%BA%E4%BE%8B" title="使用修饰符的示例的直接链接">​</a></h3>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;Hello, SwiftUI!&quot;</span>)    .font(.title)    .foregroundColor(.blue)    .padding()</span><br></pre></td></tr></table></figure>
<p>在这个例子中，<code>Text</code> 视图被应用了三个修饰符：<code>font</code> 修改字体大小，<code>foregroundColor</code> 修改文本颜色，<code>padding</code> 添加内边距。</p>
<h2 id="什么是内置修饰符​">什么是内置修饰符<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#what-is-built-in-modifiers" title="什么是内置修饰符的直接链接">​</a></h2>
<p>SwiftUI 提供了丰富的<strong>内置修饰符</strong>，开发者可以直接使用这些修饰符来调整视图的各种属性。以下是一些常用的内置修饰符：</p>
<ul>
<li><code>font(_:)</code>：设置字体和字体大小。</li>
<li><code>foregroundColor(_:)</code>：设置前景色（如文本颜色）。</li>
<li><code>background(_:)</code>：设置视图的背景颜色或视图。</li>
<li><code>padding(_:)</code>：设置视图的内边距。</li>
<li><code>frame(width:height:)</code>：设置视图的宽度和高度。</li>
<li><code>cornerRadius(_:)</code>：设置视图的圆角半径。</li>
<li><code>shadow(color:radius:x:y:)</code>：添加阴影效果。</li>
<li><code>opacity(_:)</code>：设置视图的不透明度。</li>
<li><code>rotationEffect(_:)</code>：旋转视图。</li>
<li><code>scaleEffect(_:)</code>：缩放视图。</li>
</ul>
<h3 id="示例：使用多个内置修饰符​">示例：使用多个内置修饰符<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#%E7%A4%BA%E4%BE%8B%E4%BD%BF%E7%94%A8%E5%A4%9A%E4%B8%AA%E5%86%85%E7%BD%AE%E4%BF%AE%E9%A5%B0%E7%AC%A6" title="示例：使用多个内置修饰符的直接链接">​</a></h3>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;Welcome to SwiftUI&quot;</span>)    .font(.largeTitle)    .foregroundColor(.white)    .padding()    .background(<span class="type">Color</span>.blue)    .cornerRadius(<span class="number">10</span>)    .shadow(color: .gray, radius: <span class="number">5</span>, x: <span class="number">0</span>, y: <span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<p>在这个例子中，<code>Text</code> 视图应用了多个内置修饰符，改变了字体、颜色、背景、圆角和阴影效果。</p>
<h2 id="如何自定义视图​">如何自定义视图<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#how-to-custom-view" title="如何自定义视图的直接链接">​</a></h2>
<p>除了使用内置视图和修饰符，SwiftUI 允许开发者创建<strong>自定义视图</strong>。通过组合多个视图和修饰符，可以创建可重用且模块化的 UI 组件。</p>
<h3 id="创建自定义视图的步骤​">创建自定义视图的步骤<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A7%86%E5%9B%BE%E7%9A%84%E6%AD%A5%E9%AA%A4" title="创建自定义视图的步骤的直接链接">​</a></h3>
<ol>
<li><strong>定义新的视图结构</strong>：创建一个遵循 <code>View</code> 协议的结构体。</li>
<li><strong>实现 <code>body</code> 属性</strong>：在 <code>body</code> 中定义视图的内容和布局。</li>
<li><strong>组合视图和修饰符</strong>：使用内置视图和修饰符来设计自定义视图。</li>
</ol>
<h3 id="示例：创建一个自定义按钮视图​">示例：创建一个自定义按钮视图<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#%E7%A4%BA%E4%BE%8B%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%89%E9%92%AE%E8%A7%86%E5%9B%BE" title="示例：创建一个自定义按钮视图的直接链接">​</a></h3>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUIstruct CustomButton: View &#123;    var title: String    var backgroundColor: Color    var body: some View &#123;        Text(title)            .font(.headline)            .foregroundColor(.white)            .padding()            .background(backgroundColor)            .cornerRadius(8)            .shadow(radius: 5)    &#125;&#125;struct ContentView: View &#123;    var body: some View &#123;        CustomButton(title: &quot;Click Me&quot;, backgroundColor: .green)    &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>在这个示例中，<code>CustomButton</code> 是一个自定义视图，通过组合 <code>Text</code> 视图和多个修饰符，创建了一个带有背景色、圆角和阴影效果的按钮。</p>
<h2 id="视图与组件化开发​">视图与组件化开发<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#view-and-component-development" title="视图与组件化开发的直接链接">​</a></h2>
<p><strong>组件化开发</strong> 是现代软件开发中的一种最佳实践，通过将 UI 分解为可重用的组件，提升代码的可维护性和可扩展性。在 SwiftUI 中，视图本身就是组件的基本形式，开发者可以通过创建自定义视图来实现组件化开发。</p>
<h3 id="组件化的优势​">组件化的优势<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#%E7%BB%84%E4%BB%B6%E5%8C%96%E7%9A%84%E4%BC%98%E5%8A%BF" title="组件化的优势的直接链接">​</a></h3>
<ul>
<li><strong>可重用性</strong>：相同的组件可以在不同的地方重复使用，减少代码冗余。</li>
<li><strong>可维护性</strong>：组件独立，便于管理和更新。</li>
<li><strong>可测试性</strong>：独立的组件更容易进行单元测试。</li>
</ul>
<h3 id="示例：创建多个自定义组件​">示例：创建多个自定义组件<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#%E7%A4%BA%E4%BE%8B%E5%88%9B%E5%BB%BA%E5%A4%9A%E4%B8%AA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6" title="示例：创建多个自定义组件的直接链接">​</a></h3>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">HeaderView</span>: <span class="title class_ inherited__">View</span> &#123;    <span class="keyword">var</span> title: <span class="type">String</span>    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;        <span class="type">Text</span>(title)            .font(.largeTitle)            .padding()            .background(<span class="type">Color</span>.orange)            .foregroundColor(.white)    &#125;&#125;<span class="keyword">struct</span> <span class="title class_">FooterView</span>: <span class="title class_ inherited__">View</span> &#123;    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;        <span class="type">Text</span>(<span class="string">&quot;© 2025 Your Company&quot;</span>)            .font(.footnote)            .padding()            .background(<span class="type">Color</span>.gray.opacity(<span class="number">0.2</span>))    &#125;&#125;<span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;        <span class="type">VStack</span> &#123;            <span class="type">HeaderView</span>(title: <span class="string">&quot;Welcome to My App&quot;</span>)            <span class="type">Spacer</span>()            <span class="type">FooterView</span>()        &#125;    &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>在这个示例中，<code>HeaderView</code> 和 <code>FooterView</code> 是两个独立的自定义组件，通过组合它们构建了一个完整的界面。</p>
<h2 id="MVVM-架构简介​">MVVM 架构简介<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#mvvm-architecture-introduction" title="MVVM 架构简介的直接链接">​</a></h2>
<p><strong>MVVM（Model-View-ViewModel）</strong> 是一种软件架构模式，旨在将应用程序的业务逻辑与用户界面分离。MVVM 提供了一种清晰的方式来组织代码，使其更易于维护、测试和扩展。</p>
<h3 id="MVVM-的组成部分​">MVVM 的组成部分<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#mvvm-%E7%9A%84%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86" title="MVVM 的组成部分的直接链接">​</a></h3>
<ul>
<li><strong>Model（模型）</strong>：表示应用程序的数据和业务逻辑。通常与数据存储和网络请求相关。</li>
<li><strong>View（视图）</strong>：负责显示数据和处理用户交互。SwiftUI 中的视图如 <code>Text</code>、<code>Image</code> 等。</li>
<li><strong>ViewModel（视图模型）</strong>：充当 Model 和 View 之间的中介。它处理业务逻辑，将 Model 中的数据转换为 View 可以直接使用的格式，并响应用户交互。</li>
</ul>
<h3 id="MVVM-的优势​">MVVM 的优势<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#mvvm-%E7%9A%84%E4%BC%98%E5%8A%BF" title="MVVM 的优势的直接链接">​</a></h3>
<ul>
<li><strong>分离关注点</strong>：将 UI 与业务逻辑分离，提升代码的可维护性。</li>
<li><strong>可测试性</strong>：ViewModel 可以独立于 View 进行单元测试。</li>
<li><strong>可重用性</strong>：ViewModel 可以在多个 View 中复用。</li>
</ul>
<h2 id="SwiftUI-中的-MVVM-实现​">SwiftUI 中的 MVVM 实现<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#mvvm-implementation-in-swiftui" title="SwiftUI 中的 MVVM 实现的直接链接">​</a></h2>
<p>在 SwiftUI 中，MVVM 架构通过结合 SwiftUI 的声明式语法和数据绑定机制，实现了 Model、View 和 ViewModel 的分离与协作。</p>
<h3 id="关键概念​">关键概念<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5" title="关键概念的直接链接">​</a></h3>
<ul>
<li><strong>@State</strong>：用于在 View 中存储和管理局部状态。</li>
<li><strong>@ObservableObject</strong>：用于声明一个可观察的对象，通常在 ViewModel 中使用。</li>
<li><strong>@Published</strong>：用于在 ObservableObject 中标记可以被观察的属性。</li>
<li><strong>@StateObject</strong> 和 <strong>@ObservedObject</strong>：用于在 View 中引用 ViewModel。</li>
</ul>
<h3 id="示例：使用-MVVM-架构的简单计数器应用​">示例：使用 MVVM 架构的简单计数器应用<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#%E7%A4%BA%E4%BE%8B%E4%BD%BF%E7%94%A8-mvvm-%E6%9E%B6%E6%9E%84%E7%9A%84%E7%AE%80%E5%8D%95%E8%AE%A1%E6%95%B0%E5%99%A8%E5%BA%94%E7%94%A8" title="示例：使用 MVVM 架构的简单计数器应用的直接链接">​</a></h3>
<h4 id="Model​">Model<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#model" title="Model的直接链接">​</a></h4>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">CounterModel</span> &#123;    <span class="keyword">var</span> count: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span>&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ViewModel​">ViewModel<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#viewmodel" title="ViewModel的直接链接">​</a></h4>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combineclass CounterViewModel: ObservableObject &#123;    @Published var counter: CounterModel    init(counter: CounterModel = CounterModel()) &#123;        self.counter = counter    &#125;    func increment() &#123;        counter.count += 1    &#125;    func decrement() &#123;        counter.count -= 1    &#125;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="View​">View<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#view" title="View的直接链接">​</a></h4>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUIstruct CounterView: View &#123;    @StateObject private var viewModel = CounterViewModel()    var body: some View &#123;        VStack(spacing: 20) &#123;            Text(&quot;Count: \(viewModel.counter.count)&quot;)                .font(.largeTitle)            HStack(spacing: 40) &#123;                Button(action: &#123;                    viewModel.decrement()                &#125;) &#123;                    Text(&quot;-&quot;)                        .font(.title)                        .frame(width: 60, height: 60)                        .background(Color.red)                        .foregroundColor(.white)                        .clipShape(Circle())                &#125;                Button(action: &#123;                    viewModel.increment()                &#125;) &#123;                    Text(&quot;+&quot;)                        .font(.title)                        .frame(width: 60, height: 60)                        .background(Color.green)                        .foregroundColor(.white)                        .clipShape(Circle())                &#125;            &#125;        &#125;        .padding()    &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>在这个示例中：</p>
<ul>
<li><strong>Model</strong>：<code>CounterModel</code> 包含一个 <code>count</code> 属性，表示当前计数值。</li>
<li><strong>ViewModel</strong>：<code>CounterViewModel</code> 作为 <code>ObservableObject</code>，管理 <code>CounterModel</code> 的实例，并提供 <code>increment</code> 和 <code>decrement</code> 方法来修改计数值。</li>
<li><strong>View</strong>：<code>CounterView</code> 使用 <code>@StateObject</code> 引用 <code>CounterViewModel</code>，并通过数据绑定 (<code>viewModel.counter.count</code>) 显示计数值，同时通过按钮调用 ViewModel 的方法来修改计数。</li>
</ul>
<h2 id="MVVM-架构关系图​">MVVM 架构关系图<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#mvvm-architecture-relationship-diagram" title="MVVM 架构关系图的直接链接">​</a></h2>
<p>以下图示展示了 MVVM 架构在 SwiftUI 中的关系：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph LR    Model --&gt; ViewModel    ViewModel --&gt; View    View --&gt; ViewModel</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Model</strong>：提供数据和业务逻辑。</li>
<li><strong>ViewModel</strong>：持有 Model 的实例，处理业务逻辑，并通过 <code>@Published</code> 属性将数据暴露给 View。</li>
<li><strong>View</strong>：通过 <code>@StateObject</code> 或 <code>@ObservedObject</code> 引用 ViewModel，使用数据绑定显示数据，并通过用户交互调用 ViewModel 的方法。</li>
</ul>
<h2 id="基于SwiftUI的项目如何设置MVVM​">基于SwiftUI的项目如何设置MVVM<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#how-to-set-up-mvvm-in-swiftui-projects" title="基于SwiftUI的项目如何设置MVVM的直接链接">​</a></h2>
<p>在 SwiftUI 项目中应用 MVVM 架构，可以按照以下步骤进行设置：</p>
<h3 id="1-创建-Model​">1. 创建 Model<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#1-%E5%88%9B%E5%BB%BA-model" title="1. 创建 Model的直接链接">​</a></h3>
<p>首先，定义应用程序的数据结构和业务逻辑。例如，一个简单的用户模型：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">User</span>: <span class="title class_ inherited__">Identifiable</span> &#123;    <span class="keyword">let</span> id: <span class="type">UUID</span>    <span class="keyword">let</span> name: <span class="type">String</span>    <span class="keyword">let</span> email: <span class="type">String</span>&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-创建-ViewModel​">2. 创建 ViewModel<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#2-%E5%88%9B%E5%BB%BA-viewmodel" title="2. 创建 ViewModel的直接链接">​</a></h3>
<p>创建一个 <code>ObservableObject</code> 类来管理 Model 的数据和业务逻辑：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combineclass UserViewModel: ObservableObject &#123;    @Published var users: [User] = []    func fetchUsers() &#123;        <span class="comment">// 模拟网络请求或数据获取        users = [            User(id: UUID(), name: &quot;Alice&quot;, email: &quot;alice@example.com&quot;),            User(id: UUID(), name: &quot;Bob&quot;, email: &quot;bob@example.com&quot;)        ]    &#125;    func addUser(name: String, email: String) &#123;        let newUser = User(id: UUID(), name: name, email: email)        users.append(newUser)    &#125;    func removeUser(at offsets: IndexSet) &#123;        users.remove(atOffsets: offsets)    &#125;&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-创建-View​">3. 创建 View<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#3-%E5%88%9B%E5%BB%BA-view" title="3. 创建 View的直接链接">​</a></h3>
<p>在 View 中引用 ViewModel 并使用数据绑定展示和操作数据：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUIstruct UserListView: View &#123;    @StateObject private var viewModel = UserViewModel()    var body: some View &#123;        NavigationView &#123;            List &#123;                ForEach(viewModel.users) &#123; user in                    VStack(alignment: .leading) &#123;                        Text(user.name)                            .font(.headline)                        Text(user.email)                            .font(.subheadline)                            .foregroundColor(.gray)                    &#125;                &#125;                .onDelete(perform: viewModel.removeUser)            &#125;            .navigationTitle(&quot;用户列表&quot;)            .navigationBarItems(trailing: Button(action: &#123;                viewModel.addUser(name: &quot;新用户&quot;, email: &quot;newuser@example.com&quot;)            &#125;) &#123;                Image(systemName: &quot;plus&quot;)            &#125;)            .onAppear &#123;                viewModel.fetchUsers()            &#125;        &#125;    &#125;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-组织项目结构​">4. 组织项目结构<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#4-%E7%BB%84%E7%BB%87%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84" title="4. 组织项目结构的直接链接">​</a></h3>
<p>为了更好地组织代码，建议按照 MVVM 的结构将项目分为不同的文件夹：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YourProject/├── Models/│   └── User.swift├── ViewModels/│   └── UserViewModel.swift├── Views/│   └── UserListView.swift└── YourProjectApp.swift</span><br></pre></td></tr></table></figure>
<h3 id="5-使用依赖注入（可选）​">5. 使用依赖注入（可选）<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#5-%E4%BD%BF%E7%94%A8%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E5%8F%AF%E9%80%89" title="5. 使用依赖注入（可选）的直接链接">​</a></h3>
<p>为了提高代码的可测试性和可扩展性，可以使用依赖注入将 ViewModel 注入到 View 中。例如：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">UserListView</span>: <span class="title class_ inherited__">View</span> &#123;    <span class="meta">@ObservedObject</span> <span class="keyword">var</span> viewModel: <span class="type">UserViewModel</span>    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;        <span class="comment">// 与之前相同    &#125;&#125;// 在入口处注入 ViewModelstruct YourProjectApp: App &#123;    var body: some Scene &#123;        WindowGroup &#123;            UserListView(viewModel: UserViewModel())        &#125;    &#125;&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="6-添加更多功能​">6. 添加更多功能<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#6-%E6%B7%BB%E5%8A%A0%E6%9B%B4%E5%A4%9A%E5%8A%9F%E8%83%BD" title="6. 添加更多功能的直接链接">​</a></h3>
<p>随着项目的发展，可以在 ViewModel 中添加更多的方法和属性，处理更复杂的业务逻辑，同时保持 View 的简洁和专注于展示。</p>
<h2 id="SwiftUI-术语汇总​">SwiftUI 术语汇总<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#swiftui-terminology-summary" title="SwiftUI 术语汇总的直接链接">​</a></h2>
<p>为了更好地理解 SwiftUI，以下是一些常见的术语及其解释：</p>
<ul>
<li><strong>声明式编程（Declarative Programming）</strong>：一种编程范式，开发者描述 UI 应该是什么样子，系统负责管理其状态和更新。</li>
<li><strong>视图（View）</strong>：SwiftUI 中的基本构建块，用于构建用户界面。</li>
<li><strong>修饰符（Modifier）</strong>：用于修改视图属性的方法，采用链式调用方式。</li>
<li><strong>布局容器（Layout Containers）</strong>：用于组织和布局视图的容器，如 <code>VStack</code>、<code>HStack</code>、<code>ZStack</code>。</li>
<li><strong>状态（State）</strong>：视图的数据源，影响视图的显示和行为。</li>
<li><strong>绑定（Binding）</strong>：一种双向数据流机制，使视图与其数据源保持同步。</li>
<li><strong>环境（Environment）</strong>：提供全局数据和配置，视图可以从环境中读取或写入数据。</li>
<li><strong>预览（Preview）</strong>：Xcode 提供的实时预览功能，允许开发者在编写代码时即时查看 UI 的变化。</li>
<li><strong><code>ObservableObject</code></strong>：一种可以被多个视图观察的对象，当其中的 <code>@Published</code> 属性发生变化时，视图会自动更新。</li>
<li><strong><code>@State</code></strong>：用于在视图内部存储和管理局部状态。</li>
<li><strong><code>@ObservedObject</code></strong>：用于在视图中观察外部的 <code>ObservableObject</code>，视图会在对象变化时自动更新。</li>
<li><strong><code>@EnvironmentObject</code></strong>：用于在多个视图中共享一个 <code>ObservableObject</code>，无需手动传递。</li>
</ul>
<h2 id="总结​">总结<a target="_blank" rel="noopener" href="https://yuxuetr.com/blog/2025/01/06/swiftui-intro#summary" title="总结的直接链接">​</a></h2>
<p>SwiftUI 以其声明式语法和强大的功能，正在迅速改变 iOS 和其他 Apple 平台的应用开发方式。理解 SwiftUI 的核心概念，如视图(View)、修饰符(Modifiers)、内置修饰符、如何自定义视图和组件化开发，是掌握这一框架的关键。通过引入 MVVM 架构，开发者可以进一步提升代码的可维护性和可测试性，构建出高效、可扩展的应用。</p>
<p>本文介绍了 SwiftUI 的基本概念和术语，展示了如何创建和使用自定义视图，并深入探讨了 MVVM 架构在 SwiftUI 中的实现方式。掌握这些知识后，你将能够在 SwiftUI 项目中应用最佳实践，打造出优雅且高效的用户界面。</p>
<p>继续深入学习 SwiftUI 的高级功能，如动画、数据绑定和自定义控件，将进一步提升你的开发技能，帮助你打造出更具吸引力和互动性的应用。</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../../2023/10/25/Swift/SwiftUI%E5%85%A8%E9%9D%A2%E6%8C%87%E5%8D%97-%E8%A7%86%E5%9B%BE-%E4%BF%AE%E9%A5%B0%E7%AC%A6-%E7%BB%84%E4%BB%B6%E4%B8%8EMVVM%E6%9E%B6%E6%9E%84/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../../2023/10/15/Swift/SwiftUI%E6%96%87%E6%A1%A3/"
                            aria-label=": SwiftUI文档"
                        >
                            SwiftUI文档
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2023-10-15T00:11:14+08:00">
	
		    2023 年 10 月 15 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../../categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a>, <a class="category-link" href="../../../categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/SwiftUI/">SwiftUI</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="SwiftUI简介">SwiftUI简介</h2>
<p><a href="#swiftui%E7%AE%80%E4%BB%8B"></a></p>
<p>SwiftUI是一种更为现代的编码方式，他可以为苹果任意平台声明用户界面。以更为快捷迅速的方式创建漂亮的动态应用程序！</p>
<p><img src="https://camo.githubusercontent.com/50a2f12c5e3282b365e3b2d61fb68268595f7d7cddb2a4cd5f96635465b50d72/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f313461663861316435352f35366133303432312d393863352d343365302d626666642d3630353038363539316235342e706e67" alt=""></p>
<h2 id="只需描述你的布局">只需描述你的布局</h2>
<p><a href="#%E5%8F%AA%E9%9C%80%E6%8F%8F%E8%BF%B0%E4%BD%A0%E7%9A%84%E5%B8%83%E5%B1%80"></a></p>
<blockquote>
<p>为视图的任何状态声明内容和布局。SwiftUI知道该状态何时更改，并更新视图，以匹配其呈现的状态。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">List</span>(landmarks) &#123; landmark <span class="keyword">in</span></span><br><span class="line">   <span class="type">HStack</span> &#123;</span><br><span class="line">      <span class="type">Image</span>(landmark.thumbnail)</span><br><span class="line">      <span class="type">Text</span>(landmark.name)</span><br><span class="line">      <span class="type">Spacer</span>()</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> landmark.isFavorite &#123;</span><br><span class="line">         <span class="type">Image</span>(systemName: <span class="string">&quot;star.fill&quot;</span>)</span><br><span class="line">            .foregroundColor(.yellow)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/dee4c4f45faeaf064a3d75f5f27440b630ebc284815a1853e8bcbbb84464a06a/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f636533613062393839302f63373266303838662d356265392d343661642d393234352d3163663862346337333561302e706e67" alt=""></p>
<h2 id="构建可重用组件">构建可重用组件</h2>
<p><a href="#%E6%9E%84%E5%BB%BA%E5%8F%AF%E9%87%8D%E7%94%A8%E7%BB%84%E4%BB%B6"></a></p>
<blockquote>
<p>将小的、单一职责的视图组合成更大、更复杂的界面。在为苹果任意平台设计的应用程序之间共享您的自定义视图。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">FeatureCard</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">   <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">   </span><br><span class="line">   <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">      landmark.featureImage</span><br><span class="line">         .resizable()</span><br><span class="line">         .aspectRatio(<span class="number">3</span><span class="operator">/</span><span class="number">2</span>, contentMode: .fit)</span><br><span class="line">         .overlay(<span class="type">TextOverlay</span>(landmark))</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/db8bb42a17bfee69c85380765cff44eb527695a3d8f4226e050412c8e8560ea7/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f373433623135333030352f38316534646632642d616333302d343662382d616633302d3332643063386636393334652e706e67" alt=""></p>
<h2 id="简化动画">简化动画</h2>
<p><a href="#%E7%AE%80%E5%8C%96%E5%8A%A8%E7%94%BB"></a></p>
<blockquote>
<p>创建平滑动画就像添加一个方法调用一样简单。SwiftUI会在需要时自动计算并设置过渡动画。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">VStack</span> &#123;</span><br><span class="line">   <span class="type">Badge</span>()</span><br><span class="line">      .frame(width: <span class="number">300</span>, height: <span class="number">300</span>)</span><br><span class="line">      .animation(.easeInOut())</span><br><span class="line">   <span class="type">Text</span>(name)</span><br><span class="line">      .font(.title)</span><br><span class="line">      .animation(.easeInOut())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/80023f3ab89eb740084dfd37d15b0f3de507b16b0a1d366cdc72d786d58de98d/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f643565623365656563612f32353961653665362d663231362d343064382d613065362d6134623036396263343733612e706e67" alt=""></p>
<h2 id="在Xcode中实时预览">在Xcode中实时预览</h2>
<p><a href="#%E5%9C%A8xcode%E4%B8%AD%E5%AE%9E%E6%97%B6%E9%A2%84%E8%A7%88"></a></p>
<blockquote>
<p>在不运行应用程序的情况下设计、生成和测试应用程序的界面。使用交互式预览测试控件和布局。</p>
</blockquote>
<p><img src="https://camo.githubusercontent.com/4a1a02a9323e98d568f2cd0b2db1c83597a545b034e8fbf89962f074a5ace9d2/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f616436373263363465662f64326236663133362d666537362d346336392d393564642d6433623232633364393833362e706e67" alt=""></p>
<h3 id="应用程序设计和布局">应用程序设计和布局</h3>
<p><a href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%B8%83%E5%B1%80"></a></p>
<h2 id="组合复杂界面">组合复杂界面</h2>
<p><a href="#%E7%BB%84%E5%90%88%E5%A4%8D%E6%9D%82%E7%95%8C%E9%9D%A2"></a></p>
<p>地标的首页显示一个滚动的分类列表，在每个分类中水平滚动地标。在构建此主导航时，您将探索组合视图如何适应不同的设备大小和方向。</p>
<blockquote>
<p>学习时间：20分钟</p>
<p><a target="_blank" rel="noopener" href="https://docs-assets.developer.apple.com/published/bbc4a40f38/ComposingComplexInterfaces.zip">下载地址：ComposingComplexInterfaces.zip</a></p>
</blockquote>
<h2 id="第一节-添加首页">第一节 添加首页</h2>
<p><a href="#%E7%AC%AC%E4%B8%80%E8%8A%82-%E6%B7%BB%E5%8A%A0%E9%A6%96%E9%A1%B5"></a></p>
<p>既然你已经拥有了地标应用程序所需的所有视图，现在是时候给它们一个首页了——一个统一视图页面。主视图不仅包含所有其他视图，还提供导航和显示地标的方法。</p>
<p><img src="https://camo.githubusercontent.com/184615ada53392d20cfc9a87dca89fb1debd1aa03cb7e5a80e83c3ae9ea570c9/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f376535393332306432332f36663364613762622d343666612d343766362d393466622d6335333734613466333438372e706e67" alt=""></p>
<h2 id="步骤1">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41"></a></p>
<p>在名为<code>Home.swift</code>的新文件中创建名为<code>CategoryHome</code>的自定义视图。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Landmarks Content&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/54f5c957e91cf81977c40f1f885a23db7b8ad1c39919f455a0d8b8bc9f86fe3d/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f363633356333383935622f34373266646266312d643765622d343864662d393265352d3835656161666339313464652e706e67" alt=""></p>
<h2 id="步骤2">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42"></a></p>
<p>修改<code>scene delegate</code>，使其显示新的<code>CategoryHome</code>视图而不是地标列表。</p>
<p>主视图是地标应用程序的根，因此它需要一种方式来呈现所有其他视图。</p>
<blockquote>
<p>SceneDelegate.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SceneDelegate</span>: <span class="title class_ inherited__">UIResponder</span>, <span class="title class_ inherited__">UIWindowSceneDelegate</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> window: <span class="type">UIWindow</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">scene</span>(<span class="keyword">_</span> <span class="params">scene</span>: <span class="type">UIScene</span>, <span class="params">willConnectTo</span> <span class="params">session</span>: <span class="type">UISceneSession</span>, <span class="params">options</span> <span class="params">connectionOptions</span>: <span class="type">UIScene</span>.<span class="type">ConnectionOptions</span>) &#123;</span><br><span class="line">        <span class="comment">// Use this method to optionally configure and attach the UIWindow `window` to the provided UIWindowScene `scene`.</span></span><br><span class="line">        <span class="comment">// If using a storyboard, the `window` property will automatically be initialized and attached to the scene.</span></span><br><span class="line">        <span class="comment">// This delegate does not imply the connecting scene or session are new (see `application:configurationForConnectingSceneSession` instead).</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Use a UIHostingController as window root view controller</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> windowScene <span class="operator">=</span> scene <span class="keyword">as?</span> <span class="type">UIWindowScene</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> window <span class="operator">=</span> <span class="type">UIWindow</span>(windowScene: windowScene)</span><br><span class="line">            window.rootViewController <span class="operator">=</span> <span class="type">UIHostingController</span>(</span><br><span class="line">                rootView: <span class="type">CategoryHome</span>()</span><br><span class="line">                    .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">self</span>.window <span class="operator">=</span> window</span><br><span class="line">            window.makeKeyAndVisible()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤3">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43"></a></p>
<p>添加<code>NavigationView</code>以在地标中承载不同的视图。</p>
<p>您可以使用<code>NavigationView</code>以及<code>NavigationLink</code>实例和相关修饰符在应用程序中构建导航层级结构。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Landmarks Content&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/54f5c957e91cf81977c40f1f885a23db7b8ad1c39919f455a0d8b8bc9f86fe3d/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f363633356333383935622f34373266646266312d643765622d343864662d393265352d3835656161666339313464652e706e67" alt=""></p>
<h2 id="步骤4">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44"></a></p>
<p>将导航栏的标题设置为“Featured”。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Landmarks Content&quot;</span>)</span><br><span class="line">                .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Featured&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/38292c3b58c1485c47ed763cb7c21032062389eed141c3556fb909779e4b6acd/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f333363626461306430662f33333064636463332d383334342d343038322d626561312d3230383065643838336331312e706e67" alt=""></p>
<h2 id="第二节-创建分类列表">第二节 创建分类列表</h2>
<p><a href="#%E7%AC%AC%E4%BA%8C%E8%8A%82-%E5%88%9B%E5%BB%BA%E5%88%86%E7%B1%BB%E5%88%97%E8%A1%A8"></a></p>
<p>Landmarks应用程序将所有分类显示在垂直列中的单独行中，以便于浏览。通过组合垂直和水平堆栈，并向列表中添加滚动条，就可以完成此操作。</p>
<p><img src="https://camo.githubusercontent.com/7120019785703b47c78c069692aec1fcfe5a273eec32bcdd53210d87fb6ba90a/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f656534353539633136342f33393836383833322d363861322d346431622d623532382d3935346337623063616237612e706e67" alt=""></p>
<h2 id="步骤1-2">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-1"></a></p>
<p>使用<code>Dictionary</code>结构的<code>init（grouping:by:）</code>方法将地标分组到类别中，输入地标的category属性。</p>
<p>初始化项目文件给每个示例地标预设了类别。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categories: [<span class="type">String</span>: [<span class="type">Landmark</span>]] &#123;</span><br><span class="line">        <span class="type">Dictionary</span>(</span><br><span class="line">            grouping: landmarkData,</span><br><span class="line">            by: &#123; <span class="variable">$0</span>.category.rawValue &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Landmarks Content&quot;</span>)</span><br><span class="line">                .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Featured&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤2-2">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-1"></a></p>
<blockquote>
<p>使用列表在地标中显示分类。</p>
</blockquote>
<p><code>Landmark.Category</code>会匹配列表中每一项<code>name</code>，这些项在其他类别中必须是唯一的，因为它是枚举。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categories: [<span class="type">String</span>: [<span class="type">Landmark</span>]] &#123;</span><br><span class="line">        <span class="type">Dictionary</span>(</span><br><span class="line">            grouping: landmarkData,</span><br><span class="line">            by: &#123; <span class="variable">$0</span>.category.rawValue &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">ForEach</span>(categories.keys.sorted(), id: \.<span class="keyword">self</span>) &#123; key <span class="keyword">in</span></span><br><span class="line">                    <span class="type">Text</span>(key)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Featured&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/5eb1be4e6a5a6054754c674e55cb96a964eb5e4714371dafcd8e89bc27881bc7/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f613835663032383466332f34363066653135362d643264372d343166392d613632652d3438366362653333633430642e706e67" alt=""></p>
<h2 id="第三节-添加地标行">第三节 添加地标行</h2>
<p><a href="#%E7%AC%AC%E4%B8%89%E8%8A%82-%E6%B7%BB%E5%8A%A0%E5%9C%B0%E6%A0%87%E8%A1%8C"></a></p>
<p>地标在水平滚动的行中显示每个类别。添加一个新的视图类型来表示行，然后在新视图中显示该类别的所有地标。</p>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/add-rows-landmarks.gif" alt=""></p>
<h2 id="步骤1-3">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-2"></a></p>
<p>定义用于保存行内容的新自定义视图。</p>
<p>这个视图需要存储地标的类别信息，以及地标本身。</p>
<blockquote>
<p>CategoryRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categoryName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> items: [<span class="type">Landmark</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="keyword">self</span>.categoryName)</span><br><span class="line">            .font(.headline)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryRow</span>(</span><br><span class="line">            categoryName: landmarkData[<span class="number">0</span>].category.rawValue,</span><br><span class="line">            items: <span class="type">Array</span>(landmarkData.prefix(<span class="number">3</span>))</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/069c759e8f0e65c0d2124cc0b667fc95e5c4e633e4c9787d2ce9a9c5a0c96636/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f616138396332313066362f39373033303036332d323462332d343436642d393765312d3062613339633662653638352e706e67" alt=""></p>
<h2 id="步骤2-3">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-2"></a></p>
<p>更新<code>CategoryHome</code>的主体以将类别信息传递给新的行类型。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categories: [<span class="type">String</span>: [<span class="type">Landmark</span>]] &#123;</span><br><span class="line">        <span class="type">Dictionary</span>(</span><br><span class="line">            grouping: landmarkData,</span><br><span class="line">            by: &#123; <span class="variable">$0</span>.category.rawValue &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">ForEach</span>(categories.keys.sorted(), id: \.<span class="keyword">self</span>) &#123; key <span class="keyword">in</span></span><br><span class="line">                    <span class="type">CategoryRow</span>(categoryName: key, items: <span class="keyword">self</span>.categories[key]<span class="operator">!</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Featured&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/bdb471f842daedd8a7647f492ee2f3fb8b486f551a25de7040e4ce8ce165ce89/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f383339656466653062612f63353338646139342d626338642d343065312d383962302d3961646162656464303231372e706e67" alt=""></p>
<h2 id="步骤3-2">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-1"></a></p>
<p>在<code>HStack</code>中显示该类别的地标。</p>
<blockquote>
<p>CategoryRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categoryName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> items: [<span class="type">Landmark</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span>(alignment: .top, spacing: <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">ForEach</span>(<span class="keyword">self</span>.items) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="type">Text</span>(landmark.name)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryRow</span>(</span><br><span class="line">            categoryName: landmarkData[<span class="number">0</span>].category.rawValue,</span><br><span class="line">            items: <span class="type">Array</span>(landmarkData.prefix(<span class="number">3</span>))</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/a9cf0d35dc0309d88acd3589ab689a899d0bbcb5737608bd04700958e1a59487/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f323062303265316264332f62373333313039622d646231622d346364622d616666332d6665373463616235316335362e706e67" alt=""></p>
<h2 id="步骤4-2">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-1"></a></p>
<blockquote>
<p>通过指定一个<code>frame(width:height:)</code> 并在<code>scrollView</code>中包装<code>stack</code>，为行提供空间。</p>
</blockquote>
<p>使用长数据样本更新视图预览，以便确保可以滚动。</p>
<blockquote>
<p>CategoryRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categoryName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> items: [<span class="type">Landmark</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="keyword">self</span>.categoryName)</span><br><span class="line">                .font(.headline)</span><br><span class="line">                .padding(.leading, <span class="number">15</span>)</span><br><span class="line">                .padding(.top, <span class="number">5</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">ScrollView</span>(.horizontal, showsIndicators: <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="type">HStack</span>(alignment: .top, spacing: <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="type">ForEach</span>(<span class="keyword">self</span>.items) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                        <span class="type">Text</span>(landmark.name)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .frame(height: <span class="number">185</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryRow</span>(</span><br><span class="line">            categoryName: landmarkData[<span class="number">0</span>].category.rawValue,</span><br><span class="line">            items: <span class="type">Array</span>(landmarkData.prefix(<span class="number">4</span>))</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/e8ce0ea8112e7c3538c644771ed4fa10378b87dd3c1f18b0e655de62cf6e6ef8/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f333962653830646332652f38393332346134322d363966652d343431652d386433312d3138633736346163326630392e706e67" alt=""></p>
<h2 id="第四节-组成主页">第四节 组成主页</h2>
<p><a href="#%E7%AC%AC%E5%9B%9B%E8%8A%82-%E7%BB%84%E6%88%90%E4%B8%BB%E9%A1%B5"></a></p>
<p>地标应用程序的主页需要显示地标的简单信息，然后用户点击其中一个更多进入详情视图。</p>
<p>重新使用在<code>Creating and Combining Views</code>中的视图来创建更简单的视图预览，以显示地标的分类和特征。</p>
<p><img src="https://camo.githubusercontent.com/21440c60f467abd9344efabb42a4355c9aaeb6e8098b937a3aeee23b36617f84/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393633353563666336382f33333739633736382d646334652d346464382d393831622d3132363661656337626436302e706e67" alt=""></p>
<h2 id="步骤1-4">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-3"></a></p>
<p>在<code>CategoryRow</code>旁边创建一个名为<code>CategoryItem</code>的新自定义视图，并用新视图替换<code>Text</code>视图。</p>
<blockquote>
<p>CategoryRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categoryName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> items: [<span class="type">Landmark</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="keyword">self</span>.categoryName)</span><br><span class="line">                .font(.headline)</span><br><span class="line">                .padding(.leading, <span class="number">15</span>)</span><br><span class="line">                .padding(.top, <span class="number">5</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">ScrollView</span>(.horizontal, showsIndicators: <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="type">HStack</span>(alignment: .top, spacing: <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="type">ForEach</span>(<span class="keyword">self</span>.items) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                        <span class="type">CategoryItem</span>(landmark: landmark)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .frame(height: <span class="number">185</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryItem</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            landmark.image</span><br><span class="line">                .resizable()</span><br><span class="line">                .frame(width: <span class="number">155</span>, height: <span class="number">155</span>)</span><br><span class="line">                .cornerRadius(<span class="number">5</span>)</span><br><span class="line">            <span class="type">Text</span>(landmark.name)</span><br><span class="line">                .font(.caption)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding(.leading, <span class="number">15</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryRow</span>(</span><br><span class="line">            categoryName: landmarkData[<span class="number">0</span>].category.rawValue,</span><br><span class="line">            items: <span class="type">Array</span>(landmarkData.prefix(<span class="number">4</span>))</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/2b64d2d3c0a6cb1df0563ac00675ac7fe79866129a6b72ad645bf27e0a40114e/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f396437366637373030632f36613362336335632d333465622d346637322d393363362d6136666634383831376535622e706e67" alt=""></p>
<h2 id="步骤2-4">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-3"></a></p>
<blockquote>
<p>在<code>Home.swift</code>中，添加一个名为<code>FeaturedLandmarks</code>的简单视图，该视图仅显示标记为<code>isFeatured</code>的地标。</p>
</blockquote>
<p>在后面的教程中，您将把此视图转换为可交互的轮播视图。目前，它显示了一个裁剪和缩放后的预览图像。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categories: [<span class="type">String</span>: [<span class="type">Landmark</span>]] &#123;</span><br><span class="line">        <span class="type">Dictionary</span>(</span><br><span class="line">            grouping: landmarkData,</span><br><span class="line">            by: &#123; <span class="variable">$0</span>.category.rawValue &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> featured: [<span class="type">Landmark</span>] &#123;</span><br><span class="line">        landmarkData.filter &#123; <span class="variable">$0</span>.isFeatured &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">FeaturedLandmarks</span>(landmarks: featured)</span><br><span class="line">                    .scaledToFill()</span><br><span class="line">                    .frame(height: <span class="number">200</span>)</span><br><span class="line">                    .clipped()</span><br><span class="line">                <span class="type">ForEach</span>(categories.keys.sorted(), id: \.<span class="keyword">self</span>) &#123; key <span class="keyword">in</span></span><br><span class="line">                    <span class="type">CategoryRow</span>(categoryName: key, items: <span class="keyword">self</span>.categories[key]<span class="operator">!</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Featured&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FeaturedLandmarks</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmarks: [<span class="type">Landmark</span>]</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        landmarks[<span class="number">0</span>].image.resizable()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/c27fa8ef7828faa6d7edbf28a2d0c0d69aff9c57cccecb7534739101ac917d36/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f643037636165393339372f35363235656139652d366533362d343237302d396434342d3833303262373338623965352e706e67" alt=""></p>
<h2 id="步骤3-3">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-2"></a></p>
<p>在两种地标预览中将<code>edge insets</code>设置为零，以便内容可以延伸到屏幕边缘。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categories: [<span class="type">String</span>: [<span class="type">Landmark</span>]] &#123;</span><br><span class="line">        <span class="type">Dictionary</span>(</span><br><span class="line">            grouping: landmarkData,</span><br><span class="line">            by: &#123; <span class="variable">$0</span>.category.rawValue &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> featured: [<span class="type">Landmark</span>] &#123;</span><br><span class="line">        landmarkData.filter &#123; <span class="variable">$0</span>.isFeatured &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">FeaturedLandmarks</span>(landmarks: featured)</span><br><span class="line">                    .scaledToFill()</span><br><span class="line">                    .frame(height: <span class="number">200</span>)</span><br><span class="line">                    .clipped()</span><br><span class="line">                    .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">                </span><br><span class="line">                <span class="type">ForEach</span>(categories.keys.sorted(), id: \.<span class="keyword">self</span>) &#123; key <span class="keyword">in</span></span><br><span class="line">                    <span class="type">CategoryRow</span>(categoryName: key, items: <span class="keyword">self</span>.categories[key]<span class="operator">!</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Featured&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FeaturedLandmarks</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmarks: [<span class="type">Landmark</span>]</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        landmarks[<span class="number">0</span>].image.resizable()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/831721aa7e9c7e63bc5581baf34fc71750b0640cf5ca4858edb809a9a66d5c8e/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f386566623439346239622f35303266326431382d353737342d343339642d613363312d6238623235653635613737392e706e67" alt=""></p>
<h2 id="第五节-在分区之间添加导航">第五节 在分区之间添加导航</h2>
<p><a href="#%E7%AC%AC%E4%BA%94%E8%8A%82-%E5%9C%A8%E5%88%86%E5%8C%BA%E4%B9%8B%E9%97%B4%E6%B7%BB%E5%8A%A0%E5%AF%BC%E8%88%AA"></a></p>
<p>现在，在主页中可以看到所有不同分类的地标，用户需要一种方法来访问应用程序中的每个部分。使用<code>navigation</code>和<code>presentation Apis</code>可以从主页导航到地标详情页，收藏夹和用户主页。</p>
<p><img src="https://camo.githubusercontent.com/1f94b160bf9d8ebe7bffc2e41a8436d80be58391dab2416ccffb4e483581bc4a/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f626331313837333131302f32626231326135312d323733652d346663382d613131362d3736656664393039316432342e706e67" alt=""></p>
<h2 id="步骤1-5">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-4"></a></p>
<p>在<code>CategoryRow.swift</code>中，用<code>NavigationLink</code>包装现有的<code>CategoryItem</code>。</p>
<p>类别项本身是按钮的<code>label</code>，其目的地是显示地标详情视图。</p>
<blockquote>
<p>CategoryRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categoryName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> items: [<span class="type">Landmark</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="keyword">self</span>.categoryName)</span><br><span class="line">                .font(.headline)</span><br><span class="line">                .padding(.leading, <span class="number">15</span>)</span><br><span class="line">                .padding(.top, <span class="number">5</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">ScrollView</span>(.horizontal, showsIndicators: <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="type">HStack</span>(alignment: .top, spacing: <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="type">ForEach</span>(<span class="keyword">self</span>.items) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                        <span class="type">NavigationLink</span>(</span><br><span class="line">                            destination: <span class="type">LandmarkDetail</span>(</span><br><span class="line">                                landmark: landmark</span><br><span class="line">                            )</span><br><span class="line">                        ) &#123;</span><br><span class="line">                            <span class="type">CategoryItem</span>(landmark: landmark)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .frame(height: <span class="number">185</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryItem</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            landmark.image</span><br><span class="line">                .resizable()</span><br><span class="line">                .frame(width: <span class="number">155</span>, height: <span class="number">155</span>)</span><br><span class="line">                .cornerRadius(<span class="number">5</span>)</span><br><span class="line">            <span class="type">Text</span>(landmark.name)</span><br><span class="line">                .font(.caption)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding(.leading, <span class="number">15</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryRow</span>(</span><br><span class="line">            categoryName: landmarkData[<span class="number">0</span>].category.rawValue,</span><br><span class="line">            items: <span class="type">Array</span>(landmarkData.prefix(<span class="number">4</span>))</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/413ae130993f87716ab70d4d0574fe3561803a3f47e139045d361a81f18d456c/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f626638383932343062352f36643763346262372d343338312d343863332d616132372d3234613666383933626138622e706e67" alt=""></p>
<p><em><strong>注意</strong></em></p>
<blockquote>
<p>在<code>Xcode11 beta 6</code>中，如果在列表中嵌套一个<code>ScrollView</code>，并且该<code>ScrollView</code>包含一个<code>NavigationLink</code>，那么当用户点击<code>NavigationLink</code>时，这些<code>NavigationLink</code>不会导航到目标视图。</p>
</blockquote>
<h2 id="步骤2-5">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-4"></a></p>
<p>通过应用<code>renderingMode（:）</code>和<code>foregroundColor（:）</code>修饰符更改导航外观。</p>
<p>作为<code>NavigationLink</code>的<code>label</code>传递的文本使用环境的强调色进行渲染，而图像可能被作为<code>template images</code>进行渲染。您可以修改任一行为以最适合您的设计。</p>
<blockquote>
<p>CategoryRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categoryName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> items: [<span class="type">Landmark</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="keyword">self</span>.categoryName)</span><br><span class="line">                .font(.headline)</span><br><span class="line">                .padding(.leading, <span class="number">15</span>)</span><br><span class="line">                .padding(.top, <span class="number">5</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">ScrollView</span>(.horizontal, showsIndicators: <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="type">HStack</span>(alignment: .top, spacing: <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="type">ForEach</span>(<span class="keyword">self</span>.items) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                        <span class="type">NavigationLink</span>(</span><br><span class="line">                            destination: <span class="type">LandmarkDetail</span>(</span><br><span class="line">                                landmark: landmark</span><br><span class="line">                            )</span><br><span class="line">                        ) &#123;</span><br><span class="line">                            <span class="type">CategoryItem</span>(landmark: landmark)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .frame(height: <span class="number">185</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryItem</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            landmark.image</span><br><span class="line">                .renderingMode(.original)</span><br><span class="line">                .resizable()</span><br><span class="line">                .frame(width: <span class="number">155</span>, height: <span class="number">155</span>)</span><br><span class="line">                .cornerRadius(<span class="number">5</span>)</span><br><span class="line">            <span class="type">Text</span>(landmark.name)</span><br><span class="line">                .foregroundColor(.primary)</span><br><span class="line">                .font(.caption)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding(.leading, <span class="number">15</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryRow</span>(</span><br><span class="line">            categoryName: landmarkData[<span class="number">0</span>].category.rawValue,</span><br><span class="line">            items: <span class="type">Array</span>(landmarkData.prefix(<span class="number">4</span>))</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/40ad0aeb189cf55a35d268d0f4b94c0babc84183acc947084cf997dc37dc3a5a/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f396434333530393631332f64393931623434362d316436642d343164362d623662632d3935306637376133363534352e706e67" alt=""></p>
<h2 id="步骤3-4">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-3"></a></p>
<blockquote>
<p>在<code>Home.swift</code>中，点击选项卡栏中的简介图标后，添加一个模态视图以显示用户简介页面。</p>
</blockquote>
<p>当<code>showProfile</code>状态变量设置为<code>true</code>时，SwiftUI显示用户简介占位符，当用户关闭模态时，将<code>showProfile</code>设置回<code>false</code>。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categories: [<span class="type">String</span>: [<span class="type">Landmark</span>]] &#123;</span><br><span class="line">        <span class="type">Dictionary</span>(</span><br><span class="line">            grouping: landmarkData,</span><br><span class="line">            by: &#123; <span class="variable">$0</span>.category.rawValue &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> featured: [<span class="type">Landmark</span>] &#123;</span><br><span class="line">        landmarkData.filter &#123; <span class="variable">$0</span>.isFeatured &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showingProfile <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">FeaturedLandmarks</span>(landmarks: featured)</span><br><span class="line">                    .scaledToFill()</span><br><span class="line">                    .frame(height: <span class="number">200</span>)</span><br><span class="line">                    .clipped()</span><br><span class="line">                    .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">                </span><br><span class="line">                <span class="type">ForEach</span>(categories.keys.sorted(), id: \.<span class="keyword">self</span>) &#123; key <span class="keyword">in</span></span><br><span class="line">                    <span class="type">CategoryRow</span>(categoryName: key, items: <span class="keyword">self</span>.categories[key]<span class="operator">!</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Featured&quot;</span>))</span><br><span class="line">            .sheet(isPresented: <span class="variable">$showingProfile</span>) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;User Profile&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FeaturedLandmarks</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmarks: [<span class="type">Landmark</span>]</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        landmarks[<span class="number">0</span>].image.resizable()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/831721aa7e9c7e63bc5581baf34fc71750b0640cf5ca4858edb809a9a66d5c8e/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f386566623439346239622f35303266326431382d353737342d343339642d613363312d6238623235653635613737392e706e67" alt=""></p>
<h2 id="步骤4-3">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-2"></a></p>
<p>在导航栏中添加一个按钮，在点击时将<code>showProfile</code>从<code>false</code>切换为<code>true</code>。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categories: [<span class="type">String</span>: [<span class="type">Landmark</span>]] &#123;</span><br><span class="line">        .<span class="keyword">init</span>(</span><br><span class="line">            grouping: landmarkData,</span><br><span class="line">            by: &#123; <span class="variable">$0</span>.category.rawValue &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> featured: [<span class="type">Landmark</span>] &#123;</span><br><span class="line">        landmarkData.filter &#123; <span class="variable">$0</span>.isFeatured &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showingProfile <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> profileButton: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span>(action: &#123; <span class="keyword">self</span>.showingProfile.toggle() &#125;) &#123;</span><br><span class="line">            <span class="type">Image</span>(systemName: <span class="string">&quot;person.crop.circle&quot;</span>)</span><br><span class="line">                .imageScale(.large)</span><br><span class="line">                .accessibility(label: <span class="type">Text</span>(<span class="string">&quot;User Profile&quot;</span>))</span><br><span class="line">                .padding()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">FeaturedLandmarks</span>(landmarks: featured)</span><br><span class="line">                    .scaledToFill()</span><br><span class="line">                    .frame(height: <span class="number">200</span>)</span><br><span class="line">                    .clipped()</span><br><span class="line">                    .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">                </span><br><span class="line">                <span class="type">ForEach</span>(categories.keys.sorted(), id: \.<span class="keyword">self</span>) &#123; key <span class="keyword">in</span></span><br><span class="line">                    <span class="type">CategoryRow</span>(categoryName: key, items: <span class="keyword">self</span>.categories[key]<span class="operator">!</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Featured&quot;</span>))</span><br><span class="line">            .navigationBarItems(trailing: profileButton)</span><br><span class="line">            .sheet(isPresented: <span class="variable">$showingProfile</span>) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;User Profile&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FeaturedLandmarks</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmarks: [<span class="type">Landmark</span>]</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        landmarks[<span class="number">0</span>].image(forSize: <span class="number">250</span>).resizable()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/20e42fa057151b611d238df3d90aa348ae9bb00c5f7428fed435d8e6e846acb2/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f643335366365656333652f33346566363964332d356333382d346166392d613266632d6232373930393863653934312e706e67" alt=""></p>
<h2 id="步骤5">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45"></a></p>
<p>通过添加导航链接完成主页，该链接指向可过滤所有地标的列表。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categories: [<span class="type">String</span>: [<span class="type">Landmark</span>]] &#123;</span><br><span class="line">        <span class="type">Dictionary</span>(</span><br><span class="line">            grouping: landmarkData,</span><br><span class="line">            by: &#123; <span class="variable">$0</span>.category.rawValue &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> featured: [<span class="type">Landmark</span>] &#123;</span><br><span class="line">        landmarkData.filter &#123; <span class="variable">$0</span>.isFeatured &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showingProfile <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> profileButton: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span>(action: &#123; <span class="keyword">self</span>.showingProfile.toggle() &#125;) &#123;</span><br><span class="line">            <span class="type">Image</span>(systemName: <span class="string">&quot;person.crop.circle&quot;</span>)</span><br><span class="line">                .imageScale(.large)</span><br><span class="line">                .accessibility(label: <span class="type">Text</span>(<span class="string">&quot;User Profile&quot;</span>))</span><br><span class="line">                .padding()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">FeaturedLandmarks</span>(landmarks: featured)</span><br><span class="line">                    .scaledToFill()</span><br><span class="line">                    .frame(height: <span class="number">200</span>)</span><br><span class="line">                    .clipped()</span><br><span class="line">                    .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">                </span><br><span class="line">                <span class="type">ForEach</span>(categories.keys.sorted(), id: \.<span class="keyword">self</span>) &#123; key <span class="keyword">in</span></span><br><span class="line">                    <span class="type">CategoryRow</span>(categoryName: key, items: <span class="keyword">self</span>.categories[key]<span class="operator">!</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">                </span><br><span class="line">                <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkList</span>()) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;See All&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Featured&quot;</span>))</span><br><span class="line">            .navigationBarItems(trailing: profileButton)</span><br><span class="line">            .sheet(isPresented: <span class="variable">$showingProfile</span>) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;User Profile&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FeaturedLandmarks</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmarks: [<span class="type">Landmark</span>]</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        landmarks[<span class="number">0</span>].image.resizable()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/20e42fa057151b611d238df3d90aa348ae9bb00c5f7428fed435d8e6e846acb2/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f643335366365656333652f33346566363964332d356333382d346166392d613266632d6232373930393863653934312e706e67" alt=""></p>
<h2 id="步骤6">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46"></a></p>
<p>在<code>LandmarkList.swift</code>中，删除包装地标列表的<code>NavigationView</code>，并将其添加到预览中。</p>
<p>在应用程序的环境中，<code>LandmarkList</code>将始终显示在<code>Home.swift</code>中声明的导航视图中。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Toggle</span>(isOn: <span class="variable">$userData</span>.showFavoritesOnly) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Favorites only&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">ForEach</span>(userData.landmarks) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.userData.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                    <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                        <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">LandmarkList</span>()</span><br><span class="line">                .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/b0e1c3a23091ea24ef4d8d54ada6adab9df6a85711ac1bb2a693acd7c7d76eed/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f633562616130616431332f64353737316334622d333738372d343964332d623065312d3732373731396438353463332e706e67" alt=""></p>
<blockquote>
<p>SwiftUI纲要</p>
</blockquote>
<h2 id="创建和组织视图">创建和组织视图</h2>
<p><a href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E7%BB%84%E7%BB%87%E8%A7%86%E5%9B%BE"></a></p>
<blockquote>
<p>本教程将指导您构建一个iOS应用程序——<code>Landmarks(地标)</code>，用于发现和分享您喜欢的地方。首先，您将构建显示<code>Landmark</code>的详情页面。</p>
<p>为了布局视图，&quot;地标&quot;使用<code>stacks</code>来对<code>image、text</code>等组件进行组织和分层。要将地图添加到视图中，需要包含一个标准的<code>MapKit</code>组件。当您优化视图的设计时，Xcode提供实时反馈，这样当您修改代码时，就可以看到视图状态的改变。</p>
<p>下载项目文件开始构建此项目，并按照以下步骤操作：</p>
<p>学习时长：40分钟</p>
<p><a target="_blank" rel="noopener" href="https://docs-assets.developer.apple.com/published/c2c7dffe44/CreatingAndCombiningViews.zip">下载示例：CreatingAndCombiningViews.zip</a></p>
</blockquote>
<h2 id="第一节-创建新项目并浏览画布">第一节 创建新项目并浏览画布</h2>
<p><a href="#%E7%AC%AC%E4%B8%80%E8%8A%82-%E5%88%9B%E5%BB%BA%E6%96%B0%E9%A1%B9%E7%9B%AE%E5%B9%B6%E6%B5%8F%E8%A7%88%E7%94%BB%E5%B8%83"></a></p>
<p>创建一个使用SwiftUI的新Xcode项目。浏览画布、预览和SwiftUI模板代码。</p>
<blockquote>
<p><strong>要在Xcode中预览画布上的视图并与之交互，请确保Mac运行的是macOS Catalina 10.15。</strong></p>
</blockquote>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/create-new-project.gif" alt=""></p>
<h2 id="步骤一">步骤一</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80"></a></p>
<p>打开Xcode并在Xcode的启动窗口中单击<code>Create a new Xcode</code>项目，或者选择<code>File&gt;new&gt;project</code>。</p>
<p><img src="https://camo.githubusercontent.com/b896251a7bdc07ba857696a99dc6fe59bd89c8137cad7757cfc61f738c7e0b7e/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f383662333734366539622f65326236646630632d393035632d343533652d396436372d3137646463386536633632632e706e67" alt=""></p>
<h2 id="步骤二">步骤二</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C"></a></p>
<p>在模板选择器中，选择iOS平台，选择单视图应用程序模板，然后单击下一步。</p>
<p><img src="https://camo.githubusercontent.com/19b7163f0fce23e86f191a5d33a73f483bdfb3878bb8d03b039105b99a96282d/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f306431393839386237652f30366538306666312d343766322d343638652d613331622d3165373732333234316432352e706e67" alt=""></p>
<h2 id="步骤三">步骤三</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%89"></a></p>
<p>输入“Landmarks”作为产品名称，选中Use SwiftUI复选框，然后单击Next。选择一个路径来保存你的项目。</p>
<p><img src="https://camo.githubusercontent.com/5d1aaa88b7134b13f5b631ddfaca5371751fcd696a290fa7f4033ca10c6318aa/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f646164623566636264312f33356231633834642d313236652d343732632d393833392d3934623563316362636139312e706e67" alt=""></p>
<h2 id="步骤四">步骤四</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B"></a></p>
<p>在项目导航器中，单击以选择ContentView.swift。</p>
<p>默认情况下，SwiftUI视图文件声明两个结构。第一个结构实现了视图的必选协议，并描述了视图的内容和布局。第二个结构声明了该视图的预览。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/fa45c038604e470f340bc372a0be18df3fd2d59834b19100ff37f1892ce03b03/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f653063306239396461652f39623666363131622d313464662d343539322d613937372d3037383462653861373639352e706e67" alt=""></p>
<h2 id="步骤五">步骤五</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%94"></a></p>
<p>在画布中，单击<code>Resume</code>以显示预览。</p>
<blockquote>
<p>Tips:如果画布不可见，请选择<code>Editor &gt; Editor and Canvas</code>以显示它。</p>
</blockquote>
<p><img src="https://camo.githubusercontent.com/5aca50837582794c53801557c660bfbff1dfcf7f63a32ef319ba404a38abae1c/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663239623761393030382f65343364363039312d643238612d343433372d396231622d3062643566376664656533382e706e67" alt=""></p>
<h2 id="步骤六">步骤六</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%85%AD"></a></p>
<p>在<code>body</code>属性中，将“Hello World”更改为自己的问候语。</p>
<p>当您在视图的<code>body</code>属性中更改代码时，预览将更新以反映您的更改。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello SwiftUI!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/44805c99d5837b9b3e39aefbd74ea383346bd97981c351ddc6b74ff2e9b01237/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393839373063306139622f65333334313835362d633766382d346539612d626133362d6336633731346536346263312e706e67" alt=""></p>
<h2 id="第二节-自定义文本视图">第二节 自定义文本视图</h2>
<p><a href="#%E7%AC%AC%E4%BA%8C%E8%8A%82-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%87%E6%9C%AC%E8%A7%86%E5%9B%BE"></a></p>
<p>您可以通过更改代码，或使用检查器查看可用的内容，并帮助您编写代码，来自定义视图的显示。</p>
<p>构建<code>Lanmarks</code>应用程序时，可以使用任意编辑器组合：源码编辑、画布或检查器。无论使用哪种工具，代码都会保持更新。</p>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/customize-text-view.gif" alt=""></p>
<blockquote>
<p>接下来，您将使用检查器自定义文本视图。</p>
</blockquote>
<h2 id="步骤一-2">步骤一</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80-1"></a></p>
<p>在预览中，按住<code>command</code>并单击问候语以打开结构化编辑弹出窗口，然后选择<code>Inspect</code>。</p>
<p>弹出窗口显示可自定义的不同属性，具体取决于所检查的视图类型。</p>
<p><img src="https://camo.githubusercontent.com/acbaddebaf9e02fd1f3e2f3b3af218dd010b855bff9c6ba4e3a47a513627a423/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f616563353330636561362f30616238393338352d376638352d346136382d616562312d3039313938313434316334312e706e67" alt=""></p>
<h2 id="步骤二-2">步骤二</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C-1"></a></p>
<p>使用检查器将文本更改为“Turtle Rock”，即您将在应用程序中显示的第一个地标的名称。</p>
<p><img src="https://camo.githubusercontent.com/d9ee74324dc0900cb1d7b27792990c0a5fe2b36ed66a8552040d3dfb92bb9db7/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f353132306265303465352f63376639613030632d383738382d346133322d623036612d6466376433663961373933632e706e67" alt=""></p>
<h2 id="步骤三-2">步骤三</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%89-1"></a></p>
<p>将<code>font</code>更改为<code>Title</code>。</p>
<p>这会将系统字体应用于该文本，以便它正确适应用户系统偏好的字体大小和设置。</p>
<p><img src="https://camo.githubusercontent.com/9f18c4a616058131c5077547c4cf0f8f7b1f751e953938c806ff95f06c9438ff/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f666234633137313966632f33646464633932322d366666382d343566322d383733662d6634303030623434343339332e706e67" alt=""></p>
<blockquote>
<p>要自定义SwiftUI视图，可以调用名为<code>修饰符(modifier)</code>的方法。修饰符会包装视图以更改其显示或其他属性。每个修饰符都返回一个新视图，因此通常采用垂直的链式调用多个修饰符。</p>
</blockquote>
<h2 id="步骤四-2">步骤四</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B-1"></a></p>
<p>手动编辑代码添加<code>foregroundColor（.green）</code>修饰符；这会将文本的颜色更改为绿色。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">            .font(.title)</span><br><span class="line">            .foregroundColor(.green)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/97b308c4d6e5a26f949326cd1c00522d99a24940351288718961acd8f9aa4960/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f386535333035373431652f38386637373732342d666565382d346437312d383166382d3437336530616433616264352e706e67" alt=""></p>
<blockquote>
<p>您的代码始终真实反应到视图上。因此当使用检查器更改或移除修饰符时，Xcode会立即更新视图以匹配代码。</p>
</blockquote>
<h2 id="步骤五-2">步骤五</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%94-1"></a></p>
<p>然后我们在代码编辑区，按住<code>command</code>并单击<code>Text</code>来打开检查器，然后从弹出窗口中选择<code>Inspect</code>。单击<code>Color</code>弹出菜单，然后选择<code>Inherited</code> , 将文本颜色再次更改为黑色。</p>
<p><img src="https://camo.githubusercontent.com/c6327d9f8d1dbb1700ba90424a6ed8a8a0271fa26ea928c91a742c5f5477d6be/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f623433666439633531372f66303162373931302d633362302d346630652d386261612d3632366662393833376635612e706e67" alt=""></p>
<h2 id="步骤六-2">步骤六</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%85%AD-1"></a></p>
<p>请注意，Xcode会自动更新代码以反映您的更改，并删除<code>foregroundColor（.green）</code>修饰符。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">            .font(.title)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/96956a9d68ddac2e1dc6eb288b7ab3b6fe704f1eb96d889b3b131640d3f0bcf4/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f666562336666316666642f65323464393030352d333134392d346635382d383432392d3965646330383935366433362e706e67" alt=""></p>
<h2 id="第三节">第三节</h2>
<p><a href="#%E7%AC%AC%E4%B8%89%E8%8A%82"></a></p>
<h2 id="使用堆栈组合视图">使用堆栈组合视图</h2>
<p><a href="#%E4%BD%BF%E7%94%A8%E5%A0%86%E6%A0%88%E7%BB%84%E5%90%88%E8%A7%86%E5%9B%BE"></a></p>
<p>除了在上一节中创建的标题视图之外，还将添加文本视图，以包含有关地标的详细信息，例如公园的名称和所在的州。</p>
<p>创建SwiftUI视图时，可以在视图的<code>body</code>属性中描述其内容、布局和行为；但是，<code>body</code>属性只返回单个视图。您可以将多个视图组合并嵌入到<code>Stack</code>中，从而将视图水平、垂直或前后组合在一起。</p>
<p>在本节中，您将使用<code>VStack(垂直堆栈)</code>组合标题信息，使用<code>HStack(水平堆栈)</code>组合公园详情信息。</p>
<p><img src="https://camo.githubusercontent.com/3aeefe3292b56902b53bedabdd80192b5ee234ecf269f9107b09f74caa82e2f9/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f346130303064326333342f35343661346433342d666566392d343537342d613430352d6431366563383363613766652e706e67" alt=""></p>
<blockquote>
<p>你可以使用Xcode的结构化编辑功能在容器视图中嵌入视图，也可以打开<code>Inspector</code> 或使用<code>help</code>进行其他更多有用的更改。</p>
</blockquote>
<h2 id="步骤一-3">步骤一</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80-2"></a></p>
<p>按住<code>command</code>并单击<code>Text</code>视图，会看到初始值设定项的显示结构化编辑弹出窗口，然后选择<code>Embed in VStack</code>。</p>
<p><img src="https://camo.githubusercontent.com/cc4265b5a7b78aef59daf5b1853c9f1d8249d12fcca1923e7a5b4bd27c313a30/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336665383139363335382f36633934333065322d643062382d346161642d623131332d3465313263363938303135612e706e67" alt=""></p>
<blockquote>
<p>接下来，通过从<code>组件库</code>中拖动<code>Text</code>视图，将<code>Text</code>视图添加到<code>Stack</code>中。</p>
</blockquote>
<p>通过单击Xcode窗口右上角的加号按钮（＋）打开<code>组件库</code>，然后将<code>Text</code>视图拖到<code>Turtle Rock</code>文本视图下面的位置。</p>
<p><img src="https://camo.githubusercontent.com/4a1664a9507008e96d6e9f33f86c15160bc8af2e51a5e36472abef04746303e5/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f303033396239366439372f30626635663639322d366466312d343231352d393034392d6632346662333938373639652e706e67" alt=""></p>
<h2 id="步骤三-3">步骤三</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%89-2"></a></p>
<p>将<code>Text</code>视图的默认文本替换为“Joshua Tree National Park”。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                .font(.title)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/5d6997dedec53e4066531f7149f276b467926bae5d72db398c52dc78fa9d9f0f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663933373037383362622f30303262323930382d663832632d343866342d393634622d3833393831386631333864622e706e67" alt=""></p>
<blockquote>
<p>自定义位置文本的样式，以满足布局需求。</p>
</blockquote>
<h2 id="步骤四-3">步骤四</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B-2"></a></p>
<p>将位置的<code>font</code>设置为<code>subheadline</code> 。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                .font(.title)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                .font(.subheadline)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/8d00ac729f176849ab669f4bb3b530b1b6ba1753b74e6e052635f0d6613e0636/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f343462386236383931302f66353237663134322d363664662d343831642d383364662d3865666439366637616332652e706e67" alt=""></p>
<h2 id="步骤五-3">步骤五</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%94-2"></a></p>
<p>编辑<code>VStack</code>初始值设定项，以<code>leading</code>方式对齐视图。</p>
<p>默认情况下，<code>VStack</code>会将它们的内容按轴中心对齐，并提供上下文适当的间距。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                .font(.title)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                .font(.subheadline)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/35d3cab99a52b029abb9b190e70950cd52dc94aa49f3e2d59122c5ab565b199d/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f343162383435616533652f36373233376666372d306234322d346466662d386136362d3633343464313431326135352e706e67" alt=""></p>
<blockquote>
<p>接下来，您将在位置文本的右侧添加另一个文本视图，该视图用于展示公园所在的州。</p>
</blockquote>
<h2 id="步骤六-3">步骤六</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%85%AD-2"></a></p>
<p>在画布中，按住<code>command</code>并单击<code>Joshua Tree National Park</code>，然后选择<code>Embed In HStack</code>。</p>
<p><img src="https://camo.githubusercontent.com/8caee3d1764973d6aa74464911639db3835510e1801389dfb428a9d083967c0f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f366233656139613838352f36353538333832372d343235612d343934332d626135662d6261663134636237663834622e706e67" alt=""></p>
<h2 id="步骤七">步骤七</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%83"></a></p>
<p>在地点文本后添加新的文本视图，将默认文本更改为公园所在的州，然后将其<code>font</code>设置为<code>subheadline</code> 。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                .font(.title)</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                    .font(.subheadline)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                    .font(.subheadline)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/9bfc0dced1ef3a52ce3d041accc719f33799390abfb6cd709ea43b3270777fc0/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f383262663137313031392f63323936656633632d333235622d346166342d393061642d3862346536663932666531302e706e67" alt=""></p>
<h2 id="步骤八">步骤八</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%85%AB"></a></p>
<blockquote>
<p>若想使布局自动撑开并充满设备的宽，在<code>HStack</code>中添加<code>Spacer</code>来分隔<code>Joshua Tree National Park</code>和<code>California</code>两个文本视图。</p>
</blockquote>
<p><code>Spacer</code>将撑开<code>Stack</code>，以使其包含的视图充满其父视图的所有空间，而不是仅由其内容定义其大小。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                .font(.title)</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                    .font(.subheadline)</span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                    .font(.subheadline)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/e806ad2124c7ae0896f94c64ecfa668c53e32539ef4e511deebb3dc7d2fcdff1/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f643731306534363964352f64323865643832652d366230632d343738632d623139662d3030666664323262653831652e706e67" alt=""></p>
<h2 id="步骤九">步骤九</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B9%9D"></a></p>
<p>最后，使用<code>padding()</code>修饰符方法给整个地标信息区域加一个边距。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                .font(.title)</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                    .font(.subheadline)</span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                    .font(.subheadline)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/6722a06a707c4babd354052944bc899cc907cbcd117c4b8ccf5e2f63bf1fb6b1/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f636539656364316434382f64656636386131392d666237362d346133322d396539312d6539643265393364343036372e706e67" alt=""></p>
<h2 id="第四节">第四节</h2>
<p><a href="#%E7%AC%AC%E5%9B%9B%E8%8A%82"></a></p>
<p>创建自定义图像视图</p>
<p>在名称和地点视图都设置好的情况下，接下来要做的是为地标添加一个图像。</p>
<p>对自定义的图像使用遮罩、边框和阴影，和原来的方法相比，将使用很少的代码。</p>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/custom-image-view.gif" alt=""></p>
<blockquote>
<p>首先将图片添加到项目的<code>Assets</code>中。</p>
</blockquote>
<h2 id="步骤一-4">步骤一</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80-3"></a></p>
<p>在项目<code>Resources</code>文件夹的中找到<code>turtlerock.png</code>，将其拖到<code>Assets</code>中。Xcode为图像创建一个新的图像集。</p>
<p><img src="https://camo.githubusercontent.com/dfa87e40344b3fceb0c5ccded545c0c4d576332d0c5fad96ae69de5ec0647cea/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f623539663862646134352f35666662663461382d346361642d343162652d623839342d3162323062363935646262352e706e67" alt=""></p>
<blockquote>
<p>接下来，您将为您的自定义图像视图创建一个新的SwiftUI视图。</p>
</blockquote>
<h2 id="步骤二-3">步骤二</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C-2"></a></p>
<p>选择<code>File &gt; New &gt; File</code>再次打开模板选择器。在<code>User Interface</code>中，单击选择<code>SwiftUI View</code>，然后单击<code>Next</code>。将文件命名为<code>CircleImage.swift</code>，然后单击<code>Create</code>。</p>
<p><img src="https://camo.githubusercontent.com/38f219688c78bf6c3f118949309132314feb802fec3adf0f05444fb2fc0c9772/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f356165373664396566372f38326564626531612d646662362d346236332d623637322d6432356631646339633462302e706e67" alt=""></p>
<blockquote>
<p>现在您已准备好图像，以满足设计所需。</p>
</blockquote>
<h3 id="步骤三-4">步骤三</h3>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%89-3"></a></p>
<p>使用<code>Image(:)</code>将<code>Text</code>视图替换为Turtle Rock的图像视图。</p>
<blockquote>
<p>CircleImage.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Image</span>(<span class="string">&quot;turtlerock&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CircleImage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/fa383c03ffe8a6bcfa8a8c9b28d3711f86f6f6e0fe05b7503422c19d3151b360/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f653636643661303632392f38316562313064342d393739632d346164382d393539312d6131613239343834653464612e706e67" alt=""></p>
<h2 id="步骤四-4">步骤四</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B-3"></a></p>
<p>添加<code>Image</code>的<code>.clipShape(Circle())</code>的修饰符，将图像剪裁为圆形。</p>
<p><code>Circle()</code>是一个可以用作遮罩的形状，或通过给<code>Circle()</code>设置<code>stroke</code>或<code>fill</code>来绘制视图。</p>
<blockquote>
<p>CircleImage.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Image</span>(<span class="string">&quot;turtlerock&quot;</span>)</span><br><span class="line">            .clipShape(<span class="type">Circle</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CircleImage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d12972cd7ad4fa16646907177dc7e2cd8c306fa848d21147a6f34272e66cb953/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f666366323666323732652f30643166663464612d653838632d346537392d383065612d3537366364633164646364372e706e67" alt=""></p>
<h2 id="步骤五-4">步骤五</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%94-3"></a></p>
<p>创建另一个带有灰色<code>stroke</code>的<code>Circle()</code>，使用<code>.overlay()</code>修饰符，将其覆盖添加到图像的边框中。</p>
<blockquote>
<p>CircleImage.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Image</span>(<span class="string">&quot;turtlerock&quot;</span>)</span><br><span class="line">            .clipShape(<span class="type">Circle</span>())</span><br><span class="line">            .overlay(</span><br><span class="line">                <span class="type">Circle</span>().stroke(<span class="type">Color</span>.gray, lineWidth: <span class="number">4</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CircleImage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/7478ced9e68d1e568b055f1640cfefec6a0eeb02bc63dbd30d65aaeae716090c/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f373665376531343663622f62323063333934652d663330322d343638312d383163302d6336353561363162326337302e706e67" alt=""></p>
<h2 id="步骤六-4">步骤六</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%85%AD-3"></a></p>
<p>接下来，添加半径为<code>10point</code>的阴影。</p>
<blockquote>
<p>CircleImage.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Image</span>(<span class="string">&quot;turtlerock&quot;</span>)</span><br><span class="line">            .clipShape(<span class="type">Circle</span>())</span><br><span class="line">            .overlay(</span><br><span class="line">                <span class="type">Circle</span>().stroke(<span class="type">Color</span>.gray, lineWidth: <span class="number">4</span>))</span><br><span class="line">            .shadow(radius: <span class="number">10</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CircleImage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/4d29477149e15aa7473f5a604192733176f7ca99878d2391b53f5bccdee1db15/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f313663636235646262342f61343930346164302d373864632d346635662d613366332d3165393761663331353734362e706e67" alt=""></p>
<h2 id="步骤七-2">步骤七</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%83-1"></a></p>
<p>将边框颜色修改为白色。</p>
<p>到此，我们就完成了图像视图。</p>
<blockquote>
<p>CircleImage.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Image</span>(<span class="string">&quot;turtlerock&quot;</span>)</span><br><span class="line">            .clipShape(<span class="type">Circle</span>())</span><br><span class="line">            .overlay(</span><br><span class="line">                <span class="type">Circle</span>().stroke(<span class="type">Color</span>.white, lineWidth: <span class="number">4</span>))</span><br><span class="line">            .shadow(radius: <span class="number">10</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CircleImage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/89d64a999cb02f62d2946240944ab76e7de310b58d23dd69864bf049c7cb4af9/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f353463356536356234332f65646332636666312d646465342d343931372d623538642d6564346330353639303762622e706e67" alt=""></p>
<h2 id="第五节">第五节</h2>
<p><a href="#%E7%AC%AC%E4%BA%94%E8%8A%82"></a></p>
<h2 id="UIKit和SwiftUI配合使用">UIKit和SwiftUI配合使用</h2>
<p><a href="#uikit%E5%92%8Cswiftui%E9%85%8D%E5%90%88%E4%BD%BF%E7%94%A8"></a></p>
<p>现在可以创建地图视图了，您可以使用<code>MapKit</code>中的<code>MKMappView</code>类来绘制地图。</p>
<p>要在SwiftUI中使用UIView子类，可以将另一个视图包装在遵守UIViewRepresentable协议的SwiftUI视图中。SwiftUI包含了WatchKit和AppKit视图类似的协议。</p>
<p><img src="https://camo.githubusercontent.com/b3ae3c503c97109a3f27929c376bb5ef88ddd37f5ddf569f6b4d25236fec9a4d/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f313665326561303530312f62393735333932372d666234342d346637342d383736662d3331643931323663626231362e706e67" alt=""></p>
<blockquote>
<p>现在开始，您将创建一个新的自定义视图，该视图可以显示<code>MKMapView</code>。</p>
</blockquote>
<p>选择<code>File &gt; New &gt; File</code>，选择<code>iOS</code>平台，选择<code>SwiftUI View</code>模板，然后单击<code>Next</code>。将新文件命名为<code>MapView.swift</code>，然后单击“Create”。</p>
<p><img src="https://camo.githubusercontent.com/b2cbf45d4a436da332f40ab478e46f01f52f21ae1407b995a2fc07def74d1db5/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f303266346264623163372f62633066323063662d313039342d343139332d623832372d3435353737306266626132392e706e67" alt=""></p>
<h2 id="步骤二-4">步骤二</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C-3"></a></p>
<p>添加<code>import MapKit</code>，并让<code>MappView</code>结构遵守UIViewRepresentable协议。</p>
<p>不要担心Xcode显示的警告；您将在接下来的几个步骤中修复它。</p>
<blockquote>
<p>MapView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> MapKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MapView</span>: <span class="title class_ inherited__">UIViewRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MapView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">MapView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>UIViewRepresentable</code>协议有两个需要实现的方法：使用<code>UIView(context:)</code>方法创建<code>MKMapView</code>，使用<code>updateUIView(u:context:)</code>方法来配置视图并响应视图的任意变化。</p>
</blockquote>
<h2 id="步骤三-5">步骤三</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%89-4"></a></p>
<p>用<code>makeUIView（context:）</code>方法替换body属性。</p>
<blockquote>
<p>MapView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> MapKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MapView</span>: <span class="title class_ inherited__">UIViewRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIView</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">MKMapView</span> &#123;</span><br><span class="line">        <span class="type">MKMapView</span>(frame: .zero)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MapView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">MapView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤四-5">步骤四</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B-4"></a></p>
<p>创建一个<code>updateUIView（u:context:）</code>方法，将地图视图的区域设置为正确的坐标，以便将地图居中放置在<code>Turtle Rock</code>上。</p>
<blockquote>
<p>MapView.swift</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import SwiftUI</span><br><span class="line">import MapKit</span><br><span class="line"></span><br><span class="line">struct MapView: UIViewRepresentable &#123;</span><br><span class="line">    func makeUIView(context: Context) -&gt; MKMapView &#123;</span><br><span class="line">        MKMapView(frame: .zero)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    func updateUIView(_ view: MKMapView, context: Context) &#123;</span><br><span class="line">        let coordinate = CLLocationCoordinate2D(</span><br><span class="line">            latitude: 34.011286, longitude: -116.166868)</span><br><span class="line">        let span = MKCoordinateSpan(latitudeDelta: 2.0, longitudeDelta: 2.0)</span><br><span class="line">        let region = MKCoordinateRegion(center: coordinate, span: span)</span><br><span class="line">        view.setRegion(region, animated: true)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct MapView_Preview: PreviewProvider &#123;</span><br><span class="line">    static var previews: some View &#123;</span><br><span class="line">        MapView()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>当预览处于静态模式时，它们仅完全呈现<code>SwiftUI</code>视图。因为<code>MKMapView</code>是一个<code>UIView</code>子类，所以您需要切换到实时预览来查看地图。</p>
</blockquote>
<h2 id="步骤五-5">步骤五</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%94-4"></a></p>
<p>单击<code>Live Preview</code>按钮将预览切换到实时预览模式。您可能需要单击预览上方的<code>Try Again</code>或<code>Resume</code>按钮。</p>
<p>再过一会儿，你会看到一张<code>Joshua Tree National Park</code>的地图，那里是<code>Turtle Rock</code>的故乡。</p>
<p><img src="https://camo.githubusercontent.com/f721594834182445ac4af6508efaae5520c53febf3c75b5f8549aa1de1177e9c/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f343239336536353339662f37346238633831302d626537382d346133362d613032382d6634643132373466633736302e706e67" alt=""></p>
<h2 id="第六节">第六节</h2>
<p><a href="#%E7%AC%AC%E5%85%AD%E8%8A%82"></a></p>
<h2 id="组成详情视图">组成详情视图</h2>
<p><a href="#%E7%BB%84%E6%88%90%E8%AF%A6%E6%83%85%E8%A7%86%E5%9B%BE"></a></p>
<p>现在您已经拥有了所需的所有组件——名称和位置、圆形图像以及地图。</p>
<p>现在使用目前的工具，组合自定义视图，创建地标详情视图以达到最终设计吧。</p>
<p><img src="https://camo.githubusercontent.com/194cd52911cf2ed5d4e3cad7953c38a7375a16ebc26d3932c8e196642dab6096/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f333365313530626235352f39373362613730322d383564622d343835322d383531662d3836613934636663613030322e706e67" alt=""></p>
<h2 id="步骤一-5">步骤一</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80-4"></a></p>
<p>在项目导航器中，选择<code>ContentView.swift</code>文件。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                .font(.title)</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                    .font(.subheadline)</span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                    .font(.subheadline)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/f8c51da637994597d28d41dc04507f0f93c251000f39564ef23e867b941493a3/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f366430303836356435342f62613132646666372d386164622d346565612d396535322d6239323237386639376134642e706e67" alt=""></p>
<h2 id="步骤二-5">步骤二</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C-4"></a></p>
<p>将刚才的三个文本的VStack嵌入到另一个VStack中。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                    .font(.title)</span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/f8c51da637994597d28d41dc04507f0f93c251000f39564ef23e867b941493a3/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f366430303836356435342f62613132646666372d386164622d346565612d396535322d6239323237386639376134642e706e67" alt=""></p>
<h2 id="步骤三-6">步骤三</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%89-5"></a></p>
<blockquote>
<p>将自定义<code>MapView</code>添加到<code>Stack</code>顶部。使用<code>frame(width:height:)</code>设置<code>MapView</code>的大小。</p>
</blockquote>
<p>仅指定<code>height(高度)</code>参数时，视图会自动调整其内容的宽度。在这种情况下，<code>MapView</code>将展开以填充可用空间。</p>
<h2 id="步骤四-6">步骤四</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B-5"></a></p>
<p>单击<code>Live Preview</code>按钮，以在预览中查看渲染的地图。</p>
<p>您可以在显示实时预览时继续编辑视图。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>()</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                    .font(.title)</span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/bec25a515816f18045c64d1ef74843d963bb109bf840aea5ebe74f2dfdc1440b/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f653536353333656265632f32626662663733302d666362662d343430352d613132312d6435666563393663313430332e706e67" alt=""></p>
<h2 id="步骤五-6">步骤五</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%94-5"></a></p>
<p>将<code>CircleImage</code>视图添加到<code>Stack</code>中。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>()</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>()</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                    .font(.title)</span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/7ca40186fd5e512a5fc8af8816f02a1504e386df895bbaf069430d47208c58f5/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f373261363131396562302f61373938633064382d653561632d346531392d383461382d3565336636623762663465322e706e67" alt=""></p>
<h2 id="步骤六-5">步骤六</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%85%AD-4"></a></p>
<p>若要将<code>CircleImage</code>显示在<code>MapView</code>视图的上方，请使图像垂直偏移-130个点，并从视图底部填充-130个点。</p>
<p>这些调整通过向上移动图像为文本腾出空间。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>()</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>()</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                    .font(.title)</span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/5a711088e7a71112df3d58961351cc7f0e33438f2160a85e6e24e21898b83ff8/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f623735306231356663652f37613135633138382d616334642d346163302d386161372d6163663536636431353737642e706e67" alt=""></p>
<h2 id="步骤七-3">步骤七</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%83-2"></a></p>
<p>在<code>VStack</code>中底部添加一个<code>Spacer()</code>，将内容推到屏幕的顶部。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>()</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>()</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                    .font(.title)</span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/71a7e5f83911ef9b430ae72e3560407b9976f3340bd52f8b5080ab4da1bf1d74/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f666538313037343966622f33343663313732652d313335382d343966652d626238392d3331633030373736656561382e706e67" alt=""></p>
<h2 id="步骤八-2">步骤八</h2>
<p><a href="#%E6%AD%A5%E9%AA%A4%E5%85%AB-1"></a></p>
<p>最后，要允许地图内容扩展到屏幕的上边缘，请将<code>edgesIgnoringSafeArea（.top）</code>修饰符添加到地图视图中。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>()</span><br><span class="line">                .edgesIgnoringSafeArea(.top)</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>()</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                    .font(.title)</span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/f348f6b5192adb6ce6417793d8aef7e43df24a97d6076575985141f77a9c2a87/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336231356434363864362f36363530306134662d303137392d343465362d616362302d6166393436383964396538652e706e67" alt=""></p>
<h3 id="绘图和动画">绘图和动画</h3>
<p><a href="#%E7%BB%98%E5%9B%BE%E5%92%8C%E5%8A%A8%E7%94%BB"></a></p>
<h2 id="绘制路径和形状">绘制路径和形状</h2>
<p><a href="#%E7%BB%98%E5%88%B6%E8%B7%AF%E5%BE%84%E5%92%8C%E5%BD%A2%E7%8A%B6"></a></p>
<p>用户每次访问列表中的地标时都会收到徽章。当然，要让用户收到徽章，您需要创建一个徽章。本教程将引导您通过组合路径和形状来创建徽章，然后将其与表示位置的另一个形状重叠。</p>
<p>如果要为不同类型的地标创建多个徽章，请尝试使用覆盖的符号、更改重复次数或更改不同角度和比例。</p>
<blockquote>
<p>学习时间：25分钟</p>
<p><a target="_blank" rel="noopener" href="https://docs-assets.developer.apple.com/published/03f5d726da/DrawingPathsAndShapes.zip">下载地址：DrawingPathsAndShapes.zip</a></p>
</blockquote>
<h2 id="第一节-创建徽章视图">第一节 创建徽章视图</h2>
<p><a href="#%E7%AC%AC%E4%B8%80%E8%8A%82-%E5%88%9B%E5%BB%BA%E5%BE%BD%E7%AB%A0%E8%A7%86%E5%9B%BE"></a></p>
<p>要创建徽章，首先要创建一个徽章视图，该视图使用<code>SwiftUI</code>中的矢量绘图<code>api</code>。</p>
<p><img src="https://camo.githubusercontent.com/774d2e73ebaff78b70c40ca9529b4861403a603308c8194925f26c99219a5c79/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f633034643230303131322f31656161366365302d303239662d343637652d396431392d3038353266636461646233352e706e67" alt=""></p>
<h2 id="步骤1-6">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41"></a></p>
<p>选择<code>File &gt; New &gt; File</code>，然后从“iOS模板”工作表中选择<code>SwiftUI View</code>。单击<code>Next</code>继续，然后在“Save as”字段中输入<code>Badge</code>并单击“Create”。</p>
<p><img src="https://camo.githubusercontent.com/99555d98d1b740eee3060c51ebdeb1d66ccfbef1c27e68c781b2b4914aeefeae/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f383436353835636132362f31356132366132382d653630652d343034342d623765372d3236643838646434653531302e706e67" alt=""></p>
<h2 id="步骤2-6">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42"></a></p>
<p>调整<code>Badge</code>视图以显示文本“Badge”，接下来我们开始定义徽章形状。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Badge&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/929d03baece74b8f321a9b5d3658d7e94c9672a1a1ddd1c2db4025a405459b5f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f306637373361633362632f34326663666164642d346636322d343833392d393635662d6633343238663863336431622e706e67" alt=""></p>
<h2 id="第二节-绘制徽章背景">第二节 绘制徽章背景</h2>
<p><a href="#%E7%AC%AC%E4%BA%8C%E8%8A%82-%E7%BB%98%E5%88%B6%E5%BE%BD%E7%AB%A0%E8%83%8C%E6%99%AF"></a></p>
<p>使用SwiftUI中的图形api绘制自定义徽章形状。</p>
<p><img src="https://camo.githubusercontent.com/152655c4d7925d1485ba71c999f8d9d69c540687d4b5d23baec49ae52e8b6c7c/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f356636333265333030352f31353832333462662d356139382d346436342d386663302d3764363835663431393435332e706e67" alt=""></p>
<h2 id="步骤1-7">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-1"></a></p>
<blockquote>
<p>查看<code>HexagonParameters.swift</code>文件中的代码。</p>
</blockquote>
<p>六边形参数结构定义了绘制徽章六边形的详细信息。您不会修改此数据；相反，您将使用它指定用于绘制徽章的线条和曲线的控制点。</p>
<blockquote>
<p>HexagonParameters.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HexagonParameters</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Segment</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> useWidth: (<span class="type">CGFloat</span>, <span class="type">CGFloat</span>, <span class="type">CGFloat</span>)</span><br><span class="line">        <span class="keyword">let</span> xFactors: (<span class="type">CGFloat</span>, <span class="type">CGFloat</span>, <span class="type">CGFloat</span>)</span><br><span class="line">        <span class="keyword">let</span> useHeight: (<span class="type">CGFloat</span>, <span class="type">CGFloat</span>, <span class="type">CGFloat</span>)</span><br><span class="line">        <span class="keyword">let</span> yFactors: (<span class="type">CGFloat</span>, <span class="type">CGFloat</span>, <span class="type">CGFloat</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> adjustment: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">0.085</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> points <span class="operator">=</span> [</span><br><span class="line">        <span class="type">Segment</span>(</span><br><span class="line">            useWidth:  (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">1.00</span>),</span><br><span class="line">            xFactors:  (<span class="number">0.60</span>, <span class="number">0.40</span>, <span class="number">0.50</span>),</span><br><span class="line">            useHeight: (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">0.00</span>),</span><br><span class="line">            yFactors:  (<span class="number">0.05</span>, <span class="number">0.05</span>, <span class="number">0.00</span>)</span><br><span class="line">        ),</span><br><span class="line">        <span class="type">Segment</span>(</span><br><span class="line">            useWidth:  (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">0.00</span>),</span><br><span class="line">            xFactors:  (<span class="number">0.05</span>, <span class="number">0.00</span>, <span class="number">0.00</span>),</span><br><span class="line">            useHeight: (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">1.00</span>),</span><br><span class="line">            yFactors:  (<span class="number">0.20</span> <span class="operator">+</span> adjustment, <span class="number">0.30</span> <span class="operator">+</span> adjustment, <span class="number">0.25</span> <span class="operator">+</span> adjustment)</span><br><span class="line">        ),</span><br><span class="line">        <span class="type">Segment</span>(</span><br><span class="line">            useWidth:  (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">0.00</span>),</span><br><span class="line">            xFactors:  (<span class="number">0.00</span>, <span class="number">0.05</span>, <span class="number">0.00</span>),</span><br><span class="line">            useHeight: (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">1.00</span>),</span><br><span class="line">            yFactors:  (<span class="number">0.70</span> <span class="operator">-</span> adjustment, <span class="number">0.80</span> <span class="operator">-</span> adjustment, <span class="number">0.75</span> <span class="operator">-</span> adjustment)</span><br><span class="line">        ),</span><br><span class="line">        <span class="type">Segment</span>(</span><br><span class="line">            useWidth:  (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">1.00</span>),</span><br><span class="line">            xFactors:  (<span class="number">0.40</span>, <span class="number">0.60</span>, <span class="number">0.50</span>),</span><br><span class="line">            useHeight: (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">1.00</span>),</span><br><span class="line">            yFactors:  (<span class="number">0.95</span>, <span class="number">0.95</span>, <span class="number">1.00</span>)</span><br><span class="line">        ),</span><br><span class="line">        <span class="type">Segment</span>(</span><br><span class="line">            useWidth:  (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">1.00</span>),</span><br><span class="line">            xFactors:  (<span class="number">0.95</span>, <span class="number">1.00</span>, <span class="number">1.00</span>),</span><br><span class="line">            useHeight: (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">1.00</span>),</span><br><span class="line">            yFactors:  (<span class="number">0.80</span> <span class="operator">-</span> adjustment, <span class="number">0.70</span> <span class="operator">-</span> adjustment, <span class="number">0.75</span> <span class="operator">-</span> adjustment)</span><br><span class="line">        ),</span><br><span class="line">        <span class="type">Segment</span>(</span><br><span class="line">            useWidth:  (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">1.00</span>),</span><br><span class="line">            xFactors:  (<span class="number">1.00</span>, <span class="number">0.95</span>, <span class="number">1.00</span>),</span><br><span class="line">            useHeight: (<span class="number">1.00</span>, <span class="number">1.00</span>, <span class="number">1.00</span>),</span><br><span class="line">            yFactors:  (<span class="number">0.30</span> <span class="operator">+</span> adjustment, <span class="number">0.20</span> <span class="operator">+</span> adjustment, <span class="number">0.25</span> <span class="operator">+</span> adjustment)</span><br><span class="line">        )</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤2-7">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-1"></a></p>
<p>在<code>Badge.swift</code>中，向<code>Badge</code>添加一个<code>Path shape</code>，并应用<code>fill（）</code>修饰符将该形状转换为视图。</p>
<p>您可以使用<code>paths</code>来组合线条、曲线和其他绘图，以形成更复杂的形状，如徽章的六边形背景。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        .fill(<span class="type">Color</span>.black)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤3-5">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43"></a></p>
<p>为<code>path</code>添加起点。</p>
<p><code>move（to:）</code>方法在形状的边界内移动绘图光标，就像一支虚构的笔悬停在该区域上，等待开始绘图一样。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">var</span> width: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">100.0</span></span><br><span class="line">            <span class="keyword">let</span> height <span class="operator">=</span> width</span><br><span class="line">            path.move(to: <span class="type">CGPoint</span>(x: width <span class="operator">*</span> <span class="number">0.95</span>, y: height <span class="operator">*</span> <span class="number">0.20</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        .fill(<span class="type">Color</span>.black)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤4-4">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44"></a></p>
<p>为形状数据的每个点绘制线，以创建一个大致的六边形。</p>
<p><code>addLine（to:）</code>方法接受一个点并绘制它。对<code>addLine（to:）</code>连续调用，会从上一点开始到新点画一条线。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">var</span> width: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">100.0</span></span><br><span class="line">            <span class="keyword">let</span> height <span class="operator">=</span> width</span><br><span class="line">            path.move(to: <span class="type">CGPoint</span>(x: width <span class="operator">*</span> <span class="number">0.95</span>, y: height <span class="operator">*</span> <span class="number">0.20</span>))</span><br><span class="line">            </span><br><span class="line">            <span class="type">HexagonParameters</span>.points.forEach &#123;</span><br><span class="line">                path.addLine(</span><br><span class="line">                    to: .<span class="keyword">init</span>(</span><br><span class="line">                        x: width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">0</span>,</span><br><span class="line">                        y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">0</span></span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .fill(<span class="type">Color</span>.black)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/ed85c5f693b54a593cc345800d22c474866f66600c7a317f815b704ff64e5af3/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f653562343833633738622f33383931613534372d366466342d343731382d383362632d6335313766333166623438612e706e67" alt=""></p>
<blockquote>
<p>如果你的六边形看起来有点不寻常，不要担心；这符合预期。在接下来的几个步骤中，您将努力使六边形看起来更像本节开头显示的徽章形状。</p>
</blockquote>
<h2 id="步骤5-2">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45"></a></p>
<p>使用<code>addQuadCurve（to:control:）</code>方法为徽章的角绘制<code>Bézier</code>曲线。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">var</span> width: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">100.0</span></span><br><span class="line">            <span class="keyword">let</span> height <span class="operator">=</span> width</span><br><span class="line">            path.move(</span><br><span class="line">                to: <span class="type">CGPoint</span>(</span><br><span class="line">                    x: width <span class="operator">*</span> <span class="number">0.95</span>,</span><br><span class="line">                    y: height <span class="operator">*</span> (<span class="number">0.20</span> <span class="operator">+</span> <span class="type">HexagonParameters</span>.adjustment)</span><br><span class="line">                )</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="type">HexagonParameters</span>.points.forEach &#123;</span><br><span class="line">                path.addLine(</span><br><span class="line">                    to: .<span class="keyword">init</span>(</span><br><span class="line">                        x: width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">0</span>,</span><br><span class="line">                        y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">0</span></span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                path.addQuadCurve(</span><br><span class="line">                    to: .<span class="keyword">init</span>(</span><br><span class="line">                        x: width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">1</span>,</span><br><span class="line">                        y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">1</span></span><br><span class="line">                    ),</span><br><span class="line">                    control: .<span class="keyword">init</span>(</span><br><span class="line">                        x: width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">2</span>,</span><br><span class="line">                        y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">2</span></span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .fill(<span class="type">Color</span>.black)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/87cfebdd9ef83b5c88d360e56ef8075fdb707f0022f55cdb937b6e1b7d286209/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f383238323862653436652f62633739393939392d336637632d343463312d623463332d3265333964613466373463312e706e67" alt=""></p>
<h2 id="步骤6-2">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46"></a></p>
<blockquote>
<p>将徽章<code>path</code>包装在<code>GeometryReader</code>中，以便徽章可以使用其包含视图的大小，该视图定义大小，而不是硬编码值（100）。</p>
</blockquote>
<p>当包含的视图不是正方形时，使用几何体的两个维度中的最小值以保证徽章的宽高比。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; geometry <span class="keyword">in</span></span><br><span class="line">            <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">var</span> width: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="built_in">min</span>(geometry.size.width, geometry.size.height)</span><br><span class="line">                <span class="keyword">let</span> height <span class="operator">=</span> width</span><br><span class="line">                path.move(</span><br><span class="line">                    to: <span class="type">CGPoint</span>(</span><br><span class="line">                        x: width <span class="operator">*</span> <span class="number">0.95</span>,</span><br><span class="line">                        y: height <span class="operator">*</span> (<span class="number">0.20</span> <span class="operator">+</span> <span class="type">HexagonParameters</span>.adjustment)</span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                <span class="type">HexagonParameters</span>.points.forEach &#123;</span><br><span class="line">                    path.addLine(</span><br><span class="line">                        to: .<span class="keyword">init</span>(</span><br><span class="line">                            x: width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">0</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">0</span></span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                    </span><br><span class="line">                    path.addQuadCurve(</span><br><span class="line">                        to: .<span class="keyword">init</span>(</span><br><span class="line">                            x: width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">1</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">1</span></span><br><span class="line">                        ),</span><br><span class="line">                        control: .<span class="keyword">init</span>(</span><br><span class="line">                            x: width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">2</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">2</span></span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .fill(<span class="type">Color</span>.black)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/61a30b59da3216e824c6590b73438de6c4ab4edc0a04ecb6ad00b78ea23eaee2/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f313632643635333131352f66306264636565322d316633302d343264622d396635372d6661646532343463663064392e706e67" alt=""></p>
<h2 id="步骤7">步骤7</h2>
<p><a href="#%E6%AD%A5%E9%AA%A47"></a></p>
<p>使用<code>xScale</code>和<code>xOffset</code>调整变量使徽章在其几何体中居中。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; geometry <span class="keyword">in</span></span><br><span class="line">            <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">var</span> width: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="built_in">min</span>(geometry.size.width, geometry.size.height)</span><br><span class="line">                <span class="keyword">let</span> height <span class="operator">=</span> width</span><br><span class="line">                <span class="keyword">let</span> xScale: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">0.832</span></span><br><span class="line">                <span class="keyword">let</span> xOffset <span class="operator">=</span> (width <span class="operator">*</span> (<span class="number">1.0</span> <span class="operator">-</span> xScale)) <span class="operator">/</span> <span class="number">2.0</span></span><br><span class="line">                width <span class="operator">*=</span> xScale</span><br><span class="line">                path.move(</span><br><span class="line">                    to: <span class="type">CGPoint</span>(</span><br><span class="line">                        x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="number">0.95</span>,</span><br><span class="line">                        y: height <span class="operator">*</span> (<span class="number">0.20</span> <span class="operator">+</span> <span class="type">HexagonParameters</span>.adjustment)</span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                <span class="type">HexagonParameters</span>.points.forEach &#123;</span><br><span class="line">                    path.addLine(</span><br><span class="line">                        to: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">0</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">0</span></span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                    </span><br><span class="line">                    path.addQuadCurve(</span><br><span class="line">                        to: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">1</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">1</span></span><br><span class="line">                        ),</span><br><span class="line">                        control: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">2</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">2</span></span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .fill(<span class="type">Color</span>.black)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/37f8b437e325cf8c743d02b004c60c4b608e24fbfe2556fd9b899b94d4aa749a/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f333565653665356265612f39333734316261332d396662622d343633362d613336372d3630323262663839663463652e706e67" alt=""></p>
<h2 id="步骤8">步骤8</h2>
<p><a href="#%E6%AD%A5%E9%AA%A48"></a></p>
<p>将徽章的纯黑背景替换为与设计匹配的渐变色。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; geometry <span class="keyword">in</span></span><br><span class="line">            <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">var</span> width: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="built_in">min</span>(geometry.size.width, geometry.size.height)</span><br><span class="line">                <span class="keyword">let</span> height <span class="operator">=</span> width</span><br><span class="line">                <span class="keyword">let</span> xScale: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">0.832</span></span><br><span class="line">                <span class="keyword">let</span> xOffset <span class="operator">=</span> (width <span class="operator">*</span> (<span class="number">1.0</span> <span class="operator">-</span> xScale)) <span class="operator">/</span> <span class="number">2.0</span></span><br><span class="line">                width <span class="operator">*=</span> xScale</span><br><span class="line">                path.move(</span><br><span class="line">                    to: <span class="type">CGPoint</span>(</span><br><span class="line">                        x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="number">0.95</span>,</span><br><span class="line">                        y: height <span class="operator">*</span> (<span class="number">0.20</span> <span class="operator">+</span> <span class="type">HexagonParameters</span>.adjustment)</span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                <span class="type">HexagonParameters</span>.points.forEach &#123;</span><br><span class="line">                    path.addLine(</span><br><span class="line">                        to: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">0</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">0</span></span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                    </span><br><span class="line">                    path.addQuadCurve(</span><br><span class="line">                        to: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">1</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">1</span></span><br><span class="line">                        ),</span><br><span class="line">                        control: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">2</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">2</span></span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .fill(<span class="type">LinearGradient</span>(</span><br><span class="line">                gradient: .<span class="keyword">init</span>(colors: [<span class="keyword">Self</span>.gradientStart, <span class="keyword">Self</span>.gradientEnd]),</span><br><span class="line">                startPoint: .<span class="keyword">init</span>(x: <span class="number">0.5</span>, y: <span class="number">0</span>),</span><br><span class="line">                endPoint: .<span class="keyword">init</span>(x: <span class="number">0.5</span>, y: <span class="number">0.6</span>)</span><br><span class="line">            ))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> gradientStart <span class="operator">=</span> <span class="type">Color</span>(red: <span class="number">239.0</span> <span class="operator">/</span> <span class="number">255</span>, green: <span class="number">120.0</span> <span class="operator">/</span> <span class="number">255</span>, blue: <span class="number">221.0</span> <span class="operator">/</span> <span class="number">255</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> gradientEnd <span class="operator">=</span> <span class="type">Color</span>(red: <span class="number">239.0</span> <span class="operator">/</span> <span class="number">255</span>, green: <span class="number">172.0</span> <span class="operator">/</span> <span class="number">255</span>, blue: <span class="number">120.0</span> <span class="operator">/</span> <span class="number">255</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/1e524ce2966d5a60db50b14b4b30ae40adbd877f7e0456464b2d1dfa6ebc7f5a/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f346631383133633738392f63376362313063312d376536342d346362362d623536362d3065306533633566326331372e706e67" alt=""></p>
<h2 id="步骤9">步骤9</h2>
<p><a href="#%E6%AD%A5%E9%AA%A49"></a></p>
<p>对渐变填充应用<code>aspectRatio（u:contentMode:）</code>修饰符。</p>
<p>即使其父视图不是正方形的，可以通过它可以使视图保持1:1的宽高比，并保持其在视图中心的位置。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; geometry <span class="keyword">in</span></span><br><span class="line">            <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">var</span> width: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="built_in">min</span>(geometry.size.width, geometry.size.height)</span><br><span class="line">                <span class="keyword">let</span> height <span class="operator">=</span> width</span><br><span class="line">                <span class="keyword">let</span> xScale: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">0.832</span></span><br><span class="line">                <span class="keyword">let</span> xOffset <span class="operator">=</span> (width <span class="operator">*</span> (<span class="number">1.0</span> <span class="operator">-</span> xScale)) <span class="operator">/</span> <span class="number">2.0</span></span><br><span class="line">                width <span class="operator">*=</span> xScale</span><br><span class="line">                path.move(</span><br><span class="line">                    to: <span class="type">CGPoint</span>(</span><br><span class="line">                        x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="number">0.95</span>,</span><br><span class="line">                        y: height <span class="operator">*</span> (<span class="number">0.20</span> <span class="operator">+</span> <span class="type">HexagonParameters</span>.adjustment)</span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                <span class="type">HexagonParameters</span>.points.forEach &#123;</span><br><span class="line">                    path.addLine(</span><br><span class="line">                        to: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">0</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">0</span></span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                    </span><br><span class="line">                    path.addQuadCurve(</span><br><span class="line">                        to: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">1</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">1</span></span><br><span class="line">                        ),</span><br><span class="line">                        control: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">2</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">2</span></span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .fill(<span class="type">LinearGradient</span>(</span><br><span class="line">                gradient: .<span class="keyword">init</span>(colors: [<span class="keyword">Self</span>.gradientStart, <span class="keyword">Self</span>.gradientEnd]),</span><br><span class="line">                startPoint: .<span class="keyword">init</span>(x: <span class="number">0.5</span>, y: <span class="number">0</span>),</span><br><span class="line">                endPoint: .<span class="keyword">init</span>(x: <span class="number">0.5</span>, y: <span class="number">0.6</span>)</span><br><span class="line">            ))</span><br><span class="line">            .aspectRatio(<span class="number">1</span>, contentMode: .fit)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> gradientStart <span class="operator">=</span> <span class="type">Color</span>(red: <span class="number">239.0</span> <span class="operator">/</span> <span class="number">255</span>, green: <span class="number">120.0</span> <span class="operator">/</span> <span class="number">255</span>, blue: <span class="number">221.0</span> <span class="operator">/</span> <span class="number">255</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> gradientEnd <span class="operator">=</span> <span class="type">Color</span>(red: <span class="number">239.0</span> <span class="operator">/</span> <span class="number">255</span>, green: <span class="number">172.0</span> <span class="operator">/</span> <span class="number">255</span>, blue: <span class="number">120.0</span> <span class="operator">/</span> <span class="number">255</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/f7fec3cabd47e719e97ea257fc21fb68c72689ffffca4ff3ceeb769d8063483c/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f333535643136623766662f36623561346438332d373034352d343862312d623431642d6231323936623037303265652e706e67" alt=""></p>
<h2 id="第三节-画徽章符号">第三节 画徽章符号</h2>
<p><a href="#%E7%AC%AC%E4%B8%89%E8%8A%82-%E7%94%BB%E5%BE%BD%E7%AB%A0%E7%AC%A6%E5%8F%B7"></a></p>
<p>地标徽章的中心有一个自定义徽章，该徽章基于地标应用程序图标中显示的山。</p>
<p>山体符号由两个形状组成：一个表示山顶的积雪，另一个表示沿引道的植被。您将使用两个由一个小间隙隔开的部分三角形来绘制它们。</p>
<p><img src="https://camo.githubusercontent.com/019468198dbe1e4663f786a97adedae4c70b9857a7bc2a3042250d9515d1480f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f353238376430396166642f34373364366363652d656164342d343438332d616438302d3364363934653733633435612e706e67" alt=""></p>
<h2 id="步骤1-8">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-2"></a></p>
<p>在名为<code>BadgeBackground.swift</code>的新文件中，将徽章视图的主体放入新的徽章背景视图中，以便为其他视图准备徽章视图。</p>
<blockquote>
<p>BadgeBackground.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BadgeBackground</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; geometry <span class="keyword">in</span></span><br><span class="line">            <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">var</span> width: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="built_in">min</span>(geometry.size.width, geometry.size.height)</span><br><span class="line">                <span class="keyword">let</span> height <span class="operator">=</span> width</span><br><span class="line">                <span class="keyword">let</span> xScale: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">0.832</span></span><br><span class="line">                <span class="keyword">let</span> xOffset <span class="operator">=</span> (width <span class="operator">*</span> (<span class="number">1.0</span> <span class="operator">-</span> xScale)) <span class="operator">/</span> <span class="number">2.0</span></span><br><span class="line">                width <span class="operator">*=</span> xScale</span><br><span class="line">                path.move(</span><br><span class="line">                    to: <span class="type">CGPoint</span>(</span><br><span class="line">                        x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="number">0.95</span>,</span><br><span class="line">                        y: height <span class="operator">*</span> (<span class="number">0.20</span> <span class="operator">+</span> <span class="type">HexagonParameters</span>.adjustment)</span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                <span class="type">HexagonParameters</span>.points.forEach &#123;</span><br><span class="line">                    path.addLine(</span><br><span class="line">                        to: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">0</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">0</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">0</span></span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                    </span><br><span class="line">                    path.addQuadCurve(</span><br><span class="line">                        to: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">1</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">1</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">1</span></span><br><span class="line">                        ),</span><br><span class="line">                        control: .<span class="keyword">init</span>(</span><br><span class="line">                            x: xOffset <span class="operator">+</span> width <span class="operator">*</span> <span class="variable">$0</span>.useWidth.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.xFactors.<span class="number">2</span>,</span><br><span class="line">                            y: height <span class="operator">*</span> <span class="variable">$0</span>.useHeight.<span class="number">2</span> <span class="operator">*</span> <span class="variable">$0</span>.yFactors.<span class="number">2</span></span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .fill(<span class="type">LinearGradient</span>(</span><br><span class="line">                gradient: .<span class="keyword">init</span>(colors: [<span class="keyword">Self</span>.gradientStart, <span class="keyword">Self</span>.gradientEnd]),</span><br><span class="line">                startPoint: .<span class="keyword">init</span>(x: <span class="number">0.5</span>, y: <span class="number">0</span>),</span><br><span class="line">                endPoint: .<span class="keyword">init</span>(x: <span class="number">0.5</span>, y: <span class="number">0.6</span>)</span><br><span class="line">            ))</span><br><span class="line">            .aspectRatio(<span class="number">1</span>, contentMode: .fit)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> gradientStart <span class="operator">=</span> <span class="type">Color</span>(red: <span class="number">239.0</span> <span class="operator">/</span> <span class="number">255</span>, green: <span class="number">120.0</span> <span class="operator">/</span> <span class="number">255</span>, blue: <span class="number">221.0</span> <span class="operator">/</span> <span class="number">255</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> gradientEnd <span class="operator">=</span> <span class="type">Color</span>(red: <span class="number">239.0</span> <span class="operator">/</span> <span class="number">255</span>, green: <span class="number">172.0</span> <span class="operator">/</span> <span class="number">255</span>, blue: <span class="number">120.0</span> <span class="operator">/</span> <span class="number">255</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BadgeBackground_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">BadgeBackground</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤2-8">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-2"></a></p>
<p>将徽章背景放在徽章主体中以恢复徽章。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">BadgeBackground</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤3-6">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-1"></a></p>
<p>为山形创建一个名为<code>BadgeSymbol</code>的新自定义视图，该山形在徽章设计中以旋转方式绘制。</p>
<blockquote>
<p>BadgeSymbol.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BadgeSymbol</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Badge Symbol&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BadgeSymbol_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">BadgeSymbol</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤4-5">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-1"></a></p>
<blockquote>
<p>使用<code>Paths api</code>绘制符号的顶部。</p>
</blockquote>
<p><em><strong>实验</strong></em></p>
<p>尝试调整与spacing、topWidth和topHeight常量关联的系数，以查看它们如何影响整体形状。</p>
<blockquote>
<p>BadgeSymbol.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BadgeSymbol</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; geometry <span class="keyword">in</span></span><br><span class="line">            <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">let</span> width <span class="operator">=</span> <span class="built_in">min</span>(geometry.size.width, geometry.size.height)</span><br><span class="line">                <span class="keyword">let</span> height <span class="operator">=</span> width <span class="operator">*</span> <span class="number">0.75</span></span><br><span class="line">                <span class="keyword">let</span> spacing <span class="operator">=</span> width <span class="operator">*</span> <span class="number">0.030</span></span><br><span class="line">                <span class="keyword">let</span> middle <span class="operator">=</span> width <span class="operator">/</span> <span class="number">2</span></span><br><span class="line">                <span class="keyword">let</span> topWidth <span class="operator">=</span> <span class="number">0.226</span> <span class="operator">*</span> width</span><br><span class="line">                <span class="keyword">let</span> topHeight <span class="operator">=</span> <span class="number">0.488</span> <span class="operator">*</span> height</span><br><span class="line">                </span><br><span class="line">                path.addLines([</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle, y: spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle <span class="operator">-</span> topWidth, y: topHeight <span class="operator">-</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle, y: topHeight <span class="operator">/</span> <span class="number">2</span> <span class="operator">+</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle <span class="operator">+</span> topWidth, y: topHeight <span class="operator">-</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle, y: spacing)</span><br><span class="line">                ])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BadgeSymbol_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">BadgeSymbol</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d4fadb1b6926aa0b920704543e3f73a53eca3e540352a8451d47b41ea0f88306/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f303864376334646534332f34653164623734382d653532622d343964662d386634652d3264636562356137303631662e706e67" alt=""></p>
<h2 id="步骤5-3">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-1"></a></p>
<p>绘制符号的底部。</p>
<p>使用<code>move(to:)</code> 修饰符在同一路径中的多个形状之间插入间隙。</p>
<blockquote>
<p>BadgeSymbol.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BadgeSymbol</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; geometry <span class="keyword">in</span></span><br><span class="line">            <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">let</span> width <span class="operator">=</span> <span class="built_in">min</span>(geometry.size.width, geometry.size.height)</span><br><span class="line">                <span class="keyword">let</span> height <span class="operator">=</span> width <span class="operator">*</span> <span class="number">0.75</span></span><br><span class="line">                <span class="keyword">let</span> spacing <span class="operator">=</span> width <span class="operator">*</span> <span class="number">0.030</span></span><br><span class="line">                <span class="keyword">let</span> middle <span class="operator">=</span> width <span class="operator">/</span> <span class="number">2</span></span><br><span class="line">                <span class="keyword">let</span> topWidth <span class="operator">=</span> <span class="number">0.226</span> <span class="operator">*</span> width</span><br><span class="line">                <span class="keyword">let</span> topHeight <span class="operator">=</span> <span class="number">0.488</span> <span class="operator">*</span> height</span><br><span class="line">                </span><br><span class="line">                path.addLines([</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle, y: spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle <span class="operator">-</span> topWidth, y: topHeight <span class="operator">-</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle, y: topHeight <span class="operator">/</span> <span class="number">2</span> <span class="operator">+</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle <span class="operator">+</span> topWidth, y: topHeight <span class="operator">-</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle, y: spacing)</span><br><span class="line">                ])</span><br><span class="line">                </span><br><span class="line">                path.move(to: <span class="type">CGPoint</span>(x: middle, y: topHeight <span class="operator">/</span> <span class="number">2</span> <span class="operator">+</span> spacing <span class="operator">*</span> <span class="number">3</span>))</span><br><span class="line">                path.addLines([</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle <span class="operator">-</span> topWidth, y: topHeight <span class="operator">+</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: spacing, y: height <span class="operator">-</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: width <span class="operator">-</span> spacing, y: height <span class="operator">-</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle <span class="operator">+</span> topWidth, y: topHeight <span class="operator">+</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle, y: topHeight <span class="operator">/</span> <span class="number">2</span> <span class="operator">+</span> spacing <span class="operator">*</span> <span class="number">3</span>)</span><br><span class="line">                ])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BadgeSymbol_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">BadgeSymbol</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/2aeb7c2c54ec4a4df93333c94e73d44e38f3d49090df9e54659f949904bcf0fd/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f313836336566373939612f38343533353366342d386161302d343661362d613235662d6539333866626132363064632e706e67" alt=""></p>
<h2 id="步骤6-3">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46-1"></a></p>
<p>用设计中的紫色填充符号。</p>
<blockquote>
<p>BadgeSymbol.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BadgeSymbol</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> symbolColor <span class="operator">=</span> <span class="type">Color</span>(red: <span class="number">79.0</span> <span class="operator">/</span> <span class="number">255</span>, green: <span class="number">79.0</span> <span class="operator">/</span> <span class="number">255</span>, blue: <span class="number">191.0</span> <span class="operator">/</span> <span class="number">255</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; geometry <span class="keyword">in</span></span><br><span class="line">            <span class="type">Path</span> &#123; path <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">let</span> width <span class="operator">=</span> <span class="built_in">min</span>(geometry.size.width, geometry.size.height)</span><br><span class="line">                <span class="keyword">let</span> height <span class="operator">=</span> width <span class="operator">*</span> <span class="number">0.75</span></span><br><span class="line">                <span class="keyword">let</span> spacing <span class="operator">=</span> width <span class="operator">*</span> <span class="number">0.030</span></span><br><span class="line">                <span class="keyword">let</span> middle <span class="operator">=</span> width <span class="operator">/</span> <span class="number">2</span></span><br><span class="line">                <span class="keyword">let</span> topWidth <span class="operator">=</span> <span class="number">0.226</span> <span class="operator">*</span> width</span><br><span class="line">                <span class="keyword">let</span> topHeight <span class="operator">=</span> <span class="number">0.488</span> <span class="operator">*</span> height</span><br><span class="line">                </span><br><span class="line">                path.addLines([</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle, y: spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle <span class="operator">-</span> topWidth, y: topHeight <span class="operator">-</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle, y: topHeight <span class="operator">/</span> <span class="number">2</span> <span class="operator">+</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle <span class="operator">+</span> topWidth, y: topHeight <span class="operator">-</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle, y: spacing)</span><br><span class="line">                ])</span><br><span class="line">                </span><br><span class="line">                path.move(to: <span class="type">CGPoint</span>(x: middle, y: topHeight <span class="operator">/</span> <span class="number">2</span> <span class="operator">+</span> spacing <span class="operator">*</span> <span class="number">3</span>))</span><br><span class="line">                path.addLines([</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle <span class="operator">-</span> topWidth, y: topHeight <span class="operator">+</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: spacing, y: height <span class="operator">-</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: width <span class="operator">-</span> spacing, y: height <span class="operator">-</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle <span class="operator">+</span> topWidth, y: topHeight <span class="operator">+</span> spacing),</span><br><span class="line">                    <span class="type">CGPoint</span>(x: middle, y: topHeight <span class="operator">/</span> <span class="number">2</span> <span class="operator">+</span> spacing <span class="operator">*</span> <span class="number">3</span>)</span><br><span class="line">                ])</span><br><span class="line">            &#125;</span><br><span class="line">            .fill(<span class="keyword">Self</span>.symbolColor)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BadgeSymbol_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">BadgeSymbol</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/fc3faabc42bfcfce0d0a86b1b86971ce62182e10312cb36b6d8a05722fe77787/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393631363965323830662f33643161333332362d646566612d343762342d623135352d3961643734646639636464312e706e67" alt=""></p>
<h2 id="第四节-结合徽章前景和背景">第四节 结合徽章前景和背景</h2>
<p><a href="#%E7%AC%AC%E5%9B%9B%E8%8A%82-%E7%BB%93%E5%90%88%E5%BE%BD%E7%AB%A0%E5%89%8D%E6%99%AF%E5%92%8C%E8%83%8C%E6%99%AF"></a></p>
<p>徽章设计要求在徽章背景上旋转和重复多次山形。</p>
<p>定义一种新的<code>rotation</code>类型，并利用<code>ForEach</code>视图对山形的多个副本使用相同的调整。</p>
<p><img src="https://camo.githubusercontent.com/aefc19d3e0f719333604185d492ec381604058f783ada30cf5eefecc61564831/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336635623564396530312f34333233363733312d303631652d343636322d386632372d3036643731636138663030302e706e67" alt=""></p>
<h2 id="步骤1-9">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-3"></a></p>
<p>创建新的<code>RotatedBadgeSymbol</code>视图以封装旋转符号。</p>
<p><em><strong>实验</strong></em></p>
<p>调整预览中的角度以测试旋转的效果。</p>
<blockquote>
<p>RotatedBadgeSymbol.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">RotatedBadgeSymbol</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> angle: <span class="type">Angle</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">BadgeSymbol</span>()</span><br><span class="line">            .padding(<span class="operator">-</span><span class="number">60</span>)</span><br><span class="line">            .rotationEffect(angle, anchor: .bottom)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">RotatedBadgeSymbol_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">RotatedBadgeSymbol</span>(angle: .<span class="keyword">init</span>(degrees: <span class="number">5</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/ad2e99a305cefccad8c1af9625fcd5a9ff17af394400b48eb5ce888f606d07c8/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f613730626135386564302f65303339656131662d343735662d343261662d623561312d3530363365623533353838302e706e67" alt=""></p>
<h2 id="步骤2-9">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-3"></a></p>
<p>在<code>Badge.swift</code>中，将徽章的符号放置在<code>ZStack</code>中，将其放置在徽章背景上。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> badgeSymbols: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">RotatedBadgeSymbol</span>(angle: .<span class="keyword">init</span>(degrees: <span class="number">0</span>))</span><br><span class="line">            .opacity(<span class="number">0.5</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span> &#123;</span><br><span class="line">            <span class="type">BadgeBackground</span>()</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">self</span>.badgeSymbols</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/4c54668adce42a3f23ee929bbb920da390554088e0499f1118a56e3103976bee/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f636133386162363635662f61613838653861382d666339652d343332312d626666632d3134313936663561366233392e706e67" alt=""></p>
<blockquote>
<p>现在看来，徽章符号与预期的设计和背景的相对大小相比太大了。</p>
</blockquote>
<h2 id="步骤3-7">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-2"></a></p>
<p>通过读取周围的几何图形并缩放符号，更正徽章符号的大小。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> badgeSymbols: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">RotatedBadgeSymbol</span>(angle: .<span class="keyword">init</span>(degrees: <span class="number">0</span>))</span><br><span class="line">            .opacity(<span class="number">0.5</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span> &#123;</span><br><span class="line">            <span class="type">BadgeBackground</span>()</span><br><span class="line">            </span><br><span class="line">            <span class="type">GeometryReader</span> &#123; geometry <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">self</span>.badgeSymbols</span><br><span class="line">                    .scaleEffect(<span class="number">1.0</span> <span class="operator">/</span> <span class="number">4.0</span>, anchor: .top)</span><br><span class="line">                    .position(x: geometry.size.width <span class="operator">/</span> <span class="number">2.0</span>, y: (<span class="number">3.0</span> <span class="operator">/</span> <span class="number">4.0</span>) <span class="operator">*</span> geometry.size.height)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/09976e95e2403dcece078fb1844cb1507b630bb76f19daecd72b08257b4b011b/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393030343133613433662f35393537303331322d373337642d343062352d393437322d3030626431363163633066652e706e67" alt=""></p>
<h2 id="步骤4-6">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-2"></a></p>
<p>使用<code>ForEach</code>创建旋转显示多个徽章符号的副本。</p>
<p>一个完整的360°旋转分成八个部分，通过重复山脉符号创建一个类似太阳的图案。</p>
<blockquote>
<p>Badge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> rotationCount <span class="operator">=</span> <span class="number">8</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> badgeSymbols: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ForEach</span>(<span class="number">0</span><span class="operator">..&lt;</span><span class="type">Badge</span>.rotationCount) &#123; i <span class="keyword">in</span></span><br><span class="line">            <span class="type">RotatedBadgeSymbol</span>(</span><br><span class="line">                angle: .degrees(<span class="type">Double</span>(i) <span class="operator">/</span> <span class="type">Double</span>(<span class="type">Badge</span>.rotationCount)) <span class="operator">*</span> <span class="number">360.0</span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">        .opacity(<span class="number">0.5</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span> &#123;</span><br><span class="line">            <span class="type">BadgeBackground</span>()</span><br><span class="line">            </span><br><span class="line">            <span class="type">GeometryReader</span> &#123; geometry <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">self</span>.badgeSymbols</span><br><span class="line">                    .scaleEffect(<span class="number">1.0</span> <span class="operator">/</span> <span class="number">4.0</span>, anchor: .top)</span><br><span class="line">                    .position(x: geometry.size.width <span class="operator">/</span> <span class="number">2.0</span>, y: (<span class="number">3.0</span> <span class="operator">/</span> <span class="number">4.0</span>) <span class="operator">*</span> geometry.size.height)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .scaledToFit()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Badge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Badge</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/15ff62f5c4764fddd5e34e530ddd55baeb2c23d7db10f095d2de39e4ce090b1c/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f633266353134336336612f38656165633265312d306564652d343561332d386361382d6139376230323135653530392e706e67" alt=""></p>
<h3 id="框架集成">框架集成</h3>
<p><a href="#%E6%A1%86%E6%9E%B6%E9%9B%86%E6%88%90"></a></p>
<h2 id="与UIKit协作">与UIKit协作</h2>
<p><a href="#%E4%B8%8Euikit%E5%8D%8F%E4%BD%9C"></a></p>
<p>SwiftUI与所有苹果平台上现有的UI框架无缝协作。例如，可以将UIKit视图和视图控制器放置在SwiftUI视图中，反之亦然。</p>
<p>本教程向您展示如何将主页的特色地标转换为包装UIPageViewController和UIPageControl实例。您将使用UIPageViewController来显示SwiftUI视图的轮播，并使用状态变量和绑定来协调整个用户界面中的数据更新。</p>
<blockquote>
<p>学习时间：25分钟</p>
<p><a target="_blank" rel="noopener" href="https://docs-assets.developer.apple.com/published/189399d05e/InterfacingWithUIKit.zip">下载地址：InterfacingWithUIKit.zip</a></p>
</blockquote>
<h2 id="第一节">第一节</h2>
<p><a href="#%E7%AC%AC%E4%B8%80%E8%8A%82"></a></p>
<p>创建显示UIPageViewController的视图</p>
<p>要在SwiftUI中显示UIKit视图和视图控制器，可以创建遵守<code>UIViewRepresentable</code>和<code>UIViewControllerRepresentable</code>协议的类型，您的自定义类型创建并配置它们所表示的UIKit类型，而SwiftUI管理它们的生命周期，并在需要时更新它们。</p>
<p><img src="https://camo.githubusercontent.com/b490958db204499bec0d9227373b3866b89eacf7ce83dbde95acf21bb9f2fb88/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f303665613065303265392f34343662303334372d356462382d343131332d383638632d3661346432626538333832652e706e67" alt=""></p>
<h2 id="步骤1-10">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41"></a></p>
<p>创建一个名为<code>PageViewController.swift</code>的新SwiftUI视图文件，并声明<code>PageViewController</code>类型遵守<code>UIViewControllerRepresentable</code>。</p>
<p>页面视图控制器存储<code>UIViewController</code>实例的数组。这些是在地标之间滚动的页面。</p>
<blockquote>
<p>PageViewController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageViewController</span>: <span class="title class_ inherited__">UIViewControllerRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> controllers: [<span class="type">UIViewController</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>接下来，添加<code>UIViewControllerRepresentable</code>协议的两个方法。</p>
</blockquote>
<h2 id="步骤2-10">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42"></a></p>
<p>添加<code>makeUIViewController（context:）</code>方法，该方法创建满足需求的<code>UIPageViewController</code>。</p>
<p>SwiftUI在准备好显示视图时调用此方法一次，然后管理视图控制器的生命周期。</p>
<blockquote>
<p>PageViewController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageViewController</span>: <span class="title class_ inherited__">UIViewControllerRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> controllers: [<span class="type">UIViewController</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIViewController</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageViewController</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> pageViewController <span class="operator">=</span> <span class="type">UIPageViewController</span>(</span><br><span class="line">            transitionStyle: .scroll,</span><br><span class="line">            navigationOrientation: .horizontal)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageViewController</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤3-8">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43"></a></p>
<p>添加一个<code>updateUIViewController（_:context:）</code>方法，该方法调用<code>setViewControllers(_:direction:animated:)</code>以显示数组中的第一个视图控制器。</p>
<blockquote>
<p>PageViewController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageViewController</span>: <span class="title class_ inherited__">UIViewControllerRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> controllers: [<span class="type">UIViewController</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIViewController</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageViewController</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> pageViewController <span class="operator">=</span> <span class="type">UIPageViewController</span>(</span><br><span class="line">            transitionStyle: .scroll,</span><br><span class="line">            navigationOrientation: .horizontal)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageViewController</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIViewController</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        pageViewController.setViewControllers(</span><br><span class="line">            [controllers[<span class="number">0</span>]], direction: .forward, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>创建另一个SwiftUI视图以显示UIViewControllerRepresentable视图。</p>
</blockquote>
<h2 id="步骤4-7">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44"></a></p>
<p>创建一个名为<code>PageView.swift</code>的新SwiftUI视图文件，并更新<code>PageView</code>类型以将<code>PageViewController</code>声明为子视图。</p>
<p>注意，泛型初始值设定项接受一个视图数组，并将每个视图嵌套在<code>UIHostingController</code>中。<code>UIHostingController</code>是<code>UIViewController</code>子类，表示UIKit上下文中的SwiftUI视图。</p>
<blockquote>
<p>PageView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView</span>&lt;<span class="type">Page</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> viewControllers: [<span class="type">UIHostingController</span>&lt;<span class="type">Page</span>&gt;]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">views</span>: [<span class="type">Page</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.viewControllers <span class="operator">=</span> views.map &#123; <span class="type">UIHostingController</span>(rootView: <span class="variable">$0</span>) &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageViewController</span>(controllers: viewControllers)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤5-4">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45"></a></p>
<p>更新<code>PageView_Preview</code>以传递所需的视图数组，此时预览开始工作。</p>
<blockquote>
<p>PageView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView</span>&lt;<span class="type">Page</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> viewControllers: [<span class="type">UIHostingController</span>&lt;<span class="type">Page</span>&gt;]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">views</span>: [<span class="type">Page</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.viewControllers <span class="operator">=</span> views.map &#123; <span class="type">UIHostingController</span>(rootView: <span class="variable">$0</span>) &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageViewController</span>(controllers: viewControllers)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageView</span>(features.map &#123; <span class="type">FeatureCard</span>(landmark: <span class="variable">$0</span>) &#125;)</span><br><span class="line">            .aspectRatio(<span class="number">3</span><span class="operator">/</span><span class="number">2</span>, contentMode: .fit)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d5b9106f3812db2f0ec1daa8e138cccdc07062e87738cf859bc10dca88821760/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336432393630643539312f64323265646539662d316136622d346464372d623839652d3062363763393734316263332e706e67" alt=""></p>
<h2 id="步骤6-4">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46"></a></p>
<p>在继续下一步之前，将页面视图预览固定到画布，所有操作变化都会发生在此视图上。</p>
<p><img src="https://camo.githubusercontent.com/d38e16df8e4d7240ecca90f3c33c0e8820f34d0ccf2fb0dea6f1edb9c8391101/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f383537353364343366392f65646439346234362d366539632d343737312d383265642d3965366533326639623965632e706e67" alt=""></p>
<h2 id="第二节-创建视图控制器的数据源">第二节 创建视图控制器的数据源</h2>
<p><a href="#%E7%AC%AC%E4%BA%8C%E8%8A%82-%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE%E6%8E%A7%E5%88%B6%E5%99%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E6%BA%90"></a></p>
<p>在几个简单的步骤中，您已经完成了很多工作—<code>PageViewController</code>使用一个<code>UIPageViewController</code>在SwiftUI视图中显示内容。现在是时候让视图轮播滚动了。</p>
<p><img src="https://camo.githubusercontent.com/58608e8bf0060b71898229848d86fc96cb667132cc83a5d5e93b1747400c78ae/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f346662643636376566382f37646366333263302d336230332d346235662d383336302d6264636339306664336632332e706e67" alt=""></p>
<blockquote>
<p>代表UIKit视图控制器的SwiftUI视图可以定义一个``类型，SwiftUI将其作为可表示视图上下文的一部分进行提供和管理。</p>
</blockquote>
<h2 id="步骤1-11">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-1"></a></p>
<p>在<code>PageViewController</code>中声明嵌套的<code>Coordinator</code>类。</p>
<p>SwiftUI管理<code>UIViewControllerRepresentable</code>类型的<code>Coordinator</code>，并在调用上面创建的方法时将其作为上下文的一部分提供。</p>
<blockquote>
<p>PageViewController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageViewController</span>: <span class="title class_ inherited__">UIViewControllerRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> controllers: [<span class="type">UIViewController</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIViewController</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageViewController</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> pageViewController <span class="operator">=</span> <span class="type">UIPageViewController</span>(</span><br><span class="line">            transitionStyle: .scroll,</span><br><span class="line">            navigationOrientation: .horizontal)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageViewController</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIViewController</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        pageViewController.setViewControllers(</span><br><span class="line">            [controllers[<span class="number">0</span>]], direction: .forward, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Coordinator</span>: <span class="title class_ inherited__">NSObject</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> parent: <span class="type">PageViewController</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">PageViewController</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.parent <span class="operator">=</span> pageViewController</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d5b9106f3812db2f0ec1daa8e138cccdc07062e87738cf859bc10dca88821760/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336432393630643539312f64323265646539662d316136622d346464372d623839652d3062363763393734316263332e706e67" alt=""></p>
<h2 id="步骤2-11">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-1"></a></p>
<p>向<code>PageViewController</code>添加另一个方法以生成<code>Coordinator</code>。</p>
<p>SwiftUI在<code>makeUIViewController(context:)</code>之前调用此<code>makeCoordinator（）</code>方法，以便在配置视图控制器时可以访问<code>coordinator</code>对象。</p>
<blockquote>
<p>Tips 您可以使用这个<code>Coordinator</code>来实现常见的<code>Cocoa</code>模式，例如委托、数据源和通过<code>target-action</code>响应用户事件。</p>
</blockquote>
<blockquote>
<p>PageViewController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageViewController</span>: <span class="title class_ inherited__">UIViewControllerRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> controllers: [<span class="type">UIViewController</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeCoordinator</span>() -&gt; <span class="type">Coordinator</span> &#123;</span><br><span class="line">        <span class="type">Coordinator</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIViewController</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageViewController</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> pageViewController <span class="operator">=</span> <span class="type">UIPageViewController</span>(</span><br><span class="line">            transitionStyle: .scroll,</span><br><span class="line">            navigationOrientation: .horizontal)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageViewController</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIViewController</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        pageViewController.setViewControllers(</span><br><span class="line">            [controllers[<span class="number">0</span>]], direction: .forward, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Coordinator</span>: <span class="title class_ inherited__">NSObject</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> parent: <span class="type">PageViewController</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">PageViewController</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.parent <span class="operator">=</span> pageViewController</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d5b9106f3812db2f0ec1daa8e138cccdc07062e87738cf859bc10dca88821760/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336432393630643539312f64323265646539662d316136622d346464372d623839652d3062363763393734316263332e706e67" alt=""></p>
<h2 id="步骤3-9">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-1"></a></p>
<p>向<code>Coordinator</code>类型添加<code>UIPageViewControllerDataSource</code>一致性，并实现两个必需的方法。</p>
<p>这两个方法建立视图控制器之间的关系，以便您可以在它们之间来回滑动。</p>
<blockquote>
<p>PageViewController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageViewController</span>: <span class="title class_ inherited__">UIViewControllerRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> controllers: [<span class="type">UIViewController</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeCoordinator</span>() -&gt; <span class="type">Coordinator</span> &#123;</span><br><span class="line">        <span class="type">Coordinator</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIViewController</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageViewController</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> pageViewController <span class="operator">=</span> <span class="type">UIPageViewController</span>(</span><br><span class="line">            transitionStyle: .scroll,</span><br><span class="line">            navigationOrientation: .horizontal)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageViewController</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIViewController</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        pageViewController.setViewControllers(</span><br><span class="line">            [controllers[<span class="number">0</span>]], direction: .forward, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Coordinator</span>: <span class="title class_ inherited__">NSObject</span>, <span class="title class_ inherited__">UIPageViewControllerDataSource</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> parent: <span class="type">PageViewController</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">PageViewController</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.parent <span class="operator">=</span> pageViewController</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(</span><br><span class="line">            <span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>,</span><br><span class="line">            <span class="params">viewControllerBefore</span> <span class="params">viewController</span>: <span class="type">UIViewController</span>) -&gt; <span class="type">UIViewController</span>?</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: viewController) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> index <span class="operator">==</span> <span class="number">0</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> parent.controllers.last</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> parent.controllers[index <span class="operator">-</span> <span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(</span><br><span class="line">            <span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>,</span><br><span class="line">            <span class="params">viewControllerAfter</span> <span class="params">viewController</span>: <span class="type">UIViewController</span>) -&gt; <span class="type">UIViewController</span>?</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: viewController) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> index <span class="operator">+</span> <span class="number">1</span> <span class="operator">==</span> parent.controllers.count &#123;</span><br><span class="line">                <span class="keyword">return</span> parent.controllers.first</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> parent.controllers[index <span class="operator">+</span> <span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d5b9106f3812db2f0ec1daa8e138cccdc07062e87738cf859bc10dca88821760/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336432393630643539312f64323265646539662d316136622d346464372d623839652d3062363763393734316263332e706e67" alt=""></p>
<h2 id="步骤4-8">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-1"></a></p>
<p>将<code>coordinator</code>添加为<code>UIPageViewController</code>的数据源。</p>
<blockquote>
<p>PageViewController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageViewController</span>: <span class="title class_ inherited__">UIViewControllerRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> controllers: [<span class="type">UIViewController</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeCoordinator</span>() -&gt; <span class="type">Coordinator</span> &#123;</span><br><span class="line">        <span class="type">Coordinator</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIViewController</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageViewController</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> pageViewController <span class="operator">=</span> <span class="type">UIPageViewController</span>(</span><br><span class="line">            transitionStyle: .scroll,</span><br><span class="line">            navigationOrientation: .horizontal)</span><br><span class="line">        pageViewController.dataSource <span class="operator">=</span> context.coordinator</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageViewController</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIViewController</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        pageViewController.setViewControllers(</span><br><span class="line">            [controllers[<span class="number">0</span>]], direction: .forward, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Coordinator</span>: <span class="title class_ inherited__">NSObject</span>, <span class="title class_ inherited__">UIPageViewControllerDataSource</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> parent: <span class="type">PageViewController</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">PageViewController</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.parent <span class="operator">=</span> pageViewController</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(</span><br><span class="line">            <span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>,</span><br><span class="line">            <span class="params">viewControllerBefore</span> <span class="params">viewController</span>: <span class="type">UIViewController</span>) -&gt; <span class="type">UIViewController</span>?</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: viewController) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> index <span class="operator">==</span> <span class="number">0</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> parent.controllers.last</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> parent.controllers[index <span class="operator">-</span> <span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(</span><br><span class="line">            <span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>,</span><br><span class="line">            <span class="params">viewControllerAfter</span> <span class="params">viewController</span>: <span class="type">UIViewController</span>) -&gt; <span class="type">UIViewController</span>?</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: viewController) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> index <span class="operator">+</span> <span class="number">1</span> <span class="operator">==</span> parent.controllers.count &#123;</span><br><span class="line">                <span class="keyword">return</span> parent.controllers.first</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> parent.controllers[index <span class="operator">+</span> <span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d5b9106f3812db2f0ec1daa8e138cccdc07062e87738cf859bc10dca88821760/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336432393630643539312f64323265646539662d316136622d346464372d623839652d3062363763393734316263332e706e67" alt=""></p>
<h2 id="步骤5-5">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-1"></a></p>
<p>打开实时预览并测试滑动交互。</p>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/_p42_swipe_interactions.gif" alt=""></p>
<h2 id="第三节-在SwiftUI视图状态下跟踪页面">第三节 在SwiftUI视图状态下跟踪页面</h2>
<p><a href="#%E7%AC%AC%E4%B8%89%E8%8A%82-%E5%9C%A8swiftui%E8%A7%86%E5%9B%BE%E7%8A%B6%E6%80%81%E4%B8%8B%E8%B7%9F%E8%B8%AA%E9%A1%B5%E9%9D%A2"></a></p>
<p>要准备添加自定义<code>UIPageControl</code>，需要一种方法从<code>PageView</code>中跟踪当前页。</p>
<p>为此，您将在<code>PageView</code>中声明<code>@State</code>属性，并将对该属性的绑定传递到<code>PageViewController</code>视图。<code>PageViewController</code>更新绑定以匹配当前可见页。</p>
<p><img src="https://camo.githubusercontent.com/e92d63ed36a1d524de83d58689d504c2b2618167cffc2dd875938f3bc65159df/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f313865323661616564652f62393733393638612d633030372d343061332d613332342d6431626336383731313134622e706e67" alt=""></p>
<h2 id="步骤1-12">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-2"></a></p>
<p>首先添加一个<code>currentPage</code>绑定作为<code>PageViewController</code>的属性。</p>
<p>除了声明<code>@Binding</code>属性外，还要更新对<code>setViewControllers（u:direction:animated:）</code>的调用，传递<code>currentPage</code>绑定的值。</p>
<blockquote>
<p>PageViewController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageViewController</span>: <span class="title class_ inherited__">UIViewControllerRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> controllers: [<span class="type">UIViewController</span>]</span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> currentPage: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeCoordinator</span>() -&gt; <span class="type">Coordinator</span> &#123;</span><br><span class="line">        <span class="type">Coordinator</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIViewController</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageViewController</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> pageViewController <span class="operator">=</span> <span class="type">UIPageViewController</span>(</span><br><span class="line">            transitionStyle: .scroll,</span><br><span class="line">            navigationOrientation: .horizontal)</span><br><span class="line">        pageViewController.dataSource <span class="operator">=</span> context.coordinator</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageViewController</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIViewController</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        pageViewController.setViewControllers(</span><br><span class="line">            [controllers[currentPage]], direction: .forward, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Coordinator</span>: <span class="title class_ inherited__">NSObject</span>, <span class="title class_ inherited__">UIPageViewControllerDataSource</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> parent: <span class="type">PageViewController</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">PageViewController</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.parent <span class="operator">=</span> pageViewController</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(</span><br><span class="line">            <span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>,</span><br><span class="line">            <span class="params">viewControllerBefore</span> <span class="params">viewController</span>: <span class="type">UIViewController</span>) -&gt; <span class="type">UIViewController</span>?</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: viewController) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> index <span class="operator">==</span> <span class="number">0</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> parent.controllers.last</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> parent.controllers[index <span class="operator">-</span> <span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(</span><br><span class="line">            <span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>,</span><br><span class="line">            <span class="params">viewControllerAfter</span> <span class="params">viewController</span>: <span class="type">UIViewController</span>) -&gt; <span class="type">UIViewController</span>?</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: viewController) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> index <span class="operator">+</span> <span class="number">1</span> <span class="operator">==</span> parent.controllers.count &#123;</span><br><span class="line">                <span class="keyword">return</span> parent.controllers.first</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> parent.controllers[index <span class="operator">+</span> <span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d5b9106f3812db2f0ec1daa8e138cccdc07062e87738cf859bc10dca88821760/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336432393630643539312f64323265646539662d316136622d346464372d623839652d3062363763393734316263332e706e67" alt=""></p>
<h2 id="步骤2-12">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-2"></a></p>
<p>在<code>PageView</code>中声明<code>@State</code>变量，并在创建子<code>PageViewController</code>时向属性传递绑定。</p>
<p><strong>重要</strong></p>
<p>请记住使用<code>$</code>语法创建用状态来存储值的绑定。</p>
<blockquote>
<p>PageView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView</span>&lt;<span class="type">Page</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> viewControllers: [<span class="type">UIHostingController</span>&lt;<span class="type">Page</span>&gt;]</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> currentPage <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">views</span>: [<span class="type">Page</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.viewControllers <span class="operator">=</span> views.map &#123; <span class="type">UIHostingController</span>(rootView: <span class="variable">$0</span>) &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageViewController</span>(controllers: viewControllers, currentPage: <span class="variable">$currentPage</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageView</span>(features.map &#123; <span class="type">FeatureCard</span>(landmark: <span class="variable">$0</span>) &#125;)</span><br><span class="line">            .aspectRatio(<span class="number">3</span><span class="operator">/</span><span class="number">2</span>, contentMode: .fit)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d5b9106f3812db2f0ec1daa8e138cccdc07062e87738cf859bc10dca88821760/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336432393630643539312f64323265646539662d316136622d346464372d623839652d3062363763393734316263332e706e67" alt=""></p>
<h2 id="步骤3-10">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-2"></a></p>
<p>通过更改<code>PageViewController</code>的初始值，测试该值是否通过绑定流向<code>PageViewController</code>。</p>
<blockquote>
<p>PageView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView</span>&lt;<span class="type">Page</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> viewControllers: [<span class="type">UIHostingController</span>&lt;<span class="type">Page</span>&gt;]</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> currentPage <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">views</span>: [<span class="type">Page</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.viewControllers <span class="operator">=</span> views.map &#123; <span class="type">UIHostingController</span>(rootView: <span class="variable">$0</span>) &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageViewController</span>(controllers: viewControllers, currentPage: <span class="variable">$currentPage</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageView</span>(features.map &#123; <span class="type">FeatureCard</span>(landmark: <span class="variable">$0</span>) &#125;)</span><br><span class="line">            .aspectRatio(<span class="number">3</span><span class="operator">/</span><span class="number">2</span>, contentMode: .fit)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><em>实验</em>：向<code>PageView</code>添加一个按钮，使<code>PageViewController</code>跳转到第二个视图。</p>
</blockquote>
<blockquote>
<p>PageView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView</span>&lt;<span class="type">Page</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> viewControllers: [<span class="type">UIHostingController</span>&lt;<span class="type">Page</span>&gt;]</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> currentPage <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">views</span>: [<span class="type">Page</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.viewControllers <span class="operator">=</span> views.map &#123; <span class="type">UIHostingController</span>(rootView: <span class="variable">$0</span>) &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageViewController</span>(controllers: viewControllers, currentPage: <span class="variable">$currentPage</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageView</span>(features.map &#123; <span class="type">FeatureCard</span>(landmark: <span class="variable">$0</span>) &#125;)</span><br><span class="line">            .aspectRatio(<span class="number">3</span><span class="operator">/</span><span class="number">2</span>, contentMode: .fit)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/5209c189ff1a2699c690fb8575e8b907bf5fe16b9e2e98c50af4627556b2b21b/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f373430303064653136322f37633136356330632d326330312d343633322d626339322d6634356566333135663634332e706e67" alt=""></p>
<h2 id="步骤4-9">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-2"></a></p>
<p>添加一个带有<code>currentPage</code>属性的文本视图，这样您就可以监视<code>@State</code>属性的值。</p>
<p>请注意，当您从一页刷到另一页时，值不会改变。</p>
<blockquote>
<p>PageView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView</span>&lt;<span class="type">Page</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> viewControllers: [<span class="type">UIHostingController</span>&lt;<span class="type">Page</span>&gt;]</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> currentPage <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">views</span>: [<span class="type">Page</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.viewControllers <span class="operator">=</span> views.map &#123; <span class="type">UIHostingController</span>(rootView: <span class="variable">$0</span>) &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">PageViewController</span>(controllers: viewControllers, currentPage: <span class="variable">$currentPage</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Current Page: <span class="subst">\(currentPage)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageView</span>(features.map &#123; <span class="type">FeatureCard</span>(landmark: <span class="variable">$0</span>) &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d5b9106f3812db2f0ec1daa8e138cccdc07062e87738cf859bc10dca88821760/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336432393630643539312f64323265646539662d316136622d346464372d623839652d3062363763393734316263332e706e67" alt=""></p>
<h2 id="步骤5-6">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-2"></a></p>
<blockquote>
<p>在<code>PageViewController.swift</code>中，将协调器设置为<code>UIPageViewControllerDelegate</code>，并添加<code>pageViewController(_:didFinishAnimating:previousViewControllers:transitionCompleted completed: Bool)</code> 方法。</p>
</blockquote>
<p>由于SwiftUI在页面切换动画完成时调用此方法，因此可以找到当前视图控制器的索引并更新绑定。</p>
<blockquote>
<p>PageViewController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageViewController</span>: <span class="title class_ inherited__">UIViewControllerRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> controllers: [<span class="type">UIViewController</span>]</span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> currentPage: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeCoordinator</span>() -&gt; <span class="type">Coordinator</span> &#123;</span><br><span class="line">        <span class="type">Coordinator</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIViewController</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageViewController</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> pageViewController <span class="operator">=</span> <span class="type">UIPageViewController</span>(</span><br><span class="line">            transitionStyle: .scroll,</span><br><span class="line">            navigationOrientation: .horizontal)</span><br><span class="line">        pageViewController.dataSource <span class="operator">=</span> context.coordinator</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageViewController</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIViewController</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        pageViewController.setViewControllers(</span><br><span class="line">            [controllers[currentPage]], direction: .forward, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Coordinator</span>: <span class="title class_ inherited__">NSObject</span>, <span class="title class_ inherited__">UIPageViewControllerDataSource</span>, <span class="title class_ inherited__">UIPageViewControllerDelegate</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> parent: <span class="type">PageViewController</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">PageViewController</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.parent <span class="operator">=</span> pageViewController</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(</span><br><span class="line">            <span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>,</span><br><span class="line">            <span class="params">viewControllerBefore</span> <span class="params">viewController</span>: <span class="type">UIViewController</span>) -&gt; <span class="type">UIViewController</span>?</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: viewController) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> index <span class="operator">==</span> <span class="number">0</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> parent.controllers.last</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> parent.controllers[index <span class="operator">-</span> <span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(</span><br><span class="line">            <span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>,</span><br><span class="line">            <span class="params">viewControllerAfter</span> <span class="params">viewController</span>: <span class="type">UIViewController</span>) -&gt; <span class="type">UIViewController</span>?</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: viewController) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> index <span class="operator">+</span> <span class="number">1</span> <span class="operator">==</span> parent.controllers.count &#123;</span><br><span class="line">                <span class="keyword">return</span> parent.controllers.first</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> parent.controllers[index <span class="operator">+</span> <span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>, <span class="params">didFinishAnimating</span> <span class="params">finished</span>: <span class="type">Bool</span>, <span class="params">previousViewControllers</span>: [<span class="type">UIViewController</span>], <span class="params">transitionCompleted</span> <span class="params">completed</span>: <span class="type">Bool</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> completed,</span><br><span class="line">                <span class="keyword">let</span> visibleViewController <span class="operator">=</span> pageViewController.viewControllers<span class="operator">?</span>.first,</span><br><span class="line">                <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: visibleViewController)</span><br><span class="line">            &#123;</span><br><span class="line">                parent.currentPage <span class="operator">=</span> index</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d5b9106f3812db2f0ec1daa8e138cccdc07062e87738cf859bc10dca88821760/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336432393630643539312f64323265646539662d316136622d346464372d623839652d3062363763393734316263332e706e67" alt=""></p>
<h2 id="步骤6-5">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46-1"></a></p>
<p>除了<code>dataSource</code>之外，还将<code>coordinator</code>指定为<code>UIPageViewController</code>的委托。</p>
<p>当在两个方向上连接绑定后，文本视图会在每次刷新后更新以显示正确的页码。</p>
<blockquote>
<p>PageViewController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageViewController</span>: <span class="title class_ inherited__">UIViewControllerRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> controllers: [<span class="type">UIViewController</span>]</span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> currentPage: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeCoordinator</span>() -&gt; <span class="type">Coordinator</span> &#123;</span><br><span class="line">        <span class="type">Coordinator</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIViewController</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageViewController</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> pageViewController <span class="operator">=</span> <span class="type">UIPageViewController</span>(</span><br><span class="line">            transitionStyle: .scroll,</span><br><span class="line">            navigationOrientation: .horizontal)</span><br><span class="line">        pageViewController.dataSource <span class="operator">=</span> context.coordinator</span><br><span class="line">        pageViewController.delegate <span class="operator">=</span> context.coordinator</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageViewController</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIViewController</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        pageViewController.setViewControllers(</span><br><span class="line">            [controllers[currentPage]], direction: .forward, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Coordinator</span>: <span class="title class_ inherited__">NSObject</span>, <span class="title class_ inherited__">UIPageViewControllerDataSource</span>, <span class="title class_ inherited__">UIPageViewControllerDelegate</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> parent: <span class="type">PageViewController</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">PageViewController</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.parent <span class="operator">=</span> pageViewController</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(</span><br><span class="line">            <span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>,</span><br><span class="line">            <span class="params">viewControllerBefore</span> <span class="params">viewController</span>: <span class="type">UIViewController</span>) -&gt; <span class="type">UIViewController</span>?</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: viewController) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> index <span class="operator">==</span> <span class="number">0</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> parent.controllers.last</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> parent.controllers[index <span class="operator">-</span> <span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(</span><br><span class="line">            <span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>,</span><br><span class="line">            <span class="params">viewControllerAfter</span> <span class="params">viewController</span>: <span class="type">UIViewController</span>) -&gt; <span class="type">UIViewController</span>?</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: viewController) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> index <span class="operator">+</span> <span class="number">1</span> <span class="operator">==</span> parent.controllers.count &#123;</span><br><span class="line">                <span class="keyword">return</span> parent.controllers.first</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> parent.controllers[index <span class="operator">+</span> <span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">pageViewController</span>(<span class="keyword">_</span> <span class="params">pageViewController</span>: <span class="type">UIPageViewController</span>, <span class="params">didFinishAnimating</span> <span class="params">finished</span>: <span class="type">Bool</span>, <span class="params">previousViewControllers</span>: [<span class="type">UIViewController</span>], <span class="params">transitionCompleted</span> <span class="params">completed</span>: <span class="type">Bool</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> completed,</span><br><span class="line">                <span class="keyword">let</span> visibleViewController <span class="operator">=</span> pageViewController.viewControllers<span class="operator">?</span>.first,</span><br><span class="line">                <span class="keyword">let</span> index <span class="operator">=</span> parent.controllers.firstIndex(of: visibleViewController)</span><br><span class="line">            &#123;</span><br><span class="line">                parent.currentPage <span class="operator">=</span> index</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d5b9106f3812db2f0ec1daa8e138cccdc07062e87738cf859bc10dca88821760/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336432393630643539312f64323265646539662d316136622d346464372d623839652d3062363763393734316263332e706e67" alt=""></p>
<h2 id="第四节-添加自定义分页控件">第四节 添加自定义分页控件</h2>
<p><a href="#%E7%AC%AC%E5%9B%9B%E8%8A%82-%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E9%A1%B5%E6%8E%A7%E4%BB%B6"></a></p>
<p>您已经准备好向视图中添加自定义<code>UIPageControl</code>，该控件包装在<code>SwiftUI</code>的<code>UIViewRepresentable</code>视图中。</p>
<p><img src="https://camo.githubusercontent.com/f33ce41b76a653d0786dee35b95351c06aee07e52f96da2ed4b11e6dd03d08de/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663632393031346637642f64613532303662612d383137642d346136362d623538622d3861363438303466383261342e706e67" alt=""></p>
<h2 id="步骤1-13">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-3"></a></p>
<p>创建一个新的SwiftUI视图文件，名为<code>PageControl.swift</code>。更新<code>PageControl</code>类型以遵守<code>UIViewRepresentable</code>协议。</p>
<p><code>UIViewRepresentable</code>和<code>UIViewControllerRepresentable</code>类型具有相同的生命周期，其方法与其基础的UIKit类型相对应。</p>
<blockquote>
<p>PageControl.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageControl</span>: <span class="title class_ inherited__">UIViewRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> numberOfPages: <span class="type">Int</span></span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> currentPage: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIView</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageControl</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> control <span class="operator">=</span> <span class="type">UIPageControl</span>()</span><br><span class="line">        control.numberOfPages <span class="operator">=</span> numberOfPages</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> control</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIView</span>(<span class="keyword">_</span> <span class="params">uiView</span>: <span class="type">UIPageControl</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        uiView.currentPage <span class="operator">=</span> currentPage</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/7464ce9d51ebc401e2d0aac2ce39d500dfb446199ff6c790fdb956a9ad014014/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f633239636166623832652f30386636656331392d393565322d346662372d623735652d6164623437306466363234392e706e67" alt=""></p>
<h2 id="步骤2-13">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-3"></a></p>
<p>将文本框替换为<code>PageControl</code>，从<code>VStack</code>切换到<code>ZStack</code>进行布局。</p>
<p>因为我们正在讲页数和绑定传递到当前页，所以<code>PageControl</code>已显示正确的值。</p>
<blockquote>
<p>PageView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView</span>&lt;<span class="type">Page</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> viewControllers: [<span class="type">UIHostingController</span>&lt;<span class="type">Page</span>&gt;]</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> currentPage <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">views</span>: [<span class="type">Page</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.viewControllers <span class="operator">=</span> views.map &#123; <span class="type">UIHostingController</span>(rootView: <span class="variable">$0</span>) &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span>(alignment: .bottomTrailing) &#123;</span><br><span class="line">            <span class="type">PageViewController</span>(controllers: viewControllers, currentPage: <span class="variable">$currentPage</span>)</span><br><span class="line">            <span class="type">PageControl</span>(numberOfPages: viewControllers.count, currentPage: <span class="variable">$currentPage</span>)</span><br><span class="line">                .padding(.trailing)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">PageView</span>(features.map &#123; <span class="type">FeatureCard</span>(landmark: <span class="variable">$0</span>) &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>下一步，让<code>PageControl</code>交互，这样用户可以点击一边或另一边时，页面可以随之滚动。</p>
</blockquote>
<h2 id="步骤3-11">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-3"></a></p>
<p>在<code>PageControl</code>中创建嵌套的<code>Coordinator</code>类型，并添加<code>makeCoordinator（）</code>方法以创建并返回新的协调器。</p>
<p>由于<code>UIPageControl</code>是<code>UIControl</code>子类，故使用<code>target-action</code>模式而不是代理，所以此<code>Coordinator</code>实现<code>@objc</code>方法来更新 <code>current page</code>的绑定。</p>
<blockquote>
<p>PageControl.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageControl</span>: <span class="title class_ inherited__">UIViewRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> numberOfPages: <span class="type">Int</span></span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> currentPage: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeCoordinator</span>() -&gt; <span class="type">Coordinator</span> &#123;</span><br><span class="line">        <span class="type">Coordinator</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIView</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageControl</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> control <span class="operator">=</span> <span class="type">UIPageControl</span>()</span><br><span class="line">        control.numberOfPages <span class="operator">=</span> numberOfPages</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> control</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIView</span>(<span class="keyword">_</span> <span class="params">uiView</span>: <span class="type">UIPageControl</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        uiView.currentPage <span class="operator">=</span> currentPage</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Coordinator</span>: <span class="title class_ inherited__">NSObject</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> control: <span class="type">PageControl</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">control</span>: <span class="type">PageControl</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.control <span class="operator">=</span> control</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">updateCurrentPage</span>(<span class="params">sender</span>: <span class="type">UIPageControl</span>) &#123;</span><br><span class="line">            control.currentPage <span class="operator">=</span> sender.currentPage</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/499680b5bed8b1d8fe20a72857fc639a7c34c58b6e206f786702564aa0eb7b69/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f623035623264353538382f33306162333238352d316336312d343961362d393133612d3537383263303033613731342e706e67" alt=""></p>
<h2 id="步骤4-10">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-3"></a></p>
<p>将<code>Coordinator</code>添加为<code>valueChanged</code>事件的目标，指定<code>updateCurrentPage（sender:）</code>方法作为要执行的操作。</p>
<blockquote>
<p>PageControl.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PageControl</span>: <span class="title class_ inherited__">UIViewRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> numberOfPages: <span class="type">Int</span></span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> currentPage: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeCoordinator</span>() -&gt; <span class="type">Coordinator</span> &#123;</span><br><span class="line">        <span class="type">Coordinator</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIView</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">UIPageControl</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> control <span class="operator">=</span> <span class="type">UIPageControl</span>()</span><br><span class="line">        control.numberOfPages <span class="operator">=</span> numberOfPages</span><br><span class="line">        control.addTarget(</span><br><span class="line">            context.coordinator,</span><br><span class="line">            action: <span class="keyword">#selector</span>(<span class="type">Coordinator</span>.updateCurrentPage(sender:)),</span><br><span class="line">            for: .valueChanged)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> control</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIView</span>(<span class="keyword">_</span> <span class="params">uiView</span>: <span class="type">UIPageControl</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        uiView.currentPage <span class="operator">=</span> currentPage</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Coordinator</span>: <span class="title class_ inherited__">NSObject</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> control: <span class="type">PageControl</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">control</span>: <span class="type">PageControl</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.control <span class="operator">=</span> control</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">updateCurrentPage</span>(<span class="params">sender</span>: <span class="type">UIPageControl</span>) &#123;</span><br><span class="line">            control.currentPage <span class="operator">=</span> sender.currentPage</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/499680b5bed8b1d8fe20a72857fc639a7c34c58b6e206f786702564aa0eb7b69/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f623035623264353538382f33306162333238352d316336312d343961362d393133612d3537383263303033613731342e706e67" alt=""></p>
<h2 id="步骤5-7">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-3"></a></p>
<p>现在尝试所有不同的交互，<code>PageView</code>展示了UIKit和SwiftUI视图以及控制器是如何协同工作的。</p>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/_p42_all_interactions.gif" alt=""></p>
<h3 id="绘图和动画-2">绘图和动画</h3>
<p><a href="#%E7%BB%98%E5%9B%BE%E5%92%8C%E5%8A%A8%E7%94%BB"></a></p>
<h2 id="视图动画和转场">视图动画和转场</h2>
<p><a href="#%E8%A7%86%E5%9B%BE%E5%8A%A8%E7%94%BB%E5%92%8C%E8%BD%AC%E5%9C%BA"></a></p>
<p>使用SwiftUI时，无论效果在哪里，都可以对视图或视图状态的更改单独设置动画。SwiftUI负责处理这些组合、重叠和可中断动画的所有复杂性。</p>
<p>在本教程中，您将设置一个视图的动画，该视图包含一个图形，用于跟踪用户在使用Landmarks应用程序时的行为数据。使用<code>animation(_:)</code>修改器，您将看到设置视图动画是多么容易。</p>
<blockquote>
<p>学习时间：25分钟</p>
<p><a target="_blank" rel="noopener" href="https://docs-assets.developer.apple.com/published/6178892d17/AnimatingViewsAndTransitions.zip">下载地址：AnimatingViewsAndTransitions.zip</a></p>
</blockquote>
<h2 id="第一节-向各个视图添加动画">第一节 向各个视图添加动画</h2>
<p><a href="#%E7%AC%AC%E4%B8%80%E8%8A%82-%E5%90%91%E5%90%84%E4%B8%AA%E8%A7%86%E5%9B%BE%E6%B7%BB%E5%8A%A0%E5%8A%A8%E7%94%BB"></a></p>
<p>在视图上使用<code>animation(_:)</code>修改器时，SwiftUI可以改变视图的任何<code>animatable(可动画)</code>属性。视图的颜色<code>color</code>、不透明度<code>opacity</code>、旋转<code>rotation</code>、大小<code>size</code>和其他属性都是可设置动画的。</p>
<p><img src="https://camo.githubusercontent.com/4d317f89cbe2df435bdf2ec9dcf6fba88a4a0e63b6a15e6b5c6aed225f19c72f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f333362343064383539382f38376536316239342d306237302d343739632d616630622d6232326636356636366430342e706e67" alt=""></p>
<h2 id="步骤1-14">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41"></a></p>
<p>在<code>HikeView.swift</code>中，打开实时预览并尝试显示和隐藏图形。</p>
<p>请确保在本教程中使用实时预览，以便您可以尝试每个步骤的结果。</p>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/_p22_explore-no-animations.gif" alt=""></p>
<h2 id="步骤2-14">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42"></a></p>
<p>通过添加<code>animation(.easeInOut())</code>为按钮启用旋转动画。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line">                        .padding()</span><br><span class="line">                        .animation(.easeInOut())</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/41d0296155e0de9ae8880dc2a8cb8726e5becbc41e1220ee5fb5c7b0573c553f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663438633038343036392f65656233336165662d326664342d343139312d383966392d3739383034316635656632302e706e67" alt=""></p>
<h2 id="步骤3-12">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43"></a></p>
<p>当图形可见时，添加一个让按钮变大的动画。</p>
<p><code>animation(_:)</code>修饰符将应用于其包装的视图中所有可动画的更改。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line">                        .scaleEffect(showDetail <span class="operator">?</span> <span class="number">1.5</span> : <span class="number">1</span>)</span><br><span class="line">                        .padding()</span><br><span class="line">                        .animation(.easeInOut())</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/41d0296155e0de9ae8880dc2a8cb8726e5becbc41e1220ee5fb5c7b0573c553f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663438633038343036392f65656233336165662d326664342d343139312d383966392d3739383034316635656632302e706e67" alt=""></p>
<h2 id="步骤4-11">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44"></a></p>
<p>将动画类型从<code>easeInOut（）</code>更改为<code>spring（）</code>。</p>
<p>SwiftUI包括预定义或自定义宽松的基本动画，以及弹簧和流体动画。可以调整动画的速度、在动画开始之前设置延迟或指定动画重复。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line">                        .scaleEffect(showDetail <span class="operator">?</span> <span class="number">1.5</span> : <span class="number">1</span>)</span><br><span class="line">                        .padding()</span><br><span class="line">                        .animation(.spring())</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/41d0296155e0de9ae8880dc2a8cb8726e5becbc41e1220ee5fb5c7b0573c553f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663438633038343036392f65656233336165662d326664342d343139312d383966392d3739383034316635656632302e706e67" alt=""></p>
<h2 id="步骤5-8">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45"></a></p>
<p>尝试通过在<code>scaleEffect</code>修改器的正上方添加另一个动画修改器来关闭旋转的动画。</p>
<p><em><strong>实验</strong></em></p>
<p>围绕SwiftUI尝试组合不同的动画效果，看看有什么不同的效果。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line">                        .animation(<span class="literal">nil</span>)</span><br><span class="line">                        .scaleEffect(showDetail <span class="operator">?</span> <span class="number">1.5</span> : <span class="number">1</span>)</span><br><span class="line">                        .padding()</span><br><span class="line">                        .animation(.spring())</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/41d0296155e0de9ae8880dc2a8cb8726e5becbc41e1220ee5fb5c7b0573c553f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663438633038343036392f65656233336165662d326664342d343139312d383966392d3739383034316635656632302e706e67" alt=""></p>
<h2 id="步骤6-6">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46"></a></p>
<p>在转到下一节之前，请删除两个动画（:）修改器。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">                        .scaleEffect(showDetail <span class="operator">?</span> <span class="number">1.5</span> : <span class="number">1</span>)</span><br><span class="line">                        .padding()</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/41d0296155e0de9ae8880dc2a8cb8726e5becbc41e1220ee5fb5c7b0573c553f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663438633038343036392f65656233336165662d326664342d343139312d383966392d3739383034316635656632302e706e67" alt=""></p>
<h2 id="第二节-使状态的改变产生动画效果">第二节 使状态的改变产生动画效果</h2>
<p><a href="#%E7%AC%AC%E4%BA%8C%E8%8A%82-%E4%BD%BF%E7%8A%B6%E6%80%81%E7%9A%84%E6%94%B9%E5%8F%98%E4%BA%A7%E7%94%9F%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C"></a></p>
<p>既然您已经学习了如何将动画应用于各个视图，现在是时候在更改状态值的位置添加动画了。</p>
<p>在这里，您将对用户点击按钮并切换<code>showDetail</code>属性时发生的所有更改添加动画。</p>
<p><img src="https://camo.githubusercontent.com/d4134b5708c1d69b362a440bbd9b9dc86f10a28b1fe4e4a582ef3a10439a584c/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336631323963663163392f37343633316630312d393438622d343030322d383034342d3165623063343531393465322e706e67" alt=""></p>
<h2 id="步骤1-15">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-1"></a></p>
<p>用<code>withAnimation</code>函数包装<code>showDetail.toggle（）</code>的调用。</p>
<p>受<code>showDetail</code>属性影响的两个视图（<code>disclosure</code>按钮和<code>HikeDetail</code>视图）现在都具有动画过渡。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    withAnimation &#123;</span><br><span class="line">                        <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line">                        .scaleEffect(showDetail <span class="operator">?</span> <span class="number">1.5</span> : <span class="number">1</span>)</span><br><span class="line">                        .padding()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/41d0296155e0de9ae8880dc2a8cb8726e5becbc41e1220ee5fb5c7b0573c553f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663438633038343036392f65656233336165662d326664342d343139312d383966392d3739383034316635656632302e706e67" alt=""></p>
<blockquote>
<p>减慢动画的速度，以查看SwiftUI动画是如何中断的。</p>
</blockquote>
<h2 id="步骤2-15">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-1"></a></p>
<p>将4秒长的基本动画传递给<code>withAnimation</code>函数。</p>
<p>可以传递相同类型的动画给给<code>animation（:）</code>修饰符的<code>withAnimation</code>函数。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    withAnimation(.easeInOut(duration: <span class="number">4</span>)) &#123;</span><br><span class="line">                        <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line">                        .scaleEffect(showDetail <span class="operator">?</span> <span class="number">1.5</span> : <span class="number">1</span>)</span><br><span class="line">                        .padding()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤3-13">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-1"></a></p>
<p>尝试在动画中打开和关闭图形视图。</p>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/_p22_slow-animation.gif" alt=""></p>
<h2 id="步骤4-12">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-1"></a></p>
<p>在继续下一节之前，请从<code>withAnimation</code>函数调用中删除慢速动画。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    withAnimation &#123;</span><br><span class="line">                        <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line">                        .scaleEffect(showDetail <span class="operator">?</span> <span class="number">1.5</span> : <span class="number">1</span>)</span><br><span class="line">                        .padding()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="第三节-自定义视图转场">第三节 自定义视图转场</h2>
<p><a href="#%E7%AC%AC%E4%B8%89%E8%8A%82-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A7%86%E5%9B%BE%E8%BD%AC%E5%9C%BA"></a></p>
<p>默认情况下，视图通过淡入淡出在屏幕内外切换。您可以使用<code>transition（:）</code>修饰符自定义此转场。</p>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/customize-view-transitions.gif" alt=""></p>
<h2 id="步骤1-16">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-2"></a></p>
<p>向条件可见的<code>HikeView</code>添加一个<code>transition(_:)</code>修饰符。</p>
<p>现在，图形通过滑动进入和退出视线而出现和消失。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    withAnimation &#123;</span><br><span class="line">                        <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line">                        .scaleEffect(showDetail <span class="operator">?</span> <span class="number">1.5</span> : <span class="number">1</span>)</span><br><span class="line">                        .padding()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">                    .transition(.slide)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/41d0296155e0de9ae8880dc2a8cb8726e5becbc41e1220ee5fb5c7b0573c553f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663438633038343036392f65656233336165662d326664342d343139312d383966392d3739383034316635656632302e706e67" alt=""></p>
<h2 id="步骤2-16">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-2"></a></p>
<p>将转场提取为<code>AnyTransition</code>的静态属性。</p>
<p>这将在展开自定义转场时保持代码的干净。对于自定义转换，您可以使用与SwiftUI相同的<code>.</code>语法。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">AnyTransition</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> moveAndFade: <span class="type">AnyTransition</span> &#123;</span><br><span class="line">        <span class="type">AnyTransition</span>.slide</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    withAnimation &#123;</span><br><span class="line">                        <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line">                        .scaleEffect(showDetail <span class="operator">?</span> <span class="number">1.5</span> : <span class="number">1</span>)</span><br><span class="line">                        .padding()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">                    .transition(.moveAndFade)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤3-14">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-2"></a></p>
<p>切换到使用<code>move(edge:)</code> 转场，以便图形从同一侧滑入和滑出。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">AnyTransition</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> moveAndFade: <span class="type">AnyTransition</span> &#123;</span><br><span class="line">        <span class="type">AnyTransition</span>.move(edge: .trailing)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    withAnimation &#123;</span><br><span class="line">                        <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line">                        .scaleEffect(showDetail <span class="operator">?</span> <span class="number">1.5</span> : <span class="number">1</span>)</span><br><span class="line">                        .padding()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">                    .transition(.moveAndFade)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤4-13">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-2"></a></p>
<p>使用<code>asymmetric(insertion:removal:)</code>（不对称）修饰符在视图出现和消失时提供不同的过渡。</p>
<blockquote>
<p>HikeView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">AnyTransition</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> moveAndFade: <span class="type">AnyTransition</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> insertion <span class="operator">=</span> <span class="type">AnyTransition</span>.move(edge: .trailing)</span><br><span class="line">            .combined(with: .opacity)</span><br><span class="line">        <span class="keyword">let</span> removal <span class="operator">=</span> <span class="type">AnyTransition</span>.scale</span><br><span class="line">            .combined(with: .opacity)</span><br><span class="line">        <span class="keyword">return</span> .asymmetric(insertion: insertion, removal: removal)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hike: <span class="type">Hike</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetail <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">HikeGraph</span>(data: hike.observations, path: \.elevation)</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                    <span class="type">Text</span>(hike.name)</span><br><span class="line">                        .font(.headline)</span><br><span class="line">                    <span class="type">Text</span>(hike.distanceText)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    withAnimation &#123;</span><br><span class="line">                        <span class="keyword">self</span>.showDetail.toggle()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;chevron.right.circle&quot;</span>)</span><br><span class="line">                        .imageScale(.large)</span><br><span class="line">                        .rotationEffect(.degrees(showDetail <span class="operator">?</span> <span class="number">90</span> : <span class="number">0</span>))</span><br><span class="line">                        .scaleEffect(showDetail <span class="operator">?</span> <span class="number">1.5</span> : <span class="number">1</span>)</span><br><span class="line">                        .padding()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> showDetail &#123;</span><br><span class="line">                <span class="type">HikeDetail</span>(hike: hike)</span><br><span class="line">                    .transition(.moveAndFade)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="第四节-为复杂效果撰写动画">第四节 为复杂效果撰写动画</h2>
<p><a href="#%E7%AC%AC%E5%9B%9B%E8%8A%82-%E4%B8%BA%E5%A4%8D%E6%9D%82%E6%95%88%E6%9E%9C%E6%92%B0%E5%86%99%E5%8A%A8%E7%94%BB"></a></p>
<p>单击栏下方的按钮时，图形将在三组不同的数据之间切换。在本节中，将使用组合动画为构成图形的胶囊提供动态、波动的转场动画。</p>
<p><img src="https://camo.githubusercontent.com/ea7f48d85067ec682b91b09b3d5670af26ad117a65f2bb78dece50eaced4ba99/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f363232323031646265302f66306462643666652d653337332d343835662d393636622d3136343161383032663338302e706e67" alt=""></p>
<h2 id="步骤1-17">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-3"></a></p>
<blockquote>
<p>将<code>showDetail</code>的默认值更改为true，并将<code>HikeView</code>预览锁定到画布。</p>
</blockquote>
<p>这使您在另一个文件中处理动画时依然可以在上下文中看到图表。</p>
<p><img src="https://camo.githubusercontent.com/cf94f22dc3bed82f642f4fd9f35f7a3ac0cd46625a55809cbe67112a51b33280/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f633363366636646338312f38333866316334392d353838392d343137622d613539302d6662613564643464323662642e706e67" alt=""></p>
<h2 id="步骤2-17">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-3"></a></p>
<p>在<code>GraphCapsule.swift</code>中，添加新的计算动画属性，并将其应用于胶囊形状。</p>
<blockquote>
<p>GraphCapsule.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">GraphCapsule</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> index: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> height: <span class="type">CGFloat</span></span><br><span class="line">    <span class="keyword">var</span> range: <span class="type">Range</span>&lt;<span class="type">Double</span>&gt;</span><br><span class="line">    <span class="keyword">var</span> overallRange: <span class="type">Range</span>&lt;<span class="type">Double</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> heightRatio: <span class="type">CGFloat</span> &#123;</span><br><span class="line">        <span class="built_in">max</span>(<span class="type">CGFloat</span>(magnitude(of: range) <span class="operator">/</span> magnitude(of: overallRange)), <span class="number">0.15</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> offsetRatio: <span class="type">CGFloat</span> &#123;</span><br><span class="line">        <span class="type">CGFloat</span>((range.lowerBound <span class="operator">-</span> overallRange.lowerBound) <span class="operator">/</span> magnitude(of: overallRange))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> animation: <span class="type">Animation</span> &#123;</span><br><span class="line">        <span class="type">Animation</span>.default</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Capsule</span>()</span><br><span class="line">            .fill(<span class="type">Color</span>.gray)</span><br><span class="line">            .frame(height: height <span class="operator">*</span> heightRatio, alignment: .bottom)</span><br><span class="line">            .offset(x: <span class="number">0</span>, y: height <span class="operator">*</span> <span class="operator">-</span>offsetRatio)</span><br><span class="line">            .animation(animation)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/5f732633cd0acac70f2f06525fd970ddd7a86d559e62e3b94aaca2d45ccf4cc6/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f386333376331393866632f30316330383331362d623439652d346132382d386431342d6533306365323763646337372e706e67" alt=""></p>
<h2 id="步骤3-15">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-3"></a></p>
<p>将动画切换为弹簧动画<code>spring</code>，减少阻尼部分<code>dampingFraction</code>以使条形可以跳跃。</p>
<blockquote>
<p>GraphCapsule.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">GraphCapsule</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> index: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> height: <span class="type">CGFloat</span></span><br><span class="line">    <span class="keyword">var</span> range: <span class="type">Range</span>&lt;<span class="type">Double</span>&gt;</span><br><span class="line">    <span class="keyword">var</span> overallRange: <span class="type">Range</span>&lt;<span class="type">Double</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> heightRatio: <span class="type">CGFloat</span> &#123;</span><br><span class="line">        <span class="built_in">max</span>(<span class="type">CGFloat</span>(magnitude(of: range) <span class="operator">/</span> magnitude(of: overallRange)), <span class="number">0.15</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> offsetRatio: <span class="type">CGFloat</span> &#123;</span><br><span class="line">        <span class="type">CGFloat</span>((range.lowerBound <span class="operator">-</span> overallRange.lowerBound) <span class="operator">/</span> magnitude(of: overallRange))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> animation: <span class="type">Animation</span> &#123;</span><br><span class="line">        <span class="type">Animation</span>.spring(dampingFraction: <span class="number">0.5</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Capsule</span>()</span><br><span class="line">            .fill(<span class="type">Color</span>.gray)</span><br><span class="line">            .frame(height: height <span class="operator">*</span> heightRatio, alignment: .bottom)</span><br><span class="line">            .offset(x: <span class="number">0</span>, y: height <span class="operator">*</span> <span class="operator">-</span>offsetRatio)</span><br><span class="line">            .animation(animation)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤4-14">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-3"></a></p>
<p>稍微加快动画的速度，以缩短每个条形移动到新位置所需的时间。</p>
<blockquote>
<p>GraphCapsule.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">GraphCapsule</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> index: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> height: <span class="type">CGFloat</span></span><br><span class="line">    <span class="keyword">var</span> range: <span class="type">Range</span>&lt;<span class="type">Double</span>&gt;</span><br><span class="line">    <span class="keyword">var</span> overallRange: <span class="type">Range</span>&lt;<span class="type">Double</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> heightRatio: <span class="type">CGFloat</span> &#123;</span><br><span class="line">        <span class="built_in">max</span>(<span class="type">CGFloat</span>(magnitude(of: range) <span class="operator">/</span> magnitude(of: overallRange)), <span class="number">0.15</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> offsetRatio: <span class="type">CGFloat</span> &#123;</span><br><span class="line">        <span class="type">CGFloat</span>((range.lowerBound <span class="operator">-</span> overallRange.lowerBound) <span class="operator">/</span> magnitude(of: overallRange))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> animation: <span class="type">Animation</span> &#123;</span><br><span class="line">        <span class="type">Animation</span>.spring(dampingFraction: <span class="number">0.5</span>)</span><br><span class="line">            .speed(<span class="number">2</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Capsule</span>()</span><br><span class="line">            .fill(<span class="type">Color</span>.gray)</span><br><span class="line">            .frame(height: height <span class="operator">*</span> heightRatio, alignment: .bottom)</span><br><span class="line">            .offset(x: <span class="number">0</span>, y: height <span class="operator">*</span> <span class="operator">-</span>offsetRatio)</span><br><span class="line">            .animation(animation)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤5-9">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-1"></a></p>
<p>根据胶囊在图形上的位置为每个动画添加延迟<code>delay</code>。</p>
<blockquote>
<p>GraphCapsule.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">GraphCapsule</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> index: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> height: <span class="type">CGFloat</span></span><br><span class="line">    <span class="keyword">var</span> range: <span class="type">Range</span>&lt;<span class="type">Double</span>&gt;</span><br><span class="line">    <span class="keyword">var</span> overallRange: <span class="type">Range</span>&lt;<span class="type">Double</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> heightRatio: <span class="type">CGFloat</span> &#123;</span><br><span class="line">        <span class="built_in">max</span>(<span class="type">CGFloat</span>(magnitude(of: range) <span class="operator">/</span> magnitude(of: overallRange)), <span class="number">0.15</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> offsetRatio: <span class="type">CGFloat</span> &#123;</span><br><span class="line">        <span class="type">CGFloat</span>((range.lowerBound <span class="operator">-</span> overallRange.lowerBound) <span class="operator">/</span> magnitude(of: overallRange))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> animation: <span class="type">Animation</span> &#123;</span><br><span class="line">        <span class="type">Animation</span>.spring(dampingFraction: <span class="number">0.5</span>)</span><br><span class="line">            .speed(<span class="number">2</span>)</span><br><span class="line">            .delay(<span class="number">0.03</span> <span class="operator">*</span> <span class="type">Double</span>(index))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Capsule</span>()</span><br><span class="line">            .fill(<span class="type">Color</span>.gray)</span><br><span class="line">            .frame(height: height <span class="operator">*</span> heightRatio, alignment: .bottom)</span><br><span class="line">            .offset(x: <span class="number">0</span>, y: height <span class="operator">*</span> <span class="operator">-</span>offsetRatio)</span><br><span class="line">            .animation(animation)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤6-7">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46-1"></a></p>
<p>观察自定义动画在图形之间转换时如何提供波动效果。</p>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/_p22_explore-with-animations.gif" alt=""></p>
<h2 id="构建列表和导航">构建列表和导航</h2>
<p><a href="#%E6%9E%84%E5%BB%BA%E5%88%97%E8%A1%A8%E5%92%8C%E5%AF%BC%E8%88%AA"></a></p>
<p>设置了基本地标详情视图后，需要为用户提供查看地标所有列表和查看每个地标详情的方法。</p>
<p>您将创建显示所有地标信息的视图，并动态生成一个滚动列表，用户可以点击该列表查看地标的详情视图。要微调UI，您将使用Xcode的画布以不同的设备大小呈现多个预览。</p>
<p>下载项目文件以开始构建此项目，并执行以下步骤。</p>
<blockquote>
<p>学习时间：35分钟</p>
<p><a target="_blank" rel="noopener" href="https://docs-assets.developer.apple.com/published/58bd04ddca/BuildingListsAndNavigation.zip">下载示例：BuildingListsAndNavigation.zip</a></p>
</blockquote>
<h2 id="第一节-了解示例数据。">第一节 了解示例数据。</h2>
<p><a href="#%E7%AC%AC%E4%B8%80%E8%8A%82-%E4%BA%86%E8%A7%A3%E7%A4%BA%E4%BE%8B%E6%95%B0%E6%8D%AE"></a></p>
<p>在第一个教程中，我们将数据硬编码到所有自定义视图中。在这里，您将学习如何将数据传递到自定义视图中以动态显示。</p>
<p>首先<a target="_blank" rel="noopener" href="https://docs-assets.developer.apple.com/published/58bd04ddca/BuildingListsAndNavigation.zip">下载示例项目</a>并熟悉示例数据。</p>
<p><img src="https://camo.githubusercontent.com/2dcdb436a4520060ac81a44c83c6e8d44acce0dc66b5516e771f5edc8f1eb0c9/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f346434613235636432632f32663866396431352d333438652d346337662d623533642d6265333161356438633435372e706e67" alt=""></p>
<h2 id="步骤1-18">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41"></a></p>
<p>在项目导航器中，选择<code>Models&gt;Landmark.swift</code>。</p>
<p><code>Landmark.swift</code>声明了一个Landmark结构，该结构存储应用程序需要显示的所有<code>Landmark</code>信息，并从<code>landmarkData.json</code>导入一组<code>Landmark</code>数据。</p>
<blockquote>
<p>Landmark.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> CoreLocation</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Landmark</span>: <span class="title class_ inherited__">Hashable</span>, <span class="title class_ inherited__">Codable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> id: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">var</span> imageName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">var</span> coordinates: <span class="type">Coordinates</span></span><br><span class="line">    <span class="keyword">var</span> state: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> park: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> category: <span class="type">Category</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> locationCoordinate: <span class="type">CLLocationCoordinate2D</span> &#123;</span><br><span class="line">        <span class="type">CLLocationCoordinate2D</span>(</span><br><span class="line">            latitude: coordinates.latitude,</span><br><span class="line">            longitude: coordinates.longitude)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">Category</span>: <span class="title class_ inherited__">String</span>, <span class="title class_ inherited__">CaseIterable</span>, <span class="title class_ inherited__">Codable</span>, <span class="title class_ inherited__">Hashable</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> featured <span class="operator">=</span> <span class="string">&quot;Featured&quot;</span></span><br><span class="line">        <span class="keyword">case</span> lakes <span class="operator">=</span> <span class="string">&quot;Lakes&quot;</span></span><br><span class="line">        <span class="keyword">case</span> rivers <span class="operator">=</span> <span class="string">&quot;Rivers&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Landmark</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> image: <span class="type">Image</span> &#123;</span><br><span class="line">        <span class="type">ImageStore</span>.shared.image(name: imageName)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Coordinates</span>: <span class="title class_ inherited__">Hashable</span>, <span class="title class_ inherited__">Codable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> latitude: <span class="type">Double</span></span><br><span class="line">    <span class="keyword">var</span> longitude: <span class="type">Double</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤2-18">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42"></a></p>
<p>在项目导航器中，选择<code>Resources&gt;landmarkData.json</code>。</p>
<p>您将在本教程的其余部分以及随后的所有内容中使用此示例数据。</p>
<blockquote>
<p>landmarkData.json</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;name&quot;: &quot;Turtle Rock&quot;,</span><br><span class="line">        &quot;category&quot;: &quot;Featured&quot;,</span><br><span class="line">        &quot;city&quot;: &quot;Twentynine Palms&quot;,</span><br><span class="line">        &quot;state&quot;: &quot;California&quot;,</span><br><span class="line">        &quot;id&quot;: 1001,</span><br><span class="line">        &quot;park&quot;: &quot;Joshua Tree National Park&quot;,</span><br><span class="line">        &quot;coordinates&quot;: &#123;</span><br><span class="line">            &quot;longitude&quot;: -116.166868,</span><br><span class="line">            &quot;latitude&quot;: 34.011286</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;imageName&quot;: &quot;turtlerock&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;name&quot;: &quot;Silver Salmon Creek&quot;,</span><br><span class="line">        &quot;category&quot;: &quot;Lakes&quot;,</span><br><span class="line">        &quot;city&quot;: &quot;Port Alsworth&quot;,</span><br><span class="line">        &quot;state&quot;: &quot;Alaska&quot;,</span><br><span class="line">        &quot;id&quot;: 1002,</span><br><span class="line">        &quot;park&quot;: &quot;Lake Clark National Park and Preserve&quot;,</span><br><span class="line">        &quot;coordinates&quot;: &#123;</span><br><span class="line">            &quot;longitude&quot;: -152.665167,</span><br><span class="line">            &quot;latitude&quot;: 59.980167</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;imageName&quot;: &quot;silversalmoncreek&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="步骤3-16">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43"></a></p>
<p>请注意，我们将<code>ContentView</code>类型重命名为<code>LandmarkDetail</code>。</p>
<p>在本教程和以下每个教程中，您将创建多个视图类型。</p>
<blockquote>
<p>LandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>()</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>()</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                    .font(.title)</span><br><span class="line"></span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/f348f6b5192adb6ce6417793d8aef7e43df24a97d6076575985141f77a9c2a87/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336231356434363864362f36363530306134662d303137392d343465362d616362302d6166393436383964396538652e706e67" alt=""></p>
<h2 id="第二节-创建行视图">第二节 创建行视图</h2>
<p><a href="#%E7%AC%AC%E4%BA%8C%E8%8A%82-%E5%88%9B%E5%BB%BA%E8%A1%8C%E8%A7%86%E5%9B%BE"></a></p>
<p>本节中构建的第一个视图是行视图，用于显示每个地标的详细信息。此行视图声明了一个属性即<code>landmark</code> ，其用于存储地标信息，以便行视图可以显示任何地标。稍后，您将把多个行视图合并成一个地标列表。</p>
<p><img src="https://camo.githubusercontent.com/7679f99fa7181e7bc78ece11727a61aa021c976167815cd1981ac6c382dd7c29/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f383535333364323765662f36663163336461352d333463372d346332372d626137372d3237306564326132393237322e706e67" alt=""></p>
<h2 id="步骤1-19">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-1"></a></p>
<p>创建一个新的SwiftUI视图，名为<code>LandmarkRow.swift</code>。</p>
<p><img src="https://camo.githubusercontent.com/ca612cb88a14a6cacd37822f86c9991f6f8364a9f53adc28f58e51f64d1d3261/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f396164323335316237612f30613663303233322d366436312d346538622d396530342d3237636664613437626632622e706e67" alt=""></p>
<h2 id="步骤2-19">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-1"></a></p>
<p>如果预览尚未显示，请通过选择<code>Editor &gt; Editor and Canvas</code>，来显示画布，然后单击“Resume”。</p>
<p><img src="https://camo.githubusercontent.com/540b4fa379403fc023c2e017e28eb71ad65fc6f5927a79fa852d90f86c982ec2/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f633761653862303631372f61633939663031352d333362302d346438332d626361322d6162383433383936623932662e706e67" alt=""></p>
<h2 id="步骤3-17">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-1"></a></p>
<p>添加<code>landmark</code>作为<code>LandmarkRow</code>的存储属性。</p>
<p>添加<code>landmark</code>属性时，预览将停止工作，因为<code>LandmarkRow</code>类型在初始化期间需要<code>landmark</code>实例。</p>
<blockquote>
<p>LandmarkRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkRow</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>想要修复预览，需要修改<code>PreviewProvider</code>。</p>
</blockquote>
<h2 id="步骤4-15">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44"></a></p>
<p>在<code>LandmarkRow_Previews</code>的<code>static previews</code>属性中，将<code>landmarkData</code>数组的第一个元素作为<code>LandmarkRow</code>参数添加到LandmarkRow初始值设定项中。</p>
<p>预览可以正常显示文本<code>Hello World</code>了。</p>
<blockquote>
<p>LandmarkRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/70344d7590245f3d18b90a323ac31f2a9eccd6355c8b3f59b2bf820c49c52fb8/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f316534326233323233612f32393262373461362d303137342d343737332d623834622d6238613637643566393164332e706e67" alt=""></p>
<blockquote>
<p>修复后，可以为行视图生成布局。</p>
</blockquote>
<h2 id="步骤5-10">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45"></a></p>
<p>将文本视图嵌入到<code>HStack</code>中。</p>
<blockquote>
<p>LandmarkRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/70344d7590245f3d18b90a323ac31f2a9eccd6355c8b3f59b2bf820c49c52fb8/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f316534326233323233612f32393262373461362d303137342d343737332d623834622d6238613637643566393164332e706e67" alt=""></p>
<h2 id="步骤6-8">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46"></a></p>
<p>修改文本视图以使用<code>landmark</code>的<code>name</code>属性。</p>
<blockquote>
<p>LandmarkRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(landmark.name)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/c34b69d9aa9b63d524698127d75b4399f497870d49fa6e7d40b840009b6a8890/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393834666538346334362f31616630626131302d333964362d343531332d396430382d3362616332336261636664642e706e67" alt=""></p>
<h2 id="步骤7-2">步骤7</h2>
<p><a href="#%E6%AD%A5%E9%AA%A47"></a></p>
<p>在<code>Text</code>视图之前添加<code>Image</code>视图来完成行视图。</p>
<blockquote>
<p>LandmarkRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            landmark.image</span><br><span class="line">                .resizable()</span><br><span class="line">                .frame(width: <span class="number">50</span>, height: <span class="number">50</span>)</span><br><span class="line">            <span class="type">Text</span>(landmark.name)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/63dc967eb42e2bbc2e59f3b80dd2c047a3545c50946490624d6ea0d6e5878a3e/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f626635333364626138632f65396230646461362d643166332d343438632d626435342d3266316466313966336639302e706e67" alt=""></p>
<h2 id="第三节-自定义行预览">第三节 自定义行预览</h2>
<p><a href="#%E7%AC%AC%E4%B8%89%E8%8A%82-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A1%8C%E9%A2%84%E8%A7%88"></a></p>
<p>Xcode的画布自动识别并显示当前编辑器中遵守<code>PreviewProvider</code>协议的任何类型。<code>PreviewProvider</code>返回一个或多个视图，并提供配置大小和设备的选项。</p>
<p>您可以自定义<code>PreviewProvider</code>返回的内容，以准确呈现对您最有帮助的预览。</p>
<p><img src="https://camo.githubusercontent.com/a6729288ec6370153c0302bfe5e85a501d9aa6759ded8aabbdaf3c07d1913e48/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f383936633830353734642f64653433303166612d626639632d343561632d623766322d6262623939306363623431622e706e67" alt=""></p>
<h2 id="步骤1-20">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-2"></a></p>
<p>在<code>LandmarkRow_Previews</code>中，将<code>landmark</code>参数更新为<code>landmarkData</code>数组中的第二个元素。</p>
<p>预览立即显示第二个示例地标，而不是第一个。</p>
<blockquote>
<p>LandmarkRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            landmark.image</span><br><span class="line">                .resizable()</span><br><span class="line">                .frame(width: <span class="number">50</span>, height: <span class="number">50</span>)</span><br><span class="line">            <span class="type">Text</span>(landmark.name)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">1</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/63dc967eb42e2bbc2e59f3b80dd2c047a3545c50946490624d6ea0d6e5878a3e/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f626635333364626138632f65396230646461362d643166332d343438632d626435342d3266316466313966336639302e706e67" alt=""></p>
<h2 id="步骤2-20">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-2"></a></p>
<p>使用<code>previewLayout(_:)</code> 设置一个与列表中的行近似的大小。</p>
<blockquote>
<p>LandmarkRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            landmark.image</span><br><span class="line">                .resizable()</span><br><span class="line">                .frame(width: <span class="number">50</span>, height: <span class="number">50</span>)</span><br><span class="line">            <span class="type">Text</span>(landmark.name)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">1</span>])</span><br><span class="line">            .previewLayout(.fixed(width: <span class="number">300</span>, height: <span class="number">70</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/6e9c3e19452d904a8edc75c3e99d0ebe5ffa01f16ce326db9f4b15d1b52971a5/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f623763346465376430652f64336364643533612d633363352d343135342d383466632d6362623661333133376165662e706e67" alt=""></p>
<blockquote>
<p>可以使用<code>Group</code>从<code>PreviewProvider</code>返回多个视图预览。</p>
</blockquote>
<h2 id="步骤3-18">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-2"></a></p>
<p>将返回的行包装在一个<code>Group</code>中，然后再次添加第一行。</p>
<p><code>Group</code>是用于对视图内容进行分组的容器。Xcode将组的子视图呈现为画布中的单独预览。</p>
<blockquote>
<p>LandmarkRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            landmark.image</span><br><span class="line">                .resizable()</span><br><span class="line">                .frame(width: <span class="number">50</span>, height: <span class="number">50</span>)</span><br><span class="line">            <span class="type">Text</span>(landmark.name)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">                .previewLayout(.fixed(width: <span class="number">300</span>, height: <span class="number">70</span>))</span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">1</span>])</span><br><span class="line">                .previewLayout(.fixed(width: <span class="number">300</span>, height: <span class="number">70</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/16e33f82002d7bbd654acf8ec4df30f4de33c7ff23681c31c5d5ee888b88da91/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f373566396433663964302f63393062303738382d323265322d346132352d396137662d3464616163636439653762342e706e67" alt=""></p>
<h2 id="步骤4-16">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-1"></a></p>
<p>要简化代码，请将<code>previewLayout（:）</code>调用移到<code>Group</code>的外部。</p>
<p>视图的子级视图继承视图的上下文设置，如预览配置。</p>
<blockquote>
<p>LandmarkRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            landmark.image</span><br><span class="line">                .resizable()</span><br><span class="line">                .frame(width: <span class="number">50</span>, height: <span class="number">50</span>)</span><br><span class="line">            <span class="type">Text</span>(landmark.name)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">1</span>])</span><br><span class="line">        &#125;</span><br><span class="line">        .previewLayout(.fixed(width: <span class="number">300</span>, height: <span class="number">70</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/16e33f82002d7bbd654acf8ec4df30f4de33c7ff23681c31c5d5ee888b88da91/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f373566396433663964302f63393062303738382d323265322d346132352d396137662d3464616163636439653762342e706e67" alt=""></p>
<blockquote>
<p>Tips：在<code>PreviewProvider</code>中编写的代码只会改变Xcode在画布中显示的内容。</p>
</blockquote>
<h2 id="第四节-创建地标列表">第四节 创建地标列表</h2>
<p><a href="#%E7%AC%AC%E5%9B%9B%E8%8A%82-%E5%88%9B%E5%BB%BA%E5%9C%B0%E6%A0%87%E5%88%97%E8%A1%A8"></a></p>
<p>使用SwiftUI的<code>List</code>类型时，可以显示特定于平台的视图列表。列表的元素可以是静态的，比如您目前创建的堆栈的子视图，也可以是动态生成的。您甚至可以混合静态和动态生成的视图。</p>
<p><img src="https://camo.githubusercontent.com/0dd540c130b7003f3d576baef92b8e585ce0a6dccb8130811c9fdd4da9ab1aaa/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f343431363661633763332f63393162363534362d313233302d343361322d383836372d3266306534343565646239392e706e67" alt=""></p>
<h2 id="步骤1-21">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-3"></a></p>
<p>创建一个新的<code>SwiftUI View</code>，名为<code>LandmarkList.swift</code>。</p>
<p><img src="https://camo.githubusercontent.com/9c7de4a1867143114d4a20a6885fde579d81297c027c98d2fc8f514fc1a2aaa6/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393931633532646234652f61666236646335392d636462382d346236342d396263652d3330663837636262656563342e706e67" alt=""></p>
<h2 id="步骤2-21">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-3"></a></p>
<p>将默认<code>Text</code>视图替换为<code>List</code>，并提供前两个<code>Landmark</code>作为列表子级的<code>LandmarkRow</code>实例。</p>
<p>预览显示了两个地标，它们以适合iOS的列表样式呈现。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">1</span>])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/46f318e8c55d715da76ebbc3daddc7294601ab2ecb0c5a626044afb4f83ec4e1/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f303135643038393365302f63373333313836382d646235322d346664612d613635622d3131376333326538343864392e706e67" alt=""></p>
<h2 id="第五节-动态化列表">第五节 动态化列表</h2>
<p><a href="#%E7%AC%AC%E4%BA%94%E8%8A%82-%E5%8A%A8%E6%80%81%E5%8C%96%E5%88%97%E8%A1%A8"></a></p>
<p>您可以直接从集合中生成行，而不是单独的指定列表中的元素。</p>
<p>通过传递数据集合并为集合中的每个元素提供视图的闭包，可以创建显示集合元素的列表。列表使用提供的闭包将集合中的每个元素转换为子视图。</p>
<p><img src="https://camo.githubusercontent.com/e6aaef5ffb941d324829926768025373fa43369737579d6dbd0a6bafac1362d0/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f363862636164373735392f33663266383037312d393765312d343831652d393261322d6566623138626530316563372e706e67" alt=""></p>
<h2 id="步骤1-22">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-4"></a></p>
<p>删除两个静态<code>LandmarkRow</code>，并将<code>landmarkData</code> 传递给<code>Lisst</code>初始值设定项。</p>
<p><code>List</code>使用<code>identifiable</code>数据。您可以通过以下两种方式之一生产<code>identifiable</code>数据：1、使用<code>key path</code>属性标识每个元素；2、使数据遵守<code>Identifiable</code>协议。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span>(landmarkData, id: \.id) &#123; landmark <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤2-22">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-4"></a></p>
<p>通过从闭包返回<code>LandmarkRow</code>来动态生成列表。</p>
<p>这将为<code>landmarkData</code>数组中的每个元素创建一个<code>LandmarkRow</code>。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span>(landmarkData, id: \.id) &#123; landmark <span class="keyword">in</span></span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/9a26e88d14bcac52fe6b908b862daf000771cb6e9beede294236167f9d9779eb/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f643437646332623739352f61653339343032322d633731302d346338362d393232362d3765306361323235633238372e706e67" alt=""></p>
<blockquote>
<p>接下来，您将通过使<code>Landmark</code>遵守<code>Identifiable</code>来简化代码。</p>
</blockquote>
<h2 id="步骤3-19">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-3"></a></p>
<p>切换到<code>Landmark.swift</code>并声明<code>Identifiable</code>协议。</p>
<p>由于<code>Landmark</code>类型已经具有<code>Identifiable</code>所需的id属性，因此没有其他工作要做。</p>
<blockquote>
<p>Landmark.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> CoreLocation</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Landmark</span>: <span class="title class_ inherited__">Hashable</span>, <span class="title class_ inherited__">Codable</span>, <span class="title class_ inherited__">Identifiable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> id: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">var</span> imageName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">var</span> coordinates: <span class="type">Coordinates</span></span><br><span class="line">    <span class="keyword">var</span> state: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> park: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> category: <span class="type">Category</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> locationCoordinate: <span class="type">CLLocationCoordinate2D</span> &#123;</span><br><span class="line">        <span class="type">CLLocationCoordinate2D</span>(</span><br><span class="line">            latitude: coordinates.latitude,</span><br><span class="line">            longitude: coordinates.longitude)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">Category</span>: <span class="title class_ inherited__">String</span>, <span class="title class_ inherited__">CaseIterable</span>, <span class="title class_ inherited__">Codable</span>, <span class="title class_ inherited__">Hashable</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> featured <span class="operator">=</span> <span class="string">&quot;Featured&quot;</span></span><br><span class="line">        <span class="keyword">case</span> lakes <span class="operator">=</span> <span class="string">&quot;Lakes&quot;</span></span><br><span class="line">        <span class="keyword">case</span> rivers <span class="operator">=</span> <span class="string">&quot;Rivers&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Landmark</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> image: <span class="type">Image</span> &#123;</span><br><span class="line">        <span class="type">ImageStore</span>.shared.image(name: imageName)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Coordinates</span>: <span class="title class_ inherited__">Hashable</span>, <span class="title class_ inherited__">Codable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> latitude: <span class="type">Double</span></span><br><span class="line">    <span class="keyword">var</span> longitude: <span class="type">Double</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/9a26e88d14bcac52fe6b908b862daf000771cb6e9beede294236167f9d9779eb/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f643437646332623739352f61653339343032322d633731302d346338362d393232362d3765306361323235633238372e706e67" alt=""></p>
<h2 id="步骤4-17">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-2"></a></p>
<p>切换回<code>LandmarkList.swift</code>并删除id参数。</p>
<p>从现在起，您将能够直接使用<code>Landmark</code>的集合。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/9a26e88d14bcac52fe6b908b862daf000771cb6e9beede294236167f9d9779eb/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f643437646332623739352f61653339343032322d633731302d346338362d393232362d3765306361323235633238372e706e67" alt=""></p>
<h2 id="第六节-在列表和详情之间设置导航">第六节 在列表和详情之间设置导航</h2>
<p><a href="#%E7%AC%AC%E5%85%AD%E8%8A%82-%E5%9C%A8%E5%88%97%E8%A1%A8%E5%92%8C%E8%AF%A6%E6%83%85%E4%B9%8B%E9%97%B4%E8%AE%BE%E7%BD%AE%E5%AF%BC%E8%88%AA"></a></p>
<p>列表呈现正确，但您还不能轻触每个<code>LandmarkRow</code>来查看该地标的详情页面。</p>
<p>通过把<code>List</code>嵌入到<code>NavigationView</code>中使其具有导航功能，然后在<code>NavigationLink</code>中嵌入每一行<code>LandmarkRow</code>，并设置要跳转的目标视图。</p>
<p><img src="https://camo.githubusercontent.com/40ec756f989e837d2bbc7215fa39be8b457a86f9da26b8895897c63b536c0153/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f343866653961623061332f63366632316466392d316436642d343264342d623231622d3061323538386634636439372e706e67" alt=""></p>
<h2 id="步骤1-23">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-5"></a></p>
<p>在<code>NavigationView</code>中嵌入动态生成的<code>LandmarkList</code>。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/10c5e824736a30cb2416082248046234500d1766f24939144b8492f62cc88ddf/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f303738613132653533362f66636231336362362d613865332d346339352d613266642d6138343439396131666132622e706e67" alt=""></p>
<h2 id="步骤2-23">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-5"></a></p>
<p>在显示列表时，调用<code>navigationBarTitle（:）</code>修饰符方法设置导航栏的标题。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/2e223378a25970e2f510031191eca5c174091923bd9eb329f844898fbb28b114/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f356238616236386239392f36386333343630362d306434312d343361392d623233612d6262666665393131373764382e706e67" alt=""></p>
<h2 id="步骤3-20">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-4"></a></p>
<p>在<code>List</code>的闭包中，将返回的<code>Row</code>包装在<code>NavigationLink</code> 中，指定<code>LandmarkDetail</code>视图作为跳转目标。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>()) &#123;</span><br><span class="line">                    <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/4f1f502fd64b5098da356d410e304df576a21e7491864733eecb0ebc989d4bf6/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f636336613763613332362f38383336633637612d646230332d343064362d613834612d3364333830393934306638312e706e67" alt=""></p>
<h2 id="步骤4-18">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-3"></a></p>
<p>通过切换到实时预览模式，您可以在预览中直接尝试导航功能。单击<code>Live Preview</code>按钮并点击地标行访问详情页。</p>
<p><img src="https://camo.githubusercontent.com/87d58aa06de09967e4d72ca003b8368afeebe31cfb7bb802aba7359cbbbae098/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f356533393736373734642f64393065313465662d666366652d346566342d396266382d6430353062633961343261342e706e67" alt=""></p>
<h2 id="第7节-将数据传递到子视图">第7节 将数据传递到子视图</h2>
<p><a href="#%E7%AC%AC7%E8%8A%82-%E5%B0%86%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%92%E5%88%B0%E5%AD%90%E8%A7%86%E5%9B%BE"></a></p>
<p><code>LandmarkDetail</code>视图仍然使用硬编码方式来显示地标。与<code>LandmarkRow</code>一样，<code>LandmarkDetail</code>类型及其包含的视图需要使用<code>landmark</code>属性作为其数据源。</p>
<p>从子视图开始，您将转换<code>CircleImage</code>、<code>MapView</code>和<code>LandmarkDetail</code>以显示传入的数据，而不是对每行进行硬编码。</p>
<p><img src="https://camo.githubusercontent.com/d385ac27178d00ad935d9201c395114d5a6a577609f9b3720c3c4f3e2a3ba40f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f633333383030313062662f63623439373332662d636233652d346537372d613265362d3834663766373631383530322e706e67" alt=""></p>
<h2 id="步骤1-24">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-6"></a></p>
<p>在<code>CircleImage.swift</code>中，将存储属性<code>image</code>添加到<code>CircleImage</code>。</p>
<p>这是使用SwiftUI构建视图时的常见模式。您的自定义视图通常会包装一系列修饰符。</p>
<blockquote>
<p>CircleImage.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> image: <span class="type">Image</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        image</span><br><span class="line">            .clipShape(<span class="type">Circle</span>())</span><br><span class="line">            .overlay(<span class="type">Circle</span>().stroke(<span class="type">Color</span>.white, lineWidth: <span class="number">4</span>))</span><br><span class="line">            .shadow(radius: <span class="number">10</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CircleImage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤2-24">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-6"></a></p>
<p>更新<code>CircleImage_Preview</code> 以传递名为<code>Turtle Rock</code>的<code>Image</code>。</p>
<blockquote>
<p>CircleImage.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> image: <span class="type">Image</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        image</span><br><span class="line">            .clipShape(<span class="type">Circle</span>())</span><br><span class="line">            .overlay(<span class="type">Circle</span>().stroke(<span class="type">Color</span>.white, lineWidth: <span class="number">4</span>))</span><br><span class="line">            .shadow(radius: <span class="number">10</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleImage_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CircleImage</span>(image: <span class="type">Image</span>(<span class="string">&quot;turtlerock&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>步骤3</p>
<p>在<code>MapView.swift</code>中，向<code>MapView</code>添加一个<code>coordinate</code>属性，并将代码转换为使用该属性，而不是硬编码纬度和经度。</p>
<blockquote>
<p>MapView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> MapKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MapView</span>: <span class="title class_ inherited__">UIViewRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> coordinate: <span class="type">CLLocationCoordinate2D</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIView</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">MKMapView</span> &#123;</span><br><span class="line">        <span class="type">MKMapView</span>(frame: .zero)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIView</span>(<span class="keyword">_</span> <span class="params">view</span>: <span class="type">MKMapView</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> span <span class="operator">=</span> <span class="type">MKCoordinateSpan</span>(latitudeDelta: <span class="number">0.02</span>, longitudeDelta: <span class="number">0.02</span>)</span><br><span class="line">        <span class="keyword">let</span> region <span class="operator">=</span> <span class="type">MKCoordinateRegion</span>(center: coordinate, span: span)</span><br><span class="line">        view.setRegion(region, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MapView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">MapView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤4-19">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-4"></a></p>
<p>更新<code>MapView_Preview</code>以传递数据数组中第一个地标元素的坐标。</p>
<blockquote>
<p>MapView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> MapKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MapView</span>: <span class="title class_ inherited__">UIViewRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> coordinate: <span class="type">CLLocationCoordinate2D</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIView</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">MKMapView</span> &#123;</span><br><span class="line">        <span class="type">MKMapView</span>(frame: .zero)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIView</span>(<span class="keyword">_</span> <span class="params">view</span>: <span class="type">MKMapView</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> span <span class="operator">=</span> <span class="type">MKCoordinateSpan</span>(latitudeDelta: <span class="number">0.02</span>, longitudeDelta: <span class="number">0.02</span>)</span><br><span class="line">        <span class="keyword">let</span> region <span class="operator">=</span> <span class="type">MKCoordinateRegion</span>(center: coordinate, span: span)</span><br><span class="line">        view.setRegion(region, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MapView_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">MapView</span>(coordinate: landmarkData[<span class="number">0</span>].locationCoordinate)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤5-11">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-1"></a></p>
<p>在<code>LandmarkDetail.swift</code>中，将<code>Landmark</code>属性添加到<code>LandmarkDetail</code>类中。</p>
<blockquote>
<p>LandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>()</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>()</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                    .font(.title)</span><br><span class="line"></span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkDetail</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>步骤6</p>
<p>更新<code>LandmarkDetail_Preview</code>以使用<code>landmarkData</code>数组中的第一个地标元素。</p>
<blockquote>
<p>LandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>()</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>()</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                    .font(.title)</span><br><span class="line"></span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkDetail</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤7-3">步骤7</h2>
<p><a href="#%E6%AD%A5%E9%AA%A47-1"></a></p>
<p>将所需的数据下传给自定义类型。</p>
<blockquote>
<p>LandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>(coordinate: landmark.locationCoordinate)</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>(image: landmark.image)</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(landmark.name)</span><br><span class="line">                    .font(.title)</span><br><span class="line"></span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(landmark.park)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(landmark.state)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkDetail</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤8-2">步骤8</h2>
<p><a href="#%E6%AD%A5%E9%AA%A48"></a></p>
<p>最后，调用<code>navigationBarTitle(_:displayMode:)</code>修饰符，在显示详情视图时为导航栏提供标题。</p>
<blockquote>
<p>LandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>(coordinate: landmark.locationCoordinate)</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>(image: landmark.image)</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(landmark.name)</span><br><span class="line">                    .font(.title)</span><br><span class="line"></span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(landmark.park)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(landmark.state)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="type">Text</span>(landmark.name), displayMode: .inline)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkDetail</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤9-2">步骤9</h2>
<p><a href="#%E6%AD%A5%E9%AA%A49"></a></p>
<p>在<code>SceneDelegate.swift</code>中，将应用程序的根视图切换为<code>LandmarkList</code>。</p>
<p>当在模拟器中独立运行(不是预览模式)时，您的应用程序将从<code>SceneDelegate</code>中定义的根视图开始。</p>
<blockquote>
<p>SceneDelegate.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SceneDelegate</span>: <span class="title class_ inherited__">UIResponder</span>, <span class="title class_ inherited__">UIWindowSceneDelegate</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> window: <span class="type">UIWindow</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">scene</span>(<span class="keyword">_</span> <span class="params">scene</span>: <span class="type">UIScene</span>, <span class="params">willConnectTo</span> <span class="params">session</span>: <span class="type">UISceneSession</span>, <span class="params">options</span> <span class="params">connectionOptions</span>: <span class="type">UIScene</span>.<span class="type">ConnectionOptions</span>) &#123;</span><br><span class="line">        <span class="comment">// Use this method to optionally configure and attach the UIWindow `window` to the provided UIWindowScene `scene`.</span></span><br><span class="line">        <span class="comment">// If using a storyboard, the `window` property will automatically be initialized and attached to the scene.</span></span><br><span class="line">        <span class="comment">// This delegate does not imply the connecting scene or session are new (see `application:configurationForConnectingSceneSession` instead).</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Use a UIHostingController as window root view controller</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> windowScene <span class="operator">=</span> scene <span class="keyword">as?</span> <span class="type">UIWindowScene</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> window <span class="operator">=</span> <span class="type">UIWindow</span>(windowScene: windowScene)</span><br><span class="line">            window.rootViewController <span class="operator">=</span> <span class="type">UIHostingController</span>(rootView: <span class="type">LandmarkList</span>())</span><br><span class="line">            <span class="keyword">self</span>.window <span class="operator">=</span> window</span><br><span class="line">            window.makeKeyAndVisible()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/942e2a6d97e59f6a46f5bf7872fe5724b6bd3ab79c6d8de821609fb1423b17fe/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f326662653635353663342f62666331343637622d653761392d346136312d383035312d3530623935353039633361622e706e67" alt=""></p>
<h2 id="步骤10">步骤10</h2>
<p><a href="#%E6%AD%A5%E9%AA%A410"></a></p>
<p>在<code>LandmarkList.swift</code>中，将当前<code>Landmark</code>传递到目标详情页。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                    <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/942e2a6d97e59f6a46f5bf7872fe5724b6bd3ab79c6d8de821609fb1423b17fe/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f326662653635353663342f62666331343637622d653761392d346136312d383035312d3530623935353039633361622e706e67" alt=""></p>
<h2 id="步骤11">步骤11</h2>
<p><a href="#%E6%AD%A5%E9%AA%A411"></a></p>
<p>切换到实时预览以查看从列表导航到详情视图时，是否显示正确的地标。</p>
<p><img src="https://camo.githubusercontent.com/87d58aa06de09967e4d72ca003b8368afeebe31cfb7bb802aba7359cbbbae098/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f356533393736373734642f64393065313465662d666366652d346566342d396266382d6430353062633961343261342e706e67" alt=""></p>
<h2 id="第8节-动态生成预览">第8节 动态生成预览</h2>
<p><a href="#%E7%AC%AC8%E8%8A%82-%E5%8A%A8%E6%80%81%E7%94%9F%E6%88%90%E9%A2%84%E8%A7%88"></a></p>
<p>接下来，将向<code>LandmarkList_Previews</code>添加代码，以呈现不同设备大小的列表视图预览。默认情况下，预览以激活状态设备的大小呈现。可以通过调用<code>previewDevice（:）</code>修饰符方法来更改预览设备。</p>
<p><img src="https://camo.githubusercontent.com/603502b096d1dbf3d709b47fe0f9d131ecbc1a96e086420d2d25f63e44d55b9e/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f626639376636663634642f34373565346163332d623630352d343330392d613239342d6539643265666136663161622e706e67" alt=""></p>
<h2 id="步骤1-25">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-7"></a></p>
<p>首先，将当前列表预览更改为<code>iPhone SE</code>大小的渲染器。</p>
<p>您可以提供<code>Xcode</code>的<code>scheme</code>菜单中显示的任何设备的名称。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                    <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">            .previewDevice(<span class="type">PreviewDevice</span>(rawValue: <span class="string">&quot;iPhone SE&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/2203984b932e49e6398b65e894436f578a66b000318f3603b910210a0ec188da/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f666166613963356530652f38396335393062612d613265302d343662632d626163612d3238643039303631373832652e706e67" alt=""></p>
<h2 id="步骤2-25">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-7"></a></p>
<p>在<code>LandmarkList_Previews</code>中，使用设备名称数组作为数据，将<code>LandmarkList</code>嵌入<code>ForEach</code>实例中。</p>
<p>ForEach对集合的操作方式与list相同，这意味着您可以在任何可以使用子视图的地方使用它，例如在<code>stacks</code>、<code>list</code>、<code>group</code>等中。当数据元素是简单的值类型（如您在这里使用的字符串）时，可以使用.self作为<code>identifier</code>的<code>key path</code>。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                    <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ForEach</span>([<span class="string">&quot;iPhone SE&quot;</span>, <span class="string">&quot;iPhone XS Max&quot;</span>], id: \.<span class="keyword">self</span>) &#123; deviceName <span class="keyword">in</span></span><br><span class="line">            <span class="type">LandmarkList</span>()</span><br><span class="line">                .previewDevice(<span class="type">PreviewDevice</span>(rawValue: deviceName))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/211152e25bc0bf47a4004a9e14db37a62988641dbc90c805391d7be151fbd173/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393039336136303638362f64366638326161302d663330382d346364632d623934322d6165396134613866613166392e706e67" alt=""></p>
<h2 id="步骤3-21">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-5"></a></p>
<p>使用<code>previewDisplayName(_:)</code>修饰符将设备名称添加为预览的标签。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                    <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ForEach</span>([<span class="string">&quot;iPhone SE&quot;</span>, <span class="string">&quot;iPhone XS Max&quot;</span>], id: \.<span class="keyword">self</span>) &#123; deviceName <span class="keyword">in</span></span><br><span class="line">            <span class="type">LandmarkList</span>()</span><br><span class="line">                .previewDevice(<span class="type">PreviewDevice</span>(rawValue: deviceName))</span><br><span class="line">                .previewDisplayName(deviceName)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/72d9728f29857da99cbbc6d65a54ea98688bea2d7ead6617132e113f755ce77d/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f363434663134663036342f34313930623234332d616636322d343337622d613365312d3930346435333232346630362e706e67" alt=""></p>
<h2 id="步骤4-20">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-5"></a></p>
<p>您可以尝试使用不同的设备来比较视图的渲染，所有这些都来自画布。</p>
<p><img src="https://camo.githubusercontent.com/e276e569fa4b0488ec9d0f2135055373e8f316cb83bb73d2394cf0c9b7af0963/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f386533376136303038342f64616634323962622d336237372d343138662d616431332d6161346239646137316137632e706e67" alt=""></p>
<h3 id="框架集成-2">框架集成</h3>
<p><a href="#%E6%A1%86%E6%9E%B6%E9%9B%86%E6%88%90"></a></p>
<h2 id="创建watchOS应用程序">创建watchOS应用程序</h2>
<p><a href="#%E5%88%9B%E5%BB%BAwatchos%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"></a></p>
<p>本教程为您提供了一个机会，让您可以应用您已经了解的有关SwiftUI的大部分内容，并且只需很少的努力将<code>Landmarks</code>应用程序迁移到<code>watchOS</code>。</p>
<p>在复制为iOS应用程序创建的共享数据和视图之前，您将首先向项目中添加<code>watchOS target</code>。所有资源就绪后，您将自定义SwiftUI视图，以便在<code>watchOS</code>上显示详情视图和列表视图。</p>
<blockquote>
<p>学习时间：25分钟</p>
<p><a target="_blank" rel="noopener" href="https://docs-assets.developer.apple.com/published/2165a283e4/CreatingAwatchOSApp.zip">下载地址：CreatingAwatchOSApp.zip</a></p>
</blockquote>
<h2 id="第一节-添加watchOS-Target">第一节 添加watchOS Target</h2>
<p><a href="#%E7%AC%AC%E4%B8%80%E8%8A%82-%E6%B7%BB%E5%8A%A0watchos-target"></a></p>
<p>要创建watchOS应用程序，请首先将watchOS Target添加到项目中。Xcode将watchOS应用程序的文件夹和文件，以及构建和运行该应用程序所需的方案添加到项目中。</p>
<p><img src="https://camo.githubusercontent.com/94e5cb4d1b6bf9cee0366f72b27112dfbfee7b131f979b7a5c3c25a0f546eba5/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f363332313031353864612f65306461346164642d363265622d343737652d613363622d3134626666653362383361612e706e67" alt=""></p>
<h2 id="步骤1-26">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41"></a></p>
<p>选择<code>File &gt; New &gt; Target</code>。当工作模板表出现时，选择<code>watchOS</code>选项卡，选择<code>Watch App for iOS</code>应用程序模板，然后单击<code>Next</code>。</p>
<p>此模板将新的watchOS应用程序添加到您的项目中，并与iOS应用程序配对。</p>
<p><img src="https://camo.githubusercontent.com/3f1925f86b2fade7e5cdd1a610932de6d20c4e4ab5eb287b08d9814f8171f18b/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f376334633065333137312f64363831333232342d323866362d343031382d383736302d3163623662623936623062332e706e67" alt=""></p>
<h2 id="步骤2-26">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42"></a></p>
<p>在表单中，输入<code>WatchLandmarks</code>作为产品名称。将语言设置为<code>Swift</code>，将用户界面设置为<code>SwiftUI</code>。选中<code>Include Notification Scene</code>复选框，然后单击“Finish”。</p>
<p><img src="https://camo.githubusercontent.com/ae35f464476b2d66628838d67b41534e4270d03640001178b51b630cfe730604/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f306534313063643932332f64613733363431312d346335322d346162662d616535312d3965366464643232366639332e706e67" alt=""></p>
<h2 id="步骤3-22">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43"></a></p>
<blockquote>
<p>如果Xcode提示，请单击“Activate”。</p>
</blockquote>
<p>这将选择<code>WatchLandmarks</code>方案，以便您可以构建和运行watchOS应用程序。</p>
<p><img src="https://camo.githubusercontent.com/e27ae1c3f18e4b9666755eb3a325dc9fb977dccd9a40cf680f486112b0400deb/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f363334663533666536622f35316663376633362d363264612d346461622d386435342d6330366434653738633437372e706e67" alt=""></p>
<h2 id="步骤4-21">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44"></a></p>
<p>在<code>WatchLandmarks</code>扩展的“General”选项卡中，选中<code>Supports Running Without iOS App Installation(支持在不安装iOS应用程序的情况下运行)</code>复选框。</p>
<blockquote>
<p>尽可能创建一个独立的watchOS应用程序。独立的watchOS应用不需要iOS配套应用。</p>
</blockquote>
<p><img src="https://camo.githubusercontent.com/e95d6ca42c552ac8f94552ac39cf826eea201631c2c2f2aa53b9c536cf798c31/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f623439343564306165372f39346632616132382d336365622d343932382d613663662d6435366338626138613464612e706e67" alt=""></p>
<h2 id="第二节-在目标之间共享文件">第二节 在目标之间共享文件</h2>
<p><a href="#%E7%AC%AC%E4%BA%8C%E8%8A%82-%E5%9C%A8%E7%9B%AE%E6%A0%87%E4%B9%8B%E9%97%B4%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6"></a></p>
<p>设置了watchOS目标后，需要共享iOS目标中的一些资源。您将重用<code>Landmark</code>应用程序的数据模型、一些资源文件以及两个平台都可以显示而无需修改的任何视图。</p>
<p><img src="https://camo.githubusercontent.com/1edc28a6d546e1ed24f7e6702f2a723a10290c3e5c38b7bbdaf19d803db63bdd/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f396532653061356561352f66643762633837662d613235652d346561622d383837662d6462366462636362323065382e706e67" alt=""></p>
<h2 id="步骤1-27">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-1"></a></p>
<p>在项目导航器中，单击命令以选择以下文件：LandmarkRow.swift、Landmark.swift、UserData.swift、Data.swift、Profile.swift、Hike.swift和CircleImage.swift。</p>
<p>Landmark.swift、UserData.swift、Data.swift、Profile.swift和Hike.swift定义了应用程序的数据模型。您不会使用模型的所有方面，但需要所有文件才能成功编译应用程序。LandmarkRow.swift和CircleImage.swift都是应用程序可以在watchOS上显示的视图，无需任何更改。</p>
<p><img src="https://camo.githubusercontent.com/ea545188f8eb75b30f9ef0d042a89331accc069e6ceb29d20c9ee060c44b6bdb/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f323531366535363133642f39353732313666652d616632622d343965632d616430652d6639653731643638323162652e706e67" alt=""></p>
<h2 id="步骤2-27">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-1"></a></p>
<p>在“文件检查器”中，选中“Target Membership”部分中的“WatchLandmarks Extension”复选框。</p>
<p><img src="https://camo.githubusercontent.com/98daa11ce8e23aae78655dbcbb344fab78364e24b96bc2d079bf4076c96d8a38/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f666538373435363936342f32353861333461652d613536352d343364342d613261392d3436356636653562393939392e706e67" alt=""></p>
<blockquote>
<p>这使您在上一步中选择的文件可用于watchOS应用程序。</p>
</blockquote>
<h2 id="步骤3-23">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-1"></a></p>
<p>在项目导航器中，选择Landmark组中的Assets.xclassets文件，并将其添加到<code>File</code>检查器的<code>Target Membership</code>部分中的<code>WatchLandmarks</code> Target中。</p>
<p>这与您在上一步中选择的<code>Target</code>不同。<code>WatchLandmarks Extension</code> Target包含你的应用程序的代码，而<code>WatchLandmarks Target</code>管理脚本、图标和相关资源。</p>
<p><img src="https://camo.githubusercontent.com/0b9dbaa9d025d35d817a7c05ca880f6feb9eefb10678aaa655125a215cad0593/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f343239303166333030652f66643362663461652d343539622d343638652d623631312d6561636235613433353862322e706e67" alt=""></p>
<h2 id="步骤4-22">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-1"></a></p>
<p>在项目导航器中，选择<code>Resources</code>文件夹中的所有文件，然后在<code>File</code>检查器的<code>Target Membership</code>中将它们添加到<code>WatchLandmarks Extension</code> target中。</p>
<p><img src="https://camo.githubusercontent.com/ec10e16d166dfdf5a2c40538ba019261705f7c623dd8860d6cf9bf388666cc05/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f643662376136323537342f38313462303931662d313832392d346639612d396439652d3365663137613038616635362e706e67" alt=""></p>
<h2 id="第三节-创建详情视图">第三节 创建详情视图</h2>
<p><a href="#%E7%AC%AC%E4%B8%89%E8%8A%82-%E5%88%9B%E5%BB%BA%E8%AF%A6%E6%83%85%E8%A7%86%E5%9B%BE"></a></p>
<p>现在iOS目标资源已经准备好用于watch应用程序，您需要创建一个watch的视图来显示地标详情。为了测试详情视图，您将为最大和最小的手表尺寸创建自定义预览，并对圆形视图进行一些更改，以便所有内容都适合手表界面。</p>
<p><img src="https://camo.githubusercontent.com/a0426ec1422661dea3b047ab629887a05f43745897c6f338c4067f054e40cad2/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393838393463356262642f63346534646538382d626138652d343962392d396136652d3030656439626335376633622e706e67" alt=""></p>
<h2 id="步骤1-28">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-2"></a></p>
<p>在项目导航器中，单击<code>WatchLandmarks Extension</code>文件夹旁边的三角形以显示其内容，然后添加名为<code>WatchLandmarkDetail</code>的新SwiftUI视图。</p>
<p><img src="https://camo.githubusercontent.com/8b29e4d0ecfe281efce56192f299c9b98ae900700b71deb605ce17c58c39686c/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f666566643362356538372f37376436306238312d623132622d343232302d616565302d3939383339643931363837362e706e67" alt=""></p>
<h2 id="步骤2-28">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-2"></a></p>
<p>将<code>userData、landmark、landmarkIndex</code>属性添加到<code>WatchLandmarkDetail</code>结构中。</p>
<p>这些属性与您在Handling User Input时添加到<code>LandmarkDetail</code>结构中的属性相同。</p>
<blockquote>
<p>WatchLandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello World!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">WatchLandmarkDetail</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在上一步中添加属性后，Xcode中将出现参数丢失错误。要修复错误，您需要执行以下两项操作之一：为属性提供默认值，或传递参数设置视图的属性。</p>
</blockquote>
<h2 id="步骤3-24">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-2"></a></p>
<p>在预览中，创建用户数据的实例，并使用它将<code>landmark</code>对象传递给<code>WatchLandmarkView</code>结构的初始值。还需要将用户数据设置为视图的环境对象。</p>
<blockquote>
<p>WatchLandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello World!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> userData <span class="operator">=</span> <span class="type">UserData</span>()</span><br><span class="line">        <span class="keyword">return</span> <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">0</span>])</span><br><span class="line">            .environmentObject(userData)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/52c7d41a324a48a3eb1df51ec58a274b897760eb9a34e23e53390b29c03ff4ba/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f316637333639333863382f61386131383764652d356539622d343239312d623936632d3663636162626233346638392e706e67" alt=""></p>
<h2 id="步骤4-23">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-2"></a></p>
<p>在<code>WatchLandmarkDetail.swift</code>中，从<code>body（）</code>方法返回<code>CircleImage</code>视图。</p>
<p>在这里，您可以重用iOS项目中的CircleImage视图。因为您创建了一个可调整大小的图像，所以调用<code>.scaledToFill（）</code>将调整圆的大小，使其自动适配显示。</p>
<blockquote>
<p>WatchLandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CircleImage</span>(image: <span class="keyword">self</span>.landmark.image.resizable())</span><br><span class="line">            .scaledToFill()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> userData <span class="operator">=</span> <span class="type">UserData</span>()</span><br><span class="line">        <span class="keyword">return</span> <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">0</span>])</span><br><span class="line">            .environmentObject(userData)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤5-12">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45"></a></p>
<p>为最大（44毫米）和最小（38毫米）的表盘创建预览。</p>
<p>通过对最大和最小的手表表面进行测试，你可以看到你的应用程序在屏幕上的缩放效果。一如既往，您应该在所有支持的设备大小上测试用户界面。</p>
<blockquote>
<p>WatchLandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CircleImage</span>(image: <span class="keyword">self</span>.landmark.image.resizable())</span><br><span class="line">            .scaledToFill()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> userData <span class="operator">=</span> <span class="type">UserData</span>()</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">0</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 4 - 44mm&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">1</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 2 - 38mm&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/11cbfa48139c2ad01549d97b5a9cef1482ce2f8e52edd920e278dad0c7ee3f8e/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f373432643533393730322f32626266363065642d363139372d346636342d383535352d3061383465323561313766622e706e67" alt=""></p>
<blockquote>
<p>圆形图像将调整大小以适配显示的高度。不幸的是，这也限制了圆的宽度。要解决裁减问题，您需要将图像嵌入<code>VStack</code>中，并进行一些额外的布局更改，以便圆形图像适合任何手表的宽度。</p>
</blockquote>
<h2 id="步骤6-9">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46"></a></p>
<p>将圆图像嵌入到<code>VStack</code>中。在图像下方显示地标名称及其信息。</p>
<p>如您所见，该信息不太适合在表盘屏幕上显示，但您可以通过将VStack放在滚动视图中来解决这个问题。</p>
<blockquote>
<p>WatchLandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">CircleImage</span>(image: <span class="keyword">self</span>.landmark.image.resizable())</span><br><span class="line">                .scaledToFill()</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="keyword">self</span>.landmark.name)</span><br><span class="line">                .font(.headline)</span><br><span class="line">                .lineLimit(<span class="number">0</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Toggle</span>(isOn:</span><br><span class="line">            <span class="variable">$userData</span>.landmarks[<span class="keyword">self</span>.landmarkIndex].isFavorite) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Favorite&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">Divider</span>()</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="keyword">self</span>.landmark.park)</span><br><span class="line">                .font(.caption)</span><br><span class="line">                .bold()</span><br><span class="line">                .lineLimit(<span class="number">0</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="keyword">self</span>.landmark.state)</span><br><span class="line">                .font(.caption)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> userData <span class="operator">=</span> <span class="type">UserData</span>()</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">0</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 4 - 44mm&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">1</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 2 - 38mm&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/2c3962044d2e8fb9d52feabbda3f0efa434ad2dcdccb3522561c45264d3c2e0a/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663831373162393463612f62633039313630392d363564362d343436332d383436342d6433613566336632613035312e706e67" alt=""></p>
<h2 id="步骤7-4">步骤7</h2>
<p><a href="#%E6%AD%A5%E9%AA%A47"></a></p>
<p>在滚动视图中包装<code>VStack</code>。</p>
<p>这会打开视图滚动，但会产生另一个问题：圆形图像现在会扩展到原大小，并且会调整其他UI元素的大小以匹配图像大小。您需要调整圆图像的大小，以便屏幕上只显示圆和地标名称。</p>
<blockquote>
<p>WatchLandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ScrollView</span> &#123;</span><br><span class="line">            <span class="type">VStack</span> &#123;</span><br><span class="line">                <span class="type">CircleImage</span>(image: <span class="keyword">self</span>.landmark.image.resizable())</span><br><span class="line">                    .scaledToFill()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.name)</span><br><span class="line">                    .font(.headline)</span><br><span class="line">                    .lineLimit(<span class="number">0</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="type">Toggle</span>(isOn:</span><br><span class="line">                <span class="variable">$userData</span>.landmarks[<span class="keyword">self</span>.landmarkIndex].isFavorite) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Favorite&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="type">Divider</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.park)</span><br><span class="line">                    .font(.caption)</span><br><span class="line">                    .bold()</span><br><span class="line">                    .lineLimit(<span class="number">0</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.state)</span><br><span class="line">                    .font(.caption)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> userData <span class="operator">=</span> <span class="type">UserData</span>()</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">0</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 4 - 44mm&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">1</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 2 - 38mm&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/6bba9cde52680e0519f897f766fbbc853ab2e9b7a2672272b69464f0886d3759/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f353636613563623838342f39643437616339662d323061392d346466652d393332642d3532636461346266393932342e706e67" alt=""></p>
<h2 id="步骤8-3">步骤8</h2>
<p><a href="#%E6%AD%A5%E9%AA%A48"></a></p>
<p>将<code>scaleToFill（）</code>更改为<code>scaleToFit（）</code>。</p>
<p>这将缩放圆图像以匹配显示器的宽度。</p>
<blockquote>
<p>WatchLandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ScrollView</span> &#123;</span><br><span class="line">            <span class="type">VStack</span> &#123;</span><br><span class="line">                <span class="type">CircleImage</span>(image: <span class="keyword">self</span>.landmark.image.resizable())</span><br><span class="line">                    .scaledToFit()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.name)</span><br><span class="line">                    .font(.headline)</span><br><span class="line">                    .lineLimit(<span class="number">0</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="type">Toggle</span>(isOn:</span><br><span class="line">                <span class="variable">$userData</span>.landmarks[<span class="keyword">self</span>.landmarkIndex].isFavorite) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Favorite&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="type">Divider</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.park)</span><br><span class="line">                    .font(.caption)</span><br><span class="line">                    .bold()</span><br><span class="line">                    .lineLimit(<span class="number">0</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.state)</span><br><span class="line">                    .font(.caption)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> userData <span class="operator">=</span> <span class="type">UserData</span>()</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">0</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 4 - 44mm&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">1</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 2 - 38mm&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/e6834923fb4a19e1e1f84d6b508b58c798d0184d8e46f8f5841f8d8a6c775b73/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f323761386531653230612f61333830633264632d343361342d346265362d386639322d3339303463353931356536662e706e67" alt=""></p>
<h2 id="步骤9-3">步骤9</h2>
<p><a href="#%E6%AD%A5%E9%AA%A49"></a></p>
<p>添加<code>padding</code>，使地标名称在圆图像下方可见。</p>
<blockquote>
<p>WatchLandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ScrollView</span> &#123;</span><br><span class="line">            <span class="type">VStack</span> &#123;</span><br><span class="line">                <span class="type">CircleImage</span>(image: <span class="keyword">self</span>.landmark.image.resizable())</span><br><span class="line">                    .scaledToFit()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.name)</span><br><span class="line">                    .font(.headline)</span><br><span class="line">                    .lineLimit(<span class="number">0</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="type">Toggle</span>(isOn:</span><br><span class="line">                <span class="variable">$userData</span>.landmarks[<span class="keyword">self</span>.landmarkIndex].isFavorite) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Favorite&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="type">Divider</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.park)</span><br><span class="line">                    .font(.caption)</span><br><span class="line">                    .bold()</span><br><span class="line">                    .lineLimit(<span class="number">0</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.state)</span><br><span class="line">                    .font(.caption)</span><br><span class="line">            &#125;</span><br><span class="line">            .padding(<span class="number">16</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> userData <span class="operator">=</span> <span class="type">UserData</span>()</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">0</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 4 - 44mm&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">1</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 2 - 38mm&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/0b02ca1bf5ca5290d18b14f1bada438174e7f0f2402042aa4dfed889e7a76e59/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393436633830326330302f35633633636462372d663166362d343863642d386662362d6332613162653432383335652e706e67" alt=""></p>
<h2 id="步骤10-2">步骤10</h2>
<p><a href="#%E6%AD%A5%E9%AA%A410"></a></p>
<p>在<code>后退</code>按钮上添加标题。</p>
<p>这会将后退按钮的文本设置为“地标”。但是，在添加“地标列表”视图之前，您不会看到“后退”按钮。</p>
<blockquote>
<p>WatchLandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ScrollView</span> &#123;</span><br><span class="line">            <span class="type">VStack</span> &#123;</span><br><span class="line">                <span class="type">CircleImage</span>(image: <span class="keyword">self</span>.landmark.image.resizable())</span><br><span class="line">                    .scaledToFit()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.name)</span><br><span class="line">                    .font(.headline)</span><br><span class="line">                    .lineLimit(<span class="number">0</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="type">Toggle</span>(isOn:</span><br><span class="line">                <span class="variable">$userData</span>.landmarks[<span class="keyword">self</span>.landmarkIndex].isFavorite) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Favorite&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="type">Divider</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.park)</span><br><span class="line">                    .font(.caption)</span><br><span class="line">                    .bold()</span><br><span class="line">                    .lineLimit(<span class="number">0</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.state)</span><br><span class="line">                    .font(.caption)</span><br><span class="line">            &#125;</span><br><span class="line">            .padding(<span class="number">16</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="string">&quot;Landmarks&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> userData <span class="operator">=</span> <span class="type">UserData</span>()</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">0</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 4 - 44mm&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">1</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 2 - 38mm&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/0b02ca1bf5ca5290d18b14f1bada438174e7f0f2402042aa4dfed889e7a76e59/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393436633830326330302f35633633636462372d663166362d343863642d386662362d6332613162653432383335652e706e67" alt=""></p>
<h2 id="第四节-添加watchOS地图视图">第四节 添加watchOS地图视图</h2>
<p><a href="#%E7%AC%AC%E5%9B%9B%E8%8A%82-%E6%B7%BB%E5%8A%A0watchos%E5%9C%B0%E5%9B%BE%E8%A7%86%E5%9B%BE"></a></p>
<p>现在您已经创建了基本详情视图，现在是时候添加一个地图来显示地标的位置了。与<code>CircleImage</code>不同，你不能重用iOS应用程序的<code>MapView</code>。相反，您需要创建一个<code>WKInterfaceObjectRepresentable</code>结构来包装<code>WatchKit</code>的地图视图。</p>
<p><img src="https://camo.githubusercontent.com/53b2572627149ce7fb0b40d2c07f7bd257519607b195f956ae26ef8abc4d7a19/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f313738306665356134352f37623630306664352d386637302d346365362d626532652d6434666338313530326139382e706e67" alt=""></p>
<h2 id="步骤1-29">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-3"></a></p>
<p>向<code>WatchKit extension</code>添加名为<code>WatchMapView</code>的自定义视图。</p>
<blockquote>
<p>WatchMapView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchMapView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello World!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchMapView_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">WatchMapView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/52c7d41a324a48a3eb1df51ec58a274b897760eb9a34e23e53390b29c03ff4ba/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f316637333639333863382f61386131383764652d356539622d343239312d623936632d3663636162626233346638392e706e67" alt=""></p>
<h2 id="步骤2-29">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-3"></a></p>
<blockquote>
<p>在<code>WatchMapView</code>结构中，将View更改为<code>WKInterfaceObjectRepresentable</code>。</p>
</blockquote>
<p>要查看区别，请在步骤1和2所示的代码之间来回滚动。</p>
<blockquote>
<p>WatchMapView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchMapView</span>: <span class="title class_ inherited__">WKInterfaceObjectRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello World!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchMapView_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">WatchMapView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Xcode显示编译错误，因为WatchMapView尚未实现<code>WKInterfaceObjectRepresentable</code>协议属性。</p>
</blockquote>
<h2 id="步骤3-25">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-3"></a></p>
<p>删除<code>body（）</code>方法并将其替换为<code>landmark</code>属性。</p>
<p>无论何时创建地图视图，都需要传递此属性的值。例如，可以将<code>landmark</code>的实例传递给预览。</p>
<blockquote>
<p>WatchMapView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchMapView</span>: <span class="title class_ inherited__">WKInterfaceObjectRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchMapView_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">WatchMapView</span>(landmark: <span class="type">UserData</span>().landmarks[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤4-24">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-3"></a></p>
<p>实现<code>WKInterfaceObjectRepresentable</code>的<code>makeWKInterfaceObject(context:)</code> 方法。</p>
<p>此方法用来创建<code>WatchMapView</code>显示的<code>WatchKit</code>地图。</p>
<blockquote>
<p>WatchMapView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchMapView</span>: <span class="title class_ inherited__">WKInterfaceObjectRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeWKInterfaceObject</span>(<span class="params">context</span>: <span class="type">WKInterfaceObjectRepresentableContext</span>&lt;<span class="type">WatchMapView</span>&gt;) -&gt; <span class="type">WKInterfaceMap</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">WKInterfaceMap</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchMapView_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">WatchMapView</span>(landmark: <span class="type">UserData</span>().landmarks[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤5-13">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-1"></a></p>
<p>通过实现<code>WKInterfaceObjectRepresentable</code>的<code>updateWKInterfaceObject（_:，context:）</code>方法，根据地标的坐标设置地图的区域。</p>
<p>现在，编译成功了。</p>
<blockquote>
<p>WatchMapView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchMapView</span>: <span class="title class_ inherited__">WKInterfaceObjectRepresentable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeWKInterfaceObject</span>(<span class="params">context</span>: <span class="type">WKInterfaceObjectRepresentableContext</span>&lt;<span class="type">WatchMapView</span>&gt;) -&gt; <span class="type">WKInterfaceMap</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">WKInterfaceMap</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateWKInterfaceObject</span>(<span class="keyword">_</span> <span class="params">map</span>: <span class="type">WKInterfaceMap</span>, <span class="params">context</span>: <span class="type">WKInterfaceObjectRepresentableContext</span>&lt;<span class="type">WatchMapView</span>&gt;) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> span <span class="operator">=</span> <span class="type">MKCoordinateSpan</span>(latitudeDelta: <span class="number">0.02</span>,</span><br><span class="line">            longitudeDelta: <span class="number">0.02</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> region <span class="operator">=</span> <span class="type">MKCoordinateRegion</span>(</span><br><span class="line">            center: landmark.locationCoordinate,</span><br><span class="line">            span: span)</span><br><span class="line">        </span><br><span class="line">        map.setRegion(region)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchMapView_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">WatchMapView</span>(landmark: <span class="type">UserData</span>().landmarks[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/5551ad7b71c54a37f15c63d1056aac1c7f0c5e8e1519cc2f166a73a61fa53bdb/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f356330373736623463622f39396533356233612d306333652d343063312d613739332d6261656261626230323734642e706e67" alt=""></p>
<h2 id="步骤6-10">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46-1"></a></p>
<p>选择<code>WatchLandmarkView.swift</code>文件并将地图视图添加到<code>VStack</code>的底部。</p>
<p>代码添加了一个分隔符，后跟地图视图。<code>.scaledToFit（）</code>和<code>.padding（）</code>修饰符将地图以合适的大小适配屏幕。</p>
<blockquote>
<p>WatchLandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ScrollView</span> &#123;</span><br><span class="line">            <span class="type">VStack</span> &#123;</span><br><span class="line">                <span class="type">CircleImage</span>(image: <span class="keyword">self</span>.landmark.image.resizable())</span><br><span class="line">                    .scaledToFit()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.name)</span><br><span class="line">                    .font(.headline)</span><br><span class="line">                    .lineLimit(<span class="number">0</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="type">Toggle</span>(isOn:</span><br><span class="line">                <span class="variable">$userData</span>.landmarks[<span class="keyword">self</span>.landmarkIndex].isFavorite) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Favorite&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="type">Divider</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.park)</span><br><span class="line">                    .font(.caption)</span><br><span class="line">                    .bold()</span><br><span class="line">                    .lineLimit(<span class="number">0</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="keyword">self</span>.landmark.state)</span><br><span class="line">                    .font(.caption)</span><br><span class="line">                </span><br><span class="line">                <span class="type">Divider</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">WatchMapView</span>(landmark: <span class="keyword">self</span>.landmark)</span><br><span class="line">                    .scaledToFit()</span><br><span class="line">                    .padding()</span><br><span class="line">            &#125;</span><br><span class="line">            .padding(<span class="number">16</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="string">&quot;Landmarks&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WatchLandmarkDetail_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> userData <span class="operator">=</span> <span class="type">UserData</span>()</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">0</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 4 - 44mm&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">WatchLandmarkDetail</span>(landmark: userData.landmarks[<span class="number">1</span>]).environmentObject(userData)</span><br><span class="line">                .previewDevice(<span class="string">&quot;Apple Watch Series 2 - 38mm&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/b1c95ec69bb97575ea43a15c8c0740e0f9643f936edcfb9eb0d05f2a95e269fd/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663336383661313061612f63303138653933642d636538342d343762622d623730632d3436336530343834336131342e706e67" alt=""></p>
<h2 id="第五节-创建跨平台列表视图">第五节 创建跨平台列表视图</h2>
<p><a href="#%E7%AC%AC%E4%BA%94%E8%8A%82-%E5%88%9B%E5%BB%BA%E8%B7%A8%E5%B9%B3%E5%8F%B0%E5%88%97%E8%A1%A8%E8%A7%86%E5%9B%BE"></a></p>
<p>对于地标列表，您可以重用iOS应用程序中的行<code>Row</code>，但每个平台都需要呈现自己的详情视图。为了支持这一点，您将把LandmarkList视图转换为泛型列表类型，在这里实例化代码定义了详情视图。</p>
<h2 id="步骤1-在工具栏中，选择Landmarks-scheme。">步骤1 在工具栏中，选择<code>Landmarks scheme</code>。</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-%E5%9C%A8%E5%B7%A5%E5%85%B7%E6%A0%8F%E4%B8%AD%E9%80%89%E6%8B%A9landmarks-scheme"></a></p>
<p>Xcode现在编译并运行应用程序的iOS版本。在将列表移动到watchOS应用程序之前，您要确保对<code>LandmarkList</code>视图的任何修改在iOS应用程序中仍然有效。</p>
<p><img src="https://camo.githubusercontent.com/fa82bdc504625c6f764d35ff385f348b7bbca93a267ab913261dfa8611a4be51/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f383264316230653466632f38313034303539622d396138612d346434662d616362382d6561376664386537376462372e706e67" alt=""></p>
<h2 id="步骤2-30">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-4"></a></p>
<p>选择<code>LandmarkList.swift</code>并更改类型声明，使其成为泛型类型。</p>
<blockquote>
<p>LandmarksList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>&lt;<span class="type">DetailView</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">private</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Toggle</span>(isOn: <span class="variable">$userData</span>.showFavoritesOnly) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Show Favorites Only&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">ForEach</span>(userData.landmarks) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.userData.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                    <span class="type">NavigationLink</span>(</span><br><span class="line">                    destination: <span class="type">LandmarkDetail</span>(landmark: landmark).environmentObject(<span class="keyword">self</span>.userData)) &#123;</span><br><span class="line">                        <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarksList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ForEach</span>([<span class="string">&quot;iPhone SE&quot;</span>, <span class="string">&quot;iPhone XS Max&quot;</span>].identified(by: \.<span class="keyword">self</span>)) &#123; deviceName <span class="keyword">in</span></span><br><span class="line">            <span class="type">LandmarkList</span>()</span><br><span class="line">                .previewDevice(<span class="type">PreviewDevice</span>(rawValue: deviceName))</span><br><span class="line">                .previewDisplayName(deviceName)</span><br><span class="line">        &#125;</span><br><span class="line">        .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在创建<code>LandmarkList</code>结构的实例时，添加泛型声明会导致<code>Generic parameter could not be inferred(无法推断泛型参数)</code>错误。以下步骤会修复这些错误。</p>
</blockquote>
<h2 id="步骤3-26">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-4"></a></p>
<p>为创建局部视图的闭包添加属性。</p>
<blockquote>
<p>LandmarksList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>&lt;<span class="type">DetailView</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">private</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> detailViewProducer: (<span class="type">Landmark</span>) -&gt; <span class="type">DetailView</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Toggle</span>(isOn: <span class="variable">$userData</span>.showFavoritesOnly) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Show Favorites Only&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">ForEach</span>(userData.landmarks) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.userData.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                    <span class="type">NavigationLink</span>(</span><br><span class="line">                    destination: <span class="type">LandmarkDetail</span>(landmark: landmark).environmentObject(<span class="keyword">self</span>.userData)) &#123;</span><br><span class="line">                        <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarksList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ForEach</span>([<span class="string">&quot;iPhone SE&quot;</span>, <span class="string">&quot;iPhone XS Max&quot;</span>].identified(by: \.<span class="keyword">self</span>)) &#123; deviceName <span class="keyword">in</span></span><br><span class="line">            <span class="type">LandmarkList</span>()</span><br><span class="line">                .previewDevice(<span class="type">PreviewDevice</span>(rawValue: deviceName))</span><br><span class="line">                .previewDisplayName(deviceName)</span><br><span class="line">        &#125;</span><br><span class="line">        .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤4-25">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-4"></a></p>
<p>使用<code>detailViewProducer</code>属性为地标创建详情视图。</p>
<blockquote>
<p>LandmarksList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>&lt;<span class="type">DetailView</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">private</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> detailViewProducer: (<span class="type">Landmark</span>) -&gt; <span class="type">DetailView</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Toggle</span>(isOn: <span class="variable">$userData</span>.showFavoritesOnly) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Show Favorites Only&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">ForEach</span>(userData.landmarks) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.userData.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                    <span class="type">NavigationLink</span>(</span><br><span class="line">                    destination: <span class="keyword">self</span>.detailViewProducer(landmark).environmentObject(<span class="keyword">self</span>.userData)) &#123;</span><br><span class="line">                        <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarksList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ForEach</span>([<span class="string">&quot;iPhone SE&quot;</span>, <span class="string">&quot;iPhone XS Max&quot;</span>].identified(by: \.<span class="keyword">self</span>)) &#123; deviceName <span class="keyword">in</span></span><br><span class="line">            <span class="type">LandmarkList</span>()</span><br><span class="line">                .previewDevice(<span class="type">PreviewDevice</span>(rawValue: deviceName))</span><br><span class="line">                .previewDisplayName(deviceName)</span><br><span class="line">        &#125;</span><br><span class="line">        .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>创建<code>LandmarkList</code>实例时，还需要提供一个闭包，用于创建<code>landmark</code>的详情视图。</p>
</blockquote>
<h2 id="步骤5-14">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-2"></a></p>
<p>选择Home.swift。在<code>CategoryHome</code>结构的<code>body（）</code>方法中，添加闭包以创建<code>LandmarkDetail</code>视图。</p>
<p>Xcode根据闭包的返回值推断<code>LandmarkList</code>结构的泛型类型。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categories: [<span class="type">String</span>: [<span class="type">Landmark</span>]] &#123;</span><br><span class="line">        <span class="type">Dictionary</span>(</span><br><span class="line">            grouping: landmarkData,</span><br><span class="line">            by: &#123; <span class="variable">$0</span>.category.rawValue &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> featured: [<span class="type">Landmark</span>] &#123;</span><br><span class="line">        landmarkData.filter &#123; <span class="variable">$0</span>.isFeatured &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showingProfile <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> profileButton: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span>(action: &#123; <span class="keyword">self</span>.showingProfile.toggle() &#125;) &#123;</span><br><span class="line">            <span class="type">Image</span>(systemName: <span class="string">&quot;person.crop.circle&quot;</span>)</span><br><span class="line">                .imageScale(.large)</span><br><span class="line">                .accessibility(label: <span class="type">Text</span>(<span class="string">&quot;User Profile&quot;</span>))</span><br><span class="line">                .padding()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">FeaturedLandmarks</span>(landmarks: featured)</span><br><span class="line">                    .scaledToFill()</span><br><span class="line">                    .frame(height: <span class="type">CGFloat</span>(<span class="number">200</span>))</span><br><span class="line">                    .clipped()</span><br><span class="line">                    .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">                </span><br><span class="line">                <span class="type">ForEach</span>(categories.keys.sorted(), id: \.<span class="keyword">self</span>) &#123; key <span class="keyword">in</span></span><br><span class="line">                    <span class="type">CategoryRow</span>(categoryName: key, items: <span class="keyword">self</span>.categories[key]<span class="operator">!</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">                </span><br><span class="line">                <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkList</span> &#123; <span class="type">LandmarkDetail</span>(landmark: <span class="variable">$0</span>) &#125;) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;See All&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Featured&quot;</span>))</span><br><span class="line">            .navigationBarItems(trailing: profileButton)</span><br><span class="line">            .sheet(isPresented: <span class="variable">$showingProfile</span>) &#123;</span><br><span class="line">                <span class="type">ProfileHost</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FeaturedLandmarks</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmarks: [<span class="type">Landmark</span>]</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        landmarks[<span class="number">0</span>].image.resizable()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// swiftlint:disable type_name</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">            .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤6-11">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46-2"></a></p>
<p>在LandmarkList.swift中，向预览添加类似的代码。</p>
<p>在这里，您需要使用条件判断，根据Xcode编译的当前<code>scheme</code>定义详情视图。现在地标应用程序可以按照预期在iOS上构建和运行了。</p>
<blockquote>
<p>LandmarksList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>&lt;<span class="type">DetailView</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">private</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> detailViewProducer: (<span class="type">Landmark</span>) -&gt; <span class="type">DetailView</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Toggle</span>(isOn: <span class="variable">$userData</span>.showFavoritesOnly) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Show Favorites Only&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">ForEach</span>(userData.landmarks) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.userData.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                    <span class="type">NavigationLink</span>(</span><br><span class="line">                    destination: <span class="keyword">self</span>.detailViewProducer(landmark).environmentObject(<span class="keyword">self</span>.userData)) &#123;</span><br><span class="line">                        <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">#if</span> os(watchOS)</span><br><span class="line"><span class="keyword">typealias</span> <span class="type">PreviewDetailView</span> <span class="operator">=</span> <span class="type">WatchLandmarkDetail</span></span><br><span class="line"><span class="keyword">#else</span></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">PreviewDetailView</span> <span class="operator">=</span> <span class="type">LandmarkDetail</span></span><br><span class="line"><span class="keyword">#endif</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span> &#123; <span class="type">PreviewDetailView</span>(landmark: <span class="variable">$0</span>) &#125;</span><br><span class="line">            .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/155253a23fe7a02f9e435374ece449f3d092a622da3841dd7353dc1135ba1b25/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f656164323837616138322f66396236376132322d313936632d343064372d386630302d3132323033643730626535302e706e67" alt=""></p>
<h2 id="第六节-添加地标列表">第六节 添加地标列表</h2>
<p><a href="#%E7%AC%AC%E5%85%AD%E8%8A%82-%E6%B7%BB%E5%8A%A0%E5%9C%B0%E6%A0%87%E5%88%97%E8%A1%A8"></a></p>
<p>现在您已经更新了LandmarksList视图，以便它在两个平台上都能工作，您可以将其添加到watchOS应用程序中。</p>
<p><img src="https://camo.githubusercontent.com/b36132b3627950a40351115d6c1c9f2d198d1e46e8d2fdd493a44c0299ac446a/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393964396135313461382f63633463373830662d383065382d343139362d393632332d6634653731663636666165302e706e67" alt=""></p>
<h2 id="步骤1-30">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-4"></a></p>
<p>在文件检查器中，将<code>LandmarksList.swift</code>添加到<code>WatchLandmarks Extension</code>Target。</p>
<p>现在可以在watchOS应用程序的代码中使用LandmarkList视图。</p>
<p><img src="https://camo.githubusercontent.com/d6270016341abca60586d0bcd80f66db55284bb4841e76f6f1f4885612d473dd/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f623666656465613266642f35333239623336652d326261302d343633662d623038342d3933386465666665643934322e706e67" alt=""></p>
<h2 id="步骤2-31">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-5"></a></p>
<p>在工具栏中，将<code>scheme</code>更改为<code>WatchLandmarks</code>。</p>
<p><img src="https://camo.githubusercontent.com/8e530ec5f9e0f7ffb6dbe22b95af0564eb1ca8cff023b8da7b3bdd2595f7bd28/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f373561623437356338612f39336539613464372d343039622d343233362d383336632d6566353765383161626532352e706e67" alt=""></p>
<h2 id="步骤3-27">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-5"></a></p>
<p>打开<code>LandmarkList.swift</code>，继续预览。</p>
<p>预览现在显示watchOS列表视图。</p>
<blockquote>
<p>LandmarksList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>&lt;<span class="type">DetailView</span>: <span class="type">View</span>&gt;: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">private</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> detailViewProducer: (<span class="type">Landmark</span>) -&gt; <span class="type">DetailView</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Toggle</span>(isOn: <span class="variable">$userData</span>.showFavoritesOnly) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Show Favorites Only&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">ForEach</span>(userData.landmarks) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.userData.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                    <span class="type">NavigationLink</span>(</span><br><span class="line">                    destination: <span class="keyword">self</span>.detailViewProducer(landmark).environmentObject(<span class="keyword">self</span>.userData)) &#123;</span><br><span class="line">                        <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">#if</span> os(watchOS)</span><br><span class="line"><span class="keyword">typealias</span> <span class="type">PreviewDetailView</span> <span class="operator">=</span> <span class="type">WatchLandmarkDetail</span></span><br><span class="line"><span class="keyword">#else</span></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">PreviewDetailView</span> <span class="operator">=</span> <span class="type">LandmarkDetail</span></span><br><span class="line"><span class="keyword">#endif</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span> &#123; <span class="type">PreviewDetailView</span>(landmark: <span class="variable">$0</span>) &#125;</span><br><span class="line">            .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>watchOS应用程序的根视图是ContentView，它显示默认文本<code>Hello World！</code>。</p>
</blockquote>
<p><img src="https://camo.githubusercontent.com/a30f9cebda3c540a1e1fe0292baf157da40c156769c84d0739fcab1e930c17ba/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f346230666337396331342f65663032396237332d656637622d343939352d393566352d3862646339613030653636612e706e67" alt=""></p>
<h2 id="步骤4-26">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-5"></a></p>
<p>修改ContentView，使其显示列表视图。</p>
<blockquote>
<p>ContentView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span> &#123; <span class="type">WatchLandmarkDetail</span>(landmark: <span class="variable">$0</span>) &#125;</span><br><span class="line">            .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span> &#123; <span class="type">WatchLandmarkDetail</span>(landmark: <span class="variable">$0</span>) &#125;</span><br><span class="line">            .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/a30f9cebda3c540a1e1fe0292baf157da40c156769c84d0739fcab1e930c17ba/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f346230666337396331342f65663032396237332d656637622d343939352d393566352d3862646339613030653636612e706e67" alt=""></p>
<h2 id="步骤5-15">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-3"></a></p>
<p>在模拟器中编译运行watchOS应用程序。</p>
<p>通过滚动列表中的地标来测试watchOS应用程序的行为，点击以查看地标的详细信息，并将其标记为收藏夹。单击<code>back</code>按钮返回列表，然后打开<code>Favorite</code>开关，这样您只能看到收藏的地标。</p>
<p><img src="https://camo.githubusercontent.com/dbca4e8fc36442494ed03ed86a398c0097cd6bf49c6b6b142c23852c6e387189/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f626461336236636435662f30633332306434632d386131352d346261312d393138322d3264383231333239343366362e706e67" alt=""></p>
<h2 id="第7节-创建自定义通知界面">第7节 创建自定义通知界面</h2>
<p><a href="#%E7%AC%AC7%E8%8A%82-%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E9%80%9A%E7%9F%A5%E7%95%8C%E9%9D%A2"></a></p>
<p>你的watchOS版地标应用程序几乎完成了。在这最后一部分中，您将创建一个通知界面，每当您离最喜欢的某一位置很近时，会收到地标信息的通知信息。</p>
<p><img src="https://camo.githubusercontent.com/c72963e1dff238ad5c763a4eeb9497a4e3405611aee70cabf5a39196b4cf9a81/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f333739646434353933332f36366236343234342d633164662d343963372d383936362d6639333234396435656136302e706e67" alt=""></p>
<blockquote>
<p>注意：本节仅介绍如何在收到通知后显示通知。它不描述如何设置或发送通知。</p>
</blockquote>
<h2 id="步骤1-31">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-5"></a></p>
<p>打开<code>NotificationView.swift</code>并创建一个显示有关地标、标题和消息的信息的视图。</p>
<p>因为任何通知值都可以为nil，所以预览将显示通知视图的两个版本。第一个仅在未提供数据时显示默认值，第二个显示您提供的标题、消息和位置。</p>
<blockquote>
<p>NotificationView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">NotificationView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> title: <span class="type">String</span>?</span><br><span class="line">    <span class="keyword">let</span> message: <span class="type">String</span>?</span><br><span class="line">    <span class="keyword">let</span> landmark: <span class="type">Landmark</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">title</span>: <span class="type">String</span>? <span class="operator">=</span> <span class="literal">nil</span>,</span><br><span class="line">         <span class="params">message</span>: <span class="type">String</span>? <span class="operator">=</span> <span class="literal">nil</span>,</span><br><span class="line">         <span class="params">landmark</span>: <span class="type">Landmark</span>? <span class="operator">=</span> <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.title <span class="operator">=</span> title</span><br><span class="line">        <span class="keyword">self</span>.message <span class="operator">=</span> message</span><br><span class="line">        <span class="keyword">self</span>.landmark <span class="operator">=</span> landmark</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> landmark <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">                <span class="type">CircleImage</span>(image: landmark<span class="operator">!</span>.image.resizable())</span><br><span class="line">                    .scaledToFit()</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(title <span class="operator">??</span> <span class="string">&quot;Unknown Landmark&quot;</span>)</span><br><span class="line">                .font(.headline)</span><br><span class="line">                .lineLimit(<span class="number">0</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Divider</span>()</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(message <span class="operator">??</span> <span class="string">&quot;You are within 5 miles of one of your favorite landmarks.&quot;</span>)</span><br><span class="line">                .font(.caption)</span><br><span class="line">                .lineLimit(<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">NotificationView_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">NotificationView</span>()</span><br><span class="line">            </span><br><span class="line">            <span class="type">NotificationView</span>(title: <span class="string">&quot;Turtle Rock&quot;</span>,</span><br><span class="line">                             message: <span class="string">&quot;You are within 5 miles of Turtle Rock.&quot;</span>,</span><br><span class="line">                             landmark: <span class="type">UserData</span>().landmarks[<span class="number">0</span>])</span><br><span class="line">        &#125;</span><br><span class="line">        .previewLayout(.sizeThatFits)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/0fae9f5a08302a4a49c869bf638a2acfad4094d98c421317e921f5b2daac8d8b/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f323137366330646438622f66393033653434392d376161632d343135362d623838352d6535306132616464616636622e706e67" alt=""></p>
<h2 id="步骤2-32">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-6"></a></p>
<p>打开<code>NotificationController</code>并添加<code>landmark</code>、<code>title</code>和<code>message</code>属性。</p>
<p>这些数据存储了有关通知传入信息。</p>
<blockquote>
<p>NotificationController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> WatchKit</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UserNotifications</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NotificationController</span>: <span class="title class_ inherited__">WKUserNotificationHostingController</span>&lt;<span class="title class_ inherited__">NotificationView</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span>?</span><br><span class="line">    <span class="keyword">var</span> title: <span class="type">String</span>?</span><br><span class="line">    <span class="keyword">var</span> message: <span class="type">String</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> body: <span class="type">NotificationView</span> &#123;</span><br><span class="line">        <span class="type">NotificationView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">willActivate</span>() &#123;</span><br><span class="line">        <span class="comment">// This method is called when watch view controller is about to be visible to user</span></span><br><span class="line">        <span class="keyword">super</span>.willActivate()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">didDeactivate</span>() &#123;</span><br><span class="line">        <span class="comment">// This method is called when watch view controller is no longer visible</span></span><br><span class="line">        <span class="keyword">super</span>.didDeactivate()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">didReceive</span>(<span class="keyword">_</span> <span class="params">notification</span>: <span class="type">UNNotification</span>) &#123;</span><br><span class="line">        <span class="comment">// This method is called when a notification needs to be presented.</span></span><br><span class="line">        <span class="comment">// Implement it if you use a dynamic notification interface.</span></span><br><span class="line">        <span class="comment">// Populate your dynamic notification interface as quickly as possible.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤3-28">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-6"></a></p>
<p>更新<code>body（）</code>方法以使用这些属性。</p>
<p>此方法实例化您先前创建的通知视图。</p>
<blockquote>
<p>NotificationController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> WatchKit</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UserNotifications</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NotificationController</span>: <span class="title class_ inherited__">WKUserNotificationHostingController</span>&lt;<span class="title class_ inherited__">NotificationView</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span>?</span><br><span class="line">    <span class="keyword">var</span> title: <span class="type">String</span>?</span><br><span class="line">    <span class="keyword">var</span> message: <span class="type">String</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> body: <span class="type">NotificationView</span> &#123;</span><br><span class="line">        <span class="type">NotificationView</span>(title: title,</span><br><span class="line">            message: message,</span><br><span class="line">            landmark: landmark)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">willActivate</span>() &#123;</span><br><span class="line">        <span class="comment">// This method is called when watch view controller is about to be visible to user</span></span><br><span class="line">        <span class="keyword">super</span>.willActivate()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">didDeactivate</span>() &#123;</span><br><span class="line">        <span class="comment">// This method is called when watch view controller is no longer visible</span></span><br><span class="line">        <span class="keyword">super</span>.didDeactivate()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">didReceive</span>(<span class="keyword">_</span> <span class="params">notification</span>: <span class="type">UNNotification</span>) &#123;</span><br><span class="line">        <span class="comment">// This method is called when a notification needs to be presented.</span></span><br><span class="line">        <span class="comment">// Implement it if you use a dynamic notification interface.</span></span><br><span class="line">        <span class="comment">// Populate your dynamic notification interface as quickly as possible.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤4-27">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-6"></a></p>
<p>定义<code>LandmarkIndexKey</code>。</p>
<p>使用此键可从通知中提取地标索引。</p>
<blockquote>
<p>NotificationController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> WatchKit</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UserNotifications</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NotificationController</span>: <span class="title class_ inherited__">WKUserNotificationHostingController</span>&lt;<span class="title class_ inherited__">NotificationView</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span>?</span><br><span class="line">    <span class="keyword">var</span> title: <span class="type">String</span>?</span><br><span class="line">    <span class="keyword">var</span> message: <span class="type">String</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> landmarkIndexKey <span class="operator">=</span> <span class="string">&quot;landmarkIndex&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> body: <span class="type">NotificationView</span> &#123;</span><br><span class="line">        <span class="type">NotificationView</span>(title: title,</span><br><span class="line">            message: message,</span><br><span class="line">            landmark: landmark)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">willActivate</span>() &#123;</span><br><span class="line">        <span class="comment">// This method is called when watch view controller is about to be visible to user</span></span><br><span class="line">        <span class="keyword">super</span>.willActivate()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">didDeactivate</span>() &#123;</span><br><span class="line">        <span class="comment">// This method is called when watch view controller is no longer visible</span></span><br><span class="line">        <span class="keyword">super</span>.didDeactivate()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">didReceive</span>(<span class="keyword">_</span> <span class="params">notification</span>: <span class="type">UNNotification</span>) &#123;</span><br><span class="line">        <span class="comment">// This method is called when a notification needs to be presented.</span></span><br><span class="line">        <span class="comment">// Implement it if you use a dynamic notification interface.</span></span><br><span class="line">        <span class="comment">// Populate your dynamic notification interface as quickly as possible.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤5-16">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-4"></a></p>
<p>更新<code>didReceive（:）</code>方法以解析通知中的数据。</p>
<p>此方法更新控制器的属性。调用此方法后，系统将使控制器的body属性无效，该属性将更新导航视图。然后系统在<code>Apple Watch</code>上显示通知。</p>
<blockquote>
<p>NotificationController.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> WatchKit</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> UserNotifications</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NotificationController</span>: <span class="title class_ inherited__">WKUserNotificationHostingController</span>&lt;<span class="title class_ inherited__">NotificationView</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span>?</span><br><span class="line">    <span class="keyword">var</span> title: <span class="type">String</span>?</span><br><span class="line">    <span class="keyword">var</span> message: <span class="type">String</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> landmarkIndexKey <span class="operator">=</span> <span class="string">&quot;landmarkIndex&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> body: <span class="type">NotificationView</span> &#123;</span><br><span class="line">        <span class="type">NotificationView</span>(title: title,</span><br><span class="line">            message: message,</span><br><span class="line">            landmark: landmark)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">willActivate</span>() &#123;</span><br><span class="line">        <span class="comment">// This method is called when watch view controller is about to be visible to user</span></span><br><span class="line">        <span class="keyword">super</span>.willActivate()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">didDeactivate</span>() &#123;</span><br><span class="line">        <span class="comment">// This method is called when watch view controller is no longer visible</span></span><br><span class="line">        <span class="keyword">super</span>.didDeactivate()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">didReceive</span>(<span class="keyword">_</span> <span class="params">notification</span>: <span class="type">UNNotification</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> userData <span class="operator">=</span> <span class="type">UserData</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> notificationData <span class="operator">=</span></span><br><span class="line">            notification.request.content.userInfo <span class="keyword">as?</span> [<span class="type">String</span>: <span class="keyword">Any</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> aps <span class="operator">=</span> notificationData<span class="operator">?</span>[<span class="string">&quot;aps&quot;</span>] <span class="keyword">as?</span> [<span class="type">String</span>: <span class="keyword">Any</span>]</span><br><span class="line">        <span class="keyword">let</span> alert <span class="operator">=</span> aps<span class="operator">?</span>[<span class="string">&quot;alert&quot;</span>] <span class="keyword">as?</span> [<span class="type">String</span>: <span class="keyword">Any</span>]</span><br><span class="line">        </span><br><span class="line">        title <span class="operator">=</span> alert<span class="operator">?</span>[<span class="string">&quot;title&quot;</span>] <span class="keyword">as?</span> <span class="type">String</span></span><br><span class="line">        message <span class="operator">=</span> alert<span class="operator">?</span>[<span class="string">&quot;body&quot;</span>] <span class="keyword">as?</span> <span class="type">String</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> index <span class="operator">=</span> notificationData<span class="operator">?</span>[landmarkIndexKey] <span class="keyword">as?</span> <span class="type">Int</span> &#123;</span><br><span class="line">            landmark <span class="operator">=</span> userData.landmarks[index]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>当Apple Watch收到通知时，它会创建与通知类别关联的通知控制器。若要设置通知控制器的类别，必须打开并编辑应用程序的情节提要。</p>
</blockquote>
<h2 id="步骤6-12">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46-3"></a></p>
<p>在项目导航栏中，选择“Watch Landmarks”文件夹并打开界面<code>storyboard</code>。选择指向静态通知界面控制器的箭头。</p>
<p><img src="https://camo.githubusercontent.com/2ff42dd6b1639719775536c9667f1725a8f4048c54082b63676c0130fd0bd79b/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f396533653661653038342f37643030303236652d623164642d343830392d616635612d6436623234306566623432322e706e67" alt=""></p>
<h2 id="步骤7-5">步骤7</h2>
<p><a href="#%E6%AD%A5%E9%AA%A47-1"></a></p>
<p>在属性检查器中，将<code>Notification Category</code>的名称设置为<code>LandmarkNear</code>。</p>
<p><img src="https://camo.githubusercontent.com/4203bf25cc18a8afbde6c395f5065fffd03d54a53b2fb15d42212ece46d61a6f/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f616562353239626132342f39323838386434652d643332382d346364612d396364662d3037326364626164366265612e706e67" alt=""></p>
<blockquote>
<p>配置测试负载来使用LandmarkNear类别，并传递通知控制器期望的数据。</p>
</blockquote>
<h2 id="步骤8-4">步骤8</h2>
<p><a href="#%E6%AD%A5%E9%AA%A48-1"></a></p>
<p>选择<code>PushNotificationPayload.apns</code>文件，并更新title、body、category和landmarkIndex属性。请务必将类别设置为<code>LandmarkNear</code>。您还可以删除本教程中未使用的任何键，如<code>subtitle</code>、<code>WatchKit Simulator Actions</code>和<code>customKey</code>。</p>
<blockquote>
<p>PushNotificationPayload.apns</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;aps&quot;: &#123;</span><br><span class="line">        &quot;alert&quot;: &#123;</span><br><span class="line">            &quot;body&quot;: &quot;You are within 5 miles of Silver Salmon Creek.&quot;</span><br><span class="line">            &quot;title&quot;: &quot;Silver Salmon Creek&quot;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;category&quot;: &quot;LandmarkNear&quot;,</span><br><span class="line">        &quot;thread-id&quot;: &quot;5280&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    &quot;landmarkIndex&quot;: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>负载文件模拟远程通知中从服务器发送的数据。</p>
<h2 id="步骤9-4">步骤9</h2>
<p><a href="#%E6%AD%A5%E9%AA%A49-1"></a></p>
<p>选择“Landmarks-Watch (Notification)” scheme，并编译和运行您的应用程序。</p>
<p>第一次运行通知Scheme时，系统将请求发送通知的权限。选择<code>Allow(允许)</code>。模拟器随后显示一个可滚动的通知，其中包括：一个用于将地标应用程序标记为发送者的框、通知视图和通知操作的按钮。</p>
<p><img src="https://camo.githubusercontent.com/5e9bdcb61dafdcfe82a539a6318f43adf0ff0990568ddc411344e5b05f26f930/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f656263643133633637652f61396131333262642d616463652d343939382d393164622d6630633263313464643163332e706e67" alt=""></p>
<h3 id="应用程序设计和布局-2">应用程序设计和布局</h3>
<p><a href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%B8%83%E5%B1%80"></a></p>
<h2 id="使用UI控件">使用UI控件</h2>
<p><a href="#%E4%BD%BF%E7%94%A8ui%E6%8E%A7%E4%BB%B6"></a></p>
<p>在地标应用程序中，用户可以创建一个个人资料页来表达他们的个性。为了让用户能够更改他们的个人简介，您将添加一个编辑模式，并设计一个偏好设置页面。</p>
<p>您将使用各种用于数据输入的通用用户界面控件，并在用户保存更改时更新地标数据模型。</p>
<blockquote>
<p>学习时间：25分钟</p>
<p><a target="_blank" rel="noopener" href="https://docs-assets.developer.apple.com/published/9b7e314dba/WorkingWithUIControls.zip">下载地址：WorkingWithUIControls.zip</a></p>
</blockquote>
<h2 id="第一节-显示用户简介">第一节 显示用户简介</h2>
<p><a href="#%E7%AC%AC%E4%B8%80%E8%8A%82-%E6%98%BE%E7%A4%BA%E7%94%A8%E6%88%B7%E7%AE%80%E4%BB%8B"></a></p>
<p><code>Landmarks</code>应用程序在本地存储一些详情配置和偏好设置。在用户编辑其详情之前，它们将显示在没有任何编辑控件的摘要视图中。</p>
<p><img src="https://camo.githubusercontent.com/c6e0255cc6cf7621c378c8e10b76a20f5471d4904d56a158291073a788ff4ac0/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f626664393235336532642f36393961356631322d636638612d343936342d383666642d6463303065313331653333302e706e67" alt=""></p>
<h2 id="步骤1-32">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41"></a></p>
<p>要开始，请在<code>Landmarks</code>目录下创建一个名为<code>Profile</code>的新目录，然后将名为<code>ProfileHost</code>的视图添加到该目录中。</p>
<p><code>ProfileHost</code>视图将同时承载用户信息的静态摘要视图和编辑模式。</p>
<blockquote>
<p>ProfileHost.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> draftProfile <span class="operator">=</span> <span class="type">Profile</span>.default</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Profile for: <span class="subst">\(draftProfile.username)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileHost</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/dc751f03ab8bf316b49e867e58b74d1def84ba36dd929506cde9559755e064bd/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663034323966613466302f37643238353632392d353833372d343838332d383464332d3336613831636138646662322e706e67" alt=""></p>
<h2 id="步骤2-33">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42"></a></p>
<p>将<code>Home.swift</code>中的静态文本替换为上一步中创建的<code>ProfileHost</code>。</p>
<p>现在，主屏幕上的<code>profile</code>按钮将以模态方式展现用户简介。</p>
<blockquote>
<p>Home.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> categories: [<span class="type">String</span>: [<span class="type">Landmark</span>]] &#123;</span><br><span class="line">        <span class="type">Dictionary</span>(</span><br><span class="line">            grouping: landmarkData,</span><br><span class="line">            by: &#123; <span class="variable">$0</span>.category.rawValue &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> featured: [<span class="type">Landmark</span>] &#123;</span><br><span class="line">        landmarkData.filter &#123; <span class="variable">$0</span>.isFeatured &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showingProfile <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> profileButton: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span>(action: &#123; <span class="keyword">self</span>.showingProfile.toggle() &#125;) &#123;</span><br><span class="line">            <span class="type">Image</span>(systemName: <span class="string">&quot;person.crop.circle&quot;</span>)</span><br><span class="line">                .imageScale(.large)</span><br><span class="line">                .accessibility(label: <span class="type">Text</span>(<span class="string">&quot;User Profile&quot;</span>))</span><br><span class="line">                .padding()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">FeaturedLandmarks</span>(landmarks: featured)</span><br><span class="line">                    .scaledToFill()</span><br><span class="line">                    .frame(height: <span class="number">200</span>)</span><br><span class="line">                    .clipped()</span><br><span class="line">                    .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">                </span><br><span class="line">                <span class="type">ForEach</span>(categories.keys.sorted(), id: \.<span class="keyword">self</span>) &#123; key <span class="keyword">in</span></span><br><span class="line">                    <span class="type">CategoryRow</span>(categoryName: key, items: <span class="keyword">self</span>.categories[key]<span class="operator">!</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                .listRowInsets(<span class="type">EdgeInsets</span>())</span><br><span class="line">                </span><br><span class="line">                <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkList</span>()) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;See All&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Featured&quot;</span>))</span><br><span class="line">            .navigationBarItems(trailing: profileButton)</span><br><span class="line">            .sheet(isPresented: <span class="variable">$showingProfile</span>) &#123;</span><br><span class="line">                <span class="type">ProfileHost</span>()</span><br><span class="line">                    .environmentObject(<span class="keyword">self</span>.userData)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FeaturedLandmarks</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmarks: [<span class="type">Landmark</span>]</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        landmarks[<span class="number">0</span>].image.resizable()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CategoryHome_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">CategoryHome</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/7d80dac1796c14d563b5ce1f5cdf150d623238ddcc3d3354d1a011ffd5e5943e/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f303434356634646233312f32366365353664312d303137362d343238632d396632332d3565623939353232346638322e706e67" alt=""></p>
<h2 id="步骤3-29">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43"></a></p>
<p>创建一个名为<code>ProfileSummary</code>的新视图，该视图接受一个<code>Profile</code>实例并显示一些基本的用户信息。</p>
<p><code>ProfileSummary</code>持有一个<code>Profile</code>，比个人简介持有它好，因为父视图<code>ProfileHost</code>管理此视图的<code>State</code>。</p>
<blockquote>
<p>ProfileSummary.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileSummary</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> profile: <span class="type">Profile</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> goalFormat: <span class="type">DateFormatter</span> <span class="operator">=</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> formatter <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">        formatter.dateStyle <span class="operator">=</span> .long</span><br><span class="line">        formatter.timeStyle <span class="operator">=</span> .none</span><br><span class="line">        <span class="keyword">return</span> formatter</span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(profile.username)</span><br><span class="line">                .bold()</span><br><span class="line">                .font(.title)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Notifications: <span class="subst">\(<span class="keyword">self</span>.profile.prefersNotifications <span class="operator">?</span> <span class="string">&quot;On&quot;</span>: <span class="string">&quot;Off&quot;</span> )</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Seasonal Photos: <span class="subst">\(<span class="keyword">self</span>.profile.seasonalPhoto.rawValue)</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Goal Date: <span class="subst">\(<span class="keyword">self</span>.profile.goalDate, formatter: <span class="keyword">Self</span>.goalFormat)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileSummary_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileSummary</span>(profile: <span class="type">Profile</span>.default)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/35202ca2396b10ec362f296622b16f36b22316be660c75233236e35f0d4cd954/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f333432613635343461652f39633838366562392d616363642d343363312d396161652d3930356336646335366233622e706e67" alt=""></p>
<h2 id="步骤4-28">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44"></a></p>
<p>更新<code>ProfileHost</code>以显示新的摘要视图。</p>
<blockquote>
<p>ProfileHost.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> draftProfile <span class="operator">=</span> <span class="type">Profile</span>.default</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="type">ProfileSummary</span>(profile: draftProfile)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileHost</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/f0622abcb1d191737b5d9182be9cdf5567354f360fe14c3f6417c092f78355fd/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f326666376439333961622f35383030653861362d343130392d346533302d623663372d3834306665383337363232302e706e67" alt=""></p>
<h2 id="步骤5-17">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45"></a></p>
<p>创建一个名为<code>HikeBadge</code> 的新视图，该视图由<a target="_blank" rel="noopener" href="https://github.com/ly918/SwiftUI-Chinese-Documents/wiki/01-Drawing-Paths-and-Shapes">绘制路径和形状</a>中制作的徽章以及徒步旅行的一些数据文本组成。</p>
<p>徽章只是一个图形，因此<code>HikeBadge</code>中的文本和<code>accessibility(label:)</code> 修饰符使徽章的含义对其他用户更清晰。</p>
<p><em><strong>注意：</strong></em></p>
<p>两次调用<code>frame(width:height:)</code>修饰符，使徽章以其设计时的尺寸300×300点进行缩放渲染。</p>
<blockquote>
<p>HikeBadge.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeBadge</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .center) &#123;</span><br><span class="line">            <span class="type">Badge</span>()</span><br><span class="line">                .frame(width: <span class="number">300</span>, height: <span class="number">300</span>)</span><br><span class="line">                .scaleEffect(<span class="number">1.0</span> <span class="operator">/</span> <span class="number">3.0</span>)</span><br><span class="line">                .frame(width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line">            <span class="type">Text</span>(name)</span><br><span class="line">                .font(.caption)</span><br><span class="line">                .accessibility(label: <span class="type">Text</span>(<span class="string">&quot;Badge for <span class="subst">\(name)</span>.&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HikeBadge_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HikeBadge</span>(name: <span class="string">&quot;Preview Testing&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/111ef1c72951f8fac61e410a18cbee9dca47ead17575da16f0974afb465b38d4/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f323262316564663131332f32656438626262352d393438302d343539302d386238302d3337353430386666316466302e706e67" alt=""></p>
<h2 id="步骤6-13">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46"></a></p>
<p>更新<code>ProfileSummary</code>以添加不同颜色的徽章以及获得徽章的原因文字。</p>
<blockquote>
<p>ProfileSummary.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileSummary</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> profile: <span class="type">Profile</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> goalFormat: <span class="type">DateFormatter</span> <span class="operator">=</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> formatter <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">        formatter.dateStyle <span class="operator">=</span> .long</span><br><span class="line">        formatter.timeStyle <span class="operator">=</span> .none</span><br><span class="line">        <span class="keyword">return</span> formatter</span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(profile.username)</span><br><span class="line">                .bold()</span><br><span class="line">                .font(.title)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Notifications: <span class="subst">\(<span class="keyword">self</span>.profile.prefersNotifications <span class="operator">?</span> <span class="string">&quot;On&quot;</span>: <span class="string">&quot;Off&quot;</span> )</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Seasonal Photos: <span class="subst">\(<span class="keyword">self</span>.profile.seasonalPhoto.rawValue)</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Goal Date: <span class="subst">\(<span class="keyword">self</span>.profile.goalDate, formatter: <span class="keyword">Self</span>.goalFormat)</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Completed Badges&quot;</span>)</span><br><span class="line">                    .font(.headline)</span><br><span class="line">                <span class="type">ScrollView</span> &#123;</span><br><span class="line">                    <span class="type">HStack</span> &#123;</span><br><span class="line">                        <span class="type">HikeBadge</span>(name: <span class="string">&quot;First Hike&quot;</span>)</span><br><span class="line">                        </span><br><span class="line">                        <span class="type">HikeBadge</span>(name: <span class="string">&quot;Earth Day&quot;</span>)</span><br><span class="line">                            .hueRotation(<span class="type">Angle</span>(degrees: <span class="number">90</span>))</span><br><span class="line">                        </span><br><span class="line">                        </span><br><span class="line">                        <span class="type">HikeBadge</span>(name: <span class="string">&quot;Tenth Hike&quot;</span>)</span><br><span class="line">                            .grayscale(<span class="number">0.5</span>)</span><br><span class="line">                            .hueRotation(<span class="type">Angle</span>(degrees: <span class="number">45</span>))</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                .frame(height: <span class="number">140</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileSummary_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileSummary</span>(profile: <span class="type">Profile</span>.default)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/6e1242822670a46d172d861abdf601e520c6f3a36c3c338fa2c3da6a0cc835a5/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f376363396662663531312f38626135623366372d393436642d343637652d386665322d6637303062646161346463352e706e67" alt=""></p>
<h2 id="步骤7-6">步骤7</h2>
<p><a href="#%E6%AD%A5%E9%AA%A47"></a></p>
<p>通过引入<a target="_blank" rel="noopener" href="https://github.com/ly918/SwiftUI-Chinese-Documents/wiki/02-Animating-Views-and-Transitions">视图动画与转场</a>的<code>HikeView</code>来完成<code>ProfileSummary</code>。</p>
<blockquote>
<p>ProfileSummary.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileSummary</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> profile: <span class="type">Profile</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> goalFormat: <span class="type">DateFormatter</span> <span class="operator">=</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> formatter <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">        formatter.dateStyle <span class="operator">=</span> .long</span><br><span class="line">        formatter.timeStyle <span class="operator">=</span> .none</span><br><span class="line">        <span class="keyword">return</span> formatter</span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(profile.username)</span><br><span class="line">                .bold()</span><br><span class="line">                .font(.title)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Notifications: <span class="subst">\(<span class="keyword">self</span>.profile.prefersNotifications <span class="operator">?</span> <span class="string">&quot;On&quot;</span>: <span class="string">&quot;Off&quot;</span> )</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Seasonal Photos: <span class="subst">\(<span class="keyword">self</span>.profile.seasonalPhoto.rawValue)</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Goal Date: <span class="subst">\(<span class="keyword">self</span>.profile.goalDate, formatter: <span class="keyword">Self</span>.goalFormat)</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Completed Badges&quot;</span>)</span><br><span class="line">                    .font(.headline)</span><br><span class="line">                <span class="type">ScrollView</span> &#123;</span><br><span class="line">                    <span class="type">HStack</span> &#123;</span><br><span class="line">                        <span class="type">HikeBadge</span>(name: <span class="string">&quot;First Hike&quot;</span>)</span><br><span class="line">                        </span><br><span class="line">                        <span class="type">HikeBadge</span>(name: <span class="string">&quot;Earth Day&quot;</span>)</span><br><span class="line">                            .hueRotation(<span class="type">Angle</span>(degrees: <span class="number">90</span>))</span><br><span class="line">                        </span><br><span class="line">                        </span><br><span class="line">                        <span class="type">HikeBadge</span>(name: <span class="string">&quot;Tenth Hike&quot;</span>)</span><br><span class="line">                            .grayscale(<span class="number">0.5</span>)</span><br><span class="line">                            .hueRotation(<span class="type">Angle</span>(degrees: <span class="number">45</span>))</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                .frame(height: <span class="number">140</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Recent Hikes&quot;</span>)</span><br><span class="line">                    .font(.headline)</span><br><span class="line">            </span><br><span class="line">                <span class="type">HikeView</span>(hike: hikeData[<span class="number">0</span>])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileSummary_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileSummary</span>(profile: <span class="type">Profile</span>.default)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/be5f3e3a6ac062ed689f93e9ac2f2b624e1ba24a06b4de7da1fc47bd61a5a8fa/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f326332343930656132622f64356239376331662d353064382d346339362d616364622d3038646338366662646633632e706e67" alt=""></p>
<h2 id="第二节-添加编辑模式">第二节 添加编辑模式</h2>
<p><a href="#%E7%AC%AC%E4%BA%8C%E8%8A%82-%E6%B7%BB%E5%8A%A0%E7%BC%96%E8%BE%91%E6%A8%A1%E5%BC%8F"></a></p>
<p>用户需要在查看或编辑其简介详情之间切换。您将添加一个编辑模式，通过向现有的<code>ProfileHost</code>添加一个<code>EditButton</code>，然后创建一个带有控件的视图，用于编辑单个数据。</p>
<p><img src="https://camo.githubusercontent.com/d6ab975fb258a886c7c0895e93383a0eafb7910d3d550d8b19e92145998182d2/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f633864333432643434622f38306437343066392d363633652d346436332d623036352d3964653139336566366362332e706e67" alt=""></p>
<h2 id="步骤1-33">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-1"></a></p>
<p>添加一个<code>Environment</code>属性，并设置<code>\.editMode</code>。</p>
<p>可以使用此属性读取和写入当前编辑范围。</p>
<blockquote>
<p>ProfileHost.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@Environment</span>(\.editMode) <span class="keyword">var</span> mode</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> draftProfile <span class="operator">=</span> <span class="type">Profile</span>.default</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="type">ProfileSummary</span>(profile: draftProfile)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileHost</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/6dea1a87c22691c7a43a0a50e0be144f2bcdc8e27b3732191cb4b9fe4dbdc897/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f623065663766383639302f33613533396366322d323561392d346530662d383562352d3964386539306664313165372e706e67" alt=""></p>
<h2 id="步骤2-34">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-1"></a></p>
<p>创建一个编辑按钮，用于打开和关闭环境的编辑模式。</p>
<blockquote>
<p>ProfileHost.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@Environment</span>(\.editMode) <span class="keyword">var</span> mode</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> draftProfile <span class="operator">=</span> <span class="type">Profile</span>.default</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">EditButton</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">ProfileSummary</span>(profile: draftProfile)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileHost</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/931200989845ec40b8559d1573d5fdc574eae47f5495278a32cbafc2c9e07c15/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f343266646661333261382f39346262613361382d663230362d343564642d396165652d6361643134303361343236312e706e67" alt=""></p>
<h2 id="步骤3-30">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-1"></a></p>
<p>更新<code>UserData</code>类以包含用户简介的实例，该实例在用户关闭简介视图后仍然存在。</p>
<blockquote>
<p>UserData.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">UserData</span>: <span class="title class_ inherited__">ObservableObject</span> &#123;</span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">var</span> showFavoritesOnly <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">var</span> landmarks <span class="operator">=</span> landmarkData</span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">var</span> profile <span class="operator">=</span> <span class="type">Profile</span>.default</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤4-29">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-1"></a></p>
<p>从<code>Environment</code>中读取<code>Profile</code>数据，将数据的控制权传递给<code>ProfileHost</code> 。</p>
<p>为了避免在确认编辑之前更新全局应用程序状态（例如当用户输入其名称时），编辑视图将对其自身的副本进行操作。</p>
<blockquote>
<p>ProfileHost.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@Environment</span>(\.editMode) <span class="keyword">var</span> mode</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> draftProfile <span class="operator">=</span> <span class="type">Profile</span>.default</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">EditButton</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">ProfileSummary</span>(profile: draftProfile)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileHost</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/931200989845ec40b8559d1573d5fdc574eae47f5495278a32cbafc2c9e07c15/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f343266646661333261382f39346262613361382d663230362d343564642d396165652d6361643134303361343236312e706e67" alt=""></p>
<h2 id="步骤5-18">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-1"></a></p>
<p>添加条件视图，显示静态简介视图或编辑模式视图。</p>
<p><em>注意</em></p>
<p>目前，编辑模式只是一个静态文本字段。</p>
<blockquote>
<p>ProfileHost.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@Environment</span>(\.editMode) <span class="keyword">var</span> mode</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> draftProfile <span class="operator">=</span> <span class="type">Profile</span>.default</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">EditButton</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>.mode<span class="operator">?</span>.wrappedValue <span class="operator">==</span> .inactive &#123;</span><br><span class="line">                <span class="type">ProfileSummary</span>(profile: userData.profile)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Profile Editor&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileHost</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/931200989845ec40b8559d1573d5fdc574eae47f5495278a32cbafc2c9e07c15/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f343266646661333261382f39346262613361382d663230362d343564642d396165652d6361643134303361343236312e706e67" alt=""></p>
<h2 id="第三节-定义用户简介编辑器">第三节 定义用户简介编辑器</h2>
<p><a href="#%E7%AC%AC%E4%B8%89%E8%8A%82-%E5%AE%9A%E4%B9%89%E7%94%A8%E6%88%B7%E7%AE%80%E4%BB%8B%E7%BC%96%E8%BE%91%E5%99%A8"></a></p>
<p>用户简介编辑器主要由不同的控件组成，这些控件更改用户简介中的各个详情信息。配置文件中的某些项目（如徽章）不可由用户编辑，因此它们不会显示在编辑器中。</p>
<p>为了与信息摘要保持一致，您将在编辑器中按相同的顺序添加概要文件详情信息。</p>
<p><img src="https://camo.githubusercontent.com/0cac9efdd06c38a735f0c38cd6d8b3624e86f908deb65ee01044a87728e4200b/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f396335613437613962322f37333730366661322d616566392d343633622d393966382d3133373835333731336161352e706e67" alt=""></p>
<h2 id="步骤1-34">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-2"></a></p>
<p>创建一个名为<code>ProfileEditor</code>的新视图，并包含对用户简介副本的绑定。</p>
<p>视图中的第一个控件是一个<code>TextField</code>，它控制并更新一个字符串的绑定，是用户选择的显示名称。当创建<code>TextField</code>时，您需要提供标签和字符串的绑定。</p>
<blockquote>
<p>ProfileEditor.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileEditor</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> profile: <span class="type">Profile</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Username&quot;</span>).bold()</span><br><span class="line">                <span class="type">Divider</span>()</span><br><span class="line">                <span class="type">TextField</span>(<span class="string">&quot;Username&quot;</span>, text: <span class="variable">$profile</span>.username)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileEditor_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileEditor</span>(profile: .constant(.default))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/e0b433f59437ef51e48017738bf4c32f4e2d5a0a8fe7fb42a3988e4aa31db299/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f353164333566386637372f35353630646134622d353263622d346566332d396135612d6562663165656536323362312e706e67" alt=""></p>
<h2 id="步骤2-35">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-2"></a></p>
<p>更新<code>ProfileHost</code>中的条件内容，使其包含<code>Profile Editor</code>，并传递简介信息的绑定。</p>
<p>现在，单击“Edit”时将显示“简介编辑视图”。</p>
<blockquote>
<p>ProfileHost.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@Environment</span>(\.editMode) <span class="keyword">var</span> mode</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> draftProfile <span class="operator">=</span> <span class="type">Profile</span>.default</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">EditButton</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>.mode<span class="operator">?</span>.wrappedValue <span class="operator">==</span> .inactive &#123;</span><br><span class="line">                <span class="type">ProfileSummary</span>(profile: userData.profile)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">ProfileEditor</span>(profile: <span class="variable">$draftProfile</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileHost</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/931200989845ec40b8559d1573d5fdc574eae47f5495278a32cbafc2c9e07c15/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f343266646661333261382f39346262613361382d663230362d343564642d396165652d6361643134303361343236312e706e67" alt=""></p>
<h2 id="步骤3-31">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-2"></a></p>
<p>添加是否接收地标相关事件通知的开关。</p>
<p><code>Toggles</code>是只有打开或关闭的控件，因此它们非常适合布尔值<code>Boolean</code>，如“yes”或“no”的设置。</p>
<blockquote>
<p>ProfileEditor.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileEditor</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> profile: <span class="type">Profile</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Username&quot;</span>).bold()</span><br><span class="line">                <span class="type">Divider</span>()</span><br><span class="line">                <span class="type">TextField</span>(<span class="string">&quot;Username&quot;</span>, text: <span class="variable">$profile</span>.username)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">Toggle</span>(isOn: <span class="variable">$profile</span>.prefersNotifications) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Enable Notifications&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileEditor_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileEditor</span>(profile: .constant(.default))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/0fad353c21b0b7997add4d2553a0f3453b2b09808dea3dd9c79f1552020a79a0/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663831373539336236662f36383235303337312d633531332d346534632d386430642d6134663535323433346238372e706e67" alt=""></p>
<h2 id="步骤4-30">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-2"></a></p>
<p>将<code>Picker</code>控件及其标签放置在<code>VStack</code>中，使地标照片具有可选择的季节。</p>
<blockquote>
<p>ProfileEditor.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileEditor</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> profile: <span class="type">Profile</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Username&quot;</span>).bold()</span><br><span class="line">                <span class="type">Divider</span>()</span><br><span class="line">                <span class="type">TextField</span>(<span class="string">&quot;Username&quot;</span>, text: <span class="variable">$profile</span>.username)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">Toggle</span>(isOn: <span class="variable">$profile</span>.prefersNotifications) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Enable Notifications&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Seasonal Photo&quot;</span>).bold()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Picker</span>(<span class="string">&quot;Seasonal Photo&quot;</span>, selection: <span class="variable">$profile</span>.seasonalPhoto) &#123;</span><br><span class="line">                    <span class="type">ForEach</span>(<span class="type">Profile</span>.<span class="type">Season</span>.allCases, id: \.<span class="keyword">self</span>) &#123; season <span class="keyword">in</span></span><br><span class="line">                        <span class="type">Text</span>(season.rawValue).tag(season)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                .pickerStyle(<span class="type">SegmentedPickerStyle</span>())</span><br><span class="line">            &#125;</span><br><span class="line">            .padding(.top)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileEditor_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileEditor</span>(profile: .constant(.default))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/5f7fb44f5decb629bc6fe906c174209684246778e3d78e8017fcea558bbdcea0/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f346466326462643037662f38616232653066362d343932662d346634372d616463382d3330386561333761656439342e706e67" alt=""></p>
<h2 id="步骤5-19">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45-2"></a></p>
<p>最后，在季节选择器下面添加一个<code>DatePicker</code>，修改到达地标的日期。</p>
<blockquote>
<p>ProfileEditor.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileEditor</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> profile: <span class="type">Profile</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> dateRange: <span class="type">ClosedRange</span>&lt;<span class="type">Date</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> min <span class="operator">=</span> <span class="type">Calendar</span>.current.date(byAdding: .year, value: <span class="operator">-</span><span class="number">1</span>, to: profile.goalDate)<span class="operator">!</span></span><br><span class="line">        <span class="keyword">let</span> max <span class="operator">=</span> <span class="type">Calendar</span>.current.date(byAdding: .year, value: <span class="number">1</span>, to: profile.goalDate)<span class="operator">!</span></span><br><span class="line">        <span class="keyword">return</span> min<span class="operator">...</span>max</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Username&quot;</span>).bold()</span><br><span class="line">                <span class="type">Divider</span>()</span><br><span class="line">                <span class="type">TextField</span>(<span class="string">&quot;Username&quot;</span>, text: <span class="variable">$profile</span>.username)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">Toggle</span>(isOn: <span class="variable">$profile</span>.prefersNotifications) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Enable Notifications&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Seasonal Photo&quot;</span>).bold()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Picker</span>(<span class="string">&quot;Seasonal Photo&quot;</span>, selection: <span class="variable">$profile</span>.seasonalPhoto) &#123;</span><br><span class="line">                    <span class="type">ForEach</span>(<span class="type">Profile</span>.<span class="type">Season</span>.allCases, id: \.<span class="keyword">self</span>) &#123; season <span class="keyword">in</span></span><br><span class="line">                        <span class="type">Text</span>(season.rawValue).tag(season)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                .pickerStyle(<span class="type">SegmentedPickerStyle</span>())</span><br><span class="line">            &#125;</span><br><span class="line">            .padding(.top)</span><br><span class="line">            </span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Goal Date&quot;</span>).bold()</span><br><span class="line">                <span class="type">DatePicker</span>(</span><br><span class="line">                    <span class="string">&quot;Goal Date&quot;</span>,</span><br><span class="line">                    selection: <span class="variable">$profile</span>.goalDate,</span><br><span class="line">                    in: dateRange,</span><br><span class="line">                    displayedComponents: .date)</span><br><span class="line">            &#125;</span><br><span class="line">            .padding(.top)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileEditor_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileEditor</span>(profile: .constant(.default))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/53f34a34ae2f171abbf31a50e92687bffe0bcb94780ddbb3149d1409f9cfc9ce/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f323236356630663038642f38656639306461352d313135392d346339332d393836392d6535643038623336613864392e706e67" alt=""></p>
<h2 id="第四节-延迟编辑传递">第四节 延迟编辑传递</h2>
<p><a href="#%E7%AC%AC%E5%9B%9B%E8%8A%82-%E5%BB%B6%E8%BF%9F%E7%BC%96%E8%BE%91%E4%BC%A0%E9%80%92"></a></p>
<p>要使其编辑，直到用户退出编辑模式后才生效，在编辑过程中使用其<code>Profile</code>的草稿副本，然后仅当用户确认编辑时才将草稿副本分配给真实副本。</p>
<p><img src="https://camo.githubusercontent.com/ba8bb301954e5d24b756a85cd53bb19c0d2b7d34bd309f80cecb607c120931df/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f336233616333366261322f30393433616661362d646434662d343938662d386461342d3837393031636362356531352e706e67" alt=""></p>
<h2 id="步骤1-35">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-3"></a></p>
<p>向<code>ProfileHost</code>添加取消按钮。</p>
<p>与<code>EditButton</code>提供的<code>Done</code>按钮不同，<code>Cancel</code>按钮不会将编辑应用于其闭包中的真实<code>Profile</code>数据。</p>
<blockquote>
<p>ProfileHost.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@Environment</span>(\.editMode) <span class="keyword">var</span> mode</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> draftProfile <span class="operator">=</span> <span class="type">Profile</span>.default</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">self</span>.mode<span class="operator">?</span>.wrappedValue <span class="operator">==</span> .active &#123;</span><br><span class="line">                    <span class="type">Button</span>(<span class="string">&quot;Cancel&quot;</span>) &#123;</span><br><span class="line">                        <span class="keyword">self</span>.draftProfile <span class="operator">=</span> <span class="keyword">self</span>.userData.profile</span><br><span class="line">                        <span class="keyword">self</span>.mode<span class="operator">?</span>.animation().wrappedValue <span class="operator">=</span> .inactive</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">EditButton</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>.mode<span class="operator">?</span>.wrappedValue <span class="operator">==</span> .inactive &#123;</span><br><span class="line">                <span class="type">ProfileSummary</span>(profile: userData.profile)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">ProfileEditor</span>(profile: <span class="variable">$draftProfile</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileHost</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/9cf7616ad8ad548a13328cdc59bc8e4150d63d4dc75b3ada23ea9d3707b25455/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f313663393663323531342f33323165303362622d373233372d346231302d616637362d3930633936313566653637322e706e67" alt=""></p>
<h2 id="步骤2-36">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-3"></a></p>
<p>应用<code>onAppear（perform:）</code>和<code>onDisappear（perform:）</code>修饰符，将正确的用户简介数据填充给编辑器，并在用户点击<code>Done</code>按钮时更新简介数据。</p>
<p>否则，在下次激活编辑模式时显示旧值。</p>
<blockquote>
<p>ProfileHost.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@Environment</span>(\.editMode) <span class="keyword">var</span> mode</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> draftProfile <span class="operator">=</span> <span class="type">Profile</span>.default</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">self</span>.mode<span class="operator">?</span>.wrappedValue <span class="operator">==</span> .active &#123;</span><br><span class="line">                    <span class="type">Button</span>(<span class="string">&quot;Cancel&quot;</span>) &#123;</span><br><span class="line">                        <span class="keyword">self</span>.draftProfile <span class="operator">=</span> <span class="keyword">self</span>.userData.profile</span><br><span class="line">                        <span class="keyword">self</span>.mode<span class="operator">?</span>.animation().wrappedValue <span class="operator">=</span> .inactive</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="type">EditButton</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>.mode<span class="operator">?</span>.wrappedValue <span class="operator">==</span> .inactive &#123;</span><br><span class="line">                <span class="type">ProfileSummary</span>(profile: userData.profile)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">ProfileEditor</span>(profile: <span class="variable">$draftProfile</span>)</span><br><span class="line">                    .onAppear &#123;</span><br><span class="line">                        <span class="keyword">self</span>.draftProfile <span class="operator">=</span> <span class="keyword">self</span>.userData.profile</span><br><span class="line">                    &#125;</span><br><span class="line">                    .onDisappear &#123;</span><br><span class="line">                        <span class="keyword">self</span>.userData.profile <span class="operator">=</span> <span class="keyword">self</span>.draftProfile</span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ProfileHost_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ProfileHost</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="处理用户输入">处理用户输入</h2>
<p><a href="#%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5"></a></p>
<p>在<code>Landmarks</code>应用程序中，用户可以标记他们最喜欢的位置，并筛选列表来仅仅显示他们最喜欢的位置。要创建此功能，首先要向列表中添加一个开关，以便用户只关注他们的收藏夹，然后添加一个星形按钮，用户点击该按钮可将地标标记到收藏夹。</p>
<blockquote>
<p>学习时间：20分钟</p>
<p><a target="_blank" rel="noopener" href="https://docs-assets.developer.apple.com/published/771290d0bd/HandlingUserInput.zip">下载示例：HandlingUserInput.zip</a></p>
</blockquote>
<h2 id="第一节-标记用户最喜欢的地标">第一节 标记用户最喜欢的地标</h2>
<p><a href="#%E7%AC%AC%E4%B8%80%E8%8A%82-%E6%A0%87%E8%AE%B0%E7%94%A8%E6%88%B7%E6%9C%80%E5%96%9C%E6%AC%A2%E7%9A%84%E5%9C%B0%E6%A0%87"></a></p>
<p>从优化列表开始，让用户一目了然地看到他们的最爱。为每个显示最喜欢的地标行添加一个星。</p>
<p><img src="https://camo.githubusercontent.com/4aa651ebee6d81f607e9bee34a34506164ffc48c8f17ea132c641f4e5c8ecf78/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f616261313761363135392f31626639656633392d616563312d343439612d626266362d3461353161643134626261652e706e67" alt=""></p>
<h2 id="步骤1-36">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41"></a></p>
<p>打开Xcode项目，然后在项目导航器中选择<code>LandmarkRow.swift</code>。</p>
<p><img src="https://camo.githubusercontent.com/b5ee6c4f665c8054ed2808428326c4d6662057bee79047e2cc67af6e6c155a0e/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f346464646463666363652f38613830303966382d333938382d343239342d613364362d6434303666656361343162392e706e67" alt=""></p>
<h2 id="步骤2-37">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42"></a></p>
<p>在<code>Spacer()</code>之后，在<code>if</code>语句中添加一个星星<code>Image</code>，用来测试当前地标是否被收藏。</p>
<p>在<code>SwiftUI</code>语句块中，使用<code>if</code>语句有条件地包含视图。</p>
<blockquote>
<p>LandmarkRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            landmark.image</span><br><span class="line">                .resizable()</span><br><span class="line">                .frame(width: <span class="number">50</span>, height: <span class="number">50</span>)</span><br><span class="line">            <span class="type">Text</span>(landmark.name)</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> landmark.isFavorite &#123;</span><br><span class="line">                <span class="type">Image</span>(systemName: <span class="string">&quot;star.fill&quot;</span>)</span><br><span class="line">                    .imageScale(.medium)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">1</span>])</span><br><span class="line">        &#125;</span><br><span class="line">        .previewLayout(.fixed(width: <span class="number">300</span>, height: <span class="number">70</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/fbfdfba69de187370146be22b42b87895b2f65aaada5b3166b57e77ad5588d96/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f356533626437306461662f62353138333261382d313439632d343264642d613731632d6532373866623432386561352e706e67" alt=""></p>
<h2 id="步骤3-32">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43"></a></p>
<p>由于系统图像是基于矢量的，因此可以使用<code>foregroundColor(_:)</code>修改器更改其颜色。</p>
<p>当地标的<code>isFavorite</code>属性为<code>true</code>时，星星就出现了。您将在本教程后面看到如何修改该属性。</p>
<blockquote>
<p>LandmarkRow.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            landmark.image</span><br><span class="line">                .resizable()</span><br><span class="line">                .frame(width: <span class="number">50</span>, height: <span class="number">50</span>)</span><br><span class="line">            <span class="type">Text</span>(landmark.name)</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> landmark.isFavorite &#123;</span><br><span class="line">                <span class="type">Image</span>(systemName: <span class="string">&quot;star.fill&quot;</span>)</span><br><span class="line">                    .imageScale(.medium)</span><br><span class="line">                    .foregroundColor(.yellow)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkRow_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">            <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">1</span>])</span><br><span class="line">        &#125;</span><br><span class="line">        .previewLayout(.fixed(width: <span class="number">300</span>, height: <span class="number">70</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/cc381bdda5a2ed09d939fc572dce85556290d5a4de0734734e0ec42e180bf500/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f323936663738343265362f35623964346433322d653165372d343336302d386439302d3735303736373561633137312e706e67" alt=""></p>
<h2 id="第二节-筛选列表视图">第二节 筛选列表视图</h2>
<p><a href="#%E7%AC%AC%E4%BA%8C%E8%8A%82-%E7%AD%9B%E9%80%89%E5%88%97%E8%A1%A8%E8%A7%86%E5%9B%BE"></a></p>
<p>您可以自定义列表视图，使其显示所有地标，或仅显示用户的收藏夹。为此，需要向<code>LandmarkList</code>类型添加<code>@State</code>。</p>
<p><code>@State</code>是一个值或一组值，可以随时间变化，并影响视图的行为、内容或布局。使用带有<code>@State</code>的属性将其添加到视图中。</p>
<p><img src="https://camo.githubusercontent.com/993c19c2ccd5c1576da45a2874e7e720ccfafac224f1bc41460a6ef299062cac/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f613536633730363461392f36303065356234632d643763372d343464632d386330612d3634326639316231353131372e706e67" alt=""></p>
<h2 id="步骤1-37">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-1"></a></p>
<p>在项目导航器中选择<code>LandmarkList.swift</code>。将名为<code>showFavoritesOnly</code>的<code>@State</code>属性添加到<code>LandmarkList</code>，其初始值设置为<code>false</code>。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showFavoritesOnly <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                    <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d9e7a2f4df6532c16478858c7ac5fb747e2b7cce72b4870b005aa83cf10b84fa/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f386633363332623561362f37323338653637622d343130352d343063342d396237372d3066666633373535363934622e706e67" alt=""></p>
<h2 id="步骤2-38">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-1"></a></p>
<p>单击“Resume”按钮刷新画布。</p>
<p>当您对视图的结构进行更改（如添加或修改属性）时，需要手动刷新画布。</p>
<p><img src="https://camo.githubusercontent.com/5aca50837582794c53801557c660bfbff1dfcf7f63a32ef319ba404a38abae1c/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f663239623761393030382f65343364363039312d643238612d343433372d396231622d3062643566376664656533382e706e67" alt=""></p>
<h2 id="步骤3-33">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-1"></a></p>
<p>通过检查<code>showFavoritesOnly</code>属性和每个<code>landmark.isFavorite</code>值筛选地标列表。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showFavoritesOnly <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                    <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                        <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/d9e7a2f4df6532c16478858c7ac5fb747e2b7cce72b4870b005aa83cf10b84fa/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f386633363332623561362f37323338653637622d343130352d343063342d396237372d3066666633373535363934622e706e67" alt=""></p>
<h2 id="第三节-添加控件以切换状态">第三节 添加控件以切换状态</h2>
<p><a href="#%E7%AC%AC%E4%B8%89%E8%8A%82-%E6%B7%BB%E5%8A%A0%E6%8E%A7%E4%BB%B6%E4%BB%A5%E5%88%87%E6%8D%A2%E7%8A%B6%E6%80%81"></a></p>
<p>要让用户控制列表的筛选器，需要添加一个控件，该控件可以单独更改<code>showFavoritesOnly</code>的值。通过绑定<code>toggle</code>控件来完成此操作。</p>
<p>绑定是对可变状态的引用。当用户从关闭切换到打开，然后再次关闭时，控件使用绑定相应地更新视图的状态。</p>
<p><img src="https://camo.githubusercontent.com/a67258caf2144ecc7ee1f4c04114a2eca407d5565529eda103eff177a46308c7/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f613630666538303030302f34646662386564632d663334362d346532612d623939382d3637373731356330663133662e706e67" alt=""></p>
<h2 id="步骤1-38">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-2"></a></p>
<p>将行嵌套到<code>ForEach</code>中。</p>
<p>若要在列表中组合静态视图和动态视图，或组合两个或多个不同的动态视图组，请使用<code>ForEach</code>类型，而不是将数据集合传递给列表。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showFavoritesOnly <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">ForEach</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                        <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                            <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/7620af575a013a7b2bd317f7e6763ac3e07576f079451bd0fa53706d2965258e/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393530313063356662382f35656135353237642d363630612d343461612d386437312d3265373364333064346564322e706e67" alt=""></p>
<h2 id="步骤2-39">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-2"></a></p>
<p>添加一个<code>Toggle</code>视图作为列表视图的第一个子视图，给<code>showFavoritesOnly</code>做一个绑定。</p>
<p>您可以使用<code>$</code>来访问状态变量或其绑定的属性。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> showFavoritesOnly <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">Toggle</span>(isOn: <span class="variable">$showFavoritesOnly</span>) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Favorites only&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">ForEach</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                        <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                            <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/503097b42856f626d1afe9730df92456533c60be7d7776259a1bb245c308af61/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f626136656331626361632f66623362363937662d616464342d346337332d383064662d3133376161323333386132622e706e67" alt=""></p>
<h2 id="步骤3-34">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-2"></a></p>
<p>使用实时预览并通过点击切换来尝试此新功能。</p>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/_proj_1_3_live_preview.gif" alt=""></p>
<h2 id="第四节-使用Observable-Object进行存储">第四节 使用Observable Object进行存储</h2>
<p><a href="#%E7%AC%AC%E5%9B%9B%E8%8A%82-%E4%BD%BF%E7%94%A8observable-object%E8%BF%9B%E8%A1%8C%E5%AD%98%E5%82%A8"></a></p>
<p>为了让用户控制哪些特定的地标是最喜欢的，您首先要将地标数据存储在一个<code>Observable Object</code>中。</p>
<p><code>Observable Object</code>的自定义对象，可以从<code>SwiftUI</code>环境中的存储绑定到视图。<code>SwiftUI</code>监视可观察对象的任何可能影响视图的更改，并在更改后显示正确的视图。</p>
<p><img src="https://camo.githubusercontent.com/dce7da47901d2fab4ff422853ee6508ce178e39b5bd3a16888b1416566b994cf/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f343563373038333235352f38313337623930652d353763352d346364352d623937312d6162306435313966663939622e706e67" alt=""></p>
<h2 id="步骤1-39">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-3"></a></p>
<p>创建一个名为<code>UserData.Swift</code>的新<code>Swift</code>文件。</p>
<blockquote>
<p>UserData.swift</p>
</blockquote>
<h2 id="步骤2-40">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-3"></a></p>
<p>从组合框架中声明遵守<code>ObservableObject</code>协议的新模型类型。</p>
<p><code>SwiftUI</code>订阅您的<code>ObservableObject</code>，并在数据更改时更新任何需要刷新的视图。</p>
<blockquote>
<p>UserData.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">UserData</span>: <span class="title class_ inherited__">ObservableObject</span>  &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤3-35">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-3"></a></p>
<p>添加<code>showFavoritesOnly</code>和地标的存储属性及其初始值。</p>
<blockquote>
<p>UserData.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">UserData</span>: <span class="title class_ inherited__">ObservableObject</span>  &#123;</span><br><span class="line">    <span class="keyword">var</span> showFavoritesOnly <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="keyword">var</span> landmarks <span class="operator">=</span> landmarkData</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>ObservableObject</code>需要发布对其数据的任何更改，以便其订阅者可以获取更改。</p>
</blockquote>
<h2 id="步骤4-31">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44"></a></p>
<p>将<code>@Published</code>属性添加到模型中的每个属性</p>
<blockquote>
<p>UserData.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">UserData</span>: <span class="title class_ inherited__">ObservableObject</span>  &#123;</span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">var</span> showFavoritesOnly <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">var</span> landmarks <span class="operator">=</span> landmarkData</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="第五节-在视图中采用你的模型对象">第五节 在视图中采用你的模型对象</h2>
<p><a href="#%E7%AC%AC%E4%BA%94%E8%8A%82-%E5%9C%A8%E8%A7%86%E5%9B%BE%E4%B8%AD%E9%87%87%E7%94%A8%E4%BD%A0%E7%9A%84%E6%A8%A1%E5%9E%8B%E5%AF%B9%E8%B1%A1"></a></p>
<p>现在您已经创建了<code>UserData</code>对象，您需要更新视图以将其作为应用程序的数据存储。</p>
<p><img src="https://camo.githubusercontent.com/a5272502caa72f1589db85e4029efde08c1ecfa7373d6cb0103b975e7bb40daa/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f326336313065353134302f35356439366639322d323762352d346137382d393533632d6465333263343264376563342e706e67" alt=""></p>
<h2 id="步骤1-40">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-4"></a></p>
<p>在<code>LandmarkList.swift</code>中，用<code>@EnvironmentObject</code>属性替换<code>showFavoritesOnly</code>声明，并向预览添加<code>environmentObject（:）</code>修饰符。</p>
<p>只要<code>environmentObject（:）</code>修饰符已应用于父对象，此<code>userData</code>属性就会自动获取其值。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">Toggle</span>(isOn: <span class="variable">$showFavoritesOnly</span>) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Favorites only&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">ForEach</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                        <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                            <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">            .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤2-41">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-4"></a></p>
<p>通过访问<code>userData</code>上的相同属性来替换<code>showFavoritesOnly</code>的使用。</p>
<p>与<code>@State</code>属性一样，您可以使用<code>$</code>访问到<code>userData</code>对象成员的绑定。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">Toggle</span>(isOn: <span class="variable">$userData</span>.showFavoritesOnly) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Favorites only&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">ForEach</span>(landmarkData) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.userData.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                        <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                            <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">            .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/b0e1c3a23091ea24ef4d8d54ada6adab9df6a85711ac1bb2a693acd7c7d76eed/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f633562616130616431332f64353737316334622d333738372d343964332d623065312d3732373731396438353463332e706e67" alt=""></p>
<h2 id="步骤3-36">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-4"></a></p>
<p>创建<code>ForEach</code>实例时使用<code>userData.landmarks</code>作为数据。</p>
<blockquote>
<p>LandmarkList.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">Toggle</span>(isOn: <span class="variable">$userData</span>.showFavoritesOnly) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Favorites only&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">ForEach</span>(userData.landmarks) &#123; landmark <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="operator">!</span><span class="keyword">self</span>.userData.showFavoritesOnly <span class="operator">||</span> landmark.isFavorite &#123;</span><br><span class="line">                        <span class="type">NavigationLink</span>(destination: <span class="type">LandmarkDetail</span>(landmark: landmark)) &#123;</span><br><span class="line">                            <span class="type">LandmarkRow</span>(landmark: landmark)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;Landmarks&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkList_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkList</span>()</span><br><span class="line">            .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://camo.githubusercontent.com/b0e1c3a23091ea24ef4d8d54ada6adab9df6a85711ac1bb2a693acd7c7d76eed/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f633562616130616431332f64353737316334622d333738372d343964332d623065312d3732373731396438353463332e706e67" alt=""></p>
<h2 id="步骤4-32">步骤4</h2>
<p><a href="#%E6%AD%A5%E9%AA%A44-1"></a></p>
<p>在<code>SceneDelegate.swift</code>中，将<code>environmentObject（:）</code>修饰符添加到<code>LandmarkList</code>。</p>
<p>如果您在模拟器或设备上构建并运行地标，而不是使用预览，则此更新将确保地标列表在环境中有一个<code>UserData</code>对象。</p>
<blockquote>
<p>SceneDelegate.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SceneDelegate</span>: <span class="title class_ inherited__">UIResponder</span>, <span class="title class_ inherited__">UIWindowSceneDelegate</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> window: <span class="type">UIWindow</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">scene</span>(<span class="keyword">_</span> <span class="params">scene</span>: <span class="type">UIScene</span>, <span class="params">willConnectTo</span> <span class="params">session</span>: <span class="type">UISceneSession</span>, <span class="params">options</span> <span class="params">connectionOptions</span>: <span class="type">UIScene</span>.<span class="type">ConnectionOptions</span>) &#123;</span><br><span class="line">        <span class="comment">// Use this method to optionally configure and attach the UIWindow `window` to the provided UIWindowScene `scene`.</span></span><br><span class="line">        <span class="comment">// If using a storyboard, the `window` property will automatically be initialized and attached to the scene.</span></span><br><span class="line">        <span class="comment">// This delegate does not imply the connecting scene or session are new (see `application:configurationForConnectingSceneSession` instead).</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Use a UIHostingController as window root view controller</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> windowScene <span class="operator">=</span> scene <span class="keyword">as?</span> <span class="type">UIWindowScene</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> window <span class="operator">=</span> <span class="type">UIWindow</span>(windowScene: windowScene)</span><br><span class="line">            window.rootViewController <span class="operator">=</span> <span class="type">UIHostingController</span>(</span><br><span class="line">                rootView: <span class="type">LandmarkList</span>()</span><br><span class="line">                    .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">self</span>.window <span class="operator">=</span> window</span><br><span class="line">            window.makeKeyAndVisible()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤5-20">步骤5</h2>
<p><a href="#%E6%AD%A5%E9%AA%A45"></a></p>
<p>更新<code>LandmarkDetail</code>视图以在环境中使用<code>UserData</code>对象。</p>
<p>在访问或更新地标的收藏状态时，您将使用地标索引，以便始终访问该数据的正确版本。</p>
<blockquote>
<p>LandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>(landmark: landmark)</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>(image: landmark.image)</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(landmark.name)</span><br><span class="line">                    .font(.title)</span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(landmark.park)</span><br><span class="line">                        .font(caption)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(landmark.state)</span><br><span class="line">                        .font(.caption)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="type">Text</span>(landmark.name), displayMode: .inline)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkDetail</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">            .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤6-14">步骤6</h2>
<p><a href="#%E6%AD%A5%E9%AA%A46"></a></p>
<p>切换回<code>LandmarkList.swift</code>并打开实时预览，以验证一切正常工作。</p>
<p><img src="https://camo.githubusercontent.com/211674563804b74ec03a0cc1d1b8f7240d5525d10802894e37aeac6f0612d6a6/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f363630353938333533362f63363063373334652d656232652d343639622d626465332d6364373062633739383562372e706e67" alt=""></p>
<h2 id="第六节-为每个地标创建收藏夹按钮">第六节 为每个地标创建收藏夹按钮</h2>
<p><a href="#%E7%AC%AC%E5%85%AD%E8%8A%82-%E4%B8%BA%E6%AF%8F%E4%B8%AA%E5%9C%B0%E6%A0%87%E5%88%9B%E5%BB%BA%E6%94%B6%E8%97%8F%E5%A4%B9%E6%8C%89%E9%92%AE"></a></p>
<p>地标应用程序现在可以在过滤和未经过滤的地标视图之间切换，但最喜欢的地标列表仍然是硬编码的。要允许用户添加和删除收藏，需要将收藏按钮添加到地标详情视图。</p>
<p><img src="https://camo.githubusercontent.com/2cb4907f49bdd9a91007cc4866569b2beac4d7e8d097cb42f4098447675c891c/68747470733a2f2f646f63732d6173736574732e646576656c6f7065722e6170706c652e636f6d2f7075626c69736865642f393737303763643363332f31313436653264392d363332352d343931302d393263642d3137393162626365646136302e706e67" alt=""></p>
<h2 id="步骤1-41">步骤1</h2>
<p><a href="#%E6%AD%A5%E9%AA%A41-5"></a></p>
<p>在<code>LandmarkDetail.swift</code>中，将地标的名称嵌入<code>HStack</code>。</p>
<blockquote>
<p>LandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>(landmark: landmark)</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>(image: landmark.image)</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">HStack</span> &#123;</span><br><span class="line">                    <span class="type">Text</span>(landmark.name)</span><br><span class="line">                        .font(.title)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(landmark.park)</span><br><span class="line">                        .font(caption)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(landmark.state)</span><br><span class="line">                        .font(.caption)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="type">Text</span>(landmark.name), displayMode: .inline)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkDetail</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">            .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤2-42">步骤2</h2>
<p><a href="#%E6%AD%A5%E9%AA%A42-5"></a></p>
<p>在地标名称旁边创建一个新按钮。使用<code>if-else</code>条件语句提供不同的图像，以指示地标是否收藏。</p>
<p>在按钮的<code>action</code>闭包中，代码使用带有<code>userData</code>对象的<code>landmarkIndex</code>来更新地标。</p>
<blockquote>
<p>LandmarkDetail.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> landmarkIndex: <span class="type">Int</span> &#123;</span><br><span class="line">        userData.landmarks.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> landmark.id &#125;)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>(landmark: landmark)</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>(image: landmark.image)</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">HStack</span> &#123;</span><br><span class="line">                    <span class="type">Text</span>(landmark.name)</span><br><span class="line">                        .font(.title)</span><br><span class="line"></span><br><span class="line">                    <span class="type">Button</span>(action: &#123;</span><br><span class="line">                        <span class="keyword">self</span>.userData.landmarks[<span class="keyword">self</span>.landmarkIndex].isFavorite.toggle()</span><br><span class="line">                    &#125;) &#123;</span><br><span class="line">                        <span class="keyword">if</span> <span class="keyword">self</span>.userData.landmarks[<span class="keyword">self</span>.landmarkIndex].isFavorite &#123;</span><br><span class="line">                            <span class="type">Image</span>(systemName: <span class="string">&quot;star.fill&quot;</span>)</span><br><span class="line">                                .foregroundColor(<span class="type">Color</span>.yellow)</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="type">Image</span>(systemName: <span class="string">&quot;star&quot;</span>)</span><br><span class="line">                                .foregroundColor(<span class="type">Color</span>.gray)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(landmark.park)</span><br><span class="line">                        .font(caption)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(landmark.state)</span><br><span class="line">                        .font(.caption)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationBarTitle(<span class="type">Text</span>(landmark.name), displayMode: .inline)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LandmarkDetail_Preview</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkDetail</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">            .environmentObject(<span class="type">UserData</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤3-37">步骤3</h2>
<p><a href="#%E6%AD%A5%E9%AA%A43-5"></a></p>
<p>切换回<code>LandmarkList.swift</code>，并打开实时预览。</p>
<p>当您从列表导航到详情信息并点击按钮时，这些更改将在您返回列表时保持不变。因为两个视图都在访问环境中的同一个模型对象，所以两个视图保持一致性。</p>
<p><img src="https://github.com/ly918/SwiftUI-Chinese-Documents/raw/master/Resource/_proj_1_3_complete.gif" alt=""></p>
<blockquote>
<p>User Interface</p>
</blockquote>
<h2 id="视图和控件">视图和控件</h2>
<p><a href="#%E8%A7%86%E5%9B%BE%E5%92%8C%E6%8E%A7%E4%BB%B6"></a></p>
<p>在屏幕上显示内容并处理用户交互。</p>
<h2 id="概述">概述</h2>
<p><a href="#%E6%A6%82%E8%BF%B0"></a></p>
<p>视图和控件是应用程序用户界面的可视化构建区块。使用它们在屏幕上显示应用程序的内容。视图可以描述文本、图像、形状、自定义绘图以及所有这些内容的组合。控件允许用户使用一致的API与其相应的平台和上下文进行交互。</p>
<p>使用指定其视觉关系和层次结构的容器合并视图。使用名为修饰符<code>modifiers</code>的方法自定义内置视图和为应用程序创建的视图的显示、行为和交互。</p>
<p>将修饰符<code>modifiers</code>应用于视图和控件：</p>
<ul>
<li>控制视图的大小、位置和外观属性。</li>
<li>响应轻触、手势和其他用户交互。</li>
<li>支持拖拽操作。</li>
<li>自定义动画和转场。</li>
<li>设置样式首选项和其他环境数据。</li>
</ul>
<p>有关如何使用视图和控件的其他信息，请参见人机界面指南。</p>
<h2 id="话题">话题</h2>
<p><a href="#%E8%AF%9D%E9%A2%98"></a></p>
<h3 id="摘要">摘要</h3>
<p><a href="#%E6%91%98%E8%A6%81"></a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/ly918/SwiftUI-Chinese-Documents/wiki/D1-View"><code>protocol View</code></a></p>
<p>视图:用来描述SwiftUI的视图类型。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/ly918/SwiftUI-Chinese-Documents/wiki/01-Creating-And-Combining-Views">Creating and Combining Views</a></p>
<p>创建并组合视图：本教程将指导您构建地标，这是一个iOS应用程序，用于发现和共享您喜欢的地方。您将首先构建显示地标的详情视图。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/ly918/SwiftUI-Chinese-Documents/wiki/02-Working-with-UI-Controls">Working with UI Controls</a></p>
<p>使用UI控件：在地标应用程序中，用户可以创建个人简介来表达他们的个性。为了让用户能够更改他们的个人简介，您将添加一个编辑模式并设计首选项页面。</p>
<h3 id="文本-Text">文本 Text</h3>
<p><a href="#%E6%96%87%E6%9C%AC-text"></a></p>
<p><code>struct Text</code></p>
<p>文本：显示一行或多行只读文本的视图。</p>
<p><code>struct TextField</code></p>
<p>文本输入框：显示可编辑文本的控件。</p>
<p><code>struct SecureField</code></p>
<p>密文输入框：用户安全输入私密文本的控件。</p>
<p><code>struct Font</code></p>
<p>字体：依赖于环境的字体。</p>
<h3 id="图像-Images">图像 Images</h3>
<p><a href="#%E5%9B%BE%E5%83%8F-images"></a></p>
<p><code>struct Image</code></p>
<p>图像：显示依赖于环境的图像视图。</p>
<h3 id="按钮-Buttons">按钮 Buttons</h3>
<p><a href="#%E6%8C%89%E9%92%AE-buttons"></a></p>
<p><code>struct Button</code></p>
<p>按钮：触控时执行操作的控件。</p>
<p><code>struct NavigationLink</code></p>
<p>导航链接：按下时触发导航显示的按钮。</p>
<p><code>struct MenuButton</code></p>
<p>菜单按钮：当按下时显示包含选项列表的菜单的按钮。</p>
<p><code>struct EditButton</code></p>
<p>编辑按钮：切换当前编辑范围的编辑模式的按钮。</p>
<p><code>struct PasteButton</code></p>
<p>粘贴按钮：触发从粘贴板读取数据的系统按钮。</p>
<h3 id="值选择器-Value-Selectors">值选择器 Value Selectors</h3>
<p><a href="#%E5%80%BC%E9%80%89%E6%8B%A9%E5%99%A8-value-selectors"></a></p>
<p><code>struct Toggle</code></p>
<p>开关：在打开和关闭状态之间切换的控件。</p>
<p><code>struct Picker</code></p>
<p>选择器：从一组互斥值中进行选择的控件。</p>
<p><code>struct DatePicker</code></p>
<p>日期选择器：用于选择绝对日期的控件。</p>
<p><code>struct Slider</code></p>
<p>滑块：从有界线性值范围中选择值的控件。</p>
<p><code>struct Stepper</code></p>
<p>步进器：用于执行递增和递减操作的控件。</p>
<h3 id="支持类型-Supporting-Types">支持类型 Supporting Types</h3>
<p><a href="#%E6%94%AF%E6%8C%81%E7%B1%BB%E5%9E%8B-supporting-types"></a></p>
<p><code>struct ViewBuilder</code></p>
<p>视图构建器：从闭包构造视图的自定义参数属性。</p>
<p><code>protocol ViewModifier</code></p>
<p>视图修饰器：应用于视图或其他视图的修饰器，生成原始值的不同版本。</p>
<blockquote>
<p>protocol</p>
</blockquote>
<h2 id="View">View</h2>
<p><a href="#view"></a></p>
<p>一个表示SwiftUI视图的类型。</p>
<p>代码释义</p>
<h2 id="声明">声明</h2>
<p><a href="#%E5%A3%B0%E6%98%8E"></a></p>
<blockquote>
<p>protocol View</p>
</blockquote>
<h2 id="概述-2">概述</h2>
<p><a href="#%E6%A6%82%E8%BF%B0"></a></p>
<p>通过声明遵守<code>View protocol</code>的类型来创建自定义视图。实现所需的<code>body</code>计算属性，以提供自定义视图的内容和行为。</p>
<h2 id="主题">主题</h2>
<p><a href="#%E4%B8%BB%E9%A2%98"></a></p>
<h3 id="1-Implementing-a-Custom-View-实现自定义视图">1 - Implementing a Custom View - 实现自定义视图</h3>
<p><a href="#1---implementing-a-custom-view---%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A7%86%E5%9B%BE"></a></p>
<h4 id="1-1-视图的内容和行为。必需的，默认实现。">1.1 视图的内容和行为。必需的，默认实现。</h4>
<p><a href="#11-%E8%A7%86%E5%9B%BE%E7%9A%84%E5%86%85%E5%AE%B9%E5%92%8C%E8%A1%8C%E4%B8%BA%E5%BF%85%E9%9C%80%E7%9A%84%E9%BB%98%E8%AE%A4%E5%AE%9E%E7%8E%B0"></a></p>
<blockquote>
<p>demo</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="comment">/// 1 - Implementing a Custom View - 实现自定义视图</span></span><br><span class="line">    <span class="comment">/// 视图的内容和行为。</span></span><br><span class="line">    <span class="comment">/// 必需的。默认实现。</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">            .background(<span class="type">Color</span>.yellow)</span><br><span class="line">            .border(<span class="type">Color</span>.red, width: <span class="number">2</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-Sizing-a-Views-制定视图的大小">2 - Sizing a Views - 制定视图的大小</h3>
<p><a href="#2---sizing-a-views---%E5%88%B6%E5%AE%9A%E8%A7%86%E5%9B%BE%E7%9A%84%E5%A4%A7%E5%B0%8F"></a></p>
<h4 id="2-1-将视图定位在具有指定大小的不可见框架中">2.1 将视图定位在具有指定大小的不可见框架中</h4>
<p><a href="#21-%E5%B0%86%E8%A7%86%E5%9B%BE%E5%AE%9A%E4%BD%8D%E5%9C%A8%E5%85%B7%E6%9C%89%E6%8C%87%E5%AE%9A%E5%A4%A7%E5%B0%8F%E7%9A%84%E4%B8%8D%E5%8F%AF%E8%A7%81%E6%A1%86%E6%9E%B6%E4%B8%AD"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">frame</span>(<span class="params">width</span>: <span class="type">CGFloat</span>?, <span class="params">height</span>: <span class="type">CGFloat</span>?, <span class="params">alignment</span>: <span class="type">Alignment</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="2-2-将视图定位在具有指定宽度和高度的不可见框架中。">2.2 将视图定位在具有指定宽度和高度的不可见框架中。</h4>
<p><a href="#22-%E5%B0%86%E8%A7%86%E5%9B%BE%E5%AE%9A%E4%BD%8D%E5%9C%A8%E5%85%B7%E6%9C%89%E6%8C%87%E5%AE%9A%E5%AE%BD%E5%BA%A6%E5%92%8C%E9%AB%98%E5%BA%A6%E7%9A%84%E4%B8%8D%E5%8F%AF%E8%A7%81%E6%A1%86%E6%9E%B6%E4%B8%AD"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">frame</span>(<span class="params">minWidth</span>: <span class="type">CGFloat</span>?, <span class="params">idealWidth</span>: <span class="type">CGFloat</span>?, <span class="params">maxWidth</span>: <span class="type">CGFloat</span>?, <span class="params">minHeight</span>: <span class="type">CGFloat</span>?, <span class="params">idealHeight</span>: <span class="type">CGFloat</span>?, <span class="params">maxHeight</span>: <span class="type">CGFloat</span>?, <span class="params">alignment</span>: <span class="type">Alignment</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="2-3-将视图修复为理想大小。">2.3 将视图修复为理想大小。</h4>
<p><a href="#23-%E5%B0%86%E8%A7%86%E5%9B%BE%E4%BF%AE%E5%A4%8D%E4%B8%BA%E7%90%86%E6%83%B3%E5%A4%A7%E5%B0%8F"></a></p>
<h4 id="2-4-将视图修复为理想大小，可指定垂直或水平方向的修复。">2.4 将视图修复为理想大小，可指定垂直或水平方向的修复。</h4>
<p><a href="#24-%E5%B0%86%E8%A7%86%E5%9B%BE%E4%BF%AE%E5%A4%8D%E4%B8%BA%E7%90%86%E6%83%B3%E5%A4%A7%E5%B0%8F%E5%8F%AF%E6%8C%87%E5%AE%9A%E5%9E%82%E7%9B%B4%E6%88%96%E6%B0%B4%E5%B9%B3%E6%96%B9%E5%90%91%E7%9A%84%E4%BF%AE%E5%A4%8D"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">fixedSize</span>(<span class="params">horizontal</span>: <span class="type">Bool</span>, <span class="params">vertical</span>: <span class="type">Bool</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="2-5-设置父布局应将空间分配给子布局的优先级，默认为0。">2.5 设置父布局应将空间分配给子布局的优先级，默认为0。</h4>
<p><a href="#25-%E8%AE%BE%E7%BD%AE%E7%88%B6%E5%B8%83%E5%B1%80%E5%BA%94%E5%B0%86%E7%A9%BA%E9%97%B4%E5%88%86%E9%85%8D%E7%BB%99%E5%AD%90%E5%B8%83%E5%B1%80%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%E9%BB%98%E8%AE%A4%E4%B8%BA0"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">layoutPriority</span>(<span class="type">Double</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>demo</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SizingInViews</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="comment">/// 2 - Sizing a Views - 制定视图大小</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="comment">/// 2.1 将视图定位在具有指定大小的不可见框架中。</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">                .background(<span class="type">Color</span>.yellow)</span><br><span class="line">                .border(<span class="type">Color</span>.red, width: <span class="number">2</span>)</span><br><span class="line">                .frame(width: <span class="number">200</span>, height: <span class="number">50</span>, alignment: .topLeading)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/// 2.2 将视图定位在具有指定宽度和高度的不可见框架中。</span></span><br><span class="line">           <span class="type">Text</span>(<span class="string">&quot;Hello, World 2Hello, World 2Hello, World 2Hello, World 2Hello, World 2Hello, World 2Hello&quot;</span>)</span><br><span class="line">                .background(<span class="type">Color</span>.yellow)</span><br><span class="line">                .border(<span class="type">Color</span>.red, width: <span class="number">2</span>)</span><br><span class="line">                .frame(minWidth: <span class="number">10</span>, idealWidth: <span class="number">60</span>, maxWidth: <span class="number">300</span>, minHeight: <span class="number">10</span>, idealHeight: <span class="number">60</span>, maxHeight: <span class="number">300</span>, alignment: .topTrailing)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/// 2.3 将视图固定在其理想大小。</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Hello, World3&quot;</span>)</span><br><span class="line">                .background(<span class="type">Color</span>.yellow)</span><br><span class="line">                .border(<span class="type">Color</span>.red, width: <span class="number">2</span>)</span><br><span class="line">                .fixedSize()</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/// 2.4 将视图修复为理想大小，可指定垂直或水平方向的修复。</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Hello, World4Hello, World4HelloHello, World4Hello, World4HelloHello&quot;</span>)</span><br><span class="line">                .background(<span class="type">Color</span>.yellow)</span><br><span class="line">                .border(<span class="type">Color</span>.red, width: <span class="number">2</span>)</span><br><span class="line">                .fixedSize(horizontal: <span class="literal">true</span>, vertical: <span class="literal">false</span>)</span><br><span class="line">                .frame(width: <span class="number">200</span>, height: <span class="number">200</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/// 2.5 指定布局优先级 默认为0</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Hello, World5&quot;</span>)</span><br><span class="line">                .background(<span class="type">Color</span>.yellow)</span><br><span class="line">                .border(<span class="type">Color</span>.red, width: <span class="number">2</span>)</span><br><span class="line">                .layoutPriority(<span class="number">1</span>)</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-Positioning-a-View-定位视图">3 - Positioning a View - 定位视图</h3>
<p><a href="#3---positioning-a-view---%E5%AE%9A%E4%BD%8D%E8%A7%86%E5%9B%BE"></a></p>
<h4 id="3-1-将视图的中心固定在其父坐标空间的指定点上。">3.1 将视图的中心固定在其父坐标空间的指定点上。</h4>
<p><a href="#31-%E5%B0%86%E8%A7%86%E5%9B%BE%E7%9A%84%E4%B8%AD%E5%BF%83%E5%9B%BA%E5%AE%9A%E5%9C%A8%E5%85%B6%E7%88%B6%E5%9D%90%E6%A0%87%E7%A9%BA%E9%97%B4%E7%9A%84%E6%8C%87%E5%AE%9A%E7%82%B9%E4%B8%8A"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">position</span>(<span class="type">CGPoint</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="3-2-将视图的中心固定在其父坐标空间中指定的坐标上。">3.2 将视图的中心固定在其父坐标空间中指定的坐标上。</h4>
<p><a href="#32-%E5%B0%86%E8%A7%86%E5%9B%BE%E7%9A%84%E4%B8%AD%E5%BF%83%E5%9B%BA%E5%AE%9A%E5%9C%A8%E5%85%B6%E7%88%B6%E5%9D%90%E6%A0%87%E7%A9%BA%E9%97%B4%E4%B8%AD%E6%8C%87%E5%AE%9A%E7%9A%84%E5%9D%90%E6%A0%87%E4%B8%8A"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">position</span>(<span class="params">x</span>: <span class="type">CGFloat</span>, <span class="params">y</span>: <span class="type">CGFloat</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="3-3-通过给定Size中的width和height偏移视图。">3.3 通过给定<code>Size</code>中的<code>width</code>和<code>height</code>偏移视图。</h4>
<p><a href="#33-%E9%80%9A%E8%BF%87%E7%BB%99%E5%AE%9Asize%E4%B8%AD%E7%9A%84width%E5%92%8Cheight%E5%81%8F%E7%A7%BB%E8%A7%86%E5%9B%BE"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">offset</span>(<span class="type">CGSize</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="3-4-通过指定的x和y值偏移视图。">3.4 通过指定的<code>x</code>和<code>y</code>值偏移视图。</h4>
<p><a href="#34-%E9%80%9A%E8%BF%87%E6%8C%87%E5%AE%9A%E7%9A%84x%E5%92%8Cy%E5%80%BC%E5%81%8F%E7%A7%BB%E8%A7%86%E5%9B%BE"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">offset</span>(<span class="params">x</span>: <span class="type">CGFloat</span>, <span class="params">y</span>: <span class="type">CGFloat</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="3-5-将视图延展到指定边缘的安全区域之外。">3.5 将视图延展到指定边缘的安全区域之外。</h4>
<p><a href="#35-%E5%B0%86%E8%A7%86%E5%9B%BE%E5%BB%B6%E5%B1%95%E5%88%B0%E6%8C%87%E5%AE%9A%E8%BE%B9%E7%BC%98%E7%9A%84%E5%AE%89%E5%85%A8%E5%8C%BA%E5%9F%9F%E4%B9%8B%E5%A4%96"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">edgesIgnoringSafeArea</span>(<span class="type">Edge</span>.<span class="type">Set</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="3-6-将名称分配给此视图的坐标空间，此视图的后代可以将其引用。">3.6 将名称分配给此视图的坐标空间，此视图的后代可以将其引用。</h4>
<p><a href="#36-%E5%B0%86%E5%90%8D%E7%A7%B0%E5%88%86%E9%85%8D%E7%BB%99%E6%AD%A4%E8%A7%86%E5%9B%BE%E7%9A%84%E5%9D%90%E6%A0%87%E7%A9%BA%E9%97%B4%E6%AD%A4%E8%A7%86%E5%9B%BE%E7%9A%84%E5%90%8E%E4%BB%A3%E5%8F%AF%E4%BB%A5%E5%B0%86%E5%85%B6%E5%BC%95%E7%94%A8"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">coordinateSpace</span>&lt;<span class="type">T</span>&gt;(<span class="params">name</span>: <span class="type">T</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>demo</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PositioningAViews</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="comment">/// 3  - Positioning a View - 定位视图</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span> &#123;</span><br><span class="line">            <span class="comment">/// 3.1 将视图的中心固定在其父坐标空间的指定点上。</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">                .background(<span class="type">Color</span>.red)</span><br><span class="line">                .position(<span class="type">CGPoint</span>(x: <span class="number">100</span>, y: <span class="number">0</span>))</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/// 3.2 将视图的中心固定在其父坐标空间中指定的坐标上。</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Hello, World2&quot;</span>)</span><br><span class="line">                .background(<span class="type">Color</span>.green)</span><br><span class="line">                .position(x: <span class="number">100</span>, y: <span class="number">30</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/// 3.3 通过给定`Size`中的`width`和`height`偏移视图。</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Hello, World3&quot;</span>)</span><br><span class="line">                .background(<span class="type">Color</span>.red)</span><br><span class="line">                .position(x: <span class="number">100</span>, y: <span class="number">60</span>)</span><br><span class="line">                .offset(<span class="type">CGSize</span>(width: <span class="number">30</span>, height: <span class="number">0</span>))</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/// 3.4 通过指定的`x`和`y`值偏移视图。</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Hello, World4&quot;</span>)</span><br><span class="line">                .background(<span class="type">Color</span>.green)</span><br><span class="line">                .position(x: <span class="number">100</span>, y: <span class="number">90</span>)</span><br><span class="line">                .offset(x: <span class="operator">-</span><span class="number">30</span>, y: <span class="number">0</span>)</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line">        .edgesIgnoringSafeArea(.top)<span class="comment">/// 3.5 将视图延展到指定边缘的安全区域之外。</span></span><br><span class="line">        .coordinateSpace(name: <span class="string">&quot;test&quot;</span>)<span class="comment">/// 3.6 将名称分配给此视图的坐标空间，此视图的后代可以将其引用。</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-Aligning-Views-设置视图的对其方式">4 - Aligning Views - 设置视图的对其方式</h3>
<p><a href="#4---aligning-views---%E8%AE%BE%E7%BD%AE%E8%A7%86%E5%9B%BE%E7%9A%84%E5%AF%B9%E5%85%B6%E6%96%B9%E5%BC%8F"></a></p>
<h4 id="4-1-设置视图的水平对齐方式。">4.1 设置视图的水平对齐方式。</h4>
<p><a href="#41-%E8%AE%BE%E7%BD%AE%E8%A7%86%E5%9B%BE%E7%9A%84%E6%B0%B4%E5%B9%B3%E5%AF%B9%E9%BD%90%E6%96%B9%E5%BC%8F"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">alignmentGuide</span>(<span class="type">HorizontalAlignment</span>, <span class="params">computeValue</span>: (<span class="type">ViewDimensions</span>) -&gt; <span class="type">CGFloat</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="4-2-设置视图的垂直">4.2 设置视图的垂直</h4>
<p><a href="#42-%E8%AE%BE%E7%BD%AE%E8%A7%86%E5%9B%BE%E7%9A%84%E5%9E%82%E7%9B%B4"></a></p>
<p>对齐方式。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">alignmentGuide</span>(<span class="type">VerticalAlignment</span>, <span class="params">computeValue</span>: (<span class="type">ViewDimensions</span>) -&gt; <span class="type">CGFloat</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="4-3-视图在其自身的坐标空间中的大小和对齐方式的规则。">4.3 视图在其自身的坐标空间中的大小和对齐方式的规则。</h4>
<p><a href="#43-%E8%A7%86%E5%9B%BE%E5%9C%A8%E5%85%B6%E8%87%AA%E8%BA%AB%E7%9A%84%E5%9D%90%E6%A0%87%E7%A9%BA%E9%97%B4%E4%B8%AD%E7%9A%84%E5%A4%A7%E5%B0%8F%E5%92%8C%E5%AF%B9%E9%BD%90%E6%96%B9%E5%BC%8F%E7%9A%84%E8%A7%84%E5%88%99"></a></p>
<h4 id="4-4-用于标识对齐规则的类型。">4.4 用于标识对齐规则的类型。</h4>
<p><a href="#44-%E7%94%A8%E4%BA%8E%E6%A0%87%E8%AF%86%E5%AF%B9%E9%BD%90%E8%A7%84%E5%88%99%E7%9A%84%E7%B1%BB%E5%9E%8B"></a></p>
<h3 id="5-Adjusting-the-Padding-of-a-View-调整视图边距">5 - Adjusting the Padding of a View - 调整视图边距</h3>
<p><a href="#5---adjusting-the-padding-of-a-view---%E8%B0%83%E6%95%B4%E8%A7%86%E5%9B%BE%E8%BE%B9%E8%B7%9D"></a></p>
<h4 id="5-1-将视图沿所有边缘内嵌填充指定的大小。">5.1 将视图沿所有边缘内嵌填充指定的大小。</h4>
<p><a href="#51-%E5%B0%86%E8%A7%86%E5%9B%BE%E6%B2%BF%E6%89%80%E6%9C%89%E8%BE%B9%E7%BC%98%E5%86%85%E5%B5%8C%E5%A1%AB%E5%85%85%E6%8C%87%E5%AE%9A%E7%9A%84%E5%A4%A7%E5%B0%8F"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">padding</span>(<span class="type">CGFloat</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="5-2-使用指定的EdgeInsets内嵌填充视图。">5.2 使用指定的<code>EdgeInsets</code>内嵌填充视图。</h4>
<p><a href="#52-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AE%9A%E7%9A%84edgeinsets%E5%86%85%E5%B5%8C%E5%A1%AB%E5%85%85%E8%A7%86%E5%9B%BE"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">padding</span>(<span class="type">EdgeInsets</span>) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="5-3-使用指定的Edge集合内嵌填充指定大小。">5.3 使用指定的<code>Edge</code>集合内嵌填充指定大小。</h4>
<p><a href="#53-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AE%9A%E7%9A%84edge%E9%9B%86%E5%90%88%E5%86%85%E5%B5%8C%E5%A1%AB%E5%85%85%E6%8C%87%E5%AE%9A%E5%A4%A7%E5%B0%8F"></a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">padding</span>(<span class="type">Edge</span>.<span class="type">Set</span>, <span class="type">CGFloat</span>?) -&gt; <span class="type">View</span></span><br></pre></td></tr></table></figure>
<h4 id="5-4-定义了矩形各边的内嵌距离的结构体。">5.4 定义了矩形各边的内嵌距离的结构体。</h4>
<p><a href="#54-%E5%AE%9A%E4%B9%89%E4%BA%86%E7%9F%A9%E5%BD%A2%E5%90%84%E8%BE%B9%E7%9A%84%E5%86%85%E5%B5%8C%E8%B7%9D%E7%A6%BB%E7%9A%84%E7%BB%93%E6%9E%84%E4%BD%93"></a></p>
<blockquote>
<p>demo</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">AdjustingPaddingView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="comment">/// 5 - Adjusting the Padding of a View - 调整视图边距</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span> &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="comment">/*@START_MENU_TOKEN@*/</span><span class="string">&quot;Hello, World!&quot;</span><span class="comment">/*@END_MENU_TOKEN@*/</span>)</span><br><span class="line">                .background(<span class="type">Color</span>.yellow)</span><br><span class="line">                .border(<span class="type">Color</span>.red, width: <span class="number">2</span>)</span><br><span class="line">                .position(x: <span class="number">100</span>, y: <span class="number">30</span>)</span><br><span class="line">                .padding()</span><br><span class="line">                </span><br><span class="line">        &#125;</span><br><span class="line">        .background(<span class="type">Color</span>.gray)</span><br><span class="line"><span class="comment">//        .padding()///  默认边距</span></span><br><span class="line"><span class="comment">//        .padding(30) /// 5.1 将视图沿所有边缘内嵌填充指定的大小。</span></span><br><span class="line"><span class="comment">//        .padding(EdgeInsets(top: 20, leading: 10, bottom: 60, trailing: 50)) /// 5.2 使用指定的`EdgeInsets`内嵌填充视图。</span></span><br><span class="line">        .padding([.leading,.trailing], <span class="number">20</span>) <span class="comment">/// 5.3 使用指定的`Edge`集合内嵌填充指定大小。</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../../2023/10/15/Swift/SwiftUI%E6%96%87%E6%A1%A3/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="../../../2023/08/29/%E6%95%B0%E5%AD%A6/%E4%B8%80%E6%96%87%E6%90%9E%E6%87%82%E8%B4%9D%E5%8F%B6%E6%96%AF%E5%AE%9A%E7%90%86%EF%BC%88%E5%BA%94%E7%94%A8%E7%AF%87%EF%BC%89/"
                            aria-label=": 一文搞懂贝叶斯定理（应用篇）"
                        >
                            一文搞懂贝叶斯定理（应用篇）
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2023-08-29T16:26:57+08:00">
	
		    2023 年 8 月 29 日
    	
    </time>
    
        <span>分類 </span>
        
    <a class="category-link" href="../../../categories/%E5%9F%BA%E7%A1%80/">基础</a>, <a class="category-link" href="../../../categories/%E5%9F%BA%E7%A1%80/%E6%95%B0%E5%AD%A6/">数学</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>在统计学里，长期以来，有频率学派和贝叶斯学派两大学派，他们互相鄙视对方，就像华山派的气宗与剑宗之争。</p>
<p>这两大学派最根本的观点在于看待世界的方式不同：</p>
<ul>
<li>频率学派认为世界是客观的，必须通过大量独立采样来获得统计均值，不能先给出一个主观的先验概率（假设）；</li>
<li>贝叶斯学派则认为概率是一种信念度，可以有非常主观的先验概率，然后，通过一次次采样结果修正先验概率，使之逼近客观事实。</li>
</ul>
<p>这两大学派哪个才是正确的？其实都对，只是看待世界的角度不同。但是在现实世界中，除了抛硬币、掷骰子、玩老虎机等少数符合理想数学模型的场景，频率学派才能发挥作用。大多数需要我们估算概率的现实场景，只能用贝叶斯理论来指导实践。</p>
<p>举个例子，假设我住在市区，希望赶上飞机的概率不低于90%，那么我应该提前多久出发呢？我必须试验至少100次，看看样本空间，才能获得一个比较准确的统计均值。然而这是不现实的，因为我一年可能就坐几次飞机。我只能拍脑袋先估一个提前30分钟就够了，结果第三次就没赶上，这说明我必须修正我的先验概率，后续改为提前45分钟，才能提升赶上飞机的概率。</p>
<p>我们再以《狼来了》的故事为例，当小孩第一次喊狼来了，村民听到后可以根据先验概率，比如P(小孩是诚实的)=90%判断赶紧去帮忙，结果发现被骗了，于是大家根据“被骗了”这一证据把后验概率P(小孩是诚实的)调整为60%，第二次又被骗了，于是再次把后验概率调整为20%，等到第三次听见小孩求救时，大家根据P(小孩是诚实的)=20%判断，他大概率还是在说谎，于是没有人去帮忙了。</p>
<p>有的同学会问，你说的这些，都是定性分析，没有定量计算啊！</p>
<p>要把贝叶斯定理用到定量计算，必须得借助计算机。</p>
<p>以吴军老师在中文分词领域举的一个例子来说，对于一个句子：南京市长江大桥，可以有两种划分：</p>
<ul>
<li>南京市 / 长江大桥</li>
<li>南京市长 / 江大桥</li>
</ul>
<p>到底哪一种更合理？我们可以计算条件概率：</p>
<ul>
<li>P(长江大桥|南京市) = 出现“南京市”时，出现“长江大桥”的概率；</li>
<li>P(江大桥|南京市长) = 出现“南京市长”时，出现“江大桥”的概率。</li>
</ul>
<p>提前准备好大量的中文语料，计算出任意两个词的条件概率，我们就可以得出哪种分词更合理。</p>
<p>在互联网领域，凡是遇到“当出现xyz时应该推荐什么”这样的条件概率时，也总是能应用贝叶斯理论。</p>
<p>例如，我们在搜索引擎中输入<code>elon</code>这个单词后，搜索框自动给出了联想补全：</p>
<p><img src="https://liaoxuefeng.com/blogs/all/2023-08-29-bayes-use/elon.png" alt="elon"></p>
<p>怎么实现这个功能？把用户最近搜索的所有可能的单词列出来，然后计算条件概率：</p>
<ul>
<li>P(mask|elon)=0.5</li>
<li>P(jerk|elon)=0.1</li>
<li>P(university|elon)=0.2</li>
<li>…</li>
</ul>
<p>把它们排个序，选出条件概率最大的几个，就是搜索建议。</p>
<p>诸如反垃圾邮件、电商推荐系统等，都是贝叶斯理论在机器学习中的应用。由于需要大量的计算，贝叶斯理论也只有在计算机时代才能广泛应用。</p>
<h3 id="关于信念">关于信念</h3>
<p>我们再回顾一下贝叶斯定理：</p>
<p>稍微改一下，变为：</p>
<p>P(H)是先验概率，P(H|E)是后验概率，P(E|H)/P(E)被称为调整因子，先验概率乘以调整因子就得到后验概率。</p>
<p>我们发现，如果P(H)=0，则P(H|E)=0；如果P(H)=1，则P(E|H)=P(E)，P(H|E)=1。</p>
<p>也就是说，如果先验概率为0%或100%，那么，无论出现任何证据E，都无法改变后验概率P(H|E)。这对我们看待世界的认知有重大指导意义，因为贝叶斯概率的本质是信念，通过一次次事件，我们可能加强某种信念，也可能减弱某种信念，但如果信念保持100%或0%，则可以做到对外界输入完全“免疫”。</p>
<p>举个例子，十年前许多人都认为比特币是庞氏骗局，如果100%坚定地持有这种信念，那么他将无视用户越来越多、价格上涨、交易量扩大、机构入市等诸多证据，至今仍然会坚信比特币是骗局而错过无数次机会。（注：此处示例不构成任何投资建议）</p>
<p>对于新生事物，每个人都可以有非常主观的先验概率，但只要我们不把先验概率定死为0或100%，就有机会改变自己的信念，从而更有可能接近客观事实，这也是贝叶斯定理的精髓：</p>
<blockquote>
<p>你相信什么并不重要，重要的是你别完全相信它。</p>
</blockquote>

                    
                        


                    
                    
                        <p>
                            <a
                                href="../../../2023/08/29/%E6%95%B0%E5%AD%A6/%E4%B8%80%E6%96%87%E6%90%9E%E6%87%82%E8%B4%9D%E5%8F%B6%E6%96%AF%E5%AE%9A%E7%90%86%EF%BC%88%E5%BA%94%E7%94%A8%E7%AF%87%EF%BC%89/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
          <li class="pagination-prev">
            <a
                class="btn btn--default btn--small"
                href="../2/"
                aria-label="上一頁"
            >
              <i class="fa fa-angle-left text-base icon-mr"></i>
              <span>上一頁</span>
            </a>
          </li>
        
        
          <li class="pagination-next">
            <a
                class="btn btn--default btn--small"
                href="../4/"
                aria-label="下一頁"
            >
              <span>下一頁</span>
              <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
          </li>
        
        <li class="pagination-number">第 3 頁 共 24 頁</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Kein Chan. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="../../../assets/images/profile.jpg" alt="作者的圖片"/>
        
            <h4 id="about-card-name">Kein Chan</h4>
        
            <div id="about-card-bio"><p>這是獨立全棧工程師Kein Chan的技術博客</br>分享一些技術教程,命令備忘(cheat-sheet)等</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>全棧工程師</br>資深技術顧問</br>數據科學家</br>Hit廣島觀光大使</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Tokyo/Macau
            </div>
        
    </div>
</div>

        
            <div id="algolia-search-modal" class="modal-container">
    <div class="modal">
        <div class="modal-header">
            <span class="close-button"><i class="fa fa-times"></i></span>
            <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
                <span class="searchby-algolia-text text-color-light text-small">by</span>
                <img class="searchby-algolia-logo" src="../assets/images/logo-algolia-nebula-blue-full.svg">
            </a>
            <i class="search-icon fa fa-search"></i>
            <form id="algolia-search-form">
                <input type="text" id="algolia-search-input" name="search"
                    class="form-control input--large search-input" placeholder="Search "
                    />
            </form>
        </div>
        <div class="modal-body">
            <div class="no-result text-color-light text-center">沒有找到文章</div>
            <div class="results">
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://keinchan.com/2013/04/27/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/"
                            aria-label=": R语言-环境安装"
                        >
                            <h3 class="media-heading">R语言-环境安装</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年4月27日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://keinchan.com/2013/04/28/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E5%9F%BA%E7%A1%80/"
                            aria-label=": R语言-基础"
                        >
                            <h3 class="media-heading">R语言-基础</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年4月28日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://keinchan.com/2013/05/01/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE/"
                            aria-label=": R语言-读取数据"
                        >
                            <h3 class="media-heading">R语言-读取数据</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月1日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://keinchan.com/2013/05/02/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E7%BB%98%E5%9B%BE/"
                            aria-label=": R语言-绘图"
                        >
                            <h3 class="media-heading">R语言-绘图</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月2日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://keinchan.com/2013/05/03/R%E8%AF%AD%E8%A8%80/R%E8%AF%AD%E8%A8%80-%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/"
                            aria-label=": R语言-线性回归"
                        >
                            <h3 class="media-heading">R语言-线性回归</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2013年5月3日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://keinchan.com/2015/02/22/Algorithms/1.%E7%AE%97%E6%B3%95%E5%9C%A8%E8%AE%A1%E7%AE%97%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8/"
                            aria-label=": 1. 算法在计算中的作用"
                        >
                            <h3 class="media-heading">1. 算法在计算中的作用</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月22日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://keinchan.com/2015/02/23/Algorithms/2.%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80/"
                            aria-label=": 2. 算法基础"
                        >
                            <h3 class="media-heading">2. 算法基础</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月23日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://keinchan.com/2015/02/24/Algorithms/3.%E5%87%BD%E6%95%B0%E7%9A%84%E5%A2%9E%E9%95%BF/"
                            aria-label=": 3. 函数的增长"
                        >
                            <h3 class="media-heading">3. 函数的增长</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月24日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://keinchan.com/2015/02/25/Algorithms/4.%E5%88%86%E6%B2%BB%E7%AD%96%E7%95%A5/"
                            aria-label=": 4. 分治策略"
                        >
                            <h3 class="media-heading">4. 分治策略</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月25日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://keinchan.com/2015/02/26/Algorithms/5.%E6%A6%82%E7%8E%87%E5%88%86%E6%9E%90%E5%92%8C%E9%9A%8F%E6%9C%BA%E7%AE%97%E6%B3%95/"
                            aria-label=": 5. 概率分析和随机算法"
                        >
                            <h3 class="media-heading">5. 概率分析和随机算法</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年2月26日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <p class="results-count text-medium"
                data-message-zero="沒有找到文章"
                data-message-one="找到 1 篇文章"
                data-message-other="找到 {n} 篇文章">
                找到 234 篇文章
            </p>
        </div>
    </div>
</div>

        
        
<div id="cover" style="background-image:url('../../../assets/images/cover.jpeg');"></div>
        <!--SCRIPTS-->

<script src="../../../assets/js/script-qtzvvb63gamuirvfphht7lytrxkfllzng1escnm2phjtlt4tvvxi5gl0wx4o.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
